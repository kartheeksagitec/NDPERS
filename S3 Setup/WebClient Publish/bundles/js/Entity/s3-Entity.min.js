function AddEditConstraintsController(n,t,i,r,u){var f=this;f.autoSave=n;f.attributeName=t;f.entityModel=i;f.entityId=r;f.applicationPortals=[];$.connection.hubMain.server.populateMessageList().done(function(n){f.lstMessages=n});$.connection.hubMain.server.getPortalsModel().done(function(n){var i,r,t;if(n&&n.Elements.length)for(i=0,r=n.Elements.length;i<r;i++)t=n.Elements[i],t&&t.dictAttributes&&t.dictAttributes.ID&&t.dictAttributes.sfwPortalName&&!f.applicationPortals.some(function(n){return n.id===t.dictAttributes.ID})&&f.applicationPortals.push({id:t.dictAttributes.ID,name:t.dictAttributes.sfwPortalName})});f.getErrorObject=function(n){return n.errors||(n.errors={}),n.errors};f.initilize=function(){f.isNewMode=!0;f.attributeConstraintModel=null;f.lstConstraints=[];f.errorMessage=null;f.operators=["Equal","NotEqual","LessThan","LessThanEqual","GreaterThan","GreaterThanEqual"];f.entityModel?(f.entityId||(f.entityId=f.entityModel.dictAttributes.ID),f.setAttributeConstraintModel()):f.entityId?$.connection.hubEntityModel.server.getEntityModelById(f.entityId).done(function(n){n?(f.entityModel=n,f.setAttributeConstraintModel()):f.errorMessage=String.format("entity '{0}' not found.",f.entityId)}):f.errorMessage="entity id is not specified."};f.setAttributeConstraintModel=function(){var v,y,p,w,l,t,e,i,r,s,a,o,k,b,h,d,c,n,g,nt;if(f.attributeName?(f.entityConstraintModel=f.entityModel.Elements.filter(function(n){return n.Name==="constraint"})[0],f.entityConstraintModel&&(f.attributeConstraintModel=f.entityConstraintModel.Elements.filter(function(n){return n.Name==="item"&&n.dictAttributes.sfwFieldName===f.attributeName})[0]),f.attributeConstraintModel?f.isNewMode=!1:(f.isNewMode=!0,f.attributeConstraintModel=new BaseModel("item"))):(f.isNewMode=!0,f.attributeConstraintModel=new BaseModel("item")),f.attributeConstraintModel&&!f.isNewMode){if(f.datatype=f.attributeConstraintModel.dictAttributes.sfwDataType,f.displayName=f.attributeConstraintModel.dictAttributes.sfwDisplayName,f.attributePortalMessages=f.attributeConstraintModel.Elements.filter(function(n){return n.Name==="portalmessages"})[0],f.attributeConstraintModel.dictAttributes.sfwRequired&&f.attributeConstraintModel.dictAttributes.sfwRequired.toLowerCase()==="true"){if(v=new BaseConstraint("Required",f.attributeConstraintModel.dictAttributes.sfwReqMessageId),f.attributePortalMessages)for(t=f.attributePortalMessages.Elements.filter(function(n){return n.Name==="portal"&&n.dictAttributes.sfwReqMessageId}),n=0,r=t.length;n<r;n++)e=new PortalMessage(t[n].dictAttributes.sfwPortalName,t[n].dictAttributes.sfwReqMessageId),v.portalMessages.push(e);f.lstConstraints.push(v)}if(f.attributeConstraintModel.dictAttributes.sfwMinValue){if(y=new ValueConstraint("Min",f.attributeConstraintModel.dictAttributes.sfwMinMessageId,f.attributeConstraintModel.dictAttributes.sfwMinValue),f.attributePortalMessages)for(t=f.attributePortalMessages.Elements.filter(function(n){return n.Name==="portal"&&n.dictAttributes.sfwMinMessageId}),n=0,r=t.length;n<r;n++)e=new PortalMessage(t[n].dictAttributes.sfwPortalName,t[n].dictAttributes.sfwMinMessageId),y.portalMessages.push(e);f.lstConstraints.push(y)}if(f.attributeConstraintModel.dictAttributes.sfwMaxValue){if(p=new ValueConstraint("Max",f.attributeConstraintModel.dictAttributes.sfwMaxMessageId,f.attributeConstraintModel.dictAttributes.sfwMaxValue),f.attributePortalMessages)for(t=f.attributePortalMessages.Elements.filter(function(n){return n.Name==="portal"&&n.dictAttributes.sfwMaxMessageId}),n=0,r=t.lenght;n<r;n++)e=new PortalMessage(t[n].sfwPortalName,t[n].sfwMaxMessageId),p.portalMessages.push(e);f.lstConstraints.push(p)}if(f.attributeConstraintModel.dictAttributes.sfwLength){if(w=new ValueConstraint("Length",f.attributeConstraintModel.dictAttributes.sfwLengthMessageId,f.attributeConstraintModel.dictAttributes.sfwLength),f.lengthConstraintExists=!0,f.attributePortalMessages)for(t=f.attributePortalMessages.Elements.filter(function(n){return n.Name==="portal"&&n.dictAttributes.sfwLengthMessageId}),n=0,r=t.length;n<r;n++)e=new PortalMessage(t[n].dictAttributes.sfwPortalName,t[n].dictAttributes.sfwLengthMessageId),w.portalMessages.push(e);f.lstConstraints.push(w)}if(f.attributeConstraintModel.dictAttributes.sfwRelatedField){if(l=new CompareConstraint("Compare",f.attributeConstraintModel.dictAttributes.sfwCompMessageId,f.attributeConstraintModel.dictAttributes.sfwRelatedField,f.attributeConstraintModel.dictAttributes.sfwOperator),l.relatedDisplayName=f.attributeConstraintModel.dictAttributes.sfwRelDisplayName,f.attributePortalMessages)for(t=f.attributePortalMessages.Elements.filter(function(n){return n.Name==="portal"&&n.dictAttributes.sfwCompMessageId}),n=0,r=t.length;n<r;n++)e=new PortalMessage(t[n].dictAttributes.sfwPortalName,t[n].dictAttributes.sfwCompMessageId),l.portalMessages.push(e);f.lstConstraints.push(l)}if(f.ruleQueryConstraints=f.attributeConstraintModel.Elements.filter(function(n){return n.Name==="rulequeryconstraints"})[0],f.ruleQueryConstraints)for(i=0,r=f.ruleQueryConstraints.Elements.length;i<r;i++){if(s=f.ruleQueryConstraints.Elements[i].dictAttributes.sfwCompValue,h=!1,s&&s.indexOf("#")===0&&(s=s.substring(1),h=!0),a=new RuleQueryConstraint(f.ruleQueryConstraints.Elements[i].dictAttributes.sfwLoadType,f.ruleQueryConstraints.Elements[i].dictAttributes.sfwMessageId,s,f.ruleQueryConstraints.Elements[i].dictAttributes.sfwOperator,f.ruleQueryConstraints.Elements[i].dictAttributes.sfwLoadSource,f.ruleQueryConstraints.Elements[i].dictAttributes.sfwMode,f.ruleQueryConstraints.Elements[i].dictAttributes.sfwRelatedFieldConstraints,h,f.ruleQueryConstraints.Elements[i].dictAttributes.sfwExecuteOnChange),o=f.ruleQueryConstraints.Elements[i].Elements.filter(function(n){return n.Name==="parameters"})[0],o)for(n=0,k=o.Elements.length;n<k;n++)b=o.Elements[n].dictAttributes.sfwExpression,h=!1,o.Elements[n].dictAttributes.sfwExpression&&o.Elements[n].dictAttributes.sfwExpression.indexOf("#")===0&&(b=o.Elements[n].dictAttributes.sfwExpression.substring(1),h=!0),d=new Parameter(o.Elements[n].dictAttributes.ID,o.Elements[n].dictAttributes.sfwDataType,b,h),a.parameters.push(d);if(c=f.ruleQueryConstraints.Elements[i].Elements.filter(function(n){return n.Name==="portalmessages"})[0],c)for(n=0,g=c.Elements.length;n<g;n++)nt=new PortalMessage(c.Elements[n].dictAttributes.sfwPortalName,c.Elements[n].dictAttributes.sfwMessageId),a.portalMessages.push(nt);f.lstConstraints.push(a)}}f.attributeName?f.onAttributeChanged():(f.allowConstraint(),f.getErrorObject(f).attributeName="The field can not be empty.");!f.isNewMode&&u.$parent.dialog&&u.$parent.dialog.updateTitle&&u.$parent.dialog.updateTitle("Edit Constraint");f.validate()};f.onOKClick=function(){var o,l,n,i,s,h,a,c,t,r,e;if(f.attributeConstraintModel.dictAttributes={},f.attributePortalMessages)while(f.attributePortalMessages.Elements.length)u.$root.DeleteItem(f.attributePortalMessages.Elements[0],f.attributePortalMessages.Elements);else f.attributePortalMessages=new BaseModel("portalmessages"),f.attributeConstraintModel.Elements.push(f.attributePortalMessages);if(f.ruleQueryConstraints)while(f.ruleQueryConstraints.Elements.length)u.$root.DeleteItem(f.ruleQueryConstraints.Elements[0],f.ruleQueryConstraints.Elements);else f.ruleQueryConstraints=new BaseModel("rulequeryconstraints"),f.attributeConstraintModel.Elements.push(f.ruleQueryConstraints);for(f.attributeConstraintModel.dictAttributes.sfwFieldName=f.attributeName,f.attributeConstraintModel.dictAttributes.sfwDataType=f.datatype,f.attributeConstraintModel.dictAttributes.sfwDisplayName=f.displayName,o=0,l=f.lstConstraints.length;o<l;o++)if(n=f.lstConstraints[o],n.type==="Required"){if(f.attributeConstraintModel.dictAttributes.sfwRequired="True",f.attributeConstraintModel.dictAttributes.sfwReqMessageId=n.messageId,n.portalMessages.length)for(t=0,r=n.portalMessages.length;t<r;t++)i=f.attributePortalMessages.Elements.filter(function(i){return i.dictAttributes.sfwPortalName===n.portalMessages[t].portalName})[0],i?i.dictAttributes.sfwReqMessageId=n.portalMessages[t].messageId:f.attributePortalMessages.Elements.push(new BaseModel("portal",{sfwPortalName:n.portalMessages[t].portalName,sfwReqMessageId:n.portalMessages[t].messageId}))}else if(n.type==="Min"){if(f.attributeConstraintModel.dictAttributes.sfwMinValue=n.value,f.attributeConstraintModel.dictAttributes.sfwMinMessageId=n.messageId,n.portalMessages.length)for(t=0,r=n.portalMessages.length;t<r;t++)i=f.attributePortalMessages.Elements.filter(function(i){return i.dictAttributes.sfwPortalName===n.portalMessages[t].portalName})[0],i?i.dictAttributes.sfwMinMessageId=n.portalMessages[t].messageId:f.attributePortalMessages.Elements.push(new BaseModel("portal",{sfwPortalName:n.portalMessages[t].portalName,sfwMinMessageId:n.portalMessages[t].messageId}))}else if(n.type==="Max"){if(f.attributeConstraintModel.dictAttributes.sfwMaxValue=n.value,f.attributeConstraintModel.dictAttributes.sfwMaxMessageId=n.messageId,n.portalMessages.length)for(t=0,r=n.portalMessages.length;t<r;t++)i=f.attributePortalMessages.Elements.filter(function(i){return i.dictAttributes.sfwPortalName===n.portalMessages[t].portalName})[0],i?i.dictAttributes.sfwMaxMessageId=n.portalMessages[t].messageId:f.attributePortalMessages.Elements.push(new BaseModel("portal",{sfwPortalName:n.portalMessages[t].portalName,sfwMaxMessageId:n.portalMessages[t].messageId}))}else if(n.type==="Length"){if(f.attributeConstraintModel.dictAttributes.sfwLength=n.value,f.attributeConstraintModel.dictAttributes.sfwLengthMessageId=n.messageId,n.portalMessages.length)for(t=0,r=n.portalMessages.length;t<r;t++)i=f.attributePortalMessages.Elements.filter(function(i){return i.dictAttributes.sfwPortalName===n.portalMessages[t].portalName})[0],i?i.dictAttributes.sfwLengthMessageId=n.portalMessages[t].messageId:f.attributePortalMessages.Elements.push(new BaseModel("portal",{sfwPortalName:n.portalMessages[t].portalName,sfwLengthMessageId:n.portalMessages[t].messageId}))}else if(n.type==="Compare"){if(f.attributeConstraintModel.dictAttributes.sfwRelatedField=n.value,f.attributeConstraintModel.dictAttributes.sfwRelDisplayName=n.relatedDisplayName,f.attributeConstraintModel.dictAttributes.sfwCompMessageId=n.messageId,f.attributeConstraintModel.dictAttributes.sfwOperator=n.operator,n.portalMessages.length)for(t=0,r=n.portalMessages.length;t<r;t++)i=f.attributePortalMessages.Elements.filter(function(i){return i.dictAttributes.sfwPortalName===n.portalMessages[t].portalName})[0],i?i.dictAttributes.sfwCompMessageId=n.portalMessages[t].messageId:f.attributePortalMessages.Elements.push(new BaseModel("portal",{sfwPortalName:n.portalMessages[t].portalName,sfwCompMessageId:n.portalMessages[t].messageId}))}else{if(s=new BaseModel("rulequery",{sfwLoadType:n.type,sfwLoadSource:n.loadSource,sfwOperator:n.operator,sfwCompValue:n.isConstantValue?"#"+n.value:n.value,sfwRelatedFieldConstraints:n.dependentAttributes,sfwMessageId:n.messageId,sfwMode:n.mode,sfwExecuteOnChange:n.executeOnChange}),n.parameters.length)for(h=new BaseModel("parameters"),s.Elements.push(h),t=0,a=n.parameters.length;t<a;t++)h.Elements.push(new BaseModel("parameter",{ID:n.parameters[t].id,sfwDataType:n.parameters[t].datatype,sfwExpression:n.parameters[t].isConstant?"#"+n.parameters[t].expression:n.parameters[t].expression}));if(n.portalMessages.length)for(c=new BaseModel("portalmessages"),s.Elements.push(c),t=0,r=n.portalMessages.length;t<r;t++)c.Elements.push(new BaseModel("portal",{sfwPortalName:n.portalMessages[t].portalName,sfwMessageId:n.portalMessages[t].messageId}));f.ruleQueryConstraints.Elements.push(s)}f.autoSave?$.connection.hubEntityModel.server.addAttributeConstraintAndSave(f.attributeConstraintModel,f.entityId).done(function(){}):f.isNewMode&&(e=f.entityModel.Elements.filter(function(n){return n.Name==="constraint"})[0],e||(e=new BaseModel("constraint"),u.$root.PushItem(e,f.entityModel.Elements)),u.$root.PushItem(f.attributeConstraintModel,e.Elements));u.onCancelClick&&u.onCancelClick()};f.onAttributeChanged=function(){var t=u.entityIntellisenseFactory.getAttributes(f.entityId,["column","property"],null,!0),n=t.filter(function(n){return n.ID===f.attributeName})[0];n&&u.$evalAsync(function(){f.datatype=n.DataType;f.displayName||(f.displayName=n.Caption)});f.allowConstraint();f.validate()};f.allowConstraint=function(){u.$evalAsync(function(){f.allowMinConstraint=!1;f.allowMaxConstraint=!1;f.allowLengthConstraint=!1;f.allowCompareConstraint=!1;f.datatype&&["decimal","double","float","long","short","int"].indexOf(f.datatype)>-1?(f.allowMinConstraint=!0,f.allowMaxConstraint=!0):(f.deleteConstraint("Min"),f.deleteConstraint("Max"));f.datatype&&f.datatype==="string"?f.allowLengthConstraint=!0:f.deleteConstraint("Length");f.datatype&&["decimal","double","float","long","short","int","datetime"].indexOf(f.datatype)>-1?f.allowCompareConstraint=!0:f.deleteConstraint("Compare");f.updateHasConstraintFlags()})};f.updateHasConstraintFlags=function(){f.hasRequiredConstraint=f.lstConstraints.some(function(n){return n.type==="Required"});f.hasMinConstraint=f.lstConstraints.some(function(n){return n.type==="Min"});f.hasMaxConstraint=f.lstConstraints.some(function(n){return n.type==="Max"});f.hasLengthConstraint=f.lstConstraints.some(function(n){return n.type==="Length"});f.hasCompareConstraint=f.lstConstraints.some(function(n){return n.type==="Compare"})};f.selectConstraint=function(n){f.selectedConstraint=n;f.selectedConstraint.messageId&&!f.selectedConstraint.message&&f.updateMessageText(f.selectedConstraint)};f.onLoadSourceChanged=function(n){f.populateParameters(n);f.validate()};f.populateParameters=function(n){var o,s,r,h,l,t,e,a,i,c;if(n&&(o=null,n.parameters.length&&(o=JSON.parse(JSON.stringify(n.parameters))),n.parameters.length=0,n.loadSource&&(t=null,n.type==="Rule"?(s=f.entityId,r=null,n.loadSource.indexOf(".")>-1?(h=n.loadSource.split("."),h.length>1&&(s=h[0],r=h[1])):r=n.loadSource,s&&r&&(l=u.entityIntellisenseService.GetIntellisenseData(s,"","",!0,!1,!1,!0,!1,!1),t=l.filter(function(n){return n.ID===r})[0])):n.type==="Query"&&(t=u.entityIntellisenseFactory.getQueryByQueryName(n.loadSource)),t)))for(e=0,a=t.Parameters.length;e<a;e++)i=new Parameter(t.Parameters[e].ID,t.Parameters[e].DataType),n.parameters.push(i),o&&(c=o.filter(function(n){return n.id===i.id&&n.datatype===i.datatype})[0],c&&(i.expression=c.expression,i.isConstant=c.isConstant))};f.setParameters=function(n){var t=u.$new();t.ctrl=f;t.constraint=JSON.parse(JSON.stringify(n));t.okClick=function(){f.selectedConstraint.parameters=t.constraint.parameters;t.dialog&&t.dialog.close&&t.dialog.close()};t.dialog=u.$root.showDialog(t,"Set Parameters","Entity/views/Constraint/SetConstraintParametersDialog.html",{showclose:!0})};f.onRelatedFieldChanged=function(n){var t,i;n.type==="Compare"&&(t=f.entityModel.Elements.filter(function(n){return n.Name.toLowerCase()==="attributes"})[0],t&&(i=t.Elements.filter(function(t){return t.dictAttributes.ID===n.value})[0],i&&u.$evalAsync(function(){n.relatedDisplayName=i.dictAttributes.sfwCaption})));f.validate()};f.addConstraint=function(n){var t=null;switch(n){case"Required":f.lstConstraints.some(function(t){return t.type===n})||(t=new BaseConstraint(n));break;case"Min":case"Max":case"Length":f.lstConstraints.some(function(t){return t.type===n})||(t=new ValueConstraint(n));break;case"Compare":f.lstConstraints.some(function(t){return t.type===n})||(t=new CompareConstraint(n));break;case"Rule":case"Query":t=new RuleQueryConstraint(n)}t&&(f.lstConstraints.push(t),f.selectConstraint(t),f.validate())};f.updateConstraints=function(){f.hasRequiredConstraint?f.addConstraint("Required"):f.deleteConstraint("Required");f.hasLengthConstraint?f.addConstraint("Length"):f.deleteConstraint("Length");f.hasMinConstraint?f.addConstraint("Min"):f.deleteConstraint("Min");f.hasMaxConstraint?f.addConstraint("Max"):f.deleteConstraint("Max");f.hasCompareConstraint?f.addConstraint("Compare"):f.deleteConstraint("Compare")};f.deleteConstraint=function(n){var i=null,t;i=n?f.lstConstraints.filter(function(t){return t.type===n})[0]:f.selectedConstraint;i&&(t=f.lstConstraints.indexOf(i),t>-1&&(f.lstConstraints.splice(t,1),i===f.selectedConstraint&&(t===f.lstConstraints.length&&t--,f.selectedConstraint=t>-1?f.lstConstraints[t]:null),f.validate()));n||f.updateHasConstraintFlags()};f.onMessageIdChanged=function(n){f.updateMessageText(n);f.validate()};f.updateMessageText=function(n){if(n&&(n.message="",n.messageId&&f.lstMessages)){var t=f.lstMessages.filter(function(t){return t.MessageID==n.messageId})[0];t&&(n.message=t.DisplayMessage)}};f.validateEntityAttribute=function(n,t){if(n&&t&&n.hasOwnProperty(t)){var i=u.entityIntellisenseFactory.getAttributes(f.entityId,["column","property"],null,!0);i.some(function(i){return i.ID===n[t]})||(f.getErrorObject(n)[t]="Invalid Attribute. Please select a valid column/property type attribute.")}};f.validateAttributeName=function(){f.errors=null;f.attributeName?f.constraintAlreadyPresent()?f.getErrorObject(f).attributeName="A constraint on this attribute already present.":f.validateEntityAttribute(f,"attributeName"):f.getErrorObject(f).attributeName="Attribute Name cannot be empty."};f.validateConstraint=function(n){(n.type==="Rule"||n.type==="Query")&&(n.loadSource||(f.getErrorObject(n).loadSource=n.type+"ID cannot be empty."));n.type!=="Required"&&f.validateValue(n);!n.errors||n.errors.loadSource||n.errors.value||n.errors.messageId||(n.errors=null)};f.validateValue=function(n){var t=f.getErrorObject(n);t.value=null;n.value?["Min","Max","Length"].indexOf(n.type)>-1?isNaN(n.value)&&(t.value="Value should be numeric."):["Compare","Rule","Query"].indexOf(n.type)>-1&&(n.value===f.attributeName&&(t.value="Value(Related Attribute Name) cannot be same as the Attribute Name."),n.isConstantValue||f.validateEntityAttribute(n,"value")):t.value="Value cannot be empty."};f.validate=function(){if(f.errorMessage="",f.validateAttributeName(),f.errors&&f.errors.attributeName)f.errorMessage=f.errors.attributeName;else if(f.lstConstraints.length){f.errors=null;for(var n=0,t=f.lstConstraints.length;n<t;n++)f.validateConstraint(f.lstConstraints[n]);f.lstConstraints.some(function(n){return n.errors})&&(f.errorMessage="Please resolve the validation error(s) for one or more constraints.")}else f.errors=null,f.errorMessage="Please add at least one type of constraint."};f.constraintAlreadyPresent=function(){var n=!1,t=f.entityModel.Elements.filter(function(n){return n.Name==="constraint"})[0];return t&&(n=t.Elements.some(function(n){return n.Name==="item"&&n.dictAttributes.sfwFieldName===f.attributeName&&n!==f.attributeConstraintModel})),n};f.setPortalMessages=function(n){var t=u.$new();t.ctrl=f;t.constraint=JSON.parse(JSON.stringify(n));t.okClick=function(){f.selectedConstraint.portalMessages=t.constraint.portalMessages;t.dialog&&t.dialog.close&&t.dialog.close()};t.selectPortal=function(n){t.selectedPortal=n};t.addPortal=function(){var n=new PortalMessage;t.constraint.portalMessages.push(n);t.selectPortal(n);t.validatePortals()};t.canDeletePortal=function(){return t.selectedPortal};t.deletePortal=function(){var n=t.constraint.portalMessages.indexOf(t.selectedPortal);n>-1&&(t.constraint.portalMessages.splice(n,1),t.constraint.portalMessages.length>0&&(n==t.constraint.portalMessages.length&&n--,t.selectPortal(t.constraint.portalMessages[n])));t.validatePortals()};t.validatePortal=function(n){n.portalName?t.constraint.portalMessages.some(function(t){return t.portalName===n.portalName&&t!==n})?t.ctrl.getErrorObject(n).portalName="Duplicate Portal Name. Please select different portal name.":n.errors&&(t.ctrl.getErrorObject(n).portalName=null):t.ctrl.getErrorObject(n).portalName="Portal Name cannot be empty.";n.messageId?n.errors&&(t.ctrl.getErrorObject(n).portalName=null):t.ctrl.getErrorObject(n).messageId="Message ID cannot be empty."};t.validatePortals=function(){t.portalError="";for(var n=0,i=t.constraint.portalMessages.length;n<i;n++)t.validatePortal(t.constraint.portalMessages[n]);t.constraint.portalMessages.some(function(n){return n.errors&&(n.errors.portalName||n.errors.messageId)})&&(t.portalError="Please resolve validation errors.")};t.onPortalNameChanged=function(){t.validatePortals()};t.onPortalMessageChanged=function(n){t.validatePortals();f.updateMessageText(n)};t.validatePortals();t.dialog=u.$root.showDialog(t,"Set Portal Messages","Entity/views/Constraint/SetPortalMessagesDialog.html",{showclose:!0})};f.initilize()}function BaseConstraint(n,t){this.type=n;this.messageId=t?t:"";this.message="";this.portalMessages=[]}function ValueConstraint(n,t,i){BaseConstraint.call(this,n,t);this.value=i?i:""}function CompareConstraint(n,t,i,r){ValueConstraint.call(this,n,t,i);this.operator=r?r:"Equal";this.relatedDisplayName=""}function RuleQueryConstraint(n,t,i,r,u,f,e,o,s){CompareConstraint.call(this,n,t,i,r);this.loadSource=u?u:"";this.mode=f?f:"All";this.dependentAttributes=e?e:"";this.parameters=[];this.isConstantValue=o?o:!1;this.executeOnChange=s?s:"True"}function PortalMessage(n,t){this.portalName=n;this.messageId=t?t:"";this.message=""}function Parameter(n,t,i,r){this.id=n;this.datatype=t?t:"";this.expression=i?i:"";this.isConstant=r}function BaseModel(n,t){this.Name=n;this.dictAttributes=t?t:{};this.Elements=[];this.Children=[]}function expandCollapseQuery(n){var i=n.target,t=$(i).parents("table");t.length>0&&$(t[0]).siblings("ul").slideToggle()}function extractLastValue(n){return split(n).pop()}function getIntellisenseDataForMsgs(n){var i=[],f=getCurrentFileScope(),u=f,r,t;if(u&&u.lstMessages){for(i=u.lstMessages,i=i.sort(),r=[],t=0;t<i.length;t++)i[t]&&i[t].DisplayMessageID.toLowerCase().indexOf(n.toLowerCase())>-1&&r.push(i[t]);if(lstTop100Msgs=[],r.length>100)for(t=0;t<=100;t++)lstTop100Msgs.push(r[t]);else lstTop100Msgs=r}return lstTop100Msgs}function onActionKeyDownForlstMsgs(n){var t=n.target,u=n.which?n.which:n.keyCode,r,i;n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")&&($(t).autocomplete("search",$(t).val()),n.preventDefault());r=n.char=="\b"?n.target.value.slice(0,-1):n.target.value+n.char;i=getIntellisenseDataForMsgs($(t).val());controlSelection=$(t);i&&controlSelection.autocomplete({minLength:0,source:function(n,t){var r=n.term,u=[];r!=undefined&&(r=extractLastValue(n.term),u=$.ui.autocomplete.filter($.map(i,function(n){return typeof n.DisplayMessageID=="undefined"?{label:n,value:n}:{label:n.DisplayMessageID,value:n}}),extractLastValue(n.term,this.element[0].selectionStart)));t(u)},focus:function(n,t){return $(".ui-autocomplete > li").attr("title",t.item.label),!1},select:function(n,t){var i=this;return i.value=t.item.value.DisplayMessageID?t.item.value.MessageID:t.item.value,$(this).trigger("change"),!1}})}function extractLastValue(n){return split(n).pop()}function getIntellisenseDataForChecklistID(n){for(var r=[],e=getCurrentFileScope(),t=e,f,u,i;t!=null;)if(t.$root){t=t.$root;break}else t=t.$parent;if(f=[],t&&t.lstCodeGroups){for(r=t.lstCodeGroups,r=r.sort(),u=[],i=0;i<r.length;i++)r[i].CodeIDDescription.toLowerCase().indexOf(n.toLowerCase())>-1&&u.push(r[i]);if(u.length>100)for(i=0;i<=100;i++)f.push(u[i]);else f=u}return f}function onActionKeyDownForlstCheckListID(n){var t=n.target,u=n.which?n.which:n.keyCode,r,i;n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")&&($(t).autocomplete("search",$(t).val()),n.preventDefault());r=n.char=="\b"?n.target.value.slice(0,-1):n.target.value+n.char;i=getIntellisenseDataForChecklistID($(t).val());controlSelection=$(t);i&&controlSelection.autocomplete({minLength:0,source:function(n,t){var r=n.term,u=[];r!=undefined&&(r=extractLastValue(n.term),u=$.ui.autocomplete.filter($.map(i,function(n){return typeof n.CodeIDDescription=="undefined"?{label:n,value:n}:{label:n.CodeIDDescription,value:n}}),extractLastValue(n.term,this.element[0].selectionStart)));t(u)},focus:function(n,t){return $(".ui-autocomplete > li").attr("title",t.item.label),!1},select:function(n,t){var i=this;return i.value=t.item.value.CodeIDDescription?t.item.value.CodeID:t.item.value,$(this).trigger("change"),!1}})}function getIntellisenseDataForChecklistIDForRules(n){for(var i=[],f=getCurrentFileScope(),t=f,u,r;t!=null;)if(t.$root){t=t.$root;break}else t=t.$parent;if(t&&t.lstCodeGroups)for(i=t.lstCodeValue,i=i.sort(),u=[],r=0;r<i.length;r++)i[r].CodeIDDescription.toLowerCase().indexOf(n.toLowerCase())>-1&&u.push(i[r]);return u}function onActionKeyDownForlstCheckListIDForRules(n){var t=n.target,u=n.which?n.which:n.keyCode,r,i;n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")&&($(t).autocomplete("search",$(t).val()),n.preventDefault());r=n.char=="\b"?n.target.value.slice(0,-1):n.target.value+n.char;i=getIntellisenseDataForChecklistIDForRules(r);controlSelection=$(t);i&&controlSelection.autocomplete({minLength:0,source:function(n,t){var r=n.term,u=[];r!=""&&r!=undefined&&(r=extractLastValue(n.term),u=r.length>0?$.ui.autocomplete.filter($.map(i,function(n){return typeof n.CodeIDDescription=="undefined"?{label:n,value:n}:{label:n.CodeIDDescription,value:n}}),extractLastValue(n.term,this.element[0].selectionStart)):"");t(u)},focus:function(n,t){return $(".ui-autocomplete > li").attr("title",t.item.label),!1},select:function(n,t){var i=this;return i.value=t.item.value.CodeIDDescription?t.item.value.CodeValue:t.item.value,$(this).trigger("change"),!1}})}function getIntellisenseDataForErrortable(n){var t=[],f=getCurrentFileScope(),r=f,u,i;if(r&&r.lstErrorTable)for(t=r.lstErrorTable,t=t.sort(),u=[],i=0;i<t.length;i++)t[i].toLowerCase().indexOf(n.toLowerCase())>-1&&u.push(t[i]);return u}function onActionKeyDownForErrortables(n){var t=n.target,u=n.which?n.which:n.keyCode,r,i;n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")&&($(t).autocomplete("search",$(t).val()),n.preventDefault());r=n.char=="\b"?n.target.value.slice(0,-1):n.target.value+n.char;i=getIntellisenseDataForErrortable($(t).val());setSingleLevelAutoComplete($(t),i)}function showErrorTableData(n){var t,i;t||(t=$(n.target).prevAll("input[type='text']"));t.focus();i=getIntellisenseDataForErrortable($(t).val());t&&i&&(setSingleLevelAutoComplete(t,i),$(t).data("ui-autocomplete")&&$(t).autocomplete("search",$(t).val()));n&&n.stopPropagation()}function getIntellisenseDataForChecklisttable(n){var t=[],f=getCurrentFileScope(),r=f,u,i;if(r&&r.lstErrorTable)for(t=r.lstChecklistTable,t=t.sort(),u=[],i=0;i<t.length;i++)t[i].toLowerCase().indexOf(n.toLowerCase())>-1&&u.push(t[i]);return u}function onActionKeyDownForChecklisttables(n){var t=n.target,u=n.which?n.which:n.keyCode,r,i;n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")&&($(t).autocomplete("search",$(t).val()),n.preventDefault());r=n.char=="\b"?n.target.value.slice(0,-1):n.target.value+n.char;i=getIntellisenseDataForChecklisttable($(t).val());controlSelection=$(t);i&&controlSelection.autocomplete({minLength:0,source:function(n,t){var r=n.term,u=[];r!=undefined&&(r=extractLastValue(n.term),u=$.ui.autocomplete.filter($.map(i,function(n){return typeof n=="undefined"?{label:n,value:n}:{label:n,value:n}}),extractLastValue(n.term,this.element[0].selectionStart)));t(u)},focus:function(n,t){return $(".ui-autocomplete > li").attr("title",t.item.label),!1},select:function(n,t){var i=this;return i.value=t.item.value?t.item.value:t.item.value,$(this).trigger("change"),!1}})}function showCheckListTableData(n){var t,i;t||(t=$(n.target).prevAll("input[type='text']"));t.focus();i=getIntellisenseDataForChecklisttable($(t).val());t&&i&&(setSingleLevelAutoComplete(t,i),$(t).data("ui-autocomplete")&&$(t).autocomplete("search",$(t).val()));n&&n.stopPropagation()}function canDropRuleinChecklist(n,t){var i=!0;return(n==undefined||n==null||t==null||t==undefined)&&(i=!1),i}function onBusMethodDrop(n){var r=$(n.currentTarget).scope(),f=r.obj,i,u,t;f&&(t=dragDropData,t&&t.trim().length>0&&(t.indexOf(".")>0&&(t=dragDropData.substring(dragDropData.indexOf(".")+1)),i=null,t.indexOf(".")==-1&&r.ObjTree.Rules&&(u=r.ObjTree.Rules.filter(function(n){return n.ID==t}),u&&u.length>0&&(i=u[0])),i==null&&(i=getBusObjectByPath(t,r.ObjTree)),t=t.substring(t.lastIndexOf(".")+1),i==null&&(i=getBusObjectByPath(t,r.ObjTree))))}function onBusMethodDragOver(n){n.preventDefault&&n.preventDefault();n.dataTransfer.dropEffect="move"}function onQueryIDActionKeyDown(n){var e=getScopeByFileName("MainPage"),r=n.target,i=getSplitArray($(r).val(),r.selectionStart),f=e.getFirstLevelEntityIntellisense(),o="EntityName",t,u;if(i.length>0)for(t=0;t<i.length;t++)u=f.filter(function(n){return n.ID==i[t].substring(3)}),u.length>0&&(o="",u[0].DisplayName!=undefined&&u[0].Queries!=undefined&&(n.char=="."||i[t].charAt(i[t].length-1||i[t].contains(".")))&&t<i.length?f=getQueryIntellisense(u[0]):u[0].QueryType!=undefined&&t<i.length&&(f=[]));setRuleIntellisense($(r),f,e,o);n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(r).data("ui-autocomplete")&&($(r).autocomplete("search",$(r).val()),n.preventDefault())}function getQueryIntellisense(n){return n.Queries}function getBusObjectByPath(n,t){var r,u,i;if(n.replace(/^[.\s]+|[.\s]+$/g,""),r=n.split("."),r)for(u=0;u<r.length;u++)if(t!=null)if(i=t.ChildProperties.filter(function(n){return n.ShortName==r[u]}),i!=null&&i.length>0)t=i[0],t.HasChildItems&&t.ChildProperties.length==0;else if(i=t.lstMethods.filter(function(n){return n.ShortName==r[u]}),i!=null&&i.length>0)t=i[0];else{t=null;break}return t}function GetFullItemPathFromBusObjectTree(n){for(var i=n.ShortName,t=n.objParent;t&&!t.IsMainBusObject&&t.ShortName;)i=t.ShortName+"."+i,t=t.objParent;return i}function addEditAttributeConstraint(n,t,i,r,u){var f=n.$new();f.entityModel=i;f.attributeName=t;f.entityId=r;f.autoSave=u;f.dialog=n.$root.showDialog(f,"Add Constraint","<add-edit-attribute-constraint auto-save='autoSave' entity-id='entityId' entity-model='entityModel' attribute-name='attributeName'><\/add-edit-attribute-constraint>",{showclose:!0,isInlineHtml:!0,height:500,width:1e3})}var openedDialogId="",openedQueryDialogId="",openedExecuteQueryDialogId="",openNewExpressionDialog="",openNewRuleDialog="",openNewGroupDialog="",mappedDialog="",lst=["Select","From","Where","Equal","Coma","And","On","InnerJoin","LeftOuterJoin","RightOuterJoin","FullOuterJoin","CrossJoin","Join","OrderBy","GroupBy","As","OpeningBracket","ClosingBracket"],dragDropData=null,dragDropDataObject=null;app.controller("EntityController",["$scope","$http","$rootScope","hubcontext","$FormatQueryFactory","$resourceFactory","$EntityIntellisenseFactory","$NavigateToFileService","$filter","CONSTANTS","$ValidationService","$Errors","$timeout","$interval","ConfigurationFactory","$GetEntityFieldObjectService","$compile","$searchFindReferences","$Entityintellisenseservice",function(n,t,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){function bt(t){$("#"+n.currentfile.FileName+' .nav-tabs a[data-target="#entity-attributes-'+t+"-tab-content-"+n.currentfile.FileName+'"]').tab("show")}function nt(){var t={Elements:[]},i;return t.Elements=n.objAttributes.Elements&&n.objAttributes.Elements.slice(),n.objEntity.dictAttributes.sfwParentEntity&&(i=d.GetIntellisenseData(n.objEntity.dictAttributes.sfwParentEntity,"","",!0,!0,!1,!1,!1,!1),i&&i.length>0&&(t.Elements=t.Elements.concat(ni(i)))),t}var ot,tt,st,ht,kt,ct,at,vt,rt,yt,wt;n.initialize=function(){var i,t,e;r.IsLoading=!0;n.currentfile=r.currentopenfile.file;n.objAttributes;n.objQueries;n.objConstraints;n.objMethods;n.objLifecycle;n.objEntity;n.lstlifecycle=[];n.lstCutandPaste=[];n.lstCopiedRule=[];n.lstRules=[];n.lstCopiedExpression=[];n.lstCodeValue=[];n.lstMessages=[];n.lstCodeGroups=[];n.IsExpressions=!1;n.IsRule=!1;n.lstEntityRules=[];n.lstEntityRulesDetails=[];n.lstLoadTypes=[];n.lstItemsRulesList=[];n.lstItemsCorrList=[];n.lstItemsFormsList=[];n.lstItemsHtxList=[];n.showSource=!1;n.lstBusinessObject=undefined;n.lstBusinessObjectForProperty=undefined;n.selectedDesignSource=!1;n.selectedRow=null;n.IsExecuteQueryShow=!1;n.objRuleSearch={strSearchRulesID:undefined,SelectedRuleStatus:undefined,SelectedReturnType:undefined,IsLogicalRuleChecked:undefined,IsDecisionTableChecked:undefined,IsExcelMatrixChecked:undefined,IsRuleStaticSelected:undefined,IsRulePrivateSelected:undefined};n.activeGridRow=undefined;n.SearchFieldconstraint=!1;n.SearchBusinessObject=!1;n.SearchAttributes=!1;n.SearchRelationship=!1;n.SearchExpressions=!1;n.SearchColumns=!1;n.SearchValidationRules=!1;n.SearchRules=!1;n.SearchQueries=!1;n.SearchInitialLoad=!1;n.SearchHardErrors=!1;n.SearchSoftErrors=!1;n.SearchValidateDelete=!1;n.SearchGroups=!1;n.SearchCheckList=!1;n.selectedIneritedTab="Rule";n.datatypes=["string","bool","decimal","datetime","double","float","int","long","short"];n.dataformats=["","{0:(###) ###-####}","{0:d}","{0:###-##-####}","{0:$#,###,##0.00;($#,###,##0.00)}"];n.objRuleID={};n.objRuleID.lstTypeIds=[{ID:"ID",value:"ID"},{ID:"Message ID",value:"sfwMessageId"},{ID:"Business Rule Id",value:"sfwBRID"},{ID:"Use Case Id",value:"sfwUseCaseID"}];n.objRuleID.selectedTypeID={};n.objRuleID.searchRuleByID="";n.index=0;n.IsInitialLoadLoaded=!1;n.IsHardErrorLoaded=!1;n.IsSoftErrorLoaded=!1;n.IsValidateDeleteLoaded=!1;n.IsGroupsLoaded=!1;n.IsCheckListLoaded=!1;n.InheritedRulesMenuOptions=[];n.lstobjecttree=[];n.objBusinessObject={};n.objBusinessObject.ObjTree=undefined;n.ItemExpanded="Forms";n.lstBusBaseMethods=[];n.blnShowCreateWithClass=!0;n.blnShowBusinessObjectSection=!0;i=p.getLastProjectDetails();t=i.QueryTypes;t||(t="SQL:sfwSql");n.lstDBQueryTypes=getlstQueryTypes(t);n.objBusinessObjectTree={};n.objBusinessObjectTree.lstmultipleselectedfields=[];n.objBusinessObjectTree.lstCurrentBusinessObjectProperties=[];n.objBusinessObjectTree.lstdisplaybusinessobject=[];n.customTypes=[];n.QueryEditor;n.validateEmptyMessageID=function(t){if(t){var i=l.getListByPropertyName(n.lstMessages,"MessageID");i.unshift("0");l.checkValidListValue(i,t,t.dictAttributes.sfwMessageId,"sfwMessageId","sfwMessageId",c.VALIDATION.MESSAGE_ID_EMPTY,n.validationErrorList,!0);t.dictAttributes.sfwMessage&&(delete t.errors.sfwMessageId,t&&t.errors&&!l.isEmptyObj(t.errors)&&l.removeObjInToArray(n.validationErrorList,t))}};hubMain.server.getModel(n.currentfile.FilePath,n.currentfile.FileType).done(function(t){t?(n.receiveentitymodel(t),hubMain.server.populateMessageList().done(function(t){n.lstMessages=t;gt();at()}),hubMain.server.getEntityItemsList(n.currentfile.FileName),$.connection.hubEntityModel.server.loadBusBaseMethods().done(function(t){n.$evalAsync(function(){t&&(n.lstBusBaseMethods=t,rt())})})):r.closeFile(n.currentfile.FileName)});$("#tblAttribute").on("mouseenter",function(){$("#tblAttribute > tr > th").resizable({handles:"e",minWidth:10})});e=f.getSqlReserveWords();e||u.hubMain.server.getSqlServerReservedWords();n.objnewonetooneAttribute=getNewBaseModel("attribute",{ID:"obj",sfwType:"Object",sfwEntity:"",sfwPrivate:"False"});n.objnewonetomanyAttribute=getNewBaseModel("attribute",{ID:"lst",sfwType:"Collection",sfwValue:"",sfwEntity:"",sfwPrivate:"False",Text:""});n.objnewpropertyAttribute=getNewBaseModel("attribute",{ID:"",sfwDataType:"",sfwDataFormat:"",sfwPrivate:!1,sfwValue:"",sfwEnumerator:"",Text:"",sfwType:"Property"});n.objnewexpressionAttribute=getNewBaseModel("attribute",{ID:"",sfwDataType:"",sfwDataFormat:"",sfwPrivate:!1,sfwValue:"",sfwEnumerator:"",Text:"",sfwType:"Expression"});n.objnewConstraint=getNewBaseModel("item",{sfwFieldName:"",sfwRequired:!1})};n.initialize();n.recieveItemListMappedWithEntity=function(t,i){if(t){var r=JSON.parse(t);i=="Form"?n.lstItemsFormsList=n.lstItemsFormsList.concat(r):i=="Correspondence"?n.lstItemsCorrList=n.lstItemsCorrList.concat(r):i=="Rule"?n.lstItemsRulesList=n.lstItemsRulesList.concat(r):i=="Htx"&&(n.lstItemsHtxList=n.lstItemsHtxList.concat(r))}};n.ToggleUIDesginAttribute=function(t,i){if(t[0]&&t[0].Name)switch(t[0].Name){case"attributes":t[1]&&(t[t.length-1].isAdvanceSearched=i);break;case"rules":t[1]&&(t[t.length-1].isAdvanceSearched=i);break;case"initialload":t[t.length-1].Name!="initialload"&&(t[t.length-1].isAdvanceSearched=i);break;case"validatedelete":t[t.length-1].Name!="validatedelete"&&(t[t.length-1].isAdvanceSearched=i);break;case"harderror":t[t.length-1].Name!="harderror"&&(t[t.length-1].isAdvanceSearched=i);break;case"softerror":t[t.length-1].Name!="softerror"&&(t[t.length-1].isAdvanceSearched=i);break;case"groupslist":t[t.length-1].Name!="groupslist"&&(t[t.length-1].isAdvanceSearched=i);break;case"checklist":t[t.length-1].Name!="checklist"&&(t[t.length-1].isAdvanceSearched=i);break;case"constraint":t[1]&&(t[1].isAdvanceSearched=i);break;case"queries":t[1]&&(t[2]?t[3]&&(t[3].isAdvanceSearched=i):t[1].isAdvanceSearched=i);break;case"methods":t[1]&&(t[1].isAdvanceSearched=i);break;case"lifecycle":var r=n.lstlifecycle.filter(function(n){return n.ID==t[t.length-1].dictAttributes.ID});r&&r.length>0&&(r[0].isAdvanceSearched=i);break;case"delete":t[1]&&(t[1].isAdvanceSearched=i);break;case"objectmethods":t[1]&&(t[1].isAdvanceSearched=i);break;default:n.selectDashboard()}};n.receiveUpdatedEntityModelandIntelleenselist=function(t,i){var h,u,e;n.receiveentitymodel(i);var l=n.objEntity.dictAttributes.ID,f=o.getEntityIntellisense(),s=t[2],c=t[1];if(EnitiyIntellisese=undefined,s&&s.length)for(h=0;h<s.length;h++)s[h].ID==l?EnitiyIntellisese=s[h]:f.push(s[h]);for(u=0;u<f.length;u++)f[u].ID==l&&(EnitiyIntellisese&&(f[u].Queries=EnitiyIntellisese.Queries,f[u].Attributes=EnitiyIntellisese.Attributes,f[u].XmlMethods=EnitiyIntellisese.XmlMethods,f[u].ObjectMethods=EnitiyIntellisese.ObjectMethods),f[u].ParentId=n.objEntity.dictAttributes.sfwParentEntity?n.objEntity.dictAttributes.sfwParentEntity:"",f[u].TableName=n.objEntity.dictAttributes.sfwTableName?n.objEntity.dictAttributes.sfwTableName:"",f[u].BusinessObjectName=n.objEntity.dictAttributes.sfwObjectID?n.objEntity.dictAttributes.sfwObjectID:"");e=n.$new();e.lstSummaryReport=c;e.openCSFileClick=function(t){if(t&&t.FileContent&&t.FileContent!=""){n.strCSFileContent=t.FileContent;var i=e.$new();i.closeCsDialog=function(){i.csDialog.close()};i.csDialog=r.showDialog(i,"CS File Content","CreateNewObject/views/Entity/OpenCSFile.html")}};e.closeDialog=function(){e.summaryDialog.close()};c&&c.length>0&&(e.summaryDialog=r.showDialog(e,"Summary Report","CreateNewObject/views/Entity/FileSummaryReport.html"))};n.receiveentitymodel=function(t){r.IsLoading=!1;n.$evalAsync(function(){var f,e,o,s,c,i,u,l;for(n.objEntityExtraFields=[],n.objEntity=t,n.objEntity.dictAttributes.CreateWithClass&&n.objEntity.dictAttributes.CreateWithClass.toLowerCase()=="false"&&(n.blnShowCreateWithClass=!1),n.lstRules=[],n.lstlifecycle=[],n.lstQueryGroups=[],n.lstQueryGroups.push(""),n.objEntity.objExtraData!=null&&n.objEntity.objExtraData.objInheritedRules&&n.objEntity.objExtraData.objInheritedRules!=null&&(n.objInheritedRules=n.objEntity.objExtraData.objInheritedRules,n.objInheritedRules.Text="Rules",n.objInheritedRules.IsExpanded=!0),i=0;i<n.objEntity.Elements.length;i++)if(n.objEntity.Elements[i].Name=="queries")for(n.objQueries=n.objEntity.Elements[i],u=0;u<n.objQueries.Elements.length;u++)n.objQueries.Elements[u].dictAttributes.sfwGroupName&&n.UpdateGroupName(n.objQueries.Elements[u].dictAttributes.sfwGroupName);else n.objEntity.Elements[i].Name=="constraint"?n.objConstraints=n.objEntity.Elements[i]:n.objEntity.Elements[i].Name=="rules"?(n.objRules=n.objEntity.Elements[i],n.objRules.Text="Rules",n.objRules.IsExpanded=!0,n.lstRules.push(n.objRules)):n.objEntity.Elements[i].Name=="attributes"?n.objAttributes=n.objEntity.Elements[i]:n.objEntity.Elements[i].Name=="initialload"?n.objInitialLoad=n.objEntity.Elements[i]:n.objEntity.Elements[i].Name=="softerror"?(n.objSoftError=n.objEntity.Elements[i],n.LoadParentForObject(n.objSoftError)):n.objEntity.Elements[i].Name=="harderror"?(n.objHardError=n.objEntity.Elements[i],n.LoadParentForObject(n.objHardError)):n.objEntity.Elements[i].Name=="validatedelete"?n.objValidateDelete=n.objEntity.Elements[i]:n.objEntity.Elements[i].Name=="groupslist"?(n.objGroupList=n.objEntity.Elements[i],n.LoadParentForObject(n.objGroupList)):n.objEntity.Elements[i].Name=="checklist"?n.objCheckList=n.objEntity.Elements[i]:n.objEntity.Elements[i].Name=="methods"?n.objMethods=n.objEntity.Elements[i]:n.objEntity.Elements[i].Name=="lifecycle"?n.objLifecycle=n.objEntity.Elements[i]:n.objEntity.Elements[i].Name=="delete"?n.objDelete=n.objEntity.Elements[i]:n.objEntity.Elements[i].Name=="ExtraFields"?n.objEntityExtraFields=n.objEntity.Elements[i]:n.objEntity.Elements[i].Name=="objectmethods"&&(n.objObjectMethods=n.objEntity.Elements[i]);if(n.objQueries==undefined&&(n.objQueries=n.CreateNewObject("queries",n.objEntity)),n.objConstraints==undefined&&(n.objConstraints=n.CreateNewObject("constraint",n.objEntity)),n.objRules==undefined&&(n.objRules=n.CreateNewObject("rules",n.objEntity),n.objRules.Text="Rules",n.objRules.IsExpanded=!0,n.lstRules.push(n.objRules)),n.objAttributes==undefined&&(n.objAttributes=n.CreateNewObject("attributes",n.objEntity)),n.objInitialLoad==undefined&&(n.objInitialLoad=n.CreateNewObject("initialload",n.objEntity)),n.objSoftError==undefined&&(n.objSoftError=n.CreateNewObject("softerror",n.objEntity)),n.objHardError==undefined&&(n.objHardError=n.CreateNewObject("harderror",n.objEntity)),n.objValidateDelete==undefined&&(n.objValidateDelete=n.CreateNewObject("validatedelete",n.objEntity)),n.objDelete==undefined&&(n.objDelete=n.CreateNewObject("delete",n.objEntity)),n.objGroupList==undefined&&(n.objGroupList=n.CreateNewObject("groupslist",n.objEntity)),n.objCheckList==undefined&&(n.objCheckList=n.CreateNewObject("checklist",n.objEntity)),n.objMethods==undefined&&(n.objMethods=n.CreateNewObject("methods",n.objEntity)),n.objLifecycle==undefined&&(n.objLifecycle=n.CreateNewObject("lifecycle",n.objEntity)),n.objEntityExtraFields.length==0&&(n.objEntityExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]}),n.objObjectMethods==undefined&&n.blnShowCreateWithClass&&(n.objObjectMethods=n.CreateNewObject("objectmethods",n.objEntity)),f={DispalyName:"Before Validate",ID:"BeforeValidate",XmlMethod:""},n.lstlifecycle.push(f),e={DispalyName:"After Validate",ID:"AfterValidate",XmlMethod:"",Parameters:""},n.lstlifecycle.push(e),o={DispalyName:"Before Persist",ID:"BeforePersistChanges",XmlMethod:"",Parameters:""},n.lstlifecycle.push(o),s={DispalyName:"After Persist",ID:"AfterPersistChanges",XmlMethod:"",Parameters:""},n.lstlifecycle.push(s),c={DispalyName:"Correspondence",ID:"Correspondence",XmlMethod:"",Parameters:""},n.lstlifecycle.push(c),n.objLifecycle!=undefined&&n.objLifecycle.Elements.length>0)for(i=0;i<n.objLifecycle.Elements.length;i++)for(u=0;u<n.lstlifecycle.length;u++)n.lstlifecycle[u].ID==n.objLifecycle.Elements[i].dictAttributes.ID&&(n.lstlifecycle[u].XmlMethod=n.objLifecycle.Elements[i].dictAttributes.sfwXmlMethod,n.lstlifecycle[u].Parameters=n.objLifecycle.Elements[i].dictAttributes.sfwNavigationParameter);$.connection.hubEntityModel.server.loadEntityRules(n.objEntity.dictAttributes.ID).done(function(t){n.$evalAsync(function(){n.lstScenarioDetails=[];n.lstEntityRules=t;n.selectEntityRules(0);n.lstEntityRulesDetails=t})});n.objEntity.dictAttributes.sfwChecklistId!=undefined&&n.objEntity.dictAttributes.sfwChecklistId!=null&&$.connection.hubEntityModel.server.populateCodeValues(n.objEntity.dictAttributes.sfwChecklistId);$.connection.hubEntityModel.server.populateTables().done(function(t){t&&t.length==3&&(n.recieveGetPopulateErrorTables(t[0]),n.recieveGetPopulateChecklistTables(t[1]),n.recieveGetPopulateExpressionTables(t[2]))});n.objEntity.dictAttributes.sfwObjectID!=undefined&&n.objEntity.dictAttributes.sfwObjectID!=""&&($.connection.hubEntityModel.server.getDeleteProperties(n.objEntity.dictAttributes.sfwObjectID).done(function(t){n.$evalAsync(function(){n.DeleteProperties=t})}),$.connection.hubEntityModel.server.getPartialFileData(n.objEntity.dictAttributes.sfwObjectID).done(function(t){n.$evalAsync(function(){if(t&&t.length>0){n.PartialFileData=t[0];n.PartialFileDataTypes=t[1];n.PartialFileDataTypes&&n.PartialFileDataTypes.splice(0,0,"");n.BusObjPartialFileName=t[2];for(var i=0;i<n.PartialFileData.length;i++)n.setPropertyPrefix(n.PartialFileData[i]);n.validateCSProperties()}})}));n.lstBusinessObject||hubMain.server.getLstBusinessObject().done(function(t){n.$evalAsync(function(){t&&t.length>0?(n.lstBusinessObject=t,n.lstBusinessObject&&!n.lstBusinessObject.some(function(t){return t.ID==n.objEntity.dictAttributes.sfwObjectID})&&(n.blnShowBusinessObjectSection=!1)):n.lstBusinessObject=[]})});n.lstBusinessObjectForProperty||hubMain.server.getLstBusinessObjectForProperty().done(function(t){n.$evalAsync(function(){n.lstBusinessObjectForProperty=t&&t.length>0?t:[]})});n.PopulateLoadTypes();r.queryID!=undefined&&r.queryID!=""&&n.openQueryFromLogicalRule();n.currentfile.SelectNodePath&&n.currentfile.SelectNodePath!=""&&n.selectElement(n.currentfile.SelectNodePath);n.objInheritedRules&&n.objInheritedRules.Elements.length>0&&angular.forEach(n.objInheritedRules.Elements,function(t){n.LoadRulesDetails(t)});n.validationErrorList=[];n.warningList=[];a.validationListObj&&angular.isArray(a.validationListObj)&&(l=h("filter")(a.validationListObj,{FileName:n.currentfile.FileName}),l.length==0&&a.validationListObj.push({FileName:n.currentfile.FileName,errorList:[],warningList:[]}),n.validateFileData());$.connection.hubEntityModel.server.getMainCDOList(n.objEntity.dictAttributes.sfwObjectID).done(function(t){t&&n.$evalAsync(function(){n.tableObjects=t;n.tableObjects.length>0&&n.tableObjects.splice(0,0,"")})});n.LoadRulesForChild(n.lstRules);$.connection.hubMain.server.getCustomTypes().done(function(t){n.customTypes=t})})};n.isSet=function(t){return n.tab==t};n.sort={active:"",descending:undefined};n.clearValidationRuleSelection=function(){n.SelectedRule=undefined;n.SelectedInitialLoad=undefined;n.SelectedHardError=undefined;n.SelectedSoftError=undefined;n.SelectedValidateDelete=undefined;n.SelectedGroup=undefined};n.clearBusinessObjectTabSelection=function(){n.objMethods.Elements.forEach(function(n){n.selected=!1});n.SelectedXMLMethod=undefined;n.objDelete.Elements.forEach(function(n){n.isSelected=!1});n.PartialFileData&&Object.prototype.toString.call(n.PartialFileData)==="[object Array]"&&n.PartialFileData.forEach(function(n){n.isSelected=!1});n.selectedLifeCycle=undefined;n.SelectedObjectMethod=undefined};n.ShowDesign=function(){var t,i,o,e;if(n.selectedDesignSource==!0&&(t=n.editor.getValue(),t!=null&&t!="")){if(r.IsLoading=!0,i=n.editor.selection.getCursor().row,i=i+1,t.length<32e3)hubMain.server.getDesignXmlString(t,n.currentfile,i);else{o=[];o[0]=i>0?i:1;var u="",s=[],f=0;for(e=0;e<t.length;e++)f++,u=u+t[e],f==32e3&&(f=0,s.push(u),u="");f!=0&&s.push(u);ot(s,n.currentfile,"Source-Design",o)}n.receivedesignxmlobject=function(t,i){n.selectedDesignSource=!1;n.isSourceDirty&&(n.selectedMethodProperty=undefined,n.SelectedGroup=undefined,n.SelectedCheckList=undefined,n.SelectedValidateDelete=undefined,n.SelectedSoftError=undefined,n.SelectedHardError=undefined,n.SelectedInitialLoad=undefined,n.SelectedRule=undefined,n.selectedCollectionItem=undefined,n.selectedOneToOne=undefined,n.selectedOneToMany=undefined,n.selectedExpression=undefined,n.selectedColumn=undefined,n.selectedProperty=undefined,n.selectedQuery=undefined,n.SelectedObjectMethod=undefined,n.selectedLifeCycle=undefined,n.receiveentitymodel(t),n.isSourceDirty=!1);n.selectElement(i)}}};n.isSourceDirty;n.sourceChanged=function(){n.isSourceDirty=!0;n.isDirty=!0;n.SearchSource.IsSearchCriteriaChange=!0};n.traverseMainModel=function(t){var f=[],i,r,u,e;if(t.contains("-")||t.contains(","))for(i=n.objEntity,r=0;r<t.split(",").length;r++)if(i=n.FindNodeHierarchy(i,t.split(",")[r].substring(t.split(",")[r].lastIndexOf("-")+1)),i&&(f.push(i),i.ParentID&&(i.ParentID=="softerror"||i.ParentID=="harderror")))if(u=t.split(","),e=u[u.length-1].substring(0,u[u.length-1].indexOf("-")),i.Children.length>0&&e=="rule"){i=FindChidrenHierarchy(i,t.split(",")[r+2].substring(t.split(",")[r+2].lastIndexOf("-")+1));f.push(i);break}else break;return f};n.selectElement=function(t){n.$evalAsync(function(){var f,i,e,u;if(t!=null&&t.length>1&&(f="",i=n.traverseMainModel(t),i!=null&&i!=""))if(i[0]){if(n.activeGridRow=undefined,i[0].Name=="attributes")n.selectAttributeTab(),e="",i[1]&&i[1].dictAttributes.sfwType.toLowerCase()=="expression"?e="EXPRESSION":i[1]&&(i[1].dictAttributes.sfwType.toLowerCase()=="column"||i[1].dictAttributes.sfwType.toLowerCase()=="description")?e="COLUMNS":i[1]&&i[1].dictAttributes.sfwType.toLowerCase()=="object"?e="ONETOONE":i[1]&&(i[1].dictAttributes.sfwType.toLowerCase()=="collection"||i[1].dictAttributes.sfwType.toLowerCase()=="cdocollection"||i[1].dictAttributes.sfwType.toLowerCase()=="list")?e="ONETOMANY":i[1]&&i[1].dictAttributes.sfwType.toLowerCase()=="property"&&(e="PROPERTIES"),v(function(){bt(e);n.activeGridRow=i[i.length-1]});else if(i[0].Name=="groupslist"){if(n.clearValidationRuleSelection(),n.selectValidationRulesTab(),n.SelectChildRuleView("Group"),i.length>2)for(u=1;u<i.length-1;u++)i[u].IsExpanded=!0;i[i.length-1].Name!="groupslist"&&n.SelectGroupClick(i[i.length-1]);f="validation-rules-grouplist-section"}else if(i[0].Name=="queries")n.selectQueriesTab(),i[1]&&(n.selectQuery(i[1],i[0].Elements.indexOf(i[1])),i[2]&&i[2].Name=="parameters"?i[3]&&(n.selectedParam=i[3]):i[2]&&i[2].Name=="mappedcolumns"&&i[3]&&(n.selectedUnmappedColumn=i[3])),f="entity-queries-section";else if(i[0].Name=="constraint")n.selectFieldConstraintsTab(),v(function(){n.activeGridRow=i[i.length-1]});else if(i[0].Name=="methods")n.clearBusinessObjectTabSelection(),n.selectBusinessObjectTab(),i[1]&&n.SelectXmlMethod(i[1]),f="entity-xml-method-section";else if(i[0].Name=="rules"){if(n.clearValidationRuleSelection(),n.SelectedRuleView=undefined,n.selectValidationRulesTab(),i.length>2)for(u=1;u<i.length-1;u++)i[u].IsExpanded=!0;i.length>1&&n.selectedRules(i[i.length-1]);f="entity-validation-main-rules-section"}else if(i[0].Name=="initialload")n.selectValidationRulesTab(),i[i.length-1].Name!="initialload"&&(n.SelectedInitialLoadClick(i[i.length-1],window.event),n.scrollToPosition("#entity-validation-initialload-section",".page-sidebar-content",n.SelectedInitialLoad.dictAttributes.ID,{offsetTop:400,offsetLeft:0}));else if(i[0].Name=="validatedelete")n.clearValidationRuleSelection(),n.selectValidationRulesTab(),n.selectValidateDeleteTab(),i[i.length-1].Name!="validatedelete"&&n.SelectedValidateDeleteClick(i[i.length-1]),f="entity-validation-delete-section";else if(i[0].Name=="checklist")n.clearValidationRuleSelection(),n.selectValidationRulesTab(),n.selectCheckListTab(),i[i.length-1].Name!="checklist"&&n.SelectCheckListClick(i[i.length-1]),f="entity-validation-checklist-section";else if(i[0].Name=="harderror"){if(n.clearValidationRuleSelection(),n.selectValidationRulesTab(),n.selectHardErrorTab(),n.SelectChildRuleView("HardError"),i.length>2)for(u=1;u<i.length-1;u++)i[u].IsExpanded=!0;i[i.length-1].Name!="harderror"&&n.SelectedErrorClick(i[i.length-1],null,"HardError");f="entity-validation-harderror-section"}else if(i[0].Name=="softerror"){if(n.clearValidationRuleSelection(),n.selectValidationRulesTab(),n.selectSoftErrorTab(),n.SelectChildRuleView("SoftError"),i.length>2)for(u=1;u<i.length-1;u++)i[u].IsExpanded=!0;i[i.length-1].Name!="softerror"&&n.SelectedErrorClick(i[i.length-1],null,"SoftError");f="entity-validation-softerror-section"}else if(i[0].Name=="lifecycle")n.clearBusinessObjectTabSelection(),n.selectBusinessObjectTab(),n.selectLifeCycleMethod(i[i.length-1]),f="entity-businessobject-LifeCycle-section";else if(i[0].Name=="delete")n.clearBusinessObjectTabSelection(),n.selectBusinessObjectTab(),n.setSelectedDeleteProperty(i[i.length-1]),f="entity-businessobject-delete-section";else if(i[0].Name=="objectmethods"){if(n.clearBusinessObjectTabSelection(),n.selectBusinessObjectTab(),i[i.length-1].Name!="objectmethods")if(i[i.length-1].Name!="method"){for(u=0;u<i.length;u++)if(i[u].Name=="method"){n.SelectObjectMethod(i[u]);break}}else n.SelectObjectMethod(i[i.length-1]);f="entity-businessobject-objectmethod-section"}else n.selectDashboard();i.length>1&&setTimeout(function(){if(f){var i=$("#"+n.currentfile.FileName+" #"+f).find(".selected");i&&t!=null&&t!="file"&&t!=""&&i.length>0&&i[0].scrollIntoView()}},500)}else n.selectDashboard();r.IsLoading=!1})};n.FindNode=function(t,i,r,u){return t&&angular.forEach(t.Elements,function(t){for(var f=i.length-2;f>=0;f--)t.dictAttributes.ID!=undefined?t.Name+'="'+t.dictAttributes.ID+'"'==i[f]&&(r[u]=t,u++,n.FindNode(t,i,r,u)):t.Name==i[f]&&(r[u]=t,u++,n.FindNode(t,i,r,u))}),r};ot=function(n,t,i,r){for(var u=0;u<n.length;u++)hubMain.server.receiveDataPackets(n[u],n.length,t,u,i,r)};n.ShowSource=function(){var c,s,k,p,w,u,t,l,a,f,b,v,e,i;if(n.selectedDesignSource==!1){if(n.selectedDesignSource=!0,n.objEntity!=null&&n.objEntity!=undefined){if(n.CheckAndRemoveUnmappedColumnNode(),c=GetBaseModel(n.objEntity),s=[],r.IsLoading=!0,p=[],c!=""){if(u=n.SelectedView,u=="Attributes"){if(l=document.querySelector("#"+n.currentfile.FileName+" ul[attribute-tab-wrapper] li.active a"),l&&(a=l.getAttribute("data-attribute-type"),a)){f=[];switch(a){case"COLUMNS":f=["Column"];break;case"ONETOONE":f=["Object"];break;case"ONETOMANY":f=["Collection","List","CDOCollection"];break;case"PROPERTIES":f=["Property"];break;case"EXPRESSION":f=["Expression"]}for(i=0;i<n.objAttributes.Elements.length;i++)if(n.objAttributes.Elements[i].isSelected&&f.indexOf(n.objAttributes.Elements[i].dictAttributes.sfwType)>-1){t=n.objAttributes.Elements[i];break}}t=t?t:n.objAttributes}else if(u=="Queries")t=n.selectedQuery?n.selectedQuery:n.objQueries;else if(u=="ValidationRules")n.SelectedRuleView=="ValidationRules"?t=n.SelectedInitialLoad?n.SelectedInitialLoad:n.SelectedHardError?n.SelectedHardError:n.SelectedSoftError?n.SelectedSoftError:n.SelectedValidateDelete?n.SelectedValidateDelete:n.SelectedGroup?n.SelectedGroup:n.SelectedRule?n.SelectedRule:n.objRules:n.SelectedRuleView=="Checklist"&&(t=n.SelectedCheckList?n.SelectedCheckList:n.objCheckList);else if(u=="FieldConstraints"){for(i=0;i<n.objConstraints.Elements.length;i++)if(n.objConstraints.Elements[i].isSelected){t=n.objConstraints.Elements[i];break}t=t?t:n.objConstraints}else u=="BusinessObject"?n.objMethods&&n.SelectedXMLMethod?t=n.SelectedXMLMethod:n.selectedLifeCycle?(b=n.objLifecycle.Elements.filter(function(t){return t.dictAttributes.ID==n.selectedLifeCycle.ID}),t=b[0]):n.SelectedObjectMethod?t=n.SelectedObjectMethod:n.objDelete.Elements.some(function(n){if(n.isSelected==!0)return t=n,!0})||(t=n.objMethods):u=="Expressions"&&n.SelectedExp!=undefined&&(t=n.SelectedExp);t&&(v=[],k=n.FindDeepNode(n.objEntity,t,v),w=n.getPathSource(n.objEntity,v,p),angular.copy(w,s))}if(e=JSON.stringify(c),e.length<32e3)hubMain.server.getEntityXmlObject(e,s,n.currentfile);else{var o="",y=[],h=0;for(i=0;i<e.length;i++)h++,o=o+e[i],h==32e3&&(h=0,y.push(o),o="");h!=0&&y.push(o);ot(y,n.currentfile,"DesignToSourceEntity",s)}}n.receivesourcexml=function(t,i){n.$apply(function(){n.xmlSource=t;var u=n.currentfile.FileName;setDataToEditor(n,t,i,u);n.$evalAsync(function(){r.IsLoading=!1});window.navigator.userAgent.toLowerCase().contains("chrome")&&n.$evalAsync(function(){r.IsLoading=!1});r.IsLoading=!1})}}};n.selectTextareaLine=function(n,t){var i,f;t--;var r=n[0].value.split("\n"),u=0,f=n[0].value.length;for(i=0;i<r.length;i++){if(i==t)break;u+=r[i].length+1}f=r[t].length+u;typeof n[0].selectionStart!=undefined&&(n[0].selectionStart=u,n.focus(),n[0].selectionEnd=f)};n.FindDeepNode=function(t,i,r){return t&&angular.forEach(t.Elements,function(t){var u=n.isValidObject(t,i);return(u&&r.push(t),t==i)?i:t.Elements&&t.Elements.length>0?i=n.FindDeepNode(t,i,r):t.Children&&t.Children.length>0&&(selectedChildItem=n.FindDeepNodeChildren(t,i),selectedChildItem[0]==i)?(r.push(selectedChildItem[0]),i):void 0}),i};n.FindDeepNodeChildren=function(n,t){return n.Children.filter(function(n){return n==t})};n.getPathSource=function(n,t,i){for(var u,r=0;r<t.length;r++)r==0?(u=n.Elements.indexOf(t[r]),i.push(u)):(u=t[r-1].Elements.indexOf(t[r]),u==-1&&(u=t[r-1].Children.indexOf(t[r])),i.push(u));return i};n.isValidObject=function(t,i){var u,r,f;if(t==i)return!0;for(r in t.Elements){if(t.Elements[r]==i)return!0;if(t.Elements[r].Elements&&t.Elements[r].Elements.length>0){for(iele in t.Elements[r].Elements)if(u=n.isValidObject(t.Elements[r].Elements[iele],i),u==!0)return u}else if(t.Elements[r].Children&&t.Elements[r].Children.length>0)for(iele in t.Elements[r].Children)if(u=n.isValidObject(t.Elements[r].Children[iele],i),u==!0)return u}for(f in t.Children)if(t.Children[f]==i)return!0;return u};n.FindNodeHierarchy=function(n,t){if(n&&n.Elements){var i=n.Elements[t];return i==undefined&&(i=n.Elements[t-1]),i}};n.openQueryFromLogicalRule=function(){n.selectQueriesTab();for(var t=0;t<n.objQueries.Elements.length;t++)if(n.objQueries.Elements[t].dictAttributes.ID==r.queryID){n.selectQuery(n.objQueries.Elements[t],t);break}r.queryID=undefined};n.addToDeleteProperties=function(){var t={Name:"property",Value:"",Children:[],Elements:[],dictAttributes:{}};r.PushItem(t,n.objDelete.Elements,"setSelectedDeleteProperty");n.setSelectedDeleteProperty(t);v(function(){var t=$("#"+n.currentfile.FileName).find("#entity-businessobject-delete-section").find(".selected");t&&t.length>0&&t[0].scrollIntoView()})};n.onChangeDeletePropertyId=function(t){var u;if(t&&n.DeleteProperties&&t.dictAttributes&&t.dictAttributes.ID){var i=w.GetEntityFieldObjectFromEntityField(n.objEntity.dictAttributes.ID,t.dictAttributes.ID.trim()),f=null,r=null;i&&(f=n.GetBusinessObject(i.DeclaringEntity),r=i.DeclaringEntity);i&&i.Value&&i.DeclaringEntity&&n.blnShowCreateWithClass&&n.DeleteProperties?$.connection.hubEntityModel.server.getXmlMethodForeignKeyValues(n.objEntity.dictAttributes.ID,f,i.DataType).done(function(n){n&&(t.foreignKeys=n.Foreignkeys,t.foreignKeys&&t.foreignKeys.length>0&&t.foreignKeys.indexOf(t.dictAttributes.sfwForeignKey)==-1&&(t.dictAttributes.sfwForeignKey=""))}):n.blnShowCreateWithClass?(t.foreignKeys=[],t.dictAttributes.sfwForeignKey=""):(u=[],r&&(u=d.GetIntellisenseData(r,"Column","Int",!0,!0,!1,!1,!1,!1)),n.receiveDeleteForeignKeyValues(u,"",t.dictAttributes.ID))}else t.foreignKeys=[],t.dictAttributes.sfwForeignKey=""};n.receiveDeleteForeignKeyValues=function(t,i,r){n.$apply(function(){var i=n.objDelete.Elements.filter(function(n){return n.dictAttributes.ID==r});i&&i.length>0&&angular.forEach(i,function(n){n.foreignKeys=t})})};n.setSelectedDeleteProperty=function(t){n.clearSelection();n.selectedDeleteProperty=t;for(var i=0;i<n.objDelete.Elements.length;i++)n.objDelete.Elements[i].Name=="property"&&(n.objDelete.Elements[i].isSelected=t==n.objDelete.Elements[i]?!0:!1)};n.canRemoveDeleteProperty=function(){var t=n.objDelete.Elements.filter(function(n){return n.isSelected==!0});return t&&t.length>0?!0:!1};n.removeDeleteProperty=function(){var t=n.objDelete.Elements.filter(function(n){return n.isSelected==!0}),u,i;t&&t.length>0&&(u=n.objDelete.Elements.indexOf(t[0]),i=n.objDelete.Elements.filter(function(n){return n.Name=="property"}).indexOf(t[0]),u>-1&&i>-1&&confirm("DeleteID : '"+t[0].dictAttributes.ID+"'   will be deleted, Do you want to continue?")&&(r.UndRedoBulkOp("Start"),r.DeleteItem(t[0],n.objDelete.Elements,"setSelectedDeleteProperty"),n.objDelete.Elements.filter(function(n){return n.Name=="property"}).length>0&&(i==n.objDelete.Elements.filter(function(n){return n.Name=="property"}).length&&i--,n.objDelete.Elements.filter(function(n){return n.Name=="property"})[i].isSelected=!0),r.UndRedoBulkOp("End")))};n.canMoveDeletePropertyUp=function(){var t=n.objDelete.Elements.filter(function(n){return n.isSelected==!0});return t&&t.length>0?n.objDelete.Elements.filter(function(n){return n.Name=="property"}).indexOf(t[0])>0:!1};n.moveDeletePropertyUp=function(){var t=n.objDelete.Elements.filter(function(n){return n.isSelected==!0}),i;t&&t.length>0&&(r.UndRedoBulkOp("Start"),i=n.objDelete.Elements.indexOf(t[0]),r.DeleteItem(t[0],n.objDelete.Elements),r.InsertItem(t[0],n.objDelete.Elements,i-1),r.UndRedoBulkOp("End"),tt(!1,"#entity-businessobject-delete-section",{offsetTop:400,offsetLeft:0}))};n.canMoveDeletePropertyDown=function(){var t=n.objDelete.Elements.filter(function(n){return n.isSelected==!0});return t&&t.length>0?n.objDelete.Elements.filter(function(n){return n.Name=="property"}).indexOf(t[0])<n.objDelete.Elements.filter(function(n){return n.Name=="property"}).length-1:!1};n.moveDeletePropertyDown=function(){var t=n.objDelete.Elements.filter(function(n){return n.isSelected==!0}),i;t&&t.length>0&&(i=n.objDelete.Elements.indexOf(t[0]),r.UndRedoBulkOp("Start"),i=n.objDelete.Elements.indexOf(t[0]),r.DeleteItem(t[0],n.objDelete.Elements),r.InsertItem(t[0],n.objDelete.Elements,i+1),r.UndRedoBulkOp("End"),tt(!1,"#entity-businessobject-delete-section",{offsetTop:400,offsetLeft:0}))};tt=function(t,i,r){v(function(){var u;u=t==!1?$("#"+n.currentfile.FileName).find(i):$(i);u.scrollTo(u.find(".selected"),r,null)})};n.setPropertyPrefix=function(t){t.PropertyPrefix=GetDataTypePrefix(t.DataType);t.DataType&&t.DataType.trim()!=""&&(t.DataType.toLowerCase()=="object"?t.PropertyPrefix=t.Class&&t.Class.trim()!=""&&t.Class.indexOf("bus")==0?"ibus":t.Class&&t.Class.trim()!=""&&t.Class.indexOf("utl")==0?"iutl":"icdo":(t.DataType.toLowerCase()=="list"||t.DataType.toLowerCase()=="collection")&&(t.PropertyPrefix=t.Class&&t.Class.trim()!=""&&t.Class.indexOf("utl")==0?"iclu":"iclb"));n.setPropertyID(t)};n.setDescription=function(n){var t="Gets or sets the non-collection object of type ";n.DataType&&n.DataType.trim().length>0&&(t=n.DataType.toLowerCase()=="collection"||n.DataType.toLowerCase()=="cdocollection"||n.DataType.toLowerCase()=="list"?"Gets or sets the collection object of type "+n.Class:n.DataType.toLowerCase()=="object"?"Gets or sets the non-collection object of type "+n.Class:"Gets or sets the non-collection object of type "+n.DataType);n.Description=t};n.onDataTypeChanged=function(t){t.Class="";n.setPropertyPrefix(t);n.IsDirtyPartialFile=!0;n.setDescription(t);n.validateCSProperty(t)};n.onClassNameChanged=function(t){n.setPropertyPrefix(t);n.IsDirtyPartialFile=!0;n.setDescription(t);n.setDefaultPropertyName(t);n.validateCSProperty(t)};n.onPropertyNameChanged=function(t){n.IsDirtyPartialFile=!0;n.setDescription(t);n.setPropertyID(t);n.validateCSProperty(t)};n.setPropertyID=function(n){n.PropertyID=n.PropertyPrefix+n.PropertyName};n.setDefaultPropertyName=function(t){t.Class&&t.Class.trim().length>0&&(t.Class.indexOf("bus")==0||t.Class.indexOf("utl")==0)?(t.PropertyName=t.Class.substring(3),n.setPropertyID(t),n.validateCSPropertyPropertyName(t)):t.Class&&t.Class.trim().length>0&&t.Class.indexOf("do")==0&&(t.PropertyName=t.Class.substring(2),n.setPropertyID(t),n.validateCSPropertyPropertyName(t))};n.setSelectedCSProperty=function(t){n.clearSelection();n.setCurrentCSProperty(t)};n.setSelectedCSPropertyUsingKeyUpDown=function(t){var i=n.PartialFileData.indexOf(t);i>-1&&n.setSelectedCSProperty(i)};n.setCurrentCSProperty=function(t){for(var i=0;i<n.PartialFileData.length;i++)n.PartialFileData[i].isSelected=i==t?!0:!1};n.addCSProperty=function(){var t,i;n.IsDirtyPartialFile=!0;t={DataType:"",Class:"",PropertyPrefix:"",PropertyName:"",PropertyID:"",Description:"",IsValid:!0};n.validateCSProperty(t);n.PartialFileData!=undefined&&r.PushItem(t,n.PartialFileData);i=n.PartialFileData.indexOf(t);i>0&&n.setCurrentCSProperty(i);v(function(){var n=$(".entity-business-object-properties");n.length&&n.scrollTop(n.prop("scrollHeight"))})};n.checkForPropertyFile=function(){if(n.BusObjPartialFileName==undefined)return!0};n.canDeleteCSProperty=function(){if(n.PartialFileData!=undefined)return n.PartialFileData.some(function(n){return n.isSelected})};n.deleteCSProperty=function(){var t=n.PartialFileData.filter(function(n){return n.isSelected==!0}),i;t&&t.length>0&&(i=n.PartialFileData.indexOf(t[0]),i>-1&&confirm("CSProperty : '"+t[0].PropertyID+"'   will be deleted, Do you want to continue?")&&(r.DeleteItem(t[0],n.PartialFileData),n.IsDirtyPartialFile=!0,n.PartialFileData.length>0&&(i==n.PartialFileData.length&&i--,n.PartialFileData[i].isSelected=!0)))};n.onClassNameKeyDown=function(t){var i=$(t.target);t.key!="Down"&&t.key!="Up"&&t.key!="Left"&&t.key!="Right"&&(t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE?(n.lstBusinessObjectForProperty&&$(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val()),t.preventDefault()):n.lstBusinessObjectForProperty&&setSingleLevelAutoComplete(i,n.lstBusinessObjectForProperty))};n.showClassNameList=function(t){var i=$(t.target).prevAll("input[type='text']");i&&n.lstBusinessObjectForProperty&&(i.focus(),setSingleLevelAutoComplete(i,n.lstBusinessObjectForProperty),$(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val()));t&&t.stopPropagation()};n.validateCSProperties=function(){if(n.PartialFileData&&angular.isArray(n.PartialFileData))for(var t=0;t<n.PartialFileData.length;t++)n.validateCSProperty(n.PartialFileData[t])};n.validateCSProperty=function(t){n.validateCSPropertyDataType(t);n.validateCSPropertyClass(t);n.validateCSPropertyPropertyName(t)};n.validateCSPropertyDataType=function(t){t.DataTypeError="";t.DataType&&t.DataType.trim().length>0?n.PartialFileDataTypes.indexOf(t.DataType)==-1&&(t.DataTypeError="Invalid Data Type."):t.DataTypeError="Enter Data Type.";n.setIsValid(t)};n.validateCSPropertyClass=function(t){t.ClassNameError="";t.DataType&&(t.DataType.toLowerCase()=="object"||t.DataType.toLowerCase()=="collection"||t.DataType.toLowerCase()=="cdocollection"||t.DataType.toLowerCase()=="list")&&(t.Class&&t.Class.trim().length>0||(t.ClassNameError="Enter Class Name."));n.setIsValid(t)};n.validateCSPropertyPropertyName=function(t){t.PropertyNameError="";t.PropertyName&&t.PropertyName.trim().length>0?isValidIdentifier(t.PropertyID)?n.PartialFileData.filter(function(n){return n.PropertyID==t.PropertyID}).length>1&&(t.PropertyNameError="Duplicate Property ID."):t.PropertyNameError="Invalid Property Name.":t.PropertyNameError="Enter Property Name.";n.setIsValid(t)};n.setIsValid=function(n){n.IsValid=!0;n.DataTypeError&&n.DataTypeError.trim().length>0&&(n.IsValid=!1);n.ClassNameError&&n.ClassNameError.trim().length>0&&(n.IsValid=!1);n.PropertyNameError&&n.PropertyNameError.trim().length>0&&(n.IsValid=!1)};n.BeforeSaveToFile=function(){n.objEntity&&n.objEntity.dictAttributes&&(n.IsDirtyPartialFile&&n.BusObjPartialFileName&&n.BusObjPartialFileName.trim().length>0&&$.connection.hubEntityModel.server.savePartialBusObjectFile(n.objEntity.dictAttributes.ID,n.BusObjPartialFileName,n.PartialFileData),n.addExtraFieldsDataInToMainModel(),n.CheckAndRemoveUnmappedColumnNode())};n.AfterSaveToFile=function(){var u,t,i;if(n.objEntity&&n.objEntity.dictAttributes)for(u=n.objEntity.dictAttributes.ID,t=o.getEntityIntellisense(),i=0;i<t.length;i++)if(t[i].ID==u){t[i].Queries=[];t[i].Attributes=[];t[i].XmlMethods=[];t[i].ObjectMethods=[];t[i].ParentId=n.objEntity.dictAttributes.sfwParentEntity?n.objEntity.dictAttributes.sfwParentEntity:"";t[i].TableName=n.objEntity.dictAttributes.sfwTableName?n.objEntity.dictAttributes.sfwTableName:"";t[i].BusinessObjectName=n.objEntity.dictAttributes.sfwObjectID?n.objEntity.dictAttributes.sfwObjectID:"";t[i].ErrorTableName=n.objEntity.dictAttributes.sfwErrorTable?n.objEntity.dictAttributes.sfwErrorTable:"";angular.forEach(n.objEntity.Elements,function(f){f.Name=="queries"?angular.forEach(f.Elements,function(n){var f,e;n.Name=="query"&&(f=n.dictAttributes.sfwSql,r.IsOracleDB&&(f=n.dictAttributes.sfwOracle),e={ID:n.dictAttributes.ID,DisplayName:n.dictAttributes.ID,Value:n.dictAttributes.ID,Tooltip:n.dictAttributes.ID,QueryType:n.dictAttributes.sfwQueryType,DataType:n.dictAttributes.sfwDataType,Parameters:[],Columns:[],SqlQuery:f,Entity:u,isQueryfieldsLoaded:!1,lstQueryFields:[]},angular.forEach(n.Elements,function(n){n.Name=="parameters"&&angular.forEach(n.Elements,function(n){if(n.Name=="parameter"){var t={ID:n.dictAttributes.ID,DisplayName:n.dictAttributes.ID,Value:n.dictAttributes.ID,Tooltip:n.dictAttributes.ID,DataType:n.dictAttributes.sfwDataType,Direction:n.dictAttributes.sfwDirection,Entity:u};e.Parameters.push(t)}})}),t[i].Queries.push(e))}):f.Name=="attributes"?(n.IsDirtyPartialFile&&n.BusObjPartialFileName&&n.BusObjPartialFileName.trim().length>0&&(n.CheckAndAddNewlyAddedAttributes(f,n.PartialFileData,t),r.ClearUndoRedoListByFileName(n.currentfile.FileName),n.IsDirtyPartialFile=!1),n.RefreshIntellisenseAttributes(f)):f.Name=="methods"?angular.forEach(f.Elements,function(n){var r={ID:n.dictAttributes.ID,MethodType:n.dictAttributes.sfwMethodType,Mode:n.dictAttributes.sfwMode,Items:[],Parameters:[]};n.Elements.length>0&&angular.forEach(n.Elements,function(n){var t,i;n.Name=="item"?(t={ID:n.dictAttributes.ID,ItemType:n.dictAttributes.sfwItemType,LoadType:n.dictAttributes.sfwLoadType,LoadSource:n.dictAttributes.sfwLoadSource,SfwParameters:n.dictAttributes.sfwParameter},r.Items.push(t)):n.Name=="parameter"&&(i={ID:n.dictAttributes.ID,DataType:n.dictAttributes.sfwDataType,Value:n.dictAttributes.Value},r.Parameters.push(i))});t[i].XmlMethods.push(r)}):f.Name=="objectmethods"&&angular.forEach(f.Elements,function(n){var r={ID:n.dictAttributes.ID,ReturnType:n.dictAttributes.sfwReturnType,Entity:n.dictAttributes.sfwEntity,Parameters:[]};n.Elements.length>0&&n.Elements[0].Elements.length>0&&angular.forEach(n.Elements[0].Elements,function(n){if(n.Name=="parameter"){var t={ID:n.dictAttributes.ID,DataType:n.dictAttributes.sfwDataType,Entity:n.dictAttributes.sfwEntity};r.Parameters.push(t)}});r.Type="Method";r.ID&&t[i].ObjectMethods.push(r)})});break}};n.RefreshIntellisenseAttributes=function(t){for(var u=n.objEntity.dictAttributes.ID,r=o.getEntityIntellisense(),i=0;i<r.length;i++)if(r[i].ID==u){r[i].Attributes=[];angular.forEach(t.Elements,function(n){var t,f;n&&n.dictAttributes&&n.dictAttributes.ID&&(t=n.dictAttributes.sfwDataType,(n.dictAttributes.sfwType=="List"||n.dictAttributes.sfwType=="Collection"||n.dictAttributes.sfwType=="Object"||n.dictAttributes.sfwType=="CDOCollection")&&(t=n.dictAttributes.sfwType),f={ID:n.dictAttributes.ID,DisplayName:n.dictAttributes.ID,Value:n.dictAttributes.sfwValue,Tooltip:n.dictAttributes.ID,DataType:t,Direction:"",Entity:n.dictAttributes.sfwEntity,IsPrivate:n.dictAttributes.sfwPrivate,Type:n.dictAttributes.sfwType,CodeID:n.dictAttributes.sfwCodeID,KeyNo:n.dictAttributes.sfwKeyNo,Caption:n.dictAttributes.sfwCaption,DeclaringEntity:u},r[i].Attributes.push(f))});break}};n.CheckAndAddNewlyAddedAttributes=function(t,i,u){var f,a,v,l,o,e,h,c,s;for(r.UndRedoBulkOp("Start"),f=0;f<i.length;f++){for(a=!1,v=i[f].PropertyID,l=0;l<t.Elements.length;l++)if(t.Elements[l].dictAttributes.sfwValue==v){a=!0;break}a||(i[f].DataType=="Object"&&i[f].Class.indexOf("utl")!==0?(e=n.GetEntityIdBasedOnBusinessObject(u,i[f].Class),e&&(o={},o.Value="",o.Name="attribute",o.Elements=[],s="obj"+i[f].PropertyName,o.dictAttributes={ID:s,sfwType:"Object",sfwEntity:e,sfwPrivate:"False",sfwValue:i[f].PropertyID},r.PushItem(o,t.Elements,null))):i[f].DataType=="Collection"&&i[f].Class.indexOf("utl")!==0?(e=n.GetEntityIdBasedOnBusinessObject(u,i[f].Class),e&&(h={},h.Value="",h.Name="attribute",h.Elements=[],s="lst"+i[f].PropertyName,h.dictAttributes={ID:s,sfwType:"Collection",sfwEntity:e,sfwValue:i[f].PropertyID,sfwPrivate:"False",Text:""},r.PushItem(h,t.Elements,null))):(c={},c.Value="",c.Name="attribute",c.Elements=[],s=i[f].PropertyName,c.dictAttributes={ID:s,sfwDataType:i[f].DataType,sfwDataFormat:"",sfwPrivate:!1,sfwValue:i[f].PropertyID,sfwEnumerator:"",Text:"",sfwType:"Property"},r.PushItem(c,t.Elements,null)))}r.UndRedoBulkOp("End")};n.GetEntityIdBasedOnBusinessObject=function(n,t){for(var r="",i=0;i<n.length;i++)if(n[i].BusinessObjectName==t){r=n[i].EntityName;break}return r};n.LoadParentForObject=function(t){angular.forEach(t.Elements,function(i){i.ParentID=t.Name=="harderror"||t.Name=="softerror"||t.Name=="groupslist"||t.Name=="group"?t.dictAttributes.ID:t.dictAttributes.ID;i.Elements.length>0&&n.LoadParentForObject(i);i.Children.length>0&&n.LoadParentForObject(i)});angular.forEach(t.Children,function(i){i.ParentID=t.dictAttributes.ID;i.Children.length>0&&n.LoadParentForObject(i);i.Elements.length>0&&n.LoadParentForObject(i)})};n.setObjectEditable=function(n){n.isEditable=!0};n.setObjectReadOnly=function(n){n.isEditable=!1};n.checkAndSetRowReadOnly=function(t,i){t.keyCode==$.ui.keyCode.ESCAPE&&n.setObjectReadOnly(i)};n.setAllObjectReadOnlyExceptThis=function(t){angular.forEach(n.objAttributes.Elements.filter(function(n){return n!=t}),function(t){n.setObjectReadOnly(t)})};n.GetRuleByName=function(t){var i;return n.selectedIneritedTab=="InheritedRule"?n.objInheritedRules&&n.objInheritedRules.Elements.length>0&&(i=n.FindRuleById(n.objInheritedRules,t)):n.objRules&&n.objRules.Elements.length>0&&(i=n.FindRuleById(n.objRules,t)),i};n.FindRuleById=function(t,i){var r;return angular.forEach(t.Elements,function(t){r||(t.dictAttributes.ID==i&&(r=t),t.Elements.length>0&&!r&&n.FindRuleById(t,i))}),r};n.onkeydownInExpressions=function(n){n&&n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&n.preventDefault()};n.onActionKeyDownForExpressions=function(t,i,r,u,f){n.objBusinessObject.ObjTree||i==undefined||i.toString().toLowerCase()!="true"?n.IntellisenseonActionKeyDownForExpressions(t,i,r,u,f):$.connection.hubEntityModel.server.loadObjectTree(n.objEntity.dictAttributes.sfwObjectID,"",!0).done(function(e){n.receiveObjectTree(e);n.IntellisenseonActionKeyDownForExpressions(t,i,r,u,f)})};n.IntellisenseonActionKeyDownForExpressions=function(t,i,u,f,o){var v=t.target,c=getSplitArray($(v).val(),v.selectionStart),a,s,y,l;c[c.length-1]==""&&c.pop();i=i!=undefined&&i.toString().toLowerCase()=="true"?"true":"false";var l="ID",h=n.getFirstLevelIntellisenseForExpressions(i&&i.toLowerCase()=="true",u==!1?!1:!0,f==!1?!1:!0,o==!1?!1:!0),p=!1;if(c.length>0)for(a=0;a<c.length;a++)if(s=h.filter(function(n){return n.ID&&n.ID==c[a]||n.ShortName&&n.ShortName==c[a]}),s.length>0)if(s[0].ID=="this")n.objBusinessObject.ObjTree&&(h=n.objBusinessObject.ObjTree.ChildProperties,h=h.concat(n.objBusinessObject.ObjTree.lstMethods)),l="ShortName";else if(s[0].ID=="RFunc")h=e.getRfunctionsList(),l="ID";else if(s[0].isCustomType)hubMain.server.getCustomTypeMethods(s[0].ID).done(function(i){h=i;n.setIntellisenseData(h,v,t,l)}),p=!0;else if(s[0].ItemType&&s[0].ShortName)s[0].DataType=="TableObjectType"||s[0].DataType=="CollctionType"||s[0].DataType=="BusObjectType"||s[0].DataType=="OtherReferenceType"?s[0].HasLoadedProp&&s[0].HasLoadedProp!=undefined?(h=s[0].ChildProperties,h=h.concat(s[0].lstMethods)):(y=c.join("."),y.indexOf("this.")==0&&(y=y.substring(5)),$.connection.hubEntityModel.server.loadObjectTree(s[0].ItemType.Name,s[0].FullPath,!0).done(function(t){var i="";s&&s.length>0&&s[0].FullPath&&(i=s[0].FullPath);n.receiveObjectTree(t,i)}),h=[]):h=[],l="ShortName";else{if(typeof s[0].DataType!="undefined"&&s[0].DataType=="Object"&&typeof s[0].Entity!="undefined")entityName=s[0].Entity,h=r.getEntityAttributeIntellisense(entityName,!0);else if(s[0].Type)if(s[0].Type=="Constant"){h=e.getConstantsList(c.join("."));break}else h=[];else h=[];l="ID"}p||n.setIntellisenseData(h,v,t,l)};n.setIntellisenseData=function(t,i,r,u){setMultilevelAutoCompleteForObjectTreeIntellisense($(i),t,u,undefined,n);r.ctrlKey&&r.keyCode==$.ui.keyCode.SPACE&&$(i).data("ui-autocomplete")&&($(i).autocomplete("search",$(i).val()),r.preventDefault())};n.showList=function(t,i,r,u,f){var e,s,o;e=$(t.target).prevAll("input[type='text']");e&&e.length==0&&(e=$("#textarea-expression"));e.focus();e&&(i=i!=undefined&&i.toString().toLowerCase()=="true"?"true":"false",s="ID",o=n.getFirstLevelIntellisenseForExpressions(i&&i.toLowerCase()=="true",r==!1?!1:!0,u==!1?!1:!0,f==!1?!1:!0),setSingleLevelAutoComplete(e,o));e&&o&&$(e).data("ui-autocomplete")&&$(e).autocomplete("search",$(e).val().trim());t&&t.stopPropagation()};n.getFirstLevelIntellisenseForExpressions=function(t,i,r,u){var f=[],s,h,c,l;if((r==undefined||r==!0)&&(f=f.concat(e.getConstantsList())),(u==undefined||u==!0)&&(f.push({ID:"RFunc",DisplayName:"RFunc",Value:"RFunc",Tooltip:"RFunc"}),n.customTypes&&n.customTypes.length>0))for(s=0,h=n.customTypes.length;s<h;s++)f.push({ID:n.customTypes[s],DisplayName:n.customTypes[s],Value:n.customTypes[s],Tooltip:n.customTypes[s],isCustomType:!0});return t&&n.objEntity.dictAttributes.sfwObjectID&&n.objEntity.dictAttributes.sfwObjectID.trim().length>0?f.push({ID:"this",DisplayName:"this",Value:"this",Tooltip:"this"}):(i==undefined||i==!0)&&(c=n.objEntity.dictAttributes.ID,l=o.getAttributes(c,null,null,!0),f=f.concat(l)),f};n.receiveObjectTree=function(t,i){n.$evalAsync(function(){var u,r,e,f;t=JSON.parse(t);u=t;i!=undefined&&i!=""?(r=getBusObjectByPath(i,n.objBusinessObject.ObjTree),r&&r.ItemType.Name==u.ObjName&&(r.ChildProperties=u.ChildProperties,r.lstMethods=u.lstMethods,r.HasLoadedProp=!0),SetParentForObjTreeChild(r)):(n.objBusinessObject.ObjTree=u,n.lstobjecttree.length>0&&n.lstobjecttree.splice(0,n.lstobjecttree.length),n.lstobjecttree.push(n.objBusinessObject.ObjTree),n.objBusinessObject.ObjTree.IsMainBusObject=!0,n.objBusinessObject.ObjTree.IsVisible=!0,SetParentForObjTreeChild(n.objBusinessObject.ObjTree),e=o.getEntityIntellisense(),f=e.filter(function(t){return t.ID==n.objEntity.dictAttributes.ID}),f!=undefined&&f.length>0&&f[0].Rules.length>0&&(n.objBusinessObject.ObjTree.Rules=f[0].Rules))})};n.recieveGetCodeValues=function(t){n.$evalAsync(function(){n.lstCodeValue=JSON.parse(t)})};n.recieveGetPopulateErrorTables=function(t){n.$evalAsync(function(){n.lstErrorTable=t})};n.recieveGetPopulateChecklistTables=function(t){n.$evalAsync(function(){n.lstChecklistTable=t})};n.recieveGetPopulateExpressionTables=function(t){n.$evalAsync(function(){n.lstExpressionTable=t})};n.getBoolValue=function(n){return n!=undefined&&n!=""?n=="True"||n=="true"?!0:!1:!1};n.getView=function(t){var r=!1,u,i;if(t&&t.toLowerCase().contains("id"))for(u=t.replace("id","value"),i=0;i<n.objAttributes.Elements.length;i++)if(u.toLowerCase()==n.objAttributes.Elements[i].dictAttributes.sfwValue){r=!0;break}return r};n.AddFieldConstraintFromDashBoard=function(t,i){var u=n.$new(),f,e;n.objEntity.dictAttributes&&n.objEntity.dictAttributes.ID&&(u.entityName=n.objEntity.dictAttributes.ID);u.model={Children:[],dictAttributes:{},Elements:[],Name:"item",Value:""};u.model.errors={};!t&&u.model.errors&&(u.model.errors.sfwFieldName=c.VALIDATION.EMPTY_FIELD);u.model.errors.empty_id=c.VALIDATION.ID_EMPTY;u.onCancelClick=function(){e.close()};u.OkClick=function(){delete u.model.errors;i=="Add"&&(r.PushItem(u.model,n.objConstraints.Elements,"SelectFieldConstraint"),n.SelectFieldConstraint(u.model),v(function(){var n=$(".constraint-container");n.length&&n.scrollTop(n.prop("scrollHeight"))}));var t=u.model.dictAttributes.sfwDisplayName;t||(t=u.model.dictAttributes.sfwFieldName);u.onCancelClick();n.scrollToPosition("#constraints",".entity-dashboard-inner-section-subcontainer",t)};f="Edit Field Constraint";i=="Add"&&(f="Add Field Constraint");e=r.showDialog(u,f,"Entity/views/Constraint/AddFieldConstraint.html",{width:665,height:670})};n.Operator=["","Equal","NotEqual","LessThan","LessThanEqual","GreaterThan","GreaterThanEqual"];n.addEditAttributeConstraint=function(t){addEditAttributeConstraint(n,t,n.objEntity,n.objEntity.dictAttributes.ID)};n.validateOperator=function(n,t){t==""&&n.dictAttributes.sfwRelatedField!=""?(n.errors||angular.isObject(n.errors)||(n.errors={}),n.errors.sfwOperator||(n.errors.sfwOperator=c.VALIDATION.EMPTY_FIELD)):n.errors&&n.errors.sfwOperator&&delete n.errors.sfwOperator};n.SelectFieldConstraint=function(t,i){n.objConstraints.SelectedField&&n.objConstraints.SelectedField!=t&&(n.objConstraints.SelectedField.IsFieldConstraintDetailVisibility=!1);n.clearSelection();n.objConstraints.SelectedField=t;i&&(t.dictAttributes.sfwDisplayName?n.scrollToPosition("#constraints",".entity-dashboard-inner-section-subcontainer",t.dictAttributes.sfwDisplayName):n.scrollToPosition("#constraints",".entity-dashboard-inner-section-subcontainer",t.dictAttributes.sfwFieldName))};n.SelectFieldConstraintdbclick=function(t){n.selectFieldConstraintsTab();n.SelectFieldConstraint(t,!1);t&&(n.activeGridRow=t)};n.DeleteFieldConstraint=function(t){var i=-1,u;n.objConstraints.SelectedField&&(i=n.objConstraints.Elements.indexOf(n.objConstraints.SelectedField),u=n.objConstraints.SelectedField.dictAttributes.sfwDisplayName?n.objConstraints.SelectedField.dictAttributes.sfwDisplayName:n.objConstraints.SelectedField.dictAttributes.sfwFieldName,confirm("FieldConstraint : '"+u+"'   will be deleted, Do you want to continue?")&&i>-1&&(r.DeleteItem(n.objConstraints.Elements[i],n.objConstraints.Elements,t),t?n.objConstraints.SelectedField=i<n.objConstraints.Elements.length?n.objConstraints.Elements[i]:n.objConstraints.Elements.length>0?n.objConstraints.Elements[i-1]:undefined:n.clearSelection(),$("#tblFieldConstraint").css("height","auto")))};n.onFieldNameChanged=function(t){var r=!1,i;l.validateID(t,undefined,t.dictAttributes.sfwFieldName);t.dictAttributes.sfwFieldName&&t.dictAttributes.sfwFieldName.trim().length>0&&n.objEntity.dictAttributes.ID&&(i=w.GetEntityFieldObjectFromEntityField(n.objEntity.dictAttributes.ID,t.dictAttributes.sfwFieldName),i&&i.DataType&&(n.$evalAsync(function(){t.dictAttributes.sfwDataType=i.DataType}),r=!0));r||(t.dictAttributes.sfwDataType="")};n.DetailsMode=["","All","New","Update"];n.PopulateLoadTypes=function(){n.lstLoadTypes=["None","ForeignKey","Query"]};n.onMainCdoChange=function(t){var i=$(t.target);n.tableObjects&&setSingleLevelAutoComplete(i,n.tableObjects,n);t&&t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&n.tableObjects&&($(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val()),t.preventDefault())};n.showMainCdoIntellisenseList=function(t){var i;i=$(t.target).prevAll("input[type='text']");i.focus();i&&n.tableObjects&&(setSingleLevelAutoComplete(i,n.tableObjects,n),$(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val()));t&&t.stopPropagation()};n.AddObjectMethod=function(t,i){var u=n.$new(),f,e,o;u.IsUpdate=!1;u.objObjectMethods=n.objObjectMethods;f="Add Object Method";e=r.showDialog(u,f,"Entity/views/UpdateObjectMethod.html",{width:1070,height:450});i=="Add"?(u.model={Children:[],dictAttributes:{ID:"",sfwReturnType:""},Elements:[],Name:"method",Value:""},l.validateID(u.model,n.validationErrorList,u.model.dictAttributes.ID)):(f="Edit Object Method",u.IsUpdate=!0,o=JSON.parse(JSON.stringify(t)),u.model=o);u.onCancelClick=function(){t&&i=="Update"&&u.model.errors&&$.isEmptyObject(u.model.errors)?l.removeObjInToArray(n.validationErrorList,t):i=="Add"&&u.model&&l.removeObjInToArray(n.validationErrorList,u.model);e.close()};u.OkClick=function(){if(i=="Add")r.PushItem(u.model,n.objObjectMethods.Elements,"SelectXmlMethod"),n.SelectObjectMethod(u.model);else if(i=="Update"){var f=n.objObjectMethods.Elements.indexOf(t);n.objObjectMethods.Elements[f]=u.model;n.SelectObjectMethod(u.model)}u.onCancelClick()}};n.SelectObjectMethod=function(t){t&&n.clearSelection();for(var i=0;i<n.objObjectMethods.Elements.length;i++)n.objObjectMethods.Elements[i]==t?(n.objObjectMethods.Elements[i].selected=!0,n.SelectedObjectMethod=n.objObjectMethods.Elements[i]):n.objObjectMethods.Elements[i].selected=!1};n.AddMethod=function(t,i){var u=n.$new(),e,f,s;if(u.IsUpdate=!1,u.lstobjecttree=n.lstobjecttree,e="Add Business Object Method",i=="Add")u.ErrorMessageForDisplay="Name cannot be empty.",u.obj={Children:[],dictAttributes:{ID:"",sfwDescription:"",sfwMethodType:"Other",sfwMode:""},Elements:[],Name:"method",Value:""};else for(e="Edit Business Object Method",u.IsUpdate=!0,u.obj=t,f=0;f<u.obj.Elements.length;f++)u.obj.Elements[f].Name=="item"&&(u.obj.Elements[f].isSelected=!1);s=r.showDialog(u,e,"Entity/views/AddBusinessObjectMethod.html",{width:1070,height:450});u.canOkClick=function(){var n=!1,i,t;return u.ErrorMessageForDisplay="",u.obj.dictAttributes.ID==undefined||u.obj.dictAttributes.ID==""?(n=!0,u.ErrorMessageForDisplay="Name cannot be empty."):isValidIdentifier(u.obj.dictAttributes.ID,!1)?(i=ft("xmlmethod"),t=i.Elements.filter(function(n){return n.dictAttributes.ID&&u.obj.dictAttributes.ID&&n.dictAttributes.ID.toLowerCase()==u.obj.dictAttributes.ID.toLowerCase()}),t&&t.length>0&&(u.IsUpdate?t.length>1&&(n=!0,u.ErrorMessageForDisplay="Duplicate Name."):t.length>0&&(n=!0,u.ErrorMessageForDisplay="Duplicate Name."))):(n=!0,u.ErrorMessageForDisplay="Invalid Name."),n};u.onOkClick=function(){i=="Add"&&(r.PushItem(u.obj,n.objMethods.Elements,"SelectXmlMethod"),n.SelectXmlMethod(u.obj));n.$evalAsync(function(){et(!0);rt()});u.onCancelClick();v(function(){var t=$("#"+n.currentfile.FileName).find("#entity-xml-method-section").find("span").filter(function(){return $(this).text()===u.obj.dictAttributes.ID});t=$(t)[0];t&&t.scrollIntoView()})};u.ChangeMethodType=function(n){n.dictAttributes.sfwMethodType=="Other"&&(n.dictAttributes.sfwMode="")};u.setXmlMethodNavigationParameter=function(t){n.xmlMethodParameters=t.Elements.filter(function(n){return n.Name=="parameter"}).map(function(n){return{ParamID:n.dictAttributes.ID,IsConstant:n.dictAttributes.Value!=undefined&&n.dictAttributes.Value.indexOf("#")==0,Value:n.dictAttributes.Value!=undefined&&n.dictAttributes.Value.indexOf("#")==0?n.dictAttributes.Value.substring(1):n.dictAttributes.Value}});var i=n.$new(!0);i.xmlMethodParameters=n.xmlMethodParameters;i.lstobjecttree=n.lstobjecttree;i.ObjTree=n.objBusinessObject.ObjTree;i.StrXmlMethodObjectTreePath=n.StrXmlMethodObjectTreePath;i.searchXmlMethodObjectTree=n.searchXmlMethodObjectTree;i.objEntity=n.objEntity;i.StrXmlMethodObjectTreeText=n.StrXmlMethodObjectTreeText;i.StrXmlMethodObjectTreePath=n.StrXmlMethodObjectTreePath;i.StrObjectTreeText=n.StrObjectTreeText;i.StrObjectTreePath=n.StrObjectTreePath;i.isParamAlreadySet=i.isParamAlreadySet;i.setnavigationParameterDialog=r.showDialog(i,"Navigation Parameters","Entity/views/SetNavigationParameters.html",{width:830,height:670});i.onSetNavParamOKClick=function(){for(var f,u=0;u<i.xmlMethodParameters.length;u++)f=t.Elements.filter(function(n){return n.Name=="parameter"&&n.dictAttributes.ID==i.xmlMethodParameters[u].ParamID}),f&&f.length>0&&(i.xmlMethodParameters[u].IsConstant?i.xmlMethodParameters[u].Value?r.EditPropertyValue(f[0].dictAttributes.Value,f[0].dictAttributes,"Value","#"+i.xmlMethodParameters[u].Value):r.EditPropertyValue(f[0].dictAttributes.Value,f[0].dictAttributes,"Value",""):r.EditPropertyValue(f[0].dictAttributes.Value,f[0].dictAttributes,"Value",i.xmlMethodParameters[u].Value?i.xmlMethodParameters[u].Value:""));n.xmlMethodParameters=undefined;i.xmlMethodParameters=undefined;i.onSetNavParamOKClick=undefined;i.setnavigationParameterDialog.close()}};u.moveBusMethodDown=function(n){var t,i;if(n&&(t=n.Elements.filter(function(n){return n.isSelected==!0}),t&&t.length>0)){for(i=n.Elements.indexOf(t[0]),r.UndRedoBulkOp("Start"),r.DeleteItem(t[0],n.Elements);n.Elements[i].Name=="parameter";)i++;r.InsertItem(t[0],n.Elements,i+1);r.UndRedoBulkOp("End");tt(!0,".entity-xml-addmethodlist",{offsetTop:300,offsetLeft:0})}};u.canMoveBusMethodUp=function(n){if(n){var t=n.Elements.filter(function(n){return n.isSelected==!0});if(t&&t.length>0)return n.Elements.filter(function(n){return n.Name=="item"}).indexOf(t[0])>0}return!1};u.moveBusMethodUp=function(n){var t,i;if(n&&(t=n.Elements.filter(function(n){return n.isSelected==!0}),t&&t.length>0)){for(i=n.Elements.indexOf(t[0]),r.UndRedoBulkOp("Start"),r.DeleteItem(t[0],n.Elements);n.Elements[i-1].Name=="parameter";)i--;r.InsertItem(t[0],n.Elements,i-1);r.UndRedoBulkOp("End");tt(!0,".entity-xml-addmethodlist",{offsetTop:300,offsetLeft:0})}};u.canMoveBusMethodDown=function(n){if(n){var t=n.Elements.filter(function(n){return n.isSelected==!0});if(t&&t.length>0)return n.Elements.filter(function(n){return n.Name=="item"}).indexOf(t[0])<n.Elements.filter(function(n){return n.Name=="item"}).length-1}return!1};u.canDeleteBusMethod=function(n){if(n){var t=n.Elements.filter(function(n){return n.isSelected==!0});if(t&&t.length>0)return!0}return!1};u.deleteBusMethod=function(t){var i,e,f;t&&(i=t.Elements.filter(function(n){return n.isSelected==!0}),i&&i.length>0&&(i[0].dictAttributes.ID||(i[0].dictAttributes.ID=""),confirm("BusMethod : '"+i[0].dictAttributes.ID+"'   will be deleted, Do you want to continue?")&&(e=t.Elements.indexOf(i[0]),f=t.Elements.filter(function(n){return n.Name=="item"}).indexOf(i[0]),e>-1&&f>-1&&(r.UndRedoBulkOp("Start"),r.DeleteItem(i[0],t.Elements),u.removeUnwantedXmlMethodParameters(t),r.UndRedoBulkOp("End"),l.removeObjInToArray(n.validationErrorList,i[0]),t.Elements.filter(function(n){return n.Name=="item"}).length>0&&(f==t.Elements.filter(function(n){return n.Name=="item"}).length&&f--,t.Elements.filter(function(n){return n.Name=="item"})[f].isSelected=!0)))))};u.removeUnwantedXmlMethodParameters=function(n){var i,e,u,t,f,o;if(n)for(i=n.Elements.map(function(n){return n.dictAttributes.sfwParameter}).join(",").split(","),n.dictAttributes.sfwParameter&&(e=n.dictAttributes.sfwParameter.split(","),i=i.concat(e)),u=n.Elements.filter(function(n){return n.Name=="parameter"}),t=0;t<u.length;t++)f=u[t].dictAttributes.ID,i.indexOf(f)==-1&&i.indexOf("@"+f)==-1&&(o=n.Elements.indexOf(u[t]),o>-1&&r.DeleteItem(u[t],n.Elements))};u.addBusMethod=function(n){if(n)r.PushItem({Name:"item",Value:"",Elements:[],Children:[],dictAttributes:{},isSelected:!1},n.Elements),u.setSelectedBusMethod(n,n.Elements.length-1)};u.setSelectedBusMethod=function(t,i){for(var r=0;r<t.Elements.length;r++)t.Elements[r].Name=="item"&&(r==i?(t.Elements[r].isSelected=!0,n.selectedMethodProperty=t.Elements[r],t.Elements[r].dictAttributes.sfwLoadType&&t.Elements[r].dictAttributes.sfwLoadType=="ForeignKey"&&(t.Elements[r].foreignKeys||u.getForignKeysForselectedObject(t.Elements[r]))):t.Elements[r].isSelected=!1)};u.getForignKeysForselectedObject=function(t){var r,i,u,f;t.dictAttributes.ID&&t.dictAttributes.ID.trim()!=""&&(r=w.GetEntityFieldObjectFromEntityField(n.objEntity.dictAttributes.ID,t.dictAttributes.ID.trim()),i="",r&&(i=n.GetBusinessObject(r.DeclaringEntity),u=r.DeclaringEntity),i&&n.blnShowCreateWithClass?t.dictAttributes.sfwItemType=="Collection"?$.connection.hubEntityModel.server.getXmlMethodForeignKeyValues(n.objEntity.dictAttributes.ID,i,"Collection").done(function(n){var i=n.Foreignkeys;t.foreignKeys=i}):t.dictAttributes.sfwItemType=="Object"&&$.connection.hubEntityModel.server.getXmlMethodForeignKeyValues(n.objEntity.dictAttributes.ID,i,"Object").done(function(n){var i=n.Foreignkeys;t.foreignKeys=i}):n.blnShowCreateWithClass||(f=[],u&&(f=d.GetIntellisenseData(u,"Column","Int",!0,!0,!1,!1,!1,!1)),t.foreignKeys=f))};u.addBusMethodParameter=function(n,t,i){if(!n.Elements.some(function(n){return n.Name=="parameter"&&n.dictAttributes.ID==t})){var r={Name:"parameter",Value:"",Elements:[],Children:[],dictAttributes:{ID:t,sfwDataType:i}};n.Elements.push(r)}};u.onChangeLoadMainCDO=function(n){var i,t,f;if(n)if(n.dictAttributes.sfwLoadQuery="",n.dictAttributes.sfwParameter="",n.dictAttributes.sfwLoadMainObject=="True"){for(n.dictAttributes.sfwParameter="aintPrimaryKey",i=!1,t=0;t<n.Elements.length;t++)if(n.Elements[t].Name=="parameter"&&n.Elements[t].dictAttributes.ID=="aintPrimaryKey"){i=!0;break}i||(f={Name:"parameter",Value:"",dictAttributes:{ID:"aintPrimaryKey",sfwDataType:"int"},Elements:[]},r.PushItem(f,n.Elements))}else u.removeUnwantedXmlMethodParameters(n)};u.removeUnwantedParameters=function(){u.obj&&u.removeUnwantedXmlMethodParameters(u.obj)};u.removeParameterFromSelectedXmlMethod=function(n){for(var t=0;t<n.Elements.length;t++);};u.resetLoadSource=function(t){var h,r,f,o,a,s,e,c,l;t&&(t.dictAttributes.sfwLoadSource="",t.dictAttributes&&t.dictAttributes.sfwParameter&&(t.dictAttributes.sfwParameter="",u.obj&&u.removeUnwantedXmlMethodParameters(u.obj)));t.dictAttributes.sfwLoadType=="ForeignKey"&&(f=[],i=="Add"?f.push(u.obj):f=n.getselectedMethod(),f&&f.length>0&&(h=f[0],o=h.Elements.filter(function(n){return n.isSelected==!0}),o&&o.length>0&&(r=o[0])),a=null,h&&r&&r.dictAttributes.ID&&r.dictAttributes.ID.trim()!=""&&(s=w.GetEntityFieldObjectFromEntityField(n.objEntity.dictAttributes.ID,r.dictAttributes.ID.trim()),e="",s&&(e=n.GetBusinessObject(s.DeclaringEntity),c=s.DeclaringEntity),e&&n.blnShowCreateWithClass?r.dictAttributes.sfwItemType=="Collection"?$.connection.hubEntityModel.server.getXmlMethodForeignKeyValues(n.objEntity.dictAttributes.ID,e,"Collection").done(function(n){var t=n.Foreignkeys,i=n.ForeignkeyDefaultValue;u.receiveXmlMethodForeignKeyValues(t,i)}):r.dictAttributes.sfwItemType=="Object"&&$.connection.hubEntityModel.server.getXmlMethodForeignKeyValues(n.objEntity.dictAttributes.ID,e,"Object").done(function(n){var t=n.Foreignkeys,i=n.ForeignkeyDefaultValue;u.receiveXmlMethodForeignKeyValues(t,i)}):n.blnShowCreateWithClass||(l=[],c&&(l=d.GetIntellisenseData(c,"Column","Int",!0,!0,!1,!1,!1,!1)),u.receiveXmlMethodForeignKeyValues(l,""))))};u.getBusMethod=function(t,i){var r=null,u,f;return n.objBusinessObject.ObjTree&&(i.dictAttributes.ID.indexOf(".")==-1&&n.objBusinessObject.ObjTree.Rules&&(u=n.objBusinessObject.ObjTree.Rules.filter(function(n){return n.ID==i.dictAttributes.ID}),u&&u.length>0&&(r=u[0])),r==null&&(r=getBusObjectByPath(i.dictAttributes.ID,n.objBusinessObject.ObjTree)),f=i.dictAttributes.ID.substring(i.dictAttributes.ID.lastIndexOf(".")+1),r==null&&(r=getBusObjectByPath(f,n.objBusinessObject.ObjTree))),r};u.NavigateToQueryFromBusMethod=function(n){var f=n.indexOf("."),s,u,t;if(f>-1){var i=n.substring(0,f),h=null,e=o.getEntityIntellisense();for(t=0;t<e.length;t++)if(e[t].ID==i){h=t;break}for(s=n.substring(f+1,n.length),r.queryID=s,t=0;t<r.lstopenedfiles.length;t++)if(r.lstopenedfiles[t].file.FileName==i&&(u=getScopeByFileName(i),u!=undefined)){$.connection.hubMain.server.navigateToFile(i,"").done(function(n){r.openFile(n,!1)});u.openQueryFromLogicalRule();break}u==undefined&&$.connection.hubMain.server.navigateToFile(i,"").done(function(n){r.openFile(n,!1)})}};u.validateQuery=function(n){var t,s,i,r,e;if(u.loadSourceError="",n.dictAttributes.sfwLoadType&&n.dictAttributes.sfwLoadType=="Query"&&n.dictAttributes.sfwLoadSource&&n.dictAttributes.sfwLoadSource.trim().length>0)if(t=n.dictAttributes.sfwLoadSource.indexOf("."),t>-1){var c=n.dictAttributes.sfwLoadSource.substring(0,t),f=h("filter")(o.getEntityIntellisense(),{ID:c},!0);f&&f.length>0?(s=f[0],i=n.dictAttributes.sfwLoadSource.substring(t+1,n.dictAttributes.sfwLoadSource.length),i&&i.trim().length>0?(r=h("filter")(s.Queries,{ID:i},!0),r&&r.length>0?(e=r[0],e.Parameters.length==1?e.Parameters[0].DataType!="int"&&(u.loadSourceError="DataType of parameter must be integer."):u.loadSourceError="Query should take only one parameter of type integer."):u.loadSourceError="Invalid Query."):u.loadSourceError="Invalid Query."):u.loadSourceError="Invalid Query."}else u.loadSourceError="Invalid Query."};u.onForeignKeyChange=function(n,t){setSingleLevelAutoComplete($(t.currentTarget),n.foreignKeys)};u.receiveXmlMethodForeignKeyValues=function(t,i){n.$apply(function(){var r=u.obj,n;r&&(n=r.Elements.filter(function(n){return n.isSelected==!0}),n&&n.length>0&&(n[0].foreignKeys=t,n[0].dictAttributes.sfwLoadType="ForeignKey",n[0].dictAttributes.sfwLoadSource=i))})};u.onCancelClick=function(){i=="Add"&&u.obj&&u.obj.Elements&&angular.forEach(u.obj.Elements,function(t){l.removeObjInToArray(n.validationErrorList,t)});s.close()};u.onChangeLoadQuery=function(n){var f,l,e,s,t,i,r;if(n&&n.dictAttributes.sfwLoadQuery){if(f=n.dictAttributes.sfwLoadQuery.indexOf("."),n.dictAttributes.sfwParameter="",f>-1){var a=n.dictAttributes.sfwLoadQuery.substring(0,f),c=h("filter")(o.getEntityIntellisense(),{ID:a},!0);if(c&&c.length>0&&(l=c[0],e=n.dictAttributes.sfwLoadQuery.substring(f+1,n.dictAttributes.sfwLoadQuery.length),e&&e.trim().length>0&&(s=h("filter")(l.Queries,{ID:e},!0),s&&s.length>0&&(t=s[0],t.Parameters&&t.Parameters.length>0))))for(i=0;i<t.Parameters.length>0;i++)n.dictAttributes.sfwParameter?n.dictAttributes.sfwParameter+=","+t.Parameters[i].ID:n.dictAttributes.sfwParameter=t.Parameters[i].ID,u.obj&&(r=t.Parameters[i].ID,r&&r.match("^@")&&(r=r.substring(1)),u.addBusMethodParameter(u.obj,r,t.Parameters[i].DataType))}}else u.onChangeLoadMainCDO(n);u.removeUnwantedXmlMethodParameters(n)};u.onMethodorRuleChange=function(n,t){var r,f,i;if(n.Parameters&&n.Parameters.length>0){for(r=0;r<n.Parameters.length>0;r++)t.dictAttributes.sfwParameter?t.dictAttributes.sfwParameter+=","+n.Parameters[r].ID:t.dictAttributes.sfwParameter=n.Parameters[r].ID;for(u.removeUnwantedXmlMethodParameters(u.obj),f=0;f<n.Parameters.length>0;f++)u.obj&&(i=n.Parameters[f].ID,i&&i.match("^@")&&(i=i.substring(1)),u.addBusMethodParameter(u.obj,i,n.Parameters[f].DataType))}else t.dictAttributes.sfwParameter="",u.removeUnwantedXmlMethodParameters(u.obj)};u.onPropertyChanged=function(n){if(n){var t=n.dictAttributes.sfwParameter;t&&u.addBusMethodParameter(u.obj,t,n.dictAttributes.sfwDataType);u.removeUnwantedXmlMethodParameters(u.obj)}};u.onChangeQuery=function(n){var f,l,e,s,t,i,r;if(n&&n.dictAttributes&&n.dictAttributes.sfwLoadType&&n.dictAttributes.sfwLoadType=="Query"&&n.dictAttributes.sfwLoadSource&&n.dictAttributes.sfwLoadSource.trim().length>0){if(f=n.dictAttributes.sfwLoadSource.indexOf("."),n.dictAttributes.sfwParameter="",f>-1){var a=n.dictAttributes.sfwLoadSource.substring(0,f),c=h("filter")(o.getEntityIntellisense(),{ID:a},!0);if(c&&c.length>0&&(l=c[0],e=n.dictAttributes.sfwLoadSource.substring(f+1,n.dictAttributes.sfwLoadSource.length),e&&e.trim().length>0&&(s=h("filter")(l.Queries,{ID:e},!0),s&&s.length>0&&(t=s[0],t.Parameters&&t.Parameters.length>0))))for(i=0;i<t.Parameters.length>0;i++)n.dictAttributes.sfwParameter?n.dictAttributes.sfwParameter+=","+t.Parameters[i].ID:n.dictAttributes.sfwParameter=t.Parameters[i].ID,u.obj&&(r=t.Parameters[i].ID,r&&r.match("^@")&&(r=r.substring(1)),u.addBusMethodParameter(u.obj,r,t.Parameters[i].DataType))}}else n&&n.dictAttributes&&n.dictAttributes.sfwLoadType&&n.dictAttributes.sfwLoadType=="Query"&&!n.dictAttributes.sfwLoadSource&&(n.dictAttributes.sfwParameter="");u.obj&&u.removeUnwantedXmlMethodParameters(u.obj)}};n.GetBusinessObject=function(n){for(var r="",u=o.getEntityIntellisense(),i=n,t;i;)t=u.filter(function(n){return n.ID==i}),t&&t.length>0?(r=t[0].BusinessObjectName,i=r?"":t[0].ParentId):i="";return r};n.isSelectedMethoddbclick=function(t){n.SelectXmlMethod(t);n.selectBusinessObjectTab()};n.SelectXmlMethod=function(t){t&&n.clearSelection();for(var i=0;i<n.objMethods.Elements.length;i++)n.objMethods.Elements[i]==t?(n.objMethods.Elements[i].selected=!0,n.SelectedXMLMethod=n.objMethods.Elements[i]):n.objMethods.Elements[i].selected=!1};n.canDeleteMethod=function(){if(n.objMethods!=undefined&&n.objMethods.Elements!=undefined)return n.objMethods.Elements.some(function(n){return n.selected})};n.DeleteMethod=function(t){var i=n.objMethods.Elements.filter(function(n){return n.selected}),u;i&&i.length>0&&confirm("XML Method : '"+i[0].dictAttributes.ID+"'   will be deleted, Do you want to continue?")&&(u=n.objMethods.Elements.indexOf(i[0]),l.removeObjInToArray(n.validationErrorList,i[0]),u>-1&&(r.DeleteItem(i[0],n.objMethods.Elements,t),t?n.objMethods.Elements.length>0&&(u==n.objMethods.Elements.length&&u--,n.objMethods.Elements[u].selected=!0):(i[0].selected=!1,n.clearSelection()),et(!0)))};n.SelectedXmlMethodItem=function(t){if(t&&n.SelectedXMLMethod){var i=n.SelectedXMLMethod.Elements.indexOf(t);n.setSelectedBusMethod(t,i)}};n.setSelectedBusMethod=function(t,i){for(var r=0;r<t.Elements.length;r++)t.Elements[r].Name=="item"&&(r==i?(t.Elements[r].isSelected=!0,n.selectedMethodProperty=t.Elements[r]):t.Elements[r].isSelected=!1)};n.getselectedMethod=function(){return n.objMethods.Elements.filter(function(n){return n.selected==!0})};n.getBusMethod=function(t,i){var r=null,u,f;return i.dictAttributes.ID.indexOf(".")==-1&&n.objBusinessObject.ObjTree.Rules&&(u=n.objBusinessObject.ObjTree.Rules.filter(function(n){return n.ID==i.dictAttributes.ID}),u&&u.length>0&&(r=u[0])),r==null&&(r=getBusObjectByPath(i.dictAttributes.ID,n.objBusinessObject.ObjTree)),f=i.dictAttributes.ID.substring(i.dictAttributes.ID.lastIndexOf(".")+1),r==null&&(r=getBusObjectByPath(f,n.objBusinessObject.ObjTree)),r};n.onForeignKeyChange=function(t,i){var r;if(i.keyCode&&i.keyCode!=13&&i.key!="Down"&&i.key!="Up"&&i.key!="Left"&&i.key!="Right"||i.type=="click"){if(r=i.type&&i.type=="click"?$(i.target).prevAll("input[type='text']"):$(i.target),t&&!t.foreignKeys)n.onChangeDeletePropertyId(t);t.foreignKeys&&(i.ctrlKey&&i.keyCode==$.ui.keyCode.SPACE&&$(r).data("ui-autocomplete")?($(r).autocomplete("search",$(r).val()),i.preventDefault()):(setSingleLevelAutoComplete(r,t.foreignKeys),$(r).data("ui-autocomplete")&&$(r).autocomplete("search",$(r).val())),i.type&&i.type=="click"&&(r.focus(),$(r).data("ui-autocomplete")&&$(r).autocomplete("search",$(r).val())))}i.ctrlKey&&i.keyCode==$.ui.keyCode.SPACE&&i.preventDefault()};n.onLifeCycleMethodChange=function(t){var r=!1,i,u;if(n.objLifecycle.Elements.length>0)for(i=0;i<n.objLifecycle.Elements.length;i++)n.objLifecycle.Elements[i].dictAttributes.ID==t.ID&&(r=!0,t.XmlMethod!=""&&n.isValidLifeCycleMethod(t.XmlMethod)?(n.objLifecycle.Elements[i].dictAttributes.sfwXmlMethod=t.XmlMethod,n.objLifecycle.Elements[i].dictAttributes.sfwNavigationParameter=""):n.objLifecycle.Elements.splice(i,1));!r&&n.isValidLifeCycleMethod(t.XmlMethod)&&(u={Children:[],dictAttributes:{ID:t.ID,sfwXmlMethod:t.XmlMethod},Name:"method",Value:""},n.objLifecycle.Elements.push(u));t.Parameters=""};n.onLifeCycleMethodKeyDown=function(n){var t=$(n.target);n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&(st(t),n.preventDefault())};n.showLifeCycleMethodsList=function(n){var t=$(n.target).prevAll("input[type='text']");t.focus();st(t);n&&n.stopPropagation()};st=function(t){var i=[];i=n.objMethods.Elements.filter(function(n){return n.dictAttributes.sfwMethodType!="Load"}).map(function(n){return n.dictAttributes.ID});setSingleLevelAutoComplete($(t),i);$(t).data("ui-autocomplete")&&$(t).autocomplete("search",$(t).val().trim())};n.isValidLifeCycleMethod=function(t){return n.objMethods?n.objMethods.Elements.some(function(n){return n.dictAttributes.ID==t&&n.dictAttributes.sfwMethodType!="Load"}):!1};n.onLifeCycleSetNavParamClick=function(t){var l=n.objMethods.Elements.filter(function(n){return n.dictAttributes.ID==t.XmlMethod}),e,o,s,f,a,h,u,i;if(l&&l.length>0&&(e=l[0]),e){if(n.xmlMethodParameters=e.Elements.filter(function(n){return n.Name=="parameter"}).map(function(n){return{ParamID:n.dictAttributes.ID,IsConstant:n.dictAttributes.Value!=undefined&&n.dictAttributes.Value.indexOf("#")==0,Value:n.dictAttributes.Value!=undefined&&n.dictAttributes.Value.indexOf("#")==0?n.dictAttributes.Value.substring(1):n.dictAttributes.Value}}),o=n.xmlMethodParameters.filter(function(n){return n.Value==undefined||n.Value.trim()==""}),s=n.objLifecycle.Elements.filter(function(n){return n.dictAttributes.ID==t.ID&&n.dictAttributes.sfwXmlMethod==t.XmlMethod}),s&&s.length>0&&(f=s[0]),o&&o.length>0&&f.dictAttributes.sfwNavigationParameter)for(a=f.dictAttributes.sfwNavigationParameter.split(";"),h=0;h<a.length;h++)if(u=a[h].split("="),u&&u.length==2){var y=u[0],v=u[1].indexOf("#")==0,p=v?u[1].substring(u[1].indexOf("#")+1):u[1],c=o.filter(function(n){return n.ParamID==y});c&&c.length>0&&(c[0].IsConstant=v,c[0].Value=p)}i=n.$new(!0);i.ObjTree=n.objBusinessObject.ObjTree;i.lstobjecttree=n.lstobjecttree;i.StrXmlMethodObjectTreePath=n.StrXmlMethodObjectTreePath;i.searchXmlMethodObjectTree=n.searchXmlMethodObjectTree;i.xmlMethodParameters=n.xmlMethodParameters;i.objEntity=n.objEntity;i.StrXmlMethodObjectTreeText=n.StrXmlMethodObjectTreeText;i.StrXmlMethodObjectTreePath=n.StrXmlMethodObjectTreePath;i.StrObjectTreeText=n.StrObjectTreeText;i.StrObjectTreePath=n.StrObjectTreePath;i.isParamAlreadySet=i.isParamAlreadySet;i.setnavigationParameterDialog=r.showDialog(i,"Navigation Parameters","Entity/views/SetNavigationParameters.html",{width:830,height:670});i.onSetNavParamOKClick=function(){var e,u;if(f){for(e=[],u=0;u<n.xmlMethodParameters.length;u++)!n.isParamAlreadySet(n.xmlMethodParameters[u])&&n.xmlMethodParameters[u].Value&&n.xmlMethodParameters[u].Value.trim().length>0&&e.push(n.xmlMethodParameters[u].ParamID+"="+(n.xmlMethodParameters[u].IsConstant?"#"+n.xmlMethodParameters[u].Value:n.xmlMethodParameters[u].Value));r.UndRedoBulkOp("Start");r.EditPropertyValue(f.dictAttributes.sfwNavigationParameter,f.dictAttributes,"sfwNavigationParameter",e.join(";"));r.EditPropertyValue(t.Parameters,t,"Parameters",e.join(";"));r.UndRedoBulkOp("End")}i.setnavigationParameterDialog.close();n.xmlMethodParameters=undefined;n.isParamAlreadySet=undefined;i.xmlMethodParameters=undefined;i.onSetNavParamOKClick=undefined;i.isParamAlreadySet=undefined};i.isParamAlreadySet=function(n){return e.Elements.some(function(t){return t.Name=="parameter"&&t.dictAttributes.ID==n.ParamID&&t.dictAttributes.Value&&t.dictAttributes.Value.trim().length>0})};n.isParamAlreadySet=function(n){return e.Elements.some(function(t){return t.Name=="parameter"&&t.dictAttributes.ID==n.ParamID&&t.dictAttributes.Value&&t.dictAttributes.Value.trim().length>0})}}};n.selectedLifeCycle=undefined;n.selectLifeCycleMethod=function(t){if(t.XmlMethod)n.clearSelection(),n.selectedLifeCycle=t;else if(t.dictAttributes&&t.dictAttributes.sfwXmlMethod){var i=n.lstlifecycle.filter(function(n){return n.ID==t.dictAttributes.ID});n.selectedLifeCycle=i[0]}};n.SelectObjectMethod=function(t){n.SelectedObjectMethod&&n.SelectedObjectMethod!=t&&n.SelectedObjectMethod.IsShowParams&&(n.SelectedObjectMethod.IsShowParams=!1);n.clearSelection();n.SelectedObjectMethod=t};n.onExpandCollapsedObjectMethodParams=function(n){n&&(n.IsShowParams=!n.IsShowParams)};n.IsTypeOfbusOrDo=function(n){var i=!1,t;if(n){for(t=n;(t!=null||t!=undefined)&&t.Name!="busBase"&&t.Name!="doBase";)t=t.BaseType;(t!=null||t!=undefined)&&(t.Name=="busBase"||t.Name=="doBase")&&(i=!0)}return i};n.onAddObjectMethods=function(){var t={Name:"method",Value:"",dictAttributes:{},Elements:[]};r.PushItem(t,n.objObjectMethods.Elements,"SelectObjectMethod");n.SelectObjectMethod(t);n.validateId(n.objObjectMethods.Elements[n.objObjectMethods.Elements.length-1],undefined,!0);v(function(){var t=$("#"+n.currentfile.FileName).find("#entity-businessobject-objectmethod-section").find(".selected");t&&t.length>0&&t[0].scrollIntoView()})};n.AddOrRefreshObjectMethodParams=function(t,i){angular.forEach(t.Parameters,function(t){var h=n.IsTypeOfbusOrDo(t.ParameterType),u=null,f="",s,e;if(t.ParameterType.Name.match("]$")?(u="Collection",f=t.ParameterType.Name.substring(0,t.ParameterType.Name.length-1).toLowerCase()):h&&(u="Object",f=t.ParameterType.Name.toLowerCase()),u==null)switch(t.ParameterType.Name.toLowerCase()){case"short":case"int16":u="short";break;case"int":case"int32":u="int";break;case"long":case"int64":u="long";break;case"single":u="float";break;case"boolean":u="bool";break;default:u=t.ParameterType.Name.toLowerCase()}s={Name:"parameter",Value:"",dictAttributes:{ID:t.ParameterName,sfwDataType:u},Elements:[]};f!=undefined&&f!=""&&(f.indexOf("do")==0&&(f="bus"+f.substring(2)),e=o.getEntityIntellisense().filter(function(n){return n.BusinessObjectName&&n.BusinessObjectName.toLowerCase()==f.toLowerCase()}),e&&e.length>0&&(s.dictAttributes.sfwEntity=e[0].ID));r.PushItem(s,i.Elements)})};n.DeleteObjectMethod=function(){if(n.SelectedObjectMethod){var t=n.objObjectMethods.Elements.indexOf(n.SelectedObjectMethod);t>-1&&confirm("ObjectMethod : '"+n.SelectedObjectMethod.dictAttributes.ID+"'   will be deleted, Do you want to continue?")&&(r.DeleteItem(n.SelectedObjectMethod,n.objObjectMethods.Elements),l.removeObjInToArray(n.validationErrorList,n.SelectedObjectMethod),t<n.objObjectMethods.Elements.length?n.SelectedObjectMethod=n.objObjectMethods.Elements[t]:n.objObjectMethods.Elements.length>0&&(n.SelectedObjectMethod=n.objObjectMethods.Elements[t-1]),n.objObjectMethods.Elements.length==0&&(n.SelectedObjectMethod=undefined),et(!0))}};n.onObjectMethodIdChanged=function(t,u){var s=u.Elements.filter(function(n){return n.Name=="parameters"}),f,p,a,e,v,w,b,k,y,h;if(s&&s.length>0)for(i=0;i<s[0].Elements.length;i++)r.DeleteItem(s[0].Elements[i],s[0].Elements);t&&t!=""?n.objBusinessObject.ObjTree&&n.objBusinessObject.ObjTree.lstMethods&&(f=n.objBusinessObject.ObjTree.lstMethods.filter(function(n){return n.ShortName==t}),f&&f.length>0?(p=!1,f[0].Typeof&&(p=!0),a=f[0].DataTypeName,e="",f[0].DataTypeName.match("]$")?(a="Collection",e=f[0].DataTypeName.substring(0,f[0].DataTypeName.length-1)):p&&(a="Object",e=f[0].DataTypeName),r.EditPropertyValue(u.dictAttributes.sfwReturnType,u.dictAttributes,"sfwReturnType",a),e!=undefined&&e!=""&&(e.indexOf("do")==0?e="bus"+e.substring(2):e.indexOf("cdo")==0&&(e="bus"+e.substring(3)),v=o.getEntityIntellisense().filter(function(n){return n.BusinessObjectName==e}),v&&v.length>0&&(u.dictAttributes.sfwEntity=v[0].ID)),f[0].Parameters&&f[0].Parameters.length>0?(s=u.Elements.filter(function(n){return n.Name=="parameters"}),!s||s&&s.length==0?(objParams={Name:"parameters",Value:"",dictAttributes:{},Elements:[]},u.Elements.push(objParams)):objParams=s[0],objParams&&n.AddOrRefreshObjectMethodParams(f[0],objParams)):u.Elements=[]):(u.dictAttributes.sfwReturnType=null,u.dictAttributes.sfwEntity=null,u.Elements=[])):(u.dictAttributes.sfwReturnType=null,u.dictAttributes.sfwEntity=null,u.Elements=[]);l.validateID(u,n.validationErrorList,u.dictAttributes.ID);w=ft("objectmethod");n.objBusinessObject.ObjTree&&n.objBusinessObject.ObjTree.lstMethods&&(b=n.objBusinessObject.ObjTree.lstMethods,k=b.filter(function(n){if(n.ShortName)return n.ShortName===u.dictAttributes.ID}),k.length<=0&&(h=c.VALIDATION.INVALID_FIELD,u.errors.inValid_id=h));y=l.findDuplicateId(w,u.dictAttributes.ID,c.ENTITY.NODES,null,u,"dictAttributes.ID");y?(h=c.VALIDATION.DUPLICATE_ID,y.hasOwnProperty("isParent")&&y.isParent&&(h=c.VALIDATION.DUPLICATE_ID_IN_PARENT_ENTITY),u.errors.duplicate_id=h):u.errors&&u.errors.hasOwnProperty("duplicate_id")&&delete u.errors.duplicate_id};n.getObjectMethodList=function(t){if(t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&$(t.currentTarget).data("ui-autocomplete")&&$(t.currentTarget).val()!="")$(t.currentTarget).autocomplete("search",$(t.currentTarget).val()),t.preventDefault();else if(t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE){n.onEntityChanged(n.objEntity.dictAttributes.ID);setSingleLevelAutoComplete($(t.currentTarget),n.lstObjectMethod,n,"ID","ID");$(t.currentTarget).data("ui-autocomplete")&&$(t.currentTarget).autocomplete("search",$(t.currentTarget).val());t.preventDefault()}else $(t.currentTarget).data("ui-autocomplete")&&$(t.currentTarget).val()!=""&&$(t.currentTarget).autocomplete("search",$(t.currentTarget).val())};n.showObjectMethodList=function(t){if(n.inputElement=$(t.target).prevAll("input[type='text']"),n.inputElement){if($(n.inputElement).focus(),$(n.inputElement).val()=="")n.onEntityChanged(n.objEntity.dictAttributes.ID);if(n.lstObjectMethod&&n.lstObjectMethod.length>0)setSingleLevelAutoComplete(n.inputElement,n.lstObjectMethod,n,"ID","ID"),$(n.inputElement).data("ui-autocomplete")&&$(n.inputElement).autocomplete("search",$(n.inputElement).val());else n.onEntityChanged(n.objEntity.dictAttributes.ID)}t&&t.stopPropagation()};n.onEntityChanged=function(){var u=o.getEntityIntellisense(),t,r,i;for(parententityName=n.objEntity.dictAttributes.ID,n.lstObjectMethod=[];parententityName;){if(t=u.filter(function(n){return n.ID==parententityName}),t.length>0&&t[0].ObjectMethods&&t[0].ObjectMethods.length>0){for(r=[],i=0;i<t[0].ObjectMethods.length;i++)t[0].ObjectMethods[i].Parameters&&t[0].ObjectMethods[i].Parameters.length==0&&r.push(t[0].ObjectMethods[i]);n.lstObjectMethod=n.lstObjectMethod.concat(r)}parententityName=t.length>0?t[0].ParentId:""}};n.EditAttributeRowValue=-1;n.SetEditAttributeRowValue=function(t){n.EditAttributeRowValue=t};n.AddAttributeFromDashBoard=function(){var t=n.$new(),i;t.AttributeName="";t.DescriptionInAttribute="";t.DataTypeInAttribute="";t.ObjectFieldInAttribute="";t.JSONFieldInAttribute="";t.DefaultValue="";t.DataFormatInAttribute="";t.IsPrivateAttribute=!1;i=r.showDialog(t,"Add Attribute","Entity/views/AddNewAttribute.html",{width:610,height:430});t.onCancelAttributeClick=function(){i.close()};t.clearDefaultValue=function(){t.DefaultValue=""};t.onOkClickAttributeDailog=function(){var t={};t.Value="";t.Name="attribute";t.Elements=[];this.IsPrivateAttribute=this.IsPrivateAttribute==!0?"True":"False";t.dictAttributes={ID:this.AttributeName,sfwDataType:this.DataTypeInAttribute,sfwDataFormat:this.DataFormatInAttribute,sfwPrivate:this.IsPrivateAttribute,sfwValue:this.ObjectFieldInAttribute,sfwRelatedJSONField:this.JSONFieldInAttribute,sfwEnumerator:"",Text:this.DescriptionInAttribute,sfwDefaultValue:this.DefaultValue,sfwType:"Property"};r.PushItem(t,n.objAttributes.Elements);n.selectAttribute(t,null,n.objAttributes.Elements.length-1);i.close();n.scrollToPosition("#attributes",".entity-dashboard-inner-section-container",t.dictAttributes.ID)};t.validateAttributeDailog=function(){var r,n,i;if(t.attributeError=undefined,t.AttributeName)if(isValidIdentifier(t.AttributeName,!1,!1)){if(r=nt(),n=l.findDuplicateId(r,t.AttributeName,c.ENTITY.NODES,"",null,"dictAttributes.ID"),n){i=c.VALIDATION.DUPLICATE_ID;n.hasOwnProperty("isParent")&&n.isParent&&(i=c.VALIDATION.DUPLICATE_ID_IN_PARENT_ENTITY);t.attributeError=i;return}}else{t.attributeError="Error: "+c.VALIDATION.NOT_VALID_ID;return}else{t.attributeError="Error: Enter Attribute Name/Id.";return}if(!t.DataTypeInAttribute||t.DataTypeInAttribute=="Collection"){t.attributeError="Error: Enter Data Type.";return}};t.validateAttributeDailog()};n.SelectedObject="Collection";n.removeValueAttribute=function(){if(n.selectedItem!=undefined)if(n.selectedItem.dictAttributes.sfwType=="Column")alert("Column attribute cannot be deleted");else{var t=n.objAttributes.Elements.indexOf(n.selectedItem);t>-1&&confirm("Attribute : '"+n.selectedItem.dictAttributes.ID+"'   will be deleted, Do you want to continue?")&&(r.DeleteItem(n.selectedItem,n.objAttributes.Elements,"selectAttribute"),l.removeObjInToArray(n.validationErrorList,n.selectedItem));n.clearSelection();n.checkDuplicateId(!0);$("#tblAttribute").css("height","auto")}};n.updateValidation=function(t,i){t&&(i==="BEFORE"?l.removeObjInToArray(n.validationErrorList,t):i==="AFTER"&&(n.checkDuplicateId(!0),n.checkObjectFieldValue()))};n.isCodeIdAttribute=function(t){var i,u,r;return t&&t.dictAttributes&&t.dictAttributes.sfwValue&&t.dictAttributes.sfwValue.trim().length>0&&(i=t.dictAttributes.sfwValue.toLowerCase(),i.indexOf("_id")==i.length-3&&(i=i.substring(0,i.length-3)+"_value",u=function(n){return n.dictAttributes&&n.dictAttributes.sfwType&&n.dictAttributes.sfwType.toLowerCase()=="column"&&n.dictAttributes.sfwValue&&n.dictAttributes.sfwValue.toLowerCase()==i},r=n.objAttributes.Elements.filter(u),r&&r.length>0))?!0:!1};n.refreshColumns=function(){var t=getScopeByFileName("MainPage"),i;t&&t.strDBConnection&&t.strDBConnection==="DB : Not Connected."?toastr.error("Database not connected."):n.isDirty?alert("Please save the file before refresh"):(i=confirm("Refreshing the entity will update and save the file.Do you want to continue?"),i==!0&&(r.ClearUndoRedoListByFileName(n.currentfile.FileName),n.objEntity.dictAttributes.sfwTableName!=undefined&&n.objEntity.dictAttributes.sfwTableName!=""&&(r.IsLoading=!0,$.connection.hubEntityModel.server.refreshEntityTable(r.currentopenfile.file).done(function(t){var u=t,i;u&&u.lstCodeValues.length>0?(i=n.$new(),i.$evalAsync(function(){i.lstCodeValues=u.lstCodeValues}),i.title="Set Code IDs for Columns - "+n.objEntity.dictAttributes.ID,i.template="Entity/views/SetCodeIDForColumn.html",i.onOKClick=function(){var f,e,t,o;if(angular.forEach(u.EntityModel.Elements,function(n){if(n.Name=="attributes"){f=n;return}}),i.lstCodeValues)for(t=0;t<i.lstCodeValues.length;t++)f!=undefined&&angular.forEach(f.Elements,function(n){if(n.dictAttributes.sfwType==="Column"&&n.dictAttributes.sfwValue==i.lstCodeValues[t].FieldName){n.dictAttributes.sfwCodeID=i.lstCodeValues[t].CodeValue;return}});for(t=0;t<r.lstopenedfiles.length;t++)if(o=r.lstopenedfiles[t].file.FileName,o==r.currentopenfile.file.FileName){e=r.lstopenedfiles[t];break}n.refreshEntity(u);n.onSaveFile(u.EntityModel,e);i.closeDialog();n.receiveentitymodel(u.EntityModel)},i.onCancelClick=function(){n.refreshEntity(u);i.closeDialog()},i.closeDialog=function(){i.dialog&&i.dialog.close&&i.dialog.close()},i.dialog=r.showDialog(i,i.title,i.template)):n.refreshEntity(u);r.IsLoading=!1}))))};n.refreshEntity=function(t){n.$evalAsync(function(){var f=n.currentfile,i,u,r;if(t&&t.EntityModel)for(n.objEntity.dictAttributes.sfwTableName!=undefined&&(n.objEntity.dictAttributes.sfwDataObjectID=t.EntityModel.dictAttributes.sfwDataObjectID),i=0;i<t.EntityModel.Elements.length;i++)if(t.EntityModel.Elements[i].Name=="attributes"){u=t.EntityModel.Elements[i];n.objAttributes=[];r=h("filter")(n.objEntity.Elements,{Name:"attributes"})[0];angular.copy(u,r);n.objAttributes=r;n.RefreshIntellisenseAttributes(n.objAttributes);break}})};n.onSaveFile=function(n,t){n!=undefined&&r.SaveModelWithPackets(n,t.file,t.file.FileType,!1)};n.selectAttribute=function(t,i){n.clearSelection();n.selectedItem=t;i&&n.scrollToPosition("#attributes",".entity-dashboard-inner-section-container",n.selectedItem.dictAttributes.ID)};n.selectAttributedbclick=function(t){n.selectAttribute(t);n.selectAttributeTab();var i="";switch(t.dictAttributes.sfwType){case"Property":i="PROPERTIES";break;case"Column":case"Description":i="COLUMNS";break;case"Expression":i="EXPRESSION";break;case"Object":i="ONETOONE";break;case"List":case"CDOCollection":case"Collection":i="ONETOMANY"}v(function(){bt(i);n.activeGridRow=t})};n.ValidateExpression=function(t,i,u,f){var s=[],o,a,h,e;if(r.lstopenedfiles.length>0)for(e=0;e<r.lstopenedfiles.length;e++)r.lstopenedfiles[e].file&&(r.lstopenedfiles[e].file.FileType=="Entity"||r.lstopenedfiles[e].file.FileType=="RuleConstants")&&(o=getScopeByFileName(r.lstopenedfiles[e].file.FileName),o&&o.objEntity?(a=GetBaseModel(o.objEntity),s.push(a)):o&&o.constantfilemodel&&(a=GetBaseModel(o.constantfilemodel),s.push(a)));if(s&&s.length>0)if(h=JSON.stringify(s),h.length<32e3)$.connection.hubEntityModel.server.validateExpression(t,i,u,n.objEntity.dictAttributes.ID,f,h);else{var c="",l=[],v=0;for(e=0;e<h.length;e++)v++,c=c+h[e],v==32e3&&(v=0,l.push(c),c="");for(v!=0&&l.push(c),e=0;e<l.length;e++)$.connection.hubEntityModel.server.receiveDataPacketsForValidateExpr(t,i,u,n.objEntity.dictAttributes.ID,f,l[e],l.length,e)}};n.setExpression=function(t){var i=n.$new();i.isObjectBased=t.dictAttributes.sfwObjectBased&&t.dictAttributes.sfwObjectBased.toLowerCase()=="true";i.expression=t.dictAttributes.sfwValue;i.receiveValidateExpressionMsg=function(u){n.$evalAsync(function(){t&&(i.ValidationMessageForDisplay=u,r.UndRedoBulkOp("Start"),r.EditPropertyValue(t.dictAttributes.sfwValue,t.dictAttributes,"sfwValue",i.expression),r.EditPropertyValue(t.Error,t,"Error",u),r.UndRedoBulkOp("End"),u||i.closeDialog())})};i.onSaveClick=function(){var t="ScopeId_"+i.$id;n.ValidateExpression(i.expression,"False",!1,t)};i.onCancelClick=function(){t.Error||t.dictAttributes.sfwValue||(t.Error="Null or Empty expression.");i.closeDialog()};i.closeDialog=function(){i.dialog&&i.dialog.close&&i.dialog.close()};i.dialog=r.showDialog(i,"Set Expression","Entity/views/ExpressionEditorTemplate.html")};n.closeCollectionDialog=function(){if(n.isDialogOKClick=!1,openedDialogId!=""){ngDialog.close(openedDialogId);var t=n.objAttributes.Elements.indexOf(n.selectedElement);n.objAttributes.Elements[t]=n.temporaryElement;openedDialogId=""}};n.setIDPrefix=function(n,t){n.prefix=t;n.idWithoutPrefix=n.dictAttributes.ID?n.dictAttributes.ID.indexOf(t)==0?n.dictAttributes.ID.substring(t.length,n.dictAttributes.ID.length):n.dictAttributes.ID:""};n.onIdWithoutPrefixChanged=function(t,i,r){n.$evalAsync(function(){var n,e,u,f;t.dictAttributes.ID=t.prefix+t.idWithoutPrefix;n=nt();e=n.Elements.indexOf(i);r&&n.Elements.splice(e,1);u=l.findDuplicateId(n,t.dictAttributes.ID,c.ENTITY.NODES,"description",t,"dictAttributes.ID");u?(f=c.VALIDATION.DUPLICATE_ID,u.hasOwnProperty("isParent")&&u.isParent&&(f=c.VALIDATION.DUPLICATE_ID_IN_PARENT_ENTITY),t.errors.duplicate_id=f):t.errors&&delete t.errors.duplicate_id})};n.attributesMenuOptions=[["Navigate To Entity",function(t){n.NavigateToEntity(t.$parent.attribute.dictAttributes.sfwEntity)},function(){return!0}],];n.NavigateToEntity=function(t){t&&$.connection.hubMain.server.navigateToFile(t,"").done(function(n){r.openFile(n,!1)});n.closeCollectionDialog()};n.queryTypes=["","SelectQuery","SubSelectQuery","ScalarQuery","NonQuery"];n.queryDataTypes=["","bool","DateTime","decimal","double","float","int","long","short","string"];n.parameterTypes=["","int","long","string","decimal","DateTime","uniqueidentifier"];n.isMappedColumnSelectAllChecked=!1;n.isXmlFileChecked=!0;n.isCSFileChecked=!0;n.lstQueryGroups=[];n.lstQueryGroups.push("");n.filterByGroupName=function(t){n.filterproperty=t?"sfwGroupName":"ID"};n.UpdateGroupName=function(t){if(t){var r=!1;for(i=0;i<n.lstQueryGroups.length;i++)if(n.lstQueryGroups[i]==t){r=!0;break}r||n.lstQueryGroups.push(t)}};n.SelectEntityQuery=function(t){if(t!=undefined){var i=n.objQueries.Elements.indexOf(t);n.selectQuery(t,i)}};n.disableQueryDelete=function(){return n.selectedQuery==undefined||n.objQueries==undefined||n.objQueries.Elements.length==0?(n.selectedQuery=undefined,!0):!1};n.selectQueryEntityDashboard=function(t,i,r){n.clearSelection();n.objselectedQueryTab=n.lstDBQueryTypes[0];n.selectQuery(t,i,r)};n.selectQueryEntityDashboarddbclick=function(t){n.selectQueryEntityDashboard(t);n.IsQueriesOpen=!0;n.selectQueriesTab();var i="";n.selectedQuery.dictAttributes.sfwQueryType&&(i=n.selectedQuery.dictAttributes.sfwQueryType);i=="SelectQuery"?(n.isCustomMappingTab=!0,n.selectedQuery.dictAttributes.sfwDataType="EntityTable"):n.isCustomMappingTab=!1};n.clearSelection=function(){n.selectedItem=null;n.objConstraints.SelectedField=null;n.SelectedRule=null;n.SelectedCheckList=null;n.selectedQuery=null;n.clearValidationRuleSelection();n.clearBusinessObjectTabSelection();n.selectedDeleteProperty=null};n.showSelectedQueryInEditor=function(){var i,t,u,f;n.selectedQuery&&(n.objselectedQueryTab&&(t=n.objselectedQueryTab.Attribute,i=n.selectedQuery.dictAttributes[t]),i||(i=""),n.QueryEditor||(u="Queryeditor_"+n.objEntity.dictAttributes.ID,f=y(function(){if($("#"+u).length>0){n.QueryEditor=ace.edit(u);n.QueryEditor.getSession().setMode("ace/mode/sql");n.QueryEditor.setFontSize(13);n.QueryEditor.resize(!0);n.QueryEditor.getSession().setValue(i);n.setAutoCompleteForQuery(n.QueryEditor);n.QueryEditor.getSession().on("change",function(){n.strQueryValue=n.QueryEditor.getValue();n.QueryEditor.curOp&&n.QueryEditor.curOp.command.name&&(t=n.objselectedQueryTab.Attribute,n.currentQuery.dictAttributes.ID==n.selectedQuery.dictAttributes.ID&&n.strQueryValue!=n.selectedQuery.dictAttributes[t]&&n.$evalAsync(function(){r.EditPropertyValue(n.selectedQuery.dictAttributes[t],n.selectedQuery.dictAttributes,t,n.strQueryValue,"showSelectedQueryInEditor");n.IsExecuteQueryShow=n.selectedQuery.dictAttributes[t]&&n.selectedQuery.dictAttributes[t].trim().toLowerCase().indexOf("select")===0?!0:!1}))});n.currentQuery=n.selectedQuery;y.cancel(f)}},500)),n.QueryEditor&&(i!=n.QueryEditor.getValue()&&n.QueryEditor.getSession().setValue(i),n.currentQuery=n.selectedQuery))};n.setAutoCompleteForQuery=function(t){t.setOptions({enableBasicAutocompletion:!0});var i=0;n.staticWordCompleter={getCompletions:function(n,t,r,u,f){var e=["foo","bar","baz"];e.push("Test"+i++);f(null,e.map(function(n){return{caption:n,value:n,meta:""}}))}};t.completers=[n.staticWordCompleter]};n.selectedQuery=undefined;n.selectDBTypeTab=function(t){n.objselectedQueryTab=t;n.showSelectedQueryInEditor()};n.selectQuery=function(t,i,r){if(t!=undefined){n.selectedQuery&&(n.selectedQuery.objMappedColumns=null);n.clearSelection();var u=t.dictAttributes.sfwSql;!u&&t.dictAttributes.sfwOracle&&(u=t.dictAttributes.sfwOracle);n.IsExecuteQueryShow=!1;u&&u.trim().toLowerCase().indexOf("select")===0&&(n.IsExecuteQueryShow=!0)}if($(".list-items-queries").find(".popover").remove(),n.IsQueryReferencePopover=!1,n.selectedQuery=t,n.showSelectedQueryInEditor(),t!=undefined){n.selectedQueryName=n.objEntity.dictAttributes.ID+"."+n.selectedQuery.dictAttributes.ID;n.onQueryTypeChange(t.dictAttributes.sfwQueryType);n.isCustomMappingTab&&n.GetMappedColumns()}r&&(i&&i=="entity-queries-section"?n.scrollToPosition("#"+i,".page-sidebar-content",n.selectedQuery.dictAttributes.ID):n.scrollToPosition("#queries",".entity-dashboard-inner-section-subcontainer",n.selectedQuery.dictAttributes.ID))};n.ScrollToCurrentQuery=function(){var i,t;n.selectedQuery&&(i=document.getElementById(n.objEntity.dictAttributes.ID+"_"+n.selectedQuery.dictAttributes.ID),i?i.scrollIntoView():t=setInterval(function(){var i=document.getElementById(n.objEntity.dictAttributes.ID+"_"+n.selectedQuery.dictAttributes.ID);i&&(i.scrollIntoView(),t&&clearInterval(t));setTimeout(function(){t&&clearInterval(t)},5e3)},200))};n.selectQueryGroup=function(t,i,r,u){n.selectedQuery=t;n.selectQuery(t,r,u);i&&i.stopPropagation()};n.removeSelectedQuery=function(t){if(n.selectedQuery!=undefined&&confirm("Query : '"+n.selectedQuery.dictAttributes.ID+"'   will be deleted, Do you want to continue?")){r.UndRedoBulkOp("Start");var u=n.objQueries.Elements.indexOf(n.selectedQuery),f=!1;if(n.selectedQuery.dictAttributes.sfwGroupName){for(i=0;i<n.objQueries.Elements.length;i++)if(n.objQueries.Elements[i].dictAttributes.ID!=n.selectedQuery.dictAttributes.ID&&n.objQueries.Elements[i].dictAttributes.sfwGroupName==n.selectedQuery.dictAttributes.sfwGroupName){f=!0;break}f||r.DeleteItem(n.selectedQuery.dictAttributes.sfwGroupName,n.lstQueryGroups,!1)}r.DeleteItem(n.selectedQuery,n.objQueries.Elements,t);l.removeObjInToArray(n.validationErrorList,n.selectedQuery);!0&&(n.objQueries.Elements.length>0&&t?u!=-1&&(u!=0?(n.selectedQuery=n.objQueries.Elements[u-1],n.selectQuery(n.selectedQuery,u-1)):n.objQueries.Elements.length>0&&(n.selectedQuery=n.objQueries.Elements[u],n.selectQuery(n.selectedQuery,u))):n.clearSelection());r.UndRedoBulkOp("End");pt(!0)}};n.canDeleteQuery=function(){return n.objQueries&&n.objQueries.Elements.length>0?n.selectedQuery!=undefined:!1};n.ExpandCollapsedQueryGroup=function(n){n.IsExpanded=!n.IsExpanded};n.addNewQuery=function(t){var i=n.$new(!0),u,f;i.IsExecuteQueryShow=!1;n.IsExecuteQueryShow=!1;u=GetNewQueryName("NewQuery",n.objQueries,1);i.newQueryName=u;i.isEditQueryID=!1;i.queryError=undefined;f=r.showDialog(i,"Add Query Name","Entity/views/NewQueryTemplate.html",{width:500,height:180});i.validateQueryDailog=function(){if(i.queryError=undefined,i.newQueryName)if(isValidIdentifier(i.newQueryName)){var t=l.findDuplicateId(n.objEntity,i.newQueryName,c.ENTITY.NODES,"",null,"dictAttributes.ID");if(t){i.queryError=c.VALIDATION.DUPLICATE_ID;return}}else{i.queryError="Error:Invalid Query ID.";return}else{i.queryError="Error: Enter ID.";return}};i.setNewQueryDetails=function(){var u,f;if(!i.queryError){r.UndRedoBulkOp("Start");n.IsExecuteQueryShow=!1;u={};u.Name="query";u.dictAttributes={ID:"",sfwQueryType:"",sfwDataType:"",sfwSql:""};u.dictAttributes.ID=this.newQueryName;u.dictAttributes.sfwQueryType="SelectQuery";u.dictAttributes.sfwDataType="EntityTable";n.objEntity.dictAttributes.sfwTableName!=undefined&&(u.dictAttributes.sfwSql="select * from "+n.objEntity.dictAttributes.sfwTableName);u.Elements=[];f={};f.Value="";f.Name="parameters";f.Elements=[];f.dictAttributes={};u.Elements.push(f);r.PushItem(u,n.objQueries.Elements,"SelectEntityQuery");n.selectedQuery=u;n.onQueryTypeChange(u.dictAttributes.sfwQueryType);n.selectQuery(n.objQueries.Elements[n.objQueries.Elements.length-1],n.objQueries.Elements.length-1);t&&t=="entity-queries-section"?n.scrollToPosition("#"+t,".page-sidebar-content",u.dictAttributes.ID):n.scrollToPosition("#queries",".entity-dashboard-inner-section-subcontainer",u.dictAttributes.ID);i.closeNewQueryDialog();r.UndRedoBulkOp("End");n.$evalAsync(function(){var n=$("div.selected")[0];n&&$(".page-sidebar-content").scrollTo(n,null,null)})}};i.closeNewQueryDialog=function(){f.close()}};n.closeNewQueryDialog=function(){openedQueryDialogId!=undefined&&ngDialog.close(openedQueryDialogId);openedQueryDialogId=""};n.SelectedDashBoardRule="InitialLoad";n.setSelectedRuleFromDashBoard=function(t){n.SelectedDashBoardRule=t};n.SetSelectedValidationRule=function(t,i){n.clearSelection();n.SelectedRuleView="ValidationRules";n.SelectedRule=t;i&&n.scrollToPosition("#validations",".validation-panel-left",n.SelectedRule.dictAttributes.ID)};n.SetSelectedValidationRuledbclick=function(t){n.SetSelectedValidationRule(t);n.selectValidationRulesTab()};n.DeleteValidationRule=function(){n.SelectedRule!=undefined&&(n.$evalAsync(function(){r.IsLoading=!0}),$.connection.hubEntityModel.server.getRulesUsedInChildEntities(n.objEntity.dictAttributes.ID,n.SelectedRule.dictAttributes.ID).done(function(t){var f,e,o,i,u;n.$evalAsync(function(){r.IsLoading=!1});f="";e=t&&t.length>0?t[0]:n.SelectedRule;e&&(f=ht(e,"deleted"));f?alert(f):(o=confirm("Do you want to remove the selected rule '"+n.SelectedRule.dictAttributes.ID+"'from this section ?"),o==!0&&(i=n.GetParent(n.SelectedRule,n.objRules),i!=undefined&&(u=i.Elements.indexOf(n.SelectedRule),u>-1&&(r.DeleteItem(n.SelectedRule,i.Elements,"SelectValidationRules"),g(!0),l.removeObjInToArray(n.validationErrorList,n.SelectedRule),u<i.Elements.length?(n.SelectedRule=i.Elements[u],n.selectedRules(n.SelectedRule,null)):i.Elements.length>0?(n.SelectedRule=i.Elements[u-1],n.selectedRules(n.SelectedRule,null)):n.selectedRules(i,null)))))}))};n.setSelectedInitialLoadFromDashBoard=function(t,i,r){n.clearSelection();n.SelectedRuleView="ValidationRules";n.IsInitialLoadLoaded||(n.IsInitialLoadLoaded=!0);n.SelectedInitialLoadClick(t,undefined,i,r)};n.setSelectedInitialLoadFromDashBoarddbclick=function(t){n.setSelectedInitialLoadFromDashBoard(t);n.selectValidationRulesTab()};n.DeleteInitialLoadFromDashBoard=function(){n.DeleteRuleFromContextMenu(n.SelectedInitialLoad,"InitialLoad")};n.setSelectedHardErrorFromDashBoard=function(t,i,r){n.clearSelection();n.SelectedRuleView="ValidationRules";n.IsHardErrorLoaded||(n.IsHardErrorLoaded=!0);n.SelectHardError(t,i,r)};n.setSelectedHardErrorFromDashBoarddbclick=function(t){n.setSelectedHardErrorFromDashBoard(t);n.selectValidationRulesTab()};n.DeleteHardErrorFromDashBoard=function(){n.DeleteRuleFromContextMenu(n.SelectedHardError,"HardError")};n.setSelectedSoftErrorFromDashBoard=function(t,i,r){n.clearSelection();n.SelectedRuleView="ValidationRules";n.IsSoftErrorLoaded||(n.IsSoftErrorLoaded=!0);n.SelectSoftError(t,i,r)};n.setSelectedSoftErrorFromDashBoarddbclick=function(t){n.setSelectedSoftErrorFromDashBoard(t);n.selectValidationRulesTab()};n.DeleteSoftErrorFromDashBoard=function(){n.DeleteRuleFromContextMenu(n.SelectedSoftError,"SoftError")};n.setSelectedGroupFromDashBoard=function(t,i){n.clearSelection();n.SelectedRuleView="ValidationRules";n.IsGroupsLoaded||(n.IsGroupsLoaded=!0);n.SelectGroupClick(t,null,i)};n.setSelectedGroupFromDashBoarddbclick=function(t){n.setSelectedGroupFromDashBoard(t);n.selectValidationRulesTab()};n.DeleteGroupFromDashBoard=function(){n.DeleteRuleFromContextMenu(n.SelectedGroup,"Group")};n.setSelectedValidateDeleteFromDashBoard=function(t,i,r){n.clearSelection();n.SelectedRuleView="ValidationRules";n.IsValidateDeleteLoaded||(n.IsValidateDeleteLoaded=!0);n.SelectedValidateDeleteClick(t,undefined,i,r)};n.setSelectedValidateDeleteFromDashBoarddbclick=function(t){n.setSelectedValidateDeleteFromDashBoard(t);n.selectValidationRulesTab()};n.DeleteValidateDeleteFromDashBoard=function(){n.DeleteRuleFromContextMenu(n.SelectedValidateDelete,"ValidateDelete")};n.setSelectedCheckListFromDashBoard=function(t,i,r){n.clearSelection();n.SelectedRuleView="Checklist";n.IsCheckListLoaded||(n.IsCheckListLoaded=!0);i||(i=!1);n.SelectedCheckList=t;t.objRule&&t.objRule.dictAttributes&&i==!1&&n.SelectValidationRules(t.objRule);r&&n.scrollToPosition("#dsb-checklist",".entity-dashboard-inner-section-subcontainer",n.SelectedCheckList.dictAttributes.ID)};n.setSelectedCheckListFromDashBoarddbclick=function(t){n.selectValidationRulesTab();n.setSelectedCheckListFromDashBoard(t)};n.DeleteCheckListFromDashBoard=function(){n.DeleteRuleFromContextMenu(n.SelectedCheckList,"Checklist")};n.AddRuleFromDashBoard=function(){var t=n.$new(),i;t.RuleID="";t.isObjectBasedRule=!1;t.ExpressioninRule="";t.validationRuleError="Error: Enter ID.";i=r.showDialog(t,"Add Validation Rules","Entity/views/AddNewRule.html",{width:500,height:290});t.OnRuleTemplateCancelClick=function(){i.close()};t.validateValidationRuleDailog=function(){var r,f,i,u;if(t.validationRuleError=undefined,t.RuleID){if(r=null,n.objInheritedRules&&n.objInheritedRules.Elements&&(r=n.objInheritedRules),f=ut(r),i=l.findDuplicateId(f,t.RuleID,c.ENTITY.NODES,"",null,"dictAttributes.ID"),i){u=c.VALIDATION.DUPLICATE_ID;i.hasOwnProperty("isParent")&&i.isParent&&(u=c.VALIDATION.DUPLICATE_ID_IN_PARENT_ENTITY);t.validationRuleError=u;return}}else{t.validationRuleError="Error: Enter ID.";return}};t.onRuleTemplateOkClick=function(){if(this.RuleID!=""){var i={Children:[],dictAttributes:{ID:this.RuleID,sfwObjectBased:this.isObjectBasedRule,sfwExpression:this.ExpressioninRule,sfwRuleType:"Validation"},Elements:[],Name:"rule",Value:""};r.PushItem(i,n.objRules.Elements,"SelectValidationRules");n.SelectedRule=i;n.scrollToPosition("#validations",".validation-panel-left",i.dictAttributes.ID)}t.OnRuleTemplateCancelClick()}};n.refreshInheritedRules=function(){hubMain.server.getInheritedRule(n.objEntity.dictAttributes.ID,n.objEntity.dictAttributes.sfwParentEntity).done(function(t){t&&n.$evalAsync(function(){n.selectedIneritedTab="InheritedRule";n.objInheritedRules=t;n.objInheritedRules.Elements&&n.objInheritedRules.Elements.length>0?n.selectedRules(n.objInheritedRules.Elements[0]):n.selectedRules(undefined);n.objInheritedRules.Text="Rules";n.objInheritedRules.IsExpanded=!0;n.objInheritedRules&&n.objInheritedRules.Elements.length>0&&angular.forEach(n.objInheritedRules.Elements,function(t){n.LoadRulesDetails(t)})})})};n.RulesMenuOptions=[["Delete Rule",function(t){t.element!=undefined&&(n.SelectedRule=t.element,n.DeleteValidationRule())},function(n){if(n.element!=undefined)return n.element.Name=="rule"?!0:!1}],["Rename Rule",function(t){var u,i,f;t.element!=undefined&&(n.SelectedRule=t.element,u=ht(n.SelectedRule,"renamed"),u?alert(u):(i=n.$new(!0),i.selectedRule=t.element,i.objRules=n.objRules,i.selectedRule!=undefined&&(i.newRuleID=i.selectedRule.dictAttributes.ID,i.IsEdit=!0,f=r.showDialog(i,"Edit ID","Entity/views/AddRule.html",{width:500,height:180}),i.validateNewGroup=function(t){var r,f,o,u,e;if(i.groupErrorMessageForDisplay="",r="",t=="Group"?r=this.newGroupID.toLowerCase():t=="Rule"&&(r=this.newRuleID.toLowerCase()),r==undefined||r=="")return i.groupErrorMessageForDisplay="Error: ID cannot be empty.",!0;if(f=null,n.objInheritedRules&&n.objInheritedRules.Elements&&(f=n.objInheritedRules),o=ut(f),u=l.findDuplicateId(o,r,c.ENTITY.NODES,"item",n.SelectedRule,"dictAttributes.ID"),u){e=c.VALIDATION.DUPLICATE_ID;u.hasOwnProperty("isParent")&&u.isParent&&(e=c.VALIDATION.DUPLICATE_ID_IN_PARENT_ENTITY);i.groupErrorMessageForDisplay=e;return}return!1},i.addNewRule=function(){i.IsEdit&&(r.UndRedoBulkOp("Start"),n.SelectedRule.IsInitialLoad!=undefined&&n.SelectedRule.IsInitialLoad&&n.renameSubSectionRules(n.objInitialLoad,this.newRuleID),n.SelectedRule.IsHardError!=undefined&&n.SelectedRule.IsHardError&&n.renameSubSectionRules(n.objHardError,this.newRuleID),n.SelectedRule.IsSoftError!=undefined&&n.SelectedRule.IsSoftError&&n.renameSubSectionRules(n.objSoftError,this.newRuleID),n.SelectedRule.IsValidateDelete!=undefined&&n.SelectedRule.IsValidateDelete&&n.renameSubSectionRules(n.objValidateDelete,this.newRuleID),n.SelectedRule.IsCheckList!=undefined&&n.SelectedRule.IsCheckList&&n.renameSubSectionRules(n.objCheckList,this.newRuleID),n.SelectedRule.IsGroup!=undefined&&n.SelectedRule.IsGroup&&n.renameSubSectionRules(n.objGroupList,this.newRuleID),r.EditPropertyValue(n.SelectedRule.dictAttributes.ID,n.SelectedRule.dictAttributes,"ID",this.newRuleID),r.UndRedoBulkOp("End"));g(!0);i.closeNewRule()},i.closeNewRule=function(){i.IsEdit=!1;i.IsCopy=!1;f.close()})))},function(t){if(t.element!=undefined){if(t.element.Name=="rule")return n.SelectedRule=t.element,!0}else return!1}],null];n.menuoptionforexpression=[["Copy Expression",function(t){var i,u;t.$parent.attribute&&(n.Copiedexpression=t.$parent.attribute,i={},i.Value="",i.Name="attribute",i.Elements=[],u=n.Copiedexpression.dictAttributes.ID,n.Copiedexpression.dictAttributes.ID&&(u=GetNewQueryName(n.Copiedexpression.dictAttributes.ID,n.objAttributes,1)),i.dictAttributes={ID:u,sfwDataType:n.Copiedexpression.dictAttributes.sfwDataType,sfwDataFormat:n.Copiedexpression.dictAttributes.sfwDataFormat,sfwPrivate:n.Copiedexpression.dictAttributes.sfwPrivate,sfwValue:n.Copiedexpression.dictAttributes.sfwValue,sfwEnumerator:n.Copiedexpression.dictAttributes.sfwEnumerator,Text:n.Copiedexpression.dictAttributes.Text,sfwType:"Expression"},r.UndRedoBulkOp("Start"),r.PushItem(i,n.objAttributes.Elements,null),n.selectExpression(i,!0),r.UndRedoBulkOp("End"),n.validateId(n.objAttributes.Elements[n.objAttributes.Elements.length-1],u),n.setFocustoTextbox("attributesexpression",!0,n.objAttributes.Elements[n.objAttributes.Elements.length-1]))},function(){return!0}],null];ht=function(n,t){var i="";return n.IsInitialLoad?i="The selected Rule cannot be "+t+" because it is being used in Initial Load section of this or child entities.":n.IsHardError||n.IsHardErrorAsChild?i="The selected Rule cannot be "+t+" because it is being used in Hard Errors section of this or child entities.":n.IsSoftError||n.IsSoftErrorAsChild?i="The selected Rule cannot be "+t+" because it is being used in Soft Errors section of this or child entities.":n.IsValidateDelete?i="The selected Rule cannot be "+t+" because it is being used in Validate Delete section of this or child entities.":n.IsCheckList?i="The selected Rule cannot be "+t+" because it is being used in Check List section of this or child entities.":n.IsGroup&&(i="The selected Rule cannot be "+t+" because it is being used in Group List section of this or child entities."),i};n.onMessageIdChange=function(){if(n.SelectedRule&&(n.SelectedRule.dictAttributes.sfwMessageId="",n.SelectedRule.dictAttributes.sfwMessage="",n.SelectedRule.lstMessageParams=[]),n.SelectedRule.IsMessageSelected=="MessageID"){var t=n.objRules.Elements.filter(function(t){if(t&&t.dictAttributes.ID==n.SelectedRule.dictAttributes.ID)return t});t&&t.length&&n.validateEmptyMessageID(t[0])}else n.SelectedRule.IsMessageSelected=="Description"&&l.validateIsEmptyMessageIdAndDescription(n.SelectedRule,n.validationErrorList,n.SelectedRule.dictAttributes.sfwMessageId,n.SelectedRule.dictAttributes.sfwMessage)};n.selectedRulesTrack=[];n.selectedRules=function(t,i,r){t!=undefined?n.selectValidationRuleInAllTypes(t,r,""):n.SelectedRule=undefined;i!=null&&i.stopPropagation()};n.SelectValidationRules=function(t){var i=!1;t?(n.selectedIneritedTab="Rule",n.SelectedRule=t,n.SelectedRule.IsMessageSelected==undefined||n.SelectedRule.IsMessageSelected==""?n.SelectedRule.IsMessageSelected="MessageID":n.SelectedRule.dictAttributes.sfwMessageId!=undefined&&n.SelectedRule.dictAttributes.sfwMessageId!=""&&(n.SelectedRule.IsMessageSelected="MessageID"),n.SelectedRule.dictAttributes.sfwMessage!=undefined&&n.SelectedRule.dictAttributes.sfwMessage!=""&&(n.SelectedRule.IsMessageSelected="Description"),n.IsRule=t.Name=="rule"&&n.SelectedView=="ValidationRules"?!0:!1,angular.isArray(n.objRules.Elements)&&n.objRules.Elements.indexOf(t)>-1&&(i=!0),n.objInheritedRules&&n.objInheritedRules.Elements&&!i&&n.objInheritedRules.Elements.some(function(i){if(i.dictAttributes.ID==t.dictAttributes.ID)return n.selectedIneritedTab="InheritedRule",!0})):(n.SelectedRule=undefined,n.IsRule=!1)};n.onValidateExpression=function(){n.SelectedRule&&(n.SelectedRule.Error="",n.ValidateExpression(n.SelectedRule.dictAttributes.sfwExpression,n.SelectedRule.dictAttributes.sfwObjectBased,!0,""))};n.receiveValidateExpressionMsg=function(t){n.$evalAsync(function(){n.SelectedRule&&(n.SelectedRule.Error=t)})};n.SetClass=function(t,i){var r="";return t==i&&(r="active",r="selected"),(t.Name=="rule"||t.Name=="rules")&&n.objCut&&angular.equals(n.objCut,t)&&(r=r+" redforeground"),t.isAdvanceSearched&&(r=r+" bckgGrey"),t==i&&t.isAdvanceSearched&&(r=r+" bckgGreen"),r};n.SelectChildRuleView=function(t){t=="ValidationRules"?(n.SelectedRuleView=t,n.SelectedRule||n.objRules.Elements.length>0&&n.selectedRules(n.objRules.Elements[0])):t=="InitialLoad"?(n.IsInitialLoadLoaded||(n.IsInitialLoadLoaded=!0),n.SelectedInitialLoad||n.objInitialLoad.Elements.length>0&&n.SelectedInitialLoadClick(n.objInitialLoad.Elements[0])):t=="HardError"?(n.IsHardErrorLoaded||(n.IsHardErrorLoaded=!0),n.SelectedHardError||n.objHardError.Elements.length>0&&n.SelectHardError(n.objHardError.Elements[0])):t=="SoftError"?(n.IsSoftErrorLoaded||(n.IsSoftErrorLoaded=!0),n.SelectedSoftError||n.objSoftError.Elements.length>0&&n.SelectSoftError(n.objSoftError.Elements[0])):t=="ValidateDelete"?(n.IsValidateDeleteLoaded||(n.IsValidateDeleteLoaded=!0),n.SelectedValidateDelete||n.objValidateDelete.Elements.length>0&&n.SelectedValidateDeleteClick(n.objValidateDelete.Elements[0])):t=="Group"?(n.IsGroupsLoaded||(n.IsGroupsLoaded=!0),n.SelectedGroup||n.objGroupList.Elements.length>0&&n.SelectGroupClick(n.objGroupList.Elements[0])):t=="Checklist"&&(n.SelectedRuleView=t,n.IsCheckListLoaded||(n.IsCheckListLoaded=!0),n.SelectedCheckList||n.objCheckList.Elements.length>0&&n.SelectCheckListClick(n.objCheckList.Elements[0]));n.selectedIneritedTab&&n.selectedIneritedTab=="InheritedRule"&&(n.objInheritedRules&&n.objInheritedRules.Elements&&n.objInheritedRules.Elements.length>0?n.selectedRules(n.objInheritedRules.Elements[0],null):n.selectedRules(undefined,null))};n.selectRuleType=function(t,i){n.objRuleID.searchRuleByID="";n.objRuleID.selectedTypeID=n.objRuleID.lstTypeIds[0];n.selectValidationRuleInAllTypes(t,!0,"",i)};n.SelectedInitialLoadClick=function(t,i,r,u){n.objRuleID.searchRuleByID="";n.objRuleID.selectedTypeID=n.objRuleID.lstTypeIds[0];r||(r=!1);t!=undefined?(r||n.selectValidationRuleInAllTypes(t,!0,"InitialLoad"),n.SelectedInitialLoad=t,u&&r&&n.scrollToPosition("#dsb-initial-load",".entity-dashboard-inner-section-subcontainer",n.SelectedInitialLoad.dictAttributes.ID,{offsetTop:400})):n.SelectedInitialLoad=undefined;i!=undefined&&i!=null&&i.stopPropagation()};n.SelectSoftError=function(t,i,r){n.objRuleID.searchRuleByID="";n.objRuleID.selectedTypeID=n.objRuleID.lstTypeIds[0];i||(i=!1);t?(i||n.selectValidationRuleInAllTypes(t,!0,"SoftError"),n.SelectedSoftError=t,r&&i&&n.scrollToPosition("#dsb-softerror",".entity-dashboard-inner-section-subcontainer",n.SelectedSoftError.dictAttributes.ID,{offsetTop:400})):n.SelectedSoftError=undefined};n.SelectHardError=function(t,i,r){n.objRuleID.searchRuleByID="";n.objRuleID.selectedTypeID=n.objRuleID.lstTypeIds[0];i||(i=!1);t?(i||n.selectValidationRuleInAllTypes(t,!0,"HardError"),n.SelectedHardError=t,r&&i&&n.scrollToPosition("#dsb-harderror",".entity-dashboard-inner-section-subcontainer",n.SelectedHardError.dictAttributes.ID,{offsetTop:400})):n.SelectedHardError=undefined};n.SelectedErrorClick=function(t,i,r,u){t!=undefined&&(n.clearSelection(),r=="HardError"?n.SelectHardError(t,!1,u):r=="SoftError"&&n.SelectSoftError(t,!1,u));(i!=undefined||i!=null)&&i.stopPropagation()};n.SelectedValidateDeleteClick=function(t,i,r,u){n.objRuleID.searchRuleByID="";n.objRuleID.selectedTypeID=n.objRuleID.lstTypeIds[0];r||(r=!1);t!=undefined?(n.clearSelection(),r||n.selectValidationRuleInAllTypes(t,!0,"ValidateDelete"),n.SelectedValidateDelete=t,u&&r&&n.scrollToPosition("#dsb-validatedelete",".entity-dashboard-inner-section-subcontainer",n.SelectedValidateDelete.dictAttributes.ID,{offsetTop:400})):n.SelectedValidateDelete=undefined;(i!=undefined||i!=null)&&i.stopPropagation()};n.SelectGroupClick=function(t,i,r){n.objRuleID.searchRuleByID="";n.objRuleID.selectedTypeID=n.objRuleID.lstTypeIds[0];t!=undefined?(t.Name!="group"?n.clearSelection():t.Name=="group"&&(n.SelectedInitialLoad=undefined,n.SelectedHardError=undefined,n.SelectedSoftError=undefined,n.SelectedValidateDelete=undefined),t.Name!="group"&&n.selectValidationRuleInAllTypes(t,!0,"GroupList"),n.SelectedGroup=t,r&&n.scrollToPosition("#dsb-groups",".entity-dashboard-inner-section-subcontainer",n.SelectedGroup.dictAttributes.ID,{offsetTop:400})):n.SelectedGroup=undefined;(i!=undefined||i!=null)&&i.stopPropagation()};n.SelectCheckListClick=function(t,i,r){t!=undefined&&(n.clearSelection(),n.SelectedCheckList=t,t.objRule&&t.objRule.dictAttributes&&n.SelectValidationRules(t.objRule),r&&n.scrollToPosition("#rule-checklist",".page-sidebar-content",n.SelectedCheckList.dictAttributes.ID,{offsetTop:400}));(i!=undefined||i!=null)&&i.stopPropagation()};n.selectRuleDetailsFromInheritedRule=function(t){if(n.objInheritedRules&&n.objInheritedRules.Elements&&n.objInheritedRules.Elements.length>0)for(var i=0;i<n.objInheritedRules.Elements.length;i++)n.objInheritedRules.Elements[i].dictAttributes.ID==t.dictAttributes.ID&&(t.objRule=n.objInheritedRules.Elements[i],populateMessageByMessageID(t.objRule.dictAttributes.sfwMessageId,n.lstMessages,t.objRule,!1))};kt=function(t){var i;return angular.forEach(t.Elements,function(r){i==undefined&&(r.Name=="rules"||r.Name=="expressions"?i=kt(r):r.Name=="rule"&&r.dictAttributes.ID==n.objCut.dictAttributes.ID&&(i=t))}),i};n.LoadRulesForChild=function(t){angular.forEach(t,function(t){t.Name=="rules"?n.LoadRulesForChild(t.Elements):t.Name=="rule"&&n.LoadRulesDetails(t)})};n.LoadRulesDetails=function(t){if(angular.forEach(n.objInitialLoad.Elements,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(t.IsInitialLoad=!0,n.objRule=t)}),angular.forEach(n.objHardError.Elements,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(t.IsHardError=!0,n.objRule=t);angular.forEach(n.Children,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(t.IsHardErrorAsChild=!0,n.objRule=t)})}),angular.forEach(n.objSoftError.Elements,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(t.IsSoftError=!0,n.objRule=t);angular.forEach(n.Children,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(t.IsSoftErrorAsChild=!0,n.objRule=t)})}),angular.forEach(n.objValidateDelete.Elements,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(t.IsValidateDelete=!0,n.objRule=t)}),angular.forEach(n.objCheckList.Elements,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(t.IsCheckLisk=!0,n.objRule=t)}),angular.forEach(n.objGroupList.Elements,function(i){n.LoadDetailsForGroup(i,t)}),n.rulesUsedInChildEntities&&n.rulesUsedInChildEntities.length>0){var i=n.rulesUsedInChildEntities.filter(function(n){return n.RuleID===t.dictAttributes.ID});i&&i.length>0&&(t.IsInitialLoad=t.IsInitialLoad||i[0].IsInitialLoad,t.IsHardError=t.IsHardError||i[0].IsHardError,t.IsSoftError=t.IsSoftError||i[0].IsSoftError,t.IsValidateDelete=t.IsValidateDelete||i[0].IsValidateDelete,t.IsCheckList=t.IsCheckList||i[0].IsCheckList,t.IsGroup=t.IsGroup||i[0].IsGroupsList)}};n.LoadDetailsForGroup=function(t,i){angular.forEach(t.Elements,function(t){t.dictAttributes.ID==i.dictAttributes.ID&&(t.objRule=i,i.IsGroup=!0);t.Name=="group"&&n.LoadDetailsForGroup(t,i)})};n.populateMessageByMessageID=function(t,i,u){var s=!1,f,h,e,c,o;if(t&&t.trim().length>0&&(f=n.lstMessages.filter(function(n){return n.MessageID==t}),f&&f.length>0)){if(n.SelectedRule.displayMessage=f[0].DisplayMessage,n.getParameterByDescription(n.SelectedRule.displayMessage,u),f[0].SeverityValue=="I"?n.SelectedRule.severityValue="Information":f[0].SeverityValue=="E"?n.SelectedRule.severityValue="Error":f[0].SeverityValue=="W"&&(n.SelectedRule.severityValue="Warnings"),i&&n.SelectedRule.lstMessageParams)for(h=i.split(";"),e=0;e<n.SelectedRule.lstMessageParams.length;e++)c={Id:h[e]},n.SelectedRule.lstMessageParams[e]=c;else r.EditPropertyValue(n.SelectedRule.dictAttributes.sfwMessageParameters,n.SelectedRule.dictAttributes,"sfwMessageParameters","");s=!0}s||(n.SelectedRule.displayMessage="",n.SelectedRule.lstMessageParams=[],n.SelectedRule.severityValue="",o=n.objRules.Elements.filter(function(t){if(t&&t.dictAttributes.ID==n.SelectedRule.dictAttributes.ID)return t}),o&&o.length&&n.validateEmptyMessageID(o[0]));n.SelectedRule.errors||(n.SelectedRule.errors={});l.validateIsEmptyMessageIdAndDescription(n.SelectedRule,n.validationErrorList,n.SelectedRule.dictAttributes.sfwMessageId,n.SelectedRule.dictAttributes.sfwMessage);n.DeletePropertyFromObject("sfwMessageId")};n.populateMessageByMessageDescription=function(){r.EditPropertyValue(n.SelectedRule.dictAttributes.sfwMessageParameters,n.SelectedRule.dictAttributes,"sfwMessageParameters","");l.validateIsEmptyMessageIdAndDescription(n.SelectedRule,n.validationErrorList,n.SelectedRule.dictAttributes.sfwMessageId,n.SelectedRule.dictAttributes.sfwMessage)};n.getParameterByDescription=function(t,i){var e,u,f;if(t&&t.trim().length>0){for(e=ct(t),n.SelectedRule.lstMessageParams=[],i&&r.UndRedoBulkOp("Start"),u=0;u<e;u++)f={Id:""},i?r.PushItem(f,n.SelectedRule.lstMessageParams):n.SelectedRule.lstMessageParams.push(f);i&&r.UndRedoBulkOp("End")}else n.SelectedRule.lstMessageParams=[]};n.getParameter=function(){var i,t,u;if(n.SelectedRule&&(n.Message=n.SelectedRule.dictAttributes.sfwMessage,n.Message!=undefined)){for(i=ct(n.Message),n.SelectedRule.lstMessageParams=[],r.UndRedoBulkOp("Start"),t=0;t<i;t++)u={Id:""},r.PushItem(u,n.SelectedRule.lstMessageParams);r.UndRedoBulkOp("End")}};ct=function(n){for(var t=0,r=/{(.+?)}/g,i,u=[];i=r.exec(n);)u.push(i[1]),t++;return t};n.UpdateRuleParameter=function(t,i){if(i&&(i.Id=t),n.SelectedRule.lstMessageParams.length>0){var r="";angular.forEach(n.SelectedRule.lstMessageParams,function(n){n.Id!=undefined&&n.Id!=""&&(r=r==""?n.Id:r+";"+n.Id)});n.SelectedRule.dictAttributes.sfwMessageParameters=r}};n.CloseRule=function(t){r.EditPropertyValue(t.Id,t,"Id","");n.UpdateRuleParameter(t.Id,t)};n.OpenRuleDialog=function(){var t,i;n.newRuleID=GetNewStepName("NewRule",n.objRules,1);t=n.$new(!0);t.objRules=n.objRules;t.IsEdit=!1;t.IsCopy=!1;t.HeaderText="Add New Id";t.newRuleID=GetNewStepName("NewRule",t.objRules,1);i=r.showDialog(t,"Add New ID","Entity/views/AddRule.html",{width:500,height:180});t.validateNewGroup=function(i){var r,f,o,u,e;if(t.groupErrorMessageForDisplay="",r="",i=="Group"?r=this.newGroupID.toLowerCase():i=="Rule"&&(r=this.newRuleID.toLowerCase()),r==undefined||r=="")return t.groupErrorMessageForDisplay="Error: ID cannot be empty.",!0;if(f=null,n.objInheritedRules&&n.objInheritedRules.Elements&&(f=n.objInheritedRules),o=ut(f),u=l.findDuplicateId(o,r,c.ENTITY.NODES,"item",null,"dictAttributes.ID"),u){e=c.VALIDATION.DUPLICATE_ID;u.hasOwnProperty("isParent")&&u.isParent&&(e=c.VALIDATION.DUPLICATE_ID_IN_PARENT_ENTITY);t.groupErrorMessageForDisplay=e;return}return!1};t.addNewRule=function(){var i={Name:"rule",value:"",dictAttributes:{ID:this.newRuleID,sfwRuleType:"Validation",sfwObjectBased:"False"},Elements:[]},u;n.SelectedRule?(u=n.SelectedRule,n.SelectedRule.Name=="rule"&&(u=n.GetParent(n.SelectedRule,n.objRules)),u!=undefined&&(r.PushItem(i,u.Elements,"SelectValidationRules"),t.SelectedRule=i,n.selectedRules(t.SelectedRule,null),t.IsRule=!0)):(r.PushItem(i,n.objRules.Elements,"SelectValidationRules"),t.SelectedRule=i,n.selectedRules(t.SelectedRule,null),t.IsRule=!0);t.closeNewRule();t.IsEdit||(n.objInheritedRules?n.scrollToPosition("#validationrule",".inherited-rules-list",n.SelectedRule.dictAttributes.ID):n.scrollToPosition("#validationrule",".page-sidebar-content",n.SelectedRule.dictAttributes.ID))};t.closeNewRule=function(){t.IsEdit=!1;t.IsCopy=!1;i.close()};t.validateNewGroup("Rule")};n.renameSubSectionRules=function(t,i){for(var u=0;u<t.Elements.length;u++)t.Elements[u].dictAttributes.ID==n.SelectedRule.dictAttributes.ID&&r.EditPropertyValue(t.Elements[u].dictAttributes.ID,t.Elements[u].dictAttributes,"ID",i),t.Elements[u].Elements.length>0&&n.renameSubSectionRules(t.Elements[u],i)};n.OnCheckInitialLoad=function(t){if(t){if(n.SelectedRule!=undefined){var i={Name:"item",value:"",dictAttributes:{ID:n.SelectedRule.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[]};i.objRule=n.SelectedRule;r.PushItem(i,n.objInitialLoad.Elements);n.objRule&&angular.forEach(n.objRules.Elements,function(t){t.dictAttributes.ID==i.dictAttributes.ID&&(n.SelectedRule=t)})}}else angular.forEach(n.objInitialLoad.Elements,function(t){if(t.dictAttributes.ID==n.SelectedRule.dictAttributes.ID){var i=n.objInitialLoad.Elements.indexOf(t);i>-1&&r.DeleteItem(t,n.objInitialLoad.Elements)}})};n.OnCheckHardError=function(t){if(t){if(n.SelectedRule!=undefined){if((n.SelectedRule.dictAttributes.sfwMessageId==undefined||n.SelectedRule.dictAttributes.sfwMessageId=="")&&(n.SelectedRule.dictAttributes.sfwMessage==undefined||n.SelectedRule.dictAttributes.sfwMessage=="")){alert("Cannot add the selected rule to validation. Rule must contain MessageID/Description.");n.SelectedRule.IsHardError=!1;return}var i={Name:"item",value:"",dictAttributes:{ID:n.SelectedRule.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[],Children:[]};i.objRule=n.SelectedRule;r.PushItem(i,n.objHardError.Elements);n.objRules&&angular.forEach(n.objRules.Elements,function(t){t.dictAttributes.ID==i.dictAttributes.ID&&(n.SelectedRule=t)})}}else angular.forEach(n.objHardError.Elements,function(t){if(t.dictAttributes.ID==n.SelectedRule.dictAttributes.ID){var i=n.objHardError.Elements.indexOf(t);if(i>-1){if(t.Children&&t.Children.length>0){function u(t){n.CheckHardErrorAsChild(t)&&n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"HardErrorAsChild")}angular.forEach(t.Children,u)}r.DeleteItem(t,n.objHardError.Elements)}}})};n.OnCheckSoftError=function(t){if(t){if(n.SelectedRule!=undefined){if((n.SelectedRule.dictAttributes.sfwMessageId==undefined||n.SelectedRule.dictAttributes.sfwMessageId=="")&&(n.SelectedRule.dictAttributes.sfwMessage==undefined||n.SelectedRule.dictAttributes.sfwMessage=="")){alert("Cannot add the selected rule to validation. Rule must contain MessageID/Description.");n.SelectedRule.IsSoftError=!1;return}var i={Name:"item",value:"",dictAttributes:{ID:n.SelectedRule.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[],Children:[]};i.objRule=n.SelectedRule;r.PushItem(i,n.objSoftError.Elements);n.objRules&&angular.forEach(n.objRules.Elements,function(t){t.dictAttributes.ID==i.dictAttributes.ID&&(n.SelectedRule=t)})}}else angular.forEach(n.objSoftError.Elements,function(t){if(t.dictAttributes.ID==n.SelectedRule.dictAttributes.ID){var i=n.objSoftError.Elements.indexOf(t);if(i>-1){if(t.Children&&t.Children.length>0){function u(t){n.CheckSoftErrorAsChild(t)&&n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"SoftErrorAsChild")}angular.forEach(t.Children,u)}r.DeleteItem(t,n.objSoftError.Elements)}}})};n.OnCheckValidateDelete=function(t){if(t){if(n.SelectedRule!=undefined){if(n.SelectedRule.dictAttributes.sfwMessageId==undefined&&n.SelectedRule.dictAttributes.sfwMessage==undefined){alert("Cannot add the selected rule to validation. Rule must contain MessageID/Description.");n.SelectedRule.IsValidateDelete=!1;return}var i={Name:"item",value:"",dictAttributes:{ID:n.SelectedRule.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[]};i.objRule=n.SelectedRule;r.PushItem(i,n.objValidateDelete.Elements);n.objRules&&angular.forEach(n.objRules.Elements,function(t){t.dictAttributes.ID==i.dictAttributes.ID&&(n.SelectedRule=t)})}}else angular.forEach(n.objValidateDelete.Elements,function(t){if(t.dictAttributes.ID==n.SelectedRule.dictAttributes.ID){var i=n.objValidateDelete.Elements.indexOf(t);i>-1&&r.DeleteItem(t,n.objValidateDelete.Elements)}})};n.SetMessage=function(){n.objMessage!=undefined&&(n.SelectedRule.dictAttributes.sfwMessageId=n.objMessage.MessageID,n.SelectedRule.displayMessage=n.objMessage.DisplayMessage,n.objMessage.SeverityValue=="I"?n.SelectedRule.severityValue="Information":n.objMessage.SeverityValue=="E"?n.SelectedRule.severityValue="Error":n.objMessage.SeverityValue=="W"&&(n.SelectedRule.severityValue="Warnings"),ngDialog.close(SearchMessage))};n.OnSelectMessage=function(t){n.objMessage=t};n.CloseMessageDialog=function(){ngDialog.close(SearchMessage)};n.CheckSoftErrorAsChild=function(t){var i=!1;return angular.forEach(n.objSoftError.Elements,function(n){angular.forEach(n.Children,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(i=!0)})}),i};n.CheckHardErrorAsChild=function(t){var i=!1;return angular.forEach(n.objHardError.Elements,function(n){angular.forEach(n.Children,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(i=!0)})}),i};n.ErrorMenuOptionsForHardError=[["Add Child Rule",function(t){n.SelectedErrorRule=t.element;n.SelectedErrorRule!=undefined&&n.addRuleAsChild(n.SelectedErrorRule,"HardError")},function(t){if(t.element!=undefined&&t.element.Name=="item")return n.SelectedErrorClick(t.element,null,"HardError"),!0}],["Delete",function(t){n.SelectedErrorRule=t.element;n.SelectedErrorRule!=undefined&&n.DeleteRuleFromContextMenu(t.element,"HardError")},function(t){if(t.element!=undefined)return n.SelectedErrorClick(t.element,null,"HardError"),!0}],null];n.ErrorMenuOptionsForSoftError=[["Add Child Rule",function(t){n.SelectedErrorRule=t.element;n.SelectedErrorRule!=undefined&&n.addRuleAsChild(n.SelectedErrorRule,"SoftError")},function(t){if(t.element!=undefined&&t.element.Name=="item")return n.SelectedErrorClick(t.element,null,"SoftError"),!0}],["Delete",function(t){n.SelectedErrorRule=t.element;n.SelectedErrorRule!=undefined&&n.DeleteRuleFromContextMenu(t.element,"SoftError")},function(t){if(t.element!=undefined)return n.SelectedErrorClick(t.element,null,"SoftError"),!0}],null];n.addRuleAsChild=function(t,i){var u=n.$new(),f;u.lstValidationRule=[];n.objInheritedRules&&n.objInheritedRules.Elements&&g(n.objInheritedRules,!0);n.objRules&&n.objRules.Elements&&(u.lstValidationRule=angular.copy(n.objRules.Elements));n.objInheritedRules&&n.objInheritedRules.Elements&&(u.lstValidationRule=u.lstValidationRule.concat(angular.copy(n.objInheritedRules.Elements)));f=r.showDialog(u,"Add Child Rule","Entity/views/AddChildRule.html");u.onCancelClick=function(){f.close()};u.onAddChildRuleClick=function(){var s=u.lstValidationRule.filter(function(n){return n.IsSelected==!0});if(s.length>0){var f=null,e=null,o=null;if(angular.forEach(s,function(n){(n.dictAttributes.sfwMessageId==undefined||n.dictAttributes.sfwMessageId=="")&&(n.dictAttributes.sfwMessage==undefined||n.dictAttributes.sfwMessage=="")&&(f?f+=","+n.dictAttributes.ID:f=n.dictAttributes.ID);t.dictAttributes.ID==n.dictAttributes.ID&&(e?e+=","+n.dictAttributes.ID:e=n.dictAttributes.ID);t.dictAttributes.ID!=n.dictAttributes.ID&&t.Children&&angular.forEach(t.Children,function(t){t.dictAttributes.ID==n.dictAttributes.ID&&(o?o+=","+n.dictAttributes.ID:o=n.dictAttributes.ID)})}),f&&f.contains(",")){alert('Cannot add "'+f+'" rules to validation. Rules must contain MessageID/Description.');return}if(f){alert('Cannot add "'+f+'" rule to validation. Rule must contain MessageID/Description.');return}if(e){alert('Cannot add "'+e+'" rule to validation. Same rule already exists.');return}if(o){alert('Cannot add "'+o+'" rule to validation. Same Child rule already exists.');return}angular.forEach(s,function(u){var e=n.GetRuleByName(u.dictAttributes.ID),f={Name:"rule",value:"",dictAttributes:{ID:u.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[]};f.objRule=e;r.UndRedoBulkOp("Start");i=="SoftError"?(r.PushItem(f,t.Children,"SelectSoftError"),n.SelectSoftError(f),n.setValidationRuleCheckboxValue(u.dictAttributes.ID,!0,"SoftErrorAsChild")):i=="HardError"&&(r.PushItem(f,t.Children,"SelectHardError"),n.SelectHardError(f),n.setValidationRuleCheckboxValue(u.dictAttributes.ID,!0,"HardErrorAsChild"));r.EditPropertyValue(f.ParentID,f,"ParentID",t.dictAttributes.ID);r.UndRedoBulkOp("End")});u.onCancelClick()}}};n.setValidationRuleCheckboxValue=function(t,i,u){var e,f;e=n.selectedIneritedTab=="Rule"?getDescendents(n.objRules):getDescendents(n.objInheritedRules);f=e.filter(function(n){return n.Name=="rule"&&n.dictAttributes.ID==t});f&&f.length>0&&(u=="InitialLoad"?r.EditPropertyValue(f[0].IsInitialLoad,f[0],"IsInitialLoad",i):u=="ValidateDelete"?r.EditPropertyValue(f[0].IsValidateDelete,f[0],"IsValidateDelete",i):u=="HardError"?r.EditPropertyValue(f[0].IsHardError,f[0],"IsHardError",i):u=="HardErrorAsChild"?r.EditPropertyValue(f[0].IsHardErrorAsChild,f[0],"IsHardErrorAsChild",i):u=="SoftError"?r.EditPropertyValue(f[0].IsSoftError,f[0],"IsSoftError",i):u=="SoftErrorAsChild"?r.EditPropertyValue(f[0].IsSoftErrorAsChild,f[0],"IsSoftErrorAsChild",i):u=="CheckList"?r.EditPropertyValue(f[0].IsCheckList,f[0],"IsCheckList",i):u=="Group"&&r.EditPropertyValue(f[0].IsGroup,f[0],"IsGroup",i))};n.selectIneritedTab=function(t){n.selectedIneritedTab=t};n.AddGroupFromContextMenu=function(t,i,u){var f=n.$new(!0),e="";u?t.element!=undefined&&(n.selectedGroupRule=t.element,f.selectedGroupRule=t.element,f.selectedGroupIndex=t.$index,f.selectedGroupRule!=undefined&&(f.newGroupID=f.selectedGroupRule.dictAttributes.ID,f.objRules=n.objRules,f.objGroupList=n.objGroupList,f.IsGroupRename=!0,e=r.showDialog(f,"Edit ID","Entity/views/AddGroupRule.html",{width:500,height:180}))):(f.IsNewGroup=!0,f.SelectedRule=n.SelectedRule,f.objGroupList=n.objGroupList,f.newGroupID=GetNewStepName("NewGroup",f.objGroupList,1),e=r.showDialog(f,"Add New ID","Entity/views/AddGroupRule.html",{width:500,height:180}));f.addGroup=function(){if(f.IsGroupRename)r.UndRedoBulkOp("Start"),r.EditPropertyValue(f.selectedGroupRule.dictAttributes.ID,f.selectedGroupRule.dictAttributes,"ID",this.newGroupID),f.selectedGroupRule.Elements.length>0&&angular.forEach(f.selectedGroupRule.Elements,function(n){r.EditPropertyValue(n.ParentID,n,"ParentID",f.selectedGroupRule.dictAttributes.ID)}),r.UndRedoBulkOp("End");else if(f.IsNewGroup){var t={Name:"group",value:"",dictAttributes:{ID:this.newGroupID},Elements:[]};r.PushItem(t,f.objGroupList.Elements,"SelectGroupClick");n.SelectGroupClick(t)}g(!0);f.closeGroup();f.IsNewGroup=!1};f.validateNewGroup=function(n){var t,i;if(f.groupErrorMessageForDisplay="",t="",n=="Group"&&(t=this.newGroupID.toLowerCase()),t==undefined||t=="")return f.groupErrorMessageForDisplay="Error: ID cannot be empty.",!0;for(i=0;i<f.objGroupList.Elements.length;i++)if(u){if(f.objGroupList.Elements[i]!==f.selectedGroupRule&&f.objGroupList.Elements[i].dictAttributes.ID.toLowerCase()==t)return f.groupErrorMessageForDisplay="Error:Duplicate ID present. Please enter another ID.",!0}else if(f.objGroupList.Elements[i].dictAttributes.ID.toLowerCase()==t)return f.groupErrorMessageForDisplay="Error:Duplicate ID present. Please enter another ID.",!0;return!1};f.closeGroup=function(){e.close();f.IsGroupRename=!1;f.IsNewGroup=!1}};n.DeleteGroupFromContextMenu=function(t){var i,u;t.element!=undefined&&(n.selectedGroupRule=t.element,t.element.Name=="group"&&(i=confirm("Do you want to remove the selected Group '"+t.element.dictAttributes.ID+"'from this section ?"),i==!0&&(r.UndRedoBulkOp("Start"),n.selectedGroupRule.Elements.length>0&&angular.forEach(n.selectedGroupRule.Elements,function(t){n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"Group")}),u=n.objGroupList.Elements.indexOf(t.element),r.DeleteItem(t.element,n.objGroupList.Elements,"SelectGroupClick"),r.UndRedoBulkOp("End"))))};n.DeleteRuleFromContextMenu=function(t,i){var o,e,u,f;t!=undefined&&(o=confirm("Do you want to remove the selected rule '"+t.dictAttributes.ID+"'from this section ?"),o==!0&&(r.UndRedoBulkOp("Start"),t.Name=="item"?(e="SelectGroupClick",i=="Group"?u=n.GetParentForGroups(t,n.objGroupList):i=="Checklist"?(u=n.GetParent(t,n.objCheckList),e="SelectCheckListClick"):i=="InitialLoad"?(u=n.GetParent(t,n.objInitialLoad),e="SelectedInitialLoadClick"):i=="ValidateDelete"?(u=n.GetParent(t,n.objValidateDelete),e="SelectedValidateDeleteClick"):i=="HardError"?(u=n.GetParent(t,n.objHardError),e="SelectHardError"):i=="SoftError"&&(u=n.GetParent(t,n.objSoftError),e="SelectSoftError"),u!=undefined&&(f=u.Elements.indexOf(t),r.DeleteItem(t,u.Elements,e),l.removeObjInToArray(n.validationErrorList,t),g(!0),i=="Group"?(n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"Group"),f<u.Elements.length?n.SelectGroupClick(u.Elements[f],null):u.Elements.length>0?n.SelectGroupClick(u.Elements[f-1],null):n.SelectGroupClick(undefined,null)):i=="Checklist"?(n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"CheckList"),f<u.Elements.length?n.SelectCheckListClick(u.Elements[f],null):u.Elements.length>0?n.SelectCheckListClick(u.Elements[f-1],null):n.SelectCheckListClick(undefined,null)):i=="InitialLoad"?(n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"InitialLoad"),f<u.Elements.length?n.SelectedInitialLoadClick(u.Elements[f],null):u.Elements.length>0?n.SelectedInitialLoadClick(u.Elements[f-1],null):n.SelectedInitialLoadClick(undefined,null)):i=="ValidateDelete"?(n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"ValidateDelete"),f<u.Elements.length?n.SelectedValidateDeleteClick(u.Elements[f]):u.Elements.length>0?n.SelectedValidateDeleteClick(u.Elements[f-1]):n.SelectedValidateDeleteClick(undefined,null)):i=="HardError"?(n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"HardError"),f<u.Elements.length?n.SelectHardError(u.Elements[f]):u.Elements.length>0?n.SelectHardError(u.Elements[f-1]):n.SelectHardError(undefined,null),t.Children.length>0&&angular.forEach(t.Children,function(t){n.CheckHardErrorAsChild(t)||n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"HardErrorAsChild")})):i=="SoftError"&&(n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"SoftError"),f<u.Elements.length?n.SelectSoftError(u.Elements[f]):u.Elements.length>0?n.SelectSoftError(u.Elements[f-1]):n.SelectSoftError(undefined,null),t.Children.length>0&&angular.forEach(t.Children,function(t){n.CheckSoftErrorAsChild(t)||n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"SoftErrorAsChild")})))):t.Name=="rule"?i=="HardError"?(u=n.GetParentForErrors(t,n.objHardError),u!=undefined&&(f=u.Children.indexOf(t),f>-1&&(r.DeleteItem(t,u.Children,"SelectHardError"),f<u.Children.length?n.SelectHardError(u.Children[f]):u.Children.length>0?n.SelectHardError(u.Children[f-1]):n.SelectHardError(u),n.CheckHardErrorAsChild(t)||n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"HardErrorAsChild")))):i=="SoftError"&&(u=n.GetParentForErrors(t,n.objSoftError),u!=undefined&&(f=u.Children.indexOf(t),f>-1&&(r.DeleteItem(t,u.Children,"SelectSoftError"),f<u.Children.length?n.SelectSoftError(u.Children[f]):u.Children.length>0?n.SelectSoftError(u.Children[f-1]):n.SelectSoftError(u),n.CheckSoftErrorAsChild(t)||n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"SoftErrorAsChild")))):t.Name=="group"&&(t.Elements.length>0&&angular.forEach(t.Elements,function(t){n.setValidationRuleCheckboxValue(t.dictAttributes.ID,!1,"Group")}),f=n.objGroupList.Elements.indexOf(t),r.DeleteItem(t,n.objGroupList.Elements,"SelectGroupClick"),f<n.objGroupList.Elements.length?n.setSelectedGroupFromDashBoard(n.objGroupList.Elements[f]):n.objGroupList.Elements.length>0?n.setSelectedGroupFromDashBoard(n.objGroupList.Elements[f-1]):n.setSelectedGroupFromDashBoard(undefined)),r.UndRedoBulkOp("End")))};n.GroupMenuOptionsForInitialLoad=[["Delete Rule",function(t){n.DeleteRuleFromContextMenu(t.element,"InitialLoad")},function(t){if(t.element!=undefined)return t.element.Name=="item"?(n.SelectedInitialLoadClick(t.element),!0):!1}],null];n.GroupMenuOptionsForValidateDelete=[["Delete Rule",function(t){n.DeleteRuleFromContextMenu(t.element,"ValidateDelete")},function(t){if(t.element!=undefined)return t.element.Name=="item"?(n.SelectedValidateDeleteClick(t.element),!0):!1}],null];n.GroupMenuOptionsForGroups=[["Add Group",function(t){n.AddGroupFromContextMenu(t,-1,!1)},function(n){return n.element!=undefined?n.element.Name=="group"?!0:!1:!0}],["Delete Group",function(t){n.DeleteRuleFromContextMenu(t.element)},function(t){if(t.element!=undefined)return t.element.Name=="group"?(n.SelectGroupClick(t.element),!0):!1}],["Rename Group",function(t,i){n.AddGroupFromContextMenu(t,i,!0)},function(n){if(n.element!=undefined)return n.element.Name=="group"?!0:!1}],["Delete Rule",function(t){n.DeleteRuleFromContextMenu(t.element,"Group")},function(t){if(t.element!=undefined)return t.element.Name=="item"?(n.SelectGroupClick(t.element),!0):!1}],null];n.GroupMenuOptionsForCheckList=[["Delete Rule",function(t){n.DeleteRuleFromContextMenu(t.element,"Checklist")},function(t){if(t.element!=undefined)return t.element.Name=="item"?(n.SelectCheckListClick(t.element),!0):!1}],null];n.GetParent=function(t,i){var r;return i&&angular.forEach(i.Elements,function(u){if(r==undefined){if(n.result=angular.equals(u,t),n.result){r=i;return}if(r=n.GetParent(t,u),r!=undefined)return}}),r};n.GetParentForErrors=function(t,i){var r;return i&&(angular.forEach(i.Elements,function(u){if(r==undefined){if(n.result=angular.equals(u,t),n.result){r=i;return}if(r=n.GetParentForErrors(t,u),r!=undefined)return}}),r==undefined&&(r=n.GetParentFromChildenForErrors(t,i))),r};n.GetParentFromChildenForErrors=function(t,i){var r;return angular.forEach(i.Children,function(u){if(r==undefined){if(n.result=angular.equals(u,t),n.result){r=i;return}if(r=n.GetParentFromChildenForErrors(t,u),r!=undefined)return}}),r};n.GetParentForGroups=function(n,t){var r,i;return n.ParentID&&(i=t.Elements.filter(function(t){return t.dictAttributes.ID==n.ParentID}),i&&i.length>0&&(r=i[0])),r};n.setSelectedError=function(n,t){for(var r=n,i=0;i<n.Elements.length;i++)n.Elements[i].Name=="item"&&(n.Elements[i].isSelected=i==t?!0:!1)};n.canMoveErrorUp=function(t){if(t){var i=t.Elements.filter(function(n){return n.isSelected==!0});if(i&&i.length>0&&n.SelectedSoftError&&(n.SelectedRuleView=="SoftError"?n.SelectedSoftError.ParentID=="softerror":n.SelectedHardError.ParentID=="harderror"))return t.Elements.filter(function(n){return n.Name=="item"}).indexOf(i[0])>0}return!1};n.moveErrorUp=function(n){var u=n,t,i;if(n&&(t=n.Elements.filter(function(n){return n.isSelected==!0}),t&&t.length>0)){for(i=n.Elements.indexOf(t[0]),r.UndRedoBulkOp("Start"),r.DeleteItem(t[0],n.Elements);n.Elements[i-1].Name=="harderror"||n.Elements[i-1].Name=="softerror";)i--;r.InsertItem(t[0],n.Elements,i-1);r.UndRedoBulkOp("End")}};n.canMoveErrorDown=function(t){if(t){var i=t.Elements.filter(function(n){return n.isSelected==!0});if(i&&i.length>0&&n.SelectedSoftError&&(n.SelectedRuleView=="SoftError"?n.SelectedSoftError.ParentID=="softerror":n.SelectedHardError.ParentID=="harderror"))return t.Elements.filter(function(n){return n.Name=="item"}).indexOf(i[0])<t.Elements.filter(function(n){return n.Name=="item"}).length-1}return!1};n.moveErrorDown=function(n){var u=n,t,i;if(n&&(t=n.Elements.filter(function(n){return n.isSelected==!0}),t&&t.length>0)){for(i=n.Elements.indexOf(t[0]),r.UndRedoBulkOp("Start"),r.DeleteItem(t[0],n.Elements);n.Elements[i].Name=="harderror"||n.Elements[i].Name=="softerror";)i++;r.InsertItem(t[0],n.Elements,i+1);r.UndRedoBulkOp("End")}};n.onQueryTypeChange=function(t){var i=n.queryDataTypes.indexOf("EntityTable");i>0&&n.queryDataTypes.splice(i,1);t!=undefined&&t!=""&&(t=="SelectQuery"?(n.isCustomMappingTab=!0,n.queryDataTypes.push("EntityTable"),n.selectedQuery&&n.selectedQuery.dictAttributes&&(n.selectedQuery.dictAttributes.sfwDataType="EntityTable")):n.isCustomMappingTab=!1,t=="NonQuery"&&(n.selectedQuery.dictAttributes.sfwDataType="int"),t==="SubSelectQuery"&&(n.selectedQuery.dictAttributes.sfwDataType=""))};n.executeQuery=function(){var t,i;if(n.selectedQuery&&n.selectedQuery.dictAttributes[n.objselectedQueryTab.Attribute])if(t=n.selectedQuery.Elements.filter(function(n){return n.Name==="parameters"})[0],t&&t.Elements&&t.Elements.length){for(dialogScope=n.$new(),dialogScope.ExecutionParameters=[],i=0;i<t.Elements.length;i++){var u=t.Elements[i].dictAttributes.ID,f=t.Elements[i].dictAttributes.sfwDataType,e={Parameter:u,Type:f,Value:""};dialogScope.ExecutionParameters.push(e)}dialogScope.canExecuteQuery=function(){return!dialogScope.ExecutionParameters.some(function(n){return!(n.Value&&n.Value.trim().length>0)})};dialogScope.isExecuted=!1;dialogScope.isShowingTopRecords=!n.hasQueryTopClause(n.selectedQuery.dictAttributes[n.objselectedQueryTab.Attribute]);dialogScope.onOKClick=function(){var u,i,f;if(r.IsLoading=!0,u=undefined,n.selectedQuery.dictAttributes[n.objselectedQueryTab.Attribute]&&(u=n.selectedQuery.dictAttributes[n.objselectedQueryTab.Attribute]),t&&u&&t.Elements.length>0)for(i=0;i<dialogScope.ExecutionParameters.length;i++)f=dialogScope.ExecutionParameters[i].Parameter,u=dialogScope.ExecutionParameters[i].Type&&dialogScope.ExecutionParameters[i].Type.toLowerCase()=="int"||dialogScope.ExecutionParameters[i].Type.toLowerCase()=="decimal"?u.replace(new RegExp(f,"gi"),dialogScope.ExecutionParameters[i].Value):dialogScope.ExecutionParameters[i].Type&&dialogScope.ExecutionParameters[i].Type.toLowerCase()=="string"?u.replace(new RegExp(f,"gi"),"'"+dialogScope.ExecutionParameters[i].Value+"'"):u.replace(new RegExp(f,"gi"),dialogScope.ExecutionParameters[i].Value);n.executeQueryByLimit(u,50);dialogScope.closeDialog()};dialogScope.onCancelClick=function(){dialogScope.closeDialog()};dialogScope.closeDialog=function(){dialogScope.dialog&&dialogScope.dialog.close&&dialogScope.dialog.close()};n.showExecutionQueryDialog(dialogScope)}else n.executeQueryByLimit(n.selectedQuery.dictAttributes[n.objselectedQueryTab.Attribute],50);else alert("Query is missing in current tab.")};n.executeQueryByLimit=function(t,i){i&&(i=50);var u="";t=t.replace(/\n/g," ").replace(/\t/g," ").toLowerCase().trim();t.indexOf("select")>-1?(r.IsOracleDB?n.hasQueryTopClause(t)||(u=t+" fetch first {0} rows only"):n.hasQueryTopClause(t)||(u=t.substring(0,7)+" top {0} "+t.substring(7)),u=String.format(u,i),u&&u.trim().length>0||(u=t),$.connection.hubEntityModel.server.executeQuery(u).done(function(t){n.receieveExecuteAllQueries(t)})):toastr.error("Not a select query")};n.hasQueryTopClause=function(n){return n=n.replace(/\n/g," ").replace(/\t/g," ").toLowerCase().trim(),r.IsOracleDB?n.indexOf(" fetch ")>-1:n.indexOf(" top ")>-1};n.receieveExecuteAllQueries=function(t){n.$evalAsync(function(){var i=n.$new();r.IsLoading=!1;i.EntityExecuteQueryData=t;i.isExecuted=!0;i.isShowingTopRecords=!n.hasQueryTopClause(n.selectedQuery.dictAttributes[n.objselectedQueryTab.Attribute]);n.showExecutionQueryDialog(i)})};n.showExecutionQueryDialog=function(n){n.title="Execute Query";n.template="Entity/views/ExecuteQuery.html";n.dialog=r.showDialog(n,n.title,n.template,{width:800,height:400})};var it="",lt="",dt=function(t){if(t=="copy"){r.UndRedoBulkOp("Start");var i=GetBaseModel(it);i.dictAttributes.ID=GetNewQueryName("NewQuery",n.objQueries,1);r.PushItem(i,n.objQueries.Elements,"SelectEntityQuery");n.selectedQuery=i;n.selectQuery(n.selectedQuery,0);r.UndRedoBulkOp("End")}it=""};n.QueryPasteMenuOption=[["Paste",function(){dt(lt)},function(){return it!=""}]];n.queryMenuOptions=[["Rename",function(){var t,i,u;n.newQueryName=n.selectedQuery.dictAttributes.ID;t=n.$new(!0);t.IsExecuteQueryShow=!1;n.IsExecuteQueryShow=!1;i=n.selectedQuery.dictAttributes.ID;t.newQueryName=i;n.newQueryName=n.selectedQuery.dictAttributes.ID;t.isEditQueryID=!0;u=r.showDialog(t,"Rename Query Name","Entity/views/NewQueryTemplate.html",{width:500,height:180});t.validateQueryDailog=function(){if(t.queryError=undefined,t.newQueryName)if(isValidIdentifier(t.newQueryName)){var i=l.findDuplicateId(n.objEntity,t.newQueryName,c.ENTITY.NODES,null,n.selectedQuery,"dictAttributes.ID");if(i){t.queryError=c.VALIDATION.DUPLICATE_ID;return}}else{t.queryError="Error:Invalid Query ID.";return}else{t.queryError="Error: Enter ID.";return}};t.setNewQueryDetails=function(){if(r.UndRedoBulkOp("Start"),n.IsExecuteQueryShow=!1,t.isEditQueryID==!0){var i=n.objQueries.Elements.indexOf(n.selectedQuery);r.EditPropertyValue(n.objQueries.Elements[i].dictAttributes.ID,n.objQueries.Elements[i].dictAttributes,"ID",this.newQueryName);r.EditPropertyValue(n.selectedQueryName,n,"selectedQueryName",n.objEntity.dictAttributes.ID+"."+n.objQueries.Elements[i].dictAttributes.ID)}t.closeNewQueryDialog();r.UndRedoBulkOp("End");pt(!0)};t.closeNewQueryDialog=function(){u.close()}},function(){return n.objQueries!=undefined}],["Delete",function(){n.removeSelectedQuery("SelectEntityQuery")},function(){return n.objQueries!=undefined}],["Copy",function(){it=n.selectedQuery;lt="copy"},function(t){return t.objQueries!=undefined&&t.objQueries.dictAttributes.ID!=""&&t.objQueries.Name=="query"||t.objQueries.Name=="queries"&&n.selectedQuery.Name!="group"}],["Paste",function(){dt(lt)},function(){return it!=""}],["Find Reference(s)",function(t,i){var r=$(i.currentTarget),e,o,s;if(r[0]){e=n.objEntity.dictAttributes.ID+"_"+n.selectedQuery.dictAttributes.ID;k.resetData();n.IsQueryReferencePopover=!0;n.$searchFindReferences=undefined;$(r[0]).data("bs.popover")&&$(r[0]).popover("destroy");$("body").find(".findReferences-floating-btn").remove();o='<div class="find-reference-popover popover"><div class="arrow"><\/div><div class="popover-content pull-left" onclick="stopEventPropagationConditional(event)"><\/div><\/div>';$(r[0]).popover({trigger:"manual",animation:!0,html:!0,template:o,content:b("<loading-box lazymodel='$searchFindReferences' size='xs'><\/loading-box>")(n)});$(r[0]).popover("show");var u=$(r[0]).closest("#"+e).find(".popover")[0],h=$(window).height(),f=$(r[0]).closest(".list-items-queries");f&&f.length>0&&f[0]&&$(r[0]).width()>$(f[0]).width()&&$(u).css("left",$(u).position().left-($(u).position().left-$(f[0]).width())+"px");s=k.get(n.selectedQueryName,"Query");s.done(function(t){var o,s,i,c,l;t&&t.length>0?(k.setData("Query",t,null),n.$searchFindReferences=k.getData,o=$(r[0]).data("bs.popover"),o&&(o.options.content=b("<find-referencebox><\/find-referencebox>")(n),$(r[0]).popover("show"),s=6,i=t.length<=s?t.length*32+20:s*32+20,f&&f.length>0&&f[0]&&$(r[0]).width()>$(f[0]).width()&&$(u).css("left",$(u).position().left-($(u).position().left-$(f[0]).width())+"px"),h<$(u)[0].getBoundingClientRect().top+i+40&&(c=$(u).find(".arrow")[0],l=$(c).position().top,$(c).css("top",l+i-30+"px"),$(u).css("top",$(u).position().top-i+10+"px")))):($(r[0]).closest("#"+e).find(".popover").remove(),toastr.warning("No reference found"))})}return!0},function(t){return t.objQuery.dictAttributes.ID==n.selectedQuery.dictAttributes.ID}]];n.closeFindReferencesPopover=function(t){n.IsQueryReferencePopover?$(t.currentTarget).closest(".popover").remove():n.triggerFloatingFind(t)};n.triggerFindReferences=function(t,i){var u=n.$searchFindReferences.ReferenceValue.split("."),f=$(i.currentTarget).closest("#"+u[0]+"_"+u[1]).find(".popover"),e,o;f&&($(f).remove(),n.IsQueryReferencePopover=!1,$("body").find(".findReferences-floating-btn").length<=0?(e='<span class="findReferences-floating-btn" filename="{{currentfile.FileName}}" data-toggle="popover" ng-click="triggerFloatingFind($event)"><i class="fa fa-times-circle-o" data-role="close-button" aria-hidden="true" ng-click="triggerFloatingFind($event)"><\/i><\/span>',$("body").append(b(e)(n)),o=b('<find-referencebox onclick="stopEventPropagationConditional(event)"><\/find-referencebox>')(n),$("body").find(".findReferences-floating-btn").append(o),v(function(){k.setData(null,null,t);r.openFile(t.FileInfo,!1)},600)):(k.setData(null,null,t),r.openFile(t.FileInfo,!1),$("body").find(".floating-reference-box").removeClass("showref")))};n.triggerFloatingFind=function(n){n&&$(n.currentTarget).attr("data-role")==="close-button"?($("body").find(".findReferences-floating-btn").remove(),n.stopPropagation()):$("body").find(".floating-reference-box").toggleClass("showref")};n.validateParentKeyValue=function(){n.objEntity.dictAttributes.sfwErrorTable&&!n.objEntity.dictAttributes.sfwParentKeyValue?l.checkValidListValue([],n.objEntity,n.objEntity.dictAttributes.sfwParentKeyValue,"sfwParentKeyValue","sfwParentKeyValue","Parent Key Value for Error Table cannot be empty.",n.validationErrorList,!0):n.objEntity.dictAttributes.sfwErrorTable&&n.objEntity.dictAttributes.sfwParentKeyValue?n.objEntity.errors&&n.objEntity.errors.sfwParentKeyValue&&(n.objEntity.errors.sfwParentKeyValue=undefined):!n.objEntity.dictAttributes.sfwErrorTable&&n.objEntity.errors&&(n.objEntity.errors.sfwParentKeyValue=undefined)};n.validateStatusValue=function(){n.objEntity.dictAttributes.sfwErrorTable&&!n.objEntity.dictAttributes.sfwStatusColumn?l.checkValidListValue([],n.objEntity,n.objEntity.dictAttributes.sfwStatusColumn,"sfwStatusColumn","sfwStatusColumn","Status Column for Error Table cannot be empty.",n.validationErrorList,!0):n.objEntity.dictAttributes.sfwErrorTable&&n.objEntity.dictAttributes.sfwStatusColumn?n.objEntity.dictAttributes.errors&&n.objEntity.dictAttributes.errors.sfwStatusColumn&&(n.objEntity.dictAttributes.errors.sfwStatusColumn=undefined):!n.objEntity.dictAttributes.sfwErrorTable&&n.objEntity.dictAttributes.errors&&(n.objEntity.dictAttributes.errors.sfwStatusColumn=undefined)};n.onDetailClick=function(){var t=n.$new(),i;t.SelectedEntityDetailsDialogTab="Details";t.objExtraFields=[];t.ID=undefined;t.objDummy=[];t.objVisibility={};t.showExtraFieldsTab=!1;t.formName="Entity";t.objDirFunctions={};t.objEntityDetails={};t.objEntityID=n.objEntity.dictAttributes.ID;t.objEnitityDescription=n.objEntity.dictAttributes.Text;t.strParentEntity=n.objEntity.dictAttributes.sfwParentEntity;t.objEntityTableName=n.objEntity.dictAttributes.sfwTableName;t.objEnitityAS400=n.objEntity.dictAttributes.sfwAS400Library;t.objEnitityDatabaseName=n.objEntity.dictAttributes.sfwDatabase;t.objHistoryEnabled=n.objEntity.dictAttributes.sfwHistoryEnabled;t.objVisibility.showInputTableName=!1;t.blnShowCreateWithClass=n.blnShowCreateWithClass;t.objEntityDetails.sfwMainCDO=n.objEntity.dictAttributes.sfwMainCDO;t.objEntityDetails.sfwErrorTable=n.objEntity.dictAttributes.sfwErrorTable;t.objEntityDetails.sfwParentKey=n.objEntity.dictAttributes.sfwParentKey;t.objEntityDetails.sfwParentKeyValue=n.objEntity.dictAttributes.sfwParentKeyValue;t.objEntityDetails.sfwStatusColumn=n.objEntity.dictAttributes.sfwStatusColumn;t.objEntityDetails.sfwExpressionTable=n.objEntity.dictAttributes.sfwExpressionTable;t.objEntityDetails.sfwReadOnlyRule=n.objEntity.dictAttributes.sfwReadOnlyRule;t.objEntityDetails.sfwChecklistId=n.objEntity.dictAttributes.sfwChecklistId;t.objEntityDetails.sfwChecklistTable=n.objEntity.dictAttributes.sfwChecklistTable;t.objEntityDetails.sfwActive=n.objEntity.dictAttributes.sfwActive;t.objEntityBusinessObject=n.objEntity.dictAttributes.sfwObjectID;t.objEntityDetails.hasOwnProperty("sfwReadOnlyRule")&&t.objEntityDetails.sfwReadOnlyRule&&(i=l.getListByPropertyName(n.objInitialLoad.Elements,"ID"),l.checkValidListValue(i,t.objEntityDetails,t.objEntityDetails.sfwReadOnlyRule,"sfwReadOnlyRule","sfwReadOnlyRule",c.VALIDATION.INVALID_FIELD,n.validationErrorList));t.cdoChange=function(i){var f=i,r,u;f.sfwMainCDO?(r=n.tableObjects.filter(function(n){if(n)return n===i.sfwMainCDO}),r.length<=0?(u=c.VALIDATION.INVALID_FIELD,t.objEntityDetails.errors||(t.objEntityDetails.errors={}),t.objEntityDetails.errors.inValid_id=u,delete t.objEntityDetails.errors.sfwMainCDO,delete t.objEntityDetails.errors.empty_id):(delete t.objEntityDetails.errors.sfwMainCDO,t.objEntityDetails.errors.inValid_id="",t.objEntityDetails.errors.empty_id="")):l.checkValidListValue(n.tableObjects,t.objEntityDetails,t.objEntityDetails.sfwMainCDO,"sfwMainCDO","sfwMainCDO",c.VALIDATION.EMPTY_FIELD,n.validationErrorList,!0)};t.objEntityDetails.sfwMainCDO||t.objEntityBusinessObject==undefined||t.objEntityBusinessObject==""||t.cdoChange(t.objEntityDetails);t.checkValidBusinessObject=function(){t.objEntityBusinessObject==undefined||t.objEntityBusinessObject==""?t.IsValidBO=!1:t.lstBusinessObject&&!t.lstBusinessObject.some(function(n){return n.ID==t.objEntityBusinessObject})?(t.EntityDetailsErrorMessage="Error: Invalid Business Object.",t.IsCircular=!1,t.IsValidBO=!1,n.blnShowBusinessObjectSection=!1):t.IsValidBO=!0};r.IsLoading=!0;hubMain.server.getTableIntellisense().done(function(i){n.$apply(function(){if(r.IsLoading=!1,t.lstMainTable=i,t.lstBusinessObject=n.lstBusinessObject,n.blnShowCreateWithClass&&t.checkValidBusinessObject(),t.objEntityTableName==undefined||t.objEntityTableName=="")t.objVisibility.showInputTableName=!0;else{var u=t.objEntityTableName;t.lstMainTable&&!t.lstMainTable.some(function(n){return n.ID&&n.ID.toLowerCase()==u.toLowerCase()})&&(t.EntityDetailsErrorMessage="Error: Invalid Table Name",t.objVisibility.showInputTableName=!0,t.IsCircular=!1)}})});t.checkValidEntityInheritence=function(){t.strParentEntity&&hubMain.server.checkValidParentEntity(t.objEntityID,t.strParentEntity).done(function(n){t.$evalAsync(function(){t.IsCircular=!n;t.validateEntityDetails()})})};t.receiveExtraSettingsModel=function(i){n.$apply(function(){t.objCustomSettings=i;for(var n=0;n<t.objCustomSettings.Elements.length;n++)if(t.objCustomSettings.Elements[n].Name=="Entity"){t.temp=t.objCustomSettings.Elements[n];break}})};t.setEntityDetails=function(){r.UndRedoBulkOp("Start");r.EditPropertyValue(n.objEntity.dictAttributes.ID,n.objEntity.dictAttributes,"ID",t.objEntityID);r.EditPropertyValue(n.objEntity.dictAttributes.Text,n.objEntity.dictAttributes,"Text",t.objEnitityDescription);r.EditPropertyValue(n.objEntity.dictAttributes.sfwTableName,n.objEntity.dictAttributes,"sfwTableName",t.objEntityTableName);r.EditPropertyValue(n.objEntity.dictAttributes.sfwObjectID,n.objEntity.dictAttributes,"sfwObjectID",t.objEntityBusinessObject);r.EditPropertyValue(n.objEntity.dictAttributes.sfwMainCDO,n.objEntity.dictAttributes,"sfwMainCDO",t.objEntityDetails.sfwMainCDO);r.EditPropertyValue(n.objEntity.dictAttributes.sfwErrorTable,n.objEntity.dictAttributes,"sfwErrorTable",t.objEntityDetails.sfwErrorTable);r.EditPropertyValue(n.objEntity.dictAttributes.sfwParentKey,n.objEntity.dictAttributes,"sfwParentKey",t.objEntityDetails.sfwParentKey);r.EditPropertyValue(n.objEntity.dictAttributes.sfwParentKeyValue,n.objEntity.dictAttributes,"sfwParentKeyValue",t.objEntityDetails.sfwParentKeyValue);r.EditPropertyValue(n.objEntity.dictAttributes.sfwStatusColumn,n.objEntity.dictAttributes,"sfwStatusColumn",t.objEntityDetails.sfwStatusColumn);r.EditPropertyValue(n.objEntity.dictAttributes.sfwExpressionTable,n.objEntity.dictAttributes,"sfwExpressionTable",t.objEntityDetails.sfwExpressionTable);r.EditPropertyValue(n.objEntity.dictAttributes.sfwReadOnlyRule,n.objEntity.dictAttributes,"sfwReadOnlyRule",t.objEntityDetails.sfwReadOnlyRule);r.EditPropertyValue(n.objEntity.dictAttributes.sfwChecklistId,n.objEntity.dictAttributes,"sfwChecklistId",t.objEntityDetails.sfwChecklistId);r.EditPropertyValue(n.objEntity.dictAttributes.sfwChecklistTable,n.objEntity.dictAttributes,"sfwChecklistTable",t.objEntityDetails.sfwChecklistTable);r.EditPropertyValue(n.objEntity.dictAttributes.sfwActive,n.objEntity.dictAttributes,"sfwActive",t.objEntityDetails.sfwActive);r.EditPropertyValue(n.objEntity.dictAttributes.sfwDatabase,n.objEntity.dictAttributes,"sfwDatabase",t.objEnitityDatabaseName);r.EditPropertyValue(n.objEntity.dictAttributes.sfwAS400Library,n.objEntity.dictAttributes,"sfwAS400Library",t.objEnitityAS400);r.EditPropertyValue(n.objEntity.dictAttributes.sfwParentEntity,n.objEntity.dictAttributes,"sfwParentEntity",t.strParentEntity);r.EditPropertyValue(n.objEntity.dictAttributes.sfwHistoryEnabled,n.objEntity.dictAttributes,"sfwHistoryEnabled",t.objHistoryEnabled);t.EntityDetailsErrorMessage="";var i=n.objEntity.dictAttributes.sfwParentEntity;t.strParentEntity&&t.strParentEntity!=""?hubMain.server.getInheritedRule(t.objEntityID,t.strParentEntity).done(function(i){i==null?t.$evalAsync(function(){t.IsCircular=!0;r.EditPropertyValue(n.objEntity.dictAttributes.sfwParentEntity,n.objEntity.dictAttributes,"sfwParentEntity","");t.validateEntityDetails()}):(n.$evalAsync(function(){n.selectedIneritedTab="InheritedRule";n.objInheritedRules=i;n.SelectedView==="ValidationRules"&&(n.objInheritedRules.Elements&&n.objInheritedRules.Elements.length>0?n.selectedRules(n.objInheritedRules.Elements[0]):n.selectedRules(undefined));n.objInheritedRules.Text="Rules";n.objInheritedRules.IsExpanded=!0;n.objInheritedRules&&n.objInheritedRules.Elements.length>0&&angular.forEach(n.objInheritedRules.Elements,function(t){n.LoadRulesDetails(t)})}),t.closeEntityDetails())}):n.objInheritedRules&&n.$evalAsync(function(){n.objInheritedRules=undefined;n.selectedIneritedTab="Rule";n.objRules.Elements.length>0&&n.SelectedView==="ValidationRules"&&n.selectedRules(n.objRules.Elements[0],null)});t.objDirFunctions.prepareExtraFieldData();r.UndRedoBulkOp("End");t.IsCircular||t.strParentEntity||t.closeEntityDetails();n.objEntity.dictAttributes.sfwObjectID&&(n.blnShowBusinessObjectSection=!0)};t.validateEntityDetails=function(){var r,i,u,f,e;return(t.EntityDetailsErrorMessage="",!t.IsValidBO&&t.objEntityBusinessObject&&t.lstBusinessObject&&!t.lstBusinessObject.some(function(n){return n.ID==t.objEntityBusinessObject})&&(t.EntityDetailsErrorMessage="Error: Invalid Business Object.",t.IsCircular=!1,t.IsValidBO=!1,n.blnShowBusinessObjectSection=!1),t.objVisibility.showInputTableName||(r=t.objEntityTableName,t.lstMainTable&&!t.lstMainTable.some(function(n){return n.ID&&r&&n.ID.toLowerCase()==r.toLowerCase()})&&(t.EntityDetailsErrorMessage="Error: Invalid Table Name",t.objVisibility.showInputTableName=!0,t.IsCircular=!1)),i=o.getEntityIntellisense(),u=this.strParentEntity,this.strParentEntity&&!i.some(function(n){return n.ID==u})&&(t.EntityDetailsErrorMessage="Error: Invalid Parent Entity",t.IsCircular=!1),this.strParentEntity&&t.objEntityTableName&&i&&(f=i.filter(function(n){return n.ID==u}),f.length>0&&f[0].TableName))?(t.EntityDetailsErrorMessage="Error: Multiple tables not allowed within parent and child entity.",!0):t.IsCircular&&this.strParentEntity&&this.strParentEntity!=""?(t.EntityDetailsErrorMessage="Error: Multiple tables not allowed within parent and child entity.",!0):(t.IsCircular=!1,t.objDirFunctions.getExtraFieldData&&(t.objExtraFields=t.objDirFunctions.getExtraFieldData()),e=validateExtraFields(t),e)?(t.EntityDetailsErrorMessage=t.FormDetailsErrorMessage,!0):!1};t.closeEntityDetails=function(){n.objEntity&&n.objEntity.errors&&n.objEntity.errors.invalid_code_group&&delete n.objEntity.errors.invalid_code_group;l.removeObjInToArray(n.validationErrorList,n.objEntity);t.entityDetailDialog.close()};t.selectEntityDetailsDialogTab=function(n){t.SelectedEntityDetailsDialogTab=n};t.entityDetailDialog=r.showDialog(t,"Entity Details","Entity/views/EntityDetails.html",{width:600,height:661});t.openEntityClick=function(n){n&&n!=""&&(t.closeEntityDetails(),s.NavigateToFile(n,"",""))};t.selectRuleClick=function(n){n&&n!=""&&(t.closeEntityDetails(),s.NavigateToFile(r.currentopenfile.file.FileName,"rules",n))};t.openBusinessObjectEditClick=function(){var n=t.$new();n.objEntityBusinessObject="";t.BusinessObjectEditDialog=r.showDialog(n,"Set Business Object","Entity/views/SetBusinessObject.html",{width:400,height:150});n.setBusinessObject=function(){var r=o.getEntityIntellisense(),i=n.objEntityBusinessObject;i&&r.some(function(n){return n.BusinessObjectName==i})?alert("Error: Invalid Business Object. The business object is used in another entity."):i&&t.objEntityTableName&&t.lstBusinessObject&&t.lstBusinessObject.some(function(n){return n.ID==i})?$.connection.hubEntityModel.server.validateBusinessObject(i,t.objEntityTableName).done(function(i){i==!1?alert("Error: Invalid Business Object. The business object does not contain a valid do property."):(t.objEntityBusinessObject=n.objEntityBusinessObject,t.$evalAsync(function(){t.IsValidBO=!0;t.EntityDetailsErrorMessage="";t.validateEntityDetails()}),n.closeBusinessObjectDialog())}):t.objEntityTableName||!t.lstBusinessObject||t.lstBusinessObject.some(function(n){return n.ID==i})?(t.objEntityBusinessObject=n.objEntityBusinessObject,t.IsValidBO=!0,t.EntityDetailsErrorMessage="",t.validateEntityDetails(),n.closeBusinessObjectDialog()):alert("Error: Invalid Business Object.")};n.closeBusinessObjectDialog=function(){t.BusinessObjectEditDialog.close()}};t.openTableNameEditClick=function(){var i=t.$new();i.objEntityTableName="";t.TableEditDialog=r.showDialog(i,"Set Table Name","Entity/views/SetTableName.html",{width:500,height:150});i.setTableName=function(){i.EntityTableErrorMessage="";t.objEntityBusinessObject?$.connection.hubEntityModel.server.isDataObjectFilePresent(i.objEntityTableName).done(function(r){n.$evalAsync(function(){r==!0?$.connection.hubEntityModel.server.validateBusinessObject(t.objEntityBusinessObject,i.objEntityTableName).done(function(n){n==!1?alert("Error: Invalid Table. The business object does not contain a valid do property."):(t.$evalAsync(function(){t.objEntityTableName=i.objEntityTableName;t.objVisibility.showInputTableName=!1;t.validateEntityDetails()}),i.closeTableDialog())}):i.objEntityTableName!=undefined&&i.objEntityTableName!=""&&(t.strEntityID=GetFormattedTableName(i.objEntityTableName.toLowerCase()),t.FormattedClassName=t.strEntityID,t.objEntityTableName=i.objEntityTableName,t.objVisibility.showInputTableName=!1,t.validateEntityDetails(),i.closeTableDialog())})}):i.objEntityTableName!=undefined&&i.objEntityTableName!=""&&(t.strEntityID=GetFormattedTableName(i.objEntityTableName.toLowerCase()),t.FormattedClassName=t.strEntityID,n.blnShowCreateWithClass&&(t.objEntityBusinessObject="bus"+t.strEntityID),t.objEntityTableName=i.objEntityTableName,t.objVisibility.showInputTableName=!1,t.validateEntityDetails(),i.closeTableDialog())};i.validateTableName=function(){i.EntityTableErrorMessage="";var r=o.getEntityIntellisense(),n=i.objEntityTableName;n?r.some(function(t){return t.TableName==n})?i.EntityTableErrorMessage="Error: Invalid Table Name. The table name is used in another entity.":t.lstMainTable&&!t.lstMainTable.some(function(t){return t.ID==n})&&(i.EntityTableErrorMessage="Error: Invalid Table Name."):i.EntityTableErrorMessage="Error: Invalid Table Name."};i.closeTableDialog=function(){t.TableEditDialog.close()}};t.PopulateErrorDetails=function(i,r){var u,f;t.objEntityDetails.sfwParentKey="";t.objEntityDetails.sfwParentKeyValue="";t.objEntityDetails.sfwStatusColumn="";i.errors||angular.isObject(i.errors)||(i.errors={});i.errors.sfwErrorTable="";r!=undefined&&r!=""&&(u=n.lstErrorTable.filter(function(n){return n==r}),u&&u.length>0?$.connection.hubEntityModel.server.populateErrorTableDetails(r).done(function(i){n.$apply(function(){t.lstErrorDetails=i;t.lstErrorDetails!=undefined&&(t.objEntityDetails.sfwParentKey=t.lstErrorDetails,t.objEntityDetails.sfwParentKeyValue=t.objEntityDetails.sfwMainCDO!=undefined?t.objEntityDetails.sfwMainCDO+"."+i:"."+i,t.objEntityDetails.sfwStatusColumn="status_value")})}):u.length<=0&&(f=c.VALIDATION.INVALID_ERROR_TABLE,i.errors.sfwErrorTable=f))};t.PopulateChecklistTable=function(t,i){var r,u;t.errors||angular.isObject(t.errors)||(t.errors={});t.errors.sfwChecklistTable="";i!=undefined&&i!=""&&(r=n.lstChecklistTable.filter(function(n){return n==i}),r.length<=0&&(u=c.VALIDATION.INVALID_CHECKLIST_TABLE,t.errors.sfwChecklistTable=u))};t.checkValidEntityInheritence();n.blnShowCreateWithClass&&t.checkValidBusinessObject()};n.isObjectTreeVisible=!1;n.toggleObjectTreeName="Expand Object Tree";n.toggleObjectTreeView=function(){n.isObjectTreeVisible=!n.isObjectTreeVisible;n.toggleObjectTreeName=n.isObjectTreeVisible?"Collapse Object Tree":"Expand Object Tree"};n.addMappedColumn=function(){var u=undefined,t=n.$new(!0),f,e,i,o;if(n.selectedQuery){for(n.lstDBQueryTypes.length>0&&(f=n.lstDBQueryTypes,u=getQuery(f,n.selectedQuery)),i=0;i<n.selectedQuery.Elements.length;i++)n.selectedQuery.Elements[i].Name=="parameters"&&(e=n.selectedQuery.Elements[i]);$.connection.hubEntityModel.server.getQuerySchemaFields(u,e).done(function(i){n.$evalAsync(function(){if(t.QueryColumns=i,t.TableColumnNames=[],t.lstUnmappedColumns=[],n.objAttributes&&angular.forEach(n.objAttributes.Elements,function(n){n.dictAttributes.sfwType=="Column"&&t.TableColumnNames.push(n.dictAttributes.sfwValue)}),!n.selectedQuery.objMappedColumns){r.PushItem({Name:"mappedcolumns",Value:"",dictAttributes:{},Elements:[]},n.selectedQuery.Elements);var u=n.selectedQuery.Elements.filter(function(n){return n.Name=="mappedcolumns"});u&&u.length>0&&(n.selectedQuery.objMappedColumns=u[0])}angular.forEach(t.QueryColumns,function(i){var r=i.toLowerCase(),f,u;t.TableColumnNames.indexOf(r)>-1&&(f="",n.selectedQuery.objMappedColumns&&(u=n.selectedQuery.objMappedColumns.Elements.filter(function(n){return n.dictAttributes.ID&&n.dictAttributes.ID.toLowerCase()==r}),u&&u.length==0&&t.lstUnmappedColumns.push({dictAttributes:{ID:r,sfwEntityField:""},Elements:[],Name:"column"})))});r.IsLoading=!1})})}t.isMappedColumnSelectAllChecked=!1;o=r.showDialog(t,"Add Mapped Column","Entity/views/AddMappedColumnTemplate.html",{width:500,height:600});t.onSelectAllMappedColumnChange=function(){var n;if(t.isMappedColumnSelectAllChecked)for(n=0;n<t.lstUnmappedColumns.length;n++)t.lstUnmappedColumns[n].IsSelect=!0;else for(n=0;n<t.lstUnmappedColumns.length;n++)t.lstUnmappedColumns[n].IsSelect=!1};t.setUnmappedColumns=function(){r.UndRedoBulkOp("Start");for(var i=0;i<t.lstUnmappedColumns.length;i++)t.lstUnmappedColumns[i].IsSelect&&(t.lstUnmappedColumns[i].IsDeleteColumn=!0,t.lstUnmappedColumns[i].dictAttributes.sfwEntityField=n.GetEntityField(t.lstUnmappedColumns[i].dictAttributes.ID),n.selectedQuery.objMappedColumns&&r.PushItem(t.lstUnmappedColumns[i],n.selectedQuery.objMappedColumns.Elements));r.UndRedoBulkOp("End");t.closeAddUnmappedColumnsDialog()};t.closeAddUnmappedColumnsDialog=function(){o.close()}};n.OnRemoveMappedQueryClickNew=function(t,i){r.DeleteItem(n.selectedQuery.objMappedColumns.Elements[i],n.selectedQuery.objMappedColumns.Elements)};n.refreshUnmappedColumnNew=function(){r.ClearUndoRedoListByFileName(n.currentfile.FileName);n.refreshUnmappedColumn()};n.GetMappedColumns=function(){var r,u,f,t,i;if(n.selectedQuery){for(r=undefined,n.lstDBQueryTypes.length>0&&(u=n.lstDBQueryTypes,r=getQuery(u,n.selectedQuery)),t=0;t<n.selectedQuery.Elements.length;t++)n.selectedQuery.Elements[t].Name=="parameters"&&(f=n.selectedQuery.Elements[t]);n.TableColumnNames=[];n.objAttributes&&angular.forEach(n.objAttributes.Elements,function(t){t.dictAttributes.sfwType=="Column"&&n.TableColumnNames.push(t.dictAttributes.sfwValue)});n.selectedQuery&&(i=n.selectedQuery.Elements.filter(function(n){return n.Name=="mappedcolumns"}),i&&i.length>0&&(n.selectedQuery.objMappedColumns=i[0]));n.selectedQuery.objMappedColumns&&n.selectedQuery.objMappedColumns.Elements&&angular.forEach(n.selectedQuery.objMappedColumns.Elements,function(t){t.dictAttributes&&t.dictAttributes.ID&&n.TableColumnNames.indexOf(t.dictAttributes.ID)>-1&&(t.IsDeleteColumn=!0)})}};n.refreshUnmappedColumn=function(){var i=undefined,u,f,t;if(n.selectedQuery){for(n.lstDBQueryTypes.length>0&&(u=n.lstDBQueryTypes,i=getQuery(u,n.selectedQuery)),t=0;t<n.selectedQuery.Elements.length;t++)n.selectedQuery.Elements[t].Name=="parameters"&&(f=n.selectedQuery.Elements[t]);r.IsLoading=!0;$.connection.hubEntityModel.server.getQuerySchemaFields(i,f).done(function(t){n.$apply(function(){function o(t){var u=t.toLowerCase(),i=new objElements;i.Name="column";i.dictAttributes.ID=u;i.dictAttributes.sfwEntityField="";n.TableColumnNames.indexOf(u)==-1&&(n.selectedQuery.objMappedColumns.Elements.length==0?r.PushItem(i,n.selectedQuery.objMappedColumns.Elements):n.selectedQuery.objMappedColumns.Elements.some(function(n){return n.dictAttributes.sfwParamaterName&&n.dictAttributes.sfwParamaterName.toLowerCase()==u})||r.PushItem(i,n.selectedQuery.objMappedColumns.Elements))}var e,i,u,f;if(n.QueryColumns=t,n.TableColumnNames=[],n.objAttributes&&angular.forEach(n.objAttributes.Elements,function(t){t.dictAttributes.sfwType=="Column"&&n.TableColumnNames.push(t.dictAttributes.sfwValue)}),r.UndRedoBulkOp("Start"),n.selectedQuery.objMappedColumns||(r.PushItem({Name:"mappedcolumns",Value:"",dictAttributes:{},Elements:[]},n.selectedQuery.Elements),e=n.selectedQuery.Elements.filter(function(n){return n.Name=="mappedcolumns"}),e&&e.length>0&&(n.selectedQuery.objMappedColumns=e[0])),i=n.selectedQuery.objMappedColumns.Elements,n.selectedQuery.objMappedColumns.Elements=[],angular.forEach(n.QueryColumns,o),i&&i.length>0)for(u=0;u<i.length;u++)i[u]&&i[u]&&i[u].dictAttributes.ID&&(f=n.selectedQuery.objMappedColumns.Elements.filter(function(n){return n.dictAttributes.ID==i[u].dictAttributes.ID}),f&&f.length>0&&i[u].dictAttributes.sfwEntityField&&r.EditPropertyValue(f[0].dictAttributes.sfwEntityField,f[0].dictAttributes,"sfwEntityField",i[u].dictAttributes.sfwEntityField));n.selectedQuery.objMappedColumns&&n.selectedQuery.objMappedColumns.Elements&&angular.forEach(n.selectedQuery.objMappedColumns.Elements,function(t){t.dictAttributes&&t.dictAttributes.ID&&n.TableColumnNames.indexOf(t)>-1&&(t.IsDeleteColumn=!0)});r.UndRedoBulkOp("End");r.IsLoading=!1})})}};n.GetEntityField=function(t){var r="",i=n.objAttributes.Elements.filter(function(n){return n.dictAttributes.sfwValue==t});return i&&i.length>0&&(r=i[0].dictAttributes.ID),r};n.onUnmappedColumnSelectionChange=function(t){n.selectedQuery.selectedMappedColumn=t;n.selectedUnmappedColumn=t};n.CheckAndRemoveUnmappedColumnNode=function(){n.objQueries&&n.objQueries.Elements&&n.objQueries.Elements.length>0&&angular.forEach(n.objQueries.Elements,function(n){var t,i;if(n&&n.Elements){if(n.objMappedColumns&&n.objMappedColumns.Name=="mappedcolumns"&&n.objMappedColumns.Elements&&n.objMappedColumns.Elements.length>0){for(t=n.objMappedColumns.Elements.length;t--;)n.objMappedColumns.Elements[t].dictAttributes.sfwEntityField||n.objMappedColumns.Elements.splice(t,1);n.Elements.indexOf(n.objMappedColumns)<=-1&&n.objMappedColumns.Elements.length>0&&n.Elements.push(n.objMappedColumns)}n.objMappedColumns&&n.objMappedColumns.Elements&&n.objMappedColumns.Elements.length==0&&(i=n.Elements.indexOf(n.objMappedColumns),i>-1&&n.Elements.splice(i,1))}})};n.GetMainCdoProperty=function(t){var i=!1;return t.match("^"+n.objEntity.dictAttributes.sfwMainCDO)&&(i=!0),i};n.closeAddUnmappedColumnsDialog=function(){ngDialog.close(mappedDialog.id);mappedDialog.id=""};n.getQueryParameters=function(){var f,v,e,o,h,s,i,c,y,l,a,u,t,p;if(n.selectedQuery&&n.selectedQuery.dictAttributes){if(f=undefined,v=!1,n.lstDBQueryTypes.length>0)for(e=n.lstDBQueryTypes,t=0;t<e.length;t++)if(e[t]&&e[t].Attribute&&n.selectedQuery.dictAttributes[e[t].Attribute]&&(f=n.selectedQuery.dictAttributes[e[t].Attribute],f&&f.indexOf("@")>-1)){v=!0;break}if(!v)for(o=0;o<n.selectedQuery.Elements.length;o++)n.selectedQuery.Elements[o].Name=="parameters"&&(n.selectedQuery.Elements[o].Elements=[]);if(f)for(h=f.split(/[\s,()=\r\n]+/),n.larrParameter=[],c=n.selectedQuery.Elements.filter(function(n){return n.Name=="parameters"}),c&&c.length>0&&(i=c[0]),i||(i={Name:"parameters",Value:"",dictAttributes:{},Elements:[],Children:[]},r.PushItem(i,n.selectedQuery.Elements)),t=0;t<h.length;t++)if(y=!1,h[t].indexOf("@")>-1&&(s=h[t],i)){for(l=i.Elements,a=0;a<l.length;a++)if(l[a].dictAttributes.ID==s){y=!0;n.larrParameter.push(s);break}y==!1&&(u={},u.Name="parameter",u.dictAttributes={},u.dictAttributes.ID=s,u.dictAttributes.sfwDataType="",u.Value="",r.PushItem(u,l),n.larrParameter.push(s))}if(i&&i.Elements&&i.Elements.length>0)for(t=0;t<i.Elements.length;t++)p=i.Elements[t].dictAttributes.ID,n.larrParameter.indexOf(p)==-1&&r.DeleteItem(i.Elements[t],i.Elements)}};n.AddNodeLockOperation=function(){var t=n.objselectedQueryTab.Attribute,i;n.selectedQuery.dictAttributes[t]!=undefined&&n.selectedQuery.dictAttributes[t]!=""&&(i=f.createQueryWithNoLock(n.selectedQuery.dictAttributes[t]),i.then(function(i){i&&n.$evalAsync(function(){r.EditPropertyValue(n.selectedQuery.dictAttributes[t],n.selectedQuery.dictAttributes,t,i,"showSelectedQueryInEditor");n.showSelectedQueryInEditor()})}))};n.formatQuery=function(){var t=n.objselectedQueryTab.Attribute,i;n.selectedQuery.dictAttributes[t]!=undefined&&n.selectedQuery.dictAttributes[t]!=""&&(i=f.formatQuery(n.selectedQuery.dictAttributes[t]),i.then(function(i){i&&n.$evalAsync(function(){r.EditPropertyValue(n.selectedQuery.dictAttributes[t],n.selectedQuery.dictAttributes,t,i,"showSelectedQueryInEditor");n.showSelectedQueryInEditor()})}))};n.selectDashboard=function(){n.IsDashboardVisible=!0;n.SelectedView="DashBoard"};n.IsAttributesOpen=!1;n.IsQueriesOpen=!1;n.IsValidationRulesOpen=!1;n.IsFieldConstraintOpen=!1;n.IsBusinessObjectOpen=!1;n.selectAttributeTab=function(){n.IsDashboardVisible=!1;n.SelectedView="Attributes";n.IsAttributesOpen||(n.IsAttributesOpen=!0)};n.selectQueriesTab=function(){n.IsDashboardVisible=!1;n.tab=1;n.SelectedView="Queries";n.IsQueriesOpen||(n.IsQueriesOpen=!0,n.objselectedQueryTab=n.lstDBQueryTypes[0],n.objQueries.Elements.length>0&&n.selectQuery(n.objQueries.Elements[0],0));!n.selectedQuery&&n.objQueries.Elements.length>0&&n.selectQuery(n.objQueries.Elements[0],0)};n.selectValidationRulesTab=function(){n.objRuleID.searchRuleByID="";n.objRuleID.selectedTypeID=n.objRuleID.lstTypeIds[0];n.IsDashboardVisible=!1;n.SelectedView="ValidationRules";(n.SelectedRuleView==""||n.SelectedRuleView==undefined)&&(n.SelectedRuleView="ValidationRules");n.objBusinessObject.ObjTree&&(n.objBusinessObject.ObjTree.IsExpanded=!1);n.CollapsedAllChildNode(n.objBusinessObject.ObjTree);n.IsValidationRulesOpen||(n.IsValidationRulesOpen=!0);n.objRules.Elements.length>0&&n.SelectedRule==undefined?n.selectedRules(n.objRules.Elements[0],null,!0):n.SelectedRule&&n.selectValidationRuleInAllTypes(n.SelectedRule,!0)};n.selectInitialLoadTab=function(){n.SelectedRuleView="ValidationRules";n.clearSelection();n.objInitialLoad.Elements.length>0&&!n.SelectedInitialLoad&&n.SelectedInitialLoadClick(n.objInitialLoad.Elements[0],null);n.selectValidationRulesTab();n.SelectChildRuleView("InitialLoad")};n.selectHardErrorTab=function(){n.SelectedRuleView="ValidationRules";n.clearSelection();n.objHardError.Elements.length>0&&!n.SelectedHardError&&(n.SelectedErrorClick(n.objHardError.Elements[0],null),n.setSelectedError(n.objHardError,0));n.selectValidationRulesTab();n.SelectChildRuleView("HardError")};n.selectSoftErrorTab=function(){n.SelectedRuleView="ValidationRules";n.clearSelection();n.objSoftError.Elements.length>0&&!n.SelectedSoftError&&(n.SelectedErrorClick(n.objSoftError.Elements[0],null),n.setSelectedError(n.objSoftError,0));n.selectValidationRulesTab();n.SelectChildRuleView("SoftError")};n.selectValidateDeleteTab=function(){n.SelectedRuleView="ValidationRules";n.clearSelection();n.objValidateDelete.Elements.length>0&&!n.SelectedValidateDelete&&(n.SelectedValidateDeleteClick(n.objValidateDelete.Elements[0],null),n.setSelectedValidateDelete(n.objValidateDelete,0));n.selectValidationRulesTab();n.SelectChildRuleView("ValidateDelete")};n.selectGroupTab=function(){n.SelectedRuleView="ValidationRules";n.clearSelection();n.clearValidationRuleSelection();n.objGroupList.Elements.length>0&&!n.SelectedGroup&&n.objGroupList.Elements[0].Elements.length>0&&(n.objGroupList.Elements[0].Elements[0],n.SelectGroupClick(n.objGroupList.Elements[0].Elements[0],null));n.selectValidationRulesTab();n.SelectChildRuleView("Group")};n.selectCheckListTab=function(){n.SelectedRuleView="Checklist";n.clearSelection();n.objCheckList.Elements.length>0&&!n.SelectedCheckList&&n.SelectCheckListClick(n.objCheckList.Elements[0],null);n.selectValidationRulesTab();n.SelectChildRuleView("Checklist")};n.selectFieldConstraintsTab=function(){n.IsDashboardVisible=!1;n.SelectedView="FieldConstraints";n.IsFieldConstraintOpen||(n.IsFieldConstraintOpen=!0)};n.selectMainRulesTab=function(){n.IsDashboardVisible=!1;n.SelectedView="EntityRules"};n.selectBusinessObjectTab=function(){n.IsDashboardVisible=!1;n.IsBusinessObjectOpen||(n.IsBusinessObjectOpen=!0);n.objBusinessObject.ObjTree&&(n.objBusinessObject.ObjTree.IsExpanded=!1,n.CollapsedAllChildNode(n.objBusinessObject.ObjTree));n.SelectedView="BusinessObject"};n.CollapsedAllChildNode=function(t){t&&(angular.forEach(t.ChildProperties,function(t){t.IsExpanded=!1;t.ChildProperties&&t.ChildProperties.length>0&&n.CollapsedAllChildNode(t)}),angular.forEach(t.lstMethods,function(t){t.IsExpanded=!1;t.ChildProperties&&t.ChildProperties.length>0&&n.CollapsedAllChildNode(t)}))};n.IsDashboardVisible=!0;n.addRulesFromEntity=function(n){var t=getScopeByFileName("MainPage");t!=undefined&&(t.currentFileName=r.currentopenfile.file.FileName,t.currentFilePath=r.currentopenfile.file.FilePath,t.addRules(n))};n.getClassforRulesItemDashboard=function(n){var t="";return n.isSelected&&(t="selected"),t=n.Data&&n.Data.IsStatic?t+" home-filetype-"+n.FileType+"-static-black":t+" home-filetype-"+n.FileType+"-black",n.isSelected&&n.isAdvanceSearched?t=t+" bckgGreen":n.isAdvanceSearched&&(t=t+" bckgGrey"),t};n.SelectedMatrix="ImportExcelMatrix";n.SelectedFile="ExcelFile";n.SelectedTable="Decisiontable";n.ExcelFilePath="";n.ExcelSelectedQuery="";n.Precision="6";n.Delimiter=",";n.ColumnIndex=-1;n.RowIndex=-1;n.CreateNewObject=function(n,t){var i={Name:n,Value:"",dictAttributes:{},Elements:[]};return t.Elements.push(i),i};n.addFieldFromObjectTreeClick=function(){var t=n.$new(),i;t.objBusinessObjectTree={};t.objBusinessObjectTree.lstmultipleselectedfields=[];t.objBusinessObjectTree.lstCurrentBusinessObjectProperties=[];t.objBusinessObjectTree.lstdisplaybusinessobject=[];t.objBusinessObjectTree.BusObjectName=n.objEntity.dictAttributes.sfwObjectID;i=r.showDialog(t,"Object Tree","Entity/views/ObjTree/ObjectTreeDialog.html",{width:500,height:600});t.onOkObjectTree=function(){t.objBusinessObjectTree.lstmultipleselectedfields!=undefined?(r.IsLoading=!0,v(function(){var i=t.objBusinessObjectTree.lstmultipleselectedfields;r.UndRedoBulkOp("Start");angular.forEach(i,function(i){var e=makeStringToCamelCase(i.ShortName),h,w,a,u,c;e=t.GetValidID(e);var f=getDataType(i.DataType,i.DataTypeName),s="",v="",l="Property";if(f=="Collection"||f=="CDOCollection"||f=="List"?(e="lst"+e,l=f,f="",s=i.ItemType.Name):f=="Object"&&(e="obj"+e,l=f,f="",s=i.ItemType.Name),s)for(h=o.getEntityIntellisense(),u=0;u<h.length;u++)if(h[u].BusinessObjectName==s){v=h[u].ID;break}var y="",b=getDisplayedEntity(t.objBusinessObjectTree.lstdisplaybusinessobject),p=b.strDisplayName;if(y=p?p+"."+i.ShortName:i.ShortName,w={Name:"attribute",Value:"",dictAttributes:{ID:e,sfwDataType:f,sfwValue:y,sfwType:l,sfwEntity:v},Elements:[]},a=!0,n.objAttributes&&n.objAttributes.Elements.length>0)for(u=0;u<n.objAttributes.Elements.length;u++)n.objAttributes.Elements[u].dictAttributes.ID!=undefined&&n.objAttributes.Elements[u].dictAttributes.ID.toLowerCase()==e.toLowerCase()&&(a=!1);a&&(r.PushItem(w,n.objAttributes.Elements),c=n.objAttributes.Elements[n.objAttributes.Elements.length-1],n.validateId(c,c.dictAttributes.ID),wt(c),n.checkObjectFieldValue())});r.UndRedoBulkOp("End");t.onCancelObjectTreeclick();r.IsLoading=!1},10)):(r.IsLoading=!1,t.onCancelObjectTreeclick())};t.onCancelObjectTreeclick=function(){i.close()};t.GetValidID=function(t){for(var i,e=1,f=t,u=0,r=0;r<n.objAttributes.Elements.length;r++)i=n.objAttributes.Elements[r],i.Name=="attribute"&&i.dictAttributes.ID&&i.dictAttributes.ID.toLowerCase()==t.toLowerCase()&&u++;while(u>0){for(f=t+e,u=0,r=0;r<n.objAttributes.Elements.length;r++)i=n.objAttributes.Elements[r],i.Name=="attribute"&&i.dictAttributes.ID&&i.dictAttributes.ID.toLowerCase()==f.toLowerCase()&&u++;e++}return f}};n.setSelectedValidateDelete=function(n,t){for(var r=n,i=0;i<n.Elements.length;i++)n.Elements[i].Name=="item"&&(n.Elements[i].isSelected=i==t?!0:!1)};n.canMoveValidateDeleteUp=function(n){if(n){var t=n.Elements.filter(function(n){return n.isSelected==!0});if(t&&t.length>0)return n.Elements.filter(function(n){return n.Name=="item"}).indexOf(t[0])>0}return!1};n.moveValidateDeleteUp=function(n){var u=n,t,i;if(n&&(t=n.Elements.filter(function(n){return n.isSelected==!0}),t&&t.length>0)){for(i=n.Elements.indexOf(t[0]),r.UndRedoBulkOp("Start"),r.DeleteItem(t[0],n.Elements);n.Elements[i-1].Name=="validatedelete";)i--;r.InsertItem(t[0],n.Elements,i-1);r.UndRedoBulkOp("End")}};n.canMoveValidateDeleteDown=function(n){if(n){var t=n.Elements.filter(function(n){return n.isSelected==!0});if(t&&t.length>0)return n.Elements.filter(function(n){return n.Name=="item"}).indexOf(t[0])<n.Elements.filter(function(n){return n.Name=="item"}).length-1}return!1};n.moveValidateDeleteDown=function(n){var u=n,t,i;if(n&&(t=n.Elements.filter(function(n){return n.isSelected==!0}),t&&t.length>0)){for(i=n.Elements.indexOf(t[0]),r.UndRedoBulkOp("Start"),r.DeleteItem(t[0],n.Elements);n.Elements[i].Name=="validatedelete";)i++;r.InsertItem(t[0],n.Elements,i+1);r.UndRedoBulkOp("End")}};n.removeRules=function(t){var i,u,f;n.currentFileObj&&n.currentFileObj.isSelected&&(i=!1,t=="Forms"&&(n.currentFileObj.FileType=="Maintenance"||n.currentFileObj.FileType=="Lookup"||n.currentFileObj.FileType=="Wizard"||n.currentFileObj.FileType=="UserControl"||n.currentFileObj.FileType=="Tooltip")?i=!0:t=="HTML"&&(n.currentFileObj.FileType=="FormLinkMaintenance"||n.currentFileObj.FileType=="FormLinkLookup"||n.currentFileObj.FileType=="FormLinkWizard")?i=!0:t=="Rules"&&(n.currentFileObj.FileType=="LogicalRule"||n.currentFileObj.FileType=="DecisionTable"||n.currentFileObj.FileType=="ExcelMatrix")?i=!0:t=="Correspondence"&&n.currentFileObj.FileType=="Correspondence"&&(i=!0),i==!0?(u=n.$new(),u.strMessage="Are you sure you want to delete this file ",u.FileName=n.currentFileObj.FileName,f=r.showDialog(u,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170}),u.OkClick=function(){var i=r.DeleteFile(n.currentFileObj);i.done(function(i){var u;r.deleteFileSucessCallback(n.currentFileObj,i);i&&(t=="Forms"?(u=n.lstItemsFormsList.indexOf(n.currentFileObj),u>-1&&(n.lstItemsFormsList.splice(u,1),n.currentFileObj=undefined)):t=="HTML"?(u=n.lstItemsHtxList.indexOf(n.currentFileObj),u>-1&&(n.lstItemsHtxList.splice(u,1),n.currentFileObj=undefined)):t=="Rules"?(u=n.lstItemsRulesList.indexOf(n.currentFileObj),u>-1&&(n.lstItemsRulesList.splice(u,1),n.currentFileObj=undefined)):t=="Correspondence"&&(u=n.lstItemsCorrList.indexOf(n.currentFileObj),u>-1&&(n.lstItemsCorrList.splice(u,1),n.currentFileObj=undefined)))});f.close()},u.closeDialog=function(){f.close()}):alert("Please Select file to delete."))};n.canDeleteRules=function(){return n.lstEntityRules.length>0?n.selectedEntityRule!=undefined&&n.selectedEntityRule>-1:!1};n.onOpenRuleFile=function(n){n!=null&&$.connection.hubMain.server.navigateToFile(n.FileName,"").done(function(n){r.openFile(n,!1)})};n.SearchRuleCommand=function(){var f=o.getEntityIntellisense(),i=f.filter(function(t){return t.ID==n.objEntity.dictAttributes.ID}),r,t,u;i&&i.length>0&&(r=i[0]);r&&(t=[],n.objRuleSearch.IsLogicalRuleChecked&&t.push("logicalrule"),n.objRuleSearch.IsDecisionTableChecked&&t.push("decisiontable"),n.objRuleSearch.IsExcelMatrixChecked&&t.push("excelmatrix"),u=r.Rules.filter(function(i){return(t.length==0||t.indexOf(i.RuleType.toLowerCase())>-1)&&(n.objRuleSearch.strSearchRulesID==undefined||n.objRuleSearch.strSearchRulesID.trim().length==0||i.ID.toLowerCase().indexOf(n.objRuleSearch.strSearchRulesID.toLowerCase())>-1)&&(n.objRuleSearch.SelectedRuleStatus==undefined||n.objRuleSearch.SelectedRuleStatus.trim().length==0||i.Status==n.objRuleSearch.SelectedRuleStatus)&&(n.objRuleSearch.SelectedReturnType==undefined||n.objRuleSearch.SelectedReturnType.trim().length==0||i.ReturnType==n.objRuleSearch.SelectedReturnType)&&(n.objRuleSearch.IsRuleStaticSelected==undefined||n.objRuleSearch.IsRuleStaticSelected==!1||i.IsStatic==n.objRuleSearch.IsRuleStaticSelected)&&(n.objRuleSearch.IsRulePrivateSelected==undefined||n.objRuleSearch.IsRulePrivateSelected==!1||i.IsPrivate==n.objRuleSearch.IsRulePrivateSelected)}),angular.forEach(n.lstEntityRules,function(n){n.IsVisible=u.some(function(t){return t.ID==n.ID})}))};n.ClearCommand=function(){n.objRuleSearch.strSearchRulesID=undefined;n.objRuleSearch.SelectedRuleStatus=undefined;n.objRuleSearch.SelectedReturnType=undefined;n.objRuleSearch.IsLogicalRuleChecked=undefined;n.objRuleSearch.IsDecisionTableChecked=undefined;n.objRuleSearch.IsExcelMatrixChecked=undefined;n.objRuleSearch.IsRuleStaticSelected=undefined;n.objRuleSearch.IsRulePrivateSelected=undefined;angular.forEach(n.lstEntityRules,function(n){n.IsVisible=!0})};n.receieveFilterRuleData=function(t){n.lstEntityRules=[];n.$apply(function(){n.lstEntityRules=t;n.lstEntityRules.length>0&&n.selectEntityRules(0)})};n.selectEntityRules=function(t){n.selectedEntityRule=t};n.onQueryClick=function(){var t=n.$new();t.onOkclick=function(){n.SelectedView=="ValidationRules"&&n.SelectedRule!=undefined&&(n.SelectedRule.dictAttributes.sfwExpression=t.GetExpression());t.onCancelclick()};t.selectQueryParam=function(n){t.SelectedQuery.SelectedParameter=n};t.onCancelclick=function(){ngDialog.close(t.queryDialog.id)};t.onQueryClick=function(){n.onQueryDialogClick(t)};t.GetExpression=function(){return n.getExpressionForQuery(t)};t.onQuerySelectionChange=function(n,i){t.SelectedQuery=n;i.stopPropagation()};t.ExpandCollapsedQuery=function(n,t){n.IsExpanded=!n.IsExpanded;expandCollapseQuery(t)};t.onQueryDialogClick=function(){if(t.SelectedQuery.SelectedParameter!=undefined){var i=t.$new();i.lstEntityQueryList=t.lstEntityQueryList;i.onOkclick=function(){t.SelectedQuery.SelectedParameter.Expression=i.GetExpression();i.onCancelclick()};i.GetExpression=function(){return n.getExpressionForQuery(i)};i.selectQueryParam=function(n){i.SelectedQuery.SelectedParameter=n};i.onQuerySelectionChange=function(n,t){i.SelectedQuery=n;t.stopPropagation()};i.onCancelclick=function(){ngDialog.close(i.queryDialog.id)};i.ExpandCollapsedQuery=function(n,t){n.IsExpanded=!n.IsExpanded;expandCollapseQuery(t)};i.queryDialog=ngDialog.open({template:"querySelectionWindowTemplate",scope:i,closeByDocument:!1,className:"ngdialog-theme-default ngdialog-theme-custom"})}};t.PopulateDataTypes=function(){t.DataTypes=[];t.DataTypes.push("string");t.DataTypes.push("bool");t.DataTypes.push("decimal");t.DataTypes.push("double");t.DataTypes.push("float");t.DataTypes.push("int");t.DataTypes.push("long");t.DataTypes.push("short")};t.Load=function(){$.connection.hubEntityModel.server.getEntityQueryList().done(function(n){t.lstEntityQueryList=n;t.queryDialog=ngDialog.open({template:"querySelectionWindowTemplate",scope:t,closeByDocument:!1,className:"ngdialog-theme-default ngdialog-theme-custom"})});t.PopulateDataTypes()};t.Load()};n.getExpressionForQuery=function(n){var t="RFunc.ExecuteQuery";return n.SelectedQuery.StrGenericType!=undefined&&n.SelectedQuery.StrGenericType!=""&&(t=t+"<"+n.SelectedQuery.StrGenericType+">"),t=t+"(",t=t+'"'+n.SelectedQuery.cdoId+"."+n.SelectedQuery.Name+'"',angular.forEach(n.SelectedQuery.Parameters,function(n){t=n.IsStringDataType&&n.IsConstant?t+',"'+n.Expression+'"':t+","+n.Expression}),t=t+")"};n.dashboardFilters={isAttributesFilterVisible:!1,attributesFilterText:"",isFieldConstraintsFilterVisible:!1,fieldConstraintsFilterText:"",isBusinessObjectFilterVisible:!1,businessObjectFilterText:"",isRelationshipsFilterVisible:!1,relationshipsFilterText:"",isExpressionsFilterVisible:!1,expressionsFilterText:"",isColumnsFilterVisible:!1,columnsFilterText:"",isValidationRulesFilterVisible:!1,validationRulesFilterText:"",isRulesFilterVisible:!1,rulesFilterText:"",isQueriesFilterVisible:!1,queriesFilterText:"",isInitialLoadFilterVisible:!1,initialLoadFilterText:"",isHardErrorsFilterVisible:!1,hardErrorsFilterText:"",isSoftErrorsFilterVisible:!1,softErrorsFilterText:"",isValidateDeleteFilterVisible:!1,validateDeleteFilterText:"",isGroupsFilterVisible:!1,groupsFilterText:"",isCheckListFilterVisible:!1,checkListFilterText:"",isInitialLoadFilterVisible:!1,searchInitialLoadRuleByID:"",isHardErrorFilterVisible:!1,searchHardErrorsRuleByID:"",isSoftErrorFilterVisible:!1,searchSoftErrorsRuleByID:"",isValidateDeleteFilterVisible:!1,searchValidateDeleteRuleByID:"",isGroupsFilterVisible:!1,searchGroupRuleByID:"",toggleDashboardFilter:function(t){t=="FieldConstraints"&&(n.dashboardFilters.isFieldConstraintsFilterVisible=!n.dashboardFilters.isFieldConstraintsFilterVisible,n.dashboardFilters.fieldConstraintsFilterText="");t=="BusinessObject"&&(n.dashboardFilters.isBusinessObjectFilterVisible=!n.dashboardFilters.isBusinessObjectFilterVisible,n.dashboardFilters.businessObjectFilterText="");t=="Attributes"&&(n.dashboardFilters.isAttributesFilterVisible=!n.dashboardFilters.isAttributesFilterVisible,n.dashboardFilters.attributesFilterText="");t=="Relationship"&&(n.dashboardFilters.isRelationshipsFilterVisible=!n.dashboardFilters.isRelationshipsFilterVisible,n.dashboardFilters.relationshipsFilterText="");t=="Expressions"&&(n.dashboardFilters.isExpressionsFilterVisible=!n.dashboardFilters.isExpressionsFilterVisible,n.dashboardFilters.expressionsFilterText="");t=="ValidationRules"&&(n.dashboardFilters.isValidationRulesFilterVisible=!n.dashboardFilters.isValidationRulesFilterVisible,n.dashboardFilters.validationRulesFilterText="");t=="Rules"&&(n.dashboardFilters.isRulesFilterVisible=!n.dashboardFilters.isRulesFilterVisible,n.dashboardFilters.rulesFilterText="");t=="Queries"&&(n.dashboardFilters.isQueriesFilterVisible=!n.dashboardFilters.isQueriesFilterVisible,n.dashboardFilters.queriesFilterText="");t=="InitialLoad"&&(n.dashboardFilters.isInitialLoadFilterVisible=!n.dashboardFilters.isInitialLoadFilterVisible,n.dashboardFilters.initialLoadFilterText="");t=="HardErrors"&&(n.dashboardFilters.isHardErrorsFilterVisible=!n.dashboardFilters.isHardErrorsFilterVisible,n.dashboardFilters.hardErrorsFilterText="");t=="SoftErrors"&&(n.dashboardFilters.isSoftErrorsFilterVisible=!n.dashboardFilters.isSoftErrorsFilterVisible,n.dashboardFilters.softErrorsFilterText="");t=="ValidateDelete"&&(n.dashboardFilters.isValidateDeleteFilterVisible=!n.dashboardFilters.isValidateDeleteFilterVisible,n.dashboardFilters.validateDeleteFilterText="");t=="Groups"&&(n.dashboardFilters.isGroupsFilterVisible=!n.dashboardFilters.isGroupsFilterVisible,n.dashboardFilters.groupsFilterText="");t=="CheckList"&&(n.dashboardFilters.isCheckListFilterVisible=!n.dashboardFilters.isCheckListFilterVisible,n.dashboardFilters.checkListFilterText="")}};n.openEntityClick=function(n){n&&n!=""&&s.NavigateToFile(n,"","")};n.selectRuleClick=function(n){n&&n!=""&&s.NavigateToFile(r.currentopenfile.file.FileName,"rules",n)};n.ValidateRulesandExpressions=function(){$.connection.hubEntityModel.server.validateExpressions(n.currentfile.FileName,!0).done(function(t){angular.forEach(t,function(t,i){var r=n.objAttributes.Elements.filter(function(n){if(n.dictAttributes.sfwType=="Expression")return n.dictAttributes.ID==i});r&&r.length>0&&n.$evalAsync(function(){r[0].Error=t})})});$.connection.hubEntityModel.server.validateExpressions(n.currentfile.FileName,!1).done(function(t){angular.forEach(t,function(t,i){var r=n.objRules.Elements.filter(function(n){return n.dictAttributes.ID==i});r&&r.length>0&&n.$evalAsync(function(){r[0].Error=t})})})};n.ValidateObject=function(){n.ValidateRulesandExpressions()};n.addExtraFieldsDataInToMainModel=function(){if(n.objEntityExtraFields){var t=n.objEntity.Elements.indexOf(n.objEntityExtraFields);t==-1&&n.objEntity.Elements.push(n.objEntityExtraFields)}};n.onClickOnItems=function(t){n.currentFileObj=t;n.currentFileObj&&!n.currentFileObj.isSelected&&(n.currentFileObj.isSelected=!0,n.previousFileObj&&(n.previousFileObj.isSelected=!1),n.previousFileObj=n.currentFileObj)};n.validateFileData=function(t){var u,r,i;a.validationListObj&&angular.isArray(a.validationListObj)&&(u=h("filter")(a.validationListObj,{FileName:n.currentfile.FileName}),u.length==0&&a.validationListObj.push({FileName:n.currentfile.FileName,errorList:[]}),r=h("filter")(a.validationListObj,{FileName:n.currentfile.FileName})[0],n.validationErrorList=r.errorList=[],n.warningList=r.warningList=[]);angular.forEach(n.objAttributes.Elements,function(t){n.validateId(t,undefined,!0);n.validateDataType(t,undefined,!0);wt(t)});angular.forEach(n.objQueries.Elements,function(t){if(l.validateID(t,n.validationErrorList,t.dictAttributes.ID),t.Elements.length>0){var i=h("filter")(t.Elements,{Name:"mappedcolumns"})[0];i&&i.Elements.length>0&&angular.forEach(i.Elements,function(t){if(t&&t.dictAttributes.hasOwnProperty("sfwEntityField")&&t.dictAttributes.sfwEntityField)l.checkValidListValueForMultilevel([],t,t.dictAttributes.sfwEntityField,n.objEntity.dictAttributes.ID,"sfwEntityField","sfwEntityField",c.VALIDATION.ENTITY_FIELD_INCORRECT,n.validationErrorList,!1,"")})}});n.checkDuplicateId(!1);pt(!1);g(!1);angular.forEach(n.objMethods.Elements,function(t){l.validateID(t,n.validationErrorList,t.dictAttributes.ID)});n.objEntity.dictAttributes.sfwObjectID?$.connection.hubEntityModel.server.loadObjectTree(n.objEntity.dictAttributes.sfwObjectID,"",!0).done(function(t){n.$evalAsync(function(){var n=JSON.parse(t),i=n.lstMethods&&l.getListByPropertyName(n.lstMethods,"ShortName");vt(i)})}):n.blnShowCreateWithClass&&vt([]);angular.forEach(n.objHardError.Elements,function(t){t.objRule&&(l.validateIsEmptyMessageId(t.objRule,n.validationErrorList,t.objRule.dictAttributes.sfwMessageId),l.validateIsEmptyMessageIdAndDescription(t.objRule,n.validationErrorList,t.objRule.dictAttributes.sfwMessageId,t.objRule.dictAttributes.sfwMessage))});angular.forEach(n.objSoftError.Elements,function(t){t.objRule&&(l.validateIsEmptyMessageId(t.objRule,n.validationErrorList,t.objRule.dictAttributes.sfwMessageId),l.validateIsEmptyMessageIdAndDescription(t.objRule,n.validationErrorList,t.objRule.dictAttributes.sfwMessageId,t.objRule.dictAttributes.sfwMessage))});angular.forEach(n.objDelete.Elements,function(t){var i;t.dictAttributes.hasOwnProperty("ID")&&t.dictAttributes.ID&&(i="Object,Collection,List",l.checkValidListValueForMultilevel([],t,t.dictAttributes.ID,n.objEntity.dictAttributes.ID,"ID","ID",c.VALIDATION.ENTITY_FIELD_INCORRECT,n.validationErrorList,!1,i));t.dictAttributes.hasOwnProperty("sfwMethodName")&&t.dictAttributes.sfwMethodName&&(i="Property,Collection,Object",l.checkValidListValueForXMLMethod([],t,t.dictAttributes.sfwMethodName,n.objEntity.dictAttributes.ID,"sfwMethodName","invalid_method_name",c.VALIDATION.INVALID_NAME,n.validationErrorList,i,null,!0))});n.codegrouplist?(i=l.getListByPropertyName(n.codegrouplist,"CodeID"),yt(i)):$.connection.hubMain.server.getCodeGroups().done(function(t){n.codegrouplist=t;var i=l.getListByPropertyName(n.codegrouplist,"CodeID");yt(i)});et(!1);n.validateCSProperties();n.objEntity.dictAttributes.sfwParentEntity&&t?hubMain.server.getInheritedRule(n.objEntity.dictAttributes.ID,n.objEntity.dictAttributes.sfwParentEntity).done(function(t){t&&n.$evalAsync(function(){g(t,!0);n.checkValidationRules(t.Elements)})}):(i=[],n.objEntity.dictAttributes.sfwParentEntity&&n.objInheritedRules&&n.objInheritedRules.Elements&&(i=n.objInheritedRules.Elements),n.checkValidationRules(i));n.checkObjectFieldValue();at();t&&(n.ValidateObject(),rt(),gt(),n.$evalAsync(function(){toastr.info("Entity validated successfully")}));n.validateParentKeyValue();n.validateStatusValue()};at=function(){var t=l.getListByPropertyName(n.lstMessages,"MessageID");n.objConstraints&&n.objConstraints.Elements.length>0&&angular.forEach(n.objConstraints.Elements,function(i){i&&i.dictAttributes.sfwMaxValue&&i.dictAttributes.sfwMaxMessageId&&l.checkValidListValue(t,i,i.dictAttributes.sfwMaxMessageId,"sfwMaxMessageId","sfwMaxMessageId",c.VALIDATION.INVALID_MESSAGE_ID,n.validationErrorList,!1);i&&i.dictAttributes.sfwMinValue&&i.dictAttributes.sfwMinMessageId&&l.checkValidListValue(t,i,i.dictAttributes.sfwMinMessageId,"sfwMinMessageId","sfwMinMessageId",c.VALIDATION.INVALID_MESSAGE_ID,n.validationErrorList,!1)})};vt=function(t){angular.forEach(n.objObjectMethods.Elements,function(i){l.validateID(i,n.validationErrorList,i.dictAttributes.ID);l.checkValidListValue(t,i,i.dictAttributes.ID,"ID","inValid_id",c.VALIDATION.INVALID_FIELD,n.validationErrorList)})};n.checkObjectFieldValue=function(){var t=["Object","CDOCollection","Collection","List","Property"],i=nt();angular.forEach(n.objAttributes.Elements,function(r){angular.isArray(t)&&t.indexOf(r.dictAttributes.sfwType)>-1&&(r&&r.warnings&&delete r.warnings.sfwValue,l.checkDuplicateValue(r,i,n.warningList,"sfwValue","sfwValue",!0,t))})};n.checkValidationRules=function(t){var i=[];i=i.concat(l.getListByPropertyName(n.objRules.Elements,"ID",!1));i=i.concat(l.getListByPropertyName(t,"ID",!1));n.validateRules(n.objInitialLoad.Elements,i);n.validateRules(n.objCheckList.Elements,i)};n.validateRules=function(t,i){angular.forEach(t,function(t){l.checkValidListValue(i,t,t.dictAttributes.ID,"ID","invalid_rule",t.dictAttributes.ID+" - "+c.VALIDATION.INVALID_RULE,n.validationErrorList);angular.isArray(t.Children)&&t.Children.length>0&&n.validateRules(t.Children,i)})};rt=function(){angular.forEach(n.objMethods.Elements,function(t){for(var r,i=0;i<t.Elements.length;i++)t.Elements[i].Name=="item"&&(r="Column,Property,Collection,Object",l.checkValidListValueForXMLMethod(n.lstBusBaseMethods,t.Elements[i],t.Elements[i].dictAttributes.ID,n.objEntity.dictAttributes.ID,"ID","invalid_method_name",c.VALIDATION.INVALID_NAME,n.validationErrorList,r,null,!1))})};yt=function(t){angular.forEach(n.objAttributes.Elements,function(i){i.dictAttributes.hasOwnProperty("sfwCodeID")&&i.dictAttributes.sfwCodeID&&l.checkValidListValue(t,i,i.dictAttributes.sfwCodeID,"sfwCodeID","invalid_code_group",c.VALIDATION.CODE_GROUP_NOT_EXISTS,n.validationErrorList)})};n.validateId=function(t,i,r){t&&(r?l.validateID(t,n.validationErrorList,t.dictAttributes.ID):l.validateID(t,n.validationErrorList,i))};n.validateIsEmptyMessageId=function(t,i,r){t&&(r?l.validateIsEmptyMessageId(t,n.validationErrorList,t.dictAttributes.sfwMessageId):l.validateIsEmptyMessageId(t,n.validationErrorList,i))};n.checkDuplicateObj=function(n,t,i){var u=nt(),e=u.Elements.indexOf(t),r,f;i&&u.Elements.splice(e,1);r=l.findDuplicateId(u,n.dictAttributes.ID,c.ENTITY.NODES,"description",n,"dictAttributes.ID");r?(f=c.VALIDATION.DUPLICATE_ID,r.hasOwnProperty("isParent")&&r.isParent&&(f=c.VALIDATION.DUPLICATE_ID_IN_PARENT_ENTITY),n.errors.duplicate_id=f):n.errors&&delete n.errors.duplicate_id};n.checkDuplicateId=function(t){var i=nt();angular.forEach(n.objAttributes.Elements,function(u){u.dictAttributes.sfwType!=="Description"&&l.checkDuplicateId(u,i,n.validationErrorList,t,c.ENTITY.NODES,n.warningList,r.iblnShowEntityDuplicateIdAsWarning,!0)})};var pt=function(t){angular.forEach(n.objQueries.Elements,function(i){l.checkDuplicateId(i,n.objQueries,n.validationErrorList,t,c.ENTITY.NODES)})},g=function(t){var i=null,r;n.objInheritedRules&&n.objInheritedRules.Elements&&(i=n.objInheritedRules);r=ut(i);n.objRules&&angular.forEach(n.objRules.Elements,function(i){i.Name=="rule"&&l.checkDuplicateId(i,r,n.validationErrorList,t,c.ENTITY.NODES)})},gt=function(){n.objRules&&angular.forEach(n.objRules.Elements,function(t){if(t.Name=="rule"){var i=n.objHardError.Elements.filter(function(n){if(n&&n.dictAttributes.ID==t.dictAttributes.ID)return n});i&&i.length&&n.validateEmptyMessageID(t)}})},ut=function(t){var i={Elements:[]},r=[];return i.Elements=n.objRules.Elements&&n.objRules.Elements.slice(),n.objEntity.dictAttributes.sfwParentEntity&&t&&t.Elements&&(angular.forEach(t.Elements,function(n){if(n){var t={};t=angular.copy(n,t);t.isParent=!0;r.push(t)}}),i.Elements=i.Elements.concat(r)),i},ft=function(t){var i={Elements:[]},u=[],f=!0,e=!0,r;return t=="xmlmethod"?(i.Elements=n.objMethods.Elements.slice(),e=!1):(i.Elements=n.objObjectMethods.Elements.slice(),f=!1),n.objEntity.dictAttributes.sfwParentEntity&&(r=d.GetIntellisenseData(n.objEntity.dictAttributes.sfwParentEntity,"","",!0,!1,e,!1,!1,f),r&&r.length>0&&(u=ni(r),i.Elements=i.Elements.concat(u))),i},ni=function(n){var t=[];return angular.forEach(n,function(n){if(n&&n.ID){var i={dictAttributes:{},Elements:[]};i.dictAttributes.ID=n.ID;i.Name=n.Type;i.isParent=!0;n.hasOwnProperty("Value")&&n.Value&&(i.dictAttributes.sfwValue=n.Value);n.hasOwnProperty("Type")&&n.Type&&(i.dictAttributes.sfwType=n.Type);t.push(i)}}),t},et=function(t){var i,r;i=ft("xmlmethod");angular.forEach(n.objMethods.Elements,function(r){l.validateID(r,n.validationErrorList,r.dictAttributes.ID);l.checkDuplicateId(r,i,n.validationErrorList,t,c.ENTITY.METHOD_NODES)});n.blnShowCreateWithClass&&(r=ft("objmethod"),angular.forEach(n.objObjectMethods.Elements,function(i){l.checkDuplicateId(i,r,n.validationErrorList,t,c.ENTITY.METHOD_NODES)}))};n.validateDataType=function(t,i,r){t&&(r?t.dictAttributes.sfwType=="Property"&&l.validateDataType(t,n.validationErrorList,t.dictAttributes.sfwDataType):l.validateDataType(t,n.validationErrorList,i))};wt=function(t){t&&(t.dictAttributes.sfwType=="Collection"||t.dictAttributes.sfwType=="CDOCollection"||t.dictAttributes.sfwType=="Object"||t.dictAttributes.sfwType=="List")&&l.validateEntity(t,n.validationErrorList)};n.findParentAndChildObject=function(t){var i=[];n.FindDeepNode(n.objEntity,t,i);n.$evalAsync(function(){var t=l.createFullPath(n.objEntity,i);n.selectElement(t)})};n.MoveUpInitialLoad=function(){if(n.SelectedInitialLoad){var t=n.objInitialLoad.Elements.indexOf(n.SelectedInitialLoad);r.UndRedoBulkOp("Start");r.DeleteItem(n.SelectedInitialLoad,n.objInitialLoad.Elements);r.InsertItem(n.SelectedInitialLoad,n.objInitialLoad.Elements,t-1);r.UndRedoBulkOp("End");n.scrollToPosition("#entity-validation-initialload-section",".page-sidebar-content",n.SelectedInitialLoad.dictAttributes.ID,{offsetTop:400,offsetLeft:0})}};n.isMoveUpInitialLoad=function(){if(n.SelectedInitialLoad==undefined)return!0;var t=n.objInitialLoad.Elements.indexOf(n.SelectedInitialLoad);return t>0?!1:!0};n.MoveDownInitialLoad=function(){if(n.SelectedInitialLoad){var t=n.objInitialLoad.Elements.indexOf(n.SelectedInitialLoad);r.UndRedoBulkOp("Start");r.DeleteItem(n.SelectedInitialLoad,n.objInitialLoad.Elements);r.InsertItem(n.SelectedInitialLoad,n.objInitialLoad.Elements,t+1);r.UndRedoBulkOp("End");n.scrollToPosition("#entity-validation-initialload-section",".page-sidebar-content",n.SelectedInitialLoad.dictAttributes.ID,{offsetTop:400,offsetLeft:0})}};n.isMoveDownInitialLoad=function(){if(n.SelectedInitialLoad==undefined)return!0;var t=n.objInitialLoad.Elements.indexOf(n.SelectedInitialLoad);return t!=n.objInitialLoad.Elements.length-1&&t!=-1?!1:!0};n.MoveUpHardError=function(){n.MoveUpValidationRule(n.SelectedHardError,n.objHardError,"rule");n.scrollToPosition("#entity-validation-harderror-section",".page-sidebar-content",n.SelectedHardError.dictAttributes.ID,{offsetTop:400,offsetLeft:0})};n.isMoveUpHardError=function(){return n.isMoveUpValidationRule(n.SelectedHardError,n.objHardError,"rule")};n.MoveDownHardError=function(){n.MoveDownValidationRule(n.SelectedHardError,n.objHardError,"rule");n.scrollToPosition("#entity-validation-harderror-section",".page-sidebar-content",n.SelectedHardError.dictAttributes.ID,{offsetTop:400,offsetLeft:0})};n.isMoveDownHardError=function(){return n.isMoveDownValidationRule(n.SelectedHardError,n.objHardError,"rule")};n.MoveUpValidationRule=function(n,t,i){var u,f;n&&(n.Name==i?(u=t.Elements.filter(function(t){return n.ParentID==t.dictAttributes.ID}),u&&u.length>0&&(f=u[0].Children.indexOf(n),f>0&&(r.UndRedoBulkOp("Start"),r.DeleteItem(n,u[0].Children),r.InsertItem(n,u[0].Children,f-1),r.UndRedoBulkOp("End")))):(f=t.Elements.indexOf(n),r.UndRedoBulkOp("Start"),r.DeleteItem(n,t.Elements),r.InsertItem(n,t.Elements,f-1),r.UndRedoBulkOp("End")))};n.isMoveUpValidationRule=function(n,t,i){var r,u;if(n==undefined)return!0;if(n.Name==i){if(r=t.Elements.filter(function(t){return n.ParentID==t.dictAttributes.ID}),r&&r.length>0)return u=r[0].Children.indexOf(n),u>0?!1:!0}else return u=t.Elements.indexOf(n),u>0?!1:!0};n.MoveDownValidationRule=function(n,t,i){var u,f;n&&(n.Name==i?(u=t.Elements.filter(function(t){return n.ParentID==t.dictAttributes.ID}),u&&u.length>0&&(f=u[0].Children.indexOf(n),f!=u[0].Children.length-1&&f!=-1&&(r.UndRedoBulkOp("Start"),r.DeleteItem(n,u[0].Children),r.InsertItem(n,u[0].Children,f+1),r.UndRedoBulkOp("End")))):(f=t.Elements.indexOf(n),r.UndRedoBulkOp("Start"),r.DeleteItem(n,t.Elements),r.InsertItem(n,t.Elements,f+1),r.UndRedoBulkOp("End")))};n.isMoveDownValidationRule=function(n,t,i){var u,r;if(n==undefined)return!0;if(n.Name==i){if(u=t.Elements.filter(function(t){return n.ParentID==t.dictAttributes.ID}),u&&u.length>0)return r=u[0].Children.indexOf(n),r!=u[0].Children.length-1&&r!=-1?!1:!0}else return r=t.Elements.indexOf(n),r!=t.Elements.length-1&&r!=-1?!1:!0};n.MoveUpSoftError=function(){n.MoveUpValidationRule(n.SelectedSoftError,n.objSoftError,"rule");n.scrollToPosition("#entity-validation-softerror-section",".page-sidebar-content",n.SelectedSoftError.dictAttributes.ID,{offsetTop:400,offsetLeft:0})};n.isMoveUpSoftError=function(){return n.isMoveUpValidationRule(n.SelectedSoftError,n.objSoftError,"rule")};n.MoveDownSoftError=function(){n.MoveDownValidationRule(n.SelectedSoftError,n.objSoftError,"rule");n.scrollToPosition("#entity-validation-softerror-section",".page-sidebar-content",n.SelectedSoftError.dictAttributes.ID,{offsetTop:400,offsetLeft:0})};n.isMoveDownSoftError=function(){return n.isMoveDownValidationRule(n.SelectedSoftError,n.objSoftError,"rule")};n.MoveUpValidateDelete=function(){if(n.SelectedValidateDelete){var t=n.objValidateDelete.Elements.indexOf(n.SelectedValidateDelete);r.UndRedoBulkOp("Start");r.DeleteItem(n.SelectedValidateDelete,n.objValidateDelete.Elements);r.InsertItem(n.SelectedValidateDelete,n.objValidateDelete.Elements,t-1);r.UndRedoBulkOp("End");n.scrollToPosition("#entity-validation-delete-section",".page-sidebar-content",n.SelectedValidateDelete.dictAttributes.ID,{offsetTop:400,offsetLeft:0})}};n.isMoveUpValidateDelete=function(){if(n.SelectedValidateDelete==undefined)return!0;var t=n.objValidateDelete.Elements.indexOf(n.SelectedValidateDelete);return t>0?!1:!0};n.MoveDownValidateDelete=function(){if(n.SelectedValidateDelete){var t=n.objValidateDelete.Elements.indexOf(n.SelectedValidateDelete);r.UndRedoBulkOp("Start");r.DeleteItem(n.SelectedValidateDelete,n.objValidateDelete.Elements);r.InsertItem(n.SelectedValidateDelete,n.objValidateDelete.Elements,t+1);r.UndRedoBulkOp("End");n.scrollToPosition("#entity-validation-delete-section",".page-sidebar-content",n.SelectedValidateDelete.dictAttributes.ID,{offsetTop:400,offsetLeft:0})}};n.isMoveDownValidateDelete=function(){if(n.SelectedValidateDelete==undefined)return!0;var t=n.objValidateDelete.Elements.indexOf(n.SelectedValidateDelete);return t!=n.objValidateDelete.Elements.length-1&&t!=-1?!1:!0};n.MoveUpGroupList=function(){var t,i;n.SelectedGroup&&(n.SelectedGroup.Name=="item"?(t=n.objGroupList.Elements.filter(function(t){return n.SelectedGroup.ParentID==t.dictAttributes.ID}),t&&t.length>0&&(i=t[0].Elements.indexOf(n.SelectedGroup),i>0&&(r.UndRedoBulkOp("Start"),r.DeleteItem(n.SelectedGroup,t[0].Elements),r.InsertItem(n.SelectedGroup,t[0].Elements,i-1),r.UndRedoBulkOp("End"),n.scrollToPosition("#validation-rules-grouplist-section",".page-sidebar-content",n.SelectedGroup.dictAttributes.ID,{offsetTop:400})))):(i=n.objGroupList.Elements.indexOf(n.SelectedGroup),r.UndRedoBulkOp("Start"),r.DeleteItem(n.SelectedGroup,n.objGroupList.Elements),r.InsertItem(n.SelectedGroup,n.objGroupList.Elements,i-1),r.UndRedoBulkOp("End"),n.scrollToPosition("#validation-rules-grouplist-section",".page-sidebar-content",n.SelectedGroup.dictAttributes.ID,{offsetTop:400})))};n.isMoveUpGroupList=function(){var t,i;if(n.SelectedGroup==undefined)return!0;if(n.SelectedGroup.Name=="item"){if(t=n.objGroupList.Elements.filter(function(t){return n.SelectedGroup.ParentID==t.dictAttributes.ID}),t&&t.length>0)return i=t[0].Elements.indexOf(n.SelectedGroup),i>0?!1:!0}else return i=n.objGroupList.Elements.indexOf(n.SelectedGroup),i>0?!1:!0};n.MoveDownGroupList=function(){var t,i;n.SelectedGroup&&(n.SelectedGroup.Name=="item"?(t=n.objGroupList.Elements.filter(function(t){return n.SelectedGroup.ParentID==t.dictAttributes.ID}),t&&t.length>0&&(i=t[0].Elements.indexOf(n.SelectedGroup),i!=t[0].Elements.length-1&&i!=-1&&(r.UndRedoBulkOp("Start"),r.DeleteItem(n.SelectedGroup,t[0].Elements),r.InsertItem(n.SelectedGroup,t[0].Elements,i+1),r.UndRedoBulkOp("End"),n.scrollToPosition("#validation-rules-grouplist-section",".page-sidebar-content",n.SelectedGroup.dictAttributes.ID,{offsetTop:400})))):(i=n.objGroupList.Elements.indexOf(n.SelectedGroup),r.UndRedoBulkOp("Start"),r.DeleteItem(n.SelectedGroup,n.objGroupList.Elements),r.InsertItem(n.SelectedGroup,n.objGroupList.Elements,i+1),r.UndRedoBulkOp("End"),n.scrollToPosition("#validation-rules-grouplist-section",".page-sidebar-content",n.SelectedGroup.dictAttributes.ID,{offsetTop:400})))};n.isMoveDownGroupList=function(){var i,t;if(n.SelectedGroup==undefined)return!0;if(n.SelectedGroup.Name=="item"){if(i=n.objGroupList.Elements.filter(function(t){return n.SelectedGroup.ParentID==t.dictAttributes.ID}),i&&i.length>0)return t=i[0].Elements.indexOf(n.SelectedGroup),t!=i[0].Elements.length-1&&t!=-1?!1:!0}else return t=n.objGroupList.Elements.indexOf(n.SelectedGroup),t!=n.objGroupList.Elements.length-1&&t!=-1?!1:!0};n.MoveUpCheckList=function(){if(n.SelectedCheckList){var t=n.objCheckList.Elements.indexOf(n.SelectedCheckList);r.UndRedoBulkOp("Start");r.DeleteItem(n.SelectedCheckList,n.objCheckList.Elements);r.InsertItem(n.SelectedCheckList,n.objCheckList.Elements,t-1);r.UndRedoBulkOp("End");n.scrollToPosition("#rule-checklist",".page-sidebar-content",n.SelectedCheckList.dictAttributes.ID,{offsetTop:400,offsetLeft:0})}};n.isMoveUpCheckList=function(){if(n.SelectedCheckList==undefined)return!0;var t=n.objCheckList.Elements.indexOf(n.SelectedCheckList);return t>0?!1:!0};n.MoveDownCheckList=function(){if(n.SelectedCheckList){var t=n.objCheckList.Elements.indexOf(n.SelectedCheckList);r.UndRedoBulkOp("Start");r.DeleteItem(n.SelectedCheckList,n.objCheckList.Elements);r.InsertItem(n.SelectedCheckList,n.objCheckList.Elements,t+1);r.UndRedoBulkOp("End");n.scrollToPosition("#rule-checklist",".page-sidebar-content",n.SelectedCheckList.dictAttributes.ID,{offsetTop:400,offsetLeft:0})}};n.isMoveDownCheckList=function(){if(n.SelectedCheckList==undefined)return!0;var t=n.objCheckList.Elements.indexOf(n.SelectedCheckList);return t!=n.objCheckList.Elements.length-1&&t!=-1?!1:!0};n.onnewfileclick=function(t){var i=n.$new();i.IsEntityDisabled=!0;i.SelectedCreationOption=t;i.SelectedEntity=n.objEntity.dictAttributes.ID;i.title="Create New Entity";i.dialogForNew=r.showDialog(i,i.title,"CreateNewObject/views/CreateNewObject.html",{width:830,height:700})};n.refreshMethodParams=function(t){n.objEntity.dictAttributes.sfwObjectID&&t.dictAttributes.ID&&$.connection.hubEntityModel.server.refreshMethodParameterClick(t.dictAttributes.ID,n.objEntity.dictAttributes.sfwObjectID).done(function(i){n.$evalAsync(function(){if(i){r.UndRedoBulkOp("Start");var u,f=t.Elements.filter(function(n){return n.Name=="parameters"});!f||f&&f.length==0?(u={Name:"parameters",Value:"",dictAttributes:{},Elements:[]},r.PushItem(u,t.Elements)):i.Parameters.length>0?(u=f[0],r.EditPropertyValue(u.Elements,u,"Elements",[])):r.DeleteItem(f[0],t.Elements);u&&n.AddOrRefreshObjectMethodParams(i,u);r.UndRedoBulkOp("End")}})})};n.PopulateRelatedEntity=function(t,i,r,u){var e,f;if(n.setObjectFieldForProperty(t,i,r,u),i.dictAttributes.sfwValue){for(e=o.getEntityIntellisense(),f=0;f<e.length;f++)if(e[f].BusinessObjectName==i.selecteditembusinessobjectname){i.dictAttributes.sfwEntity=e[f].ID;break}}else i.dictAttributes.sfwEntity="";l.validateEntity(i,n.validationErrorList)};n.CallValidateEmptyObjectField=function(t){n.objEntity&&n.objEntity.dictAttributes&&n.objEntity.dictAttributes.sfwObjectID&&l.validateEmptyObjectField(t,n.validationErrorList,"")};n.setObjectFieldForProperty=function(t,i,r,u){var f,s,e,o;i&&(i.dictAttributes.sfwValue=t,i.dictAttributes.hasOwnProperty("sfwDefaultValue")&&(i.dictAttributes.sfwDefaultValue=""),f=nt(),s=f.Elements.indexOf(r),u&&f.Elements.splice(s,1),n.objEntity&&n.objEntity.dictAttributes&&n.objEntity.dictAttributes.sfwObjectID&&l.validateEmptyObjectField(i,n.validationErrorList,i.dictAttributes.sfwValue),e=l.findDuplicateId(f,i.dictAttributes.sfwValue,c.ENTITY.NODES,"description",i,"dictAttributes.sfwValue"),e?(o=c.VALIDATION.DUPLICATE_FIELD,e.hasOwnProperty("isParent")&&e.isParent&&(o="Duplicate field present in parent entity "),i.warnings||angular.isObject(i.warnings)||(i.warnings={}),i.warnings.sfwValue=o):i.warnings&&delete i.warnings.sfwValue)};n.onKeyDownForQueryColumn=function(t){var r=$(t.target),i=[];n.objAttributes&&n.objAttributes.Elements&&n.objAttributes.Elements.length>0&&angular.forEach(n.objAttributes.Elements,function(n){n.dictAttributes.sfwType=="Column"&&n.dictAttributes.sfwValue&&i.push({ID:n.dictAttributes.sfwValue})});i.length>0&&setMultilevelAutoCompleteForObjectTreeIntellisense($(r),i,undefined,undefined,n)};n.scrollToPosition=function(t,i,r,u,f){v(function(){var e=$("#"+n.currentfile.FileName).find(t).find(i+" ul li span").filter(function(){return $(this).text()===r}),o=null;e&&e.length>1&&f&&e.each(function(){var t=$(this).parents("li").first(),n=t.scope().element;n&&n==f&&(o=$(this))});e=$(e)[0];o&&(e=o);e&&$("#"+n.currentfile.FileName).find(t).find(i).scrollTo(e,u,null)})};n.onBusinessMethodCommand=function(){var t=n.$new();t.objBusinessObject={};t.objBusinessObject.IsParentDialog=!0;t.afterOkClick=function(t){n.setExpressionValue(t)};n.objEntity&&n.objEntity.dictAttributes&&n.objEntity.dictAttributes.sfwObjectID&&(t.busObjectName=n.objEntity.dictAttributes.sfwObjectID,n.SelectedRule&&n.SelectedRule.dictAttributes.sfwObjectBased&&(t.IsObjectBased=n.SelectedRule.dictAttributes.sfwObjectBased),n.SelectedRule&&(t.BusinessObjectPropertyMethodDialog=r.showDialog(t,"Business Object Property / Method","Entity/views/ExpressionBuilder/BusinessObjectPropertyMethod.html",{width:1070,height:450})))};n.onQueryCommand=function(){var t=n.$new();t.objQuery={};t.objQuery.IsParentDialog=!0;t.afterOkClick=function(t){n.setExpressionValue(t)};n.objEntity&&n.objEntity.dictAttributes&&(t.busObjectName=n.objEntity.dictAttributes.sfwObjectID,n.SelectedRule&&n.SelectedRule.dictAttributes.sfwObjectBased&&(t.IsObjectBased=n.SelectedRule.dictAttributes.sfwObjectBased),n.SelectedRule&&(t.QueryDialog=r.showDialog(t,"Query","Entity/views/ExpressionBuilder/Query.html",{width:1070,height:450})))};n.onInternalFunctionsClick=function(){var t=n.$new();t.ObjInternalFunctions={};t.ObjInternalFunctions.IsParentDialog=!0;t.afterOkClick=function(t){n.setExpressionValue(t)};n.objEntity&&n.objEntity.dictAttributes&&(t.busObjectName=n.objEntity.dictAttributes.sfwObjectID,n.SelectedRule&&n.SelectedRule.dictAttributes&&n.SelectedRule.dictAttributes.sfwObjectBased&&(t.IsObjectBased=n.SelectedRule.dictAttributes.sfwObjectBased),n.SelectedRule&&(t.InternalFunctionsDialog=r.showDialog(t,"Internal Functions","Entity/views/ExpressionBuilder/InternalFunctions.html",{width:1070,height:450})))};n.setExpressionValue=function(t){if(t==undefined&&(t=""),n.SelectedRule&&n.SelectedRule.dictAttributes){var i=addTextAtCaret("textArea"+n.objEntity.dictAttributes.ID,t);r.EditPropertyValue(n.SelectedRule.dictAttributes.sfwExpression,n.SelectedRule.dictAttributes,"sfwExpression",i.trim())}};n.FindRuleIsPresentAsChild=function(n,t,i){for(var u=[],r=0;r<n.length;r++)if(n[r].dictAttributes.ID&&n[r].dictAttributes.ID==t){u.push(n[r]);break}else if(!i&&n[r].Children&&n[r].Children.length>0){if(u=n[r].Children.filter(function(n){return n.dictAttributes.ID&&n.dictAttributes.ID==t}),u.length>0){n[r].IsExpanded=!0;break}}else if(!i&&n[r].Elements&&n[r].Elements.length>0&&(u=n[r].Elements.filter(function(n){return n.dictAttributes.ID&&n.dictAttributes.ID==t}),u.length>0)){n[r].IsExpanded=!0;break}return u};n.selectValidationRuleInAllTypes=function(t,i,r,u){var f,e,v,o,s,h,c,l,a;if(n.SelectedRule=null,n.SelectedInitialLoad=null,n.SelectedHardError=null,n.SelectedSoftError=null,n.SelectedValidateDelete=null,t&&t.dictAttributes.ID&&(n.clearSelection(),n.objRules.Elements||n.objInheritedRules&&n.objInheritedRules.Elements)){if(f=[],e=n.objRules.Elements.filter(function(n){return n.dictAttributes.ID&&n.dictAttributes.ID==t.dictAttributes.ID}),e&&e.length>0&&n.selectedIneritedTab&&n.selectedIneritedTab=="Rule"?(n.SelectedRule=e[0],n.selectedIneritedTab="Rule"):n.objInheritedRules&&n.objInheritedRules.Elements&&(f=n.objInheritedRules.Elements.filter(function(n){return n.dictAttributes.ID&&n.dictAttributes.ID==t.dictAttributes.ID}),f&&f.length>0&&(n.SelectedRule=f[0],n.selectedIneritedTab="InheritedRule")),n.SelectedRule||(e&&e.length>0?(n.SelectedRule=e[0],n.selectedIneritedTab="Rule"):f&&f.length>0&&(n.SelectedRule=f[0],n.selectedIneritedTab="InheritedRule")),n.SelectedRule){if(n.SelectedRule.IsMessageSelected==undefined||n.SelectedRule.IsMessageSelected==""?n.SelectedRule.IsMessageSelected="MessageID":n.SelectedRule.dictAttributes.sfwMessageId&&(n.SelectedRule.IsMessageSelected="MessageID"),n.SelectedRule.dictAttributes.sfwMessage&&(n.SelectedRule.IsMessageSelected="Description"),n.SelectedRule.dictAttributes.sfwMessageId&&!n.SelectedRule.lstMessageParams)n.populateMessageByMessageID(n.SelectedRule.dictAttributes.sfwMessageId,n.SelectedRule.dictAttributes.sfwMessageParameters,!1);else if(n.SelectedRule.dictAttributes.sfwMessage&&(n.getParameterByDescription(n.SelectedRule.dictAttributes.sfwMessage,!1),n.SelectedRule.dictAttributes.sfwMessageParameters))for(v=n.SelectedRule.dictAttributes.sfwMessageParameters.split(";"),o=0;o<n.SelectedRule.lstMessageParams.length;o++)n.SelectedRule.lstMessageParams[o].Id=v[o];i&&r!="ValidationRule"&&(n.objInheritedRules?n.scrollToPosition("#validationrule",".inherited-rules-list",n.SelectedRule.dictAttributes.ID,{offsetTop:400,offsetLeft:0}):n.scrollToPosition("#validationrule",".page-sidebar-content",n.SelectedRule.dictAttributes.ID,{offsetTop:400,offsetLeft:0}))}n.objInitialLoad&&n.objInitialLoad.Elements&&(s=n.objInitialLoad.Elements.filter(function(n){return n.dictAttributes.ID&&n.dictAttributes.ID==t.dictAttributes.ID}),s.length>0&&(n.SelectedInitialLoad=s[0],i&&r!="InitialLoad"&&n.scrollToPosition("#entity-validation-initialload-section",".page-sidebar-content",n.SelectedInitialLoad.dictAttributes.ID,{offsetTop:400,offsetLeft:0})));n.objHardError&&n.objHardError.Elements&&(h=n.FindRuleIsPresentAsChild(n.objHardError.Elements,t.dictAttributes.ID,u),h.length>0&&(n.SelectedHardError=h[0],i&&r!="HardError"&&n.scrollToPosition("#entity-validation-harderror-section",".page-sidebar-content",n.SelectedHardError.dictAttributes.ID,{offsetTop:400,offsetLeft:0},n.SelectedHardError)));n.objSoftError&&n.objSoftError.Elements&&(c=n.FindRuleIsPresentAsChild(n.objSoftError.Elements,t.dictAttributes.ID,u),c.length>0&&(n.SelectedSoftError=c[0],i&&r!="SoftError"&&n.scrollToPosition("#entity-validation-softerror-section",".page-sidebar-content",n.SelectedSoftError.dictAttributes.ID,{offsetTop:400,offsetLeft:0},n.SelectedSoftError)));n.objValidateDelete&&n.objValidateDelete.Elements&&(l=n.objValidateDelete.Elements.filter(function(n){return n.dictAttributes.ID&&n.dictAttributes.ID==t.dictAttributes.ID}),l.length>0&&(n.SelectedValidateDelete=l[0],i&&r!="ValidateDelete"&&n.scrollToPosition("#entity-validation-delete-section",".page-sidebar-content",n.SelectedValidateDelete.dictAttributes.ID,{offsetTop:400,offsetLeft:0})));n.objGroupList&&n.objGroupList.Elements&&(a=n.FindRuleIsPresentAsChild(n.objGroupList.Elements,t.dictAttributes.ID),a.length>0&&(n.SelectedGroup=a[0],i&&r!="GroupList"&&n.scrollToPosition("#validation-rules-grouplist-section",".page-sidebar-content",n.SelectedGroup.dictAttributes.ID,{offsetTop:400})))}};n.addColumn=function(){var t={Name:"attribute",Value:"",Elements:[],Children:[],dictAttributes:{sfwType:"Column"}};r.PushItem(t,n.objAttributes.Elements);n.selectColumn(t);n.setFocustoTextbox("attributescolumn",!0,t)};n.deleteColumn=function(){var i,u,f,e,o,t;n.selectedColumn&&confirm("Attribute : '"+n.selectedColumn.dictAttributes.ID+"'   will be deleted, Do you want to continue?")&&(i=n.objAttributes.Elements.indexOf(n.selectedColumn),i>-1&&(r.UndRedoBulkOp("Start"),r.DeleteItem(n.selectedColumn,n.objAttributes.Elements,null),u=!1,f=function(n){return n.dictAttributes.sfwType=="Column"},n.objAttributes.Elements.some(f)&&(i==n.objAttributes.Elements.length&&i--,e=function(t){return n.objAttributes.Elements.indexOf(t)>=i&&t.dictAttributes.sfwType=="Column"},t=n.objAttributes.Elements.filter(e),t&&t.length>0?(n.selectColumn(t[0],!0),u=!0):(o=function(t){return n.objAttributes.Elements.indexOf(t)<=i&&t.dictAttributes.sfwType=="Column"},t=n.objAttributes.Elements.filter(o),t&&t.length>0&&(n.selectColumn(t[t.length-1],!0),u=!0))),u||n.selectColumn(null,!0),r.UndRedoBulkOp("End")))};n.createTable=function(t){r.ClearUndoRedoListByFileName(n.currentfile.FileName);r.IsLoading=!0;$.connection.hubEntityModel.server.createTable(r.currentopenfile.file.FileName,t).done(function(t){n.$evalAsync(function(){var i,u;if(t&&t.length>0)if(t.length===1&&t[0].Operation==="DB SYNC"&&t[0].Error)toastr.error(t[0].Error);else{for(i=n.$new(),i.lstSummaryReport=t,i.createTableQueryCount=0,i.alterTableQueryCount=0,i.createTableSuccessQueryCount=0,i.alterTableSuccessQueryCount=0,u=0;u<i.lstSummaryReport.length;u++)i.lstSummaryReport[u].Operation&&i.lstSummaryReport[u].Operation.toUpperCase()=="CREATE TABLE"?(i.createTableQueryCount++,i.lstSummaryReport[u].Error||i.createTableSuccessQueryCount++):i.lstSummaryReport[u].Operation&&i.lstSummaryReport[u].Operation.toUpperCase()=="ALTER TABLE"&&!i.lstSummaryReport[u].Error&&(i.alterTableQueryCount++,i.lstSummaryReport[u].Error||i.alterTableSuccessQueryCount++);i.summaryDialog=r.showDialog(i,"Summary Report","Entity/views/TableSummaryReport.html",{width:700,height:450});i.onOKClick=function(){i.summaryDialog.close();n.initialize()}}else toastr.info("No change found.");r.IsLoading=!1})})};n.syncDBWithEntity=function(){var t=getScopeByFileName("MainPage");t&&t.strDBConnection&&t.strDBConnection==="DB : Not Connected."?toastr.error("Database not connected."):confirm("This operation will update the database hierarchically as per your entity structure.\nAre you sure you want to continue?")&&n.createTable(!0)};n.validateLength=function(n){var i=!1,r=n.currentTarget,t=$(r).val(),u;return(n.keyCode===109||n.keyCode===77)&&$(r).val("MAX"),n.keyCode>=48&&n.keyCode<=57&&t=="MAX"&&$(r).val(""),t=$(r).val(),(t.trim()===""||t=="MAX"||t.indexOf(",")>-1)&&n.keyCode===44?i=!1:t==""&&n.keyCode>=48&&n.keyCode<=57?i=!0:(u=t.substr(t.length-1),i=u==","&&n.keyCode>=48&&n.keyCode<=57?!0:n.keyCode==44||n.keyCode>=48&&n.keyCode<=57?!0:!1),i===!1&&n.preventDefault(),i};n.onColumnDataTypeChanged=function(n){n&&n.dictAttributes&&["int","long","short"].indexOf(n.dictAttributes.sfwDataType)===-1&&(n.dictAttributes.sfwIsIdentity="")};v(function(){$("#"+n.currentfile.FileName).find(".entity-dashboard-items-wrapper").on("keydown",function(t){var i=t.which;return t.stopPropagation(),i==13?(n.currentFileObj&&n.currentFileObj.isSelected&&(r.openFile(n.currentFileObj),t.preventDefault()),!1):void 0})});n.DeletePropertyFromObject=function(t){n.SelectedRule&&!n.SelectedRule.dictAttributes[t]&&delete n.SelectedRule.dictAttributes[t]};n.validateReqMessageID=function(t,i){var r=l.getListByPropertyName(n.lstMessages,"MessageID");r.unshift("0");i=="ReqMsgID"&&(t.dictAttributes.sfwRequired=="True"?(t.dictAttributes.sfwReqMessageId="",l.checkValidListValue(r,t,t.dictAttributes.sfwReqMessageId,"sfwReqMessageId","sfwReqMessageId",c.VALIDATION.INVALID_MESSAGE_ID,undefined,!1)):t.dictAttributes.sfwRequired=="False"&&delete t.errors.sfwReqMessageId);i=="MaxMsgID"&&(t.dictAttributes.sfwMaxValue?l.checkValidListValue(r,t,t.dictAttributes.sfwMaxMessageId,"sfwMaxMessageId","sfwMaxMessageId",c.VALIDATION.INVALID_MESSAGE_ID,undefined,!1):(t.dictAttributes.sfwMaxMessageId!=""&&delete t.errors.sfwMaxMessageId,t.dictAttributes.sfwMaxMessageId==""&&t.errors.sfwMaxMessageId&&delete t.errors.sfwMaxMessageId));i=="MinMsgID"&&(t.dictAttributes.sfwMinValue?l.checkValidListValue(r,t,t.dictAttributes.sfwMinMessageId,"sfwMinMessageId","sfwMinMessageId",c.VALIDATION.INVALID_MESSAGE_ID,undefined,!1):(t.dictAttributes.sfwMinMessageId!=""&&delete t.errors.sfwMinMessageId,t.dictAttributes.sfwMinMessageId==""&&t.errors.sfwMinMessageId&&delete t.errors.sfwMinMessageId));t&&t.errors&&l.isEmptyObj(t.errors)&&l.removeObjInToArray(n.validationErrorList,t)};n.addNoLockToQueries=function(){for(var i,t=0;t<n.objEntity.Elements.length;t++)if(i=n.objEntity.Elements[t],i.Name=="queries"){n.HubCallToAddNolockQuery(i.Elements,0);break}};n.HubCallToAddNolockQuery=function(t,i){var u=t[i],o,e,s,h;if(u&&u.Name=="query"&&n.lstDBQueryTypes.length>0)for(o=n.lstDBQueryTypes,e=0;e<o.length;e++)o[e]&&o[e].Attribute&&u.dictAttributes[o[e].Attribute]&&(s=o[e].Attribute,u.dictAttributes[s]!=undefined&&u.dictAttributes[s]!=""&&(h=f.createQueryWithNoLock(u.dictAttributes[s]),h.then(function(f){f&&n.$evalAsync(function(){t.indexOf(u)==0&&(r.IsLoading=!0,r.UndRedoBulkOp("Start"));r.EditPropertyValue(u.dictAttributes[s],u.dictAttributes,s,f,"showSelectedQueryInEditor");n.showSelectedQueryInEditor();i++;i<t.length&&n.HubCallToAddNolockQuery(t,i);t.indexOf(u)==t.length-1&&(r.IsLoading=!1,r.UndRedoBulkOp("End"))})})))}}]);app.directive("scrolldirective",[function(){return{restrict:"A",scope:{scopeid:"="},link:function(n,t){var i=t[0],r;console.log("loading directive");r=0;t.bind("scroll",function(){if(i.scrollTop+i.offsetHeight>i.scrollHeight&&i.scrollTop>r){r=i.scrollTop-10;i.scrollHeight=i.scrollTop+i.scrollHeight;var n=GetCurrentScopeObject("Main");n.$apply(function(){n.LoadSomeData()})}})}}}]);app.directive("customvaluedraggable",[function(){return{restrict:"A",scope:{dragdata:"="},link:function(n,t){function r(t){n.dragdata!=undefined&&n.dragdata!=""&&(t.dataTransfer.setData("text",JSON.stringify(n.dragdata)),dragDropData=n.dragdata)}var i=t[0];i.localName=="li";i.draggable=!0;i.addEventListener("dragstart",r,!1)}}}]);app.directive("dropvalue",[function(){return{restrict:"A",scope:{dropdata:"=",scopeid:"=",parameter:"="},link:function(n,t){function r(t){return t.dataTransfer.dropEffect="copy",n.dropdata!=undefined&&n.dropdata!=""&&t.preventDefault&&t.preventDefault(),!1}function u(t){var i=angular.element(document.getElementById("ScopeId_"+n.scopeid)).scope(),r;t.preventDefault();r=JSON.parse(t.dataTransfer.getData("text"));i.$apply(function(){r!=undefined&&r!=""&&(n.dropdata=="input"?i.ObjSelectedlstValuesData.isExistingRule||i.setInputValues(r):n.dropdata=="output"?i.ObjSelectedlstValuesData.isExistingRule||i.setOutputValues(r):n.dropdata=="return"?i.ObjSelectedlstValuesData.isExistingRule||i.setReturnParameter(r):n.dropdata=="distinctfile"?i.DistinctFileValue=i.lstDummyColumns[r-1]:n.dropdata=="xvalue"?i.XAxisCellValue=i.lstDummyColumns[r-1]:n.dropdata=="yvalue"?i.YAxisCellValue=i.lstDummyColumns[r-1]:n.dropdata=="value"?i.Value=i.lstDummyColumns[r-1]:n.dropdata&&i.setValuesForExistingParameter(n.dropdata,r,n.parameter))});t.stopPropagation&&t.stopPropagation()}var i=t[0];i.addEventListener("dragover",r,!1);i.addEventListener("drop",u,!1)}}}]);app.directive("validationruleintellisense",["$compile","$rootScope",function(n){return{retrict:"E",replace:!0,scope:{model:"=",modebinding:"=",cssclass:"=",propertyname:"="},link:function(t,i){i.html("<div class='input-group'><input type='text' ng-class='cssclass' title='{{modebinding}}' ng-model='modebinding' ng-keydown='onkeydown($event)'  undoredodirective  model='model' propertyname='propertyname' /><span class='input-group-addon button-intellisense' ng-click='showValidationRules($event)'><\/span><\/div>");n(i.contents())(t);t.onkeydown=function(n){var t=$(n.target),r,u,i;(t.val()==undefined||t.val().trim()=="")&&(r=[],controllerScope=getCurrentFileScope(),controllerScope&&(u=controllerScope.objEntity.Elements.filter(function(n){return n.Name=="rules"}),u&&u.length>0&&(i=getDescendents(u[0]),i&&i.length>0&&(i=i.filter(function(n){return n.Name=="rule"}),angular.forEach(i,function(n){r.push({ID:n.dictAttributes.ID})}),controllerScope.objInheritedRules&&controllerScope.objInheritedRules.Elements&&controllerScope.objInheritedRules.Elements.length>0&&angular.forEach(controllerScope.objInheritedRules.Elements,function(n){r.push({ID:n.dictAttributes.ID})})))),setSingleLevelAutoComplete(t,r));n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")&&($(t).autocomplete("search",$(t).val()),n.preventDefault())};t.showValidationRules=function(n){var r,f,u,i;t.inputElement||(t.inputElement=$(n.target).prev());t.inputElement.focus();r=[];f=getCurrentFileScope();f&&(u=f.objEntity.Elements.filter(function(n){return n.Name=="rules"}),u&&u.length>0&&(i=getDescendents(u[0]),i&&i.length>0&&(i=i.filter(function(n){return n.Name=="rule"}),angular.forEach(i,function(n){r.push({ID:n.dictAttributes.ID})}))));t.inputElement&&r&&(setSingleLevelAutoComplete(t.inputElement,r,t),$(t.inputElement).data("ui-autocomplete")&&$(t.inputElement).autocomplete("search",$(t.inputElement).val()));n&&n.stopPropagation()}}}}]);app.directive("objecttreeintellisensetemplate",["$compile","$rootScope","$EntityIntellisenseFactory","CONSTANTS","$ValidationService",function(n,t,i,r,u){return{retrict:"E",replace:!0,scope:{busobject:"=",model:"=",objtree:"=",objectfield:"=",isloadmethod:"=",allowdrop:"=",isxmlmethod:"=",isdisabled:"=",onselectioncallback:"&",propertyname:"=",insidegrid:"=",entityname:"=",isloadonlymethod:"=",parentmodel:"=",errorprop:"=",isshowcollection:"=",validate:"="},template:"<div class='input-group'><span class='info-tooltip' ng-if='errorprop' ng-attr-title='{{errorprop}}' style='color:red !important'><i class='fa fa-exclamation-circle' aria-hidden='true'><\/i><\/span><input ng-class=\"insidegrid?'form-control form-filter input-sm':'form-control input-sm'\" type='text' ng-change='validateEntityField()' ng-disabled='isdisabled' title='{{objectfield}}' ng-model='objectfield' ng-keydown='onObjectFieldKeyDown($event)'  undoredodirective model='model' propertyname='propertyname' ng-blur='onTextBoxblur()' /><span class='input-group-addon button-intellisense' ng-disabled='isdisabled' ng-click='showObjectFieldList($event)'><\/span><\/div>",link:function(n,f){function s(t){return n.allowdrop&&(t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect="move"),t.stopPropagation&&t.stopPropagation(),!1}function h(i){if(i.stopPropagation&&i.stopPropagation(),n.allowdrop){$(i.currentTarget).trigger("click");var r=dragDropDataObject,u=dragDropData;n.$apply(function(){r&&(r.DataType=="ValueType"||r.DataType=="BusObjectType")?n.parentmodel&&n.parentmodel.Elements?n.parentmodel.Elements.some(function(n){return n.dictAttributes&&n.dictAttributes.sfwObjectField==u})||t.EditPropertyValue(n.objectfield,n,"objectfield",u):t.EditPropertyValue(n.objectfield,n,"objectfield",u):alert("Collection cannot be added.")});dragDropData=null;n.onselectioncallback()}else return!1}var o,e;n._objectField=n.objectfield;Object.defineProperty(n,"objectfield",{get:function(){return n._objectField},set:function(t){var i=n._objectField;n._objectField=t;setPropertyValue(n.model,n.propertyname,t);n.inputElement&&(n.objectFieldTextChanged(),n.selectionCallback())}});o=n.$watch("busobject",function(t,i){t!==i&&(n.objtree=undefined)});n.onTextBoxblur=function(){n.inputElement=undefined};n.LoadObjectTree=function(){n.busobject&&$.connection.hubEntityModel.server.loadObjectTree(n.busobject,"",!0).done(function(t){n.$evalAsync(function(){n.receiveObjectTree(t);n.Init();n.objectFieldTextChanged();$(n.inputElement).data("ui-autocomplete")!==undefined&&$(n.inputElement).autocomplete("search",$(n.inputElement).val())})})};n.receiveObjectTree=function(t,r){var f,u,o,e;t=JSON.parse(t);f=t;r!=undefined&&r!=""?(u=getBusObjectByPath(r,n.objtree),u&&u.ItemType.Name==f.ObjName&&(u.ChildProperties=f.ChildProperties,u.lstMethods=f.lstMethods,u.HasLoadedProp=!0),SetParentForObjTreeChild(u)):(n.objtree=f,n.objtree.IsMainBusObject=!0,n.objtree.IsVisible=!0,SetParentForObjTreeChild(n.objtree),o=i.getEntityIntellisense(),e=o.filter(function(t){return t.ID==n.entityname}),e!=undefined&&e.length>0&&e[0].Rules.length>0&&(n.objtree.Rules=e[0].Rules))};n.getData=function(t,i){var r;return angular.forEach(i,function(i){if(r==undefined){if(i.ShortName==t)return r=i;if(i.ChildProperties.length>0&&(r=n.getData(t,i.ChildProperties),r!=undefined))return r}}),r};n.SetIntellisenseData=function(n,t,i){if(i){var r=getBusObjectByPath(i,t);r&&r.ItemType.Name==n.ObjName&&(r.ChildProperties=n.ChildProperties,r.lstMethods=n.lstMethods,r.HasLoadedProp=!0)}};n.Init=function(){var i,u,t,r,f;if(n.objectfield!=undefined&&n.objectfield!=""&&(i=n.objectfield.split("."),u="",i.length>0&&n.objtree&&(t=n.objtree,t&&t.ChildProperties)))for(r=0;r<i.length;r++)if(t&&t.ChildProperties.length>0&&(t=n.getData(i[r],t.ChildProperties),t&&(t.HasLoadedProp==undefined||!t.HasLoadedProp)&&(f=i.filter(function(n,t){return t>r}),t.DataType!="ValueType"))){u+=i[r];$.connection.hubEntityModel.server.loadObjectTreeIntellisenseForProp(t.ItemType.Name,f,u).done(function(t){n.$evalAsync(function(){var i,r;n.objtree!=undefined&&(i=t,n.SetIntellisenseData(i,n.objtree,u),$(document.activeElement).length>0&&(document.activeElement.localName=="input"?$(document.activeElement).val().contains(".")&&$(document.activeElement).val().lastIndexOf(".")==$(document.activeElement).val().length-1&&setMultilevelAutoCompleteForObjectTreeIntellisense($(document.activeElement),i.ChildProperties,"ShortName",undefined,n):document.activeElement.localName=="textarea"&&(r=i.ChildProperties,r=r.concat(i.lstMethods),setMultilevelAutoCompleteForObjectTreeIntellisense($(document.activeElement),i.ChildProperties,"ShortName",undefined,n))))})});break}};n.selectionCallback=function(){n.$evalAsync(function(){var t,i,r,u;if(n.inputElement&&(n.inputElement.val().contains(".")?(i=n.inputElement.val(),i=i.substring(0,i.lastIndexOf(".")),i&&(t=getBusObjectByPath(i,n.objtree))):t=n.objtree,t&&t.ChildProperties&&t.ChildProperties.length>0&&n.inputElement.val().length>0&&(r=t.ChildProperties.filter(function(t){return t.FullPath==n.inputElement.val().trim()}),n.model&&(n.model.selecteditembusinessobjectname=r.length>0?r[0].ItemType.Name:"")),n.onselectioncallback)){u=n.inputElement?n.inputElement.val():"";n.onselectioncallback({id:u,model:n.model})}})};n.objectFieldTextChanged=function(){var r,u,i,t;n.objtree?n.objtree!=undefined&&n.inputElement&&(n.inputElement.val()==undefined||n.inputElement.val().trim()==""?n.isxmlmethod?(data=[],n.objtree.ChildProperties&&!n.isloadonlymethod&&(data=data.concat(n.objtree.ChildProperties)),n.objtree.lstMethods&&(data=data.concat(n.objtree.lstMethods)),n.objtree.Rules&&!n.isloadonlymethod&&(data=data.concat(n.objtree.Rules)),n.isloadonlymethod?setSingleLevelAutoComplete(n.inputElement,data,n,"ShortName","Description",n.selectionCallback):setMultilevelAutoCompleteForObjectTreeIntellisense(n.inputElement,data,"ShortName",n.onselectioncallback,n)):n.isloadonlymethod?setSingleLevelAutoComplete(n.inputElement,data,n,"ShortName","Description",n.selectionCallback):(t=[],t=n.isshowcollection==!1?n.getFilteredProperties(n.objtree.ChildProperties):n.objtree.ChildProperties,setMultilevelAutoCompleteForObjectTreeIntellisense(n.inputElement,t,"ShortName",n.onselectioncallback,n)):n.inputElement.val().contains(".")?(r=n.inputElement.val(),u=getSplitArray(n.inputElement.val(),n.inputElement[0].selectionStart),r=u.join("."),r=r.substring(0,r.lastIndexOf(".")),i=getBusObjectByPath(r,n.objtree),!i&&n.objtree&&(i=n.objtree),i&&(n.isloadonlymethod?setSingleLevelAutoComplete(n.inputElement,data,n,"ShortName","Description"):(t=[],n.isshowcollection==!1?t=n.getFilteredProperties(i.ChildProperties):(t=i.ChildProperties,i.lstMethods&&i.lstMethods.length>0&&(t=t.concat(i.lstMethods))),setMultilevelAutoCompleteForObjectTreeIntellisense(n.inputElement,t,"ShortName",n.onselectioncallback,n)))):n.objtree!=undefined&&(n.isxmlmethod?(data=[],n.objtree.ChildProperties&&!n.isloadonlymethod&&(data=data.concat(n.objtree.ChildProperties)),n.objtree.lstMethods&&(data=data.concat(n.objtree.lstMethods)),n.objtree.Rules&&!n.isloadonlymethod&&(data=data.concat(n.objtree.Rules)),n.isloadonlymethod?setSingleLevelAutoComplete(n.inputElement,data,n,"ShortName","Description"):setMultilevelAutoCompleteForObjectTreeIntellisense(n.inputElement,data,"ShortName",n.onselectioncallback,n)):n.isloadonlymethod?setSingleLevelAutoComplete(n.inputElement,data,n,"ShortName","Description"):(t=[],t=n.isshowcollection==!1?n.getFilteredProperties(n.objtree.ChildProperties):n.objtree.ChildProperties,setMultilevelAutoCompleteForObjectTreeIntellisense(n.inputElement,t,"ShortName",n.onselectioncallback,n)))):n.busobject&&n.LoadObjectTree()};n.getFilteredProperties=function(n){for(var i=[],t=0;t<n.length>0;t++)(n[t].DataType=="ValueType"||n[t].DataType=="BusObjectType"||n[t].DataType=="TableObjectType"||n[t].DataType=="OtherReferenceType")&&i.push(n[t]);return i};n.showObjectFieldList=function(t){n.inputElement||(n.inputElement=$(t.target).prevAll("input[type='text']"));n.inputElement.focus();var i=[];n.objtree||n.busobject&&n.LoadObjectTree();n.isxmlmethod?(n.objtree&&n.objtree.ChildProperties&&!n.isloadonlymethod&&(i=i.concat(n.objtree.ChildProperties)),n.objtree&&n.objtree.lstMethods&&(i=i.concat(n.objtree.lstMethods)),n.objtree&&n.objtree.Rules&&!n.isloadonlymethod&&(i=i.concat(n.objtree.Rules)),n.isloadonlymethod?setSingleLevelAutoComplete(n.inputElement,i,n,"ShortName","Description",n.selectionCallback):setMultilevelAutoCompleteForObjectTreeIntellisense(n.inputElement,i,"ShortName",n.onselectioncallback,n)):n.objtree&&(n.isloadonlymethod?setSingleLevelAutoComplete(n.inputElement,i,n,"ShortName","Description",n.selectionCallback):setMultilevelAutoCompleteForObjectTreeIntellisense(n.inputElement,n.objtree.ChildProperties,"ShortName",n.onselectioncallback,n));n.inputElement&&$(n.inputElement).data("ui-autocomplete")&&$(n.inputElement).autocomplete("search",$(n.inputElement).val());t&&t.stopPropagation()};n.onObjectFieldKeyDown=function(t){n.inputElement=$(t.target);(t.ctrlKey&&t.keyCode===$.ui.keyCode.SPACE||t.keyCode===$.ui.keyCode.PERIOD)&&(n.objtree?(n.objectFieldTextChanged(t),$(n.inputElement).data("ui-autocomplete")!==undefined&&$(n.inputElement).autocomplete("search",$(n.inputElement).val())):n.busobject&&n.LoadObjectTree(),t.ctrlKey&&t.keyCode===$.ui.keyCode.SPACE&&t.preventDefault())};e=f[0];e.addEventListener("dragover",s,!1);e.addEventListener("drop",h,!1);n.validateEntityField=function(){var f,e,t,i;if(n.propertyname&&n.validate){for(f=n.propertyname.split("."),property=f[f.length-1],e=r.VALIDATION.ENTITY_FIELD_INCORRECT,property!="sfwEntityField"&&(e=r.VALIDATION.INVALID_FIELD),t=[],n.objtree&&n.objtree.ChildProperties&&(t=u.getListByPropertyName(n.objtree.ChildProperties,"Name",!1)),i=0;i<t.length;i++)t[i]=t[i].split(":")[0];u.checkValidListValue(t,n.model,$(n.inputElement).val(),property,property,r.VALIDATION.INVALID_FIELD,undefined)}}}}}]);app.directive("customruledraggable",[function(){return{restrict:"A",scope:{dragdata:"="},link:function(n,t){function r(){n.dragdata.Name=="rule"&&(dragDropData=null,dragDropData=n.dragdata)}var i=t[0];i.localName=="li";i.draggable=!0;i.addEventListener("dragstart",r,!1)}}}]);app.directive("droprule",["$rootScope",function(n){return{restrict:"A",scope:{dropdata:"=",selectedsection:"="},link:function(t,i){function u(n){return n.dataTransfer.dropEffect="copy",t.dropdata&&t.dropdata.Name&&(t.dropdata.Name=="group"||t.dropdata.Name=="item"||t.dropdata.Name=="harderror"||t.dropdata.Name=="softerror")&&n.preventDefault&&n.preventDefault(),!1}function f(i){var e=getCurrentFileScope(),r,o,u,f;if(i.preventDefault(),r=dragDropData,r!=null){if(o=e.GetRuleByName(r.dictAttributes.ID),t.dropdata.Name=="group"&&r.Name=="rule")u={Name:"item",value:"",dictAttributes:{ID:r.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[]},t.dropdata.dictAttributes&&(u.ParentID=t.dropdata.dictAttributes.ID),u.objRule=o,f=!1,angular.forEach(t.dropdata.Elements,function(n){n.dictAttributes.ID==u.dictAttributes.ID&&(f=!0)}),t.$apply(function(){f?alert("Cannot add the selected rule to validation. Same rule already exists."):(n.UndRedoBulkOp("Start"),n.PushItem(u,t.dropdata.Elements,"SelectGroupClick"),e.setValidationRuleCheckboxValue(r.dictAttributes.ID,!0,"Group"),e.SelectGroupClick(u),n.UndRedoBulkOp("End"))});else if(r.Name=="rule"&&t.selectedsection=="HardError"){if(t.dropdata.Name=="harderror")u={Name:"item",value:"",dictAttributes:{ID:r.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[],Children:[]},u.objRule=o,f=!1,angular.forEach(t.dropdata.Elements,function(n){n.dictAttributes.ID==u.dictAttributes.ID&&(f=!0)}),t.$apply(function(){if(f)alert("Cannot add the selected rule to validation. Same rule already exists as a Parent.");else{if((r.dictAttributes.sfwMessageId==undefined||r.dictAttributes.sfwMessageId=="")&&(r.dictAttributes.sfwMessage==undefined||r.dictAttributes.sfwMessage=="")){alert("Cannot add the selected rule to validation. Rule must contain MessageID/Description.");return}n.UndRedoBulkOp("Start");n.PushItem(u,t.dropdata.Elements,"SelectHardError");e.SelectHardError(u);e.setValidationRuleCheckboxValue(r.dictAttributes.ID,!0,"HardError");n.UndRedoBulkOp("End")}});else if(t.dropdata.Name=="item"){if(u={Name:"rule",value:"",dictAttributes:{ID:r.dictAttributes.ID,sfwStatus:"Active"},Elements:[]},u.objRule=o,f=!1,t.dropdata.dictAttributes.ID==r.dictAttributes.ID){alert("Cannot add the selected rule to validation. Same rule already exists.");i.stopPropagation&&i.stopPropagation();return}t.dropdata!=undefined&&t.dropdata.Children!=undefined&&t.dropdata.Children!=null&&angular.forEach(t.dropdata.Children,function(n){n.dictAttributes.ID==u.dictAttributes.ID&&(f=!0)});t.$apply(function(){if(f)alert("Cannot add the selected rule to validation. Same rule already exists.");else{if((r.dictAttributes.sfwMessageId==undefined||r.dictAttributes.sfwMessageId=="")&&(r.dictAttributes.sfwMessage==undefined||r.dictAttributes.sfwMessage=="")){alert("Cannot add the selected rule to validation. Rule must contain MessageID/Description.");return}t.dropdata!=undefined&&t.dropdata.Children!=undefined&&t.dropdata!=null&&t.dropdata.Children!=null&&(n.UndRedoBulkOp("Start"),n.PushItem(u,t.dropdata.Children,"SelectHardError"),e.SelectHardError(u),e.setValidationRuleCheckboxValue(r.dictAttributes.ID,!0,"HardErrorAsChild"),n.UndRedoBulkOp("End"))}})}}else if(r.Name=="rule"&&t.selectedsection=="SoftError")if(t.dropdata.Name=="softerror")u={Name:"item",value:"",dictAttributes:{ID:r.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[],Children:[]},u.objRule=o,f=!1,angular.forEach(t.dropdata.Elements,function(n){n.dictAttributes.ID==u.dictAttributes.ID&&(f=!0)}),t.$apply(function(){if(f)alert("Cannot add the selected rule to validation. Same rule already exists as a Parent.");else{if((r.dictAttributes.sfwMessageId==undefined||r.dictAttributes.sfwMessageId=="")&&(r.dictAttributes.sfwMessage==undefined||r.dictAttributes.sfwMessage=="")){alert("Cannot add the selected rule to validation. Rule must contain MessageID/Description.");return}n.UndRedoBulkOp("Start");n.PushItem(u,t.dropdata.Elements,"SelectSoftError");e.SelectSoftError(u);e.setValidationRuleCheckboxValue(r.dictAttributes.ID,!0,"SoftError");n.UndRedoBulkOp("End")}});else if(t.dropdata.Name=="item"){if(u={Name:"rule",value:"",dictAttributes:{ID:r.dictAttributes.ID,sfwStatus:"Active"},Elements:[]},u.objRule=o,f=!1,t.dropdata.dictAttributes.ID==r.dictAttributes.ID){alert("Cannot add the selected rule to validation. Same rule already exists.");i.stopPropagation&&i.stopPropagation();return}angular.forEach(t.dropdata.Children,function(n){n.dictAttributes.ID==u.dictAttributes.ID&&(f=!0)});t.$apply(function(){if(f)alert("Cannot add the selected rule to validation. Same rule already exists.");else{if((r.dictAttributes.sfwMessageId==undefined||r.dictAttributes.sfwMessageId=="")&&(r.dictAttributes.sfwMessage==undefined||r.dictAttributes.sfwMessage=="")){alert("Cannot add the selected rule to validation. Rule must contain MessageID/Description.");return}n.UndRedoBulkOp("Start");n.PushItem(u,t.dropdata.Children,"SelectSoftError");e.SelectSoftError(u);e.setValidationRuleCheckboxValue(r.dictAttributes.ID,!0,"SoftErrorAsChild");n.UndRedoBulkOp("End")}})}i.stopPropagation&&i.stopPropagation();dragDropData=null}}var r=i[0];r.addEventListener("dragover",u,!1);r.addEventListener("drop",f,!1)}}}]);app.directive("dropruleinchecklist",["$rootScope",function(n){return{restrict:"A",scope:{dropruledata:"="},link:function(t,i){function u(n){return n.dataTransfer.dropEffect="copy",canDropRuleinChecklist(dragDropData,t.dropruledata)&&(t.dropruledata.Name=="checklist"||t.dropruledata.Name=="initialload"||t.dropruledata.Name=="validatedelete")&&n.preventDefault&&n.preventDefault(),!1}function f(i){var e=getCurrentFileScope(),u,o,r,f;i.preventDefault();u=dragDropData;u!=null&&(o=e.GetRuleByName(u.dictAttributes.ID),t.dropruledata.Name=="checklist"?(r={Name:"item",value:"",dictAttributes:{ID:u.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[]},r.objRule=o,f=!1,angular.forEach(t.dropruledata.Elements,function(n){n.dictAttributes.ID==r.dictAttributes.ID&&(f=!0)}),t.$apply(function(){f?alert("Cannot add the selected rule to validation. Same rule already exists."):(n.UndRedoBulkOp("Start"),n.PushItem(r,t.dropruledata.Elements,"SelectCheckListClick"),e.setValidationRuleCheckboxValue(u.dictAttributes.ID,!0,"CheckList"),e.SelectedCheckList=r,n.UndRedoBulkOp("End"))})):t.dropruledata.Name=="initialload"?(r={Name:"item",value:"",dictAttributes:{ID:u.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[]},r.objRule=o,f=!1,angular.forEach(t.dropruledata.Elements,function(n){n.dictAttributes.ID==r.dictAttributes.ID&&(f=!0)}),t.$apply(function(){f?alert("Cannot add the selected rule to validation. Same rule already exists."):(n.UndRedoBulkOp("Start"),n.PushItem(r,t.dropruledata.Elements,"SelectedInitialLoadClick"),e.SelectedInitialLoadClick(r),e.setValidationRuleCheckboxValue(u.dictAttributes.ID,!0,"InitialLoad"),n.UndRedoBulkOp("End"))})):t.dropruledata.Name=="validatedelete"&&(r={Name:"item",value:"",dictAttributes:{ID:u.dictAttributes.ID,sfwMode:"All",sfwStatus:"Active"},Elements:[]},r.objRule=o,f=!1,angular.forEach(t.dropruledata.Elements,function(n){n.dictAttributes.ID==r.dictAttributes.ID&&(f=!0)}),t.$apply(function(){if(f)alert("Cannot add the selected rule to validation. Same rule already exists.");else{if((u.dictAttributes.sfwMessageId==undefined||u.dictAttributes.sfwMessageId=="")&&(u.dictAttributes.sfwMessage==undefined||u.dictAttributes.sfwMessage=="")){alert("Cannot add the selected rule to validation. Rule must contain MessageID/Description.");return}n.UndRedoBulkOp("Start");n.PushItem(r,t.dropruledata.Elements,"SelectedValidateDeleteClick");e.SelectedValidateDeleteClick(r);e.setValidationRuleCheckboxValue(u.dictAttributes.ID,!0,"ValidateDelete");n.UndRedoBulkOp("End")}})),dragDropData=null)}var r=i[0];r.addEventListener("dragover",u,!1);r.addEventListener("drop",f,!1)}}}]);app.directive("checklistitemcommontemplate",["$compile","$http","$rootScope","ngDialog",function(n,t,i,r){return{restrict:"E",replace:!0,scope:{model:"=",codevalues:"=",iscontroldisable:"=",entitymodel:"="},link:function(n){n.GetCheckListDescription=function(t){n.codeDescription=t};n.SetCheckList=function(){n.objCheckListValue!=undefined&&(n.model.dictAttributes.sfwChecklistValue=n.objCheckListValue.CodeID,n.codeDescription=n.objCheckListValue.Description,r.close(openedDialogId))};n.OnSelectChecklist=function(t){n.objCheckListValue=t};n.CloseCheckList=function(){r.close(openedDialogId)};n.GetCheckListDescription()},templateUrl:function(n,t){return t.templateUrl||"Entity/views/CheckItemTemplate.html"}}}]);app.directive("colResizeableJquery",[function(){return{restrict:"A",link:function(n,t){t.on("mouseenter",function(i){var r,u;i.preventDefault();i.stopPropagation();i.stopImmediatePropagation();r="#"+t[0].id;t[0].id!=undefined&&t[0].id!=""&&(u=r+" tr th",r!="#tblBusinessObjectMethod"?n.$evalAsync(function(){$(u).resizable({handles:"e",minWidth:10,grid:50,alsoResize:r})}):n.$apply(function(){$(u).resizable({handles:"e",minWidth:10})}))})}}}]);app.directive("colResizeableExcelMatrics",[function(){return{restrict:"A",link:function(n,t){t.on("mouseenter",function(i){i.preventDefault();i.stopPropagation();i.stopImmediatePropagation();var r="#"+t[0].id,u=r+" tr td";n.$apply(function(){$(u).resizable({handles:"e",minWidth:10,grid:50,alsoResize:r})})})}}}]);app.directive("commonEntityTreeDirective",["$compile",function(){return{restrict:"E",replace:!0,scope:{collection:"=",childCollectionProperty:"=",textProperty:"=",expandedProperty:"=",onitemdblclickCallback:"=",onitemclickCallback:"=",parentTextProperty:"=",contextmenuproperty:"=",filtertext:"=",selecteditem:"=",validationruletype:"=",selectedsection:"=",validationerrorobject:"="},link:function(n){n.onItemDoubleClick=function(t,i){if(n.onitemdblclickCallback)n.onitemdblclickCallback(t,i)};n.onItemClick=function(t,i){if(n.selecteditem=t,n.onitemclickCallback)n.onitemclickCallback(t,i,n.selectedsection)};n.toggleExpandCollapse=function(n,t){t.IsExpanded=!t.IsExpanded};n.getPropertyValue=getPropertyValue},templateUrl:"Entity/views/TreeTemplateForEntity.html"}}]);app.directive("commonEntityTreeChildDirective",[function(){return{restrict:"A",replace:!0,scope:!1,templateUrl:"Entity/views/TreeItemsTemplateForEntity.html"}}]);app.directive("newbusobjecttreedirective",["$compile","$rootScope",function(n,t){return{restrict:"E",replace:!0,scope:{busobjectname:"=",isshowproperties:"=",isshowmethods:"=",isshowrules:"=",selectedfield:"=",lstdisplaybusinessobject:"=",lstmultipleselectedfields:"=",lstcurrentbusinessobjectproperties:"=",ischeckboxvisible:"=",selectedfieldclick:"&"},link:function(n){var i=n.$watch("busobjectname",function(){n.Init()});n.AddClsBusinessObject=function(i,r,u,f){var e,o,s;n.isParentFieldCollection=f=="Collection"||f=="List"?!0:!1;e={};o="";o=n.checkObjectIsPresent(i);o==""?(s=n.isshowmethods?!0:!1,$.connection.hubEntityModel.server.loadObjectTree(i,"",s).done(function(o){var s=o;s=JSON.parse(s);n.$evalAsync(function(){n.ChildProperties=[];n.lstMethods=[];t.IsLoading=!1;n.lstChildPropertiesandMethods=[];s.ChildProperties&&(n.ChildProperties=s.ChildProperties);s.lstMethods&&(n.lstMethods=s.lstMethods);n.isshowproperties&&(n.lstChildPropertiesandMethods=n.ChildProperties);n.isshowmethods&&(n.lstChildPropertiesandMethods=n.lstChildPropertiesandMethods.concat(n.lstMethods));sortListBasedOnproperty(n.lstChildPropertiesandMethods,"","Name");e={IsVisible:!0,strBusinessobjectId:i,Properties:n.lstChildPropertiesandMethods,SortedProperties:n.lstChildPropertiesandMethods};n.lstcurrentbusinessobjectproperties=e.Properties;n.lstBusinessObjects.push(e);n.AddClsDisplayBusinessObject(e,r,u,f);n.setVisibilityForBusinessObjectOrDisplayBusinessObject(n.lstBusinessObjects,i,"BusinessObject")})})):(e=o,n.lstcurrentbusinessobjectproperties=e.Properties,n.AddClsDisplayBusinessObject(e,r,u,f),n.setVisibilityForBusinessObjectOrDisplayBusinessObject(n.lstBusinessObjects,i,"BusinessObject"))};n.AddClsDisplayBusinessObject=function(t,i,r,u){var f={IsVisible:!0,strDisplayName:i,strID:t.strBusinessobjectId,ClsBusinessObject:t,strParentID:r,DataType:u,isParentFieldCollection:n.isParentFieldCollection};n.lstDisplayBusinessObject.push(f);n.lstdisplaybusinessobject=n.lstDisplayBusinessObject;n.setVisibilityForBusinessObjectOrDisplayBusinessObject(n.lstDisplayBusinessObject,i,"DisplayBusinessObject")};n.setVisibilityForBusinessObjectOrDisplayBusinessObject=function(t,i,r){for(var u=0;u<t.length;u++)r=="BusinessObject"?t[u].strBusinessobjectId==i?(t[u].IsVisible=!0,n.currentBusinessObject=t[u],t[u].SortedProperties=t[u].Properties,n.lstcurrentbusinessobjectproperties=t[u].Properties):t[u].IsVisible=!1:t[u].strDisplayName==i?(t[u].IsVisible=!0,n.objBusinessObjectFilter.DisplayPath=t[u].strDisplayName):t[u].IsVisible=!1;n.objBusinessObjectFilter.LimitCount=35};n.Init=function(){n.lstBusinessObjects=[];n.lstDisplayBusinessObject=[];n.objBusinessObjectFilter={};n.objBusinessObjectFilter.ObjectTreeFilter="";n.objBusinessObjectFilter.LimitCount=35;n.objBusinessObjectFilter.DisplayPath="";n.currentBusinessObject="";n.busobjectname&&n.AddClsBusinessObject(n.busobjectname,"",null,"")};n.Navigatetoprevlist=function(){n.lstDisplayBusinessObject.length>1&&(ClearSelectedFieldList(n.lstChildPropertiesandMethods),n.lstmultipleselectedfields=[],n.IsSelectAll=!1,n.lstDisplayBusinessObject.splice(n.lstDisplayBusinessObject.length-1,1),n.lstDisplayBusinessObject[n.lstDisplayBusinessObject.length-1].IsVisible=!0,n.setVisibilityForBusinessObjectOrDisplayBusinessObject(n.lstBusinessObjects,n.lstDisplayBusinessObject[n.lstDisplayBusinessObject.length-1].strID,"BusinessObject"),n.setVisibilityForBusinessObjectOrDisplayBusinessObject(n.lstDisplayBusinessObject,n.lstDisplayBusinessObject[n.lstDisplayBusinessObject.length-1].strDisplayName,"DisplayBusinessObject"))};n.getPathFromDisplayedBusinessObjects=function(){for(var i="",t=0;t<n.lstDisplayBusinessObject.length;t++)if(n.lstDisplayBusinessObject[t].IsVisible){i=n.lstDisplayBusinessObject[t].strDisplayName;break}return i};n.isValidField=function(n){var t=!1;return(n.DataType=="CDOCollection"||n.DataType=="List"||n.DataType=="CollctionType"||n.DataType=="BusObjectType"||n.DataType=="TableObjectType"||n.DataType=="OtherReferenceType"||n.DataTypeName=="CDOCollection"||n.DataTypeName=="List"||n.DataTypeName=="CollctionType"||n.DataTypeName=="BusObjectType"||n.DataTypeName=="TableObjectType"||n.DataTypeName=="OtherReferenceType")&&(t=!0),t};n.LoadNextLevelObjectField=function(t,i){var s=GetFullItemPathFromBusObjectTree(t),e=n.isValidField(t),f;if(t.ItemType&&e){var r=n.getPathFromDisplayedBusinessObjects(),o=t.DataType,u="";u=r!=""?r+"."+t.ShortName:t.ShortName;f=n.getParentBusinessObject();ClearSelectedFieldList(n.lstChildPropertiesandMethods);n.lstmultipleselectedfields=[];n.IsSelectAll=!1;n.AddClsBusinessObject(t.ItemType.Name,u,f,o)}i&&i.stopPropagation()};n.getParentBusinessObject=function(){for(var i="",t=0;t<n.lstBusinessObjects.length;t++)if(n.lstBusinessObjects[t].IsVisible){i=n.lstBusinessObjects[t].strBusinessobjectId;break}return i};n.checkObjectIsPresent=function(t){for(var r="",i=0;i<n.lstBusinessObjects.length;i++)if(n.lstBusinessObjects[i].strBusinessobjectId==t){r=n.lstBusinessObjects[i];break}return r};n.sortList=function(t,i){var r,l;if(i!=""){var f=[],e=[],o=[],s=[],h=[],c=[],u="Name";for(r=0;r<t.Properties.length;r++)t.Properties[r][u]==i?f.push(t.Properties[r]):t.Properties[r][u].toLowerCase()==i.toLowerCase()?e.push(t.Properties[r]):t.Properties[r][u].indexOf(i)==0?o.push(t.Properties[r]):t.Properties[r][u].toLowerCase().indexOf(i.toLowerCase())==0?s.push(t.Properties[r]):t.Properties[r][u].contains(i)?h.push(t.Properties[r]):t.Properties[r][u].toLowerCase().contains(i.toLowerCase())&&c.push(t.Properties[r]);l=f.concat(e).concat(o).concat(s).concat(h).concat(c);t.SortedProperties=l}else t.SortedProperties=t.Properties;n.objBusinessObjectFilter.LimitCount=35};n.lstmultipleselectedfields=[];n.IsSelectAll=!1;n.RemoveOrIsFieldPresentFromMultipleSelectedField=function(t,i){for(var u=!1,r=0;r<n.lstmultipleselectedfields.length;r++)if(n.lstmultipleselectedfields[r].Name==t.Name){i=="Delete"?n.lstmultipleselectedfields.splice(r,1):i=="bool"&&(u=!0);break}return u};n.selectField=function(t,i){var u,r;if(n.selectedfield&&!i.ctrlKey?(n.selectedfield.IsRecordSelected=!1,n.ischeckboxvisible||(n.selectedfield.IsSelected="False")):n.selectedfield&&(u=n.RemoveOrIsFieldPresentFromMultipleSelectedField(n.selectedfield,"bool"),u||n.lstmultipleselectedfields.push(n.selectedfield),n.selectedfield=undefined),i.ctrlKey||(n.selectedfield=t,n.selectedfield.IsRecordSelected=!0),i&&(i.stopPropagation(),i.stopImmediatePropagation()),!n.ischeckboxvisible)if(i.ctrlKey)t.IsRecordSelected?(t.IsRecordSelected=!1,t.IsSelected="False",n.RemoveOrIsFieldPresentFromMultipleSelectedField(t,"Delete")):(t.IsRecordSelected=!0,t.IsSelected="True",n.lstmultipleselectedfields.push(t));else{for(r=0;r<n.lstmultipleselectedfields.length;r++)n.lstmultipleselectedfields[r].IsRecordSelected=!1,n.lstmultipleselectedfields[r].IsSelected="False";n.lstmultipleselectedfields=[];t.IsRecordSelected=!0;t.IsSelected="True"}n.selectedfieldclick&&n.selectedfieldclick({selectedfield:n.selectedfield})};n.AddIntoSelectedList=function(t){if(n.ischeckboxvisible&&n.lstmultipleselectedfields)if(t.IsSelected=="True")n.lstmultipleselectedfields.push(t);else for(var i=0;i<n.lstmultipleselectedfields.length;i++)if(n.lstmultipleselectedfields[i].ShortName==t.ShortName){n.lstmultipleselectedfields.splice(i,1);break}};n.OnChangeSelectAll=function(t){n.lstmultipleselectedfields=[];for(var i=0;i<n.lstcurrentbusinessobjectproperties.length;i++)t?(n.lstcurrentbusinessobjectproperties[i].IsSelected="True",n.lstmultipleselectedfields.push(n.lstcurrentbusinessobjectproperties[i])):n.lstcurrentbusinessobjectproperties[i].IsSelected="False"}},templateUrl:"Entity/views/ObjTree/BusObjectTreeTemplate.html"}}]);app.directive("busobjecttreechildtemplate",[function(){return{restrict:"A",replace:!0,scope:!1,templateUrl:"Entity/views/ObjTree/BusObjectTreeChildWrapper.html"}}]);app.directive("entityquerytemplate",[function(){return{restrict:"A",replace:!0,scope:!1,templateUrl:"Entity/views/EntityQueryTree.html"}}]);app.directive("validationrulestreeview",["$compile",function(n){var t=function(){return"<div> <ul> <li ng-repeat='element in lstrules.Elements |filter:{dictAttributes:{[filterproperty]:filtertext}} track by $index' aria-selected='false' customruledraggable dragdata='element' ng-class=\"classforchild?'marg-left-20':''\"> <div context-menu='menuoptionforrules' ng-class=\"element==selecteditem?'selected color-light2':''\" tabindex='{{$index}}' key-up-down-with-element callbackfn='onItemClick' objproperty=\"'element'\" parentelem=\"'li'\"> <i style='float:left;margin-top:6px' ng-if='element.Elements.length>0' ng-click='toggleExpandCollapse($event,element)' ng-class=\"element.IsExpanded?'fa fa-minus':'fa fa-plus'\"><\/i> <span class='info-tooltip dtc-span' style='position:relative;color:red!important;' ng-if='element.errors.empty_id || element.errors.inValid_id || element.errors.duplicate_id' ng-attr-title='{{element.errors.empty_id || element.errors.inValid_id || element.errors.duplicate_id}}'><i class='fa fa-exclamation-circle' aria-hidden='true'><\/i><\/span> <span ng-dblclick='onItemDoubleClik($event,element)' ng-click='onItemClick(element)' ng-class='{bckgGrey: element.isAdvanceSearched, bckgGreen: (selecteditem == element && element.isAdvanceSearched)}' ng-bind='element.dictAttributes.ID' droprule selectedsection=\"'Item'\" dropdata='element' ondragenter='return false;' title='{{element.dictAttributes.ID}}'><\/span> <\/div> <span validationrulestreeview lstrules='element' filtertext='filtertext' filterproperty='filterproperty' selecteditem='selecteditem' onitemclickcallback='onitemclickcallback(selecteditem,selectedsection)' ng-if='element.Elements.length > 0' filtertext='filtertext' classforchild='true' menuoptionforrules='menuoptionforrules' ng-show='element.IsExpanded'><\/span> <\/li> <\/ul> <\/div>"};return{restrict:"EA",scope:{lstrules:"=",menuoptionforrules:"=",selecteditem:"=",filtertext:"=",classforchild:"=",findParentAndChildObject:"=",filterproperty:"="},link:function(i,r){i.onItemDoubleClick=function(n,t){if(i.onitemdblclickCallback)i.onitemdblclickCallback(n,t)};i.onItemClick=function(n){if(n){var t=getCurrentFileScope();t&&(t.SelectedRule=n,t.selectValidationRuleInAllTypes&&t.selectValidationRuleInAllTypes(n,!0,"ValidationRule"))}};i.toggleExpandCollapse=function(n,t){t.IsExpanded=!t.IsExpanded};i.$watch("lstrules",function(){i.lstrules&&angular.isArray(i.lstrules.Elements)&&(r.html(t(i.lstrules,r)),n(r.contents())(i))})}}}]);app.directive("duplicateIdObj",[function(){return{restrict:"A",scope:{currObj:"=",errorMessageClickCallback:"&callbackFn"},link:function(n){n.findNextObject=function(t,i){t.stopImmediatePropagation();t.stopPropagation();$(".duplicate-id-tooltip").hide();n.errorMessageClickCallback({paramObj:i})}},template:function(){return'<div ng-if="currObj.otherDuplicateObj.length >0" class="duplicate-id-tooltip"> <ul class="list-unstyled" margin-bottom: 0px!important;> <li ng-repeat="obj in currObj.otherDuplicateObj track by $index"> <span ng-click="findNextObject($event,obj);"> Duplicate ID ( {{obj.dictAttributes.ID}} ) present in - {{obj.Name}} <\/span> <\/li> <\/ul> <\/div>'}}}]);app.directive("entityattributeintellisense",["$rootScope","$filter","$Entityintellisenseservice","CONSTANTS","$ValidationService",function(n,t,i,r,u){return{retrict:"E",replace:!0,scope:{model:"=",type:"=",datatype:"=",entityid:"=",modebinding:"=",onchangecallback:"&",ontextchangecallback:"&",isdisabled:"=",onblurcallback:"&",validate:"=",errorprop:"=",isempty:"=",setcolumndatatype:"=",isjson:"=",isloadinheritedobjects:"=",propertyname:"="},template:"<div><span class='info-tooltip dtc-span' ng-if='errorprop' ng-attr-title='{{errorprop}}' style='color:red !important'><i class='fa fa-exclamation-circle' aria-hidden='true'><\/i><\/span><div class='input-group'><input ng-disabled='isdisabled' type='text' ng-change='onchange();validateEntityField()' ondrop='onEntityFieldDropInDirective(event)' ng-blur='onBlur()' ondragover='onEntityFieldDragOver(event)' class='form-control input-sm' title='{{modebinding}}' ng-model='modebinding' undoredodirective model='model' propertyname='propertyname' ng-keyup='onkeyup($event)' ng-keydown='onkeydown($event)' /><span ng-disabled='isdisabled' class='input-group-addon button-intellisense' ng-click='showIntellisenseList($event)'><\/span><\/div><\/div>",link:function(n){n.prevEntityID=undefined;n.onkeyup=function(t){if(n.entityid&&n.entityid.trim().length>0&&n.inputElement){var i=getSplitArray(n.inputElement.val(),n.inputElement[0].selectionStart);(i.length>1||i.length==0)&&n.setAutocomplete(n.inputElement,t)}n.ontextchangecallback()};n.onkeydown=function(t){if(n.entityid&&n.entityid.trim().length>0){n.inputElement&&n.prevEntityID==n.entityid||(n.inputElement=$(t.target),n.setAutocomplete(n.inputElement,t));n.prevEntityID=n.entityid;t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&$(n.inputElement).data("ui-autocomplete")&&($(n.inputElement).autocomplete("search",$(n.inputElement).val()),t.preventDefault());var i=getSplitArray(n.inputElement.val(),n.inputElement[0].selectionStart);i.length==1&&n.isMultilevelActive&&n.setAutocomplete(n.inputElement,t)}else setMultilevelAutoCompleteForObjectTreeIntellisense($(t.target),[],"",n.onchangecallback)};n.getIntellisenseData=function(t){var r=[],f,u;if(r=i.GetIntellisenseData(t,n.type,n.datatype,n.isloadinheritedobjects,!0,!1,!1,!1,!1),n.isjson){for(f=[],u=0;u<r.length;u++)r[u].Value&&r[u].Value.toLowerCase().startsWith("json")&&f.push(r[u]);return f}return r};n.setAutocomplete=function(t){var u,r,f,i;if(n.isMultilevelActive=!1,n.entityid&&n.entityid.trim().length>0){if(u=getSplitArray(t.val(),t[0].selectionStart),r=[],r=n.getIntellisenseData(n.entityid),u.length>1)for(n.isMultilevelActive=!0,f=0;f<u.length;f++)i=r.filter(function(n){return n.ID==u[f]}),i.length>0&&(r=typeof i[0].DataType!="undefined"&&(i[0].DataType=="Object"||i[0].DataType=="Collection"||i[0].DataType=="CDOCollection"||i[0].DataType=="List")&&typeof i[0].Entity!="undefined"?n.getIntellisenseData(i[0].Entity):[]);setMultilevelAutoCompleteForObjectTreeIntellisense(t,r,"",n.onchangecallback)}else setMultilevelAutoCompleteForObjectTreeIntellisense(t,[],"",n.onchangecallback)};n.showIntellisenseList=function(t){if(n.inputElement||(n.inputElement=$(t.target).prevAll("input[type='text']")),n.entityid&&n.entityid.trim().length>0){n.prevEntityID!=n.entityid&&n.setAutocomplete(n.inputElement,t);n.inputElement.focus();n.prevEntityID=n.entityid;var i=getSplitArray(n.inputElement.val(),n.inputElement[0].selectionStart);i.length>1?n.setAutocomplete(n.inputElement,t):i.length==1&&n.isMultilevelActive&&n.setAutocomplete(n.inputElement,t);$(n.inputElement).data("ui-autocomplete")&&$(n.inputElement).autocomplete("search",$(n.inputElement).val())}else setMultilevelAutoCompleteForObjectTreeIntellisense(n.inputElement,[],"",n.onchangecallback)};n.validateEntityField=function(){var i,f,t;n.propertyname&&n.validate&&(i=n.propertyname.split("."),property=i[i.length-1],f=r.VALIDATION.ENTITY_FIELD_INCORRECT,property!="sfwEntityField"&&(f=r.VALIDATION.INVALID_FIELD),t=[],n.isjson?(t=u.getListByPropertyName(n.getIntellisenseData(n.entityid),"ID",!1),u.checkValidListValue(t,n.model,$(n.inputElement).val(),property,property,r.VALIDATION.INVALID_FIELD,undefined)):u.checkValidListValueForMultilevel(t,n.model,$(n.inputElement).val(),n.entityid,property,property,f,undefined,n.isempty))};n.onBlur=function(){n.onblurcallback&&n.onblurcallback()};n.onchange=function(){n.onchangecallback&&n.onchangecallback();n.validateEntityField()}}}}]);app.directive("xmlmethodintellisensetemplate",["$compile","$rootScope","$Entityintellisenseservice","$filter","$ValidationService","CONSTANTS","$GetEntityFieldObjectService",function(n,t,i,r,u,f,e){return{retrict:"E",replace:!0,scope:{model:"=",objectfield:"=",propertyname:"=",entityid:"=",type:"=",onchangecallback:"&",isxmlmethod:"=",iscorrespondancexmlmethod:"@",onmethodorrulechange:"&",isdelete:"=",lstbusbasemethods:"=",onpropertychanged:"&"},template:"<div class='input-group'><span class='info-tooltip' ng-if='model.errors.invalid_method_name && !isxmlmethod' ng-attr-title='{{model.errors.invalid_method_name}}' style='color:red !important'><i class='fa fa-exclamation-circle' aria-hidden='true'><\/i><\/span><input ng-class=\"insidegrid?'form-control form-filter input-sm':'form-control input-sm'\" type='text' ng-disabled='isdisabled' title='{{objectfield}}' ng-model='objectfield' ng-keyup='onkeyup($event);validateMethodName()' ng-keydown='onkeydown($event)' ng-change='onchange();validateMethodName()' ng-blur='onBlur()' undoredodirective model='model' propertyname='propertyname'/><span class='input-group-addon button-intellisense' ng-click='showIntellisenseList($event)'><\/span><\/div>",link:function(n){n.prevEntityID=undefined;n.selectedobject="";n.onkeyup=function(t){if(t.key!="Down"&&t.key!="Up"&&t.key!="Left"&&t.key!="Right"&&n.entityid&&n.entityid.trim().length>0&&n.inputElement){var i=getSplitArray(n.inputElement.val(),n.inputElement[0].selectionStart);(i.length>1||i.length==0)&&n.setAutocomplete(n.inputElement,t)}};n.onkeydown=function(t){if(t.key!="Down"&&t.key!="Up"&&t.key!="Left"&&t.key!="Right")if(n.selectedobject="",n.entityid&&n.entityid.trim().length>0){n.inputElement&&n.prevEntityID==n.entityid&&$(t.target).val()||(n.inputElement=$(t.target),n.setAutocomplete(n.inputElement,t));n.prevEntityID=n.entityid;t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&$(n.inputElement).data("ui-autocomplete")&&($(n.inputElement).autocomplete("search",$(n.inputElement).val()),t.preventDefault());var i=getSplitArray(n.inputElement.val(),n.inputElement[0].selectionStart);i.length==1&&n.isMultilevelActive&&n.setAutocomplete(n.inputElement,t)}else setMultilevelAutoCompleteForObjectTreeIntellisense($(t.target),[],"",n)};n.getIntellisenseData=function(t){var e=[],r,f,u;if(n.isdelete){if(r=i.GetIntellisenseData(t,n.type,n.datatype,!0,!0,!0,!1,!1,!1),f=[],r)for(u=0;u<r.length;u++)r[u].Parameters&&r[u].Type=="Method"&&r[u].Parameters.length==0&&r[u].ID&&f.push(r[u]),r[u].Type!="Method"&&r[u].ID&&f.push(r[u]);e=f}else e=n.iscorrespondancexmlmethod?i.GetIntellisenseData(t,n.type,n.datatype,!0,!1,!1,!1,!1,!0):i.GetIntellisenseData(t,n.type,n.datatype,!0,!0,!0,!0,!1,!1);return e};n.setAutocomplete=function(t){var r,u,i;if(n.isMultilevelActive=!1,n.entityid&&n.entityid.trim().length>0){if(r=getSplitArray(t.val(),t[0].selectionStart),n.data=[],n.data=n.getIntellisenseData(n.entityid),n.lstbusbasemethods&&n.lstbusbasemethods.length&&(n.data=n.data.concat(n.lstbusbasemethods)),r.length>1)for(n.isMultilevelActive=!0,u=0;u<r.length;u++)i=n.data.filter(function(n){return n.ID&&n.ID==r[u]}),i.length>0&&(n.data=typeof i[0].DataType!="undefined"&&(i[0].DataType=="Object"||i[0].DataType=="Collection"||i[0].DataType=="CDOCollection"||i[0].DataType=="List")&&typeof i[0].Entity!="undefined"?n.getIntellisenseData(i[0].Entity):[]);setMultilevelAutoCompleteForObjectTreeIntellisense(t,n.data,"",null,n)}else setMultilevelAutoCompleteForObjectTreeIntellisense(t,[],"",null,n)};n.showIntellisenseList=function(t){if(n.inputElement||(n.inputElement=$(t.target).prevAll("input[type='text']")),n.entityid&&n.entityid.trim().length>0){n.prevEntityID==n.entityid&&$(n.inputElement).val()||n.setAutocomplete(n.inputElement,t);n.inputElement.focus();n.prevEntityID=n.entityid;var i=getSplitArray(n.inputElement.val(),n.inputElement[0].selectionStart);i.length>1?n.setAutocomplete(n.inputElement,t):i.length==1&&n.isMultilevelActive&&n.setAutocomplete(n.inputElement,t);$(n.inputElement).data("ui-autocomplete")&&$(n.inputElement).autocomplete("search",$(n.inputElement).val())}else setMultilevelAutoCompleteForObjectTreeIntellisense(n.inputElement,[],"",n.onchangecallback)};n.onBlur=function(){n.onchangecallback&&n.onchangecallback()};n.getObjectFromField=function(t,i){var u="",o,f;return u=e.GetEntityFieldObjectFromEntityField(t,i),!u&&n.data&&n.data.length>0&&(o=i.split("."),f=r("filter")(n.data,{ID:o[o.length-1]},!0),f&&f.length>0&&(u=f[0])),u};n.onchange=function(){var i,t,r,u;if(n.isxmlmethod)if(n.model.dictAttributes.ID=n.objectfield,n.objectfield)if(n.objectfield&&n.entityid)if(i=n.getObjectFromField(n.entityid,n.objectfield),i){if(t="",t=n.selectedobject?n.selectedobject:i,t.Type&&(n.model.dictAttributes.sfwItemType=t.Type),(t.Type=="Method"||t.Type=="Rule")&&(n.model.dictAttributes.sfwDataType=t.ReturnType,n.onmethodorrulechange))n.onmethodorrulechange({objobjectmethodorrule:t,objitem:n.model});if((t.Type=="Property"||t.Type=="Column")&&(n.model.dictAttributes.ID?(r=n.model.dictAttributes.ID.split("."),u=r.join("_"),n.model.dictAttributes.sfwParameter=u,n.model.dictAttributes.sfwItemType="Property",n.model.dictAttributes.sfwDataType=t.DataType):(n.model.dictAttributes.sfwItemType="",n.model.dictAttributes.sfwParameter="",n.model.dictAttributes.sfwDataType=""),n.onpropertychanged))n.onpropertychanged({objitem:n.model})}else n.clearFields();else n.clearFields();else n.clearFields()};n.clearFields=function(){n.model.dictAttributes.sfwParameter="";n.model.dictAttributes.sfwItemType="";n.model.dictAttributes.sfwLoadType="";n.model.dictAttributes.sfwLoadSource="";n.model.dictAttributes.sfwDataType=""};n.validateMethodName=function(){if(n.propertyname&&n.model){var i=n.propertyname.split(".")[1],t=[];n.lstbusbasemethods&&n.lstbusbasemethods.length>0&&(t=t.concat(n.lstbusbasemethods));u.checkValidListValueForXMLMethod(t,n.model,$(n.inputElement).val(),n.entityid,i,"invalid_method_name",f.VALIDATION.INVALID_NAME,undefined,n.type,n.datatype,n.isdelete,n.iscorrespondancexmlmethod)}}}}}]);app.directive("addEditAttributeConstraint",["$compile","$rootScope","$Entityintellisenseservice","$EntityIntellisenseFactory",function(n,t,i,r){return{retrict:"E",replace:!0,scope:{autoSave:"=",attributeName:"=",entityModel:"=",entityId:"="},templateUrl:"Entity/views/Constraint/AddFieldConstraint.html",link:function(n){n.entityIntellisenseService=i;n.entityIntellisenseFactory=r;n.ctrl=new AddEditConstraintsController(n.autoSave,n.attributeName,n.entityModel,n.entityId,n);n.onCancelClick=function(){n.$parent.dialog&&n.$parent.dialog.close&&n.$parent.dialog.close()}}}}]);var undoFormatQuery=function(n){var t="",r,i;if(n!=undefined&&n!="")for(t=removeSpecialCharacters(n,!0),r=["Select","From","Where","Equal","Coma","And","On","InnerJoin","LeftOuterJoin","RightOuterJoin","FullOuterJoin","CrossJoin","Join","OrderBy","GroupBy","As","OpeningBracket","ClosingBracket"],i=0;i<r.length;i++)t=CheckAndUndoFormat(t,r[i]);return t},CheckAndUndoFormat=function(n,t){switch(t){case"Select":n=n.replace(new RegExp("(SELECT\n\t)","gi"),"SELECT");break;case"From":n=n.replace(new RegExp("(\nFROM\n\t)","gi"),"FROM");break;case"Where":n=n.replace(new RegExp("(\nWHERE\n\t)","gi"),"WHERE");break;case"Equal":n=n.replace(new RegExp("( = )","gi"),"=");break;case"Coma":n=n.replace(new RegExp("(,\n\t)","gi"),",");break;case"And":n=n.replace(new RegExp("( AND\n\t)","gi")," AND");break;case"On":n=n.replace(new RegExp("(\n\t ON)","gi"),"ON");break;case"InnerJoin":n=n.replace(new RegExp("(\n\tINNER JOIN)","gi"),"INNER JOIN");break;case"LeftOuterJoin":n=n.replace(new RegExp("(\n\t LEFT OUTER JOIN)","gi"),"LEFT OUTER JOIN");break;case"RightOuterJoin":n=n.replace(new RegExp("(\n\t RIGHT OUTER JOIN)","gi"),"RIGHT OUTER JOIN");break;case"FullOuterJoin":n=n.replace(new RegExp("(\n\t FULL OUTER JOIN)","gi"),"FULL OUTER JOIN");break;case"CrossJoin":n=n.replace(new RegExp("(\n\tCROSS JOIN)","gi"),"CROSS JOIN");break;case"OrderBy":n=n.replace(new RegExp("(\nORDER\t BY )","gi"),"ORDER BY");break;case"GroupBy":n=n.replace(new RegExp("(\nGROUP\t BY )","gi"),"GROUP BY");break;case"As":n=n.replace(new RegExp("( \tAS)","gi")," AS")}return n},checkAndFormat=function(n,t){switch(t){case"Select":n=n.replace(new RegExp("(select )","gi"),"SELECT\n\t");break;case"From":n=n.replace(new RegExp("( from )","gi"),"\nFROM\n\t");break;case"Where":n=n.replace(new RegExp("( where )","gi"),"\nWHERE\n\t");break;case"Equal":n=n.replace(new RegExp("( =)","gi"),"=");n=n.replace(new RegExp("(= )","gi"),"=");n=n.replace(new RegExp("(=)","gi")," = ");break;case"Coma":n=n.replace(new RegExp("( ,)","gi"),",");n=n.replace(new RegExp("(, )","gi"),",");n=n.replace(new RegExp("(,)","gi"),",\n\t");break;case"And":n=n.replace(new RegExp("( and)","gi")," AND\n\t");break;case"On":n=n.replace(new RegExp("( on)","gi"),"\n\t ON");break;case"InnerJoin":n=n.replace(new RegExp("(inner join)","gi"),"\n\tINNER JOIN");break;case"LeftOuterJoin":n=n.replace(new RegExp("(left outer join )","gi"),"LEFT OUTER JOIN");n=n.replace(new RegExp("(left outer join)","gi"),"\n\t LEFT OUTER JOIN ");break;case"RightOuterJoin":n=n.replace(new RegExp("(right outer join )","gi"),"RIGHT OUTER JOIN");n=n.replace(new RegExp("(right outer join)","gi"),"\n\tRIGHT OUTER JOIN ");break;case"FullOuterJoin":n=n.replace(new RegExp("(full outer join )","gi"),"FULL OUTER JOIN");n=n.replace(new RegExp("(full outer join)","gi"),"\n\tFULL OUTER JOIN ");break;case"CrossJoin":n=n.replace(new RegExp("(cross join )","gi"),"CROSS JOIN");n=n.replace(new RegExp("(cross join)","gi"),"\n\tCROSS JOIN ");break;case"OrderBy":n=n.replace(new RegExp("(order by )","gi"),"ORDER BY");n=n.replace(new RegExp("(order by)","gi"),"\nORDER BY ");break;case"GroupBy":n=n.replace(new RegExp("(group by )","gi"),"GROUP BY");n=n.replace(new RegExp("(group by)","gi"),"\nGROUP BY ");break;case"As":n=n.replace(new RegExp("( as)","gi")," AS");break;case"OpeningBracket":n=n.replace(new RegExp(" \\( ","gi"),"(");break;case"ClosingBracket":n=n.replace(new RegExp(" \\) ","gi"),")")}return n},removeSpecialCharacters=function(n,t){for(var u,f=0,i="",r=0;r<n.length;r++)n[r]!="\n"&&n[r]!="\r"&&n[r]!="\t"?i=i.concat(n[r]):i[i.length-1]!=" "&&t&&(u=f+1,u<n.length&&n[u]!=" "&&n[u]!="\n"&&n[u]!="\r"&&n[u]!="\t"&&(i=i.concat(" "))),f++;return i};app.controller("BusinessObjectPropertyMethod",["$scope","$http","$rootScope",function(n,t,i){n.objBusinessObjectTree={};n.objBusinessObjectTree.lstdisplaybusinessobject=[];n.objBusinessObjectTree.lstmultipleselectedfields=[];n.objBusinessObjectTree.lstCurrentBusinessObjectProperties=[];n.objBusinessObjectTree.SelectedField=undefined;n.objBusinessObject.ObjTree=undefined;n.objBusinessObject.sfwObjectField=undefined;n.lstMethodProperties=[];n.lstGenericTypes=["","bool","datetime","decimal","double","int","string","float","long","short"];n.objBusinessObjectTree.BusObjectName=n.busObjectName;n.IsObjectBased=n.SelectedRule.dictAttributes.sfwObjectBased;n.onPropertyChange=function(t){var f,i,u,r;if(n.lstMethodProperties=[],t)if(t.indexOf(".")>0){for(f=t.split("."),i=n.objBusinessObject.ObjTree,u=0;u<f.length;u++)i=n.getData(f[u],i.ChildProperties,i.lstMethods);if(i){n.objBusinessObjectTree.SelectedField=i;n.onGetParameters(i)}}else if(n.objBusinessObject.ObjTree&&n.objBusinessObject.ObjTree.lstMethods&&(r=n.objBusinessObject.ObjTree.lstMethods.filter(function(n){return n.ShortName==t}),r&&r.length>0)){n.objBusinessObjectTree.SelectedField=r[0];n.onGetParameters(r[0])}};n.onGetParameters=function(t){t&&t.Parameters&&t.Parameters.length>0&&angular.forEach(t.Parameters,function(t){var i={ParameterName:t.ParameterName,DataType:t.ParameterType.FullName,Isconstant:!1,Expression:""};n.lstMethodProperties.push(i)})};n.getData=function(t,i,r){var u;return angular.forEach(i,function(i){if(!u){if(i.ShortName==t)return u=i;if(i.ChildProperties.length>0&&(u=n.getData(t,i.ChildProperties),u))return u}}),angular.forEach(r,function(n){if(!u&&n.ShortName==t)return u=n}),u};n.SelectParam=function(t){n.objBusinessObject.SelectedParameter=t};n.onOkClick=function(){var t=n.GetExpression();n.afterOkClick&&n.objBusinessObject.IsParentDialog&&n.afterOkClick(t);n.clickOkFromBusinessObject&&n.clickOkFromBusinessObject(t);n.BusinessObjectPropertyMethodDialog.close()};n.GetExpression=function(){var t,i;return n.objBusinessObjectTree.SelectedField&&(t="this.",n.objBusinessObjectTree.SelectedField.ItemPath&&n.objBusinessObjectTree.BusObjectName?n.objBusinessObjectTree.SelectedField.ItemPath.startsWith(n.objBusinessObjectTree.BusObjectName)&&(i=n.objBusinessObjectTree.SelectedField.ItemPath.substring(n.objBusinessObjectTree.BusObjectName.length+1),t=String.format("{0}{1}",t,i)):n.objBusinessObjectTree.SelectedField&&n.objBusinessObjectTree.SelectedField.Name&&(t=String.format("{0}{1}",t,n.objBusinessObjectTree.SelectedField.Name)),n.objBusinessObjectTree.SelectedField.DataType.toLowerCase()=="methodtype"&&(t=n.UpdateMethodExpression(t))),t};n.UpdateMethodExpression=function(t){return n.objBusinessObjectTree.SelectedField&&n.objBusinessObjectTree.SelectedField.lstMethods.length>0&&n.objBusinessObjectTree.SelectedField.lstMethods.IsGeneric&&(t=String.format("{0}<{1}>",t,n.objBusinessObjectTree.genericType)),t=String.format("{0}(",t),n.lstMethodProperties.length>0&&(angular.forEach(n.lstMethodProperties,function(n){t=n.DataType.toLowerCase().indexOf("string")>-1&&n.Isconstant?String.format('{0}"{1}",',t,n.Expression):String.format("{0}{1},",t,n.Expression)}),t=t.trimEnd(",")),t=String.format("{0})",t)};n.onCancelClick=function(){n.BusinessObjectPropertyMethodDialog.close()};n.onBusinessMethodCommand=function(){var t=n.$new();t.objBusinessObject={};t.clickOkFromBusinessObject=function(t){n.objBusinessObjectTree.SelectedField&&n.$evalAsync(function(){n.objBusinessObject.SelectedParameter&&(n.objBusinessObject.SelectedParameter.Expression=t)})};t.IsObjectBased=n.IsObjectBased;t.BusinessObjectPropertyMethodDialog=i.showDialog(t,"Business Object Property / Method","Entity/views/ExpressionBuilder/BusinessObjectPropertyMethod.html",{width:1070,height:450})};n.onInternalFunctionsClick=function(){var t=n.$new();t.ObjInternalFunctions={};t.clickOkFromInternalFunc=function(t){n.objBusinessObjectTree.SelectedField&&n.$evalAsync(function(){n.objBusinessObject.SelectedParameter&&(n.objBusinessObject.SelectedParameter.Expression=t)})};t.IsObjectBased=n.IsObjectBased;t.InternalFunctionsDialog=i.showDialog(t,"Internal Functions","Entity/views/ExpressionBuilder/InternalFunctions.html",{width:1070,height:450})};n.onQueryClick=function(){var t=n.$new();t.objQuery={};t.clickOkFromQuery=function(t){n.objBusinessObjectTree.SelectedField&&n.$evalAsync(function(){n.objBusinessObject.SelectedParameter&&(n.objBusinessObject.SelectedParameter.Expression=t)})};t.IsObjectBased=n.IsObjectBased;t.QueryDialog=i.showDialog(t,"Query","Entity/views/ExpressionBuilder/Query.html",{width:1070,height:450})};n.checkGenericMethod=function(){var t=!1;return n.BuisnessObjectErrorMessage=undefined,n.objBusinessObjectTree.SelectedField&&n.objBusinessObjectTree.SelectedField.lstMethods&&n.objBusinessObjectTree.SelectedField.lstMethods.length>0&&n.objBusinessObjectTree.SelectedField.lstMethods.IsGeneric&&(n.objBusinessObjectTree.genericType||(n.BuisnessObjectErrorMessage="Error: Please select generic type.",t=!0)),t}}]);app.controller("InternalFunctions",["$scope","$http","$rootScope","$filter","hubcontext",function(n,t,i){n.lstGenericTypes=["","bool","datetime","decimal","double","int","string","float","long","short"];n.Init=function(){n.IsObjectBased=n.SelectedRule.dictAttributes.sfwObjectBased};n.onOkClick=function(){var t=n.getExpression();n.afterOkClick&&n.ObjInternalFunctions.IsParentDialog&&n.afterOkClick(t);n.clickOkFromInternalFunc&&n.clickOkFromInternalFunc(t);n.InternalFunctionsDialog.close()};n.onClickInternalFunction=function(t){n.ObjInternalFunctions.lstParameters=[];n.ObjInternalFunctions.SelectedInternalFunc=t;t&&t.lstParameter.length>0&&angular.forEach(t.lstParameter,function(t){n.$evalAsync(function(){var i={ParameterName:t.ParameterName,ParameterDataType:t.ParameterDataType,Isconstant:!1,Expression:"",IsGeneric:t.IsGeneric};n.ObjInternalFunctions.lstParameters.push(i)})})};n.onCancelClick=function(){n.InternalFunctionsDialog.close()};n.SelectParam=function(t){n.ObjInternalFunctions.SelectedParameter=t};n.getExpression=function(){var t;return n.ObjInternalFunctions.SelectedInternalFunc&&(t=n.GetExpressionForInternalFunc(n.ObjInternalFunctions.SelectedInternalFunc.MethodName.Name)),t};n.GetExpressionForInternalFunc=function(t){return n.ObjInternalFunctions.SelectedInternalFunc&&n.ObjInternalFunctions.SelectedInternalFunc.IsGeneric&&(t=String.format("{0}<{1}>",t,n.ObjInternalFunctions.genericType)),t=String.format("{0}(",t),angular.forEach(n.ObjInternalFunctions.lstParameters,function(n){t=n.ParameterDataType.toLowerCase()=="string"&&n.Isconstant?String.format('{0}"{1}",',t,n.Expression):String.format("{0}{1},",t,n.Expression)}),t=t.trimEnd(","),t=String.format("{0})",t)};n.onInternalFunctionsClick=function(){var t=n.$new();t.ObjInternalFunctions={};t.clickOkFromInternalFunc=function(t){n.ObjInternalFunctions.SelectedInternalFunc&&n.$evalAsync(function(){n.ObjInternalFunctions.SelectedParameter&&(n.ObjInternalFunctions.SelectedParameter.Expression=t)})};t.IsObjectBased=n.IsObjectBased;t.InternalFunctionsDialog=i.showDialog(t,"Internal Functions","Entity/views/ExpressionBuilder/InternalFunctions.html",{width:1070,height:450})};n.onQueryClick=function(){var t=n.$new();t.objQuery={};t.clickOkFromQuery=function(t){n.ObjInternalFunctions.SelectedInternalFunc&&n.$evalAsync(function(){n.ObjInternalFunctions.SelectedParameter&&(n.ObjInternalFunctions.SelectedParameter.Expression=t)})};t.IsObjectBased=n.IsObjectBased;t.QueryDialog=i.showDialog(t,"Query","Entity/views/ExpressionBuilder/Query.html",{width:1070,height:450})};n.onBusinessMethodCommand=function(){var t=n.$new();t.objBusinessObject={};t.clickOkFromBusinessObject=function(t){n.ObjInternalFunctions.SelectedInternalFunc&&n.$evalAsync(function(){n.ObjInternalFunctions.SelectedParameter&&(n.ObjInternalFunctions.SelectedParameter.Expression=t)})};t.busObjectName=n.busObjectName;t.IsObjectBased=n.IsObjectBased;t.BusinessObjectPropertyMethodDialog=i.showDialog(t,"Business Object Property / Method","Entity/views/ExpressionBuilder/BusinessObjectPropertyMethod.html",{width:1070,height:450})};n.checkGenericMethod=function(){var t=!1;return n.InternalFunctionErrorMessage=undefined,n.ObjInternalFunctions.SelectedInternalFunc&&n.ObjInternalFunctions.SelectedInternalFunc.IsGeneric&&(n.ObjInternalFunctions.genericType||(n.InternalFunctionErrorMessage="Error: Please select generic type.",t=!0)),t};n.Init()}]);app.controller("QueryExpression",["$scope","$http","$rootScope","$filter","$EntityIntellisenseFactory",function(n,t,i,r,u){n.lstEntities=[];n.lstGenericTypes=["","bool","datetime","decimal","double","int","string","float","long","short"];n.Init=function(){n.lstEntities.push(r("filter")(u.getEntityIntellisense()));n.IsObjectBased=n.SelectedRule.dictAttributes.sfwObjectBased};n.onOkClick=function(){var t=n.getExpression();n.afterOkClick&&n.objQuery.IsParentDialog&&n.afterOkClick(t);n.clickOkFromQuery&&n.clickOkFromQuery(t);n.QueryDialog.close()};n.onCancelClick=function(){n.QueryDialog.close()};n.selectQuery=function(t){var i,h,f,c,e,o,s;n.objQuery.lstParameters=[];n.objQuery.selectedQuery=t;t&&t&&t.trim().length>0&&(i=t.indexOf("."),i>-1&&(h=t.substring(0,i),f=r("filter")(u.getEntityIntellisense(),{ID:h},!0),f&&f.length>0&&(c=f[0],e=t.substring(i+1,t.length),e&&e.trim().length>0&&(o=r("filter")(c.Queries,{ID:e},!0),o&&o.length>0&&(s=o[0],s.Parameters.length>0&&angular.forEach(s.Parameters,function(t){n.$evalAsync(function(){var i={ParameterName:t.ID,DataType:t.DataType,Isconstant:!1,Expression:""};n.objQuery.lstParameters.push(i)})}))))))};n.SelectParam=function(t){n.objQuery.SelectedParameter=t};n.getExpression=function(){var t;return n.objQuery.selectedQuery&&(t=n.GetExpressionForSelectedQuery(n.objQuery.selectedQuery)),t};n.GetExpressionForSelectedQuery=function(t){var i="RFunc.ExecuteQuery",r,u,f;return n.objQuery.genericType&&(i=String.format("{0}<{1}>",i,n.objQuery.genericType)),i=String.format("{0}(",i),t&&t&&t.trim().length>0&&(r=t.indexOf("."),r>-1&&(u=t.substring(0,r),f=t.substring(r+1,t.length),i=String.format('{0}"{1}.{2}"',i,u,f))),angular.forEach(n.objQuery.lstParameters,function(n){i=n.DataType.toLowerCase().indexOf("string")>-1&&n.Isconstant&&n.Isconstant=="True"?String.format('{0},"{1}"',i,n.Expression):String.format("{0},{1}",i,n.Expression)}),i=String.format("{0})",i)};n.onQueryClick=function(){var t=n.$new();t.objQuery={};t.clickOkFromQuery=function(t){n.objQuery.selectedQuery&&n.$evalAsync(function(){n.objQuery.SelectedParameter&&(n.objQuery.SelectedParameter.Expression=t)})};t.IsObjectBased=n.IsObjectBased;t.QueryDialog=i.showDialog(t,"Query","Entity/views/ExpressionBuilder/Query.html",{width:1070,height:450})};n.onInternalFunctionsClick=function(){var t=n.$new();t.ObjInternalFunctions={};t.clickOkFromInternalFunc=function(t){n.objQuery.selectedQuery&&n.$evalAsync(function(){n.objQuery.SelectedParameter&&(n.objQuery.SelectedParameter.Expression=t)})};t.IsObjectBased=n.IsObjectBased;t.InternalFunctionsDialog=i.showDialog(t,"Internal Functions","Entity/views/ExpressionBuilder/InternalFunctions.html",{width:1070,height:450})};n.onBusinessMethodCommand=function(){var t=n.$new();t.objBusinessObject={};t.clickOkFromBusinessObject=function(t){n.objQuery.selectedQuery&&n.$evalAsync(function(){n.objQuery.SelectedParameter&&(n.objQuery.SelectedParameter.Expression=t)})};t.IsObjectBased=n.IsObjectBased;t.busObjectName=n.busObjectName;t.BusinessObjectPropertyMethodDialog=i.showDialog(t,"Business Object Property / Method","Entity/views/ExpressionBuilder/BusinessObjectPropertyMethod.html",{width:1070,height:450})};n.Init()}]);app.filter("entityAttributesbytype",function(){return function(n,t){return n.filter(function(n){if(n&&n.hasOwnProperty("dictAttributes"))if(angular.isArray(t)){if(t.indexOf(n.dictAttributes.sfwType)>-1)return n}else if(n.dictAttributes.sfwType===t)return n})}});