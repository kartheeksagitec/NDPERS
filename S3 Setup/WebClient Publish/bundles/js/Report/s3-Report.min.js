app.controller("ReportController",["$scope","$rootScope","ngDialog","$EntityIntellisenseFactory","$filter","$NavigateToFileService","$timeout","CONSTANTS",function(n,t,r,u,f,e,o,s){n.isDirty=!1;t.IsLoading=!0;n.objReportDetailsDialog={};n.lstReportMethod=[];n.validationErrorList=[];n.currentfile=t.currentopenfile.file;n.lstControl=s.FORM.CONTROL_TYPES;n.traverseMainModel=function(t){var u=[],i,r;if(t.contains("-")||t.contains(","))for(i=n.ReportModel,r=0;r<t.split(",").length;r++)i=FindNodeHierarchy(i,t.split(",")[r].substring(t.split(",")[r].lastIndexOf("-")+1)),i&&u.push(i);return u};n.selectElement=function(i){n.$evalAsync(function(){if(i!=null&&i!="form"&&i!=""){var r=n.traverseMainModel(i);r.length>0&&r[0].Name!="initialload"&&r[r.length-1].Name!="sfwRow"&&r[r.length-1].Name!="sfwTable"&&SetFormSelectedControl(n.ReportModel,r[r.length-1],window.event)}t.IsLoading=!1})};n.ToggleUIDesginAttribute=function(n,t){n.length>0&&n[0].Name!="initialload"&&n[n.length-1].Name!="sfwRow"&&n[n.length-1].Name!="sfwTable"&&(n[n.length-1].isAdvanceSearched=t)};n.selectedDesignSource=!1;n.ShowDesign=function(){var i,r,o,e;if(n.selectedDesignSource==!0&&(i=n.editor.getValue(),i!=null&&i!="")){if(t.IsLoading=!0,r=n.editor.selection.getCursor().row,r=r+1,i.length<32e3)hubMain.server.getDesignXmlString(i,n.currentfile,r);else{o=[];o[0]=r>0?r:1;var u="",s=[],f=0;for(e=0;e<i.length;e++)f++,u=u+i[e],f==32e3&&(f=0,s.push(u),u="");f!=0&&s.push(u);h(s,n.currentfile,"Source-Design",o)}n.receivedesignxmlobject=function(t,i){n.selectedDesignSource=!1;n.isSourceDirty&&(n.receiveReportModel(t),n.isSourceDirty=!1);n.$evalAsync(function(){n.selectElement(i);i!=null&&i!="form"&&i!=""})}}};n.isSourceDirty;n.sourceChanged=function(){n.isSourceDirty=!0;n.isDirty=!0;n.SearchSource.IsSearchCriteriaChange=!0};var h=function(n,t,i){for(var r=0;r<n.length;r++)hubMain.server.receiveDataPackets(n[r],n.length,t,r,i,null)};n.ShowSource=function(){var v,l,a,o,u,s,i,e;if(n.selectedDesignSource==!1&&(n.selectedDesignSource=!0,l=[],n.ReportModel!=null&&n.ReportModel!=undefined&&(t.IsLoading=!0,o=GetBaseModel(n.ReportModel),o!=""))){if(u=[],n.ReportModel.SelectedControl!=undefined&&n.ReportModel.SelectedControl.IsSelected&&(s=[],v=n.FindDeepNode(n.ReportModel,n.ReportModel.SelectedControl,s),a=n.getPathSource(n.ReportModel,s,l),angular.copy(a,u)),i=JSON.stringify(o),i.length<32e3)hubMain.server.getSourceXmlObject(i,n.currentfile,u);else{var r="",c=[],f=0;for(e=0;e<i.length;e++)f++,r=r+i[e],f==32e3&&(f=0,c.push(r),r="");f!=0&&c.push(r);h(c,n.currentfile,"Design-Source",u)}n.receivesourcexml=function(i,r){n.$apply(function(){n.xmlSource=i;var u=n.currentfile.FileName;setDataToEditor(n,i,r,u);n.$evalAsync(function(){t.IsLoading=!1;n.currentSelectedParams=undefined});window.navigator.userAgent.toLowerCase().contains("chrome")&&n.$evalAsync(function(){t.IsLoading=!1})})}}};n.FindNodeHierarchy=function(n,t){if(n&&n.Elements){var i=n.Elements[t];return i==undefined&&(i=n.Elements[t-1]),i}};n.FindDeepNode=function(t,i,r){return t&&angular.forEach(t.Elements,function(t){var u=n.isValidObject(t,i);return(u&&r.push(t),t==i)?i:t.Elements&&t.Elements.length>0?i=n.FindDeepNode(t,i,r):void 0}),i};n.getPathSource=function(n,t,i){for(var u,r=0;r<t.length;r++)r==0?(u=n.Elements.indexOf(t[r]),i.push(u)):(u=t[r-1].Elements.indexOf(t[r]),i.push(u));return i};n.isValidObject=function(t,i){var u,r;if(t==i)return!0;for(r in t.Elements){if(t.Elements[r]==i)return!0;if(t.Elements[r].Elements&&t.Elements[r].Elements.length>0)for(iele in t.Elements[r].Elements)if(u=n.isValidObject(t.Elements[r].Elements[iele],i),u==!0)return u}return u};hubMain.server.getModel(n.currentfile.FilePath,n.currentfile.FileType).done(function(i){i?n.receiveReportModel(i):t.closeFile(n.currentfile.FileName)});n.setMainTableandInitialLoadFormModel=function(t){for(i=0;i<t.Elements.length;i++){var r=t.Elements[i];r.Name=="initialload"?n.InitialLoad=r:r.Name=="sfwTable"&&(n.MainTable=r)}};n.receiveReportModel=function(i){n.$apply(function(){n.ReportModel=i;n.ReportModel.RemoteObjectCollection=[];n.objReportExtraFields=[];n.MainTable=undefined;n.InitialLoad=undefined;n.setMainTableandInitialLoadFormModel(n.ReportModel);n.InitialLoad&&n.InitialLoad.Elements.length>0&&(n.PopulateInitialLoad(),n.PopulateParameters());n.objReportExtraFields=f("filter")(n.ReportModel.Elements,{Name:"ExtraFields"});n.objReportExtraFields.length>0&&(n.objReportExtraFields=n.objReportExtraFields[0]);n.objReportExtraFields.length==0&&(n.objReportExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]})});$.connection.hubCreateNewObject.server.loadMethodList().done(function(t){n.$evalAsync(function(){if(t){var i=JSON.parse(t);n.lstReportMethod=i;n.PopulateParameters()}})}).fail(function(n){alert(n)});$.connection.hubForm.server.getRemoteObjectList().done(function(t){n.$evalAsync(function(){t&&(n.ReportModel.RemoteObjectCollection=t,n.ReportModel.RemoteObjectCollection&&n.ReportModel.RemoteObjectCollection.length>0&&n.ReportModel.RemoteObjectCollection.splice(0,0,{dictAttributes:{ID:""}}))})});n.$evalAsync(function(){t.IsLoading=!1})};n.PopulateInitialLoad=function(){angular.forEach(n.InitialLoad.Elements,function(t){t.Name=="query"?(n.InitialLoad.Query=t.dictAttributes.sfwQueryRef,n.objMainQuery=t):t.Name=="custommethod"&&(n.InitialLoad.Method=t.dictAttributes.sfwMethodName,n.InitialLoad.objCustomMethod=t,strParams=n.GetMethodParameters(n.InitialLoad.Method))})};n.PopulateParameters=function(i){var r=[],f;i?t.EditPropertyValue(n.lstParameters,n,"lstParameters",[]):n.lstParameters=[];n.objMainQuery?n.objMainQuery.dictAttributes.sfwQueryRef!=undefined&&n.objMainQuery.dictAttributes.sfwQueryRef!=""&&(f=u.getEntityIntellisense(),r=onQueryChange(n.objMainQuery.dictAttributes.sfwQueryRef,f)):n.InitialLoad&&n.InitialLoad.objCustomMethod&&n.InitialLoad.objCustomMethod.dictAttributes.sfwMethodName!=undefined&&n.InitialLoad.objCustomMethod.dictAttributes.sfwMethodName!=""&&(r=n.GetMethodParameters(n.InitialLoad.objCustomMethod.dictAttributes.sfwMethodName));r.length>0&&angular.forEach(r,function(r){var f=r.ID.substr(1),e=r.DataType,u={ParamName:f,ParamDataType:e};i?t.PushItem(u,n.lstParameters):n.lstParameters.push(u)});n.ReportModel.lstParameters=n.lstParameters};n.GetMethodParameters=function(t){function f(n){return n.ShortName==t}function e(n){var t=n.ParameterType.FullName;t=t.substring(t.lastIndexOf(".")+1);r.push({ID:" "+n.ParameterName,DataType:t})}var r=[],i=n.lstReportMethod.filter(f),u;return i&&i.length>0&&(u=i[0],angular.forEach(u.Parameters,e)),r};n.menuOptionsForReport=[["Add Row",function(){n.AddRowCommand()}],null,];n.AddRowCommand=function(){var i,r,u,f;if(t.UndRedoBulkOp("Start"),n.MainTable=null,n.setMainTableandInitialLoadFormModel(n.ReportModel),n.MainTable||(n.MainTable={Name:"sfwTable",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},n.MainTable.dictAttributes.ID="",t.PushItem(n.MainTable,n.ReportModel.Elements)),n.MainTable){for(i={Name:"sfwRow",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},r=GetMaxColCount(i,n.MainTable),r<1&&(r=1),u=0;u<r;u++)f={Name:"sfwColumn",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},t.PushItem(f,i.Elements);t.PushItem(i,n.MainTable.Elements)}t.UndRedoBulkOp("End")};n.selectedParameters=function(t){n.currentSelectedParams=t};n.onDetailClick=function(){var i=n.$new();i.objExtraFields=[];i.objDirFunctions={};i.showExtraFieldsTab=!1;i.formName="Report";i.InitialLoad=undefined;i.objMainQuery=undefined;i.ReportModel={};i.PopulateInitialLoad=function(){angular.forEach(i.InitialLoad.Elements,function(t){t.Name=="query"?(i.InitialLoad.Query=t.dictAttributes.sfwQueryRef,i.objMainQuery=t):t.Name=="custommethod"&&(i.InitialLoad.Method=t.dictAttributes.sfwMethodName,i.InitialLoad.objCustomMethod=t,strParams=n.GetMethodParameters(i.InitialLoad.Method))})};i.Init=function(){i.ReportModel={dictAttributes:{}};angular.forEach(n.ReportModel.dictAttributes,function(n,t){i.ReportModel.dictAttributes[t]=n});n.InitialLoad?(i.InitialLoad={},angular.copy(n.InitialLoad,i.InitialLoad)):i.InitialLoad={Name:"initialload",Value:"",dictAttributes:{},Elements:[],Children:[]};i.ReportModel.IsQuery="Query";i.InitialLoad&&i.InitialLoad.objCustomMethod&&(i.ReportModel.IsQuery="Method");i.PopulateInitialLoad()};$.connection.hubMain.server.getResources("").done(function(n){n&&n.length>0&&(i.resourceList=n)});$.connection.hubCreateNewObject.server.loadReportData().done(function(n){i.$apply(function(){i.lstReportData=n})});i.lstReportCategory||$.connection.hubCreateNewObject.server.loadReportCategory().done(function(n){i.$evalAsync(function(){if(n){var t=JSON.parse(n);i.lstReportCategory=t}})}).fail(function(n){alert(n)});i.validateReportDetails=function(){if(i.ReportDetailsErrorMessage="",i.objDirFunctions.getExtraFieldData&&(i.objExtraFields=i.objDirFunctions.getExtraFieldData()),i.resourceList&&i.resourceList.length>0&&i.ReportModel.dictAttributes.sfwResource&&!i.resourceList.filter(function(n){return n.ResourceID&&n.ResourceID.trim()==i.ReportModel.dictAttributes.sfwResource.trim()}).length>0)return i.ReportDetailsErrorMessage="Error: Invalid Resource ID.",!0;if(i.lstReportCategory&&i.lstReportCategory.length>0&&i.ReportModel.dictAttributes.sfwReportCategory&&!i.lstReportCategory.filter(function(n){return n.CodeValue==i.ReportModel.dictAttributes.sfwReportCategory.trim()}).length>0)return i.ReportDetailsErrorMessage="Error: Invalid Report Category.",!0;if(!i.ValidateQuery())return!0;var n=validateExtraFields(i);return i.ReportDetailsErrorMessage=i.FormDetailsErrorMessage,n};i.ValidateQuery=function(){var n=!0,f,t,e;if(i.objMainQuery&&i.objMainQuery.dictAttributes.sfwQueryRef){if(i.objMainQuery.dictAttributes.sfwQueryRef.contains(".")){if(f=i.objMainQuery.dictAttributes.sfwQueryRef,t=f.split("."),t&&t.length==2){var o=t[0],s=t[1],h=u.getEntityIntellisense(),r=h.filter(function(n){return n.ID==o});r&&r.length>0?(e=r[0],e.Queries.some(function(n){return n.ID==s})||(i.ReportDetailsErrorMessage="Error: Invalid Query",n=!1)):(i.ReportDetailsErrorMessage="Error: Invalid Query",n=!1)}return n}i.ReportDetailsErrorMessage="Error: Invalid Query";n=!1}return n};i.OkClick=function(){n.PopulateParameters();i.objDirFunctions.prepareExtraFieldData&&i.objDirFunctions.prepareExtraFieldData();i.ReportDetailsDialog.close()};i.onReportTypeChange=function(n){for(i.objMainQuery?i.objMainQuery.dictAttributes.sfwQueryRef="":i.InitialLoad.objCustomMethod&&(i.InitialLoad.objCustomMethod.dictAttributes.sfwMethodName="");i.InitialLoad.Elements.length>0;)i.InitialLoad.Elements.splice(0,1);i.objMainQuery=undefined;i.InitialLoad.objCustomMethod=undefined;n=="Query"?i.objMainQuery||(i.objMainQuery={Name:"query",Value:"",dictAttributes:{},Elements:[]},i.InitialLoad.Elements.push(i.objMainQuery)):i.InitialLoad.objCustomMethod||(i.InitialLoad.objCustomMethod={Name:"custommethod",Value:"",dictAttributes:{},Elements:[]},i.InitialLoad.Elements.push(i.InitialLoad.objCustomMethod))};i.NavigateToEntityQuery=function(n){if(n&&n!=""&&n.contains(".")){i.OkClick();var t=n.split(".");e.NavigateToFile(t[0],"queries",t[1])}};i.OkClick=function(){t.UndRedoBulkOp("Start");angular.forEach(i.ReportModel.dictAttributes,function(i,r){t.EditPropertyValue(n.ReportModel.dictAttributes[r],n.ReportModel.dictAttributes,r,i)});for(var r=0;r<n.ReportModel.Elements.length;r++)if(n.ReportModel.Elements[r].Name=="initialload"){t.DeleteItem(n.ReportModel.Elements[r],n.ReportModel.Elements);t.InsertItem(i.InitialLoad,n.ReportModel.Elements,r);break}t.EditPropertyValue(n.InitialLoad,n,"InitialLoad",i.InitialLoad);n.PopulateInitialLoad();t.EditPropertyValue(n.objMainQuery,n,"objMainQuery",i.objMainQuery);t.EditPropertyValue(n.InitialLoad.objcustommethod,n.InitialLoad,"objcustommethod",i.InitialLoad.objcustommethod);n.PopulateParameters(!0);i.objDirFunctions.prepareExtraFieldData&&i.objDirFunctions.prepareExtraFieldData();t.UndRedoBulkOp("End");i.ReportDetailsDialog.close()};i.ReportDetailsDialog=t.showDialog(i,"Details","Report/views/ReportDetails.html",{width:700,height:500});i.Init()};n.onActionKeyDown=function(t){var i=t.target,u=i.tagName=="INPUT"?$(i).val():i.innerText,r=[];n.lstParameters&&angular.forEach(n.lstParameters,function(n){n.ParamName&&n.ParamName.toLowerCase().contains(u.toLowerCase())&&r.push(n.ParamName)});setSingleLevelAutoComplete($(i),r);t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&$(i).data("ui-autocomplete")&&($(i).autocomplete("search",$(i).val()),t.preventDefault())};n.addExtraFieldsDataInToMainModel=function(){if(n.objReportExtraFields){var t=n.ReportModel.Elements.indexOf(n.objReportExtraFields);t==-1&&n.ReportModel.Elements.push(n.objReportExtraFields)}};n.BeforeSaveToFile=function(){n.addExtraFieldsDataInToMainModel()};n.ClearSelectFields=function(){lstEntityTreeFieldData=null};n.OnCutControlClick=function(t){var i=[];i.push(t);n.CopyToClipBoard(i,"Control",!0)};n.OnCopyControlClick=function(t){var i=[];i.push(t);n.CopyToClipBoard(i,"Control",!1)};n.OnPasteControl=function(i){n.ClipboardData&&n.$evalAsync(function(){function r(r){var u=GetBaseModel(r);n.IsCutOper?n.OnDeleteControlClick(r):u.dictAttributes.ID=GetControlID(n.ReportModel,r.Name);r.Name=="udc"&&(u.UcChild=[],u.UcChild.push(r.UcChild[0]));t.PushItem(u,i.Elements);u.ParentVM=i}t.UndRedoBulkOp("Start");angular.forEach(n.ClipboardData,r);n.IsCutOper&&(n.ClipboardData=[],n.ClipboardDataOpeType="",n.IsCutOper=!1);t.UndRedoBulkOp("End")})};n.selectControlOnDoubleClick=function(t,i){n.selectControl(t,i);n.ActiveTabForReport="Properties"};n.selectControl=function(t,i){t&&(t.isLoaded||(t.isLoaded=!0),n.ReportModel.SelectedControl&&(n.ReportModel.SelectedControl.Name=="sfwPanel"||n.ReportModel.SelectedControl.Name=="sfwDialogPanel"||n.ReportModel.SelectedControl.Name=="sfwListView")&&(n.ReportModel.SelectedControl.IsVisible=!1),SetFormSelectedControl(n.ReportModel,t,i),t.Name=="sfwTabSheet"&&(t.ParentVM.SelectedTabSheet=t,t.ParentVM.SelectedTabSheet.IsSelected=!0),(t.Name=="sfwPanel"||t.Name=="sfwDialogPanel"||t.Name=="sfwListView")&&(t.IsVisible=!0));n.setDisplayNoneToTable&&n.setDisplayNoneToTable()};n.OnDeleteControlClick=function(i){i&&(t.DeleteItem(i,i.ParentVM.Elements),i.ParentVM&&n.selectControl(i.ParentVM,null))};n.CopyToClipBoard=function(t,i,r){function u(t){n.ClipboardData.push(t)}n.ClipboardData=[];n.ClipboardDataOpeType=i;n.IsCutOper=r;angular.forEach(t,u)};n.OnCutCell=function(t){n.CopyToClipBoard(t.Elements,"Cell",!0)};n.OnCopyCell=function(t){n.CopyToClipBoard(t.Elements,"Cell",!1)};n.OnPasteCell=function(i){n.ClipboardData&&n.$evalAsync(function(){function r(r){n.IsCutOper&&n.ClearCell(r.ParentVM);var u=GetBaseModel(r);n.IsCutOper||(u.dictAttributes.ID=GetControlID(n.ReportModel,r.Name));t.PushItem(u,i.Elements);u.ParentVM=i}t.UndRedoBulkOp("Start");angular.forEach(n.ClipboardData,r);n.IsCutOper&&(n.ClipboardData=[],n.ClipboardDataOpeType="",n.IsCutOper=!1);t.UndRedoBulkOp("End")})};n.ClearCell=function(n){while(n.Elements.length>0)t.DeleteItem(n.Elements[0],n.Elements)};n.OnCopyCutPasteControlClick=function(t){t=="cut"?n.ReportModel&&n.ReportModel.SelectedControl&&n.ReportModel.SelectedControl.Name!="sfwColumn"?n.OnCutControlClick(n.ReportModel.SelectedControl):n.ReportModel&&n.ReportModel.SelectedControl&&(n.ReportModel.SelectedControl.Name=="sfwColumn"||n.ReportModel.SelectedControl.Name=="sfwButtonGroup")&&n.OnCutCell(n.ReportModel.SelectedControl):t=="copy"?n.ReportModel&&n.ReportModel.SelectedControl&&n.ReportModel.SelectedControl.Name!="sfwColumn"?n.OnCopyControlClick(n.ReportModel.SelectedControl):n.ReportModel&&n.ReportModel.SelectedControl&&(n.ReportModel.SelectedControl.Name=="sfwColumn"||n.ReportModel.SelectedControl.Name=="sfwButtonGroup")&&n.OnCopyCell(n.ReportModel.SelectedControl):t=="paste"&&(n.ClipboardData&&n.ClipboardDataOpeType=="Control"&&n.ReportModel.SelectedControl&&(n.ReportModel.SelectedControl.Name=="sfwColumn"||n.ReportModel.SelectedControl.Name=="sfwButtonGroup")?n.OnPasteControl(n.ReportModel.SelectedControl):n.ClipboardData&&n.ClipboardDataOpeType=="Cell"&&n.ReportModel.SelectedControl&&(n.ReportModel.SelectedControl.Name=="sfwColumn"||n.ReportModel.SelectedControl.Name=="sfwButtonGroup")&&n.OnPasteCell(n.ReportModel.SelectedControl))};n.OnRowColumnInsertMoveClick=function(i){if(n.ReportModel&&n.ReportModel.SelectedControl){var r=null,u=null;r=n.ReportModel.SelectedControl.Name=="sfwColumn"?n.ReportModel.SelectedControl:FindParent(n.ReportModel.SelectedControl,"sfwColumn");u=r&&r.ParentVM?r.ParentVM.ParentVM:null;u&&r&&n.$evalAsync(function(){var e;if(i=="InsertRowAbove"){var f=u.Elements.indexOf(r.ParentVM),o=InsertRow(r,f,u),s=GetIndexToInsert(!1,f);t.InsertItem(o,u.Elements,s)}else if(i=="InsertRowBelow"){var f=u.Elements.indexOf(r.ParentVM),o=InsertRow(r,f,u),s=GetIndexToInsert(!0,f);t.InsertItem(o,u.Elements,s)}else i=="InsertColumnLeft"?(e=r.ParentVM.Elements.indexOf(r),n.InsertColumn(r,!1,e,u)):i=="InsertColumnRight"?(e=r.ParentVM.Elements.indexOf(r),n.InsertColumn(r,!0,e,u)):i=="MoveRowUp"?n.MoveRowUp(r,u):i=="MoveRowDown"?n.MoveRowDown(r,u):i=="MoveColumnLeft"?n.MoveColumnLeft(r,u):i=="MoveColumnRight"&&n.MoveColumnRight(r,u)})}};n.InsertColumn=function(i,r,u,f){function e(i){for(var e,r,f=0;f<i.Elements.length;f++)if(e=i.Elements[f],i.Elements.indexOf(e)==u){r=e;break}if(r||n.CheckAndAddColumnsToRow(i,u,u),r){var s=i.Elements.indexOf(r),o={Name:"sfwColumn",value:"",prefix:"swc",dictAttributes:{},Elements:[],Children:[]};o.ParentVM=i;s<i.Elements.length?t.InsertItem(o,i.Elements,s):t.PushItem(o,i.Elements)}}function o(t){n.CheckAndAddColumnsToRow(t,s,u)}if(i)if(r){var s=n.GetNextColIndex(i);t.UndRedoBulkOp("Start");angular.forEach(f.Elements,o);t.UndRedoBulkOp("End")}else t.UndRedoBulkOp("Start"),angular.forEach(f.Elements,e),t.UndRedoBulkOp("End")};n.CheckAndAddColumnsToRow=function(i,r,u){for(var e=0,l=!1,o,s,c,h,f;e<=r;){for(o=undefined,s=0;s<i.Elements.length;s++)if(c=i.Elements[s],i.Elements.indexOf(c)==e){o=c;break}o?e=n.GetNextColIndex(o):(h="swc",f={Name:"sfwColumn",value:"",prefix:h,dictAttributes:{},Elements:[],Children:[]},f.ParentVM=i,t.PushItem(f,i.Elements),l=!0,e++)}l||(h="swc",f={Name:"sfwColumn",value:"",prefix:h,dictAttributes:{},Elements:[],Children:[]},f.ParentVM=i,r<i.Elements.length?t.InsertItem(f,i.Elements,u+1):t.PushItem(f,i.Elements))};n.GetNextColIndex=function(t){var i=t.ParentVM.Elements.indexOf(t),r=n.getColspan(t);return r>0?i=t.ParentVM.Elements.indexOf(t)+r:i++,i};n.getColspan=function(n){return n&&n.dictAttributes.ColumnSpan&&parseInt(n.dictAttributes.ColumnSpan)?n.dictAttributes.ColumnSpan:1};n.MoveRowUp=function(n,i){if(n){var r=n,u=i.Elements.indexOf(r.ParentVM);u>0&&(t.UndRedoBulkOp("Start"),t.DeleteItem(r.ParentVM,i.Elements),t.InsertItem(r.ParentVM,i.Elements,u-1),t.UndRedoBulkOp("End"))}};n.MoveRowDown=function(n,i){if(n){var r=n,f=i.Elements.length,u=i.Elements.indexOf(r.ParentVM);u<f-1&&(t.UndRedoBulkOp("Start"),t.DeleteItem(r.ParentVM,i.Elements),t.InsertItem(r.ParentVM,i.Elements,u+1),t.UndRedoBulkOp("End"))}};n.MoveColumnLeft=function(n,i){function u(n){var i=n.Elements[r];i&&(t.DeleteItem(n.Elements[r],n.Elements),t.InsertItem(i,n.Elements,r-1))}if(n){var r=n.ParentVM.Elements.indexOf(n);r>0&&(t.UndRedoBulkOp("Start"),angular.forEach(i.Elements,u),t.UndRedoBulkOp("End"))}};n.MoveColumnRight=function(n,i){function u(n){var i=n.Elements[r];i&&(t.DeleteItem(n.Elements[r],n.Elements),t.InsertItem(i,n.Elements,r+1))}if(n){var f=GetMaxColCount(n.ParentVM,i),r=n.ParentVM.Elements.indexOf(n);r<f-1&&(t.UndRedoBulkOp("Start"),angular.forEach(i.Elements,u),t.UndRedoBulkOp("End"))}};n.clearCell=function(n){while(n.Elements.length>0)t.DeleteItem(n.Elements[0],n.Elements)};n.clearPanel=function(){var i,r,u,f,e;if(n.ReportModel.SelectedControl&&(i=null,i=n.ReportModel.SelectedControl.Name==="sfwPanel"?n.ReportModel.SelectedControl.Elements[0]:FindParent(n.ReportModel.SelectedControl,"sfwTable",!0),i)){for(t.UndRedoBulkOp("Start"),r=0;r<i.Elements.length;r++)if(u=i.Elements[r],u)for(f=0;f<u.Elements.length;f++)n.clearCell(u.Elements[f]);n.ReportModel.SelectedControl.Name!=="sfwPanel"&&n.ReportModel.SelectedControl.Name!=="sfwTable"&&n.ReportModel.SelectedControl.Name!=="sfwColumn"&&(e=FindParent(n.ReportModel.SelectedControl,"sfwColumn",!0),e&&n.selectControl(e));t.UndRedoBulkOp("End")}};n.deleteRow=function(){var i,r;n.ReportModel.SelectedControl&&(i=FindParent(n.ReportModel.SelectedControl,"sfwRow",!0),i&&i.ParentVM&&i.ParentVM.Elements&&(i.ParentVM.Elements.length>1?(r=i.ParentVM.Elements.indexOf(i),t.UndRedoBulkOp("Start"),t.DeleteItem(i,i.ParentVM.Elements),r===i.ParentVM.Elements.length&&r--,r>-1&&i.ParentVM.Elements.length>0&&i.ParentVM.Elements[r].Elements.length>0&&n.selectControl(i.ParentVM.Elements[r].Elements[0]),t.UndRedoBulkOp("End")):alert("Atleast one row should be present")))};n.deleteColumn=function(){var i,u,f,r,e;n.ReportModel.SelectedControl&&(i=FindParent(n.ReportModel.SelectedControl,"sfwColumn",!0),i&&i.ParentVM&&i.ParentVM.ParentVM&&(u=i.ParentVM.ParentVM,f=GetMaxColCount(i.ParentVM,u),f>1?(r=i.ParentVM.Elements.indexOf(i),e=function(n){n.Elements.length>r&&(t.DeleteItem(n.Elements[r],n.Elements),n.Elements&&n.Elements.length==0&&n.ParentVM&&t.DeleteItem(n,n.ParentVM.Elements))},t.UndRedoBulkOp("Start"),angular.forEach(u.Elements,e),r===i.ParentVM.Elements.length&&r--,i.ParentVM.Elements.length>r&&n.selectControl(i.ParentVM.Elements[r]),t.UndRedoBulkOp("End")):alert("Atleast one column should be present")))};n.InsertCell=function(n,i,r){var u=-1,e,f;r?u=n.Elements.indexOf(i)+1:(u=n.Elements.indexOf(i),u>0&&(u-=u));u>-1&&(e="swc",f={Name:"sfwColumn",value:"",prefix:e,dictAttributes:{},Elements:[],Children:[]},f.ParentVM=n,u<n.Elements.length?t.InsertItem(f,n.Elements,u):t.PushItem(f,n.Elements))};n.deleteCellClick=function(){if(n.ReportModel&&n.ReportModel.SelectedControl){if(n.ReportModel.SelectedControl.Name=="sfwPanel"&&n.ReportModel.SelectedControl.IsMainPanel)return;var t=null;t=n.ReportModel.SelectedControl.Name=="sfwColumn"?n.ReportModel.SelectedControl:FindParent(n.ReportModel.SelectedControl,"sfwColumn");n.deleteCell(t)}};n.deleteCell=function(i){i.ParentVM&&i.ParentVM.ParentVM&&i.ParentVM.ParentVM.Name=="sfwTable"&&i.ParentVM.ParentVM.Elements.length==1&&i.ParentVM.Elements.length==1?alert("Cannot delete as only one cell present."):(t.DeleteItem(i,i.ParentVM.Elements),n.ReportModel&&n.ReportModel.SelectedControl&&n.ReportModel.SelectedControl.ParentVM&&(n.ReportModel.SelectedControl.ParentVM.Elements.length==0&&n.ReportModel.SelectedControl.ParentVM.Name=="sfwRow"?(t.DeleteItem(n.ReportModel.SelectedControl.ParentVM,n.ReportModel.SelectedControl.ParentVM.ParentVM.Elements),n.selectControl(n.ReportModel.SelectedControl.ParentVM.ParentVM,null)):n.selectControl(n.ReportModel.SelectedControl.ParentVM,null)))};n.OnInsertCellClick=function(t){if(n.ReportModel&&n.ReportModel.SelectedControl){if(n.ReportModel.SelectedControl.Name=="sfwPanel"&&n.ReportModel.SelectedControl.IsMainPanel)return;var i=null,r=null;i=n.ReportModel.SelectedControl.Name=="sfwColumn"?n.ReportModel.SelectedControl:FindParent(n.ReportModel.SelectedControl,"sfwColumn");r=i&&i.ParentVM?i.ParentVM.ParentVM:null;r&&i&&n.$evalAsync(function(){t=="InsertCellLeft"?n.InsertCell(i.ParentVM,i,!1):t=="InsertCellRight"&&n.InsertCell(i.ParentVM,i,!0)})}}}]);