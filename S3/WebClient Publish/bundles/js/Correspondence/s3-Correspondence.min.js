function onEntityFieldDropForDataFields(n){var t=angular.element($(n.target)).scope();if(t&&t.$parent&&t.$parent.objCorrespondenceDetails&&t.$parent.objCorrespondenceDetails.SelecetdField){for(var i=t.$parent.objCorrespondenceDetails.SelecetdField,f=t.$parent.objCorrespondenceDetails.SelecetdField.ID,r=t.$parent.objCorrespondenceDetails.SelecetdField.DataType,u=null;i.objParent&&!i.objParent.IsMainEntity;)i=i.objParent,f=[i.ID,f].join(".");r&&r.toLowerCase()=="datetime"?u="{0:d}":r&&r.toLowerCase()=="decimal"&&(i.ID.toLowerCase().indexOf("_amt")>-1||i.ID.toLowerCase().indexOf("_amount")>-1)?u="{0:C}":r&&r.toLowerCase().contains("ssn")?u="{0:000-##-####}":(i.ID.toLowerCase().contains("phone")||i.ID.toLowerCase().contains("fax"))&&(u="{0:(###)###-####}");t.$parent.$apply(function(){t.$parent.selectedFieldBookMark.dictAttributes.sfwEntityField=f;r&&(t.$parent.selectedFieldBookMark.dictAttributes.sfwDataType=r.toLowerCase());u&&(t.$parent.selectedFieldBookMark.dictAttributes.sfwDataFormat=u)})}}function onEntityFieldDropForTable(n){var i=angular.element($(n.target)).scope(),t,r;if(i&&i.objCorrespondenceDetails.SelecetdField)if(t=i.objCorrespondenceDetails.SelecetdField,t.Type=="Collection"){for(r=i.objCorrespondenceDetails.SelecetdField.ID;t.objParent&&!t.objParent.IsMainEntity&&t.objParent.Type=="Collection";)t=t.objParent,r=[t.ID,r].join(".");i.$apply(function(){i.selectedTableBookMark.dictAttributes.sfwEntityField=r})}else alert("Only attribute of type Collection/List can be dropped.");lstEntityTreeFieldData=null}function onEntityFieldDropForTableFields(n){var i=angular.element($(n.target)).scope(),t,r,u;if(i&&i&&i.objCorrespondenceDetails.SelecetdField&&(t=i.objCorrespondenceDetails.SelecetdField,r="",i.selectedTableBookMark.dictAttributes.sfwEntityField)){var o=i.objCorrespondenceDetails.SelecetdField.ID,f=getDisplayedEntity(i.objCorrespondenceDetails.LstDisplayedEntities),e=t.ID;f&&f.strDisplayName!=""&&(e=f.strDisplayName+"."+t.ID);u=e;t&&u&&u.contains(i.selectedTableBookMark.dictAttributes.sfwEntityField)?(t.DataType&&t.DataType.toLowerCase()=="datetime"?r="{0:d}":t.DataType&&t.DataType.toLowerCase()=="decimal"&&t.Value&&(t.Value.toLowerCase().indexOf("_amt")>-1||t.Value.toLowerCase().indexOf("_amount")>-1)?r="{0:C}":t.Value&&t.Value.toLowerCase().contains("ssn")?r="{0:000-##-####}":t.Value&&(t.Value.toLowerCase().contains("phone")||t.Value.toLowerCase().contains("fax"))&&(r="{0:(###)###-####}"),r!=""&&(r=r),i.$apply(function(){i.objTbl.dictAttributes.sfwDataField=u.substring(i.selectedTableBookMark.dictAttributes.sfwEntityField.length+1,u.length);i.objTbl.dictAttributes.sfwDataFormat=r})):alert("The Field Name should belong to the collection object associated with the Table.")}lstEntityTreeFieldData=null}function onEntityFieldDropForTemplateObjectBased(n){var t=angular.element($(n.target)).scope(),i,r;if(t&&t.$parent&&t.$parent.objCorrespondenceDetails.SelecetdField)if(i=t.$parent.objCorrespondenceDetails.SelecetdField,i.Type=="Object"){for(r=t.$parent.objCorrespondenceDetails.SelecetdField.ID;i.objParent&&!i.objParent.IsMainEntity&&i.objParent.Type=="Object";)i=i.objParent,r=[i.ID,r].join(".");t.$parent.$apply(function(){t.$parent.selectedTemplateBookMark.dictAttributes.sfwEntityField=r});t.$parent.getTemplateList()}else alert("Field Type has to be 'Object'")}function onEntityFieldDropForTemplateForCollection(n){var t=angular.element($(n.target)).scope(),i,r;if(t&&t.$parent&&t.$parent.objCorrespondenceDetails.SelecetdField)if(i=t.$parent.objCorrespondenceDetails.SelecetdField,i.Type=="Collection"){for(r=t.$parent.objCorrespondenceDetails.SelecetdField.ID;i.objParent&&!i.objParent.IsMainEntity&&i.objParent.Type=="Collection";)i=i.objParent,r=[i.ID,r].join(".");t.$parent.$apply(function(){t.$parent.selectedTemplateBookMark.dictAttributes.sfwEntityField=r});t.$parent.getTemplateList()}else alert("Field Type has to be 'Collection' or 'List'")}app.controller("CorrespondenceController",["$scope","$http","$rootScope","ngDialog","$EntityIntellisenseFactory","$NavigateToFileService","CONSTANTS","$ValidationService","$Errors","$filter","$timeout","$GetEntityFieldObjectService","$Entityintellisenseservice","ConfigurationFactory",function(n,t,r,u,f,e,o,s,h,c,a,v,y,p){var d,nt,g,w,it,k,rt;n.UserDataFielddatatypes=[{key:"",value:""},{key:"int",value:"Int"},{key:"boolean",value:"Boolean"},{key:"decimal",value:"Decimal"},{key:"datetime",value:"Datetime"},{key:"sfwhtmltext",value:"Html Text"}];n.datatypes=o.CORRESPONDENCEDATATYPES;n.dataformats=["","{0:d}","{0:C}","{0:000-##-####}","{0:(###)###-####}"];n.ValueSeparators=["","nl"];n.currentfile=r.currentopenfile.file;n.SelectedCorrespondenceTab="DataFields";n.DataFieldIsItemSelected=!0;n.entityTreeName="";n.lstTemplates=[];n.objCorrespondenceDetails={};n.SelectedEntityObjectTreeFields=[];n.objCorrespondenceDetails.LstDisplayedEntities=[];n.objCorrespondenceDetails.SelecetdField=[];n.templatetypes=[];n.templatetypes.push("Entity","Collection");n.CorTemplateCollection=[];n.parameterList=[];n.lstControl=o.FORM.CONTROL_TYPES;n.ilstXmlMethods=[];n.ilstAssociatedForms=[];n.ilstGlobalParameters=[];hubMain.server.getModel(n.currentfile.FilePath,n.currentfile.FileType).done(function(t){t?(n.receiveCorrespondencemodel(t),$.connection.hubForm.server.getGlobleParameters().done(function(t){t&&n.$apply(function(){n.ilstGlobalParameters=t.Elements.map(function(n){return n.dictAttributes.ID})})})):r.closeFile(n.currentfile.FileName)});n.ToggleUIDesginAttribute=function(n,t){if(n[0]&&n[0].Name){if(n[0].Name=="sfwFieldBookMarks"&&n[n.length-1].Name=="sfwFieldBookMark"&&(n[n.length-1].isAdvanceSearched=t),n[0].Name=="sfwTableBookMarks"&&(n[n.length-1].Name=="sfwTableBookMark"&&(n[n.length-1].isAdvanceSearched=t),n[n.length-1].Name=="sfwColumn"&&(n[n.length-1].isAdvanceSearched=t)),n[0].Name=="sfwQueryBookMarks"||n[0].Name=="sfwQueryForm")for(var i=0;i<n.length;i++)i==n.length-1&&n[n.length-1].Name!="sfwQueryBookMarks"&&n[n.length-1].Name!="sfwQueryForm"&&n[n.length-1].Name!="sfwRow"&&n[n.length-1].Name!="sfwTable"&&(n[n.length-1].isAdvanceSearched=t);n[0].Name=="sfwChildTemplateBookmarks"&&n[n.length-1].Name=="sfwChildTemplateBookmark"&&(n[n.length-1].isAdvanceSearched=t);n[0].Name=="sfwRuleBookmarks"&&n[n.length-1].Name=="sfwRuleBookmark"&&(n[n.length-1].isAdvanceSearched=t)}};n.traverseMainModel=function(t){var u=[],r,i;if(t.contains("-")||t.contains(","))for(r=n.objCorrespondenceDetails,i=0;i<t.split(",").length;i++)r=n.FindNodeHierarchy(r,t.split(",")[i].substring(t.split(",")[i].lastIndexOf("-")+1)),u.push(r);return u};n.selectElement=function(t){var i,u,f;if(t!=null&&t!="form"&&t!=""){if(i=n.traverseMainModel(t),u="",i.length>0){if(n.ActiveTabForCorr="Entity",i[0].Name=="sfwFieldBookMarks"&&(n.selectDataFieldsTab(),i[i.length-1].Name=="sfwFieldBookMark"&&n.SelectedFieldBookMarkClick(i[i.length-1]),u="correspondence-FieldBookMark-tab-content"),i[0].Name=="sfwTableBookMarks"&&(n.objTableBookMarks.Elements.forEach(function(n){n.IsExpanded=!1}),n.selectTablesTab(),i[i.length-1].Name=="sfwTableBookMark"&&n.SelectedTableBookMarksClick(i[i.length-1]),i[i.length-1].Name=="sfwColumn"&&(n.SelectedTableBookMarksClick(i[i.length-2]),n.selectedColumnClick(i[i.length-2].Elements.indexOf(i[i.length-1]),i[i.length-1])),u="correspondence-TableBookMark-tab-content"),i[0].Name=="sfwRepeaters"&&(n.objRepeaterBookMarks.Elements.forEach(function(n){n.IsExpanded=!1}),n.selectRepeaterControlTab(),i[i.length-1].Name=="sfwRepeater"&&n.SelectedRepeaterBookMarksClick(i[i.length-1]),i[i.length-1].Name=="sfwFieldBookMark"&&(n.SelectedRepeaterBookMarksClick(i[i.length-2]),n.selectedColumnClick(i[i.length-2].Elements.indexOf(i[i.length-1]),i[i.length-1])),u="correspondence-RepeaterControlBookMark-tab-content"),i[0].Name=="sfwQueryBookMarks"||i[0].Name=="sfwQueryForm"){for(n.ActiveTabForCorr="Items",n.selectUserFieldsTab(),f=0;f<i.length;f++)f==i.length-1&&i[i.length-1].Name!="sfwQueryBookMarks"&&i[i.length-1].Name!="sfwQueryForm"&&i[i.length-1].Name!="sfwRow"&&i[i.length-1].Name!="sfwTable"&&(SetFormSelectedControl(n.objCorrespondenceDetails,i[i.length-1],window.event),i[i.length-1].Name=="sfwQueryBookMark"&&(n.selectedQueryBookMark=i[i.length-1]));u="correspondence-QueryBookMark-tab-content"}i[0].Name=="sfwChildTemplateBookmarks"&&(n.selectTemplatesTab(),i[i.length-1].Name=="sfwChildTemplateBookmark"&&n.SelectedTemplateClick(i[i.length-1]),u="correspondence-TemplateBookMark-tab-content");i[0].Name=="sfwRuleBookmarks"&&(n.selectRuleTab(),i[i.length-1].Name=="sfwRuleBookmark"&&n.SelectedRuleBookMarkClick(i[i.length-1]),u="correspondence-RuleBookMark-tab-content");i[0].Name==="sfwHyperlinkBookmarks"&&(n.selectRuleTab(),i[i.length-1].Name==="sfwHyperlinkBookmark"&&n.selectHyperlinkBookmark(i[i.length-1]),u="correspondence-HyperlinkBookmarks-tab-content");i.length>1&&setTimeout(function(){if(u){var i=$("#"+n.currentfile.FileName+" #"+u).find(".selected");i&&t!=null&&t!="file"&&t!=""&&i.length>0&&i[0].scrollIntoView()}},500)}}else t&&t=="form"&&(n.ActiveTabForCorr="Entity");r.IsLoading=!1};n.selectedDesignSource=!1;n.ShowDesign=function(){var t,i,o,e;if(n.selectedDesignSource==!0&&(t=n.editor.getValue(),t!=null&&t!="")){if(r.IsLoading=!0,i=n.editor.selection.getCursor().row,i=i+1,t.length<32e3)hubMain.server.getDesignXmlString(t,n.currentfile,i);else{o=[];o[0]=i>0?i:1;var u="",s=[],f=0;for(e=0;e<t.length;e++)f++,u=u+t[e],f==32e3&&(f=0,s.push(u),u="");f!=0&&s.push(u);d(s,n.currentfile,"Source-Design",o)}n.receiveformcorrdesignxmlobject=function(t,i){n.selectedDesignSource=!1;n.isSourceDirty&&(n.receiveCorrespondencemodel(t),n.isSourceDirty=!1);n.$evalAsync(n.selectElement(i))}}};n.isSourceDirty;n.sourceChanged=function(){n.isSourceDirty=!0;n.isDirty=!0;n.SearchSource.IsSearchCriteriaChange=!0};d=function(n,t,i,r){for(var u=0;u<n.length;u++)hubMain.server.receiveDataPackets(n[u],n.length,t,u,i,r)};n.ShowSource=function(){var v,l,a,s,i,f,t,h,o;if(n.selectedDesignSource==!1&&(n.selectedDesignSource=!0,l=[],n.objCorrespondenceDetails!=null&&n.objCorrespondenceDetails!=undefined&&(r.IsLoading=!0,s=GetBaseModel(n.objCorrespondenceDetails),s!=""))){if(i=JSON.stringify(s),f=[],n.selectedFieldBookMark&&n.SelectedCorrespondenceTab=="DataFields"?t=n.selectedFieldBookMark:n.selectedTableBookMark&&n.SelectedCorrespondenceTab=="Tables"?t=n.selectedSfwColumn==undefined?n.selectedTableBookMark:n.selectedSfwColumn:n.selectedRepeaterBookMark&&n.SelectedCorrespondenceTab=="RepeaterControl"?t=n.selectedSfwColumn==undefined?n.selectedRepeaterBookMark:n.selectedSfwColumn:n.SelectedCorrespondenceTab=="UserFields"&&n.objCorrespondenceDetails.SelectedControl!=undefined&&n.objCorrespondenceDetails.SelectedControl.IsSelected?t=n.objCorrespondenceDetails.SelectedControl:n.selectedTemplateBookMark&&n.SelectedCorrespondenceTab=="Templates"&&n.ActiveTabForCorr=="Items"?t=n.selectedTemplateBookMark:n.selectedRuleBookMark&&n.SelectedCorrespondenceTab=="VisibleRule"?t=n.selectedRuleBookMark:n.selectedHyperlinkBookmark&&n.SelectedCorrespondenceTab=="Hyperlink"&&(t=n.selectedHyperlinkBookmark),t&&(h=[],v=n.FindDeepNode(n.objCorrespondenceDetails,t,h),a=n.getPathSource(n.objCorrespondenceDetails,h,l),angular.copy(a,f)),i.length<32e3)hubMain.server.getSourceXmlObject(i,n.currentfile,f);else{var u="",c=[],e=0;for(o=0;o<i.length;o++)e++,u=u+i[o],e==32e3&&(e=0,c.push(u),u="");e!=0&&c.push(u);d(c,n.currentfile,"Design-Source",f)}n.receivesourcexml=function(t,i){n.$apply(function(){n.xmlSource=t;var u=n.currentfile.FileName;setDataToEditor(n,t,i,u);n.$evalAsync(function(){r.IsLoading=!1;n.SelectedCorrespondenceTab="DataFields"});window.navigator.userAgent.toLowerCase().contains("chrome")&&n.$evalAsync(function(){r.IsLoading=!1})})}}};n.FindNodeHierarchy=function(n,t){if(n&&n.Elements){var i=n.Elements[t];return i==undefined&&(i=n.Elements[t-1]),i}};n.FindDeepNode=function(t,i,r){return t&&angular.forEach(t.Elements,function(t){var u=n.isValidObject(t,i);return(u&&r.push(t),t==i)?i:t.Elements&&t.Elements.length>0?i=n.FindDeepNode(t,i,r):void 0}),i};n.getPathSource=function(n,t,i){for(var u,r=0;r<t.length;r++)r==0?(u=n.Elements.indexOf(t[r]),i.push(u)):(u=t[r-1].Elements.indexOf(t[r]),i.push(u));return i};n.isValidObject=function(t,i){var u,r;if(t==i)return!0;for(r in t.Elements){if(t.Elements[r]==i)return!0;if(t.Elements[r].Elements&&t.Elements[r].Elements.length>0)for(iele in t.Elements[r].Elements)if(u=n.isValidObject(t.Elements[r].Elements[iele],i),u==!0)return u}return u};n.receiveCorrespondencemodel=function(t){n.$apply(function(){var i,u,f;for(n.objCorrespondenceExtraFields=[],n.objCorrespondenceDetails=t,n.objCorrespondenceDetails.RemoteObjectCollection=[],n.headerID=n.objCorrespondenceDetails.dictAttributes.ID,n.objCorrespondenceDetails.dictAttributes.sfwEntity&&(n.PopulateXmlMethodInCors(n.objCorrespondenceDetails.dictAttributes.sfwEntity),n.populateXmlMethods()),n.entityTreeName=n.objCorrespondenceDetails.dictAttributes.sfwEntity,i=0;i<n.objCorrespondenceDetails.Elements.length;i++)n.objCorrespondenceDetails.Elements[i].Name=="sfwAssociatedForms"?(n.objAssociatedForms=n.objCorrespondenceDetails.Elements[i],n.blnAssociatedFormPresent=n.objAssociatedForms.Elements.length>0?!0:!1):n.objCorrespondenceDetails.Elements[i].Name=="sfwFieldBookMarks"?(n.objFieldBookMarks=n.objCorrespondenceDetails.Elements[i],n.objFieldBookMarks.Elements.length>0&&n.SelectedFieldBookMarkClick(n.objFieldBookMarks.Elements[0])):n.objCorrespondenceDetails.Elements[i].Name=="sfwQueryBookMarks"?(n.objQueryBookMarks=n.objCorrespondenceDetails.Elements[i],n.SelectedQueryClick(n.objQueryBookMarks.Elements[0])):n.objCorrespondenceDetails.Elements[i].Name=="sfwTableBookMarks"?(n.objTableBookMarks=n.objCorrespondenceDetails.Elements[i],n.objTableBookMarks.Elements.length>0&&n.SelectedTableBookMarksClick(n.objTableBookMarks.Elements[0])):n.objCorrespondenceDetails.Elements[i].Name=="sfwRepeaters"?(n.objRepeaterBookMarks=n.objCorrespondenceDetails.Elements[i],n.objRepeaterBookMarks.Elements.length>0&&n.SelectedRepeaterBookMarksClick(n.objRepeaterBookMarks.Elements[0])):n.objCorrespondenceDetails.Elements[i].Name=="sfwQueryForm"?n.objQueryForm=n.objCorrespondenceDetails.Elements[i]:n.objCorrespondenceDetails.Elements[i].Name=="sfwChildTemplateBookmarks"?(n.objChildTemplateBookmarks=n.objCorrespondenceDetails.Elements[i],n.objChildTemplateBookmarks.Elements.length>0&&n.SelectedTemplateClick(n.objChildTemplateBookmarks.Elements[0])):n.objCorrespondenceDetails.Elements[i].Name=="sfwCorrespondenceTests"?(n.objCorrespondenceTests=n.objCorrespondenceDetails.Elements[i],n.setParentVM(n.objCorrespondenceDetails.Elements[i])):n.objCorrespondenceDetails.Elements[i].Name=="sfwRuleBookmarks"?(n.objRuleBookmarks=n.objCorrespondenceDetails.Elements[i],n.setParentVM(n.objCorrespondenceDetails.Elements[i])):n.objCorrespondenceDetails.Elements[i].Name=="sfwHyperlinkBookmarks"?(n.objHyperlinkBookmarks=n.objCorrespondenceDetails.Elements[i],n.setParentVM(n.objCorrespondenceDetails.Elements[i])):n.objCorrespondenceDetails.Elements[i].Name=="ExtraFields"&&(n.objCorrespondenceExtraFields=n.objCorrespondenceDetails.Elements[i]);n.objCorrespondenceDetails.dictAttributes.sfwRemoveBookmarksAfterGeneration&&n.objCorrespondenceDetails.dictAttributes.sfwRemoveBookmarksAfterGeneration.toLowerCase()==="false"||(n.objCorrespondenceDetails.dictAttributes.sfwRemoveBookmarksAfterGeneration="");n.populateAssociatedForms();n.objAssociatedForms==undefined&&(n.objAssociatedForms=n.CreateNewObject("sfwAssociatedForms",n.objCorrespondenceDetails));n.objFieldBookMarks==undefined&&(n.objFieldBookMarks=n.CreateNewObject("sfwFieldBookMarks",n.objCorrespondenceDetails));n.objQueryBookMarks==undefined&&(n.objQueryBookMarks=n.CreateNewObject("sfwQueryBookMarks",n.objCorrespondenceDetails));n.objTableBookMarks==undefined&&(n.objTableBookMarks=n.CreateNewObject("sfwTableBookMarks",n.objCorrespondenceDetails));n.objRepeaterBookMarks==undefined&&(n.objRepeaterBookMarks=n.CreateNewObject("sfwRepeaters",n.objCorrespondenceDetails));n.objQueryForm==undefined&&(n.objQueryForm=n.CreateNewObject("sfwQueryForm",n.objCorrespondenceDetails));n.objRuleBookmarks==undefined&&(n.objRuleBookmarks=n.CreateNewObject("sfwRuleBookmarks",n.objCorrespondenceDetails));n.objHyperlinkBookmarks||(n.objHyperlinkBookmarks=n.CreateNewObject("sfwHyperlinkBookmarks",n.objCorrespondenceDetails));n.objCorrespondenceTests==undefined&&(n.objCorrespondenceTests=n.CreateNewObject("sfwCorrespondenceTests",n.objCorrespondenceDetails));n.objCorrespondenceExtraFields.length==0?n.objCorrespondenceExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]}:n.objQueryForm.Elements&&n.objQueryForm.Elements.length>0&&(n.objCorrespondenceDetails.SelectedControl=n.objQueryForm.Elements[0]);n.objChildTemplateBookmarks==undefined&&(n.objChildTemplateBookmarks=n.CreateNewObject("sfwChildTemplateBookmarks",n.objCorrespondenceDetails));n.validationErrorList=[];h.validationListObj&&angular.isArray(h.validationListObj)&&(u=c("filter")(h.validationListObj,{FileName:n.currentfile.FileName}),u.length==0&&h.validationListObj.push({FileName:n.currentfile.FileName,errorList:[]}),f=c("filter")(h.validationListObj,{FileName:n.currentfile.FileName})[0],n.validationErrorList=f.errorList=[]);r.IsLoading=!1;$.connection.hubForm.server.getRemoteObjectList().done(function(t){n.$evalAsync(function(){t&&(n.objCorrespondenceDetails.RemoteObjectCollection=t,n.objCorrespondenceDetails.RemoteObjectCollection&&n.objCorrespondenceDetails.RemoteObjectCollection.length>0&&n.objCorrespondenceDetails.RemoteObjectCollection.splice(0,0,{dictAttributes:{ID:""}}))})})})};n.setParentVM=function(t){t&&angular.forEach(t.Elements,function(i){i.ParentVM=[];i.ParentVM=t;n.setParentVM(i)})};nt=function(){n.lstEntityTemplate={};n.parameterList=[];n.lstEntityTemplate[n.objCorrespondenceDetails.dictAttributes.sfwEntity]=n.objCorrespondenceDetails.dictAttributes.sfwTemplate;g(n.objChildTemplateBookmarks,n.objCorrespondenceDetails.dictAttributes.sfwEntity);n.CorTemplateCollection&&n.CorTemplateCollection.length<=0&&n.PopulateCorrespondenceTemplate();$.connection.hubForm.server.getGlobleParameters().done(function(t){n.$evalAsync(function(){t&&n.objGlobleParametersList(t)})});$.connection.hubMain.server.getCorrespondenceValidationData(n.lstEntityTemplate,n.objCorrespondenceDetails.dictAttributes.sfwEntity).done(function(t){n.validationData=t;n.resourceList=s.getListByPropertyName(n.validationData.Resources,"ResourceID",!1);n.codeGroupList=n.validationData.CodeGroup;ut(n.validationData[n.objCorrespondenceDetails.dictAttributes.sfwEntity+"_rule"]);n.objEntityExtraData.lstHardErrors=n.createValidationRuleList(n.validationData[n.objCorrespondenceDetails.dictAttributes.sfwEntity+"_rule"],!1,!1);n.objCorrespondenceDetails&&(n.objCorrespondenceDetails.dictAttributes.hasOwnProperty("sfwEntity")&&s.validateEntity(n.objCorrespondenceDetails,undefined),n.objCorrespondenceDetails.dictAttributes.hasOwnProperty("sfwResource")&&n.objCorrespondenceDetails.dictAttributes.sfwResource&&n.objCorrespondenceDetails.dictAttributes.sfwResource!=0&&s.checkValidListValue(n.resourceList,n.objCorrespondenceDetails,n.objCorrespondenceDetails.dictAttributes.sfwResource,"sfwResource","invalid_resource",o.VALIDATION.RESOURCE_NOT_EXISTS,n.validationErrorList),n.objCorrespondenceDetails.dictAttributes.hasOwnProperty("sfwFooterTemplate")&&n.objCorrespondenceDetails.dictAttributes.sfwFooterTemplate&&s.checkValidListValue(n.CorTemplateCollection,n.objCorrespondenceDetails,n.objCorrespondenceDetails.dictAttributes.sfwFooterTemplate,"sfwFooterTemplate","sfwFooterTemplate",o.VALIDATION.INVALID_TEMPLATE,n.validationErrorList),n.objCorrespondenceDetails.dictAttributes.hasOwnProperty("sfwHeaderTemplate")&&n.objCorrespondenceDetails.dictAttributes.sfwHeaderTemplate&&s.checkValidListValue(n.CorTemplateCollection,n.objCorrespondenceDetails,n.objCorrespondenceDetails.dictAttributes.sfwHeaderTemplate,"sfwHeaderTemplate","sfwHeaderTemplate",o.VALIDATION.INVALID_TEMPLATE,n.validationErrorList),n.objCorrespondenceDetails.dictAttributes.hasOwnProperty("sfwConditionalRule")&&n.objCorrespondenceDetails.dictAttributes.sfwConditionalRule&&s.checkValidListValue(n.objEntityExtraData.lstRules,n.objCorrespondenceDetails,n.objCorrespondenceDetails.dictAttributes.sfwConditionalRule,"sfwConditionalRule","sfwConditionalRule",o.VALIDATION.CONDITIONAL_RULE_NOT_EXISTS,n.validationErrorList));n.objQueryForm&&n.iterateModel(n.objQueryForm);n.objCorrespondenceDetails&&b(n.objCorrespondenceDetails,n.objCorrespondenceDetails.dictAttributes.sfwEntity,n.objEntityExtraData);a(function(){$("#validation-btn").prop("disabled",!1)});r.IsLoading=!1})};g=function(t,i){angular.forEach(t.Elements,function(t){var r=k(t.dictAttributes.sfwEntityField,i,t),u;r&&!n.lstEntityTemplate.hasOwnProperty(r)&&(u=t.dictAttributes.sfwTemplate?t.dictAttributes.sfwTemplate:n.objCorrespondenceDetails.dictAttributes.sfwTemplate,n.lstEntityTemplate[r]=u);t.Elements&&t.Elements.length>0&&g(t,i)})};n.objGlobleParametersList=function(t){angular.forEach(t.Elements,function(t){if(t&&t.dictAttributes.ID){var i="~"+t.dictAttributes.ID;n.parameterList.push(i)}})};n.createValidationRuleList=function(n){var i=[],t;return n&&n.lstHardErrorList&&(t=n.lstHardErrorList[0],t&&t.Elements.length>0&&angular.forEach(t.Elements,function(n){n!=undefined&&n.dictAttributes.ID!=""&&i.push(n.dictAttributes.ID)})),i};w=function(n,t,i,r){var u=[],f;return u=r?y.GetIntellisenseData(n,"","",!0,!1,!1,!1,!1,!0):y.GetIntellisenseData(n,"","",!0,!1,!0,!1,!1,!1),f=[],u&&u.length>0&&(t?u=c("filter")(u,{ReturnType:"Collection"}):i&&(u=c("filter")(u,{ReturnType:"Object"})),u&&u.length>0&&(f=s.getListByPropertyName(u,"ID",!1))),f};n.validateFileData=function(){var t=c("filter")(h.validationListObj,{FileName:n.currentfile.FileName})[0];n.validationErrorList=t.errorList=[];r.IsLoading=!0;nt()};n.iterateModel=function(t){angular.forEach(t.Elements,function(t){o.FORM.IGNORE_NODES.indexOf(t.Name)<=-1&&(s.validateID(t,n.validationErrorList,t.dictAttributes.ID),s.checkDuplicateId(t,n.objQueryForm,n.validationErrorList,!1,o.FORM.NODES));t.Elements&&t.Elements.length>0&&o.FORM.NODES.indexOf(t.Name)>-1&&n.iterateModel(t)})};n.objEntityExtraData={};var ut=function(t){n.objEntityExtraData.lstRules=PopulateEntityRules(t,!1,!1)},b=function(t,i,r){angular.forEach(t.Elements,function(t){var u,e,h,c;t.dictAttributes.hasOwnProperty("sfwVisibleRule")&&t.dictAttributes.sfwVisibleRule&&s.checkValidListValue(r.lstRules,t,undefined,"sfwVisibleRule","invalid_visible_rule",o.VALIDATION.VISIBLE_RULE_NOT_EXISTS,n.validationErrorList);t.dictAttributes.hasOwnProperty("sfwEnableRule")&&t.dictAttributes.sfwEnableRule&&s.checkValidListValue(r.lstRules,t,undefined,"sfwEnableRule","invalid_enable_rule",o.VALIDATION.ENABLE_RULE_NOT_EXISTS,n.validationErrorList);t.dictAttributes.hasOwnProperty("sfwReadOnlyRule")&&t.dictAttributes.sfwReadOnlyRule&&s.checkValidListValue(r.lstRules,t,undefined,"sfwReadOnlyRule","invalid_readonly_rule",o.VALIDATION.READONLY_RULE_NOT_EXISTS,n.validationErrorList);t.Name=="sfwTableBookMark"&&t.dictAttributes.hasOwnProperty("sfwEntityField")&&t.dictAttributes.sfwEntityField&&(u="Object,Collection,List",s.checkValidListValueForMultilevel([],t,t.dictAttributes.sfwEntityField,i,"sfwEntityField","sfwEntityField",o.VALIDATION.ENTITY_FIELD_INCORRECT,n.validationErrorList,!1,u));t.dictAttributes.hasOwnProperty("sfwColumnHeader")&&t.Name=="sfwColumn"&&(u="",s.checkValidListValueForMultilevel([],t,t.dictAttributes.sfwEntityField,i,"sfwEntityField","sfwEntityField",o.VALIDATION.ENTITY_FIELD_INCORRECT,n.validationErrorList,!0,u));t.Name=="sfwFieldBookMark"&&t.dictAttributes.hasOwnProperty("sfwEntityField")&&t.dictAttributes.sfwEntityField&&(u="",s.checkValidListValueForMultilevel([],t,t.dictAttributes.sfwEntityField,i,"sfwEntityField","sfwEntityField",o.VALIDATION.ENTITY_FIELD_INCORRECT,n.validationErrorList,!1,u));t.Name=="sfwChildTemplateBookmark"&&t.dictAttributes.hasOwnProperty("sfwEntityField")&&t.dictAttributes.sfwEntityField&&(u="",t.dictAttributes.sfwChildTemplateType=="Entity"?u="Object":t.dictAttributes.sfwChildTemplateType=="Collection"&&(u="Collection,List"),s.checkValidListValueForMultilevel([],t,t.dictAttributes.sfwEntityField,i,"sfwEntityField","sfwEntityField",o.VALIDATION.ENTITY_FIELD_INCORRECT,n.validationErrorList,!1,u));t.dictAttributes.hasOwnProperty("sfwXmlMethod")&&t.dictAttributes.sfwXmlMethod&&(e=w(i,!1,!1,!0),s.checkValidListValue(e,t,t.dictAttributes.sfwXmlMethod,"sfwXmlMethod","invalid_method_name",o.VALIDATION.INVALID_METHOD,n.validationErrorList));t.dictAttributes.hasOwnProperty("sfwRetrievalQuery")&&t.dictAttributes.sfwRetrievalQuery&&s.checkValidQuery(f.getEntityIntellisense(),t,t.dictAttributes.sfwRetrievalQuery,undefined,"sfwRetrievalQuery","sfwRetrievalQuery",o.VALIDATION.INVALID_QUERY,n.validationErrorList);t.dictAttributes.hasOwnProperty("sfwRetrievalMethod")&&t.dictAttributes.sfwRetrievalMethod&&(e=w(i,!1,!0),s.checkValidListValue(e,t,t.dictAttributes.sfwRetrievalMethod,"sfwRetrievalMethod","invalid_retrieval_method",o.VALIDATION.INVALID_METHOD,n.validationErrorList));t.dictAttributes.hasOwnProperty("sfwResource")&&t.dictAttributes.sfwResource&&t.dictAttributes.sfwResource!=0&&s.checkValidListValue(n.resourceList,t,t.dictAttributes.sfwResource,"sfwResource","invalid_resource",o.VALIDATION.RESOURCE_NOT_EXISTS,n.validationErrorList);t.dictAttributes.hasOwnProperty("sfwValidationRules")&&t.dictAttributes.sfwValidationRules&&s.checkMultipleValueWithList(r.lstHardErrors,t,t.dictAttributes.sfwValidationRules,";","sfwValidationRules","invalid_validation_rule",o.VALIDATION.VALIDATION_RULE_NOT_EXISTS,n.validationErrorList);t.dictAttributes.hasOwnProperty("sfwTemplateName")&&t.dictAttributes.sfwTemplateName&&n.validateTemplateName(t,"onload");t.dictAttributes.hasOwnProperty("sfwLoadSource")&&t.dictAttributes.sfwLoadSource&&(t.dictAttributes.sfwLoadType=="CodeGroup"?(h=s.getListByPropertyName(n.codeGroupList,"CodeID"),h.push("0"),s.checkValidListValue(h,t,t.dictAttributes.sfwLoadSource,"sfwLoadSource","invalid_code_group",o.VALIDATION.CODE_GROUP_NOT_EXISTS,n.validationErrorList)):t.dictAttributes.sfwLoadType=="Query"?s.checkValidQuery(f.getEntityIntellisense(),t,t.dictAttributes.sfwLoadSource,undefined,"sfwLoadSource","sfwLoadSource",o.VALIDATION.INVALID_QUERY,n.validationErrorList):t.dictAttributes.sfwLoadType=="Method"?(e=w(i,!0,!1),s.checkValidListValue(e,t,t.dictAttributes.sfwLoadSource,"sfwLoadSource","invalid_method",o.VALIDATION.INVALID_METHOD,n.validationErrorList)):t.dictAttributes.sfwLoadType=="ServerMethod"&&it(t));t.dictAttributes.hasOwnProperty("sfwQueryID")&&t.dictAttributes.sfwQueryID&&(h=getQueryBookMarksID(n.objCorrespondenceDetails),s.checkValidListValue(h,t,t.dictAttributes.sfwQueryID,"sfwQueryID","invalid_query_id",o.VALIDATION.INVALID_QUERY_ID,n.validationErrorList));t.dictAttributes.hasOwnProperty("sfwParameters")&&t.dictAttributes.sfwParameters&&n.validateParameters(t,t.dictAttributes.sfwParameters,"sfwParameters");t.dictAttributes.hasOwnProperty("sfwAutoParameters")&&t.dictAttributes.sfwAutoParameters&&n.validateParameters(t,t.dictAttributes.sfwAutoParameters,"sfwAutoParameters");t.dictAttributes.hasOwnProperty("sfwCascadingRetrievalParameters")&&t.dictAttributes.sfwCascadingRetrievalParameters&&n.validateParameters(t,t.dictAttributes.sfwCascadingRetrievalParameters,"sfwCascadingRetrievalParameters");t.Elements&&t.Elements.length>0&&(t.Name=="sfwTableBookMark"?(c=k(t.dictAttributes.sfwEntityField,i,t),c?b(t,c,r):b(t,i,r)):b(t,i,r))})},tt=function(t){angular.forEach(t.Elements,function(t){t&&t.dictAttributes.ID&&n.parameterList.push(t.dictAttributes.ID);t.Elements.length>0&&tt(t)})};n.validateParameters=function(t,i,r){var u,o,f,h,e;for(tt(n.objQueryForm),u="prop-",r=="sfwAutoParameters"?u="autoprop-":r=="sfwCascadingRetrievalParameters"&&(u="cprop-"),o=i.split(";"),f=0;f<o.length;f++)h=o[f].split("="),e=h[h.length-1],s.checkValidListValue(n.parameterList,t,e,r,u+e,"parameter value("+e+") does not exists",n.validationErrorList)};it=function(t){var i=[],r,u;n.validationData&&n.validationData.hasOwnProperty("RemoteObject")&&(i=n.validationData.RemoteObject);r=GetServerMethodObject("srvCommon",i);u=PopulateServerMethod([],t,r,!0);s.checkValidListValue(u,t,t.dictAttributes.sfwLoadSource,"sfwLoadSource","sfwLoadSource",o.VALIDATION.INVALID_METHOD,n.validationErrorList)};k=function(n,t,i){var f,e=r.getEntityAttributeIntellisense(t,!0,!1,!1,!1,!1),s,o,u;if(n&&n.contains("."))for(s=i.dictAttributes.sfwEntityField.split("."),o=0;o<s.length;o++)e&&(u=e.filter(function(n){return n.ID==s[o]})[0],u&&u.Entity&&(f=u.Entity,e=r.getEntityAttributeIntellisense(f,!0,!1,!1,!1,!1)));else f=i.dictAttributes.sfwEntityField,u=e.filter(function(t){return t.ID==n})[0],u&&u.Entity&&(f=u.Entity);return f};n.CreateNewObject=function(n,t){var i={Name:n,Value:"",dictAttributes:{},Elements:[]};return t.Elements.push(i),i};n.SelectedFieldBookMarkClick=function(t){n.selectedFieldBookMark=t};n.SelectedRuleBookMarkClick=function(t){n.selectedRuleBookMark=t};n.selectHyperlinkBookmark=function(t){n.selectedHyperlinkBookmark=t};n.SelectedTableBookMarksClick=function(t){t&&(t.IsExpanded=!0,n.selectedTableBookMark=t,n.SelectedTableEntityID="",n.selectedTableBookMark.dictAttributes&&n.selectedTableBookMark.dictAttributes.sfwEntityField&&n.setEntityIDForSelectedTable(n.selectedTableBookMark.dictAttributes.sfwEntityField),n.selectedSfwColumn=undefined,n.selectedColumn=undefined)};n.SelectedRepeaterBookMarksClick=function(t){t&&(t.IsExpanded=!0,n.selectedRepeaterBookMark=t,n.SelectedTableEntityID="",n.selectedRepeaterBookMark.dictAttributes&&n.selectedRepeaterBookMark.dictAttributes.sfwEntityField&&n.setEntityIDForSelectedTable(n.selectedRepeaterBookMark.dictAttributes.sfwEntityField))};n.setEntityIDForSelectedTable=function(t){var s,e,r,u,i;if(t){s=n.objCorrespondenceDetails.dictAttributes.sfwEntity;e=[];n.SelectedTableEntityID=s;var c=f.getEntityIntellisense(),h=c,o=h.filter(function(n){return n.ID==s});if(o.length>0&&(e=o[0].Attributes),r=t.split("."),r.length>0)for(u=0;u<r.length;u++)i=e.filter(function(n){return n.ID==r[u]}),i.length>0&&typeof i[0].DataType!="undefined"&&(i[0].DataType=="Object"||i[0].DataType=="Collection"||i[0].DataType=="CDOCollection"||i[0].DataType=="List")&&typeof i[0].Entity!="undefined"&&i[0].ID==r[u]&&r[u]!=""&&(e=[],entityname=i[0].Entity,n.SelectedTableEntityID=entityname,o=h.filter(function(n){return n.ID==entityname}),o.length>0&&(e=o[0].Attributes))}};n.selectedColumnClick=function(t,i){n.selectedColumn=t;n.selectedSfwColumn=i};n.SelectedQueryClick=function(t){t&&(n.selectedQueryBookMark=t)};n.deleteSelectedColumn=function(){var t=-1;n.selectedSfwColumn&&(t=n.selectedTableBookMark.Elements.indexOf(n.selectedSfwColumn),r.DeleteItem(n.selectedTableBookMark.Elements[t],n.selectedTableBookMark.Elements));n.selectedSfwColumn=undefined;t<n.selectedTableBookMark.Elements.length&&t>-1?(n.selectedSfwColumn=n.selectedTableBookMark.Elements[t],n.selectedColumn=t):n.selectedTableBookMark.Elements.length>0&&(n.selectedSfwColumn=n.selectedTableBookMark.Elements[t-1],n.selectedColumn=t-1);n.isDirty=!0};n.canDeleteColumn=function(){return n.selectedSfwColumn?!0:!1};n.moveSelectedColumnUp=function(){if(n.selectedSfwColumn){var t=n.selectedTableBookMark.Elements.indexOf(n.selectedSfwColumn),i=n.selectedTableBookMark.Elements[t-1];i&&(n.selectedTableBookMark.Elements[t-1]=n.selectedSfwColumn,n.selectedTableBookMark.Elements[t]=i,n.selectedColumn=t-1)}};n.canmoveSelectedColumnUp=function(){var i=!1,t;if(n.selectedSfwColumn!=undefined)for(t=0;t<n.selectedTableBookMark.Elements.length;t++)n.selectedTableBookMark.Elements[t]==n.selectedSfwColumn&&t>0&&(i=!0);return i};n.moveSelectedColumnDown=function(){if(n.selectedSfwColumn){var t=n.selectedTableBookMark.Elements.indexOf(n.selectedSfwColumn),i=n.selectedTableBookMark.Elements[t+1];i&&(n.selectedTableBookMark.Elements[t+1]=n.selectedSfwColumn,n.selectedTableBookMark.Elements[t]=i,n.selectedColumn=t+1)}};n.canmoveSelectedColumnDown=function(){var i=!1,t;if(n.selectedSfwColumn!=undefined)for(t=0;t<n.selectedTableBookMark.Elements.length;t++)n.selectedTableBookMark.Elements[t]==n.selectedSfwColumn&&t<n.selectedTableBookMark.Elements.length-1&&(i=!0);return i};n.PopulateXmlMethodInCors=function(t){var r,i;n.lstXmlMethods=[];t&&(r=f.getEntityIntellisense(),r&&(i=r.filter(function(n){return n.ID==t}),i&&i.length>0&&angular.forEach(i,function(t){angular.forEach(t.ObjectMethods,function(t){n.lstXmlMethods.push(t)})})))};n.SelectedTemplateClick=function(t){n.selectedTemplateBookMark=t;n.getTemplateList()};n.onchangeEnitityTableBookmark=function(t){n.entityTreeName=t?t:n.objCorrespondenceDetails.dictAttributes.sfwEntity};n.onDetailClick=function(){var t=n.$new();t.objExtraFields=[];t.objDirFunctions={};t.showExtraFieldsTab=!1;t.formName="Correspondence";t.lstAssociatedForms=[];t.objCorrespondenceDetails={};t.LoadAssociatedForms=function(){if(t.objAssociatedForms&&t.objAssociatedForms.Elements.length>0)for(var n=0;n<t.objAssociatedForms.Elements.length;n++)t.lstAssociatedForms.push(t.objAssociatedForms.Elements[n]);t.blnAssociatedFormPresent?angular.forEach(t.objAssociatedForms.Elements,function(n){$.connection.hubCorrespondence.server.getFormEntityName(n.dictAttributes.ID).done(function(i){t.receiveFormEntityName(i,n.dictAttributes.ID)})}):angular.forEach(t.lstAssociatedForms,function(n){$.connection.hubCorrespondence.server.getFormEntityName(n.FormName).done(function(i){t.receiveFormEntityName(i,n.FormName)})})};t.Init=function(){t.objCorrespondenceDetails={dictAttributes:{},errors:{}};angular.forEach(n.objCorrespondenceDetails.dictAttributes,function(n,i){t.objCorrespondenceDetails.dictAttributes[i]=n});angular.forEach(n.objCorrespondenceDetails.errors,function(n,i){t.objCorrespondenceDetails.errors[i]=n});t.blnAssociatedFormPresent=n.blnAssociatedFormPresent;t.objAssociatedForms=n.objAssociatedForms;t.LoadAssociatedForms();t.removeBookmarksAfterGeneration=!t.objCorrespondenceDetails.dictAttributes.sfwRemoveBookmarksAfterGeneration;n.PopulateCorrespondenceTemplate();$.connection.hubEntityModel.server.getInitialLoadRules(n.objCorrespondenceDetails.dictAttributes.sfwEntity).done(function(n){t.conditionalRules=n})};t.onRemoveBookmarksAfterGenerationChange=function(){t.objCorrespondenceDetails.dictAttributes.sfwRemoveBookmarksAfterGeneration=t.removeBookmarksAfterGeneration?"":"False"};t.validateCorsDetails=function(){var r=!1,e,u,h,i,n,o,l,s;if(t.CorDetailsErrorMessage="",t.objCorrespondenceDetails.dictAttributes.sfwEntity&&(e=f.getEntityIntellisense(),t.lstAssociatedForms&&t.lstAssociatedForms.length>0))for(u=0,h=t.lstAssociatedForms.length;u<h;u++)if(t.objCorrespondenceDetails.dictAttributes.sfwEntity!=t.lstAssociatedForms[u].FormEntity){if(!t.lstAssociatedForms[u].dictAttributes.sfwEntityField){t.CorDetailsErrorMessage="Please select a Target Entity for the form.";r=!0;break}if(i=[],e&&e.length>0&&(i=c("filter")(e,{ID:t.lstAssociatedForms[u].FormEntity},!0)),n=[],i&&i.length>0&&i[0].Attributes&&i[0].Attributes.length>0){for(o=t.lstAssociatedForms[u].dictAttributes.sfwEntityField.split("."),l=o[o.length-1],s=0;s<o.length;s++)n=i[0].Attributes.filter(function(n){return n.ID==o[s]&&n.Type=="Object"}),n&&n.length>0&&(i=c("filter")(e,{ID:n[0]&&n[0].Entity},!0));if(n=n.filter(function(n){return n.ID==l&&n.Entity==t.objCorrespondenceDetails.dictAttributes.sfwEntity&&n.Type=="Object"}),n&&n.length>0)r=!1;else{t.CorDetailsErrorMessage="The Target Entity must be of type main Entity.";r=!0;break}}}return r?r:(t.objDirFunctions.getExtraFieldData&&(t.objExtraFields=t.objDirFunctions.getExtraFieldData()),r=validateExtraFields(t),t.CorDetailsErrorMessage=t.FormDetailsErrorMessage,r)};t.refreshAssociatedForms=function(){$.connection.hubCorrespondence.server.loadAssociatedForms(t.objCorrespondenceDetails.dictAttributes.sfwTemplate,t.objCorrespondenceDetails.dictAttributes.sfwType).done(function(n){t.$apply(function(){var u,i,e,f;for(r.IsLoading=!0,u=[],i=0;i<t.lstAssociatedForms.length;i++)u.length>0&&!u.some(function(n){return n.dictAttributes.ID==t.lstAssociatedForms[i]})?u.push(t.lstAssociatedForms[i]):u.push(t.lstAssociatedForms[i]);if(n)for(t.lstAssociatedForms=[],i=0;i<n.length;i++)e=u.filter(function(t){return t.dictAttributes.ID==n[i].FormName}),f={Name:"sfwAssociatedForm",Value:"",dictAttributes:{},Elements:[]},f.dictAttributes.ID=n[i].FormName,f.FormEntity=n[i].FormEntity,e&&e.length>0&&(f.dictAttributes.sfwEntityField=e[0].dictAttributes.sfwEntity),t.lstAssociatedForms.push(f);r.IsLoading=!1})})};t.receiveFormEntityName=function(n,i){t.$apply(function(){angular.forEach(t.lstAssociatedForms,function(t){t.dictAttributes.ID==i&&(t.FormEntity=n)})})};t.onClickAssociatedForm=function(n,i){t.selectCurrentAF=n;t.selectedAssociatedFormRow=i};t.onClickWithoutAssociatedForm=function(n,i){t.selectCurrentWithoutAF=n;t.selectedWithoutAssociatedFormRow=i;var u=f.getEntityIntellisense(),r=u.filter(function(n){return n.BusinessObjectName==t.selectedWithoutAssociatedFormRow.FormEntity});r.length>0&&(t.selectedWithoutAssociatedFormRow.EntityName=r[0].ID)};t.openAssociatedFormsDialog=function(n,i){var u=t.$new(),o,e;t&&(t.blnAssociatedFormPresent?(t.selectCurrentAF=n,t.selectedAssociatedFormRow=i):(t.selectCurrentWithoutAF=n,t.selectedWithoutAssociatedFormRow=i,o=f.getEntityIntellisense(),e=o.filter(function(n){return n.BusinessObjectName==t.selectedWithoutAssociatedFormRow.FormEntity}),e.length>0&&(t.selectedWithoutAssociatedFormRow.EntityName=e[0].ID)));u.onAssociatedFormOKClick=function(){var f,i,e;if(t.blnAssociatedFormPresent){var n="",f=getDisplayedEntity(t.selectedAssociatedFormRow.LstDisplayedEntities),i=f.strDisplayName;t.selectedAssociatedFormRow&&t.selectedAssociatedFormRow.SelectedField&&(n=t.selectedAssociatedFormRow.SelectedField.ID,i!=""&&(n=i+"."+t.selectedAssociatedFormRow.SelectedField.ID));t.selectedAssociatedFormRow.dictAttributes.sfwEntityField=n}else f=getDisplayedEntity(t.selectedWithoutAssociatedFormRow.LstDisplayedEntities),i=f.strDisplayName,t.selectedWithoutAssociatedFormRow.Field&&(n=t.selectedWithoutAssociatedFormRow.Field.ID,i!=""&&(n=i+"."+t.selectedWithoutAssociatedFormRow.Field.ID)),t.selectedWithoutAssociatedFormRow.TargetEntity=n,e={Name:"sfwAssociatedForm",value:"",dictAttributes:{ID:t.selectedWithoutAssociatedFormRow.FormName,sfwEntityField:n,FormEntity:t.selectedWithoutAssociatedFormRow.EntityName},Elements:[]},r.PushItem(e,t.objAssociatedForms.Elements,"onClickWithoutAssociatedForm"),t.blnAssociatedFormPresent=!0;u.onAssociatedFormCloseClick()};u.onAssociatedFormCloseClick=function(){u.openAssociatedFormDialog.close()};u.openAssociatedFormDialog=r.showDialog(u,"Associated Form","Correspondence/views/CorrespondenceAssociatedForms.html")};t.NavigateToEntity=function(n,i){n&&n!=""&&!i&&(t.onOkClick(),e.NavigateToFile(n,"",""))};t.onOkClick=function(){if(r.UndRedoBulkOp("Start"),angular.forEach(t.objCorrespondenceDetails.dictAttributes,function(t,i){r.EditPropertyValue(n.objCorrespondenceDetails.dictAttributes[i],n.objCorrespondenceDetails.dictAttributes,i,t)}),t.objDirFunctions.prepareExtraFieldData&&t.objDirFunctions.prepareExtraFieldData(),t.lstAssociatedForms&&t.lstAssociatedForms.length>0){n.objAssociatedForms&&n.objAssociatedForms.Elements.length>0&&r.EditPropertyValue(n.objAssociatedForms.Elements,n.objAssociatedForms,"Elements",[]);for(var i=0;i<t.lstAssociatedForms.length;i++)r.PushItem(t.lstAssociatedForms[i],n.objAssociatedForms.Elements)}n.objAssociatedForms.Elements.length>0?r.EditPropertyValue(n.blnAssociatedFormPresent,n,"blnAssociatedFormPresent",!0):r.EditPropertyValue(n.blnAssociatedFormPresent,n,"blnAssociatedFormPresent",!1);r.EditPropertyValue(n.entityTreeName,n,"entityTreeName",n.objCorrespondenceDetails.dictAttributes.sfwEntity);r.UndRedoBulkOp("End");n.objCorrespondenceDetails.errors={};angular.forEach(t.objCorrespondenceDetails.errors,function(t,i){n.objCorrespondenceDetails.errors[i]=t});$.isEmptyObject(n.objCorrespondenceDetails.errors)&&s.removeObjInToArray(n.validationErrorList,n.objCorrespondenceDetails);t.closeDetails()};t.closeDetails=function(){s.removeObjInToArray(n.validationErrorList,t.objCorrespondenceDetails);t.TemplateDetailsDialog.close()};t.onConditionalRuleKeyDown=function(n){var i=$(n.target);n.key!="Down"&&n.key!="Up"&&n.key!="Left"&&n.key!="Right"&&t.setCondtionalRuleData(i)};t.showConditionalRuleIntellisense=function(n){var i=$(n.target).prevAll("input[type='text']");t.setCondtionalRuleData(i);t.validateConditionalRule(n)};t.setCondtionalRuleData=function(n){t.objCorrespondenceDetails&&!t.objCorrespondenceDetails.errors&&(t.objCorrespondenceDetails.errors={});t.objCorrespondenceDetails&&t.objCorrespondenceDetails.dictAttributes.sfwEntity&&t.objCorrespondenceDetails.errors&&!t.objCorrespondenceDetails.errors.invalid_entity?$.connection.hubEntityModel.server.getInitialLoadRules(t.objCorrespondenceDetails.dictAttributes.sfwEntity).done(function(i){t.conditionalRules=i;n.focus();setSingleLevelAutoComplete(n,t.conditionalRules);$(n).data("ui-autocomplete")&&$(n).autocomplete("search",$(n).val())}):setSingleLevelAutoComplete(n,[])};t.validateConditionalRule=function(i){var r=$(i.target),u=t.conditionalRules?t.conditionalRules:[];s.checkValidListValue(u,t.objCorrespondenceDetails,$(r).val(),"sfwConditionalRule","sfwConditionalRule",o.VALIDATION.CONDITIONAL_RULE_NOT_EXISTS,n.validationErrorList)};t.navigateToConditionalRule=function(i){var r=n.objCorrespondenceDetails.dictAttributes.sfwEntity;i&&i!=""&&(t.onOkClick(),e.NavigateToFile(r,"initialload",i))};t.TemplateDetailsDialog=r.showDialog(t,"Details","Correspondence/views/CorrespondenceTemplateDetails.html",{width:700,height:560});t.Init()};n.onSynchroniseClick=function(){r.IsLoading=!0;$.connection.hubCorrespondence.server.synchronizeBookmarks(n.objCorrespondenceDetails.dictAttributes.sfwTemplate,n.objCorrespondenceDetails.dictAttributes.ID,n.objCorrespondenceDetails.dictAttributes.sfwType)};n.receieveSyncronizeBookMarkData=function(t){var i=JSON.parse(t);r.UndRedoBulkOp("Start");n.synchronizeBookmarksValues(i);n.SyncronizeCorTestStep(i);r.UndRedoBulkOp("End");n.objFieldBookMarks.Elements.length==0?n.selectedFieldBookMark=undefined:n.objFieldBookMarks.Elements.length>0&&(n.selectedFieldBookMark=n.objFieldBookMarks.Elements[0]);n.objTableBookMarks.Elements.length==0?n.selectedTableBookMark=undefined:n.objTableBookMarks.Elements.length>0&&(n.selectedTableBookMark=n.objTableBookMarks.Elements[0]);n.objRepeaterBookMarks.Elements.length==0?n.selectedRepeaterBookMark=undefined:n.objRepeaterBookMarks.Elements.length>0&&(n.selectedRepeaterBookMark=n.objRepeaterBookMarks.Elements[0]);n.objChildTemplateBookmarks.Elements.length==0?n.selectedTemplateBookMark=undefined:n.objChildTemplateBookmarks.Elements.length>0&&(n.selectedTemplateBookMark=n.objChildTemplateBookmarks.Elements[0]);n.objRuleBookmarks.Elements.length==0?n.selectedRuleBookMark=undefined:n.objRuleBookmarks.Elements.length>0&&(n.selectedRuleBookMark=n.objRuleBookmarks.Elements[0]);n.objHyperlinkBookmarks.Elements.length==0?n.selectedHyperlinkBookmark=undefined:n.objHyperlinkBookmarks.Elements.length>0&&(n.selectedHyperlinkBookmark=n.objHyperlinkBookmarks.Elements[0]);n.getTemplateList();n.isDirty=!0;n.$evalAsync(function(){r.IsLoading=!1});r.ClearUndoRedoListByFileName(n.currentfile.FileName)};n.SyncronizeCorTestStep=function(){n.objCorrespondenceTests&&$.connection.hubCorrespondence.server.retrieveBookmarksOfTemplate(n.objCorrespondenceDetails.dictAttributes.sfwTemplate).done(function(t){var i=t;i&&i.length>0&&n.$evalAsync(function(){for(var r,f,t,u=0;u<n.objCorrespondenceTests.Elements.length;u++){for(r=n.objCorrespondenceTests.Elements[u],f=[],t=r.Elements.length-1;t>=0;t--)r.Elements[t].Name!=="parameter"&&f.push(r.Elements[t]);for(t=r.Elements.length-1;t>=0;t--)r.Elements[t].Name!=="parameter"&&r.Elements.splice(t,1);n.LoadBookmarks(i,r,f)}})})};n.synchronizeBookmarksValues=function(t){for(var o,s,h,ut,a,w,k,d,b,f,v,nt,tt,c,it,rt,g,ft,y,u,e,p,i=0;i<t.length;i++)o=t[i],n.FindBookmark(o)||(n.IsFieldBookMark(o)?(s={Name:"sfwFieldBookMark",Value:"",dictAttributes:{ID:o.Name},Elements:[]},r.PushItem(s,n.objFieldBookMarks.Elements)):n.IsTableBookMark(o)?(s={Name:"sfwTableBookMark",Value:"",dictAttributes:{ID:o.Name},Elements:[]},r.PushItem(s,n.objTableBookMarks.Elements)):n.IsQueryBookMark(o)?(s={Name:"sfwQueryBookMark",Value:"",dictAttributes:{ID:o.Name},Elements:[]},r.PushItem(s,n.objQueryBookMarks.Elements)):n.IsTemplateBookMark(o)?(s={Name:"sfwChildTemplateBookmark",Value:"",dictAttributes:{ID:o.Name,sfwChildTemplateType:"Entity"},Elements:[]},r.PushItem(s,n.objChildTemplateBookmarks.Elements)):n.IsRuleBookMark(o)?(s={Name:"sfwRuleBookmark",Value:"",dictAttributes:{ID:o.Name},Elements:[]},r.PushItem(s,n.objRuleBookmarks.Elements)):n.IsHyperlinkBookmark(o)?(p={Name:"sfwHyperlinkBookmark",Value:"",dictAttributes:{ID:o.Name},Elements:[]},r.PushItem(p,n.objHyperlinkBookmarks.Elements)):n.IsRepeaterBookMark(o)&&(s={Name:"sfwRepeater",Value:"",dictAttributes:{ID:o.Name},Elements:[]},o.icolRepeaterCells.length>0&&angular.forEach(o.icolRepeaterCells,function(n){var t={Name:"sfwFieldBookMark",Value:"",dictAttributes:{ID:n.Name},Elements:[]};s.Elements.push(t)}),r.PushItem(s,n.objRepeaterBookMarks.Elements)),f=!0);if(f=!1,n.objFieldBookMarks)for(i=n.objFieldBookMarks.Elements.length-1;i>=0;i--){for(ut=n.objFieldBookMarks.Elements[i],h=ut.dictAttributes.ID,f=!1,u=0;u<t.length;u++)if(e=t[u],e.Name==h&&n.IsFieldBookMark(e)){f=!0;break}f||r.DeleteItem(n.objFieldBookMarks.Elements[i],n.objFieldBookMarks.Elements)}if(n.objTableBookMarks)for(i=n.objTableBookMarks.Elements.length-1;i>=0;i--){for(a=n.objTableBookMarks.Elements[i],h=a.dictAttributes.ID,f=!1,w="",u=0;u<t.length;u++)if(e=t[u],e.Name==h&&n.IsTableBookMark(e)){e.strColHeadings!=undefined&&e.strColHeadings!=""&&(w=e.strColHeadings);f=!0;break}if(f){if(k=[],w!=undefined&&w.length>0){for(d=w.split(";"),b=0;b<d.length;b++){for(f=!1,c=0;c<a.Elements.length;c++)if(a.Elements[c].dictAttributes.sfwColumnHeader==d[b]){k.push(a.Elements[c]);f=!0;break}f||(g={Name:"sfwColumn",Value:"",dictAttributes:{sfwColumnHeader:d[b]},Elements:[]},k.push(g))}a.Elements=k}}else r.DeleteItem(n.objTableBookMarks.Elements[i],n.objTableBookMarks.Elements)}if(n.objRepeaterBookMarks)for(i=n.objRepeaterBookMarks.Elements.length-1;i>=0;i--){for(v=n.objRepeaterBookMarks.Elements[i],h=v.dictAttributes.ID,f=!1,nt="",u=0;u<t.length;u++)if(e=t[u],e.Name==h&&n.IsRepeaterBookMark(e)){e.icolRepeaterCells&&(nt=e.icolRepeaterCells);f=!0;break}if(f){for(tt=[],c=0;c<nt.length;c++){for(it=nt[c],rt=!1,l=0;l<v.Elements.length;l++)if(v.Elements[l].dictAttributes.ID==it.Name){rt=!0;r.PushItem(v.Elements[l],tt);break}rt||(g={Name:"sfwFieldBookMark",Value:"",dictAttributes:{ID:it.Name},Elements:[]},r.PushItem(g,tt))}v.Elements=tt}else r.DeleteItem(n.objRepeaterBookMarks.Elements[i],n.objRepeaterBookMarks.Elements)}if(n.objQueryBookMarks!=null)for(i=n.objQueryBookMarks.Elements.length-1;i>=0;i--){for(ft=n.objQueryBookMarks.Elements[i],h=ft.dictAttributes.ID,f=!1,u=0;u<t.length;u++)if(e=t[u],e.Name==h&&n.IsQueryBookMark(e)){f=!0;break}f||r.DeleteItem(n.objQueryBookMarks.Elements[i],n.objQueryBookMarks.Elements)}if(n.objChildTemplateBookmarks!=null)for(i=n.objChildTemplateBookmarks.Elements.length-1;i>=0;i--){for(y=n.objChildTemplateBookmarks.Elements[i],h=y.dictAttributes.ID,f=!1,u=0;u<t.length;u++)if(e=t[u],e.Name==h&&n.IsTemplateBookMark(e)){f=!0;break}f||r.DeleteItem(y,n.objChildTemplateBookmarks.Elements)}if(n.objRuleBookmarks)for(i=n.objRuleBookmarks.Elements.length-1;i>=0;i--){for(y=n.objRuleBookmarks.Elements[i],h=y.dictAttributes.ID,f=!1,u=0;u<t.length;u++)if(e=t[u],e.Name==h){f=!0;break}f||r.DeleteItem(y,n.objRuleBookmarks.Elements)}if(n.objHyperlinkBookmarks)for(i=n.objHyperlinkBookmarks.Elements.length-1;i>=0;i--)p=n.objHyperlinkBookmarks.Elements[i],t.some(function(n){return n.Name===p.dictAttributes.ID})||r.DeleteItem(p,n.objHyperlinkBookmarks.Elements)};n.FindBookmark=function(t){var i=[],r;return n.IsTableBookMark(t)?n.objTableBookMarks!=null&&(i=n.objTableBookMarks.Elements):t.Type==="QueryUser"||t.Type==="QueryConditionalBlock"||t.Type==="QueryCheckBoxControl"?n.objQueryBookMarks&&(i=n.objQueryBookMarks.Elements):n.IsRepeaterBookMark(t)?n.objRepeaterBookMarks&&(i=n.objRepeaterBookMarks.Elements):t.Type==="Template"?n.objChildTemplateBookmarks&&(i=n.objChildTemplateBookmarks.Elements):t.Type==="RuleConditionalBlock"?n.objRuleBookmarks&&(i=n.objRuleBookmarks.Elements):t.Type==="HyperLink"?n.objHyperlinkBookmarks&&(i=n.objHyperlinkBookmarks.Elements):n.objFieldBookMarks&&(i=n.objFieldBookMarks.Elements),i?(r=i.filter(function(n){return n.dictAttributes.ID==t.Name}),r&&r.length>0)?!0:!1:void 0};n.IsFieldBookMark=function(t){return n.IsTableBookMark(t)||n.IsQueryBookMark(t)||n.IsTemplateBookMark(t)||n.IsRuleBookMark(t)||n.IsRepeaterBookMark(t)||n.IsHyperlinkBookmark(t)?!1:!0};n.IsTableBookMark=function(n){return n.Type=="NormalTable"?!0:!1};n.IsQueryBookMark=function(n){return n.Type==="QueryUser"||n.Type==="QueryConditionalBlock"||n.Type==="QueryCheckBoxControl"?!0:!1};n.IsTemplateBookMark=function(n){return n.Type=="Template"?!0:!1};n.IsRuleBookMark=function(n){return n.Type=="RuleConditionalBlock"?!0:!1};n.IsHyperlinkBookmark=function(n){return n.Type==="HyperLink"};n.IsRepeaterBookMark=function(n){return n.Type=="Repeater"?!0:!1};n.openWordTemplateClick=function(){r.IsLoading=!0;$.connection.hubCorrespondence.server.openWordDocument(n.objCorrespondenceDetails.dictAttributes.sfwTemplate,n.objCorrespondenceDetails.dictAttributes.ID)};n.receieveDummyCall=function(){n.$evalAsync(function(){r.IsLoading=!1})};n.IsGroupChange=function(t){t&&(t=="Entity"||t=="Collection")&&(n.selectedTemplateBookMark.dictAttributes.sfwEntityField="",n.selectedTemplateBookMark.dictAttributes.sfwTemplateName="")};n.getTemplateList=function(){var t,i;n.selectedTemplateBookMark&&(n.objCorrespondenceDetails.dictAttributes.sfwTemplate||(n.objCorrespondenceDetails.dictAttributes.sfwTemplate=""),t="",n.selectedTemplateBookMark.dictAttributes.sfwEntityField&&(i=v.GetEntityFieldObjectFromEntityField(n.objCorrespondenceDetails.dictAttributes.sfwEntity,n.selectedTemplateBookMark.dictAttributes.sfwEntityField),i&&(t=i.Entity)),t?$.connection.hubCorrespondence.server.getListOfTemplates(t,n.objCorrespondenceDetails.dictAttributes.sfwTemplate).done(function(t){n.receieveTemplatesList(t)}):$.connection.hubCorrespondence.server.getListOfTemplates(n.objCorrespondenceDetails.dictAttributes.sfwEntity,n.objCorrespondenceDetails.dictAttributes.sfwTemplate).done(function(t){n.receieveTemplatesList(t)}))};n.receieveTemplatesList=function(t){n.$apply(function(){n.lstTemplates=t})};n.onTemplateEntityChange=function(){n.getTemplateList();n.selectedTemplateBookMark&&n.validateTemplateName(n.selectedTemplateBookMark,"edit")};n.menuOptionsForUserControl=[["Add Row",function(){n.AddRowCommand()}],null,];n.AddRowCommand=function(){var t,u,e;if(r.UndRedoBulkOp("Start"),t=n.objQueryForm.Elements.filter(function(n){return n.Name=="sfwTable"}),t==null&&t.length==0&&(t={Name:"sfwTable",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},t.dictAttributes.ID="",r.PushItem(t,n.objQueryForm.Elements)),t&&t.length>0){var o=t[0].Elements.filter(function(n){return n.Name=="sfwRow"}),f={Name:"sfwRow",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},i=GetMaxColCount(o[0],t);for(i<1&&(i=1),u=0;u<i;u++)e={Name:"sfwColumn",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},r.PushItem(e,f.Elements);r.PushItem(f,t[0].Elements)}r.UndRedoBulkOp("End")};n.OnAddControlClick=function(t){var f=[],o,i,u,e;t&&n.objQueryBookMarks!=null&&n.objQueryBookMarks.Elements.length>0&&(i=n.objQueryForm.Elements.filter(function(n){return n.Name=="sfwTable"}),(i==undefined||i=="")&&(r.UndRedoBulkOp("Start"),u={Name:"sfwTable",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},u.ParentVM=n.objQueryForm,u.dictAttributes.ID="tblMain",r.PushItem(u,n.objQueryForm.Elements),i.push(u)),i&&i.length>0&&(e=i[0].Elements.filter(function(n){return n.Name=="sfwRow"}),angular.forEach(n.objQueryBookMarks.Elements,function(n){if(n.IsSelected){f.push(n);var r=i[0].Elements.length,t=0;e&&e.length>0&&(t=GetMaxColCount(e[0],i));r==0&&t==0&&(t=2);n.IsSelected=!1}}),f&&f.length>0&&n.AddControls(i[0],o,t,f,!1)))};n.AddControls=function(t,i,u,f,e){var k,a,o,s,d,g,y,v,p,nt,tt,w,h,c,l,b;for(u=="sfwHyperLink"&&(u="sfwLinkButton"),k=.4,a=1,a=f.length*2,o=1,s=2,t&&t.Elements&&t.Elements.length>0&&(s=GetMaxColCount(t.Elements[0],t)),s==0&&(d={Name:"sfwColumn",value:"",prefix:c,dictAttributes:{},Elements:[],Children:[]},t.Elements[0].Elements.push(d),g={Name:"sfwColumn",value:"",prefix:c,dictAttributes:{},Elements:[],Children:[]},t.Elements[0].Elements.push(g),s=2),o=a==s?1:a/s+k,o=Math.round(o),o<=0&&(o=1),y=GetVM("sfwColumn",i),y?(p=y.ParentVM,nt=p.ParentVM.Elements.indexOf(p),v=nt):(tt=t.Elements.length,v=tt-1),w=[],h=0,rowInd=1;rowInd<=o;rowInd++){for(c="swc",l={Name:"sfwRow",value:"",prefix:c,dictAttributes:{},Elements:[],Children:[]},l.ParentVM=t,colInd=0;colInd<s;colInd++)b={Name:"sfwColumn",value:"",prefix:c,dictAttributes:{},Elements:[],Children:[]},b.ParentVM=l,r.PushItem(b,l.Elements);r.InsertItem(l,t.Elements,rowInd+v);angular.forEach(t.Elements[rowInd+v].Elements,function(n){var t={};t.key=h;t.value=n;w.push(t);h++})}h=0;angular.forEach(f,function(t){h=n.AddControlsGrid(w,u,t,h,e)})};n.AddControlsGrid=function(t,u,e,o,s){var l=o,a=CreateControlID(n.objCorrespondenceDetails,e.dictAttributes.ID,u),c,h,y="swc",p,w;for(i=0;i<t.length;i++)if(t[i].key==l){c=t[i].value;l++;h={Name:"sfwLabel",value:"",prefix:y,dictAttributes:{sfwIsCaption:"True"},Elements:[],Children:[]};h.ParentVM=c;p=CreateControlID(n.objCorrespondenceDetails,e.dictAttributes.ID,"sfwLabel",!0);h.dictAttributes.ID=p;h.dictAttributes.Text=GetCaptionFromFieldName(e.dictAttributes.ID)+" : ";s||(h.dictAttributes.AssociatedControlID=a);r.PushItem(h,c.Elements);break}for(i=0;i<t.length;i++)if(t[i].key==l){if(c=t[i].value,l++,h={Name:u,value:"",prefix:y,dictAttributes:{},Elements:[],Children:[]},h.ParentVM=c,a=u=="sfwLabel"?CreateControlID(n.objCorrespondenceDetails,e.dictAttributes.ID,u,!1):CreateControlID(n.objCorrespondenceDetails,e.dictAttributes.ID,u,!0),h.dictAttributes.ID=a,h.dictAttributes.sfwQueryID=e.dictAttributes.ID,u=="sfwLinkButton")h.dictAttributes.sfwMethodName="btnOpen_Click";else if(u=="sfwDropDownList"||u=="sfwMultiSelectDropDownList"||u=="sfwCascadingDropDownList"||u=="sfwCheckBoxList"||u=="sfwRadioButtonList"){if(endsWith(e.Value,"_value")){var b=n.objCorrespondenceDetails.dictAttributes.sfwEntity,k=f.getEntityIntellisense(),v=GetCodeID(b,e.dictAttributes.ID,k);v||(v="0");h.dictAttributes.sfwLoadSource=v}}else u=="sfwRadioButton"?(w=e.Value.substring(e.Value.indexOf(".")+1),h.dictAttributes.GroupName=w):SetDefultValuesBasedOnDataType(e,u,h);r.PushItem(h,c.Elements);break}return l};n.selectDataFieldsTab=function(){n.SelectedCorrespondenceTab="DataFields";n.ActiveTabForCorr="Entity";n.objFieldBookMarks&&n.objFieldBookMarks.Elements.length>0&&n.SelectedFieldBookMarkClick(n.objFieldBookMarks.Elements[0])};n.selectTablesTab=function(){n.SelectedCorrespondenceTab="Tables";n.ActiveTabForCorr="Entity"};n.selectUserFieldsTab=function(){n.SelectedCorrespondenceTab="UserFields";n.ActiveTabForCorr="Items";n.objCorrespondenceDetails.IsCommonPropertiesOpen=!0;n.objQueryBookMarks&&n.objQueryBookMarks.Elements.length>0&&n.SelectedQueryClick(n.objQueryBookMarks.Elements[0])};n.selectTemplatesTab=function(){n.SelectedCorrespondenceTab="Templates";n.ActiveTabForCorr="Entity";n.objChildTemplateBookmarks&&n.objChildTemplateBookmarks.Elements.length>0&&(n.SelectedTemplateClick(n.objChildTemplateBookmarks.Elements[0]),n.selectedTemplateBookMark.dictAttributes.sfwChildTemplateType||(n.selectedTemplateBookMark.dictAttributes.sfwChildTemplateType="Entity"))};n.selectRepeaterControlTab=function(){n.SelectedCorrespondenceTab="RepeaterControl";n.ActiveTabForCorr="Entity"};n.selectRuleTab=function(){n.SelectedCorrespondenceTab="VisibleRule";n.ActiveTabForCorr="Entity";n.objRuleBookmarks&&n.objRuleBookmarks.Elements.length>0&&n.SelectedRuleBookMarkClick(n.objRuleBookmarks.Elements[0])};n.selectHyperlinkTab=function(){n.SelectedCorrespondenceTab="Hyperlink";n.ActiveTabForCorr="Entity";n.objHyperlinkBookmarks&&n.objHyperlinkBookmarks.Elements.length>0&&n.selectHyperlinkBookmark(n.objHyperlinkBookmarks.Elements[0])};n.UserFieldMenuOptions=[["Add Row",function(){var i,f,e,t,u;if(r.UndRedoBulkOp("Start"),n.objQueryForm){if(n.objQueryForm.Elements&&n.objQueryForm.Elements.length>0&&(i=n.objQueryForm.Elements[0]),i)if(t={Name:"sfwRow",prefix:"swc",dictAttributes:{},Elements:[],Children:[]},t.ParentVM=i,r.PushItem(t,i.Elements),f=GetMaxColCount(t,i),f==0)u={Name:"sfwColumn",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},u.ParentVM=t,r.PushItem(u,t.Elements);else for(e=0;e<f;e++)u={Name:"sfwColumn",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},u.ParentVM=t,r.PushItem(u,t.Elements);i||(i={Name:"sfwTable",prefix:"swc",dictAttributes:{},Elements:[],Children:[]},i.ParentVM=n.objQueryForm,i.dictAttributes.ID="tblMain",r.PushItem(i,n.objQueryForm.Elements),t={Name:"sfwRow",prefix:"swc",dictAttributes:{},Elements:[],Children:[]},t.ParentVM=i,r.PushItem(t,i.Elements),u={Name:"sfwColumn",prefix:"swc",Value:"",dictAttributes:{},Elements:[],Children:[]},u.ParentVM=t,r.PushItem(u,t.Elements))}r.UndRedoBulkOp("End")},null]];n.NavigateToCorrespondence=function(n){n&&n!=""&&hubMain.server.navigateToFile(n,"").done(function(n){r.openFile(n,!1)})};n.selectMethodClick=function(t){t&&t!=""&&e.NavigateToFile(n.objCorrespondenceDetails.dictAttributes.sfwEntity,"objectmethods",t)};n.onActionKeyDown=function(t){var s=t.target,c=n.objCorrespondenceDetails.dictAttributes.sfwEntity,e=[],l=r.getEntityAttributeIntellisense(c,!0),h,i,u;e=e.concat(l);var a=f.getEntityIntellisense(),v=a,o=getSplitArray(s.innerText,getCaretCharacterOffsetWithin(s));if(o.length>0)for(u=0;u<o.length;u++)if(i=e.filter(function(n){return n.ID==o[u]}),i.length>0)if(i[0].Type=="Constant"&&i[0].ID==o[u])break;else if(i[0].ID=="RFunc"&&o[u]=="RFunc")e=r.rFuncMethods;else if(typeof i[0].DataType!="undefined"&&(i[0].DataType=="Object"||i[0].DataType=="Collection"||i[0].DataType=="CDOCollection"||i[0].DataType=="List")&&typeof i[0].Entity!="undefined"&&i[0].ID==o[u]&&u<o.length-1)for(parententityName=i[0].Entity,e=[];parententityName!="";)e=e.concat(r.getEntityAttributeIntellisense(parententityName,!1)),h=v.filter(function(n){return n.ID==parententityName}),parententityName=h.length>0?h[0].ParentId:"";else e=i[0].DataType!="undefined"&&i[0].DataType!="Object"&&i[0].DataType!="Collection"&&i[0].DataType!="CDOCollection"&&i[0].DataType!="List"&&i[0].DataType!="AliasObject"?[]:i;if(i=[],o.length>0){for(u=0;u<o.length;u++)i=e.filter(function(n){if(n.ID)return n.ID.toLowerCase().contains(o[u].toLowerCase())});e=i}setRuleIntellisense($(s),e);t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&$(s).data("ui-autocomplete")&&($(s).autocomplete("search",$(s).val()),t.preventDefault())};n.addExtraFieldsDataInToMainModel=function(){if(n.objCorrespondenceExtraFields){var t=n.objCorrespondenceDetails.Elements.indexOf(n.objCorrespondenceExtraFields);t==-1&&n.objCorrespondenceDetails.Elements.push(n.objCorrespondenceExtraFields)}};n.BeforeSaveToFile=function(){n.addExtraFieldsDataInToMainModel()};n.ClearSelectFields=function(){lstEntityTreeFieldData=null};n.NavigateToTemplate=function(t){t&&t.trim()!=""&&(n.$evalAsync(function(){r.IsLoading=!0}),hubMain.server.navigateToTemplate(t).done(function(t){n.$evalAsync(function(){r.IsLoading=!1});t?$.connection.hubMain.server.navigateToFile(t,"").done(function(n){r.openFile(n,null)}):toastr.error("File not exist.")}))};n.findParentAndChildObject=function(t){var i=[];n.FindDeepNode(n.objCorrespondenceDetails,t,i);n.$evalAsync(function(){var t=s.createFullPath(n.objCorrespondenceDetails,i);n.selectElement(t)})};n.validateTemplateName=function(t,i){var r=[],u;i=="onload"?(r=n.validationData[n.objCorrespondenceDetails.dictAttributes.sfwEntity],t.Name=="sfwChildTemplateBookmark"&&(u="",u=t.dictAttributes.sfwEntityField?k(t.dictAttributes.sfwEntityField,n.objCorrespondenceDetails.dictAttributes.sfwEntity,t):n.objCorrespondenceDetails.dictAttributes.sfwEntity,n.validationData&&n.validationData.hasOwnProperty(u)&&(r=n.validationData[u]))):r=n.lstTemplates;s.checkValidListValue(r,t,t.dictAttributes.sfwTemplateName,"sfwTemplateName","sfwTemplateName",o.VALIDATION.INVALID_TEMPLATE,n.validationErrorList)};n.OnCutControlClick=function(t){var i=[];i.push(t);n.CopyToClipBoard(i,"Control",!0)};n.OnCopyControlClick=function(t){var i=[];i.push(t);n.CopyToClipBoard(i,"Control",!1)};n.OnPasteControl=function(t){n.ClipboardData&&n.$evalAsync(function(){r.UndRedoBulkOp("Start");angular.forEach(n.ClipboardData,function(i){var u=GetBaseModel(i);n.IsCutOper?n.OnDeleteControlClick(i):u.dictAttributes.ID=GetControlID(n.objCorrespondenceDetails,i.Name);i.Name=="udc"&&(u.UcChild=[],u.UcChild.push(i.UcChild[0]));r.PushItem(u,t.Elements);u.ParentVM=t});n.IsCutOper&&(n.ClipboardData=[],n.ClipboardDataOpeType="",n.IsCutOper=!1);r.UndRedoBulkOp("End")})};n.selectControlOnDoubleClick=function(t,i){n.selectControl(t,i);n.ActiveTabForCorr="Properties"};n.selectControl=function(t,i){t&&(t.isLoaded||(t.isLoaded=!0),n.objCorrespondenceDetails.SelectedControl&&(n.objCorrespondenceDetails.SelectedControl.Name=="sfwPanel"||n.objCorrespondenceDetails.SelectedControl.Name=="sfwDialogPanel"||n.objCorrespondenceDetails.SelectedControl.Name=="sfwListView")&&(n.objCorrespondenceDetails.SelectedControl.IsVisible=!1),SetFormSelectedControl(n.objCorrespondenceDetails,t,i),t.Name=="sfwTabSheet"&&(t.ParentVM.SelectedTabSheet=t,t.ParentVM.SelectedTabSheet.IsSelected=!0),(t.Name=="sfwPanel"||t.Name=="sfwDialogPanel"||t.Name=="sfwListView")&&(t.IsVisible=!0));n.setDisplayNoneToTable&&n.setDisplayNoneToTable()};n.OnDeleteControlClick=function(t){t&&(r.DeleteItem(t,t.ParentVM.Elements),t.ParentVM&&n.selectControl(t.ParentVM,null))};n.CopyToClipBoard=function(t,i,r){n.ClipboardData=[];n.ClipboardDataOpeType=i;n.IsCutOper=r;angular.forEach(t,function(t){n.ClipboardData.push(t)})};n.OnCutCell=function(t){n.CopyToClipBoard(t.Elements,"Cell",!0)};n.OnCopyCell=function(t){n.CopyToClipBoard(t.Elements,"Cell",!1)};n.OnPasteCell=function(t){n.ClipboardData&&n.$evalAsync(function(){r.UndRedoBulkOp("Start");angular.forEach(n.ClipboardData,function(i){n.IsCutOper&&n.ClearCell(i.ParentVM);var u=GetBaseModel(i);n.IsCutOper||(u.dictAttributes.ID=GetControlID(n.objCorrespondenceDetails,i.Name));r.PushItem(u,t.Elements);u.ParentVM=t});n.IsCutOper&&(n.ClipboardData=[],n.ClipboardDataOpeType="",n.IsCutOper=!1);r.UndRedoBulkOp("End")})};n.ClearCell=function(n){while(n.Elements.length>0)r.DeleteItem(n.Elements[0],n.Elements)};n.OnCopyCutPasteControlClick=function(t){t=="cut"?n.objCorrespondenceDetails&&n.objCorrespondenceDetails.SelectedControl&&n.objCorrespondenceDetails.SelectedControl.Name!="sfwColumn"?n.OnCutControlClick(n.objCorrespondenceDetails.SelectedControl):n.objCorrespondenceDetails&&n.objCorrespondenceDetails.SelectedControl&&(n.objCorrespondenceDetails.SelectedControl.Name=="sfwColumn"||n.objCorrespondenceDetails.SelectedControl.Name=="sfwButtonGroup")&&n.OnCutCell(n.objCorrespondenceDetails.SelectedControl):t=="copy"?n.objCorrespondenceDetails&&n.objCorrespondenceDetails.SelectedControl&&n.objCorrespondenceDetails.SelectedControl.Name!="sfwColumn"?n.OnCopyControlClick(n.objCorrespondenceDetails.SelectedControl):n.objCorrespondenceDetails&&n.objCorrespondenceDetails.SelectedControl&&(n.objCorrespondenceDetails.SelectedControl.Name=="sfwColumn"||n.objCorrespondenceDetails.SelectedControl.Name=="sfwButtonGroup")&&n.OnCopyCell(n.objCorrespondenceDetails.SelectedControl):t=="paste"&&(n.ClipboardData&&n.ClipboardDataOpeType=="Control"&&n.objCorrespondenceDetails.SelectedControl&&(n.objCorrespondenceDetails.SelectedControl.Name=="sfwColumn"||n.objCorrespondenceDetails.SelectedControl.Name=="sfwButtonGroup")?n.OnPasteControl(n.objCorrespondenceDetails.SelectedControl):n.ClipboardData&&n.ClipboardDataOpeType=="Cell"&&n.objCorrespondenceDetails.SelectedControl&&(n.objCorrespondenceDetails.SelectedControl.Name=="sfwColumn"||n.objCorrespondenceDetails.SelectedControl.Name=="sfwButtonGroup")&&n.OnPasteCell(n.objCorrespondenceDetails.SelectedControl))};n.onActionKeyDownForTemplates=function(t){var i=t.target,r;t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE?($(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val()),t.preventDefault()):(inputvalue=$(i).val(),r=n.getIntellisenseDataForTemplatesList(inputvalue),setSingleLevelAutoComplete($(i),r))};n.showTemplateNameList=function(t){var i=$(t.target).prevAll("input[type='text']"),r=n.getIntellisenseDataForTemplatesList($(i).val());i&&r&&(i.focus(),setSingleLevelAutoComplete($(i),r),$(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val()));t&&t.stopPropagation()};n.getIntellisenseDataForTemplatesList=function(t){var i=[],u,r;if(n.lstTemplates)for(i=n.lstTemplates,i=i.sort(),u=[],r=0;r<i.length;r++)i[r]&&i[r].toLowerCase().indexOf(t)>-1&&u.push(i[r]);return u};n.OnRowColumnInsertMoveClick=function(t){if(n.objCorrespondenceDetails&&n.objCorrespondenceDetails.SelectedControl){var i=null,u=null;i=n.objCorrespondenceDetails.SelectedControl.Name=="sfwColumn"?n.objCorrespondenceDetails.SelectedControl:FindParent(n.objCorrespondenceDetails.SelectedControl,"sfwColumn");u=i&&i.ParentVM?i.ParentVM.ParentVM:null;u&&i&&n.$evalAsync(function(){var e;if(t=="InsertRowAbove"){var f=u.Elements.indexOf(i.ParentVM),o=InsertRow(i,f,u),s=GetIndexToInsert(!1,f);r.InsertItem(o,u.Elements,s)}else if(t=="InsertRowBelow"){var f=u.Elements.indexOf(i.ParentVM),o=InsertRow(i,f,u),s=GetIndexToInsert(!0,f);r.InsertItem(o,u.Elements,s)}else t=="InsertColumnLeft"?(e=i.ParentVM.Elements.indexOf(i),n.InsertColumn(i,!1,e,u)):t=="InsertColumnRight"?(e=i.ParentVM.Elements.indexOf(i),n.InsertColumn(i,!0,e,u)):t=="MoveRowUp"?n.MoveRowUp(i,u):t=="MoveRowDown"?n.MoveRowDown(i,u):t=="MoveColumnLeft"?n.MoveColumnLeft(i,u):t=="MoveColumnRight"&&n.MoveColumnRight(i,u)})}};n.InsertColumn=function(t,i,u,f){function e(t){for(var e,i,f=0;f<t.Elements.length;f++)if(e=t.Elements[f],t.Elements.indexOf(e)==u){i=e;break}if(i||n.CheckAndAddColumnsToRow(t,u,u),i){var s=t.Elements.indexOf(i),o={Name:"sfwColumn",value:"",prefix:"swc",dictAttributes:{},Elements:[],Children:[]};o.ParentVM=t;s<t.Elements.length?r.InsertItem(o,t.Elements,s):r.PushItem(o,t.Elements)}}function o(t){n.CheckAndAddColumnsToRow(t,s,u)}if(t)if(i){var s=n.GetNextColIndex(t);r.UndRedoBulkOp("Start");angular.forEach(f.Elements,o);r.UndRedoBulkOp("End")}else r.UndRedoBulkOp("Start"),angular.forEach(f.Elements,e),r.UndRedoBulkOp("End")};n.CheckAndAddColumnsToRow=function(t,i,u){for(var e=0,l=!1,o,s,c,h,f;e<=i;){for(o=undefined,s=0;s<t.Elements.length;s++)if(c=t.Elements[s],t.Elements.indexOf(c)==e){o=c;break}o?e=n.GetNextColIndex(o):(h="swc",f={Name:"sfwColumn",value:"",prefix:h,dictAttributes:{},Elements:[],Children:[]},f.ParentVM=t,r.PushItem(f,t.Elements),l=!0,e++)}l||(h="swc",f={Name:"sfwColumn",value:"",prefix:h,dictAttributes:{},Elements:[],Children:[]},f.ParentVM=t,i<t.Elements.length?r.InsertItem(f,t.Elements,u+1):r.PushItem(f,t.Elements))};n.GetNextColIndex=function(t){var i=t.ParentVM.Elements.indexOf(t),r=n.getColspan(t);return r>0?i=t.ParentVM.Elements.indexOf(t)+r:i++,i};n.getColspan=function(n){return n&&n.dictAttributes.ColumnSpan&&parseInt(n.dictAttributes.ColumnSpan)?n.dictAttributes.ColumnSpan:1};n.MoveRowUp=function(n,t){if(n){var i=n,u=t.Elements.indexOf(i.ParentVM);u>0&&(r.UndRedoBulkOp("Start"),r.DeleteItem(i.ParentVM,t.Elements),r.InsertItem(i.ParentVM,t.Elements,u-1),r.UndRedoBulkOp("End"))}};n.MoveRowDown=function(n,t){if(n){var i=n,f=t.Elements.length,u=t.Elements.indexOf(i.ParentVM);u<f-1&&(r.UndRedoBulkOp("Start"),r.DeleteItem(i.ParentVM,t.Elements),r.InsertItem(i.ParentVM,t.Elements,u+1),r.UndRedoBulkOp("End"))}};n.MoveColumnLeft=function(n,t){function u(n){var t=n.Elements[i];t&&(r.DeleteItem(n.Elements[i],n.Elements),r.InsertItem(t,n.Elements,i-1))}if(n){var i=n.ParentVM.Elements.indexOf(n);i>0&&(r.UndRedoBulkOp("Start"),angular.forEach(t.Elements,u),r.UndRedoBulkOp("End"))}};n.MoveColumnRight=function(n,t){function u(n){var t=n.Elements[i];t&&(r.DeleteItem(n.Elements[i],n.Elements),r.InsertItem(t,n.Elements,i+1))}if(n){var f=GetMaxColCount(n.ParentVM,t),i=n.ParentVM.Elements.indexOf(n);i<f-1&&(r.UndRedoBulkOp("Start"),angular.forEach(t.Elements,u),r.UndRedoBulkOp("End"))}};n.clearCell=function(n){while(n.Elements.length>0)r.DeleteItem(n.Elements[0],n.Elements)};n.clearPanel=function(){var t,i,u,f,e;if(n.objCorrespondenceDetails.SelectedControl&&(t=null,t=n.objCorrespondenceDetails.SelectedControl.Name==="sfwPanel"?n.objCorrespondenceDetails.SelectedControl.Elements[0]:FindParent(n.objCorrespondenceDetails.SelectedControl,"sfwTable",!0),t)){for(r.UndRedoBulkOp("Start"),i=0;i<t.Elements.length;i++)if(u=t.Elements[i],u)for(f=0;f<u.Elements.length;f++)n.clearCell(u.Elements[f]);n.objCorrespondenceDetails.SelectedControl.Name!=="sfwPanel"&&n.objCorrespondenceDetails.SelectedControl.Name!=="sfwTable"&&n.objCorrespondenceDetails.SelectedControl.Name!=="sfwColumn"&&(e=FindParent(n.objCorrespondenceDetails.SelectedControl,"sfwColumn",!0),e&&n.selectControl(e));r.UndRedoBulkOp("End")}};n.deleteRow=function(){var t,i;n.objCorrespondenceDetails.SelectedControl&&(t=FindParent(n.objCorrespondenceDetails.SelectedControl,"sfwRow",!0),t&&t.ParentVM&&t.ParentVM.Elements&&(t.ParentVM.Elements.length>1?(i=t.ParentVM.Elements.indexOf(t),r.UndRedoBulkOp("Start"),r.DeleteItem(t,t.ParentVM.Elements),i===t.ParentVM.Elements.length&&i--,i>-1&&t.ParentVM.Elements.length>0&&t.ParentVM.Elements[i].Elements.length>0&&n.selectControl(t.ParentVM.Elements[i].Elements[0]),r.UndRedoBulkOp("End")):alert("Atleast one row should be present")))};n.deleteColumn=function(){var t,u,f,i,e;n.objCorrespondenceDetails.SelectedControl&&(t=FindParent(n.objCorrespondenceDetails.SelectedControl,"sfwColumn",!0),t&&t.ParentVM&&t.ParentVM.ParentVM&&(u=t.ParentVM.ParentVM,f=GetMaxColCount(t.ParentVM,u),f>1?(i=t.ParentVM.Elements.indexOf(t),e=function(n){n.Elements.length>i&&(r.DeleteItem(n.Elements[i],n.Elements),n.Elements&&n.Elements.length==0&&n.ParentVM&&r.DeleteItem(n,n.ParentVM.Elements))},r.UndRedoBulkOp("Start"),angular.forEach(u.Elements,e),i===t.ParentVM.Elements.length&&i--,t.ParentVM.Elements.length>i&&n.selectControl(t.ParentVM.Elements[i]),r.UndRedoBulkOp("End")):alert("Atleast one column should be present")))};n.InsertCell=function(n,t,i){var u=-1,e,f;i?u=n.Elements.indexOf(t)+1:(u=n.Elements.indexOf(t),u>0&&(u-=u));u>-1&&(e="swc",f={Name:"sfwColumn",value:"",prefix:e,dictAttributes:{},Elements:[],Children:[]},f.ParentVM=n,u<n.Elements.length?r.InsertItem(f,n.Elements,u):r.PushItem(f,n.Elements))};n.deleteCellClick=function(){if(n.objCorrespondenceDetails&&n.objCorrespondenceDetails.SelectedControl){if(n.objCorrespondenceDetails.SelectedControl.Name=="sfwPanel"&&n.objCorrespondenceDetails.SelectedControl.IsMainPanel)return;var t=null;t=n.objCorrespondenceDetails.SelectedControl.Name=="sfwColumn"?n.objCorrespondenceDetails.SelectedControl:FindParent(n.objCorrespondenceDetails.SelectedControl,"sfwColumn");n.deleteCell(t)}};n.deleteCell=function(t){t.ParentVM&&t.ParentVM.ParentVM&&t.ParentVM.ParentVM.Name=="sfwTable"&&t.ParentVM.ParentVM.Elements.length==1&&t.ParentVM.Elements.length==1?alert("Cannot delete as only one cell present."):(r.DeleteItem(t,t.ParentVM.Elements),n.objCorrespondenceDetails&&n.objCorrespondenceDetails.SelectedControl&&n.objCorrespondenceDetails.SelectedControl.ParentVM&&(n.objCorrespondenceDetails.SelectedControl.ParentVM.Elements.length==0&&n.objCorrespondenceDetails.SelectedControl.ParentVM.Name=="sfwRow"?(r.DeleteItem(n.objCorrespondenceDetails.SelectedControl.ParentVM,n.objCorrespondenceDetails.SelectedControl.ParentVM.ParentVM.Elements),n.selectControl(n.objCorrespondenceDetails.SelectedControl.ParentVM.ParentVM,null)):n.selectControl(n.objCorrespondenceDetails.SelectedControl.ParentVM,null)))};n.OnInsertCellClick=function(t){if(n.objCorrespondenceDetails&&n.objCorrespondenceDetails.SelectedControl){if(n.objCorrespondenceDetails.SelectedControl.Name=="sfwPanel"&&n.objCorrespondenceDetails.SelectedControl.IsMainPanel)return;var i=null,r=null;i=n.objCorrespondenceDetails.SelectedControl.Name=="sfwColumn"?n.objCorrespondenceDetails.SelectedControl:FindParent(n.objCorrespondenceDetails.SelectedControl,"sfwColumn");r=i&&i.ParentVM?i.ParentVM.ParentVM:null;r&&i&&n.$evalAsync(function(){t=="InsertCellLeft"?n.InsertCell(i.ParentVM,i,!1):t=="InsertCellRight"&&n.InsertCell(i.ParentVM,i,!0)})}};n.PopulateCorrespondenceTemplate=function(){r.IsLoading=!0;$.connection.hubCorrespondence.server.getListOfAllTemplates().done(function(t){n.$apply(function(){n.CorTemplateCollection=t;r.IsLoading=!1})})};n.selectTestsTab=function(){n.SelectedCorrespondenceTab="Tests";n.ActiveTabForCorr="SubTests"};n.selectTestsTab=function(){if(p.getLastProjectDetails()&&p.getLastProjectDetails().ScenarioXmlFileLocation||toastr.warning("Check the Scenario XML File Location in settings file."),n.SelectedCorrespondenceTab="Tests",n.objCorrespondenceTests.Elements&&n.objCorrespondenceTests.Elements.length>0)n.onTestClick(n.objCorrespondenceTests.Elements[0]);n.ActiveTabForCorr="SubTests"};n.AddCorrespondenceTest=function(){if(p.getLastProjectDetails()&&p.getLastProjectDetails().ScenarioXmlFileLocation){var i=undefined,t=n.$new();t.openNewAddTest=r.showDialog(t,"New Correspondence Test","Correspondence/views/AddNewTest.html");t.addTest=function(){if(r.IsLoading=!0,n.objCorrespondenceDetails.dictAttributes.sfwTemplate){r.UndRedoBulkOp("Start");var i={Name:"sfwCorrespondenceTest",value:"",dictAttributes:{ID:t.newTest,sfwIsObjectBased:t.isObjectBased},Elements:[]};t.isObjectBased&&(i.dictAttributes.sfwLoadSource="form",i.dictAttributes.sfwAssociatedFormName=n.ilstAssociatedForms.length>0?n.ilstAssociatedForms[0]:"");t.retriveBookmarks(i)}else alert("Template name is not there.")};t.retriveBookmarks=function(u){$.connection.hubCorrespondence.server.retrieveBookmarksOfTemplate(n.objCorrespondenceDetails.dictAttributes.sfwTemplate).done(function(f){var e=f;e&&e.length>0&&n.LoadBookmarks(e,u,i);n.$evalAsync(function(){r.PushItem(u,n.objCorrespondenceTests.Elements)});n.onTestClick(u);t.isObjectBased&&n.updateTestParameters()});r.UndRedoBulkOp("End");t.closeTest();r.IsLoading=!1};t.closeTest=function(){t.openNewAddTest.close()};t.validateTest=function(){t.testErrorMessageForDisplay="";var i=!1;return t.newTest?t.newTest&&n.objCorrespondenceTests.Elements.length>0&&n.objCorrespondenceTests.Elements.some(function(n){return n.dictAttributes.ID==t.newTest})&&(t.testErrorMessageForDisplay="Error: Duplicate name is not allowed.",i=!0):(t.testErrorMessageForDisplay="Error: Test name is mandatory.",i=!0),i}}else toastr.warning("Check the Scenario XML File Location in settings file.")};n.LoadBookmarks=function(t,i,r){n.$evalAsync(function(){var f,u;i.dictAttributes.sfwIsObjectBased!=="True"&&(f=t.filter(function(n){return n.Type===BookmarkType.Simple||n.Type===BookmarkType.ConditionalBlock||n.Type===BookmarkType.CheckBoxControl}),f&&f.length>0&&n.CreateTestFieldForFieldBookmarks(f,i,r));n.objQueryBookMarks&&(u=n.objQueryBookMarks.Elements,n.CreateTestFields(u,"Query",i,r),n.getContorlFromQueryOnLoad(i));n.objTableBookMarks&&i.dictAttributes.sfwIsObjectBased!=="True"&&(u=n.objTableBookMarks.Elements,n.CreateTestFields(u,"Table",i,r));n.objChildTemplateBookmarks&&i.dictAttributes.sfwIsObjectBased!=="True"&&(u=n.objChildTemplateBookmarks.Elements,n.CreateTestFields(u,"Template",i,r));n.objRuleBookmarks&&i.dictAttributes.sfwIsObjectBased!=="True"&&(u=n.objRuleBookmarks.Elements,n.CreateTestFields(u,"Rule",i,r));n.objHyperlinkBookmarks&&i.dictAttributes.sfwIsObjectBased!=="True"&&(u=n.objHyperlinkBookmarks.Elements,n.CreateTestFields(u,"Hyperlink",i,r));n.objRepeaterBookMarks&&i.dictAttributes.sfwIsObjectBased!=="True"&&(u=n.objRepeaterBookMarks.Elements,n.CreateTestFields(u,"sfwRepeater",i,r))})};n.CreateTestFieldForFieldBookmarks=function(n,t,i){angular.forEach(n,function(n){var r={Name:"sfwCorrespondenceTestField",Value:"",dictAttributes:{},Elements:[],Children:[]},u;r.dictAttributes.ID=n.Name;r.dictAttributes.sfwBookmarkType="Field";t.Elements.push(r);i&&(u=i.filter(function(t){return t.dictAttributes.ID==n.Name}),u&&u.length>0&&(r.dictAttributes.Value=u[0].dictAttributes.Value))})};n.CreateTestFields=function(t,i,r,u){angular.forEach(t,function(t){var f={Name:"sfwCorrespondenceTestField",value:"",dictAttributes:{},Elements:[]},e,o;f.dictAttributes.ID=t.dictAttributes.ID;f.dictAttributes.sfwBookmarkType=i;t.Name&&(t.Name.indexOf("sfwTableBookMark")>-1||t.Name.indexOf("sfwRepeater")>-1)?f.dictAttributes.sfwDataType="Collection":f.dictAttributes.sfwDataType?f.dictAttributes.sfwDataType=t.dictAttributes.sfwDataType:i=="Template"&&t.dictAttributes.sfwChildTemplateType?f.dictAttributes.sfwDataType=t.dictAttributes.sfwChildTemplateType:i=="Rule"&&t.Name&&t.Name.indexOf("sfwRuleBookmark")>-1&&(f.dictAttributes.sfwRuleID=t.dictAttributes.sfwRuleID);r.Elements.push(f);u&&(e=u.filter(function(n){return n.dictAttributes.ID==t.dictAttributes.ID}),e&&e.length>0&&(f.dictAttributes.Value=e[0].dictAttributes.Value,t.Name==="sfwHyperlinkBookmark"&&(f.dictAttributes.sfwDisplayText=e[0].dictAttributes.sfwDisplayText),o=r.Elements[r.Elements.length-1],t.Name&&(t.Name.indexOf("sfwTableBookMark")>-1?n.SetCollectionValuesOnSynchronize(f,e[0],o,t):t.Name.indexOf("sfwRepeater")>-1?n.SetCollectionValuesOnSynchronize(f,e[0],o,t):t.Name.indexOf("sfwChildTemplateBookmark")>-1&&(t.dictAttributes.sfwChildTemplateType&&t.dictAttributes.sfwChildTemplateType.indexOf("Entity")>-1?angular.forEach(e[0].Elements,function(t){var i={Name:"sfwCorrespondenceTestField",value:"",dictAttributes:{},Elements:[]},r;i.dictAttributes.ID=t.dictAttributes.ID;i.dictAttributes.sfwDataType=t.dictAttributes.sfwDataType;i.dictAttributes.Value=t.dictAttributes.Value;t.dictAttributes.sfwBookmarkType&&(i.dictAttributes.sfwBookmarkType=t.dictAttributes.sfwBookmarkType);o.Elements.push(i);r=o.Elements[o.Elements.length-1];n.setChildTempleteEntityOnSync(t,r)}):t.dictAttributes.sfwChildTemplateType&&t.dictAttributes.sfwChildTemplateType.indexOf("Collection")>-1&&n.SetCollectionValuesOnSynchronize(f,e[0],o,t)))))})};n.setChildTempleteEntityOnSync=function(t,i){t.Elements.length>0&&angular.forEach(t.Elements,function(t){var u,r;t.Name==="sfwCorrespondenceTestFields"?(u={Name:"sfwCorrespondenceTestFields",value:"",dictAttributes:{},Elements:[]},u.dictAttributes.indexNumber=t.indexNumber,i.Elements.push(u),angular.forEach(t.Elements,function(t){var i={Name:"sfwCorrespondenceTestField",value:"",dictAttributes:{},Elements:[]};i.dictAttributes.ID=t.dictAttributes.ID;i.dictAttributes.Value=t.dictAttributes.Value;t.dictAttributes.sfwBookmarkType&&(i.dictAttributes.sfwBookmarkType=t.dictAttributes.sfwBookmarkType);t.Elements&&t.Elements.length>0&&n.setChildTempleteEntityOnSync(t,i);u.Elements.push(i)})):(r={Name:"sfwCorrespondenceTestField",value:"",dictAttributes:{},Elements:[]},r.dictAttributes.ID=t.dictAttributes.ID,r.dictAttributes.Value=t.dictAttributes.Value,t.dictAttributes.sfwBookmarkType&&(r.dictAttributes.sfwBookmarkType=t.dictAttributes.sfwBookmarkType),t.Elements&&t.Elements.length>0&&n.setChildTempleteEntityOnSync(t,r),i.Elements.push(r))})};n.SetCollectionValuesOnSynchronize=function(n,t,i,r){for(var f,e=t.Elements.length,u=0;u<e;u++)f={Name:"sfwCorrespondenceTestFields",Value:"",dictAttributes:{},Elements:[],Children:[]},f.dictAttributes.indexNumber=u,i.Elements.push(f),angular.forEach(r.Elements,function(n){var e,r,o;if(i.dictAttributes.sfwBookmarkType=="Table"){if(n.dictAttributes.sfwColumnHeader){for(e={Name:"sfwCorrespondenceTestField",Value:"",dictAttributes:{},Elements:[],Children:[]},e.dictAttributes.sfwColumnHeader=n.dictAttributes.sfwColumnHeader,e.dictAttributes.sfwDataType=n.dictAttributes.sfwDataType,r=0;r<t.Elements.length;r++)if(t.Elements[r].dictAttributes.indexNumber==u){for(o=0;o<t.Elements[r].Elements.length;o++)if(t.Elements[r].Elements[o].dictAttributes.sfwColumnHeader==n.dictAttributes.sfwColumnHeader){e.dictAttributes.Value=t.Elements[r].Elements[o].dictAttributes.Value;break}break}f.Elements.push(e)}}else if(n.dictAttributes.ID){for(e={Name:"sfwCorrespondenceTestField",Value:"",dictAttributes:{},Elements:[],Children:[]},e.dictAttributes.ID=n.dictAttributes.ID,e.dictAttributes.sfwDataType=n.dictAttributes.sfwDataType,r=0;r<t.Elements.length;r++)if(t.Elements[r].dictAttributes.indexNumber==u){for(o=0;o<t.Elements[r].Elements.length;o++)if(t.Elements[r].Elements[o].dictAttributes.ID==n.dictAttributes.ID){e.dictAttributes.Value=t.Elements[r].Elements[o].dictAttributes.Value;break}break}f.Elements.push(e)}})};n.DeleteCorrespondenceTest=function(){var i=confirm("Do you want to remove the selected test '"+n.SetSelectedTest.dictAttributes.ID+"'from this section ?"),t;if(i){if(t=n.objCorrespondenceTests.Elements.indexOf(n.SetSelectedTest),t>-1)if(r.DeleteItem(n.SetSelectedTest,n.objCorrespondenceTests.Elements,"onTestClick"),t<n.objCorrespondenceTests.Elements.length)n.onTestClick(n.objCorrespondenceTests.Elements[t]);else if(n.objCorrespondenceTests.Elements.length>0)n.onTestClick(n.objCorrespondenceTests.Elements[t-1]);else n.onTestClick(n.objCorrespondenceTests);n.objCorrespondenceTests.Elements.length==0&&(n.SetSelectedTest=undefined)}};n.onTestClick=function(t){r.IsLoading=!0;n.SetSelectedTest=t;n.getContorlFromQueryOnLoad(t);r.IsLoading=!1};n.onInputClick=function(t){n.SetSelectedInput=t};n.onAddItems=function(t){n.SetSelectedInput=t;OpenPopup(t,n,n.objCorrespondenceDetails)};n.getContorlFromQueryOnLoad=function(t){var i=[],r=[],f=n.objQueryBookMarks.Elements,u;f&&f.length>0&&(r=n.getControlForQuery(f),t&&t.Elements.length>0&&r.length>0&&(u=t.Elements.filter(function(n){return n.dictAttributes.sfwBookmarkType==="Query"}),u&&u.length>0&&r.length>0&&angular.forEach(u,function(t){i=r.filter(function(n){return n.dictAttributes.sfwQueryID==t.dictAttributes.ID});i&&i.length>0&&(t.controlName=i[0].Name,(t.controlName==="sfwDropDownList"||t.controlName==="sfwCheckBoxList"||t.controlName==="sfwRadioButtonList"||t.controlName==="sfwMultiSelectDropDownList")&&(t.LoadType=i[0].dictAttributes.sfwLoadType?i[0].dictAttributes.sfwLoadType:"Items",t.lstItems=[],i[0].Elements.length>0?angular.forEach(i[0].Elements,function(n){n.Name=="ListItem"&&t.lstItems.push(n)}):i[0].dictAttributes.sfwLoadType=="CodeGroup"&&i[0].dictAttributes.sfwLoadSource!="0"&&$.connection.hubMain.server.getCodeValuesForDropDown(i[0].dictAttributes.sfwLoadSource).done(function(i){n.$evalAsync(function(){i&&i.length>0&&angular.forEach(i,function(n){t.lstItems.push({dictAttributes:{Text:n.CodeValueDescription,Value:n.CodeValue}})})})})))})))};n.getControlForQuery=function(t){var i=[];return angular.forEach(n.objQueryForm.Elements,function(n){n&&angular.forEach(n.Elements,function(n){n&&angular.forEach(n.Elements,function(n){n&&angular.forEach(t,function(t){i=i.concat(n.Elements.filter(function(n){return n.dictAttributes.sfwQueryID==t.dictAttributes.ID}))})})})}),i};n.validateObjectBasedTest=function(){n.istrObjectBasedTestError="";n.SetSelectedTest.dictAttributes.sfwIsObjectBased==="True"&&(n.SetSelectedTest.dictAttributes.sfwLoadSource!=="form"||n.SetSelectedTest.dictAttributes.sfwAssociatedFormName?n.SetSelectedTest.dictAttributes.sfwLoadSource!=="xmlmethod"||n.SetSelectedTest.dictAttributes.sfwXmlMethod||(n.istrObjectBasedTestError="Please select an Xml Method."):n.istrObjectBasedTestError="Please select an associated form.")};n.populateAssociatedForms=function(){n.ilstAssociatedForms=[];$.connection.hubCorrespondence.server.loadAssociatedForms(n.objCorrespondenceDetails.dictAttributes.sfwTemplate,n.objCorrespondenceDetails.dictAttributes.sfwType).done(function(t){n.$apply(function(){t&&t.length&&(n.ilstAssociatedForms=t.map(function(n){return n.FormName}))})})};n.populateXmlMethods=function(){var t,i;n.ilstXmlMethods=[];t=f.getEntityIntellisense();t&&(i=t.filter(function(t){return t.ID===n.objCorrespondenceDetails.dictAttributes.sfwEntity})[0],i&&angular.forEach(i.XmlMethods,function(t){t.MethodType.toLowerCase()==="load"&&(t.Mode.toLowerCase()==="update"||t.Mode.toLowerCase()==="all")&&n.ilstXmlMethods.push(t)}))};n.updateXmlMethodParameters=function(){var i=n.ilstXmlMethods.filter(function(t){return t.ID===n.SetSelectedTest.dictAttributes.sfwXmlMethod})[0],u,t,f;if(r.UndRedoBulkOp("Start"),u=n.SetSelectedTest.Elements.filter(function(n){return n.Name==="parameter"}),i&&i.Parameters)for(t=0;t<i.Parameters.length;t++)u.some(function(n){return n.dictAttributes.ID===i.Parameters[t].ID})||(f={Name:"parameter",dictAttributes:{ID:i.Parameters[t].ID},Elements:[]},r.PushItem(f,n.SetSelectedTest.Elements));for(t=0;t<u.length;t++)i&&i.Parameters&&i.Parameters.some(function(n){return n.ID===u[t].dictAttributes.ID})||r.DeleteItem(u[t],n.SetSelectedTest.Elements);r.UndRedoBulkOp("End");r.IsLoading=!1};n.updateTestParameters=function(){r.IsLoading=!0;n.validateObjectBasedTest();n.SetSelectedTest.dictAttributes.sfwLoadSource==="xmlmethod"?n.updateXmlMethodParameters():$.connection.hubForm.server.getFormParameters(n.SetSelectedTest.dictAttributes.sfwAssociatedFormName,"Update").done(function(t){n.$apply(function(){var u,i,f;if(t){for(r.UndRedoBulkOp("Start"),u=n.SetSelectedTest.Elements.filter(function(n){return n.Name==="parameter"}),i=0;i<t.length;i++)u.some(function(n){return n.dictAttributes.ID===t[i].ParmeterField})||(f={Name:"parameter",dictAttributes:{ID:t[i].ParmeterField},Elements:[]},r.PushItem(f,n.SetSelectedTest.Elements));for(i=0;i<u.length;i++)t.some(function(n){return n.ParmeterField===u[i].dictAttributes.ID})||r.DeleteItem(u[i],n.SetSelectedTest.Elements);r.UndRedoBulkOp("End")}r.IsLoading=!1})})};n.onRunClick=function(){var i,f;r.IsLoading=!0;var o=GetBaseModel(n.objCorrespondenceDetails),s=GetBaseModel(n.SetSelectedTest),h={mainModel:o,selectedTestStep:s,templateName:n.objCorrespondenceDetails.dictAttributes.sfwTemplate};if(h!=null)if(i=JSON.stringify(h),i.length<32e3)$.connection.hubCorrespondence.server.onOpenCorrTestWord(n.objCorrespondenceDetails.dictAttributes.sfwTemplate,s,o);else{var t="",e=[],u=0;for(f=0;f<i.length;f++)u++,t=t+i[f],u==32e3&&(u=0,e.push(t),t="");u!=0&&e.push(t);rt(e)}};rt=function(n){for(var t=0;t<n.length;t++)$.connection.hubCorrespondence.server.receiveDataPacketsForTestCorrespondence(n[t],n.length,t)}}]);app.directive("collectiondirectivefortest",["$compile","$rootScope",function(n){var t=function(){var n='<td valign="top" ng-repeat="item in items.Elements" ng-model="SelectedTestField">';return n+="  <table><tr>",n+=' <td><input type="text" class="form-control form-filter input-sm min-width-80" title="{{item.dictAttributes.Value}}" ng-model="item.dictAttributes.Value" ng-hide="item.dictAttributes.sfwBookmarkType == \'Template\' || item.dictAttributes.sfwBookmarkType == \'Table\'"/> <\/td>',n+='  <td> <a><img src="images/Common/icon_add_dark.svg" ng-click="OpenPopup(item)" ng-show="item.dictAttributes.sfwDataType == \'Collection\' && item.dictAttributes.sfwBookmarkType == \'Template\'"/><\/a> <\/td>',n+='  <td> <a><img src="images/Common/icon_add_dark.svg" ng-click="OpenPopup(item)" ng-show="item.dictAttributes.sfwBookmarkType == \'Table\'"/><\/a> <\/td>',n+='  <td> <a><img src="images/Common/icon_add_dark.svg"  ng-click="OpenPopup(item)" ng-show="item.dictAttributes.sfwDataType == \'Entity\' && item.dictAttributes.sfwBookmarkType == \'Template\'"/><\/a><\/td><\/tr> ',n+"<\/table><\/td>"};return{restrict:"A",replace:!0,scope:{items:"=",model:"=",mainmodel:"=",objselectedstep:"="},link:function(i,r){r.html(t(i.testfieldmodel,i.objselectedstep));n(r.contents())(i);i.OpenPopup=function(n){OpenPopup(n,i,i.mainmodel)}}}}]);GetMatchTemplate=function(n,t){for(var r=[],i=t.ParentVM;i&&i.Name!=="sfwCorrespondenceTestField"&&i.Name!=="sfwCorrespondenceTest";)i=i.ParentVM;return i&&(r=n.Elements.filter(function(n){return n.dictAttributes.ID==i.dictAttributes.ID})),r};OpenPopup=function(n,t,i){var u,e,r,h,c,s,f;if(n.dictAttributes.sfwBookmarkType=="Table"||n.dictAttributes.sfwBookmarkType=="sfwRepeater"){if(u=i.Elements.filter(function(n){return n.Name=="sfwChildTemplateBookmarks"}),u&&u.length>0)if(e=GetMatchTemplate(u[0],n),!e||e&&e.length==0){for(r=n.ParentVM;r!=null;){if(r.dictAttributes.sfwBookmarkType=="Template"&&r.dictAttributes.sfwDataType&&(h=getDescendents(u),h&&h.length>0&&(c=h[0].filter(function(n){return n.dictAttributes.ID==ParentVM.dictAttributes.ID}),c&&c.length>0)))break;r=r.ParentVM}if(r){var l=[],o=null,a=getDescendents(i);a&&a.length>0&&(s=a.filter(function(n){return n.dictAttributes.ID==r.dictAttributes.ID}),s&&s.length>0?s[0].dictAttributes.sfwTemplateName&&$.connection.hubCorrespondence.server.getAllBookMarks(s[0].dictAttributes.sfwTemplateName).done(function(f){var e,s,h,c;if(f.length==2&&(l=f[0],o=f[1],o))if(n.ParentVM.dictAttributes.ID)e=getDescendents(o),e&&e.length>0&&(s=e.filter(function(t){return t.dictAttributes.ID==n.ParentVM.dictAttributes.ID}),s&&s.length>0&&OpenChildTemplateWindow(l,s[0],n,t,i));else{for(var a=n.ParentVM,v=undefined;r!=null;){if(r.dictAttributes.sfwBookmarkType=="Template"&&r.dictAttributes.sfwDataType&&(h=getDescendents(u),h&&h.length>0&&(c=h[0].filter(function(n){return n.dictAttributes.ID==ParentVM.dictAttributes.ID}),c&&c.length>0)))break;r=r.ParentVM}o&&OpenChildTemplateWindow(l,o,n,t,i)}}):GetAllBookmarksAndFileModelForTable(n,i.dictAttributes.ID,t,i))}else GetAllBookmarksAndFileModelForTable(n,i.dictAttributes.ID,t,i)}else e&&GetAllBookmarksAndFileModelForTable(n,e[0].dictAttributes.sfwTemplateName,t,i)}else if(n.dictAttributes.sfwBookmarkType=="Template"){var l=[],o=null,u=i.Elements.filter(function(n){return n.Name=="sfwChildTemplateBookmarks"});u&&u.length>0&&(f=u[0].Elements.filter(function(t){return t.dictAttributes.ID==n.dictAttributes.ID}),f&&f.length>0&&f[0].dictAttributes.sfwTemplateName&&$.connection.hubCorrespondence.server.getAllBookMarks(f[0].dictAttributes.sfwTemplateName).done(function(r){var u,s,h,c,o;if(r.length==2)if(l=r[0],e=r[1],e)OpenChildTemplateWindow(l,e,n,t,i);else{for(u=n.ParentVM;u;){if(u.dictAttributes.sfwBookmarkType=="Template"&&u.dictAttributes.sfwDataType&&(s=i.Elements.filter(function(n){return n.Name=="sfwChildTemplateBookmarks"}),s&&s.length>0&&(h=getDescendents(s[0]),h&&h.length>0&&(c=h.filter(function(n){return n.dictAttributes.ID==u.dictAttributes.ID}),c&&c.length>0))))break;u=u.ParentVM}if(u){var l=[],e=null,a=getDescendents(i);a&&a.length>0&&(o=a.filter(function(n){return n.dictAttributes.ID==u.dictAttributes.ID}),o&&o.length>0&&o[0].dictAttributes.sfwTemplateName&&$.connection.hubCorrespondence.server.getAllBookMarks(o[0].dictAttributes.sfwTemplateName).done(function(n){var u,o,r,s,h;n.length==2&&(l=n[0],e=n[1],u=getDescendents(e),u&&u.length>0&&(r=u.filter(function(n){return n.dictAttributes.ID==f[0].dictAttributes.ID}),r&&r.length>0&&(o=getDescendents(r),o&&o.length>0&&(r=o.filter(function(n){return n.dictAttributes.ID==f[0].dictAttributes.ID}),r&&r.length>0&&(r[0].dictAttributes.sfwChildTemplateType=="Entity"||r[0].dictAttributes=="Collection")&&(s=[],h=null,r[0].dictAttributes.sfwTemplateName&&$.connection.hubCorrespondence.server.getAllBookMarks(r[0].dictAttributes.sfwTemplateName).done(function(n){var f=n[0],u=n[1];u&&OpenChildTemplateWindow(f,u,r[0],t,i)}))))))}))}}}))}};GetAllBookmarksAndFileModelForTable=function(n,t,i,r){var u=i.$new(!0),f,e;u.lstData=[];f=[];e=null;u.testfieldmodel=n;u.correspondencemainmodel=r;t&&($.connection.hubCorrespondence.server.getAllBookMarks(t).done(function(t){var o,s,i;t.length==2&&(f=t[0],e=t[1]);n.dictAttributes.sfwBookmarkType&&n.dictAttributes.sfwBookmarkType.indexOf("Template")>-1?u.$evalAsync(function(){u.lstData=CreateColumnsForChildTemplate(f)}):e?(o=getDescendents(e),o&&o.length>0&&(i=o.filter(function(t){return t.dictAttributes.ID==n.dictAttributes.ID}),i&&i.length>0&&angular.forEach(i[0].Elements,function(n){i[0].Name=="sfwRepeater"?u.$evalAsync(function(){u.lstData.push(n.dictAttributes.ID)}):u.$evalAsync(function(){u.lstData.push(n.dictAttributes.sfwColumnHeader)})}))):(s=r.Elements.filter(function(n){n.Name=="sfwTableBookMarks"}),s&&s.length>0&&(i=s[0].Elements.filter(function(t){return t.dictAttributes.ID==n.dictAttributes.ID}),i&&i.length>0&&angular.forEach(i[0].Elements,function(n){i[0].Name=="sfwRepeater"?u.$evalAsync(function(){u.lstData.push(n.dictAttributes.ID)}):u.$evalAsync(function(){u.lstData.push(n.dictAttributes.sfwColumnHeader)})})))}),u.openAddItemToListForCollection=i.$root.showDialog(u,"Add Items","Correspondence/views/AddItemToListForCollection.html"),u.AddCollectionRecord=function(){var r=0,n=undefined,t={Name:"sfwCorrespondenceTestFields",Value:"",dictAttributes:{},Elements:[]};u.model?(r=u.model.Elements.length,n=u.model):u.testfieldmodel&&(r=u.testfieldmodel.Elements.length,n=u.testfieldmodel);t.dictAttributes.indexNumber=r;t.ParentVM=u.testfieldmodel;i.$root.PushItem(t,u.testfieldmodel.Elements);u.lstData&&u.lstData.length>0&&(angular.forEach(u.lstData,function(r){var e={Name:"sfwCorrespondenceTestField",Value:"",dictAttributes:{},Elements:[]},u;e.ParentVM=t;e.dictAttributes.ID=r;f&&f.length>0&&n&&n.dictAttributes.sfwBookmarkType!="Table"&&(u=f.filter(function(n){return n.Name==r}),u&&u.length>0&&(u.Type==BookmarkType.QueryUser||u.Type==BookmarkType.QueryConditionalBlock,SetTemplateBookmarkTypeInModel(u,e,n)));i.$root.PushItem(e,t.Elements)}),u.selectedCollectionRow=u.testfieldmodel.Elements[u.testfieldmodel.Elements.length-1])},u.SelectedCollectionField=function(n){u.selectedCollectionRow=n},u.DeleteCollectionRecord=function(){var n=u.testfieldmodel.Elements.indexOf(u.selectedCollectionRow);n>-1&&(i.$root.DeleteItem(u.selectedCollectionRow,u.testfieldmodel.Elements,""),n<u.testfieldmodel.Elements.length?u.SelectedCollectionField(u.testfieldmodel.Elements[n]):u.testfieldmodel.Elements.length>0?u.SelectedCollectionField(u.testfieldmodel.Elements[n-1]):u.SelectedCollectionField(u.testfieldmodel));u.testfieldmodel.Elements.length==0&&(u.selectedCollectionRow=undefined)})};SetTemplateBookmarkTypeInModel=function(n,t,i){var u=getDescendents(i),r;if(u&&u.length>0&&(r=u.filter(function(n){return n.dictAttributes.ID==t.dictAttributes.ID}),r&&r.length>0)){t.dictAttributes.sfwDataType=r[0].dictAttributes.sfwDataType;switch(n[0].Type){case BookmarkType.ConditionalBlock:case BookmarkType.ElseBlock:case BookmarkType.EndBlock:case BookmarkType.Simple:t.dictAttributes.sfwBookmarkType="Field";break;case BookmarkType.NormalTable:case BookmarkType.StaticTable:t.dictAttributes.sfwBookmarkType="Table";break;case BookmarkType.Template:t.dictAttributes.sfwBookmarkType="Template";t.dictAttributes.sfwDataType=r[0].dictAttributes.sfwChildTemplateType;break;case BookmarkType.RuleConditionalBlock:t.dictAttributes.sfwBookmarkType="Rule";break;default:t.dictAttributes.sfwBookmarkType="Field"}}};CreateColumnsForChildTemplate=function(n){var t=[];return n&&n.length>0&&angular.forEach(n,function(n){t.push(n.Name)}),t};OpenChildTemplateWindow=function(n,t,i,r,u){i.dictAttributes.sfwDataType=="Entity"?GetAllBookmarksAndFileModelForEntity(i,t.dictAttributes.ID,r,u):i.dictAttributes.sfwDataType=="Collection"&&GetAllBookmarksAndFileModelForTable(i,t.dictAttributes.ID,r,u)};GetAllBookmarksAndFileModelForEntity=function(n,t,i,r){var u=i.$new(),f,e;u.lstData=[];f=[];e=null;t&&$.connection.hubCorrespondence.server.getAllBookMarks(t).done(function(t){var o,s;if(t.length==2&&(f=t[0],e=t[1]),n.Elements.length>0){for(o=n.Elements.length-1;o>=0;o--)s=f.filter(function(t){return t.Name==n.Elements[o].dictAttributes.ID}),(!s||s&&s.length==0)&&n.Elements.splice(o,1);angular.forEach(f,function(t){var r=n.Elements.filter(function(n){return n.dictAttributes.ID==t.Name});(!r||r&&r.length==0)&&AddTemplateBookmarkInModel(t,e,n,i)})}else angular.forEach(f,function(t){AddTemplateBookmarkInModel(t,e,n,i)});u.testfieldmodel=n;u.correspondencemainmodel=r;u.openAddItemToListForEntity=i.$root.showDialog(u,"Add Items","Correspondence/views/AddItemToListForEntity.html");u.OnItemClick=function(n){u.selectedItem=n};u.$evalAsync(function(){u.Elements=n.Elements});u.OpenPopup=function(n){OpenPopup(n,u,e)}})};AddTemplateBookmarkInModel=function(n,t,i,r){var u,e,f;if(n.Type!=BookmarkType.QueryUser&&n.Type!=BookmarkType.QueryConditionalBlock){if(u={Name:"sfwCorrespondenceTestField",Value:"",dictAttributes:{},Elements:[]},u.dictAttributes.ID=n.Name,e=getDescendents(t),e&&e.length>0&&(f=e.filter(function(t){return t.dictAttributes.ID&&t.dictAttributes.ID.toLowerCase()==n.Name.toLowerCase()}),f&&f.length>0)){u.dictAttributes.sfwDataType=f[0].dictAttributes.sfwDataType;switch(n.Type){case BookmarkType.ConditionalBlock:case BookmarkType.ElseBlock:case BookmarkType.EndBlock:case BookmarkType.Simple:u.dictAttributes.sfwBookmarkType="Field";break;case BookmarkType.NormalTable:case BookmarkType.StaticTable:u.dictAttributes.sfwBookmarkType="Table";break;case BookmarkType.Template:u.dictAttributes.sfwBookmarkType="Template";u.dictAttributes.sfwDataType=f[0].dictAttributes.sfwChildTemplateType;break;case BookmarkType.RuleConditionalBlock:u.dictAttributes.sfwBookmarkType="Rule";break;default:u.dictAttributes.sfwBookmarkType="Field"}}r.$root.PushItem(u,i.Elements)}};var BookmarkType={Undefined:0,Simple:1,Constant:2,ConditionalBlock:3,QueryConditionalBlock:4,RuleConditionalBlock:5,EndBlock:6,Barcode:7,QueryUser:8,NormalTable:9,StaticTable:10,InsertFile:11,ElseBlock:12,Template:13,Repeater:14,RepeaterEnd:15,HyperLink:16,CheckBoxControl:17,QueryCheckBoxControl:18};app.directive("correspondencetabletemplate",["$compile","$EntityIntellisenseFactory","$ValidationService","CONSTANTS","$NavigateToFileService","$rootScope","$GetEntityFieldObjectService",function(n,t,i,r,u,f,e){var o=function(){var n="";return n+='<div class="panel" ng-click="loadEntityTree(true, $event)">',n+='<div class="panel-heading"  ng-click="items.IsExpanded=!items.IsExpanded">',n+='<span ng-bind="items.dictAttributes.ID"><\/span>',n+='<div class="correspondence-panel-arrow">',n+="<i ng-class=\"!items.IsExpanded?'fa fa-chevron-down':'fa fa-chevron-up'\">",n+="<\/i>",n+="<\/div>",n+="<\/div>",n+='<div class="panel-body" ng-if="items.IsExpanded">',n+='<div class="form-group no-bottom-margin">',n+='<label class="control-label corr-tables-caption" ng-if="!items.dictAttributes.sfwEntityField.trim()">Entity Field<\/label><label class="control-label corr-tables-caption" ng-if="items.dictAttributes.sfwEntityField.trim()"><a ng-click="NavigateToEntityField(items.dictAttributes.sfwEntityField,objcorrespondence.dictAttributes.sfwEntity)">Entity Field<\/a><\/label>',n+='<entityfieldelementintellisense onchangecallback="clearEntityFieldforTable()" modebinding="items.dictAttributes.sfwEntityField"  class="corr-tables-input" model="items" onblurcallback="setEntityIDForSelectedTable(items)" isshowonetoone=true isshowonetomany=true entityid="objcorrespondence.dictAttributes.sfwEntity" propertyname="\'dictAttributes.sfwEntityField\'" errorprop="items.errors.sfwEntityField" validate="true"/>',n+="<\/div>",n+='<div class="contact-table-manage">',n+='<table class="sws-table sws-bordered-table auto-width" ng-click="loadEntityTree(false, $event)">',n+="<thead>",n+="<tr>",n+="<th><\/th>",n+="<th ng-repeat=\"objTbl in items.Elements\"  ng-class=\"{'selected':objTbl==selectedSfwColumn, 'bckgGrey' : objTbl.isAdvanceSearched, 'bckgGreen' : (objTbl.isAdvanceSearched && objTbl==selectedSfwColumn)}\" >{{objTbl.dictAttributes.sfwColumnHeader}}<\/th>",n+="<\/tr>",n+="<\/thead>",n+="<tbody>",n+="<tr>",n+='<td class="sws-bordered-table-left-td">Field Name<\/td>',n+='<td ng-repeat="objTbl in items.Elements">',n+='<entityfieldelementintellisense setcolumndatatype="true" candrop="true" modebinding="objTbl.dictAttributes.sfwEntityField" model="objTbl" entityid="SelectedTableEntityID" propertyname="\'dictAttributes.sfwEntityField\'" errorprop="objTbl.errors.sfwEntityField" validate="true" isempty="true"/>',n+="<\/td>",n+="<\/tr>",n+="<tr >",n+='<td class="sws-bordered-table-left-td">Data Format<\/td>',n+='<td ng-repeat="objTbl in items.Elements">',n+='<common-intellisense collection="dataformats" selected-item="objTbl.dictAttributes.sfwDataFormat" model="objTbl" propertyname="\'dictAttributes.sfwDataFormat\'"><\/common-intellisense>',n+="<\/td>",n+="<\/tr>",n+="<tr>",n+='<td class="sws-bordered-table-left-td">Data Type<\/td>',n+='<td ng-repeat="objTbl in items.Elements">',n+='<select class="form-control form-filter input-sm" ng-options="datatype.CodeID as datatype.CodeValue for datatype in datatypes" title="{{objTbl.dictAttributes.sfwColumnDataType}}" ng-model="objTbl.dictAttributes.sfwColumnDataType"><\/select>',n+="<\/td>",n+="<\/tr>",n+="<\/tbody>",n+="<\/table>",n+="<\/div>",n+="<\/div>",n+="<\/div>",n};return{restrict:"E",replace:!0,scope:{items:"=",objcorrespondence:"=",entitytreename:"=entityTreeName",changeCallback:"&",selectedSfwColumn:"="},link:function(s,h){s.datatypes=r.CORRESPONDENCEDATATYPES;s.dataformats=["","{0:d}","{0:C}","{0:000-##-####}","{0:(###)###-####}"];s.loadEntityTree=function(n,t){if(n)s.changeCallback&&s.changeCallback();else if(s.items.dictAttributes.sfwEntityField&&s.objcorrespondence.dictAttributes.sfwEntity){var i=e.GetEntityFieldObjectFromEntityField(s.objcorrespondence.dictAttributes.sfwEntity,s.items.dictAttributes.sfwEntityField);i&&(i.DataType=="Collection"||i.DataType=="List")&&s.changeCallback&&s.changeCallback({entity:i.Entity})}t&&t.stopPropagation()};s.clearEntityFieldforTable=function(){s.items.Elements.forEach(function(n){n.dictAttributes.sfwEntityField="";i.checkValidListValue([],n,n.dictAttributes.sfwEntityField,"sfwEntityField","sfwEntityField",r.VALIDATION.ENTITY_FIELD_INCORRECT,undefined,!0)})};s.setEntityIDForSelectedTable=function(n){var t,i;s.SelectedTableEntityID=undefined;entityField=n.dictAttributes.sfwEntityField;t=s.objcorrespondence.dictAttributes.sfwEntity;entityField&&t&&(i=e.GetEntityFieldObjectFromEntityField(t,entityField),i&&(s.SelectedTableEntityID=i.Entity))};s.items&&(h.html(o(s.items)),n(h.contents())(s),s.setEntityIDForSelectedTable(s.items));s.NavigateToEntityField=function(n,i){var l,h,c,v,a,y,p,e;if(n&&i){var r=n.split("."),o=[],b=t.getEntityIntellisense(),w=b,h="";for(i&&(h=i);h;)c=w.filter(function(n){return n.ID==h}),c.length>0?(v=c[0].Attributes,o=o.concat(v),h=c[0].ParentId):h="";if(r.length>1)for(s.isMultilevelActive=!0,l=0;l<r.length-1;l++)if(e=o.filter(function(n){return n.ID==r[l]}),e.length>0&&typeof e[0].DataType!="undefined"&&(e[0].DataType=="Object"||e[0].DataType=="Collection"||e[0].DataType=="CDOCollection"||e[0].DataType=="List")&&typeof e[0].Entity!="undefined")for(h=e[0].Entity,l<r.length-2&&(o=[]);h;)c=w.filter(function(n){return n.ID==h}),c.length>0?(v=c[0].Attributes,o=o.concat(v),h=c[0].ParentId):h="";o&&o.length>0&&(a=o.filter(function(n){return n.ID==r[r.length-1]}),a&&a.length>0&&(y=r[r.length-1],a[0].Type&&a[0].Type=="Description"&&r[r.length-1]&&r[r.length-1].toLowerCase().endsWith("description")&&(y=r[r.length-1].substr(0,r[r.length-1].length-11)+"Value"),r.length==1?(p="",i&&(p=i),p&&(f.IsLoading=!0,u.NavigateToFile(p,"attributes",y))):r.length>1&&(e=o.filter(function(n){return n.ID==r[r.length-2]}),e&&e!=""&&e[0].Entity&&(f.IsLoading=!0,u.NavigateToFile(e[0].Entity,"attributes",y)))))}}}}}]);app.directive("correspondencerepeatercontroltemplate",["$compile","$EntityIntellisenseFactory","$ValidationService","CONSTANTS","$NavigateToFileService","$rootScope","$GetEntityFieldObjectService",function(n,t,i,r,u,f,e){var o=function(){var n="";return n+='<div class="panel" ng-click="loadEntityTree(true, $event)">',n+='<div class="panel-heading"  ng-click="items.IsExpanded=!items.IsExpanded">',n+='<span ng-bind="items.dictAttributes.ID"><\/span>',n+='<div class="correspondence-panel-arrow">',n+="<i ng-class=\"!items.IsExpanded?'fa fa-chevron-down':'fa fa-chevron-up'\">",n+="<\/i>",n+="<\/div>",n+="<\/div>",n+='<div class="panel-body" ng-if="items.IsExpanded">',n+="<Grid>",n+="    <Grid.ColumnDefinitions>",n+='        <ColumnDefinition Width="auto" />',n+='        <ColumnDefinition Width="*" />',n+='        <ColumnDefinition Width="auto" />',n+='        <ColumnDefinition Width="*" />',n+="  <\/Grid.ColumnDefinitions>",n+="    <Grid.RowDefinitions>",n+='        <RowDefinition Height="*" />',n+="<\/Grid.RowDefinitions>",n+='<label Grid.Column="0" class="control-label " style="vertical-align:10px" ng-if="!items.dictAttributes.sfwEntityField.trim()">Entity Field<\/label><label class="control-label corr-tables-caption" ng-if="items.dictAttributes.sfwEntityField.trim()"><a ng-click="NavigateToEntityField(items.dictAttributes.sfwEntityField,objcorrespondence.dictAttributes.sfwEntity)">Entity Field<\/a><\/label>',n+='<entityfieldelementintellisense Grid.Column="1" onchangecallback="clearEntityFieldforTable()" modebinding="items.dictAttributes.sfwEntityField" class="corr-tables-input" model="items" onblurcallback="setEntityIDForSelectedTable(items)" isshowonetoone=true isshowonetomany=true entityid="objcorrespondence.dictAttributes.sfwEntity" propertyname="\'dictAttributes.sfwEntityField\'" errorprop="items.errors.sfwEntityField" validate="true" />',n+='<label Grid.Column="2" style="vertical-align:10px" class="control-label marg-left-10">Show First Line Header<\/label>',n+='<input class="marg-left-10" type="checkbox" style="vertical-align:10px" ng-model="items.dictAttributes.sfwFirstLineHeader" ng-checked="items.dictAttributes.sfwFirstLineHeader" undoredodirective model="items" ng-true-value="\'True\'" ng-false-value="\'False\'" />',n+="<\/Grid>",n+='<div class="contact-table-manage">',n+='<table class="sws-table sws-bordered-table auto-width" ng-click="loadEntityTree(false, $event)">',n+="<thead>",n+="<tr>",n+="<th>ID<\/th>",n+="<th>Data Type<\/th>",n+="<th>Data Format<\/th>",n+="<th>Entity Field<\/th>",n+="<\/tr>",n+="<\/thead>",n+="<tbody>",n+='<tr ng-repeat="objTbl in items.Elements">',n+="<td>",n+='<input type="text" class="form-control input-sm" ng-model="objTbl.dictAttributes.ID"  undoredodirective model="objTbl" />',n+="<\/td>",n+="<td>",n+='<select class="form-control form-filter input-sm" ng-options="datatype.CodeID as datatype.CodeValue for datatype in datatypes" title="{{objTbl.dictAttributes.sfwDataType}}" ng-model="objTbl.dictAttributes.sfwDataType"><\/select>',n+="<\/td>",n+="<td>",n+='<common-intellisense collection="dataformats" selected-item="objTbl.dictAttributes.sfwDataFormat" model="objTbl" propertyname="\'dictAttributes.sfwDataFormat\'"><\/common-intellisense>',n+="<\/td>",n+="<td>",n+='<entityfieldelementintellisense setcolumndatatype="true" candrop="true" modebinding="objTbl.dictAttributes.sfwEntityField" model="objTbl" entityid="SelectedTableEntityID" propertyname="\'dictAttributes.sfwEntityField\'" errorprop="objTbl.errors.sfwEntityField" validate="true" isempty="true"/>',n+="<\/td>",n+="<\/tr>",n+="<\/tbody>",n+="<\/table>",n+="<\/div>",n+="<\/div>",n+="<\/div>",n};return{restrict:"E",replace:!0,scope:{items:"=",objcorrespondence:"=",entitytreename:"=entityTreeName",changeCallback:"&",selectedSfwColumn:"="},link:function(s,h){s.datatypes=r.CORRESPONDENCEDATATYPES;s.dataformats=["","{0:d}","{0:C}","{0:000-##-####}","{0:(###)###-####}"];s.loadEntityTree=function(n,t){if(n)s.changeCallback&&s.changeCallback();else if(s.items.dictAttributes.sfwEntityField&&s.objcorrespondence.dictAttributes.sfwEntity){var i=e.GetEntityFieldObjectFromEntityField(s.objcorrespondence.dictAttributes.sfwEntity,s.items.dictAttributes.sfwEntityField);i&&(i.DataType=="Collection"||i.DataType=="List")&&s.changeCallback&&s.changeCallback({entity:i.Entity})}t&&t.stopPropagation()};s.clearEntityFieldforTable=function(){s.items.Elements.forEach(function(n){n.dictAttributes.sfwEntityField="";i.checkValidListValue([],n,n.dictAttributes.sfwEntityField,"sfwEntityField","sfwEntityField",r.VALIDATION.ENTITY_FIELD_INCORRECT,undefined,!0)})};s.setEntityIDForSelectedTable=function(n){var t,i;s.SelectedTableEntityID=undefined;entityField=n.dictAttributes.sfwEntityField;t=s.objcorrespondence.dictAttributes.sfwEntity;entityField&&t&&(i=e.GetEntityFieldObjectFromEntityField(t,entityField),i&&(s.SelectedTableEntityID=i.Entity))};s.items&&(h.html(o(s.items)),n(h.contents())(s),s.setEntityIDForSelectedTable(s.items));s.NavigateToEntityField=function(n,i){var l,h,c,v,a,y,p,e;if(n&&i){var r=n.split("."),o=[],b=t.getEntityIntellisense(),w=b,h="";for(i&&(h=i);h;)c=w.filter(function(n){return n.ID==h}),c.length>0?(v=c[0].Attributes,o=o.concat(v),h=c[0].ParentId):h="";if(r.length>1)for(s.isMultilevelActive=!0,l=0;l<r.length-1;l++)if(e=o.filter(function(n){return n.ID==r[l]}),e.length>0&&typeof e[0].DataType!="undefined"&&(e[0].DataType=="Object"||e[0].DataType=="Collection"||e[0].DataType=="CDOCollection"||e[0].DataType=="List")&&typeof e[0].Entity!="undefined")for(h=e[0].Entity,l<r.length-2&&(o=[]);h;)c=w.filter(function(n){return n.ID==h}),c.length>0?(v=c[0].Attributes,o=o.concat(v),h=c[0].ParentId):h="";o&&o.length>0&&(a=o.filter(function(n){return n.ID==r[r.length-1]}),a&&a.length>0&&(y=r[r.length-1],a[0].Type&&a[0].Type=="Description"&&r[r.length-1]&&r[r.length-1].toLowerCase().endsWith("description")&&(y=r[r.length-1].substr(0,r[r.length-1].length-11)+"Value"),r.length==1?(p="",i&&(p=i),p&&(f.IsLoading=!0,u.NavigateToFile(p,"attributes",y))):r.length>1&&(e=o.filter(function(n){return n.ID==r[r.length-2]}),e&&e!=""&&e[0].Entity&&(f.IsLoading=!0,u.NavigateToFile(e[0].Entity,"attributes",y)))))}}}}}]);