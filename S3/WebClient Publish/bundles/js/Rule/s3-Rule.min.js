function GetVariablesAndParams(n,t,i){var r,u;if(i){if(t=="parameters")return r=[],n&&n.Parameters&&(r=n.Parameters),r}else if(n&&n.Elements)return r=n.Elements.filter(function(n){return n.Name==t?!0:!1}),r.length>0?r[0]:(u={Name:t,value:"",dictAttributes:{},Elements:[]},n.Elements.push(u),u)}function closeOtherRightPanels(n){var t=getCurrentFileScope(),r,i,u,f;n!="LocalVariables"&&(r=$("div[id='"+t.$root.currentopenfile.file.FileName+"']").find("#dvLocalVar"),r.hide("slide",{direction:"right"}));n!="Parameters"&&(i=$("div[id='"+t.$root.currentopenfile.file.FileName+"']").find("#dvParameters"),i.hide("slide",{direction:"right"}));n!="DecisionTableParameters"&&(i=$("div[id='"+t.$root.currentopenfile.file.FileName+"']").find("#dvDecisionTableParameters"),i.hide("slide",{direction:"right"}));n!="ChildRules"&&(u=$("div[id='"+t.$root.currentopenfile.file.FileName+"']").find("#dvChildRules"),u.hide("slide",{direction:"right"}));n!="ParentRules"&&(f=$("div[id='"+t.$root.currentopenfile.file.FileName+"']").find("#dvParentRules"),f.hide("slide",{direction:"right"}))}function setSelectionForCurrentPanel(n){var t=n.currentTarget;t&&($(t).addClass("selected"),$(t).siblings().removeClass("selected"))}function setAnalystView(n){n=="LogicalRule"?($(".tbl-assign").parent("span").css("margin-top","15px"),$(".default-text-assign").css("height","22px"),$(".tbl-assign").each(function(){$(this).find("tr").each(function(n){n>0&&$(this).hide()})})):n=="DecisionTable"&&$(".dt-assign-header, .dt-assign, .dt-row-col-header, .dt-if").each(function(){$(this).find("table tr").each(function(n){n>0&&$(this).hide()})})}function setDeveloperView(n){n=="LogicalRule"?($(".tbl-assign").parent("span").removeAttr("style"),$(".default-text-assign").removeAttr("style"),$(".tbl-assign").each(function(){$(this).find("tr").each(function(n){n>0&&$(this).show()})})):n=="DecisionTable"&&$(".dt-assign-header, .dt-assign, .dt-row-col-header, .dt-if").each(function(){$(this).find("table tr").each(function(n){n>0&&$(this).show()})})}function containsMathOpe(n){return n.contains("+")||n.contains("-")||n.contains("*")||n.contains("/")||n.contains(" ")||n.contains(">")||n.contains("<")||n.contains("%")||n.contains("==")||n.contains("!")||n.contains("=")||n.contains("(")?!0:!1}function isMathope(n){return n=="+"||n=="-"||n=="*"||n=="/"||n==" "||n=="\n"||n==">"||n=="<"||n=="%"||n=="="||n=='"'||n=="("||n==")"||n==","||n=="?"||n==":"||n==";"?!0:!1}function getSplitArray(n,t){for(var f=[],r=n.split(""),u=[],i=t-1;i>=0;i--){if(r[i]!='"'&&isMathope(r[i]))break;u.push(r[i])}return u.length>0&&(n=u.reverse().join(""),f=n.split(".")),f}function split(n){return n.split(".")}function extractLast(n,t){var i=getSplitArray(n,t);return i.length>0?i.pop():""}function caretPosition(n){var e=0,i=n.ownerDocument||n.document,o=i.defaultView||i.parentWindow,t,r,u,s,f;return typeof o.getSelection!="undefined"?(t=o.getSelection(),t.rangeCount>0&&(r=o.getSelection().getRangeAt(0),u=r.cloneRange(),u.selectNodeContents(n),u.setEnd(r.endContainer,r.endOffset),e=u.toString().length)):(t=i.selection)&&t.type!="Control"&&(s=t.createRange(),f=i.body.createTextRange(),f.moveToElementText(n),f.setEndPoint("EndToEnd",s),e=f.text.length),e}function setRuleIntellisense(n,t,i,r){window.event&&(window.event.keyCode===38||window.event.keyCode===40)||(r==""&&(r=undefined),ruleIntellisenseData=t,t.length>0&&(t=typeof t[0].ID=="undefined"?t.sort():typeof r!="undefined"?t.sort(function(n,t){var i=n[r].toLowerCase(),u=t[r].toLowerCase();return i<u?-1:i>u?1:0}):t.sort(function(n,t){if(n.ID&&t.ID){var i=n.ID.toLowerCase(),r=t.ID.toLowerCase();if(i<r)return-1;if(i>r)return 1}return 0}),n.autocomplete({minLength:0,appendTo:"#dvIntellisense",open:function(t){var u,f,r,i,e,o,s;n[0].localName=="textarea"||n[0].localName=="input"&&n.attr("type")=="text"?(u=n.textareaHelper("caretPosAbs"),$("#dvIntellisense > ul").css({left:u.left+"px",top:u.top+"px",width:"auto",height:"auto",overflow:"auto",maxWidth:"300px",maxHeight:"300px","z-index":"999999999"})):n[0].localName=="span"&&(f=n[0].ownerDocument||n[0].document,r=f.defaultView||f.parentWindow,r&&typeof r.getSelection!="undefined"&&(e=r.getSelection(),e.rangeCount>0&&(o=r.getSelection().getRangeAt(0),i=o.getBoundingClientRect())),s=i&&(i.left!=0||i.top!=0)?{left:i.left+"px",top:i.top+i.height+"px",width:"auto",height:"auto",overflow:"auto",maxWidth:"300px",maxHeight:"300px","z-index":"999999999"}:{width:"auto",height:"auto",overflow:"auto",maxWidth:"300px",maxHeight:"300px","z-index":"999999999"},$("#dvIntellisense > ul").css(s),setIntellisensePosition(t));$(n).data("ui-autocomplete")&&($(".page-header-fixed").css("pointer-events","none"),$("#dvIntellisense").css("pointer-events","auto"))},source:function(n,i){t=ruleIntellisenseData;i($.ui.autocomplete.filter($.map(t,function(n){var t="";return n.DataType&&n.DataType.toLowerCase()=="int"?t="<img style='margin-right:6px' src='images/Form/icon-integer.png'/>":n.DataType&&n.DataType.toLowerCase()=="bool"?t="<img style='margin-right:6px' src='images/Form/icon-boolean.png'/>":n.DataType&&(n.DataType.toLowerCase()=="collection"||n.DataType.toLowerCase()=="cdocollection"||n.DataType.toLowerCase()=="list")?t="<img style='margin-right:6px' src='images/Form/icon-collection.png'/>":n.DataType&&n.DataType.toLowerCase()=="datetime"?t="<img style='margin-right:6px' src='images/Form/icon-datetime.png'/>":n.DataType&&n.DataType.toLowerCase()=="decimal"?t="<img style='margin-right:6px' src='images/Form/icon-decimal.png'/>":n.DataType&&n.DataType.toLowerCase()=="double"?t="<img style='margin-right:6px' src='images/Form/icon-double.png'/>":n.DataType&&n.DataType.toLowerCase()=="float"?t="<img style='margin-right:6px' src='images/Form/icon-float.png'/>":n.DataType&&n.DataType.toLowerCase()=="string"?t="<img style='margin-right:6px' src='images/Form/icon-string.png'/>":n.DataType&&n.DataType.toLowerCase()=="object"?t="<img style='margin-right:6px' src='images/Form/icon-object.png'/>":n.EntityName&&n.EntityName!=""?t="<img style='margin-right:6px' src='images/Home/small_filetype/Entity.png'/>":n.RuleType&&n.RuleType=="LogicalRule"?t="<img style='margin-right:6px' src='images/Home/small_filetype/logical_rule.png'/>":n.RuleType&&n.RuleType=="DecisionTable"?t="<img style='margin-right:6px' src='images/Home/small_filetype/decision_table..png'/>":n.RuleType&&n.RuleType=="ExcelMatrix"&&(t="<img style='margin-right:6px' src='images/Home/small_filetype/Excel_matrix.png'/>"),typeof n.ID=="undefined"?{label:n,value:n,logo:t}:typeof r!="undefined"&&n.hasOwnProperty(r)?{label:n[r],value:n,logo:t}:{label:n.ID,value:n,logo:t}}),extractLast(n.term,this.element[0].selectionStart)))},focus:function(n,t){return t.item.value&&t.item.value.hasOwnProperty("SqlQuery")?$(".ui-autocomplete > li").attr("title",t.item.value.SqlQuery):t.item.value&&t.item.value.hasOwnProperty("Tooltip")&&t.item.value.Tooltip?$(".ui-autocomplete > li").attr("title",t.item.value.Tooltip):$(".ui-autocomplete > li").attr("title",t.item.label),!1},select:function(t,u){var e,h=0,b,k,v,l,o,f,s,y;if(t.target.localName=="input"?e=getSplitArray(this.value,this.selectionStart):t.target.localName=="span"&&(h=caretPosition(this),e=getSplitArray(this.innerText,h)),e.length>0)if(t.target.localName=="input")this.value=this.value.substr(0,this.value.lastIndexOf(e[e.length-1]));else if(t.target.localName=="span")for(f=h-e[e.length-1].length,e[e.length-1].length>0&&(h=f),b=e[e.length-1].split(""),k=f+b.length,v=f;v<k;v++)this.innerText=this.innerText.slice(0,f)+this.innerText.slice(f+1,this.innerText.length);if(typeof r!="undefined"&&u.item.value[r])this.value=this.value+u.item.value[r];else if(u.item.value.ID){if(t.target.localName=="input"?this.value=this.value+u.item.value.ID:t.target.localName=="span"&&(this.innerText=[this.innerText.slice(0,h),u.item.value.ID,this.innerText.slice(h)].join("")),i&&i.model&&i.model.Name&&(i.model.Name=="calllogicalrule"||i.model.Name=="calldecisiontable"||i.model.Name=="callexcelmatrix"||i.model.Name=="method"||i.model.Name=="query"))if(l=i.model.Elements.filter(function(n){return n.Name=="parameters"}),u.item.value.RuleType||u.item.value.QueryType||u.item.value.ReturnType){if(u.item.value.Parameters){for(o=null,l.length>0?o=l[0]:(o={Name:"parameters",Value:"",dictAttributes:{},Elements:[],Children:[]},i.parameters=o),i.$root.UndRedoBulkOp("Start"),o.Elements.length>0&&i.$apply(function(){o.Elements=o.Elements.filter(function(n){return u.item.value.Parameters.some(function(t){return t.ID==n.dictAttributes.ID})})}),f=0;f<u.item.value.Parameters.length;f++)s=o.Elements.filter(function(n){return n.dictAttributes.ID==u.item.value.Parameters[f].ID}),s.length>0?i.$apply(function(){i.$root.EditPropertyValue(s[0].dictAttributes.sfwDataType,s[0].dictAttributes,"sfwDataType",u.item.value.Parameters[f].DataType);i.$root.EditPropertyValue(s[0].dictAttributes.sfwDirection,s[0].dictAttributes,"sfwDirection",u.item.value.Parameters[f].Direction);i.$root.EditPropertyValue(s[0].dictAttributes.sfwEntity,s[0].dictAttributes,"sfwEntity",u.item.value.Parameters[f].Entity)}):i.$apply(function(){var n={Name:"parameter",Value:"",dictAttributes:{ID:u.item.value.Parameters[f].ID,sfwDataType:u.item.value.Parameters[f].DataType,sfwDirection:u.item.value.Parameters[f].Direction,sfwEntity:u.item.value.Parameters[f].Entity,sfwNodeID:generateUUID()},Elements:[],Children:[]};i.$root.PushItem(n,o.Elements)});l.length==0&&i.$apply(function(){i.$root.PushItem(o,i.model.Elements)});i.$root.UndRedoBulkOp("End")}}else l.length>0&&i.$apply(function(){i.$root.DeleteItem(i.model.Elements[i.model.Elements.indexOf(l[0])],i.model.Elements)})}else this.innerText=this.localName=="input"?this.value:this.innerText+u.item.value;if(y=angular.element($(this)).scope(),y&&y.$broadcast("UpdateOnClick",n[0]),this.childNodes[0]!=undefined){var p=this.ownerDocument||this.document,d=p.defaultView||p.parentWindow,c,nt=u.item.value&&u.item.value.ID!=undefined?u.item.value.ID.length:u.item.value.length,w=h+nt,a=document.createRange(),g=this.childNodes[0].length-w;g<0?a.setStart(this.childNodes[0],w+g):a.setStart(this.childNodes[0],w);a.collapse(!0);typeof d.getSelection!="undefined"?(c=d.getSelection(),c.removeAllRanges(),c.addRange(a)):(c=p.selection)&&c.type!="Control"&&(c.removeAllRanges(),c.addRange(a))}else $(this).trigger("change");return!1},close:function(){$(".page-header-fixed").css("pointer-events","auto")}})))}function returnScope(n,t){return n[t]}function resetNodeIds(n){var t;if(n.dictAttributes&&n.dictAttributes.sfwNodeID&&(n.dictAttributes.sfwNodeID=generateUUID()),n.Elements&&(n.Name=="neorule"||n.Name=="logicalrule"||n.Name=="switch"||n.Name=="foreach"||n.Name=="while"||n.Name=="case"||n.Name=="default"||n.Name=="actions"))for(t=0;t<n.Elements.length;t++)n.Elements[t]=resetNodeIds(n.Elements[t]);if(n.Elements&&n.Name!="parameters"&&n.Name!="ExtraFields"&&n.Name!="variables"&&n.Name!="neorule"&&n.Name!="logicalrule"&&n.Name!="case"&&n.Name!="default")for(t=0;t<n.Children.length;t++)n.Children[t]=resetNodeIds(n.Children[t]);return n}function getEntityIntellisense(n){var t=[],r=JSON.parse(sessionStorage.intellisenseData),i=r.filter(function(t){return t.ID==n});return i.length>0&&(t=t.concat(i[0].Attributes)),t}function getFirstLevelIntellisense(){var u=[],o=[],s=[],t=getCurrentFileScope(),i=[],f=[],n,r,e;for(t.IsDecisionTable?t.parameters&&(i=t.parameters):(t.parameters&&t.parameters.Elements&&(i=t.parameters.Elements),t.variables&&t.variables.Elements&&(f=t.variables.Elements)),n=0;n<i.length;n++)i[n].ParamID&&(i[n].dictAttributes?o.push({ID:i[n].dictAttributes.ID,DataType:i[n].dictAttributes.sfwDataType,Direction:i[n].dictAttributes.sfwDirection,Entity:i[n].dictAttributes.sfwEntity}):o.push({ID:i[n].ParamID,DataType:i[n].DataType,Direction:i[n].Direction,Entity:i[n].Entity}));for(n=0;n<f.length;n++)f[n].dictAttributes.ID&&s.push({ID:f[n].dictAttributes.ID,DataType:f[n].dictAttributes.sfwDataType,Entity:f[n].dictAttributes.sfwEntity});for(u=o.concat(s),r=t;r!=null;)if(r.$root){r=r.$root;break}else r=r.$parent;return r&&r.objConstants&&u.push({ID:r.objConstants.dictAttributes.ID,Type:"Constants"}),t.objLogicalRule.dictAttributes?t.objLogicalRule.dictAttributes.sfwStatic.toLowerCase()!="true"&&(e=t.objLogicalRule.dictAttributes.sfwEntity,u=u.concat(getEntityIntellisense(e))):t.objLogicalRule.Static.toLowerCase()!="true"&&(e=t.objLogicalRule.Entity,u=u.concat(getEntityIntellisense(e))),u}function getConstants(n){var t,u,r,f,i;for(data=[],t=getCurrentFileScope();t!=null;)if(t.$root){t=t.$root;break}else t=t.$parent;if(t&&t.objConstants){if(u=n.split("."),u[0]==t.objConstants.dictAttributes.ID)for(r=t.objConstants.Elements,i=1;i<u.length;i++)f=r.filter(function(n){return n.dictAttributes.ID==u[i]}),f&&f.length>0&&(r=f[0].Elements);if(r&&r.length>0)for(i=0;i<r.length;i++)data.push({ID:r[i].dictAttributes.ID,Type:"Constants"});return data}}function getEntityRules(n,t,i){var r=JSON.parse(sessionStorage.intellisenseData),u,f;for(r=r.filter(function(t){return t.Name==n}),u=[],f=0;f<r.length;f++)u=u.concat(r[f].Rules.filter(function(n){return n.RuleType==t&&n.IsStatic==i}));return u}function getChildRules(n){for(var e=getDescendents(n),r=e.filter(function(n){return n.Name=="calllogicalrule"||n.Name=="calldecisiontable"||n.Name=="callexcelmatrix"}),u=[],i=0;i<r.length;i++){var o=r[i].Name=="calllogicalrule"?"LogicalRule":r[i].Name=="calldecisiontable"?"DecisionTable":"ExcelMatrix",t=r[i].dictAttributes.sfwRuleID,f=!1;t&&t.length>0&&(t.lastIndexOf(".")>-1&&(f=!0,t=t.substring(t.lastIndexOf(".")+1)),u.some(function(n){return n.ID==t})||u.push({ID:t,Type:o,IsStatic:f}))}return u}function getCaretCharacterOffsetWithin(n){var e=0,i=n.ownerDocument||n.document,o=i.defaultView||i.parentWindow,t,r,u,s,f;return typeof o.getSelection!="undefined"?(t=o.getSelection(),t.rangeCount>0&&(r=o.getSelection().getRangeAt(0),u=r.cloneRange(),u.selectNodeContents(n),u.setEnd(r.endContainer,r.endOffset),e=u.toString().length)):(t=i.selection)&&t.type!="Control"&&(s=t.createRange(),f=i.body.createTextRange(),f.moveToElementText(n),f.setEndPoint("EndToEnd",s),e=f.text.length),e}function scrollToLeft(n){var i=$(n.target),t=i.parent().siblings(".rule-scrollable-tab");t&&t.length>0&&t[0].scrollLeft>0&&(t[0].scrollLeft=t[0].scrollLeft>=30?t[0].scrollLeft-30:0)}function scrollToRight(n){var i=$(n.target),t=i.parent().siblings(".rule-scrollable-tab");t&&t.length>0&&t[0].scrollLeft<t[0].scrollWidth&&(t[0].scrollLeft=t[0].scrollLeft+30<=t[0].scrollWidth?t[0].scrollLeft+30:t[0].scrollWidth)}function sortDates(n,t){if(n&&n.length>0)return n.sort(function(n,i){var r=new Date(n=="Default"||n==undefined?"01/01/0001":n),u=new Date(i=="Default"||i==undefined?"01/01/0001":i);if(r&&u)if(t&&t=="asc"){if(r<u)return-1;if(r>u)return 1}else{if(r>u)return-1;if(r<u)return 1}return 0})}function getCurrentEffectiveDate(n){if(n&&n.length>0){var i=new Date,t=n.filter(function(n){return n=new Date(n=="Default"||n==undefined?"01/01/0001":n),new Date(n)<=i});if(t&&t.length>0)return t=sortDates(t),t[0]}}function checkAndCollapseNode(n){var t=$("div[node-id='"+n+"']");t&&t.length>0&&t.find("> .node-expander").hasClass("node-collapsed")&&collapseNode(t,!0)}function expandNode(n,t){$(n).parents("li").first().find("> div > .node-wrapper > ul").show();t?($(n).parents("li").first().find("> div > ul").show(),$(n).parents("li").first().find("> div > .node-wrapper > ul > li").show()):($(n).parents("li").first().find("> div > ul").slideDown("slow"),$(n).parents("li").first().find("> div > .node-wrapper > ul > li").slideDown("slow"));$(n).parents("li").first().find("> div > .node-wrapper > ul").css("min-height","");$(n).siblings(".node-wrapper").addClass("node-wrapper-after");$(n).removeClass("node-collapsed");$(n).addClass("node-expanded")}function collapseNode(n,t){$(n).parents("li").first().find("> div > .node-wrapper > ul").css("min-height","0px");t?($(n).parents("li").first().find("> div > ul").hide(),$(n).parents("li").first().find("> div > .node-wrapper > ul").hide(),$(n).siblings(".node-wrapper").removeClass("node-wrapper-after")):($(n).parents("li").first().find("> div > ul").slideUp("slow",function(){$(n).parents("li").first().find("> div > ul").hide();$(n).siblings(".node-wrapper").removeClass("node-wrapper-after")}),$(n).parents("li").first().find("> div > .node-wrapper > ul > li").length>0?$(n).parents("li").first().find("> div > .node-wrapper > ul > li").slideUp("slow",function(){$(n).parents("li").first().find("> div > .node-wrapper > ul").hide();$(n).siblings(".node-wrapper").removeClass("node-wrapper-after")}):($(n).parents("li").first().find("> div > .node-wrapper > ul").hide(),$(n).siblings(".node-wrapper").removeClass("node-wrapper-after")));$(n).removeClass("node-expanded");$(n).addClass("node-collapsed")}function setSelectionByCharacterOffsets(n,t,i){var r,f,o,h,c,e;if(window.getSelection&&document.createRange){r=0;f=document.createRange();f.setStart(n,0);f.collapse(!0);for(var l=[n],u,s=!1,a=!1;!a&&(u=l.pop());)if(u.nodeType==3)o=r+u.length,!s&&t>=r&&t<=o&&(f.setStart(u,t-r),s=!0),s&&i>=r&&i<=o&&(f.setEnd(u,i-r),a=!0),r=o;else for(h=u.childNodes.length;h--;)l.push(u.childNodes[h]);c=window.getSelection();c.removeAllRanges();c.addRange(f)}else document.selection&&(e=document.body.createTextRange(),e.moveToElementText(n),e.collapse(!0),e.moveEnd("character",i),e.moveStart("character",t),e.select())}function disableEditing(n){$(n).parents(".node").first().attr("draggable","true");$(n).attr("contenteditable","false")}function enableEditing(n){$(n).parents(".node").first().removeAttr("draggable");$(n).attr("contenteditable","true");setSelectionByCharacterOffsets(n,$(n).text().length,$(n).text().length);$(n).focus()}function enableExpressionEditing(n,t){var i;n&&(t||(t=0),i=$("div[node-id='"+n+"']").find("> .node-wrapper > .node > .node-expression-block[logical-rule-editable]"),i.length===0&&(i=$("div[node-id='"+n+"']").find("> .node-wrapper > .node > .node-expression-container > .node-expression-block[logical-rule-editable]")),i.length===0&&(i=$("div[node-id='"+n+"']").find("> .node-wrapper > .node > .node-expression-container > .node-expression-inline[logical-rule-editable]")),i.length===0&&(i=$("div[node-id='"+n+"']").find("> .node-wrapper > .node > .node-header-block[logical-rule-editable]")),i.length===0&&(i=$("div[node-id='"+n+"']").find("> .node-wrapper > .node > .node-header-container > .node-header-block[logical-rule-editable]")),i.length===0&&(i=$("div[node-id='"+n+"']").find("> .node-wrapper > .node > .node-header-container > .node-header-inline[logical-rule-editable]")),i.length>t&&enableEditing(i[t]))}function ExpandCollapse(n){$(n).parent().siblings().toggle();$(n).siblings("ul").toggle();$(n).toggleClass("logicalrule-expanded logicalrule-collapsed")}function searchNodeByIdInCurrentRule(n){var t=getCurrentFileScope();return searchByNodeId(t.objLogicalRule,n)}function searchByNodeId(n,t){var i=null,r;if(n.dictAttributes.sfwNodeID==t)return n;if((n.Name=="neorule"||n.Name=="logicalrule"||n.Name=="switch"||n.Name=="foreach"||n.Name=="while"||n.Name=="case"||n.Name=="default")&&n.Elements.length>0)for(r=0;r<n.Elements.length;r++)if(i=searchByNodeId(n.Elements[r],t),i!=null)return i;if(n.Name!="parameters"&&n.Name!="ExtraFields"&&n.Name!="variables"&&n.Name!="neorule"&&n.Name!="logicalrule"&&n.Name!="case"&&n.Name!="default"&&i==null&&n.Children.length>0)for(r=0;r<n.Children.length;r++)if(i=searchByNodeId(n.Children[r],t),i!=null)return i;return i}function addItemOnDrop(n,t){var i=getCurrentFileScope(),e,u;if(n!=t){e=null;u=null;n.length==2?(e=searchByNodeId(i.objLogicalRule,n[0]),u=searchByNodeId(i.objLogicalRule,n[1])):n.length==1&&(u=searchByNodeId(i.objLogicalRule,n[0]),u==null&&(u=n[0],i.objSelectedLogicalRule&&i.ResetAllvalues(i.objSelectedLogicalRule),u.IsSelected=!0));var f=null,r=null,o=null;t.length==3?(f=searchByNodeId(i.objLogicalRule,t[0]),r=searchByNodeId(i.objLogicalRule,t[1]),o=t[2]):t.length==2&&(r=searchByNodeId(i.objLogicalRule,t[0]),o=t[1]);i.$evalAsync(function(){var n,t,s;if(i.$root.UndRedoBulkOp("Start"),o=="top")n=f.Children&&f.Children.length>0?f.Children.indexOf(r):-1,n>-1?(e!=null&&removeDragItemFromExistingParent(i,u,e),i.$root.InsertItem(u,f.Children,f.Children.indexOf(r))):(n=f.Elements.indexOf(r),n>-1&&(e!=null&&removeDragItemFromExistingParent(i,u,e),i.$root.InsertItem(u,f.Elements,f.Elements.indexOf(r))));else if(o=="bottom")n=f.Children!=undefined?f.Children.indexOf(r):-1,n>-1?(e!=null&&removeDragItemFromExistingParent(i,u,e),i.$root.InsertItem(u,f.Children,f.Children.indexOf(r)+1)):(n=f.Elements.indexOf(r),n>-1&&(e!=null&&removeDragItemFromExistingParent(i,u,e),i.$root.InsertItem(u,f.Elements,f.Elements.indexOf(r)+1)));else if(o=="left")n=f.Children!=undefined?f.Children.indexOf(r):-1,n>-1?(e!=null&&removeDragItemFromExistingParent(i,u,e),i.$root.InsertItem(u,f.Children,f.Children.indexOf(r)),i.$root.DeleteItem(r,f.Children),i.$root.PushItem(r,u.Children)):(n=f.Elements.indexOf(r),n>-1&&(e!=null&&removeDragItemFromExistingParent(i,u,e),i.$root.InsertItem(u,f.Elements,f.Elements.indexOf(r)),i.$root.DeleteItem(r,f.Elements),i.$root.PushItem(r,u.Children)));else if(o=="right")if(e!=null&&removeDragItemFromExistingParent(i,u,e),r.Name=="case"||r.Name=="default"){for(t=r.Elements.length-1;t>=0;t--)s=r.Elements[t],i.$root.DeleteItem(s,r.Elements),i.$root.InsertItem(s,u.Children,0);i.$root.PushItem(u,r.Elements)}else{for(t=r.Children.length-1;t>=0;t--)s=r.Children[t],i.$root.DeleteItem(s,r.Children),i.$root.InsertItem(s,u.Children,0);i.$root.PushItem(u,r.Children)}else o=="inside"&&(e!=null&&removeDragItemFromExistingParent(i,u,e),i.$root.InsertItem(u,r.Elements,0));i.$root.UndRedoBulkOp("End")})}}function removeDragItemFromExistingParent(n,t,i){var f=getNodeCollection(i,t),o=f.indexOf(t),r,u,e;if(o>-1&&(r=getNodeCollection(t),n.$root.DeleteItem(t,f),t.Name!="case"&&t.Name!="default"))for(u=r.length-1;u>=0;u--)e=r[u],n.$root.DeleteItem(e,r),n.$root.InsertItem(e,f,o)}function getNodeCollection(n,t){var i=null;return t?n.Children&&n.Children.indexOf(t)>-1?i=n.Children:n.Elements&&n.Elements.indexOf(t)>-1&&(i=n.Elements):i=n.Name==="case"||n.Name==="default"?n.Elements:n.Children,i}function GetLevel(n,t){var i="",r="",u;return t=="foreach"?(i="ul-foreach-outer",r="ul-foreach-inner"):t=="while"?(i="ul-while-outer",r="ul-while-inner"):t=="condition"&&(i="ul-condition-outer",r="ul-condition-inner"),u=$(n).parents("."+i+",."+r),u.length>0?$(u[0]).attr("class").contains(i)?!0:!1:void 0}function expandCollapseParameters(n){var t=$(n.target),r=t.parents("tr").siblings(),i=$(r[r.length-1]).find("table");t!=null&&(t.hasClass("callactivity-arrow-right")?(t.removeClass("callactivity-arrow-right"),t.addClass("callactivity-arrow-down"),i!=null&&i.removeAttr("style")):(t.removeClass("callactivity-arrow-down"),t.addClass("callactivity-arrow-right"),i!=null&&i.attr("style","display:none")))}function ToggleAllOutLining(n){var i=$(n).find(".node-expanded"),t=$(n).find(".node-collapsed");t.length>0?t.each(function(n,t){expandNode(t,!0)}):i.each(function(n,t){collapseNode(t,!0)})}function canDrag(n){var u=!0,f=getCurrentFileScope(),t,i,r;return n!=undefined&&n!=null&&(t=searchByNodeId(f.objLogicalRule,n[0]),i=searchByNodeId(f.objLogicalRule,n[1]),t!=null&&i!=null&&t.Name=="switch"&&i.Name=="case"&&(r=t.Elements.filter(function(n){return n.Name=="case"}),r.length==1&&r[0]==i&&(u=!1))),u}function getNewObject(n){var t={Name:n,Value:"",dictAttributes:{sfwNodeID:generateUUID()},Elements:[],Children:[]};return n=="actions"?t.Elements.push({Name:"action",Value:"",dictAttributes:{sfwNodeID:generateUUID()},Elements:[],Children:[]}):n=="switch"&&(t.Elements.push({Name:"case",Value:"",dictAttributes:{sfwNodeID:generateUUID()},Elements:[]}),t.Elements.push({Name:"default",Value:"",dictAttributes:{sfwNodeID:generateUUID()},Elements:[]})),t}function canDrop(n,t){var u=getCurrentFileScope(),s=!0,h,i,c,l,a,o;if(n==undefined||n==null||t==undefined||t==null)s=!1;else{h=null;i=null;n.length==2?(h=searchByNodeId(u.objLogicalRule,n[0]),i=searchByNodeId(u.objLogicalRule,n[1])):n.length==1&&(i=searchByNodeId(u.objLogicalRule,n[0]),i==null&&(i=n[0]));var f=null,r=null,e=null;if((t.length==3?(f=searchByNodeId(u.objLogicalRule,t[0]),r=searchByNodeId(u.objLogicalRule,t[1]),e=t[2]):t.length==2&&(r=searchByNodeId(u.objLogicalRule,t[0]),e=t[1]),i==r)||(c=getDescendents(i),c.indexOf(r)>-1))return!1;if(r.Name=="logicalrule"){if(l=r.Elements.filter(function(n){return n.Name!="variables"}),l.length>0)return!1}else{if((r.Name=="case"||r.Name=="default")&&e!="right"&&!(i.Name=="case"||i.Name=="default")||r.Name=="switch"&&e=="inside"&&i.Name!="case")return!1;if(i.Name=="case"||i.Name=="default")if(f!=null){if(f.Name!="switch"||e=="right"||i.Name=="case"&&r.Name=="default"||i.Name=="default"&&((a=f.Elements.filter(function(n){return n.Name=="default"}),a.length>0)||(o=f.Elements.filter(function(n){return n.Name=="case"}),o.indexOf(r)<o.length-1)))return!1}else if(r.Name=="switch"){if(i.Name=="default")return!1}else return!1}}return s}var ruleIntellisenseData,dragDropData,dragDropDataObject;app.controller("RuleController",["$scope","$rootScope","ngDialog","$resourceFactory","$EntityIntellisenseFactory","$timeout","$DashboardFactory","$cookies","$NavigateToFileService","ConfigurationFactory","$interval","$ValidationService",function(n,t,i,r,u,f,e,o,s,h,c,l){function ut(t){var i=!1,r=(t.StrDataTypePrefix?t.StrDataTypePrefix:"")+t.strID,u,o,f,e;return n.IsDecisionTable?n.parameters&&(u=n.parameters.filter(function(n){return n.ParamID==r&&!angular.equals(n,t)}),u.length>0&&(i=!0)):(n.parameters&&n.parameters.Elements&&n.parameters.Elements.length>0&&(u=n.parameters.Elements.filter(function(n){return n.dictAttributes.ID==r&&!angular.equals(n,t)}),u.length>0&&(i=!0)),n.variables&&n.variables.Elements&&n.variables.Elements.length>0&&(o=n.variables.Elements.filter(function(n){return n.dictAttributes.ID==r&&!angular.equals(n,t)}),o.length>0&&(i=!0)),f=l.getEntityAttributes(n.objLogicalRule.dictAttributes.sfwEntity,!0,!1,!1,!1,!1),angular.isArray(f)&&(e=f.filter(function(n){return n&&n.ID&&n.ID.toLowerCase()==r.toLowerCase()}),angular.isArray(e)&&e.length>0&&(i=!0))),i}function ft(n,t){for(var u="",r="",i=t;i>=0;i--){if(isMathope(n.charAt(i))||n.charAt(i)==".")break;r+=n.charAt(i)}return r.length>0&&(u=r.split("").reverse().join("")),u}function et(n,t){var u=!1,i=n.indexOf("NewObject"),r;return-1!=i?(r=i+9+1,t>=r&&(u=!0)):(i=n.indexOf("NewCollection"),-1!=i?(r=i+13+1,t>=r&&(u=!0)):(i=n.indexOf("NewList"),-1!=i&&(r=i+7+1,t>=r&&(u=!0)))),u}function ot(n){var i=0,r=0,t;if(n)for(t=0;t<n.length;t++)n[t]=="("?i++:n[t]==")"&&r++;return i==r}var tt,a,nt,y,w,p,b;t.IsLoading=!0;n.loadedRules=[];n.currentfile=t.currentopenfile.file;n.isDirty=!1;n.customTypes=[];n.navigateToFileService=s;n.isDescriptionText=!1;n.isStatusOption=!1;n.CheckParameterVisible=!1;n.objLogicalRule=null;n.IsParameterVisible=!1;n.IsLocalVariableVisible=!1;n.IsParentRulesVisible=!1;n.IsChildRulesVisible=!1;n.selectedEffectiveDate=undefined;n.selectedDesignSource=!1;n.activeLeftTab="Parameters";n.ShowMethod=!0;n.blnIsEntityObjectBased=!0;n.isExcelMatrix=!1;n.isDecisionTable=!1;n.isLogicalRule=!1;n.hasDefaultVersion=!1;n.IsToolsDivCollapsed=!0;n.lstDataFormat=["{0:(###) ###-####} ","{0:d}","{0:###-##-####}","{0:$#,###,##0.00;($#,###,##0.00)}"];hubMain.server.getModel(n.currentfile.FilePath,n.currentfile.FileType).done(function(i){i?n.receiverulemodel(i):t.closeFile(n.currentfile.FileName)});n.LoadUIforDesiredRule=function(){n.objLogicalRule&&(n.objLogicalRule.dictAttributes?n.objLogicalRule.dictAttributes.sfwRuleType=="LogicalRule"?n.isLogicalRule=!0:n.objLogicalRule.dictAttributes.sfwRuleType=="ExcelMatrix"&&(n.isExcelMatrix=!0):n.objLogicalRule.RuleType=="DecisionTable"&&(n.isDecisionTable=!0))};n.LoadRuleStatus={repeatSelect:null,StatusValue:[{id:"1",name:"Active"},{id:"2",name:"Inactive"}]};n.LoadRuleReturnTypes={repeatSelect:null,ReturnValue:[{id:"0",name:""},{id:"1",name:"bool"},{id:"2",name:"datetime"},{id:"3",name:"decimal"},{id:"4",name:"float"},{id:"5",name:"double"},{id:"6",name:"int"},{id:"7",name:"long"},{id:"8",name:"short"},{id:"9",name:"string"},{id:"10",name:"Collection"},{id:"11",name:"Object"},{id:"12",name:"List"}]};n.LoadRuleReturnTypesForDecisionTable={repeatSelect:null,ReturnValue:[{id:"0",name:""},{id:"1",name:"bool"},{id:"2",name:"datetime"},{id:"3",name:"decimal"},{id:"4",name:"float"},{id:"5",name:"double"},{id:"6",name:"int"},{id:"7",name:"long"},{id:"8",name:"short"},{id:"9",name:"string"}]};n.receiverulemodel=function(i){n.$evalAsync(function(){var f,o,l,e,u,s,r,h,c;if(n.objLogicalRule=i,n.ruleID="",n.loadedRules=[],n.objSelectedLogicalRule=undefined,n.objEffectiveDate=[],n.objstatus=["","Active","Inactive"],n.status=n.objstatus[0],n.IsDecisionTable=!1,n.effectiveDate=n.objEffectiveDate[0],n.lstViewModel=["Developer View","Analyst View"],n.ViewMode="Developer View",n.objRuleExtraFields=undefined,n.currentfile.FileType=="LogicalRule"&&(n.activeLeftTab="Toolbox"),n.LoadUIforDesiredRule(),n.currentfile.FileType!="DecisionTable")n.ruleID=n.objLogicalRule.dictAttributes.ID,angular.forEach(n.objLogicalRule.Elements,function(t){if(t.Name=="logicalrule"){var i=t.dictAttributes.sfwEffectiveDate;i&&i.trim().length>0?n.objEffectiveDate.push(i):n.objEffectiveDate.push("Default")}else t.Name=="ExtraFields"&&(n.objRuleExtraFields=t)});else{if(n.IsDecisionTable=!0,n.ruleID=n.objLogicalRule.RuleID,f=n.objLogicalRule.ExtraFields,f&&f.length>0)for(n.objRuleExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]},u=0;u<f.length;u++)o={Name:"ExtraField",Value:"",dictAttributes:{},Elements:[]},o.dictAttributes.ID=f[u].ID,o.dictAttributes.Value=f[u].Value,o.dictAttributes.URL=f[u].URL,n.objRuleExtraFields.Elements.push(o);angular.forEach(n.objLogicalRule.Rules,function(t){var i=t.EffectiveDate;i==undefined||i==""?n.objEffectiveDate.push("Default"):n.objEffectiveDate.push(i)})}if(n.hasDefaultVersion=n.objEffectiveDate.indexOf("Default")>-1,n.objRuleExtraFields||(n.objRuleExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]}),n.sortEffectiveDates(),l=getCurrentEffectiveDate(n.objEffectiveDate),l?n.selectRuleAndScrollToEffectiveDate(l):n.selectRuleAndScrollToEffectiveDate("Default"),n.variables=GetVariablesAndParams(n.objSelectedLogicalRule,"variables",n.IsDecisionTable),n.parameters=GetVariablesAndParams(n.objLogicalRule,"parameters",n.IsDecisionTable),n.variables!=undefined&&n.variables.Elements.length>0&&(angular.forEach(n.variables.Elements,function(n){n.IsEditLocalVar=!1}),n.SelectedLocalVariable=n.variables.Elements[0]),n.IsDecisionTable){if(n.parameters!=undefined&&n.parameters.length>0&&(angular.forEach(n.parameters,function(n){n.IsEditParameter=!1}),n.SelectedParameter=n.parameters[0]),n.objSelectedLogicalRule&&n.objSelectedLogicalRule.Rows&&n.objSelectedLogicalRule.Rows.length>0&&(e=n.objSelectedLogicalRule.Rows[0],e&&e.Cells&&e.Cells.length>0&&(e.Cells[0].Item.IsSelected=!0,n.selectedDecisionTable=e.Cells[0])),r=getScopeByFileName("MainPage"),r.ErrorNode){for(h=r.ErrorNode.istrNodeID,u=0;u<n.objLogicalRule.Rules.length;u++)r.getCurrentErrorStepNodeForDecisionTable(h,n.objLogicalRule.Rules[u]);c=r.currenterrornode;n.objStepSelectionChanged(c);r.ErrorNode=""}}else if(n.parameters!=undefined&&n.parameters.Elements.length>0&&(angular.forEach(n.parameters.Elements,function(n){n.IsEditParameter=!1}),n.SelectedParameter=n.parameters.Elements[0]),n.objLogicalRule.dictAttributes.sfwRuleType=="LogicalRule"&&n.objSelectedLogicalRule&&n.objSelectedLogicalRule.Elements.length>0&&(s=n.objSelectedLogicalRule.Elements.filter(function(n){return n.Name!="variables"}),s&&s.length>0&&(s[0].IsSelected=!0,n.selectedItem=s[0])),r=getScopeByFileName("MainPage"),r.ErrorNode){h=r.ErrorNode.istrNodeID;r.getCurrentErrorStepNodeForLogicalRule(h,n.objLogicalRule);c=r.currenterrornode;n.onStepSelectChange(c);r.ErrorNode=""}n.HasRelatedParameterBasedScenario=n.objLogicalRule.objExtraData.HasRelatedParameterBasedScenario;n.HasRelatedObjectBasedScenario=n.objLogicalRule.objExtraData.HasRelatedObjectBasedScenario;n.HasRelatedXLBasedScenario=n.objLogicalRule.objExtraData.HasRelatedExcelBasedScenario;n.HasRelatedDataSourceBasedScenario=n.objLogicalRule.objExtraData.HasRelatedDataSourceBasedScenario;n.UpdateScenarioDetails();n.updateParentRules();$.connection.hubMain.server.getCustomTypes().done(function(t){n.customTypes=t});t.IsLoading=!1})};n.selectRuleAndScrollToEffectiveDate=function(t){t=t?t:"Default";n.selectRule(t);n.scrollToEffectiveDate(t)};n.scrollToEffectiveDate=function(t){var r,i;t=t?t:"Default";r=document.getElementById([n.currentfile.FileName,"_version_",t.replace("\\","")].join(""));r?r.scrollIntoView():i=setInterval(function(){var r=document.getElementById([n.currentfile.FileName,"_version_",t.replace("\\","")].join(""));r&&(r.scrollIntoView(),i&&clearInterval(i));setTimeout(function(){i&&clearInterval(i)},1e3)},100)};n.sortEffectiveDates=function(){n.objEffectiveDate=sortDates(n.objEffectiveDate)};n.canShowStartArrow=function(){if(n.objSelectedLogicalRule){var t=n.objSelectedLogicalRule.Elements.filter(function(n){return n.Name!="variables"});return t&&t.length>0?!0:!1}return!1};n.showSource=!1;n.ToggleUIDesginAttribute=function(t,i){var e=n.objLogicalRule.dictAttributes?n.objLogicalRule.dictAttributes.sfwRuleType:n.objLogicalRule.RuleType,u,f,r;if(e=="LogicalRule"&&t[0]&&t[0].Name){if(t[t.length-1].Name!="logicalrule"&&t[0].Name!="parameters"&&t[1].Name!="variables"&&t[t.length-1].Name!="ExtraField"&&t[t.length-1].Name!="ExtraFields")if(t[t.length-1].Name!="action"){if(u=t[t.length-1],t[t.length-1].Name=="parameter"||t[t.length-1].Name=="parameters")for(f=t[t.length-1],t.pop(),r=0;r<t.length;r++)if(t[r].Name=="calldecisiontable"){u=n.callRule(f,t,"calldecisiontable");break}else if(t[r].Name=="calllogicalrule"){u=n.callRule(f,t,"calllogicalrule");break}else if(t[r].Name=="callexcelmatrix"){u=n.callRule(f,t,"callexcelmatrix");break}u.isAdvanceSearched=i}else t[t.length-1].isAdvanceSearched=i}else e=="DecisionTable"&&t[0]&&t[0].Item&&(t[t.length-1].Item.isAdvanceSearched=i)};n.traverseMainModel=function(t,i){var o=[],u=n.objLogicalRule,c,h,r,e,f,s;if(t.contains("-")||t.contains(",")){c=n.objLogicalRule.dictAttributes?n.objLogicalRule.dictAttributes.sfwRuleType:n.objLogicalRule.RuleType;switch(c){case"LogicalRule":for(r=0;r<t.split(",").length;r++)t.split(",")[r].substring(0,t.split(",")[r].lastIndexOf("-"))=="items"?r!=t.split(",").length-1&&(u=FindChidrenHierarchy(u,t.split(",")[r+1].substring(t.split(",")[r+1].lastIndexOf("-")+1)),r++):u=n.FindNodeHierarchy(u,t.split(",")[r].substring(t.split(",")[r].lastIndexOf("-")+1)),u&&(u.Name=="logicalrule"&&(n.objSelectedLogicalRule=u),o.push(u));break;case"ExcelMatrix":for(r=0;r<t.split(",").length;r++)u=n.FindNodeHierarchy(u,t.split(",")[r].substring(t.split(",")[r].lastIndexOf("-")+1)),u&&(u.Name=="logicalrule"&&(n.objSelectedLogicalRule=u),o.push(u));break;case"DecisionTable":if(h=n.objLogicalRule.Rules[t.split(",")[0].substring(t.split(",")[0].lastIndexOf("-")+1)],i.length>3&&!i[0].startsWith("ExtraFields")&&!i[0].startsWith("ExtraField"))for(r=0;r<h.Rows.length;r++)for(e=h.Rows[r],f=0;f<e.Cells.length;f++)if(e.Cells[f].Item.NodeID!=undefined&&e.Cells[f].Item.ItemType!=undefined)for(s=i.length-3;s>=0;s--)e.Cells[f].Item.ItemType+'="'+e.Cells[f].Item.NodeID+'"'==i[s]&&o.push(e.Cells[f])}}return o};n.selectElement=function(i,r){var h,l,u,e,s,o,a;if(n.selectedRuleItem=[],n.objSelectedRule=undefined,n.objSelectedSwitch=undefined,n.objSelectedAction=undefined,n.objSelectedDefault=undefined,n.objSelectedDefaultAction=undefined,i!=null&&n.objLogicalRule.dictAttributes&&n.objLogicalRule.dictAttributes.sfwRuleType=="LogicalRule"&&i!="neorule"&&!i.includes("ExtraFields")&&!i.includes("ExtraField")&&(u=n.traverseMainModel(i),u[0]&&u[0].Name=="logicalrule"&&(n.selectedRuleItem.push(u[0]),u[0].dictAttributes.sfwEffectiveDate?n.selectRuleAndScrollToEffectiveDate(u[0].dictAttributes.sfwEffectiveDate):n.selectRuleAndScrollToEffectiveDate("Default")),u.length>0&&u[u.length-1].Name!="logicalrule"))if(u[0].Name=="parameters")n.IsToolsDivCollapsed=!1,n.setActiveLeftTab("Parameters"),n.setSelectedParameters(u[u.length-1],window.event);else if(u[1]&&u[1].Name=="variables")n.setSelectedLocalVar(u[u.length-1],window.event);else if(u[u.length-1].Name!="ExtraField"&&u[u.length-1].Name!="ExtraFields")if(u[u.length-1].Name!="action"){if(h=u[u.length-1],u[u.length-1].Name=="parameter"||u[u.length-1].Name=="parameters")for(l=u[u.length-1],u.pop(),e=0;e<u.length;e++)if(u[e].Name=="calldecisiontable"){h=n.callRule(l,u,"calldecisiontable");break}else if(u[e].Name=="calllogicalrule"){h=n.callRule(l,u,"calllogicalrule");break}else if(u[e].Name=="callexcelmatrix"){h=n.callRule(l,u,"callexcelmatrix");break}n.onSelectChange(h)}else if(u[u.length-1].Name=="action")n.onSelectChange(u[u.length-2]);else n.onSelectChange(u[u.length-1]);if(i==null||!n.objLogicalRule.dictAttributes||n.objLogicalRule.dictAttributes.sfwRuleType!="ExcelMatrix"||i=="neorule"||i.includes("ExtraFields")||i.includes("ExtraField")||(u=n.traverseMainModel(i),u[0]&&u[0].Name=="logicalrule"&&(u[0].dictAttributes.sfwEffectiveDate?n.selectRuleAndScrollToEffectiveDate(u[0].dictAttributes.sfwEffectiveDate):n.selectRuleAndScrollToEffectiveDate("Default")),u.length>0&&u[u.length-1].Name!="logicalrule"&&(u[0].Name=="parameters"?(n.setActiveLeftTab("Parameters"),u[u.length-1].Name!="parameters"&&n.setSelectedParameters(u[u.length-1],window.event)):u[1]&&u[1].Name=="variables"&&n.setSelectedLocalVar(u[u.length-1],window.event))),i!=null&&n.objLogicalRule.RuleType=="DecisionTable")if(i[0].startsWith("parameter")||i[0].startsWith("neorule")||i[0].startsWith("ExtraFields")||i[0].startsWith("ExtraField")||(n.objSelectedLogicalRule=n.objLogicalRule.Rules[r.split(",")[0].substring(r.split(",")[0].lastIndexOf("-")+1)],n.selectRuleAndScrollToEffectiveDate(n.objSelectedLogicalRule.EffectiveDate)),i.length>0&&i.length<4&&(i[0]=="parameters"||i[0].startsWith("parameter")))for(e=0;e<n.objLogicalRule.Parameters.length;e++)n.objLogicalRule.Parameters[e].ParamID==i[0].substring(i[0].indexOf('"')+1).replace('"',"")&&(n.IsToolsDivCollapsed=!1,n.setSelectedParameters(n.objLogicalRule.Parameters[e],window.event));else if(i.length>3&&!i[0].startsWith("ExtraFields")&&!i[0].startsWith("ExtraField"))for(e=0;e<n.objSelectedLogicalRule.Rows.length;e++)for(s=n.objSelectedLogicalRule.Rows[e],o=0;o<s.Cells.length;o++)if(s.Cells[o].Item.NodeID!=undefined&&s.Cells[o].Item.ItemType!=undefined)for(a=i.length-3;a>=0;a--)if(s.Cells[o].Item.ItemType+'="'+s.Cells[o].Item.NodeID+'"'==i[a]){n.objSelectedLogicalRule.noConditionsDisplayed<e&&(n.objSelectedLogicalRule.noConditionsDisplayed=e+1);n.onDecisionStepChange(s.Cells[o])}t.IsLoading=!1;f(function(){var t=$("#"+n.currentfile.FileName).find(".selected-node"),u,r,f;if(t&&n.objLogicalRule.dictAttributes&&n.objLogicalRule.dictAttributes.sfwRuleType=="LogicalRule"&&i!="neorule")n.selectedRuleItem.length>0&&(u=n.loadedRules.indexOf(n.selectedRuleItem[0])),t.length==1?t[0].scrollIntoView():t[u]&&t[u].scrollIntoView();else if(n.objLogicalRule&&n.objLogicalRule.RuleType=="DecisionTable")if(t=$("#"+n.currentfile.FileName).find(".decision-table-selection"),r=0,t&&t.length>0)t[r].scrollIntoView();else{function e(){var t=$("#"+n.currentfile.FileName).find(".decision-table-selection");t&&t.length>0&&(t[r].scrollIntoView&&t[r].scrollIntoView(),c.cancel(f))}f=c(e,500)}})};n.onDecisionStepChange=function(t){n.selectedDecisionTable=t;n.objLogicalRule&&n.objSelectedLogicalRule&&n.ResetAllvaluesForDecisionTable(n.objSelectedLogicalRule);t.Item&&(t.Item.IsSelected=!0)};n.ShowDesign=function(){var i,r,o,e;if(n.selectedDesignSource==!0&&(i=n.editor.getValue(),i!=null&&i!="")){if(t.IsLoading=!0,r=n.editor.selection.getCursor().row,r=r+1,i.length<32e3)hubMain.server.getRuleXmlString(i,n.currentfile.FileType,r);else{o=[];o[0]=r>0?r:1;var u="",s=[],f=0;for(e=0;e<i.length;e++)f++,u=u+i[e],f==32e3&&(f=0,s.push(u),u="");f!=0&&s.push(u);d(s,n.currentfile,"SourceToDesignForRule",o)}n.receiverulexmlobject=function(t,i,r){n.selectedDesignSource=!1;n.isSourceDirty&&(n.selectedDecisionTable=undefined,n.selectedItem=undefined,n.ResetAllvalues(n.objSelectedLogicalRule),n.receiverulemodel(t),n.isSourceDirty=!1);n.$evalAsync(n.selectElement(i,r))}}};n.isSourceDirty;n.sourceChanged=function(){n.isSourceDirty=!0;n.isDirty=!0;n.SearchSource.IsSearchCriteriaChange=!0};n.onSelectChange=function(t){n.selectedItem=t;n.SelectedParameter=undefined;n.objLogicalRule&&n.objLogicalRule.dictAttributes&&n.objSelectedLogicalRule&&n.ResetAllvalues(n.objSelectedLogicalRule);t.IsSelected=!0};n.callRule=function(t,i,r){var u;if(t&&i[i.length-1]&&i[i.length-1].Name==r)return u=i[i.length-1],i[i.length-1];if(t)i.pop(),u=n.callRule(i[i.length-1],i,r);else return u;return u};n.FindNode=function(t,i,r,u){return t&&angular.forEach(t.Elements,function(f){f.ParentVM=t;for(var e=i.length-2;e>=0;e--)f.dictAttributes.sfwNodeID!=undefined?f.Name+'="'+f.dictAttributes.sfwNodeID+'"'==i[e]&&(r[u]=f,u++,n.FindNode(f,i,r,u)):f.Name==i[e]&&(r[u]=f,u++,n.FindNode(f,i,r,u))}),r};var d=function(n,t,i,r){for(var u=0;u<n.length;u++)hubMain.server.receiveDataPackets(n[u],n.length,t,u,i,r)},it=function(n,t,i,r){for(var u=0;u<n.length;u++)hubMain.server.receiveDataPacketsForDecisionTable(n[u],n.length,u,t,i,r)},rt=function(n,t){n.Cells.filter(function(n){if(n.Item.IsSelected==!0)return t.push(n.Item),n.Item})},v,g=function(n){return n.Rules&&n.Rules.length>0?angular.forEach(n.Rules,function(t){return t.ParentVM=n,t.Rows?v=g(t):void 0}):n.Rows?angular.forEach(n.Rows,function(t){return t.ParentVM=n,t.Cells?v=g(t):void 0}):n.Cells&&n.Cells.filter(function(t){return t.ParentVM=n,t.Item.IsSelected==!0?(t.Item.ParentVM=t,v=t.Item):void 0}),v},st=function(t,i){for(var r=n.objLogicalRule;t.ParentVM;)t.ParentVM.Cells&&t.ParentVM.Cells.length>0?i.push(t.ParentVM.Cells.indexOf(t)):t.ParentVM.Rows&&t.ParentVM.Rows.length>0?i.push(t.ParentVM.Rows.indexOf(t)):t.ParentVM.Rules&&t.ParentVM.Rules.length>0&&i.push(t.ParentVM.Rules.indexOf(t)),t=t.ParentVM;return i};n.ShowSource=function(){var o,e,u,p,s,l,f,r,v;if(n.selectedDesignSource==!1&&(n.showSource=!0,n.selectedDesignSource=!0,$("#dvBuildResults").is(":visible")&&hideBuildResults(),e=[],n.objLogicalRule!=null&&n.objLogicalRule!=undefined)){t.IsLoading=!0;p=n.currentfile.FileType=="DecisionTable"?n.objLogicalRule:GetBaseModel(n.objLogicalRule);var c=JSON.stringify(p),i=[];if(n.currentfile.FileType=="DecisionTable"?n.selectedDecisionTable!=undefined?(i[0]=n.selectedDecisionTable.Item.NodeID,f=n.objSelectedLogicalRule.DataHeaders.filter(function(n){return n.IsSelected}),l=n.objLogicalRule.Rules.indexOf(n.objSelectedLogicalRule),f.length==0?(s=[],f=n.objSelectedLogicalRule.Rows.filter(function(n){return rt(n,s)}),s.length>0&&(i[0]=s[0].NodeID,s[0].IsSelected=!1)):i[0]=f[0].NodeID,i[0]=i[0]+"~"+l):(l=n.objLogicalRule.Rules.indexOf(n.objSelectedLogicalRule),i[0]="~"+l):(f=n.FindSelectedNode(n.objSelectedLogicalRule),f&&f.IsSelected?(r=[],o=n.FindDeepNode(n.objLogicalRule,f,r),u=n.getPathSource(n.objLogicalRule,r,e),angular.copy(u,i)):(r=[],o=n.FindDeepNode(n.objLogicalRule,n.objSelectedLogicalRule,r),u=n.getPathSource(n.objLogicalRule,r,e),angular.copy(u,i)),n.SelectedParameter!=undefined&&n.activeLeftTab=="Parameters"?(r=[],o=undefined,e=[],o=n.FindDeepNode(n.objLogicalRule,n.SelectedParameter,r),u=n.getPathSource(n.objLogicalRule,r,e),angular.copy(u,i)):n.SelectedLocalVariable!=undefined&&n.IsLocalVariableVisible==!0&&(o=undefined,e=[],o=n.FindDeepNode(n.objLogicalRule,n.SelectedLocalVariable,r),u=n.getPathSource(n.objLogicalRule,r,e),angular.copy(u,i))),i.length==0&&(i[0]=""),c.length<32e3)hubMain.server.getRuleXmlObject(c,n.currentfile,i);else{var h="",y=[],a=0;for(v=0;v<c.length;v++)a++,h=h+c[v],a==32e3&&(a=0,y.push(h),h="");a!=0&&y.push(h);d(y,n.currentfile,"DesignToSourceForRule",i)}n.receiverulexml=function(i,r){n.$apply(function(){n.xmlSource=i;var u=n.currentfile.FileName;setDataToEditor(n,i,r,u);n.$evalAsync(function(){t.IsLoading=!1;n.selectedDecisionTable=undefined;n.ResetAllvalues(n.objSelectedLogicalRule)})})}}};n.FindSelectedNode=function(t){return t&&(t.Elements.length>0&&angular.forEach(t.Elements,function(t){return t.IsSelected==!0?a=t:t.Elements&&t.Elements.length>0||t.Children&&t.Children.length>0?a=n.FindSelectedNode(t):void 0}),t.Children&&t.Children.length>0&&angular.forEach(t.Children,function(t){return t.IsSelected==!0?a=t:t.Elements&&t.Elements.length>0||t.Children&&t.Children.length>0?a=n.FindSelectedNode(t):void 0})),a};n.FindDeepNode=function(t,i,r){return t&&(t.Elements&&t.Elements.length>0&&angular.forEach(t.Elements,function(t){var u=n.isValidObject(t,i);return(u&&r.push(t),t==i)?i:t.Elements&&t.Elements.length>0||t.Children&&t.Children.length>0?i=n.FindDeepNode(t,i,r):void 0}),t.Children&&t.Children.length>0&&angular.forEach(t.Children,function(t){var u=n.isValidObject(t,i);return(u&&r.push(t),t==i)?i:t.Elements&&t.Elements.length>0||t.Children&&t.Children.length>0?i=n.FindDeepNode(t,i,r):void 0})),i};n.FindNodeHierarchy=function(n,t){if(n&&n.Elements)return n.Elements[t]};n.getPathSource=function(n,t,i){for(var u,r=0;r<t.length;r++)r==0?(u=n.Elements.indexOf(t[r]),i.push("elements-"+u)):(u=t[r-1].Elements.indexOf(t[r]),u==-1?(u=t[r-1].Children.indexOf(t[r]),i.push("children-"+u)):i.push("elements-"+u));return i};n.isValidObject=function(t,i){var u,f,e,r;if(t==i)return!0;if(t.Elements&&t.Elements.length>0)for(f=0;f<t.Elements.length;f++){if(t.Elements[f]==i)return!0;if(t.Elements[f].Elements&&t.Elements[f].Elements.length>0)for(r=0;r<t.Elements[f].Elements.length;r++)if(u=n.isValidObject(t.Elements[f].Elements[r],i),u==!0)return u;if(t.Elements[f].Children&&t.Elements[f].Children.length>0)for(r=0;r<t.Elements[f].Children.length;r++)if(u=n.isValidObject(t.Elements[f].Children[r],i),u==!0)return u}if(t.Children&&t.Children.length>0)for(e=0;e<t.Children.length;e++){if(t.Children[e]==i)return!0;if(t.Children[e].Elements&&t.Children[e].Elements.length>0)for(r=0;r<t.Children[e].Elements.length;r++)if(u=n.isValidObject(t.Children[e].Elements[r],i),u==!0)return u;if(t.Children[e].Children&&t.Children[e].Children.length>0)for(r=0;r<t.Children[e].Children.length;r++)if(u=n.isValidObject(t.Children[e].Children[r],i),u==!0)return u}return u};n.setActiveLeftTab=function(t){n.activeLeftTab=t};n.setViewMode=function(i){n.ViewMode=i;i=="Analyst View"?$("#"+t.currentopenfile.file.FileName).find(".hidden-span-expression").hide():$("#"+t.currentopenfile.file.FileName).find(".hidden-span-expression").show()};n.selectRule=function(i,r){var u;n.IsDecisionTable?(u=n.loadedRules.filter(function(n){return n.EffectiveDate==i||i=="Default"&&!n.EffectiveDate}),u&&u.length>0?r?t.EditPropertyValue(n.objSelectedLogicalRule,n,"objSelectedLogicalRule",u[0]):n.objSelectedLogicalRule=u[0]:(u=n.objLogicalRule.Rules.filter(function(n){return n.EffectiveDate==i||i=="Default"&&!n.EffectiveDate}),u&&u.length>0&&(u[0].noConditionsDisplayed=30,r?(t.EditPropertyValue(n.objSelectedLogicalRule,n,"objSelectedLogicalRule",u[0]),t.PushItem(u[0],n.loadedRules)):(n.objSelectedLogicalRule=u[0],n.loadedRules.push(u[0]))))):(u=n.loadedRules.filter(function(n){return n.dictAttributes.sfwEffectiveDate==i||i=="Default"&&!n.dictAttributes.sfwEffectiveDate}),u&&u.length>0?r?t.EditPropertyValue(n.objSelectedLogicalRule,n,"objSelectedLogicalRule",u[0]):n.objSelectedLogicalRule=u[0]:(u=n.objLogicalRule.Elements.filter(function(n){return n.Name=="logicalrule"&&(n.dictAttributes.sfwEffectiveDate==i||i=="Default"&&!n.dictAttributes.sfwEffectiveDate)}),u&&u.length>0&&(r?(t.EditPropertyValue(n.objSelectedLogicalRule,n,"objSelectedLogicalRule",u[0]),t.PushItem(u[0],n.loadedRules)):(n.objSelectedLogicalRule=u[0],n.loadedRules.push(u[0])))));r?(t.EditPropertyValue(n.selectedEffectiveDate,n,"selectedEffectiveDate",i),t.EditPropertyValue(n.variables,n,"variables",GetVariablesAndParams(n.objSelectedLogicalRule,"variables",n.IsDecisionTable))):(n.selectedEffectiveDate=i,n.variables=GetVariablesAndParams(n.objSelectedLogicalRule,"variables",n.IsDecisionTable));n.updateChildRules(r);n.objLogicalRule.dictAttributes&&n.objLogicalRule.dictAttributes.sfwRuleType=="ExcelMatrix"&&(n.objSelectedLogicalRule.objColumnValues||n.prepareExcelMatrix())};n.SelectLogicalRule=function(t){var r,i;if(t)if(n.objLogicalRule.dictAttributes)for(r=t.dictAttributes.sfwEffectiveDate,i=0;i<n.objLogicalRule.Elements.length;i++)n.objLogicalRule.Elements[i].Name=="logicalrule"&&(n.objLogicalRule.Elements[i].dictAttributes.sfwEffectiveDate==r?(n.objSelectedLogicalRule=n.objLogicalRule.Elements[i],n.updateChildRules(),n.objLogicalRule.dictAttributes.sfwRuleType=="ExcelMatrix"&&n.prepareExcelMatrix(),n.variables=GetVariablesAndParams(n.objSelectedLogicalRule,"variables",n.IsDecisionTable),angular.forEach(n.variables.Elements,function(n){n.IsEditLocalVar=!1})):(n.objLogicalRule.Elements[i].dictAttributes.sfwEffectiveDate==undefined||n.objLogicalRule.Elements[i].dictAttributes.sfwEffectiveDate==""||n.objLogicalRule.Elements[i].dictAttributes.sfwEffectiveDate=="Default")&&(r==undefined||r==""||r=="Default")&&(n.objSelectedLogicalRule=n.objLogicalRule.Elements[i],n.updateChildRules(),n.variables=GetVariablesAndParams(n.objSelectedLogicalRule,"variables",n.IsDecisionTable),angular.forEach(n.variables.Elements,function(n){n.IsEditLocalVar=!1})));else if(n.objLogicalRule.dictAttributes==undefined)for(r=t.EffectiveDate,i=0;i<n.objLogicalRule.Rules.length;i++)n.objLogicalRule.Rules[i].EffectiveDate==r?n.objSelectedLogicalRule=n.objLogicalRule.Rules[i]:(n.objLogicalRule.Rules[i].EffectiveDate==undefined||n.objLogicalRule.Rules[i].EffectiveDate==""||n.objLogicalRule.Rules[i].EffectiveDate=="Default")&&(r==undefined||r==""||r=="Default")&&(n.objSelectedLogicalRule=n.objLogicalRule.Rules[i]),n.updateChildRules()};n.SetClass=function(n,t){if(n==t)return"active"};n.receiveEntityBusinessObject=function(t){n.IsBusObjPresent=!0;n.objLogicalRule.dictAttributes?(n.objLogicalRule.dictAttributes.sfwRuleType!="ExcelMatrix"&&t&&(n.CanCreateObjectBasedScenario=!0),$.connection.hubRuleModel.server.getEntityBusinessObjectMethods(t).done(function(t){n.businessObjectMethods=t}),(n.objLogicalRule.dictAttributes.sfwStatic&&n.objLogicalRule.dictAttributes.sfwStatic.toLowerCase()=="true"||!t)&&(n.ShowMethod=!1)):(t&&(n.CanCreateObjectBasedScenario=!0),$.connection.hubRuleModel.server.getEntityBusinessObjectMethods(t).done(function(t){n.businessObjectMethods=t}),(n.objLogicalRule.Static&&n.objLogicalRule.Static.toLowerCase()=="true"||!t)&&(n.ShowMethod=!1))};n.canSaveFile=function(){var r=!0,i;return y&&(i=t.lstopenedfiles.filter(function(t){return(t.file.FileName.startsWith("rsn")||t.file.FileName.startsWith("rso"))&&t.file.FileName.substring(3)==n.currentfile.FileName.substring(3)}).filter(function(n){var t=getScopeByFileName(n.file.FileName);return t&&t.isDirty}).map(function(n){return"'"+n.file.FileName+"'"}),i&&i.length>0&&(alert("Please save following files before saving this rule.\n\n"+i.join("\n")),r=!1)),r};n.BeforeSaveToFile=function(){n.addExtraFieldsDataInToMainModel()};n.AfterSaveToFile=function(){if(!y&&n.objLogicalRule){var t="";t=!n.IsDecisionTable&&n.objLogicalRule.dictAttributes?n.objLogicalRule.dictAttributes.sfwEntity:n.objLogicalRule.Entity;n.UpdateIntellisenseListAttributesAfterSave(t)}};n.UpdateIntellisenseListAttributesAfterSave=function(t){var e="",r,i,f;for(e=n.IsDecisionTable?n.objLogicalRule.RuleID:n.objLogicalRule.dictAttributes.ID,r=u.getEntityIntellisense(),i=0;i<r.length;i++)if(r[i].ID==t){if(r[i].Rules.length>0)for(f=0;f<r[i].Rules.length;f++)r[i].Rules[f].ID==e&&(intellisenseruleobject=r[i].Rules[f],intellisenseruleobject.Parameters=[],n.IsDecisionTable?(intellisenseruleobject.IsStatic=n.objLogicalRule.Static!=undefined&&n.objLogicalRule.Static.toLowerCase()=="true"?!0:!1,intellisenseruleobject.ReturnType=n.objLogicalRule.ReturnType,intellisenseruleobject.Status=n.objLogicalRule.Status,intellisenseruleobject.IsPrivate=n.objLogicalRule.Private!=undefined&&n.objLogicalRule.Private.toLowerCase()=="true"?!0:!1,angular.forEach(n.objLogicalRule.Parameters,function(n){var t={ID:n.ParamID,DisplayName:n.ParamID,Value:n.ParamID,Tooltip:n.ParamID,DataType:n.DataType,Direction:n.Direction,Entity:n.Entity};intellisenseruleobject.Parameters.push(t)})):(intellisenseruleobject.IsStatic=n.objLogicalRule.dictAttributes.sfwStatic!=undefined&&n.objLogicalRule.dictAttributes.sfwStatic.toLowerCase()=="true"?!0:!1,intellisenseruleobject.ReturnType=n.objLogicalRule.dictAttributes.sfwReturnType,intellisenseruleobject.Status=n.objLogicalRule.dictAttributes.sfwStatus,intellisenseruleobject.IsPrivate=n.objLogicalRule.dictAttributes.sfwPrivate!=undefined&&n.objLogicalRule.dictAttributes.sfwPrivate.toLowerCase()=="true"?!0:!1,angular.forEach(n.objLogicalRule.Elements,function(n){n.Name=="parameters"&&angular.forEach(n.Elements,function(n){if(n.Name=="parameter"){var t={ID:n.dictAttributes.ID,DisplayName:n.dictAttributes.ID,Value:n.dictAttributes.ID,Tooltip:n.dictAttributes.ID,DataType:n.dictAttributes.sfwDataType,Direction:n.dictAttributes.sfwDirection,Entity:n.dictAttributes.sfwEntity};intellisenseruleobject.Parameters.push(t)}})})));break}};n.onStepSelectChange=function(n){var t=getCurrentFileScope();t.objLogicalRule&&t.objLogicalRule.dictAttributes&&t.objSelectedLogicalRule&&t.ResetAllvalues(t.objSelectedLogicalRule);n.IsSelected=!0};n.objStepSelectionChanged=function(n){var t=getCurrentFileScope();t.objLogicalRule&&t.objSelectedLogicalRule&&t.ResetAllvaluesForDecisionTable(t.objSelectedLogicalRule);n.Item&&(n.Item.IsSelected=!0)};n.openEntityFile=function(){n.objLogicalRule.dictAttributes?$.connection.hubMain.server.navigateToFile(n.objLogicalRule.dictAttributes.sfwEntity,"").done(function(n){t.openFile(n,!1)}):$.connection.hubMain.server.navigateToFile(n.objLogicalRule.Entity,"").done(function(n){t.openFile(n,!1)})};n.NewVersion=function(){var i=n.$new(),r;i.objDummyRule={};i.objDummyRule.effectiveDatePicker="";i.objDummyRule.description="";i.objDummyRule.status=n.objstatus[0];i.objDummyRule.chkCopyCurrentRule=!1;i.objDummyRule.chkDefaultVersion=!1;i.objDummyRule.IsOkDisable=!0;i.CancelNewVersion=function(){n.CancelNewVersion(i)};i.getDisableValue=function(){return n.getDisableValue(i)};i.isValidVersion=function(){n.getDisableValue(i)};i.AddLogicalRule=function(){n.AddLogicalRule(i)};r=t.showDialog(i,"Add New Version","Rule/views/AddNewVersion.html");ComponentsPickers.init();n.CancelNewVersion=function(){r.close()};i.isValidVersion()};n.EditEffectiveDateDailog=function(){var i=n.$new();i.hasDefaultVersion=n.hasDefaultVersion;i.Init=function(){function t(n){i.objEditSelectedRule.EffectiveDate!=n&&n!="Default"&&i.objEditSelectedRule.lstEffectiveDate.push(n)}i.objEditSelectedRule={};i.objEditSelectedRule.IsDefaultVersion=!1;i.objEditSelectedRule.lstEffectiveDate=[];i.objEditSelectedRule.IsDefault=!1;n.objSelectedLogicalRule.dictAttributes!=undefined?n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate==undefined||n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate==""?(i.objEditSelectedRule.IsDefaultVersion=!0,i.objEditSelectedRule.IsDefault=!0):i.objEditSelectedRule.EffectiveDate=n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate:n.objSelectedLogicalRule.dictAttributes==undefined&&(n.objSelectedLogicalRule.EffectiveDate==undefined||n.objSelectedLogicalRule.EffectiveDate==""?(i.objEditSelectedRule.IsDefaultVersion=!0,i.objEditSelectedRule.IsDefault=!0):i.objEditSelectedRule.EffectiveDate=n.objSelectedLogicalRule.EffectiveDate);angular.forEach(n.objEffectiveDate,t)};i.ValidateEffectiveDate=function(){var t=!1;return i.objEditSelectedRule.ErrorMsgForDisplay="",i.objEditSelectedRule.IsDefault?i.objEditSelectedRule.EffectiveDate?i.objEditSelectedRule.lstEffectiveDate.some(function(n){return n==i.objEditSelectedRule.EffectiveDate&&n!=i.objEditSelectedRule.SelectDefaultVersion})?(t=!0,i.objEditSelectedRule.ErrorMsgForDisplay="Duplicate Effective Date."):i.objEditSelectedRule.SelectDefaultVersion||(t=!0,i.objEditSelectedRule.ErrorMsgForDisplay="Select Rule to set as Default."):i.objEditSelectedRule.IsDefaultVersion||(t=!0,i.objEditSelectedRule.ErrorMsgForDisplay="Select Effective Date."):n.hasDefaultVersion&&(i.objEditSelectedRule.EffectiveDate?i.objEditSelectedRule.lstEffectiveDate.some(function(n){return n==i.objEditSelectedRule.EffectiveDate})&&(t=!0,i.objEditSelectedRule.ErrorMsgForDisplay="Duplicate Effective Date."):(i.objEditSelectedRule.ErrorMsgForDisplay="Select Effective Date for Default version.",t=!0)),t};i.onOkClick=function(){var r,u;i.objEditSelectedRule.IsDefault?i.objEditSelectedRule.IsDefaultVersion||(t.UndRedoBulkOp("Start"),n.objSelectedLogicalRule.dictAttributes!=undefined?(n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate==undefined||n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate=="")&&(r=n.objLogicalRule.Elements.filter(function(n){return n.dictAttributes.sfwEffectiveDate==i.objEditSelectedRule.SelectDefaultVersion}),t.EditPropertyValue(n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate,n.objSelectedLogicalRule.dictAttributes,"sfwEffectiveDate",i.objEditSelectedRule.EffectiveDate),r&&r.length>0&&t.EditPropertyValue(r[0].dictAttributes.sfwEffectiveDate,r[0].dictAttributes,"sfwEffectiveDate","")):n.objSelectedLogicalRule.dictAttributes==undefined&&(n.objSelectedLogicalRule.EffectiveDate==undefined||n.objSelectedLogicalRule.EffectiveDate=="")&&(r=n.objLogicalRule.Rules.filter(function(n){return n.EffectiveDate==i.objEditSelectedRule.SelectDefaultVersion}),t.EditPropertyValue(n.objSelectedLogicalRule.EffectiveDate,n.objSelectedLogicalRule,"EffectiveDate",i.objEditSelectedRule.EffectiveDate),r&&r.length>0&&t.EditPropertyValue(r[0].EffectiveDate,r[0],"EffectiveDate","")),u=n.objEffectiveDate.indexOf(i.objEditSelectedRule.SelectDefaultVersion),t.DeleteItem(n.objEffectiveDate[u],n.objEffectiveDate),t.InsertItem("Default",n.objEffectiveDate,u),u=n.objEffectiveDate.indexOf(n.selectedEffectiveDate),t.DeleteItem(n.objEffectiveDate[u],n.objEffectiveDate),t.InsertItem(i.objEditSelectedRule.EffectiveDate,n.objEffectiveDate,u),t.EditPropertyValue(n.selectedEffectiveDate,n,"selectedEffectiveDate",i.objEditSelectedRule.EffectiveDate),t.UndRedoBulkOp("End")):i.objEditSelectedRule.IsDefaultVersion?(t.UndRedoBulkOp("Start"),n.objSelectedLogicalRule.dictAttributes!=undefined?n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate&&(r=n.objLogicalRule.Elements.filter(function(n){return n.Name=="logicalrule"&&!n.dictAttributes.sfwEffectiveDate}),t.EditPropertyValue(n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate,n.objSelectedLogicalRule.dictAttributes,"sfwEffectiveDate",""),t.EditPropertyValue(n.objSelectedLogicalRule.dictAttributes.sfwStatus,n.objSelectedLogicalRule.dictAttributes,"sfwStatus",""),r&&r.length>0&&t.EditPropertyValue(r[0].dictAttributes.sfwEffectiveDate,r[0].dictAttributes,"sfwEffectiveDate",i.objEditSelectedRule.EffectiveDate)):n.objSelectedLogicalRule.dictAttributes==undefined&&n.objSelectedLogicalRule.EffectiveDate&&(r=n.objLogicalRule.Rules.filter(function(n){return!n.EffectiveDate}),t.EditPropertyValue(n.objSelectedLogicalRule.EffectiveDate,n.objSelectedLogicalRule,"EffectiveDate",""),t.EditPropertyValue(n.objSelectedLogicalRule.Status,n.objSelectedLogicalRule,"Status",""),r&&r.length>0&&t.EditPropertyValue(r[0].EffectiveDate,r[0],"EffectiveDate",i.objEditSelectedRule.EffectiveDate)),u=n.objEffectiveDate.indexOf("Default"),u>-1&&(t.DeleteItem(n.objEffectiveDate[u],n.objEffectiveDate),t.InsertItem(i.objEditSelectedRule.EffectiveDate,n.objEffectiveDate,u)),u=n.objEffectiveDate.indexOf(n.selectedEffectiveDate),t.DeleteItem(n.objEffectiveDate[u],n.objEffectiveDate),t.InsertItem("Default",n.objEffectiveDate,u),t.EditPropertyValue(n.selectedEffectiveDate,n,"selectedEffectiveDate","Default"),n.hasDefaultVersion||t.EditPropertyValue(n.hasDefaultVersion,n,"hasDefaultVersion",!0),t.UndRedoBulkOp("End")):(t.UndRedoBulkOp("Start"),u=n.objEffectiveDate.indexOf(n.selectedEffectiveDate),n.objSelectedLogicalRule.dictAttributes!=undefined?t.EditPropertyValue(n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate,n.objSelectedLogicalRule.dictAttributes,"sfwEffectiveDate",i.objEditSelectedRule.EffectiveDate):t.EditPropertyValue(n.objSelectedLogicalRule.EffectiveDate,n.objSelectedLogicalRule,"EffectiveDate",i.objEditSelectedRule.EffectiveDate),t.DeleteItem(n.objEffectiveDate[u],n.objEffectiveDate),t.InsertItem(i.objEditSelectedRule.EffectiveDate,n.objEffectiveDate,u),t.EditPropertyValue(n.selectedEffectiveDate,n,"selectedEffectiveDate",i.objEditSelectedRule.EffectiveDate),t.UndRedoBulkOp("End"));i.CloseDialog()};i.CloseDialog=function(){i.dialog&&i.dialog.close()};i.onChangeDefaultVersion=function(){i.objEditSelectedRule.EffectiveDate="";i.objEditSelectedRule.SelectDefaultVersion=""};i.Init();i.dialog=t.showDialog(i,"Edit Effective Date","Rule/views/EditEffectiveDate.html",{width:550,height:400});ComponentsPickers.init()};n.getDisableValue=function(t){var r=!1,i,u;if(t.objDummyRule.IsOkDisable=!1,t.objDummyRule.errorMessage="",t.objDummyRule.chkDefaultVersion){if(t.objDummyRule.chkDefaultVersion){for(t.objDummyRule.effectiveDatePicker="",i=!1,u=0;u<n.objEffectiveDate.length;u++)if(n.objEffectiveDate[u]==undefined||n.objEffectiveDate[u]==""||n.objEffectiveDate[u]=="Default"){i=!0;t.objDummyRule.errorMessage="Default version already exists.";t.objDummyRule.IsOkDisable=i;r=i;break}i||(t.objDummyRule.effectiveDatePicker="",t.objDummyRule.IsOkDisable=i,r=i)}}else t.objDummyRule.effectiveDatePicker==undefined||t.objDummyRule.effectiveDatePicker==""?(t.objDummyRule.IsOkDisable=!0,t.objDummyRule.errorMessage="Effective Date cannot be empty.",r=!0):n.objLogicalRule.Elements==undefined&&n.objLogicalRule.RuleType=="DecisionTable"?angular.forEach(n.objLogicalRule.Rules,function(n){n.EffectiveDate==t.objDummyRule.effectiveDatePicker&&(t.objDummyRule.IsOkDisable=!0,t.objDummyRule.errorMessage="Version with same effective date already exists.",r=!0)}):angular.forEach(n.objLogicalRule.Elements,function(n){n.Name=="logicalrule"&&n.dictAttributes.sfwEffectiveDate==t.objDummyRule.effectiveDatePicker&&(t.objDummyRule.IsOkDisable=!0,t.objDummyRule.errorMessage="Version with same effective date already exists.",r=!0)});return r};n.AddLogicalRule=function(i){var u,e,o,r,p,s,l,a,w,y,f;if(u=i.objDummyRule.chkDefaultVersion?"":i.objDummyRule.effectiveDatePicker,e=i.objDummyRule.description,o=i.objDummyRule.status,i.objDummyRule.chkCopyCurrentRule)if(n.objSelectedLogicalRule.dictAttributes)p=JSON.stringify(n.objSelectedLogicalRule),r=resetNodeIds(JSON.parse(p)),r.NodeID=generateUUID();else if(s=JSON.stringify(n.objSelectedLogicalRule),s.length<32e3)$.connection.hubMain.server.refreshNodeIdsForDT(s,e,u,o);else{var h="",v=[],c=0;for(l=0;l<s.length;l++)c++,h=h+s[l],c==32e3&&(c=0,v.push(h),h="");c!=0&&v.push(h);it(v,e,u,o)}else n.objLogicalRule.dictAttributes==undefined?n.objLogicalRule.RuleType=="DecisionTable"&&(r={Rows:[],DataHeaders:[]},r.NodeID=generateUUID(),a=generateUUID(),w={Description:"",Expression:"",ItemType:"dataheader",NodeID:a},r.DataHeaders.push(w),f={Cells:[]},y=generateUUID(),cell={Colspan:1,Rowspan:1,Item:{Description:"",Expression:"",ItemType:"rowheader",NodeID:y}},f.Cells.push(cell),cell={Colspan:1,Rowspan:1,Item:{Description:"",Expression:"",ItemType:"assignheader",NodeID:generateUUID(),DataHeaderID:a}},f.Cells.push(cell),r.Rows.push(f),f={Cells:[]},cell={Colspan:1,Rowspan:1,Item:{Description:"",Expression:"",ItemType:"if",NodeID:generateUUID(),HeaderID:y}},f.Cells.push(cell),cell={Colspan:1,Rowspan:1,Item:{Description:"",Expression:"",ItemType:"assign",NodeID:generateUUID(),DataHeaderID:a}},f.Cells.push(cell),r.Rows.push(f)):r={Name:"logicalrule",value:"",dictAttributes:{sfwNodeID:generateUUID()},Elements:[],Children:[]};t.UndRedoBulkOp("Start");r&&(n.objLogicalRule.dictAttributes!=undefined?(r.dictAttributes.Text=e,r.dictAttributes.sfwStatus=o,r.dictAttributes.sfwEffectiveDate=u,t.PushItem(r,n.objLogicalRule.Elements,"SelectLogicalRule")):(r.Description=e,r.Status=o,r.EffectiveDate=u,t.PushItem(r,n.objLogicalRule.Rules,"SelectLogicalRule")),t.PushItem(u?u:"Default",n.objEffectiveDate),n.selectRule(u?u:"Default",!0),n.effectiveDate=u,t.UndRedoBulkOp("End"),i.objDummyRule.effectiveDatePicker=null,i.objDummyRule.description=null,i.objDummyRule.status=n.objstatus[0],i.objDummyRule.chkCopyCurrentRule=!1,i.objDummyRule.chkDefaultVersion=!1,n.objSelectedLogicalRule!=undefined&&(n.variables=GetVariablesAndParams(n.objSelectedLogicalRule,"variables",!1),n.variables!=undefined&&angular.forEach(n.variables.Elements,function(n){n.IsEditLocalVar=!1})));i.CancelNewVersion()};n.DeleteLogicalRule=function(i){var e,f,r,u;if(i=="Default"){alert("Cannot Delete the Default Rule ");return}e=confirm(String.format("Do you want to delete rule version '{0}'?",i));e&&(n.objLogicalRule.dictAttributes!=undefined?(r=n.objLogicalRule.Elements.filter(function(n){return n.Name=="logicalrule"&&n.dictAttributes.sfwEffectiveDate==i}),r&&r.length>0&&(t.UndRedoBulkOp("Start"),u=n.objEffectiveDate.indexOf(i),t.DeleteItem(r[0],n.objLogicalRule.Elements,null),f=n.loadedRules.filter(function(n){return n.dictAttributes.sfwEffectiveDate==i}),f&&f.length>0&&t.DeleteItem(f[0],n.loadedRules,null),t.DeleteItem(i,n.objEffectiveDate),u>0?n.selectRule(n.objEffectiveDate[u-1],!0):n.selectRule(n.objEffectiveDate[u],!0),t.UndRedoBulkOp("End"))):n.objLogicalRule.dictAttributes==undefined&&(r=n.objLogicalRule.Rules.filter(function(n){return n.EffectiveDate==i}),r&&r.length>0&&(t.UndRedoBulkOp("Start"),u=n.objEffectiveDate.indexOf(i),t.DeleteItem(r[0],n.objLogicalRule.Rules,null),n.loadedRules.indexOf(r[0])>0&&t.DeleteItem(r[0],n.loadedRules,null),t.DeleteItem(i,n.objEffectiveDate),u>0?n.selectRule(n.objEffectiveDate[u-1],!0):n.selectRule(n.objEffectiveDate[u],!0),t.UndRedoBulkOp("End"))))};n.recieveRefreshNodeIds=function(i){n.$apply(function(){var r=JSON.parse(i);t.PushItem(r,n.objLogicalRule.Rules,"SelectLogicalRule");t.PushItem(r.EffectiveDate?r.EffectiveDate:"Default",n.objEffectiveDate);n.selectRule(r.EffectiveDate?r.EffectiveDate:"Default",!0)})};n.ExportToExcel=function(i){var r,e;if(t.IsLoading=!0,r=JSON.stringify(n.objLogicalRule),r.length<32e3)i?$.connection.hubRuleModel.server.exportExcelMatrix(r,n.selectedEffectiveDate):$.connection.hubRuleModel.server.exportToExcel(r,n.selectedEffectiveDate);else{var u="",o=[],f=0;for(e=0;e<r.length;e++)f++,u=u+r[e],f==32e3&&(f=0,o.push(u),u="");f!=0&&o.push(u);nt(o,i)}};nt=function(t,i){for(var r=0;r<t.length;r++)$.connection.hubRuleModel.server.receiveDataPacketsForExportExcel(t[r],t.length,r,n.selectedEffectiveDate,i)};n.buildRule=function(i){n.objLogicalRule.dictAttributes==undefined?(t.IsLoading=!0,$.connection.hubRuleModel.server.getRuleBuildResult(n.objLogicalRule.RuleID,i).done(function(n){t.receiveRuleBuildResult(n)})):(t.IsLoading=!0,$.connection.hubRuleModel.server.getRuleBuildResult(n.objLogicalRule.dictAttributes.ID,i).done(function(n){t.receiveRuleBuildResult(n)}))};n.openRuleInExpression=function(i){n.objLogicalRule.dictAttributes==undefined?$.connection.hubRuleModel.server.getRuleExpression(n.objLogicalRule.RuleID,n.objSelectedLogicalRule.EffectiveDate,i,!1,t.currentopenfile.file.FileName):$.connection.hubRuleModel.server.getRuleExpression(n.objLogicalRule.dictAttributes.ID,n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate,i,!1,t.currentopenfile.file.FileName)};n.loadChildRuleInExpression=function(t){t.HasChildRules&&!t.IsExpanded&&t.lstChildren.length==0&&n.objLogicalRule.dictAttributes&&$.connection.hubRuleModel.server.getRuleExpression(t.RuleID,"",t.IsObjectRule,!0);t.IsExpanded=!t.IsExpanded};n.receiveRuleExpression=function(i,r,u){n.$apply(function(){var f=n.$new(!0),o,e,s;r?n.SelectedRuleInExpression&&(o=JSON.parse(i),n.SearchParentRuleForExpression(u,o,n.SelectedRuleInExpression)):(e=JSON.parse(i),f.lstRuleInExpression=[],f.lstRuleInExpression.push(e),n.SelectedRuleInExpression=e,n.SelectedRuleInExpression.IsWithOutTracing="WithoutTracing",n.SelectedRuleInExpression.SelectedEffectiveDate=e.lstExpressions[0],s=t.showDialog(f,"Rule In Expression","Rule/views/RuleInExpression.html",{width:800,height:600}),f.CloseDialog=function(){s.close()},f.getClassForRuleInExpression=function(t){return n.SelectedRuleInExpression==t?"selected":""},f.onSelectRuleInExpression=function(t,i){n.SelectedRuleInExpression=t;n.SelectedRuleInExpression.SelectedEffectiveDate=t.lstExpressions[0];i.stopPropagation()},f.loadChildRuleInExpression=function(i){i.HasChildRules&&!i.IsExpanded&&i.lstChildren.length==0&&n.objLogicalRule.dictAttributes&&$.connection.hubRuleModel.server.getRuleExpression(i.RuleID,"",i.IsObjectRule,!0,t.currentopenfile.file.FileName);i.IsExpanded=!i.IsExpanded})})};n.SearchParentRuleForExpression=function(t,i,r){r.RuleID==t?r.lstChildren=i:angular.forEach(r.lstChildren,function(r){n.SearchParentRuleForExpression(t,i,r)})};n.onSelectRuleInExpression=function(t,i){n.SelectedRuleInExpression=t;n.SelectedRuleInExpression.SelectedEffectiveDate=t.lstExpressions[0];i.stopPropagation()};n.selectRuleInExpressionXml=function(){var n=i.getOpenDialogs(),t;n.length>0&&(t=$("div[id="+n[n.length-1]+"]").find("#txtruleInExpression"),t[0].value=xmlstring,tt=CodeMirror.fromTextArea(t[0],{mode:"application/xml",styleActiveLine:!0,lineNumbers:!0,foldGutter:!0,autofocus:!0,readonly:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],lineWrapping:!1}))};n.getClassForRuleInExpression=function(t){if(n.SelectedRuleInExpression==t)return"selected"};n.AddLocalVariable=function(){n.OnLocalVarEdit({Name:"variable",value:"",dictAttributes:{},Elements:[]},!0)};n.deleteLocalVariable=function(){};n.RemoveLocalVariable=function(i,r){var f,u;n.SelectedLocalVariable=i;f=!0;r||(f=confirm("Local Variable : '"+n.SelectedLocalVariable.dictAttributes.ID+"'   will be deleted, Do you want to continue?"));f&&(u=n.variables.Elements.indexOf(n.SelectedLocalVariable),t.DeleteItem(n.SelectedLocalVariable,n.variables.Elements),u<n.variables.Elements.length?n.SelectedLocalVariable=n.variables.Elements[u]:n.variables.Elements.length>0&&(n.SelectedLocalVariable=n.variables.Elements[u-1]))};n.setSelectedLocalVar=function(t){n.SelectedLocalVariable=t;angular.forEach(n.variables.Elements,function(n){n!=t&&(n.IsEditLocalVar=!1)})};n.getClassForLocalVar=function(t){if(t==n.SelectedLocalVariable)return"selected-variable"};n.OnLocalVarEdit=function(i,r){var u,o;n.SelectedLocalVariable=i;u=n.$new();u.isAdd=r;u.addType="Variable";u.variable=i;var f=n.SelectedLocalVariable.dictAttributes.ID,h=!1,e=GetDataTypePrefix(n.SelectedLocalVariable.dictAttributes.sfwDataType);f?e&&n.SelectedLocalVariable.dictAttributes.ID.match("^"+e)&&(f=f.substring(e.length),h=!0):f="";u.variable.strID=f;u.variable.IsPrefixVisible=h;u.variable.StrDataTypePrefix=e;u.variable.strDataType=n.SelectedLocalVariable.dictAttributes.sfwDataType;u.variable.strEntity=n.SelectedLocalVariable.dictAttributes.sfwEntity;u.variable.strValue=n.SelectedLocalVariable.dictAttributes.Value;u.variable.strText=n.SelectedLocalVariable.dictAttributes.Text;u.variable.strDataFormat=n.SelectedLocalVariable.dictAttributes.sfwDataFormat;u.UpdateLocalVarDatatype=function(n){u.variable.StrDataTypePrefix=GetDataTypePrefix(n);u.variable.IsPrefixVisible=!0;n!="Collection"&&n!="CDOCollection"&&n!="List"&&n!="Object"&&(u.variable.strEntity="")};u.closeDialog=function(){u.isAdd&&(n.SelectedLocalVariable=n.variables.length>0?n.variables[0]:undefined);o&&o.close&&o.close()};u.OnLocalVarOkClick=function(){n.SelectedLocalVariable=u.variable;n.SelectedLocalVariable.IsEditLocalVar=!1;var i=n.SelectedLocalVariable.strID;n.SelectedLocalVariable.IsPrefixVisible&&(i=(n.SelectedLocalVariable.StrDataTypePrefix?n.SelectedLocalVariable.StrDataTypePrefix:"")+(n.SelectedLocalVariable.strID?n.SelectedLocalVariable.strID:""));t.UndRedoBulkOp("Start");t.EditPropertyValue(n.SelectedLocalVariable.dictAttributes.ID,n.SelectedLocalVariable.dictAttributes,"ID",i);n.SelectedLocalVariable.dictAttributes.ID==undefined&&(n.SelectedLocalVariable.dictAttributes.ID="");t.EditPropertyValue(n.SelectedLocalVariable.dictAttributes.sfwDataType,n.SelectedLocalVariable.dictAttributes,"sfwDataType",n.SelectedLocalVariable.strDataType);t.EditPropertyValue(n.SelectedLocalVariable.dictAttributes.sfwEntity,n.SelectedLocalVariable.dictAttributes,"sfwEntity",n.SelectedLocalVariable.strEntity);t.EditPropertyValue(n.SelectedLocalVariable.dictAttributes.Value,n.SelectedLocalVariable.dictAttributes,"Value",n.SelectedLocalVariable.strValue);t.EditPropertyValue(n.SelectedLocalVariable.dictAttributes.Text,n.SelectedLocalVariable.dictAttributes,"Text",n.SelectedLocalVariable.strText);t.EditPropertyValue(n.SelectedLocalVariable.dictAttributes.sfwDataFormat,n.SelectedLocalVariable.dictAttributes,"sfwDataFormat",n.SelectedLocalVariable.strDataFormat);u.isAdd&&t.PushItem(n.SelectedLocalVariable,n.variables.Elements);t.UndRedoBulkOp("End");u.closeDialog()};u.openEntityClick=function(n){n&&n!=""&&(u.OnLocalVarOkClick(),s.NavigateToFile(n,"",""))};u.isAdd&&(u.variable.strDataType="string",u.UpdateLocalVarDatatype(u.variable.strDataType));o=t.showDialog(u,u.isAdd?"Add Variable":"Edit Variable","Rule/views/AddEditVariable.html")};n.isInvalidEntity=function(n){var t=!1,i,r;return(n.strDataType=="Collection"||n.strDataType=="CDOCollection"||n.strDataType=="Object"||n.strDataType=="List")&&(i=u.getEntityIntellisense(),r=i,r.some(function(t){return t.ID==n.strEntity})||(t=!0)),t};n.isInvalidVariable=function(t){var i=!1;return t&&(t.ErrorMessage="",t.strID&&t.strID.replace(" ","").length!=0?ut(t)?(i=!0,t.ErrorMessage="Error: Duplicate ID."):t.strDataType&&t.strDataType.replace(" ","").length!=0?t.strDataType!="Collection"&&t.strDataType!="CDOCollection"&&t.strDataType!="Object"&&t.strDataType!="List"||t.strEntity&&t.strEntity.replace(" ","").length!=0?n.isInvalidEntity(t)&&(i=!0,t.ErrorMessage="Error: Invalid Entity."):(i=!0,t.ErrorMessage="Error: Enter the Entity."):(i=!0,t.ErrorMessage="Error: Enter the Datatype."):(i=!0,t.ErrorMessage="Error: Enter the ID.")),i};n.menuOptionsForLocalVariables=[["Convert to Parameter",function(i){var r,u;if(i.objVar!=undefined)if(n.IsDecisionTable){if(confirm("Local Variable : '"+i.objVar.ParamID+"'   will be deleted, Do you want to continue?")){if(t.UndRedoBulkOp("Start"),r={ParamID:i.objVar.ParamID,DataType:i.objVar.DataType,Direction:"In",DataFormat:i.objVar.DataFormat,Entity:i.objVar.Entity,Text:i.objVar.Text},n.parameters.length>13){alert("Cannot convert to parameter as maximum limit has been reached.");return}t.PushItem(r,n.parameters);u=n.parameters.length-1;n.SelectedParameter=n.parameters[u];n.RemoveLocalVariable(i.objVar,!0);t.UndRedoBulkOp("End")}}else if(confirm("Local Variable : '"+i.objVar.dictAttributes.ID+"'   will be deleted, Do you want to continue?")){if(t.UndRedoBulkOp("Start"),r={Name:"parameter",value:i.objVar.value,dictAttributes:{ID:i.objVar.dictAttributes.ID,sfwDataType:i.objVar.dictAttributes.sfwDataType,sfwEntity:i.objVar.dictAttributes.sfwEntity,Text:i.objVar.dictAttributes.Text,sfwDataFormat:i.objVar.dictAttributes.sfwDataFormat,sfwDirection:"In"},Elements:[]},n.parameters.Elements.length>13){alert("Cannot convert to parameter as maximum limit has been reached.");return}t.PushItem(r,n.parameters.Elements);u=n.parameters.Elements.length-1;n.SelectedParameter=n.parameters.Elements[u];n.RemoveLocalVariable(i.objVar,!0);t.UndRedoBulkOp("End")}},function(t){return t.objVar!=undefined&&(n.SelectedLocalVariable=t.objVar),!0}],null,];n.ShowLocalVars=function(){var i=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#dvLocalVar");n.IsParameterVisible=!1;n.IsParentRulesVisible=!1;n.IsChildRulesVisible=!1;i.is(":visible")?(i.hide("slide",{direction:"right"}),n.IsLocalVariableVisible=!1):(i.show("slide",{direction:"right"}),n.IsLocalVariableVisible=!0);closeOtherRightPanels("LocalVariables")};n.AddParameters=function(){var t;t=n.IsDecisionTable?{ParamID:"",DataType:"",Direction:"",DataFormat:"",Entity:"",Text:""}:{Name:"parameter",value:"",dictAttributes:{},Elements:[]};n.AddOrUpdateParameter(t,!0)};n.RemoveParameters=function(t){n.IsDecisionTable?n.DeleteParameter(n.parameters,t):n.DeleteParameter(n.parameters.Elements,t)};n.DeleteParameter=function(i,r){var u,e,f;n.SelectedParameter&&(u="",n.SelectedParameter.ParamID?u=n.SelectedParameter.ParamID:n.SelectedParameter.strID?u=n.SelectedParameter.strID:n.SelectedParameter.dictAttributes&&n.SelectedParameter.dictAttributes.ID&&(u=n.SelectedParameter.dictAttributes.ID),e=!0,r||(e=confirm("Parameter : '"+u+"'   will be deleted, Do you want to continue?")),e&&(f=i.indexOf(n.SelectedParameter),t.DeleteItem(n.SelectedParameter,i),f<i.length?n.SelectedParameter=i[f]:i.length>0&&(n.SelectedParameter=i[f-1])))};n.setSelectedParameters=function(t){n.selectedItem=undefined;n.SelectedParameter=t;n.IsDecisionTable?angular.forEach(n.parameters,function(n){n!=t&&(n.IsEditParameter=!1)}):angular.forEach(n.parameters.Elements,function(n){n!=t&&(n.IsEditParameter=!1)})};n.getClassForParameters=function(t){if(t==n.SelectedParameter)return"selected-variable"};n.OnParameterEdit=function(t){var u,i,r;n.SelectedParameter=t;u=!1;n.IsDecisionTable?(i=n.SelectedParameter.ParamID,r=GetDataTypePrefix(n.SelectedParameter.DataType),i?r&&n.SelectedParameter.ParamID.match("^"+r)&&(i=i.substring(r.length),u=!0):i="",n.OnEditParameter(r,i,n.SelectedParameter.DataType,n.SelectedParameter.Entity,n.SelectedParameter.Direction,n.SelectedParameter.Text,n.SelectedParameter.DataFormat,u)):(i=n.SelectedParameter.dictAttributes.ID,r=GetDataTypePrefix(n.SelectedParameter.dictAttributes.sfwDataType),i?r&&n.SelectedParameter.dictAttributes.ID.match("^"+r)&&(i=i.substring(r.length),u=!0):i="",n.OnEditParameter(r,i,n.SelectedParameter.dictAttributes.sfwDataType,n.SelectedParameter.dictAttributes.sfwEntity,n.SelectedParameter.dictAttributes.sfwDirection,n.SelectedParameter.dictAttributes.Text,n.SelectedParameter.dictAttributes.sfwDataFormat,u))};n.OnEditParameter=function(t,i,r,u,f,e,o,s){n.SelectedParameter.strID=i;n.SelectedParameter.StrDataTypePrefix=t;n.SelectedParameter.IsPrefixVisible=s;n.SelectedParameter.strDataType=r;n.SelectedParameter.strEntity=u;n.SelectedParameter.strDirection=f!=undefined&&f!=""?f:"In";n.SelectedParameter.strText=e;n.SelectedParameter.strDataFormat=o};n.AddOrUpdateParameter=function(i,r){var u=n.$new(),e,f;u.addType="Parameter";u.isAdd=r;u.parameter=i;e=!1;n.OnParameterEdit(u.parameter);u.UpdateParameterDataType=function(n){u.parameter.StrDataTypePrefix=GetDataTypePrefix(n);u.parameter.IsPrefixVisible=!0;n!="Collection"&&n!="CDOCollection"&&n!="List"&&n!="Object"&&(u.parameter.strEntity="")};u.UpdateDirection=function(){u.parameter.strEntity="";u.parameter.strDataType="";u.parameter.StrDataTypePrefix=""};u.closeDialog=function(){u.isAdd&&n.IsDecisionTable?n.SelectedParameter=n.parameters.length>0?n.parameters[n.parameters.length-1]:undefined:u.isAdd&&(n.SelectedParameter=n.parameters.Elements.length>0?n.parameters.Elements[n.parameters.Elements.length-1]:undefined);f&&f.close&&f.close()};u.OnParameterOkClick=function(){if(n.SelectedParameter=u.parameter,u.isAdd&&n.IsDecisionTable&&n.parameters&&n.parameters.length>13){alert("Cannot add parameter as maximum limit has been reached.");return}if(u.isAdd&&n.parameters&&n.parameters.Elements&&n.parameters.Elements.length>13){alert("Cannot add parameter as maximum limit has been reached.");return}t.UndRedoBulkOp("Start");var i=n.SelectedParameter.strID;n.SelectedParameter.IsPrefixVisible&&(i=n.SelectedParameter.StrDataTypePrefix+n.SelectedParameter.strID);n.IsDecisionTable?(t.EditPropertyValue(n.SelectedParameter.ParamID,n.SelectedParameter,"ParamID",i),n.SelectedParameter.ParamID==undefined&&t.EditPropertyValue(n.SelectedParameter.ParamID,n.SelectedParameter,"ParamID",""),t.EditPropertyValue(n.SelectedParameter.DataType,n.SelectedParameter,"DataType",n.SelectedParameter.strDataType),t.EditPropertyValue(n.SelectedParameter.Entity,n.SelectedParameter,"Entity",n.SelectedParameter.strEntity),t.EditPropertyValue(n.SelectedParameter.Direction,n.SelectedParameter,"Direction",n.SelectedParameter.strDirection),t.EditPropertyValue(n.SelectedParameter.Text,n.SelectedParameter,"Text",n.SelectedParameter.strText),t.EditPropertyValue(n.SelectedParameter.DataFormat,n.SelectedParameter,"DataFormat",n.SelectedParameter.strDataFormat)):(t.EditPropertyValue(n.SelectedParameter.dictAttributes.ID,n.SelectedParameter.dictAttributes,"ID",i),n.SelectedParameter.dictAttributes.ID==undefined&&t.EditPropertyValue(n.SelectedParameter.dictAttributes.ID,n.SelectedParameter.dictAttributes,"ID",""),t.EditPropertyValue(n.SelectedParameter.dictAttributes.sfwDataType,n.SelectedParameter.dictAttributes,"sfwDataType",n.SelectedParameter.strDataType),t.EditPropertyValue(n.SelectedParameter.dictAttributes.sfwEntity,n.SelectedParameter.dictAttributes,"sfwEntity",n.SelectedParameter.strEntity),t.EditPropertyValue(n.SelectedParameter.dictAttributes.sfwDirection,n.SelectedParameter.dictAttributes,"sfwDirection",n.SelectedParameter.strDirection),t.EditPropertyValue(n.SelectedParameter.dictAttributes.Text,n.SelectedParameter.dictAttributes,"Text",n.SelectedParameter.strText),t.EditPropertyValue(n.SelectedParameter.dictAttributes.sfwDataFormat,n.SelectedParameter.dictAttributes,"sfwDataFormat",n.SelectedParameter.strDataFormat));u.isAdd&&n.IsDecisionTable?t.PushItem(n.SelectedParameter,n.parameters):u.isAdd&&t.PushItem(n.SelectedParameter,n.parameters.Elements);t.UndRedoBulkOp("End");u.closeDialog()};u.openEntityClick=function(n){n&&n!=""&&(u.OnParameterOkClick(),s.NavigateToFile(n,"",""))};u.isAdd&&(u.parameter.strDataType="string",u.UpdateParameterDataType(u.parameter.strDataType));f=t.showDialog(u,u.isAdd?"Add Parameter":"Edit Parameter","Rule/views/AddEditVariable.html")};n.menuOptionsForParameters=[["Convert to Local Variable",function(i){var r,u;i.objParam!=undefined&&confirm("Parameter : '"+i.objParam.dictAttributes.ID+"'   will be deleted, Do you want to continue?")&&(t.UndRedoBulkOp("Start"),r={Name:"variable",value:i.objParam.value,dictAttributes:{ID:i.objParam.dictAttributes.ID,sfwDataType:i.objParam.dictAttributes.sfwDataType,sfwEntity:i.objParam.dictAttributes.sfwEntity,Text:i.objParam.dictAttributes.Text,sfwDataFormat:i.objParam.dictAttributes.sfwDataFormat},Elements:[]},t.PushItem(r,n.variables.Elements),u=n.variables.Elements.length-1,n.SelectedLocalVariable=n.variables.Elements[u],n.RemoveParameters(!0),t.UndRedoBulkOp("End"))},function(t){return t.objParam!=undefined&&(n.SelectedParameter=t.objParam),n.objLogicalRule.dictAttributes&&n.objLogicalRule.dictAttributes.sfwRuleType=="ExcelMatrix"?!1:!0}],null,];n.ShowParameters=function(){var i=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#dvParameters");n.IsLocalVariableVisible=!1;n.IsParentRulesVisible=!1;n.IsChildRulesVisible=!1;i.is(":visible")?(i.hide("slide",{direction:"right"}),n.IsParameterVisible=!1):(i.show("slide",{direction:"right"}),n.IsParameterVisible=!0);closeOtherRightPanels("Parameters")};n.HideparameterLocalVars=function(){var r=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#dvParameters"),i;n.IsLocalVariableVisible=!1;r.is(":visible")&&(r.hide("slide",{direction:"right"}),n.IsParameterVisible=!1);closeOtherRightPanels("");i=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#dvLocalVar");n.IsParameterVisible=!1;i.is(":visible")&&(i.hide("slide",{direction:"right"}),n.IsLocalVariableVisible=!1)};n.ShowDecisionTableParameters=function(){var i=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#dvDecisionTableParameters");i.is(":visible")?(i.hide("slide",{direction:"right"}),n.IsParameterVisible=!1):(i.show("slide",{direction:"right"}),n.IsParameterVisible=!0);closeOtherRightPanels("DecisionTableParameters")};n.showChildRules=function(){var i=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#dvChildRules");n.IsLocalVariableVisible=!1;n.IsParentRulesVisible=!1;n.IsParameterVisible=!1;i.is(":visible")?(i.hide("slide",{direction:"right"}),n.IsChildRulesVisible=!1):(i.show("slide",{direction:"right"}),n.IsChildRulesVisible=!0);closeOtherRightPanels("ChildRules")};n.showParentRules=function(){var i=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#dvParentRules");n.IsLocalVariableVisible=!1;n.IsParameterVisible=!1;n.IsChildRulesVisible=!1;i.is(":visible")?(i.hide("slide",{direction:"right"}),n.IsParentRulesVisible=!1):(i.show("slide",{direction:"right"}),n.IsParentRulesVisible=!0);closeOtherRightPanels("ParentRules")};n.prepareExcelMatrix=function(){var e,r,i,u,f,t;for(n.objSelectedLogicalRule.objColumnValues=[],n.objSelectedLogicalRule.objExcelColumnValues=[],n.objSelectedLogicalRule.objHeaderRowValues=[],n.objSelectedLogicalRule.objHeaderColumnValues=[],n.objSelectedLogicalRule.objHeaderRowTitle="",e=n.objSelectedLogicalRule,t=0;t<e.Elements.length;t++)if(e.Elements[t].Name.toString().toLowerCase()=="rows")for(r=e.Elements[t],i=0;i<r.Elements.length;i++)r.Elements[i].dictAttributes.ID==0?(u=r.Elements[i].dictAttributes.sfwColumnValues,u&&(r.Elements[i].dictAttributes.Value!=undefined&&(n.objSelectedLogicalRule.objHeaderRowTitle=r.Elements[i].dictAttributes.Value),f=[],f=u.split(n.objSelectedLogicalRule.dictAttributes.sfwDelimiter),n.objSelectedLogicalRule.objHeaderColumnValues.push(f))):(u=r.Elements[i].dictAttributes.sfwColumnValues,u&&(f=[],f=u.split(n.objSelectedLogicalRule.dictAttributes.sfwDelimiter),n.objSelectedLogicalRule.objExcelColumnValues.push(f),n.objSelectedLogicalRule.objHeaderRowValues.push(r.Elements[i].dictAttributes.Value)));if(n.objSelectedLogicalRule.objExcelColumnValues.length>25)for(t=0;t<25;t++)n.objSelectedLogicalRule.objColumnValues.push(n.objSelectedLogicalRule.objExcelColumnValues[t]);else n.objSelectedLogicalRule.objColumnValues=n.objSelectedLogicalRule.objExcelColumnValues};n.LoadSomeRowsinExcelMatrix=function(){var i,t;if(n.objSelectedLogicalRule.objColumnValues)for(i=n.objSelectedLogicalRule.objColumnValues.length,count=0,t=i;t<n.objSelectedLogicalRule.objExcelColumnValues.length;t++){if(count==5)break;else n.objSelectedLogicalRule.objColumnValues.push(n.objSelectedLogicalRule.objExcelColumnValues[t]);count++}};n.updateChildRules=function(i){n.isChildRulesLoading=!0;i?t.EditPropertyValue(n.childRules,n,"childRules",getChildRules(n.objSelectedLogicalRule)):n.childRules=getChildRules(n.objSelectedLogicalRule);n.isChildRulesLoading=!1};n.updateParentRules=function(){n.isParentRulesLoading=!0;var t=!1,i="",r="",u="";n.objLogicalRule.dictAttributes?(u=n.objLogicalRule.dictAttributes.ID,i=n.objLogicalRule.dictAttributes.sfwEntity,r=n.objLogicalRule.dictAttributes.sfwRuleType,t=n.objLogicalRule.dictAttributes.sfwStatic&&n.objLogicalRule.dictAttributes.sfwStatic.toLowerCase()=="true"?!0:!1):(u=n.objLogicalRule.RuleID,i=n.objLogicalRule.Entity,r=n.objLogicalRule.RuleType,t=n.objLogicalRule.Static&&n.objLogicalRule.Static.toLowerCase()=="true"?!0:!1);$.connection.hubRuleModel.server.getParentRules(u,r,t,i).done(function(t){n.$evalAsync(function(){n.parentRules=t;n.isParentRulesLoading=!1})})};n.openRule=function(n){$.connection.hubMain.server.navigateToFile(n,"").done(function(n){t.openFile(n,undefined)})};n.UpdateScenarioDetails=function(){var f,t,r;if(n.objLogicalRule!=undefined&&(t="",n.currentfile.FileType=="DecisionTable"?(t=n.objLogicalRule.Entity,f=n.objLogicalRule.RuleID):(t=n.objLogicalRule.dictAttributes.sfwEntity,f=n.objLogicalRule.dictAttributes.ID),t!=undefined&&t!="")){var e=u.getEntityIntellisense(),o=e,i=o.filter(function(n){return n.ID==t});i&&i.length>0&&(r="",i[0].BusinessObjectName&&(r=i[0].BusinessObjectName),n.receiveEntityBusinessObject(r))}};n.SetParameterScenario=function(t){n.$apply(function(){n.HasRelatedParameterBasedScenario=!0;n.objLogicalRule.objExtraData.RelatedParameterBasedScenarioFile=t;n.objLogicalRule.objExtraData.HasRelatedParameterBasedScenario=!0})};n.NavigateToScenario=function(i){var r;i=="ParameterScenario"?r=n.objLogicalRule.objExtraData.RelatedParameterBasedScenarioFile:i=="ObjectScenario"?r=n.objLogicalRule.objExtraData.RelatedObjectBasedScenarioFile:i=="ExcelScenario"&&(r=n.objLogicalRule.objExtraData.RelatedExcelBasedScenarioFile);r&&t.openFile(r)};n.AddNewScenario=function(i,r){if(n.isDirty)alert("Save Rule file before creating scenario.");else{var u,f;n.objLogicalRule.dictAttributes==undefined?(u=n.objLogicalRule.RuleID,f=n.objLogicalRule.Entity):(u=n.objLogicalRule.dictAttributes.ID,f=n.objLogicalRule.dictAttributes.sfwEntity);h.getLastProjectDetails()&&h.getLastProjectDetails().ScenarioXmlFileLocation?(n.$evalAsync(function(){t.IsLoading=!0}),$.connection.hubRuleModel.server.createNewScenario(i,f,u,n.currentfile.FilePath,r).done(function(u){n.$apply(function(){if(!r){var f=u;i!="ExcelScenario"&&t.openFile(f);i=="ParameterScenario"?(n.HasRelatedParameterBasedScenario=!0,n.objLogicalRule.objExtraData.RelatedParameterBasedScenarioFile=f):i=="ObjectScenario"?(n.HasRelatedObjectBasedScenario=!0,n.objLogicalRule.objExtraData.RelatedObjectBasedScenarioFile=f):i=="ExcelScenario"&&(n.HasRelatedXLBasedScenario=!0,n.objLogicalRule.objExtraData.RelatedExcelBasedScenarioFile=f)}n.$evalAsync(function(){t.IsLoading=!1})})})):toastr.warning("Check the Scenario XML File Location in settings file.")}};n.FixAllNodeIds=function(){n.isDirty?alert("Please save the file First."):(t.IsLoading=!0,$.connection.hubRuleModel.server.fixAllNodeIds(n.currentfile).done(function(t){t&&n.receiverulemodel(t)}),t.IsLoading=!1,alert("All node ids are fixed."))};y=!1;w="";n.RuleDetailsOkClick=function(){var r,i,e,f,o;if(t.UndRedoBulkOp("Start"),n.IsDecisionTable?n.IsDecisionTable&&(n.objLogicalRule.Entity!=this.Entity&&(w=n.objLogicalRule.Entity,y=!0),t.EditPropertyValue(n.objLogicalRule.Entity,n.objLogicalRule,"Entity",this.Entity),t.EditPropertyValue(n.objLogicalRule.Description,n.objLogicalRule,"Description",this.Description),this.MatchAllConditions==undefined||this.MatchAllConditions==!1?t.EditPropertyValue(n.objLogicalRule.MatchAllConditions,n.objLogicalRule,"MatchAllConditions","False"):t.EditPropertyValue(n.objLogicalRule.MatchAllConditions,n.objLogicalRule,"MatchAllConditions","True"),this.ThrowError==undefined||this.ThrowError==!1?t.EditPropertyValue(n.objLogicalRule.ThrowError,n.objLogicalRule,"ThrowError","False"):t.EditPropertyValue(n.objLogicalRule.ThrowError,n.objLogicalRule,"ThrowError","True"),t.EditPropertyValue(n.objLogicalRule.ReturnType,n.objLogicalRule,"ReturnType",this.ReturnType),t.EditPropertyValue(n.objLogicalRule.Status,n.objLogicalRule,"Status",this.Status),t.EditPropertyValue(n.objLogicalRule.NeoTrackID,n.objLogicalRule,"NeoTrackID",this.NeoTrackID),this.Private==undefined||this.Private==!1?t.EditPropertyValue(n.objLogicalRule.Private,n.objLogicalRule,"Private","False"):t.EditPropertyValue(n.objLogicalRule.Private,n.objLogicalRule,"Private","True"),this.Trace==undefined||this.Trace==!1?t.EditPropertyValue(n.objLogicalRule.Trace,n.objLogicalRule,"Trace","False"):t.EditPropertyValue(n.objLogicalRule.Trace,n.objLogicalRule,"Trace","True"),this.Static==undefined||this.Static==!1?(t.EditPropertyValue(n.objLogicalRule.Static,n.objLogicalRule,"Static","False"),t.EditPropertyValue(n.objLogicalRule.CacheResult,n.objLogicalRule,"CacheResult","False")):(t.EditPropertyValue(n.objLogicalRule.Static,n.objLogicalRule,"Static","True"),this.CacheResult==undefined||this.CacheResult==!1?t.EditPropertyValue(n.objLogicalRule.CacheResult,n.objLogicalRule,"CacheResult","False"):t.EditPropertyValue(n.objLogicalRule.CacheResult,n.objLogicalRule,"CacheResult","True")),n.objDirFunctions.prepareExtraFieldData&&n.objDirFunctions.prepareExtraFieldData(),n.objLogicalRule.Static&&n.objLogicalRule.Static.toLowerCase()=="true"&&(n.ShowMethod=!1)):(n.objLogicalRule.dictAttributes.sfwEntity!=this.sfwEntity&&(w=n.objLogicalRule.dictAttributes.sfwEntity,y=!0),t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwEntity,n.objLogicalRule.dictAttributes,"sfwEntity",this.sfwEntity),t.EditPropertyValue(n.objLogicalRule.dictAttributes.Text,n.objLogicalRule.dictAttributes,"Text",this.Text),t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwReturnType,n.objLogicalRule.dictAttributes,"sfwReturnType",this.sfwReturnType),t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwStatus,n.objLogicalRule.dictAttributes,"sfwStatus",this.sfwStatus),t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwNeoTrackID,n.objLogicalRule.dictAttributes,"sfwNeoTrackID",this.sfwNeoTrackID),n.objLogicalRule.dictAttributes.sfwReturnType=="List"||n.objLogicalRule.dictAttributes.sfwReturnType=="Object"||n.objLogicalRule.dictAttributes.sfwReturnType=="Collection"?t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwReturnEntity,n.objLogicalRule.dictAttributes,"sfwReturnEntity",this.sfwReturnEntity):t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwReturnEntity,n.objLogicalRule.dictAttributes,"sfwReturnEntity",""),this.sfwPrivate==undefined||this.sfwPrivate==!1?t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwPrivate,n.objLogicalRule.dictAttributes,"sfwPrivate","False"):t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwPrivate,n.objLogicalRule.dictAttributes,"sfwPrivate","True"),this.sfwTrace==undefined||this.sfwTrace==!1?t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwTrace,n.objLogicalRule.dictAttributes,"sfwTrace","False"):t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwTrace,n.objLogicalRule.dictAttributes,"sfwTrace","True"),this.sfwStatic==undefined||this.sfwStatic==!1?(t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwStatic,n.objLogicalRule.dictAttributes,"sfwStatic","False"),t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwCacheResult,n.objLogicalRule.dictAttributes,"sfwCacheResult","False")):(t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwStatic,n.objLogicalRule.dictAttributes,"sfwStatic","True"),this.sfwCacheResult==undefined||this.sfwCacheResult==!1?t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwCacheResult,n.objLogicalRule.dictAttributes,"sfwCacheResult","False"):t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwCacheResult,n.objLogicalRule.dictAttributes,"sfwCacheResult","True")),n.objLogicalRule.dictAttributes.sfwRuleType=="ExcelMatrix"&&(t.EditPropertyValue(n.objLogicalRule.dictAttributes.rowHeader,n.objLogicalRule.dictAttributes,"rowHeader",this.rowHeader),t.EditPropertyValue(n.objLogicalRule.dictAttributes.columnHeader,n.objLogicalRule.dictAttributes,"columnHeader",this.columnHeader),t.EditPropertyValue(n.objLogicalRule.dictAttributes.sfwDefaultValue,n.objLogicalRule.dictAttributes,"sfwDefaultValue",this.sfwDefaultValue)),n.objDirFunctions.prepareExtraFieldData&&n.objDirFunctions.prepareExtraFieldData(),n.objLogicalRule.dictAttributes.sfwStatic&&n.objLogicalRule.dictAttributes.sfwStatic.toLowerCase()=="true"?n.ShowMethod=!1:n.IsBusObjPresent&&(n.ShowMethod=!0)),n.objLogicalRule.dictAttributes!=undefined)for(r=u.getEntityIntellisense(),i=0;i<r.length;i++)if(r[i].ID==n.objLogicalRule.dictAttributes.sfwEntity){for(e=r[i],f=0;f<r[i].Rules.length;f++)if(r[i].Rules[f].ID==n.objLogicalRule.dictAttributes.ID){o=r[i].Rules[f];t.EditPropertyValue(r[i].Rules[f].IsStatic,r[i].Rules[f],"IsStatic",this.sfwStatic);t.EditPropertyValue(r[i].Rules[f].IsPrivate,r[i].Rules[f],"IsPrivate",this.sfwPrivate);t.EditPropertyValue(r[i].Rules[f].ReturnType,r[i].Rules[f],"ReturnType",this.sfwReturnType);break}break}t.UndRedoBulkOp("End");ruledetailsdialogid="";p&&p.close()};n.NavigateToEntity=function(n){n&&n!=""&&s.NavigateToFile(n,"","")};n.receieveMovedRuleFile=function(i){var r=JSON.parse(i),f,u;for(t.isFilesListUpdated=!0,f="",n.IsDecisionTable?(ruleid=n.objLogicalRule.RuleID,f=n.objLogicalRule.Entity):(ruleid=n.objLogicalRule.dictAttributes.ID,f=n.objLogicalRule.dictAttributes.sfwEntity),u=0;u<r.length;u++)if(r[u].FileName===n.currentfile.FileName){n.currentfile.FilePath=r[u].FilePath;break}r&&r.length>0&&n.updateUserFiles(r)};n.updateUserFiles=function(n){for(var r,u=o.getObject("UserDetails"),i=0;i<n.length;i++)n[i].UserId=JSON.parse(u).UserID,n[i].Data=null;r=e.updateUserFiles(n);r.then(function(i){var r,u;if(i)for(r=0;r<n.length;r++)t.updateUserFileDetails(n[r]),u=t.lstopenedfiles.filter(function(t){return t.file.FileName==n[r].FileName}),u&&u.length>0&&t.closeFile(n[r].FileName)})};n.onDetailClick=function(){var i=n.$new();i.objExtraFields=[];n.objDirFunctions={};i.showExtraFieldsTab=!1;i.formName="Rule";n.IsDecisionTable?n.IsDecisionTable&&(i.RuleID=n.objLogicalRule.RuleID,i.Entity=n.objLogicalRule.Entity,i.Description=n.objLogicalRule.Description,i.MatchAllConditions=n.objLogicalRule.MatchAllConditions=="True"||n.objLogicalRule.MatchAllConditions=="true"?!0:!1,i.ThrowError=n.objLogicalRule.ThrowError=="True"||n.objLogicalRule.ThrowError=="true"?!0:!1,i.ReturnType=n.objLogicalRule.ReturnType,i.Status=n.objLogicalRule.Status,i.NeoTrackID=n.objLogicalRule.NeoTrackID,i.CacheResult=n.objLogicalRule.CacheResult=="true"||n.objLogicalRule.CacheResult=="True"?!0:!1,i.Static=n.objLogicalRule.Static=="true"||n.objLogicalRule.Static=="True"?!0:!1,i.Private=n.objLogicalRule.Private=="True"||n.objLogicalRule.Private=="true"?!0:!1,i.Trace=n.objLogicalRule.Trace=="True"||n.objLogicalRule.Trace=="true"?!0:!1):(i.ID=n.objLogicalRule.dictAttributes.ID,i.sfwEntity=n.objLogicalRule.dictAttributes.sfwEntity,i.Text=n.objLogicalRule.dictAttributes.Text,i.sfwReturnType=n.objLogicalRule.dictAttributes.sfwReturnType,i.sfwReturnEntity=n.objLogicalRule.dictAttributes.sfwReturnEntity,i.sfwStatus=n.objLogicalRule.dictAttributes.sfwStatus,i.sfwNeoTrackID=n.objLogicalRule.dictAttributes.sfwNeoTrackID,i.sfwCacheResult=n.objLogicalRule.dictAttributes.sfwCacheResult=="True"||n.objLogicalRule.dictAttributes.sfwCacheResult=="true"?!0:!1,i.sfwStatic=n.objLogicalRule.dictAttributes.sfwStatic=="True"||n.objLogicalRule.dictAttributes.sfwStatic=="true"?!0:!1,i.sfwPrivate=n.objLogicalRule.dictAttributes.sfwPrivate=="True"||n.objLogicalRule.dictAttributes.sfwPrivate=="true"?!0:!1,i.sfwTrace=n.objLogicalRule.dictAttributes.sfwTrace=="True"||n.objLogicalRule.dictAttributes.sfwTrace=="true"?!0:!1,n.objLogicalRule.dictAttributes.sfwRuleType=="ExcelMatrix"&&(i.rowHeader=n.objLogicalRule.dictAttributes.rowHeader,i.columnHeader=n.objLogicalRule.dictAttributes.columnHeader,i.sfwDefaultValue=n.objLogicalRule.dictAttributes.sfwDefaultValue));i.SelectedRuleDetailsDialogTab="Details";i.ID=undefined;p=t.showDialog(i,"Rule Details","Rule/views/RuleDetails.html",{height:600,width:660});i.selectRuleDetailsDialogTab=function(){i.SelectedRuleDetailsDialogTab="Details"};i.selectRuleExtraFieldsDialogTab=function(){i.SelectedRuleDetailsDialogTab="ExtraFields"};i.onReturnTypeChange=function(){i.sfwReturnEntity=""};i.validateRuleDetails=function(){var t,n;if(i.RuleDetailsErrorMessage=undefined,t=!1,i.IsDecisionTable){if(!i.Entity)return i.RuleDetailsErrorMessage="Entity is mandatory.",!0;if((i.ReturnType=="Collection"||i.ReturnType=="Object"||i.ReturnType=="List")&&!i.sfwReturnEntity)return i.RuleDetailsErrorMessage="Enter Return Entity Type.",!0}else{if(!i.sfwEntity)return i.RuleDetailsErrorMessage="Entity is mandatory.",!0;if((i.sfwReturnType=="Collection"||i.sfwReturnType=="Object"||i.sfwReturnType=="List")&&!i.sfwReturnEntity)return i.RuleDetailsErrorMessage="Enter Return Entity Type.",!0}return(i.objDirFunctions.getExtraFieldData&&(i.objExtraFields=i.objDirFunctions.getExtraFieldData()),n=validateExtraFields(i),n)?(i.RuleDetailsErrorMessage=i.FormDetailsErrorMessage,!0):i.RuleDetailsErrorMessage!=undefined?!0:!1};i.closeRuleDetails=function(){p.close()}};n.updateView=function(){var r=n.ViewMode,t,i;if(n.objSelectedLogicalRule!=undefined){if(t=n.objLogicalRule,i="",t.dictAttributes!==undefined)i=t.dictAttributes.sfwRuleType;else if(t.RuleType!==undefined)i=t.RuleType;else{alert("Rule Type not found.");return}r=="Analyst View"?setAnalystView(i):setDeveloperView(i)}};n.showDescriptiontext=function(){n.isDescriptionText=!0};n.showStatusOptions=function(){n.isStatusOption=!0};n.focusOutFromDescriptionText=function(){n.isDescriptionText=!1};n.focusOutFromStatus=function(){n.isStatusOption=!1};n.getVarParamAttributes=function(n,i,r){var u,c,h;n||(n=[]);var s=[],l=[],a=[],e=getCurrentFileScope(),f=[],o=[];for(e.IsDecisionTable?e.parameters&&(f=e.parameters):(e.parameters&&e.parameters.Elements&&(f=e.parameters.Elements),e.variables&&e.variables.Elements&&(o=e.variables.Elements)),u=0;u<f.length;u++)f[u].dictAttributes?(n.length==0||n.indexOf(f[u].dictAttributes.sfwDataType)>-1)&&l.push({ID:f[u].dictAttributes.ID,DisplayName:f[u].dictAttributes.ID,Value:f[u].dictAttributes.ID,Tooltip:f[u].dictAttributes.ID,DataType:f[u].dictAttributes.sfwDataType,Direction:f[u].dictAttributes.sfwDirection,Entity:f[u].dictAttributes.sfwEntity}):(n.length==0||n.indexOf(f[u].DataType)>0)&&l.push({ID:f[u].ParamID,DisplayName:f[u].ParamID,Value:f[u].ParamID,Tooltip:f[u].ParamID,DataType:f[u].DataType,Direction:f[u].Direction,Entity:f[u].Entity});for(u=0;u<o.length;u++)(n.length==0||n.indexOf(o[u].dictAttributes.sfwDataType)>-1)&&a.push({ID:o[u].dictAttributes.ID,DisplayName:o[u].dictAttributes.ID,Value:o[u].dictAttributes.ID,Tooltip:o[u].dictAttributes.ID,DataType:o[u].dictAttributes.sfwDataType,Entity:o[u].dictAttributes.sfwEntity});return s=l.concat(a),e.objLogicalRule.dictAttributes?e.objLogicalRule.dictAttributes.sfwStatic&&e.objLogicalRule.dictAttributes.sfwStatic.toLowerCase()!="true"&&(h=r!=undefined&&r!=null?r:e.objLogicalRule.dictAttributes.sfwEntity,c=t.getEntityAttributeIntellisense(h,i),c=c.filter(function(t){if(n.length==0||n.indexOf(t.DataType)>-1)return t}),s=s.concat(c)):e.objLogicalRule.Static.toLowerCase()!="true"&&(h=r!=undefined&&r!=null?r:e.objLogicalRule.Entity,s=s.concat(t.getEntityAttributeIntellisense(h,i))),s};n.getFirstLevelIntellisense=function(){var i=n.getVarParamAttributes(undefined,!0),t,u;if(i=i.concat(r.getConstantsList()),i.push({ID:"RFunc",DisplayName:"RFunc",Value:"RFunc",Tooltip:"RFunc"}),n.customTypes&&n.customTypes.length>0)for(t=0,u=n.customTypes.length;t<u;t++)i.push({ID:n.customTypes[t],DisplayName:n.customTypes[t],Value:n.customTypes[t],Tooltip:n.customTypes[t],isCustomType:!0});return i};n.onActionKeyDown=function(i){var c=getCurrentFileScope(),l=i.target,y,e,p,b,v,w,k,rt,o,d,g,h,f;y=c.objLogicalRule.dictAttributes?c.objLogicalRule.dictAttributes.sfwEntity:c.objLogicalRule.Entity;e=[];e=n.getFirstLevelIntellisense();var ut=u.getEntityIntellisense(),a=ut,o=a.filter(function(n){return n.ID==y}),st="";if(st=c.objLogicalRule.dictAttributes?c.objLogicalRule.dictAttributes.sfwStatic:c.objLogicalRule.Static,o[0]&&o[0].ParentId!=""&&st.toLowerCase()!="true")for(p=o[0].ParentId;p!="";)e=e.concat(t.getEntityAttributeIntellisense(p,!1)),o=a.filter(function(n){return n.ID==p}),p=o[0]?o[0].ParentId:"";n.GetAliasObjects(n.objSelectedLogicalRule,!0);n.CheckForLoopAndGetLoopParameters(c.SelectedNode,!0,n.objSelectedLogicalRule);e=e.concat(n.lstSelectedAliasobjCollection);var nt=getCaretCharacterOffsetWithin(l),s=getSplitArray(l.innerText,nt),tt=l.innerText.substring(0,nt);if(tt&&tt.match(".*RFunc")){var lt=tt.lastIndexOf("RFunc"),at=l.innerText.substring(lt,nt),vt=ot(at);vt||(b=ft(l.innerText.substring(0,l.innerText.length-1),getCaretCharacterOffsetWithin(l)),b=="NewCollection"||b=="NewObject"||b=="NewList"?e=a:et(l.innerText,getCaretCharacterOffsetWithin(l))&&(e=a))}var it=[],ht=0,ct=!1;if(s.length>1)for(v=0;v<s.length;v++)for(w=0;w<n.lstSelectedAliasobjCollection.length;w++)if(s[v]==n.lstSelectedAliasobjCollection[w].ID){ht=v;ct=!0;s.splice(v,1);it=n.lstSelectedAliasobjCollection[w].AliasName.split(".");break}for(k=it.length-1;k>=0;k--)s.splice(ht,0,it[k]);if(rt=!1,ct){var ut=u.getEntityIntellisense(),a=ut,y="";if(y=c.objLogicalRule.dictAttributes?c.objLogicalRule.dictAttributes.sfwEntity:c.objLogicalRule.Entity,o=a.filter(function(n){return n.ID==y}),o.length>0&&(d=o[0].Queries.filter(function(n){return n.QueryType=="SelectQuery"}),e=d),e=e.concat(c.getVarParamAttributes(["Collection","CDOCollection","List","Object"],!0,y)),o&&o.length>0&&o[0].ParentId!="")for(parententityname=o[0].ParentId;parententityname!="";)o=a.filter(function(n){return n.ID==parententityname}),o&&o.length>0&&(d=o[0].Queries.filter(function(n){return n.QueryType=="SelectQuery"}),e=e.concat(d)),g=t.getEntityAttributeIntellisense(parententityname,!1),g=g.filter(function(n){return n.DataType=="Collection"||n.DataType=="CDOCollection"||n.DataType=="Object"||n.DataType=="List"}),e=e.concat(g),parententityname=o&&o.length>0?o[0].ParentId:"";if(s.length>0)for(h=0;h<s.length;h++)if(f=e.filter(function(n){return n.ID==s[h]}),f.length>0)if(typeof f[0].DataType!="undefined"&&(f[0].DataType=="Object"||f[0].DataType=="Collection"||f[0].DataType=="CODCollection"||f[0].DataType=="List")&&typeof f[0].Entity!="undefined"&&f[0].ID==s[h]&&h<s.length-1)for(e=[],parententityname=f[0].Entity;parententityname!="";)o=a.filter(function(n){return n.ID==parententityname}),e=e.concat(t.getEntityAttributeIntellisense(parententityname,!1)),parententityname=o&&o.length>0?o[0].ParentId:"";else typeof f[0].DataType!="undefined"&&f[0].DataType!="Object"&&f[0].DataType!="Collection"&&f[0].DataType!="CDOCollection"&&f[0].DataType!="List"&&f[0].DataType!="string"&&h<s.length-1?f[0].isQueryfieldsLoaded?e=f[0].lstQueryFields:(c.getQueryFields(f[0].Entity,f[0].ID),e=[]):e=f;else h!=s.length-1&&(e=[])}else if(s.length>0)for(h=0;h<s.length;h++)if(f=e.filter(function(n){return n.ID==s[h]}),f.length>0)if(f[0].Type&&f[0].ID==s[h]&&f[0].Type=="Constant"){if(f[0].Type=="Constant"){e=r.getConstantsList(s.join("."));break}}else if(f[0].ID=="RFunc"&&s[h]=="RFunc")e=r.getRfunctionsList();else if(f[0].isCustomType)hubMain.server.getCustomTypeMethods(f[0].ID).done(function(t){e=t;n.setRuleIntellisenseData(e,s,l,i)}),rt=!0;else if(typeof f[0].DataType!="undefined"&&(f[0].DataType=="Object"||f[0].DataType=="Collection"||f[0].DataType=="CDOCollection"||f[0].DataType=="List")&&typeof f[0].Entity!="undefined"&&f[0].ID==s[h]&&h<s.length-1)for(parententityName=f[0].Entity,e=[];parententityName!="";)e=e.concat(t.getEntityAttributeIntellisense(parententityName,!1)),o=a.filter(function(n){return n.ID==parententityName}),parententityName=o[0]&&o.length>0?o[0].ParentId:"";else e=f[0].DataType!="undefined"&&f[0].DataType!="Object"&&f[0].DataType!="Collection"&&f[0].DataType!="CDOCollection"&&f[0].DataType!="List"&&f[0].DataType!="AliasObject"?[]:f;else h!=s.length-1&&(e=[]);rt||n.setRuleIntellisenseData(e,s,l,i)};n.setRuleIntellisenseData=function(n,t,i,r){var f=[],u;if(t.length>0){for(u=0;u<t.length;u++)f=n.filter(function(n){if(n.ID)return n.ID.toLowerCase().contains(t[u].toLowerCase())});n=f}setRuleIntellisense($(i),n);r.ctrlKey&&r.keyCode==$.ui.keyCode.SPACE&&$(i).data("ui-autocomplete")&&($(i).autocomplete("search",$(i).val()),r.preventDefault())};n.CheckForLoopAndGetLoopParameters=function(t,i,r){var u,f,e;if(i&&(b=t,n.lstSelectedAliasobjCollection=[]),r.Elements!=undefined&&r.Elements.length>0)for(u=0;u<r.Elements.length;u++)if(r.Elements[u].dictAttributes!=undefined&&r.Elements[u].dictAttributes.sfwNodeID==t.dictAttributes.sfwNodeID){if(r.Elements[u].Name=="foreach")for(f=0;f<n.lstAliasObjCollection.length;f++)if(n.lstAliasObjCollection[f].ID==r.Elements[u].dictAttributes.sfwItemName){for(e=!1,k=0;k<n.lstSelectedAliasobjCollection.length;k++)n.lstSelectedAliasobjCollection[k].ID==n.lstAliasObjCollection[f].ID&&(e=!0);e||b.dictAttributes.sfwNodeID!=r.Elements[u].dictAttributes.sfwNodeID&&n.lstSelectedAliasobjCollection.push(n.lstAliasObjCollection[f])}n.CheckForLoopAndGetLoopParameters(r,!1,n.objSelectedLogicalRule)}else r.Elements[u].Elements!=undefined&&r.Elements[u].Elements.length>0&&n.CheckForLoopAndGetLoopParameters(t,!1,r.Elements[u]),r.Elements[u].Children!=undefined&&r.Elements[u].Children.length>0&&n.CheckForLoopAndGetLoopParameters(t,!1,r.Elements[u]);if(r.Children!=undefined&&r.Children.length>0)for(u=0;u<r.Children.length;u++)if(r.Children[u].dictAttributes!=undefined&&r.Children[u].dictAttributes.sfwNodeID==t.dictAttributes.sfwNodeID){if(r.Children[u].Name=="foreach")for(f=0;f<n.lstAliasObjCollection.length;f++)if(n.lstAliasObjCollection[f].ID==r.Children[u].dictAttributes.sfwItemName){for(e=!1,k=0;k<n.lstSelectedAliasobjCollection.length;k++)n.lstSelectedAliasobjCollection[k].ID==n.lstAliasObjCollection[f].ID&&(e=!0);e||b.dictAttributes.sfwNodeID!=r.Children[u].dictAttributes.sfwNodeID&&n.lstSelectedAliasobjCollection.push(n.lstAliasObjCollection[f])}n.CheckForLoopAndGetLoopParameters(r,!1,n.objSelectedLogicalRule)}else r.Children[u].Elements!=undefined&&r.Children[u].Elements.length>0&&n.CheckForLoopAndGetLoopParameters(t,!1,r.Children[u]),r.Children[u].Children!=undefined&&r.Children[u].Children.length>0&&n.CheckForLoopAndGetLoopParameters(t,!1,r.Children[u])};n.GetAliasObjects=function(t,i){var r,u,f;if(i&&(n.lstAliasObjCollection=[]),t.Elements!=undefined&&t.Elements.length>0)for(r=0;r<t.Elements.length;r++)t.Elements[r].Name=="foreach"?(u=[],n.GetAliasName(t.Elements[r].dictAttributes.sfwObjectID),t.Elements[r].dictAttributes.sfwItemName!=undefined&&t.Elements[r].dictAttributes.sfwItemName!=""&&t.Elements[r].dictAttributes.sfwObjectID!=""&&t.Elements[r].dictAttributes.sfwObjectID!=undefined&&(f={ID:t.Elements[r].dictAttributes.sfwItemName,Tooltip:t.Elements[r].dictAttributes.sfwItemName,DataType:"AliasObject",lstobjCollection:u,Value:t.Elements[r].dictAttributes.sfwItemName,AliasName:n.AliasName},n.lstAliasObjCollection.push(f)),n.GetAliasObjects(t.Elements[r],!1)):(t.Elements[r].Elements!=undefined&&t.Elements[r].Elements.length>0&&n.GetAliasObjects(t.Elements[r],!1),t.Elements[r].Children!=undefined&&t.Elements[r].Children.length>0&&n.GetAliasObjects(t.Elements[r],!1));if(t.Children!=undefined&&t.Children.length>0)for(r=0;r<t.Children.length;r++)t.Children[r].Name=="foreach"?(u=[],n.GetAliasName(t.Children[r].dictAttributes.sfwObjectID),t.Children[r].dictAttributes.sfwItemName!=undefined&&t.Children[r].dictAttributes.sfwItemName!=""&&t.Children[r].dictAttributes.sfwObjectID!=undefined&&t.Children[r].dictAttributes.sfwObjectID!=""&&(f={ID:t.Children[r].dictAttributes.sfwItemName,Tooltip:t.Children[r].dictAttributes.sfwItemName,DataType:"AliasObject",lstobjCollection:u,Value:t.Children[r].dictAttributes.sfwItemName,AliasName:n.AliasName},n.lstAliasObjCollection.push(f)),n.GetAliasObjects(t.Children[r])):(t.Children[r].Elements!=undefined&&t.Children[r].Elements.length>0&&n.GetAliasObjects(t.Children[r]),t.Children[r].Children!=undefined&&t.Children[r].Children.length>0&&n.GetAliasObjects(t.Children[r]))};n.GetAliasName=function(t){var i,u,f,r;if(t!=undefined){for(i=t.split("."),u=0;u<n.lstAliasObjCollection.length;u++)for(f=0;f<i.length;f++)i[f]==n.lstAliasObjCollection[u].ID&&(i[f]=n.lstAliasObjCollection[u].AliasName);for(t="",r=0;r<i.length;r++)t+=r==0?i[r]:"."+i[r];n.AliasName=t}};n.getQueryFields=function(t,i){hubMain.server.getEntityQueryFields(t,i).done(function(r){n.$apply(function(){var f=u.getEntityIntellisense(),e=f.filter(function(n){return n.ID==t}),n=e[0].Queries.filter(function(n){return n.ID==i});n.length>0&&(n[0].lstQueryFields=r,n[0].isQueryfieldsLoaded=!0)})})};n.FindMatchingList=function(){n.objLogicalRule.dictAttributes!=undefined&&n.objLogicalRule.dictAttributes.sfwRuleType=="LogicalRule"?$.connection.hubRuleModel.server.findTextforRule(n.findtext,n.objSelectedLogicalRule).done(function(t){n.lstMatchingtext=undefined;n.$apply(function(){if(n.ResetAllvalues(n.objSelectedLogicalRule),n.lstMatchingtext=t,n.lstMatchingtext.length>0){var i=n.lstMatchingtext[n.FindIndex];i!=undefined&&n.findSelfVM(i.SelfVM,n.objSelectedLogicalRule)}else n.FindIndex=-1})}):n.objLogicalRule.RuleType=="DecisionTable"&&$.connection.hubRuleModel.server.findTextListForDecisionTable(n.findtext,n.objSelectedLogicalRule).done(function(t){n.lstMatchingtext=undefined;n.$apply(function(){if(n.ResetAllvaluesForDecisionTable(n.objSelectedLogicalRule),n.lstMatchingtext=t,n.lstMatchingtext.length>0){var i=n.lstMatchingtext[n.FindIndex];i!=undefined&&n.findSelfVMForDecisionTable(i.SelfVM,n.objSelectedLogicalRule)}else n.FindIndex=-1})});n.FindIndex=0};n.IsFindOpen=!1;n.FindNext=function(){if(n.lstMatchingtext!=undefined)if(n.lstMatchingtext.length>0&&n.FindIndex<n.lstMatchingtext.length){n.FindIndex++;var t=n.lstMatchingtext[n.FindIndex];t!=undefined?n.objLogicalRule.dictAttributes!=undefined&&n.objLogicalRule.dictAttributes.sfwRuleType=="LogicalRule"?(n.ResetAllvalues(n.objSelectedLogicalRule),n.findSelfVM(t.SelfVM,n.objSelectedLogicalRule)):n.objLogicalRule.RuleType=="DecisionTable"&&(n.ResetAllvaluesForDecisionTable(n.objSelectedLogicalRule),n.findSelfVMForDecisionTable(t.SelfVM,n.objSelectedLogicalRule)):(n.FindIndex--,alert("Finished searching, reached end of the file"))}else alert("Finished searching, reached end of the file")};n.FindPrevious=function(){var t;n.lstMatchingtext!=undefined&&n.lstMatchingtext.length>0&&n.FindIndex>-1&&(n.FindIndex--,n.FindIndex>-1?n.objLogicalRule.dictAttributes!=undefined&&n.objLogicalRule.dictAttributes.sfwRuleType=="LogicalRule"?(n.ResetAllvalues(n.objSelectedLogicalRule),t=n.lstMatchingtext[n.FindIndex],t!=undefined&&n.findSelfVM(t.SelfVM,n.objSelectedLogicalRule)):n.objLogicalRule.RuleType=="DecisionTable"&&(n.ResetAllvaluesForDecisionTable(n.objSelectedLogicalRule),t=n.lstMatchingtext[n.FindIndex],t!=undefined&&n.findSelfVMForDecisionTable(t.SelfVM,n.objSelectedLogicalRule)):alert("Finished searching, reached start of the file"))};n.findSelfVM=function(t,i){angular.forEach(i.Elements,function(r){r.dictAttributes.sfwNodeID==t.dictAttributes.sfwNodeID&&(r.Name=="action"?i.IsSelected=!0:r.IsSelected=!0);n.findSelfVM(t,r)});angular.forEach(i.Children,function(r){r.dictAttributes.sfwNodeID==t.dictAttributes.sfwNodeID&&(r.Name=="action"?i.IsSelected=!0:r.IsSelected=!0);n.findSelfVM(t,r)})};n.ResetAllvalues=function(t){angular.forEach(t.Elements,function(t){t.IsSelected=!1;n.ResetAllvalues(t)});angular.forEach(t.Children,function(t){t.IsSelected=!1;n.ResetAllvalues(t)})};n.findSelfVMForDecisionTable=function(n,t){angular.forEach(t.DataHeaders,function(t){if(t.NodeID==n.NodeID){t.IsSelected=!0;return}});angular.forEach(t.Rows,function(t){angular.forEach(t.Cells,function(t){if(t.Item.NodeID==n.NodeID){t.Item.IsSelected=!0;return}})})};n.ResetAllvaluesForDecisionTable=function(n){angular.forEach(n.DataHeaders,function(n){n.IsSelected=!1});angular.forEach(n.Rows,function(n){angular.forEach(n.Cells,function(n){n.Item.IsSelected=!1;return})})};n.isMatchHtmlNodeText=function(n,t){var r=!1,i=n;return i=i.replace(/<\/?u[^>]*>/g,""),i=i.replace(new RegExp("(&gt;)","gi"),">"),i=i.replace(new RegExp("(&lt;)","gi"),"<"),t.dictAttributes?i==t.dictAttributes.sfwExpression?r=!0:t.Name=="method"?i==t.dictAttributes.sfwReturnField?r=!0:i==t.dictAttributes.sfwMethodName&&(r=!0):t.Name=="calllogicalrule"||t.Name=="calldecisiontable"||t.Name=="callexcelmatrix"?i==t.dictAttributes.sfwReturnField?r=!0:i==t.dictAttributes.sfwRuleID&&(r=!0):t.Name=="foreach"&&i==t.dictAttributes.sfwObjectID&&(r=!0):t.dictAttributes||i==t.Expression&&(r=!0),r};n.resetAllSpanValue=function(){for(var t,i=document.getElementsByClassName("hidden-span-expression"),n=0;n<i.length;n++)t=$(i[n])[0].innerHTML,t=t.replace(/<\/?u[^>]*>/g,""),$(i[n])[0].innerHTML=t};n.findVM=function(t){var i,r;return n.objLogicalRule.dictAttributes!=undefined?(r=n.objLogicalRule.Elements.filter(function(n){return n.Name=="logicalrule"}),angular.forEach(r,function(r){if(!i){var u=r.Elements.filter(function(n){return n.Name!="variables"});angular.forEach(r.Elements,function(r){i||r.Name!="variables"&&(i=n.FindVMByNodeID(t,r))})}})):angular.forEach(n.objLogicalRule.Rules,function(r){i||(i=n.FindDecisionTableVMByNodeID(t,r))}),i};n.FindVMByNodeID=function(t,i){var r;return i.dictAttributes.sfwNodeID==t?i:(angular.forEach(i.Elements,function(i){r||(i.dictAttributes.sfwNodeID==t&&(r=i),r=n.FindVMByNodeID(t,i))}),angular.forEach(i.Children,function(i){r||(i.dictAttributes.sfwNodeID==t&&(r=i),r=n.FindVMByNodeID(t,i))}),r)};n.FindDecisionTableVMByNodeID=function(n,t){var i;return angular.forEach(t.DataHeaders,function(t){if(!i&&t.NodeID==n){i=t;return}}),angular.forEach(t.Rows,function(t){angular.forEach(t.Cells,function(t){if(!i&&t.Item.NodeID==n){i=t.Item;return}})}),i};n.openEntityClick=function(t){t.strEntity&&t.strEntity!=""&&(n.OnParameterOkClick(t),s.NavigateToFile(t.strEntity,"",""))};n.addExtraFieldsDataInToMainModel=function(){var u,i,r,t;if(n.currentfile.FileType!="DecisionTable")n.objRuleExtraFields&&(u=n.objLogicalRule.Elements.indexOf(n.objRuleExtraFields),u==-1&&n.objLogicalRule.Elements.push(n.objRuleExtraFields));else if(n.objRuleExtraFields.Elements.length>0){for(r=[],t=0;t<n.objRuleExtraFields.Elements.length;t++)i={},i.ID=n.objRuleExtraFields.Elements[t].dictAttributes.ID,i.Value=n.objRuleExtraFields.Elements[t].dictAttributes.Value,i.URL=n.objRuleExtraFields.Elements[t].dictAttributes.URL,r.push(i);n.objLogicalRule.ExtraFields=r}else n.objLogicalRule.ExtraFields=[]};n.toggleSideBar=function(){n.IsToolsDivCollapsed=!n.IsToolsDivCollapsed};n.EditVersionDetailsDailog=function(){var i=n.$new();i.Init=function(){i.objRuleVersion={};i.objRuleVersion.IsDefaultVersion=!1;n.objSelectedLogicalRule.dictAttributes!=undefined?(n.objSelectedLogicalRule.dictAttributes.sfwEffectiveDate||(i.objRuleVersion.IsDefaultVersion=!0),i.objRuleVersion.Description=n.objSelectedLogicalRule.dictAttributes.Text,i.objRuleVersion.Status=n.objSelectedLogicalRule.dictAttributes.sfwStatus):n.objSelectedLogicalRule.dictAttributes==undefined&&(n.objSelectedLogicalRule.EffectiveDate||(i.objRuleVersion.IsDefaultVersion=!0),i.objRuleVersion.Description=n.objSelectedLogicalRule.Description,i.objRuleVersion.Status=n.objSelectedLogicalRule.Status)};i.onOkClick=function(){t.UndRedoBulkOp("Start");n.objLogicalRule.dictAttributes?(t.EditPropertyValue(n.objSelectedLogicalRule.dictAttributes.Text,n.objSelectedLogicalRule.dictAttributes,"Text",i.objRuleVersion.Description),t.EditPropertyValue(n.objSelectedLogicalRule.dictAttributes.sfwStatus,n.objSelectedLogicalRule.dictAttributes,"sfwStatus",i.objRuleVersion.Status)):(t.EditPropertyValue(n.objSelectedLogicalRule.Description,n.objSelectedLogicalRule,"Description",i.objRuleVersion.Description),t.EditPropertyValue(n.objSelectedLogicalRule.Status,n.objSelectedLogicalRule,"Status",i.objRuleVersion.Status));t.UndRedoBulkOp("End");i.CloseDialog()};i.CloseDialog=function(){i.versionDetailDialog&&i.versionDetailDialog.close()};i.Init();i.versionDetailDialog=t.showDialog(i,"Version Details","Rule/views/RuleVersionDetails.html")}}]);app.directive("checkTabOverflow",["$parse","$compile","$rootScope",function(){return{restrict:"A",link:function(n,t,i){i.functionName&&(n[i.functionName]=function(){return n.hasOverflow(t)},n.hasOverflow||(n.hasOverflow=function(n){var i=!1,t=n.parent().siblings(".rule-scrollable-tab");return t&&t.length>0&&t[0].offsetWidth<t[0].scrollWidth&&(i=!0),i}))}}}]);app.directive("logicalRuleStartNodeList",["$compile",function(){return{restrict:"E",scope:{model:"=",viewMode:"="},replace:!0,link:function(n){n.getStartTemplate=function(){return'<ul class="logical-rule-first-ul"><logical-rule-node-wrapper  ng-if="item.Name != \'variables\'" ng-repeat="item in siblingsCollection" model="item" view-mode="viewMode"><\/logical-rule-node-wrapper><\/ul>'};n.init=function(){n.siblingsCollection=n.model.Elements};n.init()},templateUrl:"Rule/views/LogicalRule/LogicalRuleStartTemplate.html"}}]);app.directive("logicalRuleNodeList",["$compile",function(n){return{restrict:"E",replace:!0,link:function(t,i){var r,u;t.getElementsTemplate=function(){return'<ul ng-class="model.Name == \'logicalrule\'?\'logical-rule-first-ul\':\'\'">                                                                                                             <li ng-if="item.Name != \'variables\'" ng-repeat="item in siblingsCollection">          <logical-rule-node-wrapper ng-if="item.Name != \'variables\'" model="item" parent-model="model" view-mode="viewMode"><\/logical-rule-node-wrapper>                                <\/li>                                                                                                                                                                            <\/ul>                                                                                                                                                                                '};t.siblingsCollection=t.model.Name=="case"||t.model.Name=="default"?t.model.Elements:t.model.Children;r=i.parent();r&&(u=$(t.getElementsTemplate()),n(u)(t),i.remove(),r.append(u))}}}]);app.directive("loopSwitchChildren",["$compile",function(n){return{restrict:"E",replace:!0,link:function(t,i){var r,u;t.getChildrenTemplate=function(){return'<ul ng-class="model.Name == \'switch\'? \'ul-switch\':\'ul-children\'">                                                                           <li ng-repeat="item in model.Elements">          <logical-rule-node-wrapper model="item" parent-model="model" view-mode="viewMode"><\/logical-rule-node-wrapper>                            <\/li>                                                                                                                                                                                                                                                                                   <\/ul>                                                                                                                                         '};r=i.parent();r&&(u=$(t.getChildrenTemplate()),n(u)(t),i.remove(),r.append(u))}}}]);app.directive("logicalRuleNodeWrapper",["$compile","$rootScope","$timeout",function(n,t,i){var e=function(n,r){var e,u=null,f;e=n.Name=="case"||n.Name=="default"?n.Elements:n.Children;f=generateUUID();u={Name:r,value:"",dictAttributes:{sfwNodeID:f},Elements:[],Children:[]};r=="switch"?(f=generateUUID(),u.Elements.push({Name:"case",value:"",dictAttributes:{sfwNodeID:f},Elements:[],Children:[]}),f=generateUUID(),u.Elements.push({Name:"default",value:"",dictAttributes:{sfwNodeID:f},Elements:[],Children:[]})):r=="actions"&&u.Elements.push({Name:"action",value:"",dictAttributes:{sfwNodeID:generateUUID()},Elements:[],Children:[]});u.IsSelected=!0;t.PushItem(u,e);i(function(){n&&checkAndCollapseNode(n.dictAttributes.sfwNodeID);enableExpressionEditing(u.dictAttributes.sfwNodeID)})},f=function(n,r){var f=generateUUID(),u={Name:r,value:"",dictAttributes:{sfwNodeID:f},Elements:[],Children:[]},o=null,s,e;if(r=="switch")f=generateUUID(),u.Elements.push({Name:"case",value:"",dictAttributes:{sfwNodeID:f},Elements:[],Children:[]}),f=generateUUID(),u.Elements.push({Name:"default",value:"",dictAttributes:{sfwNodeID:f},Elements:[],Children:[]});else if(r=="case"){for(s=!1,e=0;e<n.Elements.length;e++)if(n.Elements[e].Name=="default"){s=!0;o=n.Elements.indexOf(n.Elements[e]);break}}else r=="actions"&&u.Elements.push({Name:"action",value:"",dictAttributes:{sfwNodeID:generateUUID()},Elements:[],Children:[]});u.IsSelected=!0;o?t.InsertItem(u,n.Elements,o):t.PushItem(u,n.Elements);i(function(){n&&checkAndCollapseNode(n.dictAttributes.sfwNodeID);enableExpressionEditing(u.dictAttributes.sfwNodeID)})},r,u,o,h=function(n,t,i){r=n;u=t;o=i},a=function(n){var p,w,b,y,v,e,k,l,h,c,f,a;if(r!=undefined){if(t.UndRedoBulkOp("Start"),v=JSON.stringify(r),e=JSON.parse(v),o=="cut"){if(r.Name=="case")if(n.Name!="switch")alert("If/Else block can be added only inside switch block"),u=undefined;else{for(p=0,f=0;f<u.Elements.length;f++)u.Elements[f].Name==r.Name&&p++;p<=1&&(alert("Atleast one if block has to be present inside switch block"),u=undefined)}if(r.Name=="default"&&n.Name=="switch")for(f=0;f<n.Elements.length;f++)n.Elements[f].Name==r.Name&&(alert("Only one Else block can be present"),u=undefined);else r.Name=="default"&&n.Name!="switch"&&(alert("If/Else block can be added only inside the Condition"),u=undefined);if(w=!1,b=!1,u!=undefined){if(u.Name=="foreach"||u.Name=="while"){for(f=0;f<u.Children.length;f++)if(u.Children[f].Name==r.Name&&u.Children[f].dictAttributes.sfwNodeID==r.dictAttributes.sfwNodeID){t.DeleteItem(u.Children[f],u.Children);w=!0;y=f;break}for(f=0;f<u.Elements.length;f++)if(u.Elements[f].Name==r.Name&&u.Elements[f].dictAttributes.sfwNodeID==r.dictAttributes.sfwNodeID){t.DeleteItem(u.Elements[f],u.Elements);y=f;b=!0;break}}if(u.Name!="logicalrule"&&u.Name!="case"&&u.Name!="default")for(f=0;f<u.Children.length;f++)if(u.Children[f].Name==r.Name&&u.Children[f].dictAttributes.sfwNodeID==r.dictAttributes.sfwNodeID){t.DeleteItem(u.Children[f],u.Children);w=!0;y=f;break}if(u.Name=="logicalrule"||u.Name=="case"||u.Name=="default"||u.Name=="switch")for(f=0;f<u.Elements.length;f++)if(u.Elements[f].Name==r.Name&&u.Elements[f].dictAttributes.sfwNodeID==r.dictAttributes.sfwNodeID){t.DeleteItem(u.Elements[f],u.Elements);y=f;b=!0;break}if((r.Name=="case"||r.Name=="default")&&n.Name=="switch"){for(c=!1,f=0;f<n.Elements.length;f++)if(n.Elements[f].Name=="default"){c=!0;t.InsertItem(e,n.Elements,f);break}c||t.PushItem(e,n.Elements)}else if(n.Name=="case"&&r.Name=="case"||n.Name=="default"&&r.Name=="default"||n.Name=="default"&&r.Name=="case"||n.Name=="case"&&r.Name=="default"||n.Name!="switch"&&r.Name=="case")alert("If/Else block can be added only inside the Condition");else if(v=JSON.stringify(r),e=JSON.parse(v),n.Name=="case"||n.Name=="default")t.PushItem(e,n.Elements);else if(r.Name=="case"&&n.Name=="switch"){for(l=0,h=0;h<n.Elements.length;h++)n.Elements[h].Name=="case"&&l++;t.InsertItem(r,n.Elements,l)}else t.PushItem(e,n.Children)}r=undefined}else if(o=="copy"){if(k=generateUUID(),e.dictAttributes.sfwNodeID=k,e.$$hashKey=generateUUID(),e.Children!=undefined)for(f=0;f<e.Children.length;f++)e.Children=[];if(s(e),n.Name=="case"&&e.Name=="case"||n.Name=="default"&&e.Name=="default"||n.Name=="default"&&e.Name=="case"||n.Name=="case"&&e.Name=="default"||n.Name!="switch"&&r.Name=="case"||n.Name!="switch"&&r.Name=="default")alert("If/Else block can be added only inside the Condition");else if(n.Name=="case"||n.Name=="default")t.PushItem(e,n.Elements);else if((e.Name=="case"||e.Name=="default")&&n.Name=="switch"){if(e.Name=="case"){for(l=0,h=0;h<n.Elements.length;h++)n.Elements[h].Name=="case"&&l++;t.InsertItem(e,n.Elements,l)}else if(e.Name=="default"){for(c=!1,f=0;f<n.Elements.length;f++)if(n.Elements[f].Name==r.Name){alert("Only one Else block can be present");c=!0;break}c||t.PushItem(e,n.Elements)}}else t.PushItem(e,n.Children)}else if(o=="copy++"){if(e.dictAttributes.sfwNodeID=generateUUID(),e.$$hashKey=generateUUID(),s(e),n.Name=="case"&&e.Name=="case"||n.Name=="default"&&e.Name=="default"||n.Name=="default"&&e.Name=="case"||n.Name=="case"&&e.Name=="default"||n.Name!="switch"&&r.Name=="case"||n.Name!="switch"&&r.Name=="default")alert("If/Else block can be added only inside the Condition");else if(n.Name=="case"||n.Name=="default")t.PushItem(e,n.Elements);else if((e.Name=="case"||e.Name=="default")&&n.Name=="switch"){if(e.Name=="case"){for(l=0,h=0;h<n.Elements.length;h++)n.Elements[h].Name=="case"&&l++;t.InsertItem(e,n.Elements,l)}else if(e.Name=="default"){for(c=!1,f=0;f<n.Elements.length;f++)if(n.Elements[f].Name==r.Name){alert("Only one Else block can be present");c=!0;break}c||t.PushItem(e,n.Elements)}}else t.PushItem(e,n.Children);r=undefined}t.UndRedoBulkOp("End");a=getCurrentFileScope();a.objLogicalRule&&a.objLogicalRule.dictAttributes&&a.objSelectedLogicalRule&&a.ResetAllvalues(a.objSelectedLogicalRule);e.IsSelected=!0;i(function(){n&&checkAndCollapseNode(n.dictAttributes.sfwNodeID)})}},c=function(n,t){var i=!1;return angular.forEach(n.Elements,function(n){i||(i=n.dictAttributes&&t.dictAttributes&&n.dictAttributes.sfwNodeID==t.dictAttributes.sfwNodeID?!0:c(n,t))}),i||angular.forEach(n.Children,function(n){i||(i=n.dictAttributes&&t.dictAttributes&&n.dictAttributes.sfwNodeID==t.dictAttributes.sfwNodeID?!0:c(n,t))}),i},s=function(n){var t;if(n.Children!=undefined)for(t=0;t<n.Children.length;t++)n.Children[t].dictAttributes.sfwNodeID=generateUUID(),n.Children[t].$$hashKey&&(n.Children[t].$$hashKey=generateUUID()),n.Children[t].Children!=undefined?n.Children[t].Children.length>0&&s(n.Children[t]):n.Children[t].Elements.length>0&&s(n.Children[t]);if(n.Elements!=undefined)for(t=0;t<n.Elements.length;t++)n.Elements[t].dictAttributes.sfwNodeID=generateUUID(),n.Elements[t].$$hashKey&&(n.Elements[t].$$hashKey=generateUUID()),n.Elements[t].Elements.length>0&&s(n.Elements[t]),n.Elements[t].Children!=undefined&&n.Elements[t].Children.length>0&&s(n.Elements[t])},v=function(n,i){var u,r;return t.UndRedoBulkOp("Start"),u=!1,n.Name=="case"?u=y(n,i):n.Name=="action"?u=p(n,i):((i.Name=="logicalrule"||i.Name=="switch"||i.Name=="case"||i.Name=="default"||i.Name=="foreach"||i.Name=="while")&&(r=i.Elements.indexOf(n),r>-1&&(t.DeleteItem(n,i.Elements),i.Name!="switch"&&n.Children!=undefined&&angular.forEach(n.Children,function(n){t.InsertItem(n,i.Elements,r);r++}))),i.Name!="logicalrule"&&i.Name!="case"&&i.Name!="default"&&(r=i.Children.indexOf(n),r>-1&&(t.DeleteItem(n,i.Children),n.Children!=undefined&&n.Children.length>0&&angular.forEach(n.Children,function(n){t.InsertItem(n,i.Children,r);r++}))),u=!0),t.UndRedoBulkOp("End"),u},y=function(n,i){var r=!1,u=l(i,n.Name);return u==1?alert("One If Block Should be there"):(t.DeleteItem(n,i.Elements),r=!0),r},l=function(n,t){var i=0;return angular.forEach(n.Elements,function(n){n.Name==t&&i++}),i},p=function(n,i){var r=!1,u=l(i);u==1?alert("One Assign Should be there"):(t.DeleteItem(n,i.Elements),r=!0)},w=function(n){var i=generateUUID(),r={Elements:[],dictAttributes:{sfwNodeID:i,sfwExpression:""},Children:[],IsSelected:!1,Name:"action",Value:""};t.PushItem(r,n.Elements)},b=function(n){n.Elements.length>1&&t.DeleteItem(n.Elements[n.Elements.length-1],n.Elements)};return{restrict:"E",scope:{model:"=",parentModel:"=",viewMode:"="},replace:!0,link:function(u,s){var y,l;u.getNodeTemplate=function(){var n="";switch(u.model.Name){case"actions":n="<actions-node><\/actions-node>";break;case"break":case"continue":case"default":n="<break-continue-default-node><\/break-continue-default-node>";break;case"notes":n="<notes-node><\/notes-node>";break;case"return":case"switch":case"case":case"while":n="<return-switch-case-while-node><\/return-switch-case-while-node>";break;case"calllogicalrule":case"calldecisiontable":case"callexcelmatrix":n="<call-rule-node><\/call-rule-node>";break;case"foreach":n="<for-each-node><\/for-each-node>";break;case"query":n="<query-node><\/query-node>";break;case"method":n="<method-node><\/method-node>"}return n};u.getTemplate=function(){var n=['<div logical-rule-drag-drop node-id="{{::model.dictAttributes.sfwNodeID}}" node-name="{{::model.Name}}" ng-keydown="onkeydownevent($event,model,parentModel)">                                                                                 ',"    <span ng-show=\"(model.Name === 'foreach' || model.Name === 'while' || model.Name === 'switch') || (model.Name !== 'case' && model.Name !== 'default' && model.Children.length > 0) || ((model.Name === 'case' || model.Name === 'default') && model.Elements.length > 0)\" class=\"node-expander node-expanded\" ng-click=\"toggleNodeChildren($event)\"><\/span>                                                                                              ",'    <div class="node-wrapper node-wrapper-after">                                                                                                                                        '];return n.push(u.getNodeTemplate()),n=n.concat(["<ul  logical-rule-drag-drop ng-if=\"model.Name == 'foreach' || model.Name == 'while' || model.Name == 'switch'\" ng-class=\"model.Name == 'switch'? 'ul-switch':'ul-children'\">                 ",'            <li ng-repeat="item in model.Elements">                                                                                                                                      ','                <logical-rule-node-wrapper model="item" parent-model="model" view-mode="viewMode"><\/logical-rule-node-wrapper>                                                           ',"            <\/li>                                                                                                                                                                        ","                                                                                                                                                                                         ","        <\/ul>                                                                                                                                                                            ","    <\/div>                                                                                                                                                                               ","    <ul ng-if=\"(model.Name == 'case' || model.Name == 'default') && model.Elements.length>0\">                                                                                        ",'        <li ng-repeat="item in model.Elements">                                                                                                                                          ','            <logical-rule-node-wrapper model="item" parent-model="model" view-mode="viewMode"><\/logical-rule-node-wrapper>                                                               ',"        <\/li>                                                                                                                                                                            ","    <\/ul>                                                                                                                                                                                ","    <ul ng-if=\"model.Name != 'case' && model.Name != 'default' && model.Children.length>0\">                                                                                          ",'        <li ng-repeat="item in model.Children">                                                                                                                                          ','            <logical-rule-node-wrapper model="item" parent-model="model" view-mode="viewMode"><\/logical-rule-node-wrapper>                                                               ',"        <\/li>                                                                                                                                                                            ","    <\/ul>                                                                                                                                                                                ","<\/div>                                                                                                                                                                                   "]),n.join("")};u.toggleParameters=function(n){if(u.parameters&&u.parameters.Elements.length>0){var t=$(n.target).parents(".node").first();t.find(".parameters-expander-refresh.fa-caret-right").length>0?u.showParameters(t):u.hideParameters(t)}};u.showParameters=function(n){n.find(".parameters-wrapper").slideDown("slow");n.find(".parameters-expander-refresh.fa-caret-right").addClass("fa-caret-down");n.find(".parameters-expander-refresh.fa-caret-right").removeClass("fa-caret-right")};u.hideParameters=function(n){n.find(".parameters-wrapper").slideUp("slow");n.find(".parameters-expander-refresh.fa-caret-down").addClass("fa-caret-right");n.find(".parameters-expander-refresh.fa-caret-down").removeClass("fa-caret-down")};u.syncParameterVisibility=function(n){i(function(){n.find(".parameters-expander-refresh.fa-caret-right").length>0?u.hideParameters(n):u.showParameters(n)})};u.toggleNodeChildren=function(n){$(n.target).hasClass("node-expanded")?collapseNode(n.target,!0):expandNode(n.target,!0)};u.onStepSelectChange=function(n){var t=getCurrentFileScope();t.onSelectChange(n);u.SelectedNode=n};u.onActionKeyDown=function(n){if(controllerScope=getCurrentFileScope(),controllerScope&&controllerScope.onActionKeyDown){controllerScope.SelectedNode=u.SelectedNode;controllerScope.onActionKeyDown(n)}};u.onDescriptionKeyDown=function(){};u.init=function(){if((u.model.Name==="switch"||u.model.Name==="foreach"||u.model.Name==="while")&&(u.childrenCollection=u.model.Elements),u.siblingsCollection=u.model.Name==="case"||u.model.Name==="default"?u.model.Elements:u.model.Children,u.model.Elements.length>0){var i=function(n){return n.Name=="parameters"},n=u.model.Elements.filter(i);n&&n.length>0&&(u.parameters=n[0])}if(u.menuOptions=[["AddItem",[["Condition",function(){var n=u.model;e(n,"switch")}],["Action",function(){var n=u.model;e(n,"actions")}],["Method",function(){var n=u.model;e(n,"method")}],["CallLogicalRule",function(){var n=u.model;e(n,"calllogicalrule")}],["CallDecisionTable",function(){var n=u.model;e(n,"calldecisiontable")}],["CallExcelMatrix",function(){var n=u.model;e(n,"callexcelmatrix")}],["Loop",function(){var n=u.model;e(n,"foreach")}],["Return",function(){var n=u.model;e(n,"return")}],["While",function(){var n=u.model;e(n,"while")}],["Break",function(){var n=u.model;e(n,"break")}],["Continue",function(){var n=u.model;e(n,"continue")}],["Query",function(){var n=u.model;e(n,"query")}],["Notes",function(){var n=u.model;e(n,"notes")}]]],null,["Add Step",[["Condition",function(){var n=u.model;f(n,"switch")}],["Action",function(){var n=u.model;f(n,"actions")}],["Method",function(){var n=u.model;f(n,"method")}],["CallLogicalRule",function(){var n=u.model;f(n,"calllogicalrule")}],["CallDecisionTable",function(){var n=u.model;f(n,"calldecisiontable")}],["CallExcelMatrix",function(){var n=u.model;f(n,"callexcelmatrix")}],["Loop",function(){var n=u.model;f(n,"foreach")}],["Return",function(){var n=u.model;f(n,"return")}],["While",function(){var n=u.model;f(n,"while")}],["Break",function(){var n=u.model;f(n,"break")}],["Continue",function(){var n=u.model;f(n,"continue")}],["Query",function(){var n=u.model;f(n,"query")}],["Notes",function(){var n=u.model;f(n,"notes")}]],function(n){return(n.model.Name.match(/foreach/)||n.model.Name.match(/while/))!=null}],null,["Add if",function(){var n=u.model;f(n,"case")},function(n){return n.model.Name.match(/switch/)!=null}],null,["Add else",function(){var n=u.model;f(n,"default")},function(n){for(var t=0;t<n.model.Elements.length;t++)if(n.model.Elements[t].Name=="default")return!1;return n.model.Name.match(/switch/)!=null}],null,["Add Action",function(){var n=u.model;w(n)},function(n){return n.model.Name.match(/actions/)!=null}],null,["Delete Action",function(){var n=u.model;b(n)},function(n){return n.model.Name.match(/actions/)!=null&&u.model.Elements.length>1}],null,["Delete",function(){var t=u.model,n=u.parentModel;n!=undefined&&v(t,n)},function(n){var i,t;if(n.model.Name=="case"){for(i=0,t=0;t<n.parentModel.Elements.length;t++)n.parentModel.Elements[t].Name=="case"&&i++;return i<=1?!1:!0}return!0}],null,["Cut",function(){var n=u.model,t=u.parentModel;h(n,t,"cut")}],null,["Copy",function(){var n=u.model,t=u.parentModel;h(n,t,"copy")}],null,["Copy++",function(){var n=u.model,t=u.parentModel;h(n,t,"copy++")}],null,["Paste",function(){var n=u.model;a(n)},function(){var n=u.model;return r?c(r,n)&&o==="cut"?!1:u.model==r&&o==="cut"?!1:!0:!0}],null,["Toggle All Outlining",function(n){n.model&&ToggleAllOutLining($("div[node-id='"+n.model.dictAttributes.sfwNodeID+"']").parents(".logical-rule-first-ul").first())}],null,["Comment",function(){var n=u.model;t.EditPropertyValue(n.dictAttributes.sfwCommented,n.dictAttributes,"sfwCommented","True")},function(n){return n.model.dictAttributes.sfwCommented!="True"&&n.model.Name!="case"&&n.model.Name!="default"}],null,["Uncomment",function(){var n=u.model;t.EditPropertyValue(n.dictAttributes.sfwCommented,n.dictAttributes,"sfwCommented","False")},function(n){return n.model.dictAttributes.sfwCommented=="True"&&n.model.Name!="case"&&n.model.Name!="default"}],null],u.model.IsSelected)u.onStepSelectChange(u.model)};u.getCssClass=function(n){var t="";return n.dictAttributes.sfwCommented==="True"&&(t="commented-node"),n.IsSelected?(t+=" selected-node",n.isAdvanceSearched&&(t+=" bckgGreen")):n.isAdvanceSearched&&(t+=" bckgGrey"),t};u.init();y=s.parent();y&&(l=$(u.getTemplate()),n(l)(u),s.remove(),y.append(l),(u.model.Name==="foreach"||u.model.Name==="while")&&i(function(){var n=l.parents(".ul-children-even,.ul-children-odd").length;n>0&&n%2==1?l.find("> .node-wrapper > .ul-children").addClass("ul-children-even"):l.find("> .node-wrapper > .ul-children").addClass("ul-children-odd")}))}}}]);app.directive("actionsNode",["$rootScope","$timeout",function(n,t){return{restrict:"E",replace:!0,link:function(i){i.actionIndex=null;i.setCurrentAction=function(n){i.actionIndex=n};i.onkeydownevent=function(r){if(i.model.Name=="actions")if(r.ctrlKey&&r.keyCode==$.ui.keyCode.ENTER){var f=generateUUID(),u={Elements:[],dictAttributes:{sfwNodeID:f,sfwExpression:""},Children:[],IsSelected:!1,Name:"action",Value:""};i.actionIndex||i.actionIndex===0?n.InsertItem(u,i.model.Elements,i.actionIndex+1):n.PushItem(u,i.model.Elements);t(function(){enableExpressionEditing(i.model.dictAttributes.sfwNodeID,i.actionIndex+1)});r.stopPropagation&&r.stopPropagation();r.preventDefault&&r.preventDefault()}else r.ctrlKey&&r.keyCode==$.ui.keyCode.DELETE&&($(".page-header-fixed").css("pointer-events","auto"),i.model.Elements.length>1&&(i.actionIndex||i.actionIndex===0?n.DeleteItem(i.model.Elements[i.actionIndex],i.model.Elements):n.DeleteItem(i.model.Elements[i.model.Elements.length-1],i.model.Elements),i.actionIndex>i.model.Elements.length&&i.actionIndex--),r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault())}},templateUrl:"Rule/views/LogicalRule/ActionsNodeTemplate.html"}}]);app.directive("breakContinueDefaultNode",[function(){return{restrict:"E",replace:!0,templateUrl:"Rule/views/LogicalRule/BreakContinueDefaultNodeTemplate.html"}}]);app.directive("callRuleNode",["$rootScope","$EntityIntellisenseFactory",function(n,t){return{restrict:"E",replace:!0,link:function(i){i.onRuleIDKeyDown=function(n){var e=getCurrentFileScope(),a=n.target,u=getSplitArray(a.innerText,getCaretCharacterOffsetWithin(a)),c,l,b,f,v,y,k,s,r,o;e.GetAliasObjects(e.objSelectedLogicalRule,!0);e.CheckForLoopAndGetLoopParameters(i.SelectedNode,!0,e.objSelectedLogicalRule);c="";c=e.objLogicalRule.dictAttributes?e.objLogicalRule.dictAttributes.sfwEntity:e.objLogicalRule.Entity;i.model.Name=="calllogicalrule"?l="LogicalRule":i.model.Name=="calldecisiontable"?l="DecisionTable":i.model.Name=="callexcelmatrix"&&(l="ExcelMatrix");var nt=t.getEntityIntellisense(),d=nt,ut=d.filter(function(n){return n.Rules.some(function(t){return t.IsStatic&&(n.ID==c||!t.IsPrivate)&&t.RuleType==l})}),p=[],w=[],tt="";if(tt=e.objLogicalRule.dictAttributes?e.objLogicalRule.dictAttributes.sfwStatic:e.objLogicalRule.Static,b=[],tt.toLowerCase()!="true")for(var nt=t.getEntityIntellisense(),d=nt,h=c;h!="";)s=d.filter(function(n){return n.ID==h}),s&&s.length>0?(p=s[0].Rules.filter(function(n){return!n.IsStatic&&(h==c||!n.IsPrivate)&&n.RuleType==l}),w=s[0].Attributes.filter(function(n){return n.DataType=="Object"}),c!=h&&(p=p.concat(w)),h=s[0].ParentId,b=b.concat(p)):h="";f=ut.concat(b);f=f.concat(e.lstSelectedAliasobjCollection);f=f.concat(e.getVarParamAttributes(["Object"],!0,c));var g=[],it=0,rt=!1;if(u.length>1)for(v=0;v<u.length;v++)for(y=0;y<e.lstSelectedAliasobjCollection.length;y++)if(u[v]==e.lstSelectedAliasobjCollection[y].ID){it=v;rt=!0;u.splice(v,1);g=e.lstSelectedAliasobjCollection[y].AliasName.split(".");break}for(k=g.length-1;k>=0;k--)u.splice(it,0,g[k]);if(rt)f=i.GetAliasData(u,e,l);else if(u.length>0)for(o=0;o<u.length;o++)if(r=f.filter(function(n){return n.ID==u[o]}),r.length>0&&typeof r[0].Rules!="undefined"&&o<u.length)r[0].ID==u[o]&&(f=r[0].Rules.filter(function(n){return n.IsStatic&&(r[0].ID==c||!n.IsPrivate)&&n.RuleType==l}));else if(r.length>0&&r[0].DataType!=undefined&&o<u.length){if(r[0].DataType=="Object"&&r[0].ID==u[o])for(h=r[0].Entity,f=[];h!="";)s=d.filter(function(n){return n.ID==h}),s&&s.length>0?(f=f.concat(s[0].Rules.filter(function(n){return!n.IsStatic&&!n.IsPrivate&&n.RuleType==l})),w=s[0].Attributes.filter(function(n){return n.DataType=="Object"}),f=f.concat(w),h=s[0].ParentId):h=""}else r.length>0&&r[0].RuleType!=undefined&&o<u.length?(r[0].RuleType=="LogicalRule"||r[0].RuleType=="DecisionTable"||r[0].RuleType=="ExcelMatrix")&&(f=[]):o!=u.length-1&&(f=[]);if(r=[],u.length>0){for(o=0;o<u.length;o++)r=f.filter(function(n){return n.ID.toLowerCase().contains(u[o].toLowerCase())});f=r}setRuleIntellisense($(a),f,i);n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(a).data("ui-autocomplete")&&($(a).autocomplete("search",$(a).val()),n.preventDefault())};i.onCallRuleDoubleClick=function(){var t=i.model.dictAttributes.sfwRuleID,r;t!=undefined&&(r=t.lastIndexOf("."),t=t.substring(r+1),$.connection.hubMain.server.navigateToFile(t,"").done(function(t){n.openFile(t)}))};i.getExpressionValue=function(n,t){var r="",i=t.filter(function(t){return t.dictAttributes.ID==n.dictAttributes.ID&&t.dictAttributes.sfwDataType==n.dictAttributes.sfwDataType&&t.dictAttributes.sfwDirection==n.dictAttributes.sfwDirection});return i&&i.length>0&&(r=i[0].dictAttributes.sfwExpression),r};i.refreshRuleParameters=function(r){var c=getCurrentFileScope(),u,a,v,e,f,s,y;c&&c.currentfile.FileName&&n.ClearUndoRedoListByFileName(c.currentfile.FileName);var o=i.model.dictAttributes.sfwRuleID,l="",h=[];if(o||(o=""),o.contains(".")&&(h=o.split(".")),l=h.length>0?h[h.length-1]:o,angular.forEach(i.model.Elements,function(n){n.Name=="parameters"&&(u=n)}),n.UndRedoBulkOp("Start"),u==undefined&&(u={Name:"parameters",value:"",dictAttributes:{},Elements:[],Children:[]},i.parameters=u,n.PushItem(u,i.model.Elements)),a=[],angular.forEach(u.Elements,function(n){a.push(n)}),u.Elements=[],v=!1,l!="")for(e=t.getEntityIntellisense(),f=0;f<e.length;f++){if(e[f].Rules.length>0)for(s=0;s<e[f].Rules.length;s++)if(e[f].Rules[s].ID==l){intellisenseruleobject=e[f].Rules[s];intellisenseruleobject!=undefined&&angular.forEach(intellisenseruleobject.Parameters,function(t){var r={Name:"parameter",value:"",dictAttributes:{ID:t.ID,sfwDataType:t.DataType,sfwDirection:t.Direction},Elements:[],Children:[]};r.dictAttributes.sfwExpression=i.getExpressionValue(r,a);(t.DataType==="Collection"||t.DataType==="List"|t.DataType==="Object")&&(r.dictAttributes.sfwEntity=t.Entity);r.dictAttributes.sfwNodeID=generateUUID();n.PushItem(r,u.Elements)});v=!0;break}if(v)break}n.UndRedoBulkOp("End");y=$(r.target).parents(".node").first();i.syncParameterVisibility(y)}},templateUrl:"Rule/views/LogicalRule/CallRuleNodeTemplate.html"}}]);app.directive("forEachNode",["$rootScope","$EntityIntellisenseFactory",function(n,t){return{restrict:"E",replace:!0,link:function(i){i.onLoopCollectionkeyDown=function(r){var o=getCurrentFileScope(),e=[],c=r.target,u,g,k,v,y,l,a,p,f,h;o.GetAliasObjects(o.objSelectedLogicalRule,!0);o.CheckForLoopAndGetLoopParameters(i.SelectedNode,!0,o.objSelectedLogicalRule);var s=getSplitArray(c.innerText,getCaretCharacterOffsetWithin(c)),tt=t.getEntityIntellisense(),w=tt,b="";if(b=o.objLogicalRule.dictAttributes?o.objLogicalRule.dictAttributes.sfwEntity:o.objLogicalRule.Entity,u=w.filter(function(n){return n.ID==b}),g="",u&&u.length>0&&(g=u[0]),e=e.concat(o.getVarParamAttributes(["CDOCollection","Collection","List","Object"],!0,b)),o.objLogicalRule.dictAttributes.sfwStatic.toLowerCase()=="false"&&(u&&u.length>0&&(v=u[0].Queries.filter(function(n){return n.QueryType=="SelectQuery"}),e=e.concat(v)),k="",k=o.objLogicalRule.dictAttributes?o.objLogicalRule.dictAttributes.sfwStatic:o.objLogicalRule.Static,u&&u.length>0&&u[0]&&u[0].ParentId!=""&&k.toLowerCase()!="true"))for(parententityname=u[0].ParentId;parententityname!="";)u=w.filter(function(n){return n.ID==parententityname}),u&&u.length>0&&(v=u[0].Queries.filter(function(n){return n.QueryType=="SelectQuery"}),e=e.concat(v)),y=n.getEntityAttributeIntellisense(parententityname,!1),y=y.filter(function(n){return n.DataType=="Collection"||n.DataType=="CDOCollection"||n.DataType=="Object"||n.DataType=="List"}),e=e.concat(y),parententityname=u&&u.length>0?u[0].ParentId:"";e=e.concat(o.lstSelectedAliasobjCollection);var d=[],nt=0,it=!1;if(s.length>1)for(l=0;l<s.length;l++)for(a=0;a<o.lstSelectedAliasobjCollection.length;a++)if(s[l]==o.lstSelectedAliasobjCollection[a].ID){nt=l;it=!0;s.splice(l,1);d=o.lstSelectedAliasobjCollection[a].AliasName.split(".");break}for(p=d.length-1;p>=0;p--)s.splice(nt,0,d[p]);if(s.length>0)for(h=0;h<s.length;h++)if(f=e.filter(function(n){return n.ID==s[h]}),f.length>0)if(typeof f[0].DataType!="undefined"&&(f[0].DataType=="Object"||f[0].DataType=="Collection"||f[0].DataType=="CDOCollection"||f[0].DataType=="List")&&typeof f[0].Entity!="undefined"&&f[0].ID==s[h]&&h<s.length-1)for(e=[],parententityname=f[0].Entity;parententityname!="";)u=w.filter(function(n){return n.ID==parententityname}),u&&u.length>0,e=e.concat(n.getEntityAttributeIntellisense(parententityname,!1).filter(function(n){return n.DataType=="Object"||n.DataType=="Collection"||n.DataType=="CDOCollection"||n.DataType=="List"})),parententityname=u&&u.length>0?u[0].ParentId:"";else typeof f[0].DataType!="undefined"&&f[0].DataType!="Object"&&f[0].DataType!="Collection"&&f[0].DataType!="CDOCollection"&&f[0].DataType!="List"&&h<s.length-1?f[0].isQueryfieldsLoaded?e=f[0].lstQueryFields:(o.getQueryFields(f[0].Entity,f[0].ID),e=[]):e=f;else h!=s.length-1&&(e=[]);if(f=[],s.length>0){for(h=0;h<s.length;h++)f=e.filter(function(n){return n.ID.toLowerCase().contains(s[h].toLowerCase())});e=f}setRuleIntellisense($(c),e,i);r.ctrlKey&&r.keyCode==$.ui.keyCode.SPACE&&$(c).data("ui-autocomplete")&&($(c).autocomplete("search",$(c).val()),r.preventDefault())}},templateUrl:"Rule/views/LogicalRule/ForEachNodeTemplate.html"}}]);app.directive("methodNode",["$rootScope","$EntityIntellisenseFactory","$IentBaseMethodsFactory",function(n,t,i){return{restrict:"E",replace:!0,link:function(r){r.onMethodNameKeyDown=function(n){var y=getCurrentFileScope(),f=n.target,e=getSplitArray(f.innerText,getCaretCharacterOffsetWithin(f)),u,l,o,a,h,v,c;e[e.length-1]==""&&e.pop();u=[];l="";y.objLogicalRule.dictAttributes&&(l=y.objLogicalRule.dictAttributes.sfwEntity);for(var p=t.getEntityIntellisense(),w=p,s=l;s!="";)o=w.filter(function(n){return n.ID==s}),o&&o.length>0&&o[0].BusinessObjectName?(a=[],a=o[0].ObjectMethods.filter(function(n){return n.ID}),u=u.concat(a),s=o[0].ParentId):(s="",h=i.getIentBaseMethods(),h&&h.length&&(u=u.concat(h)));if(v=[],e.length>0){for(c=0;c<e.length;c++)v=u.filter(function(n){return n.ID.toLowerCase().contains(e[c].toLowerCase())});u=v}f.innerText.contains(".")&&(u=[]);setRuleIntellisense($(f),u,r);n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(f).data("ui-autocomplete")&&($(f).autocomplete("search",$(f).val()),n.preventDefault())};r.getExpressionValue=function(n,t){var r="",i=t.filter(function(t){return t.dictAttributes.ID==n.dictAttributes.ID});return i&&i.length>0&&(r=i[0].dictAttributes.sfwExpression),r};r.refreshMethodParameters=function(u){var p=r.model.dictAttributes.sfwMethodName,c,f,l,e,a,h,o,v,y;angular.forEach(r.model.Elements,function(n){n.Name=="parameters"&&(f=n)});c=getCurrentFileScope();n.UndRedoBulkOp("Start");f==undefined&&(f={Name:"parameters",value:"",dictAttributes:{},Elements:[],Children:[]},n.PushItem(f,r.model.Elements));l=[];angular.forEach(f.Elements,function(n){l.push(n)});f.Elements=[];e=[];a="";c.objLogicalRule.dictAttributes&&(a=c.objLogicalRule.dictAttributes.sfwEntity);var w=t.getEntityIntellisense(),b=w,s=b.filter(function(n){return n.ID==a});for(s&&s.length>0&&s[0].BusinessObjectName?e=s[0].ObjectMethods:(h=i.getIentBaseMethods(),h&&h.length&&(e=e.concat(h))),o=0;o<e.length;o++)if(e[o].ID==p){v=e[o];angular.forEach(v.Parameters,function(t){var i=null;i=v.MethodName?{Name:"parameter",value:"",dictAttributes:{ID:t.ParameterName,sfwDataType:t.ParameterType.Name,sfwNodeID:generateUUID()},Elements:[],Children:[]}:{Name:"parameter",value:"",dictAttributes:{ID:t.ID,sfwDataType:t.DataType,sfwEntity:t.Entity,sfwNodeID:generateUUID()},Elements:[],Children:[]};i.dictAttributes.sfwExpression=r.getExpressionValue(i,l);n.PushItem(i,f.Elements)});break}n.UndRedoBulkOp("End");y=$(u.target).parents(".node").first();r.syncParameterVisibility(y)}},templateUrl:"Rule/views/LogicalRule/MethodNodeTemplate.html"}}]);app.directive("notesNode",["$rootScope",function(n){return{restrict:"E",replace:!0,link:function(t){t.editNotes=function(i){var u=null;i.Elements.length==0?(u={Children:[],Elements:[],Name:"Text",Value:"",dictAttributes:{}},i.Elements.push(u)):u=i.Elements[0];var r=t.$new(),f=JSON.stringify(u),e=JSON.parse(f);r.objText=e;r.dialog=n.showDialog(r,"Edit Notes","Rule/views/EditNotesTemplate.html",{width:400,height:400});r.SaveChangedTextData=function(){n.EditPropertyValue(u.Value,u,"Value",r.objText.Value);u.IsValueInCDATAFormat=!0;r.onCancelClick()};r.onCancelClick=function(){r.dialog&&r.dialog.close()}}},templateUrl:"Rule/views/LogicalRule/NotesNodeTemplate.html"}}]);app.directive("queryNode",["$rootScope","$EntityIntellisenseFactory","$NavigateToFileService",function(n,t,i){return{restrict:"E",replace:!0,link:function(n){n.onQueryIDKeyDown=function(i){var e=getCurrentFileScope(),c=i.target,f,k,l,a,v,h,r,b,u,s;e.GetAliasObjects(e.objSelectedLogicalRule,!0);e.CheckForLoopAndGetLoopParameters(n.SelectedNode,!0,e.objSelectedLogicalRule);var o=getSplitArray(c.innerText,getCaretCharacterOffsetWithin(c)),nt=t.getEntityIntellisense(),y=nt,p="";p=e.objLogicalRule.dictAttributes?e.objLogicalRule.dictAttributes.sfwEntity:e.objLogicalRule.Entity;f=y.filter(function(n){return n.ID==p});k="";k=f[0]?f[0]:"";h=p;r=[];h!=""&&(f=y.filter(function(n){return n.ID==h}),f&&f.length>0&&(r=r.concat(f[0].Queries)));r=r.concat(e.lstSelectedAliasobjCollection);var w=[],d=0,g=!1;if(o.length>1)for(l=0;l<o.length;l++)for(a=0;a<e.lstSelectedAliasobjCollection.length;a++)if(o[l]==e.lstSelectedAliasobjCollection[a].ID){d=l;g=!0;o.splice(l,1);w=e.lstSelectedAliasobjCollection[a].AliasName.split(".");break}for(v=w.length-1;v>=0;v--)o.splice(d,0,w[v]);if(g)r=n.GetAliasData(o,e);else if(o.length>0)for(s=0;s<o.length;s++)if(u=r.filter(function(n){return n.ID==o[s]}),u.length>0)if(typeof u[0].DataType!="undefined"&&u[0].DataType!="Object"&&u[0].DataType!="Collection"&&u[0].DataType!="CDOCollection"&&u[0].DataType!="List"&&s<o.length-1)u[0].isQueryfieldsLoaded?r=u[0].lstQueryFields:(e.getQueryFields(u[0].Entity,u[0].ID),r=[]);else if(u[0].DataType!="undefined"&&u[0].DataType=="Object"){for(h=u[0].Entity,r=[];h!="";)f=y.filter(function(n){return n.ID==h}),f&&f.length>0&&(r=r.concat(f[0].Queries)),b=[],f&&f.length>0?(b=f[0].Attributes.filter(function(n){return n.DataType=="Object"}),r=r.concat(b),h=f[0].ParentId):h="";r=r.concat(e.lstSelectedAliasobjCollection)}else r=u;else s!=o.length-1&&(r=[]);if(u=[],o.length>0){for(s=0;s<o.length;s++)u=r.filter(function(n){return n.ID.toLowerCase().contains(o[s].toLowerCase())});r=u}setRuleIntellisense($(c),r,n);i.ctrlKey&&i.keyCode==$.ui.keyCode.SPACE&&$(c).data("ui-autocomplete")&&($(c).autocomplete("search",$(c).val()),i.preventDefault())};n.navigateToQuery=function(n){var r=getCurrentFileScope(),t=n.dictAttributes.sfwQueryID;t&&t!=""&&(r.objLogicalRule.dictAttributes?i.NavigateToFile(r.objLogicalRule.dictAttributes.sfwEntity,"queries",t):i.NavigateToFile(r.objLogicalRule.Entity,"queries",t))};n.refreshQueryParameters=function(i){var l=n.model.dictAttributes.sfwQueryID,h=[],s,o,f,u,r,e,c;for(angular.forEach(n.model.Elements,function(n){if(n.Name=="parameters"){var t={Children:n.Children,dictAttributes:n.dictAttributes,IsSelected:n.IsSelected,Name:n.Name,value:n.value,Elements:n.Elements};f=n;h=t}}),s="",o=getCurrentFileScope(),s=o.objLogicalRule.dictAttributes?o.objLogicalRule.dictAttributes.sfwEntity:o.objLogicalRule.Entity,f==undefined&&(f={Name:"parameters",value:"",dictAttributes:{},Elements:[],Children:[]},n.model.Elements.push(f)),f.Elements=[],u=t.getEntityIntellisense(),r=0;r<u.length;r++)if(u[r].ID==s){if(u[r].Queries.length>0)for(e=0;e<u[r].Queries.length;e++)if(u[r].Queries[e].ID==l){intellisenseruleobject=u[r].Queries[e];intellisenseruleobject!=undefined&&angular.forEach(intellisenseruleobject.Parameters,function(n){var t={Name:"parameter",value:"",dictAttributes:{ID:n.ID,sfwDataType:n.DataType},Elements:[],Children:[]};angular.forEach(h.Elements,function(i){i.dictAttributes.ID==n.ID&&(t.dictAttributes.sfwExpression=i.dictAttributes.sfwExpression)});f.Elements.push(t)});break}break}c=$(i.target).parents(".node").first();n.syncParameterVisibility(c)}},templateUrl:"Rule/views/LogicalRule/QueryNodeTemplate.html"}}]);app.directive("returnSwitchCaseWhileNode",[function(){return{restrict:"E",replace:!0,templateUrl:"Rule/views/LogicalRule/ReturnSwitchCaseWhileNodeTemplate.html"}}]);app.directive("logicalRuleEditable",[function(){return{restrict:"A",link:function(n,t){t.dblclick(function(n){$(n.target).attr("contenteditable")!=="true"&&enableEditing(this);n.stopPropagation&&n.stopPropagation()});t.on("keyup",function(n){n.which==27&&disableEditing(this)});t.on("blur",function(){disableEditing(this)})}}}]);app.directive("logicalRuleDragDrop",["$timeout",function(n){return{restrict:"A",link:function(t,i,r){var o,f,s;if($(i).hasClass("logical-rule-container")){o=function(){e();dragDropData=null};$(i).on("mouseup drop",o)}t.canDrop=function(n){var r=!1,u,i,f;return dragDropData&&(n.isOverTop||n.isOverLeft||n.isOverRight||n.isOverBottom||n.isOverInside)&&(r=!0,t.model&&(u=null,i=null,dragDropData.length===1?(u=dragDropData[0].dictAttributes.sfwNodeID,i=dragDropData[0].Name):dragDropData.length>1&&(u=dragDropData[1],f=searchNodeByIdInCurrentRule(u),f&&(i=f.Name)),u===t.model.dictAttributes.sfwNodeID||u===t.parentModel.dictAttributes.sfwNodeID&&n.isOverRight===!1?r=!1:(i==="foreach"||i==="while"||i==="switch")&&$("div[node-id='"+u+"']").find("> .node-wrapper > ul div[node-id='"+t.model.dictAttributes.sfwNodeID+"']").length>0?r=!1:$("div[node-id='"+t.model.dictAttributes.sfwNodeID+"'] > .node-expander").hasClass("node-collapsed")&&n.isOverRight?r=!1:t.model.Name==="case"||t.model.Name==="default"?n.isOverLeft?r=!1:t.model.Name==="default"&&n.isOverBottom?r=!1:(i==="case"||i==="default")&&n.isOverRight?r=!1:(n.isOverTop||n.isOverBottom)&&i!=="case"&&i!=="default"?r=!1:i==="default"&&t.parentModel.Elements.filter(function(n){return n.Name==="default"}).length>0?r=!1:i==="default"&&t.model.Name==="case"&&n.isOverTop&&(r=!1):(i==="case"||i==="default")&&(r=!1))),r};f=function(n){var r=n.clientX?n:n.originalEvent,i=n.currentTarget.getBoundingClientRect(),e={isOverInside:r.clientX>i.left&&r.clientX<i.right&&r.clientY>i.top&&r.clientY<i.bottom},f;t.canDrop(e)&&(f=$(n.currentTarget).closest(".logical-rule-container"),u("inside",i,f))};s=function(n){var i,s,c;if(n.preventDefault&&n.preventDefault(),n.currentTarget.localName=="ul"&&$(n.currentTarget).hasClass("ul-children"))$(n.currentTarget).find("> li").length===0&&f(n);else if(n.currentTarget.localName==="div")if($(n.currentTarget).hasClass("logical-rule-container"))$(n.currentTarget).find("> ul > li").length===0&&f(n);else{var r=h(n.currentTarget),a=n.clientX?n:n.originalEvent,o=l(a,r);t.canDrop(o)&&(i=$(n.currentTarget).parents(".logical-rule-container"),e(),o.isOverTop?(u("top",r,i),s=$(n.currentTarget).prev(),s&&s.length>0&&(c=h(s[0]),u("verticalfill",c,i))):o.isOverLeft?u("left",r,i):o.isOverRight?(u("right",r,i),u("horizontalfill",r,i)):o.isOverBottom&&(u("bottom",r,i),u("verticalfill",r,i)))}n.stopPropagation&&n.stopPropagation()};$(i).on("dragover",s);var h=function(n){var t={liBounds:undefined,nodeBounds:undefined,elementsUlBounds:undefined,childrenUlBounds:undefined},i,r;return t.liBounds=n.getBoundingClientRect(),t.nodeBounds=$(n).find(" > .node-wrapper > .node")[0].getBoundingClientRect(),i=$(n).find("> ul"),i&&i.length>0&&(t.elementsUlBounds=i[0].getBoundingClientRect()),r=$(n).find(" > .node-wrapper > ul"),r&&r.length>0&&(t.childrenUlBounds=r[0].getBoundingClientRect()),t},u=function(n,t,i){var r={left:0,right:0,height:0,width:0},u;switch(n){case"top":r.left=t.nodeBounds.left;r.top=t.liBounds.top-20;r.width=t.liBounds.width-50;r.height=t.nodeBounds.top-t.liBounds.top+20;break;case"left":r.left=t.liBounds.left;r.top=t.nodeBounds.top;r.width=t.nodeBounds.left-t.liBounds.left;r.height=t.liBounds.height-40;break;case"right":r.left=t.elementsUlBounds?t.elementsUlBounds.left-30:t.liBounds.right-30;r.top=t.nodeBounds.top;r.width=30;r.height=t.liBounds.height-40;break;case"bottom":r.left=t.nodeBounds.left;r.top=t.liBounds.bottom-20;r.width=t.liBounds.width-60;r.height=40;break;case"horizontalfill":r.left=t.nodeBounds.right;r.top=t.nodeBounds.top;r.width=t.elementsUlBounds?t.elementsUlBounds.left-30-r.left:t.liBounds.right-30-r.left;r.height=t.nodeBounds.height;break;case"verticalfill":r.left=t.nodeBounds.left;t.childrenUlBounds?(r.top=t.childrenUlBounds.bottom,r.width=t.childrenUlBounds.width+(t.childrenUlBounds.left-t.nodeBounds.left)):(r.top=t.nodeBounds.bottom,r.width=t.nodeBounds.width);r.height=t.liBounds.bottom-20-r.top;break;case"inside":r.left=t.left;r.top=t.top;r.width=t.width;r.height=t.height}u=$(i)[0].getBoundingClientRect();r.left=r.left-u.left+$(i).scrollLeft();r.top=r.top-u.top+$(i).scrollTop();c(n,r,i)},c=function(i,u,f){i==="horizontalfill"?i="right":i==="verticalfill"&&(i="bottom");var o=$('<div class="drop-area" ><\/div>');o.css("left",u.left);o.css("top",u.top);o.css("height",u.height);o.css("width",u.width);o.on("dragover",function(n){n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation()});o.on("dragleave",function(){});o.on("drop",function(u){i==="inside"?r.isFirstNode&&t.rule?addItemOnDrop(dragDropData,[t.rule.dictAttributes.sfwNodeID,i],u):addItemOnDrop(dragDropData,[t.model.dictAttributes.sfwNodeID,i],u):addItemOnDrop(dragDropData,[t.parentModel.dictAttributes.sfwNodeID,t.model.dictAttributes.sfwNodeID,i],u);var f=dragDropData;n(function(){f&&f.length>0&&f[0].dictAttributes&&enableExpressionEditing(f[0].dictAttributes.sfwNodeID)});e();dragDropData=null});$(f).append(o)},e=function(){$(".drop-area").remove()},l=function(n,t){var i={isOverTop:!1,isOverLeft:!1,isOverRight:!1,isOverBottom:!1},r,u,f,e;return i.isOverTop=n.clientY>t.liBounds.top&&n.clientY<t.nodeBounds.top&&n.clientX>t.nodeBounds.left&&n.clientX<t.liBounds.right-30,i.isOverLeft=n.clientX>t.liBounds.left&&n.clientX<t.nodeBounds.left&&n.clientY>t.nodeBounds.top&&n.clientY<t.liBounds.bottom-20,r=t.elementsUlBounds&&n.clientX<t.elementsUlBounds.left-30&&n.clientX>t.nodeBounds.right&&n.clientY>t.nodeBounds.top&&n.clientY<t.nodeBounds.bottom||!t.elementsUlBounds&&n.clientX<t.liBounds.right-30&&n.clientX>t.nodeBounds.right&&n.clientY>t.nodeBounds.top&&n.clientY<t.nodeBounds.bottom,u=t.elementsUlBounds&&n.clientX<t.elementsUlBounds.left&&n.clientX>t.elementsUlBounds.left-30&&n.clientY>t.nodeBounds.top&&n.clientY<t.liBounds.bottom-20||!t.elementsUlBounds&&n.clientX<t.liBounds.right&&n.clientX>t.liBounds.right-30&&n.clientY>t.nodeBounds.top&&n.clientY<t.liBounds.bottom-20,i.isOverRight=r||u,f=t.childrenUlBounds&&n.clientY<t.liBounds.bottom&&n.clientY>t.childrenUlBounds.bottom&&n.clientX>t.nodeBounds.left&&n.clientX<t.childrenUlBounds.right||!t.childrenUlBounds&&n.clientY<t.liBounds.bottom&&n.clientY>t.nodeBounds.bottom&&n.clientX>t.nodeBounds.left&&n.clientX<t.nodeBounds.right,e=n.clientY<t.liBounds.bottom&&n.clientY>t.liBounds.bottom-20&&n.clientX>t.nodeBounds.left&&n.clientX<t.liBounds.right-30,i.isOverBottom=f||e,i}}}}]);app.directive("customdraggable",[function(){return{restrict:"A",scope:{dragdata:"=",isruletoolbar:"=",isobjectbased:"=",displaypath:"="},link:function(n,t){function r(t){dragDropData=null;dragDropDataObject=null;t.dataTransfer.effectAllowed="move";t.dataTransfer.setData("Text","");n.dragdata&&(n.dragdata instanceof Array?canDrag(n.dragdata)&&(dragDropData=n.dragdata):(dragDropData=n.dragdata,n.isruletoolbar?dragDropData=[getNewObject(dragDropData)]:n.isobjectbased&&(dragDropDataObject=n.dragdata,dragDropData=n.dragdata.ShortName,n.displaypath&&(dragDropData=n.displaypath+"."+n.dragdata.ShortName))))}var i=t[0];i.draggable=!0;i.addEventListener("dragstart",r,!1)}}}]);app.directive("customdroppable",["$rootScope","$timeout",function(){return{restrict:"A",scope:{dropdata:"="},link:function(n,t){function r(t){return canDrop(dragDropData,n.dropdata)&&(t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect="move",t.dataTransfer.setData("Text",""),t.preventDefault()),!1}function u(t){if(t.target.localName!="span"||t.target.contentEditable!="true"){var i=dragDropData;i!=undefined&&i!=null&&i!=""&&addItemOnDrop(i,n.dropdata,t);dragDropData=null}}var i=t[0];i.addEventListener("dragover",r,!1);i.addEventListener("drop",u,!1)}}}]);dragDropData=null;dragDropDataObject=null;String.prototype.contains=function(n){return this.indexOf(n)>-1};app.directive("rowconditionitemdirective",["$compile","ngDialog","$rootScope",function(n,t,i){var r=function(n,t){if(n.length>0)for(var i=0,i=0;i<n.length;i++)n[i].Item!=undefined&&n[i].Item.ItemType=="assignheader"&&n[i].Item.DataHeaderID==t.Item.DataHeaderID&&(n[i].Item.Expression=t.Item.Expression),n[i].Cells!=undefined&&r(n[i].Cells,t)};return{restrict:"A",scope:{items:"=",logicalrule:"=",rciviewmode:"="},templateUrl:"Rule/views/DecisionTable/rowconditionitem.html",link:function(t){t.init=function(){t.conditionType="default";t.items.Item.ItemType=="notesheader"||t.items.Item.ItemType=="returnheader"?t.conditionType="1":t.items.Item.ItemType=="colheader"||t.items.Item.ItemType=="rowheader"?t.conditionType="2":t.items.Item.ItemType=="assignheader"?t.conditionType="3":t.items.Item.ItemType!="notesheader"&&t.items.Item.ItemType!="returnheader"&&t.items.Item.ItemType!="colheader"&&t.items.Item.ItemType!="rowheader"&&t.items.Item.ItemType!="assignheader"&&t.items.Item.ItemType!="notes"&&(t.conditionType="4")};t.getclass=function(n){var i="";return n!=undefined&&(i=n.Item.IsSelected?"decision-table-selection":n.Item.ItemType=="if"?"dt-if":n.Item.ItemType=="colheader"||n.Item.ItemType=="rowheader"?"dt-row-col-header":n.Item.ItemType=="assignheader"||n.Item.ItemType=="notesheader"||n.Item.ItemType=="returnheader"?"dt-assign-header":"dt-assign",n.Item.isAdvanceSearched&&(i+=" bckgGrey"),n.Item.IsSelected&&n.Item.isAdvanceSearched&&(i+=" bckgGreen")),i+(t.rciviewmode=="Developer View"?" inner-div":" inner-div-analystview")};t.columnnamechange=function(){r(t.logicalrule.Rows,t.items)};t.onActionKeyDown=function(n){if(controllerScope=getCurrentFileScope(),controllerScope)controllerScope.onActionKeyDown(n)};t.notesdailog=function(n){if(n.Item.ItemType=="notes"){var r=t.$new(),f=JSON.stringify(n.Item),u=JSON.parse(f);u.Value=n.Item.NotesValue;r.objText=u;r.dialog=i.showDialog(r,"Edit Notes","Rule/views/EditNotesTemplate.html",{width:400,height:400});r.SaveChangedTextData=function(){i.EditPropertyValue(n.Item.NotesValue,n.Item,"NotesValue",r.objText.Value);r.onCancelClick()};r.onCancelClick=function(){r.dialog&&r.dialog.close()}}};t.AddContentEditable=function(r){if($(r.currentTarget).attr("content-editable")==undefined){var u=$(r.currentTarget),f=$(r.currentTarget).text().length,e=u.attr("data-condition-type"),o=u;u.attr("ng-model",$(r.currentTarget).attr("bindpropertyname"));u.attr("content-editable","");t.items.Item.ItemType=="assignheader"&&u.attr("ng-change","columnnamechange()");e=="Expression"&&(o=u.closest("[expression-wrapper]"));n(o)(t);setTimeout(function(){var n=$("#"+i.currentopenfile.file.FileName).find("#"+t.items.Item.NodeID+" span[data-condition-type= '"+e+"']");n&&n.length>0&&(n.first().focus(),setSelectionByCharacterOffsets(n[0],f,f))},4)}};t.init()}}}]);app.directive("rowconditiondirective",["$compile","$rootScope",function(n,t){var i=function(n,i,r,u){var h=generateUUID(),a,c,l,o,f,s,e,v;for(t.UndRedoBulkOp("Start"),a={DataHeaderID:"",Description:"",Expression:"",ItemType:"dataheader",NodeID:h},o=0;o<u.DataHeaders.length;o++)if(u.DataHeaders[o].NodeID==r.objChild.Item.DataHeaderID){t.InsertItem(a,u.DataHeaders,o+1);break}for(c=u.Rows.indexOf(n),f=c;f<u.Rows.length;f++)for(e=0;e<u.Rows[f].Cells.length;e++)u.Rows[f].Cells[e].Item.DataHeaderID==r.objChild.Item.DataHeaderID&&(u.Rows[f].Cells[e].Item.ItemType=="assignheader"||u.Rows[f].Cells[e].Item.ItemType=="notesheader"||u.Rows[f].Cells[e].Item.ItemType=="returnheader"?(i=="actions"?itemName="assignheader":i=="notes"?itemName="notesheader":i=="return"&&(itemName="returnheader"),l={Colspan:"1",Rowspan:"1",Item:{DataHeaderID:h,Description:"",Expression:"",ItemType:itemName,NodeID:generateUUID()}}):(u.Rows[f].Cells[e].Item.ItemType=="assign"||u.Rows[f].Cells[e].Item.ItemType=="notes"||u.Rows[f].Cells[e].Item.ItemType=="return")&&(i=="actions"?itemName="assign":i=="notes"?itemName="notes":i=="return"&&(itemName="return"),l=i=="notes"?{Colspan:"1",Rowspan:"1",Item:{DataHeaderID:h,Description:"",Expression:"",ItemType:itemName,NodeID:generateUUID(),NotesValue:""}}:{Colspan:"1",Rowspan:"1",Item:{DataHeaderID:h,Description:"",Expression:"",ItemType:itemName,NodeID:generateUUID()}}),t.InsertItem(l,u.Rows[f].Cells,e+1));if(c>0)for(o=0;o<n.Cells.length;o++)if(n.Cells[o].Item.DataHeaderID==r.objChild.Item.DataHeaderID)for(f=c-1;f>=0;f--)for(s=0,e=0;e<u.Rows[f].Cells.length;e++)if(u.Rows[f].Cells[e].Item.ItemType=="colheader"&&(s=u.Rows[f].Cells[e].Colspan),u.Rows[f].Cells[e].Item.ItemType=="if")if(v=s+u.Rows[f].Cells[e].Colspan,v>o&&s<=o){t.EditPropertyValue(u.Rows[f].Cells[e].Colspan,u.Rows[f].Cells[e],"Colspan",u.Rows[f].Cells[e].Colspan+1);break}else s=s+u.Rows[f].Cells[e].Colspan;t.UndRedoBulkOp("End")},r=function(n,i,r){for(var h,a,s,v,u,e,o=r.Rows.indexOf(n),c=0,l=0,f=0;f<n.Cells.length;f++)(n.Cells[f].Item.ItemType=="assignheader"||n.Cells[f].Item.ItemType=="notesheader"||n.Cells[f].Item.ItemType=="returnheader")&&c++;if(o>0)for(h=0;h<r.Rows[o-1].Cells.length;h++)r.Rows[o-1].Cells[h].Item.ItemType=="if"&&l++;if(isvalid=!0,isreturnpresent=!1,i.objChild.Item.ItemType=="assignheader"&&o>-1){for(a=i.objChild.Item.DataHeaderID,u=0;u<r.Rows[o].Cells.length;u++){if(r.Rows[o].Cells[u].Item.ItemType=="returnheader"){isreturnpresent=!0;break}if(r.Rows[o].Cells[u].Item.ItemType=="assignheader")if(r.Rows[o].Cells[u].Item.DataHeaderID==a)isvalid=!1;else{isvalid=!0;break}}isreturnpresent&&(isvalid=!0)}if(i.objChild.Item.ItemType=="returnheader"&&o>-1)for(u=0;u<r.Rows[o].Cells.length;u++)if(r.Rows[o].Cells[u].Item.ItemType=="assignheader"){isvalid=!0;break}else if(r.Rows[o].Cells[u].Item.ItemType=="returnheader"&&r.Rows[o].Cells[u].Item.DataHeaderID!=i.objChild.Item.DataHeaderID){isvalid=!0;break}else isvalid=!1;if(c<2||c==l||!isvalid)alert("Atleast one action column should be present");else{for(t.UndRedoBulkOp("Start"),u=0;u<r.DataHeaders.length;u++)if(r.DataHeaders[u].NodeID==i.objChild.Item.DataHeaderID){t.DeleteItem(r.DataHeaders[u],r.DataHeaders);break}if(o=r.Rows.indexOf(n),o>0){for(u=0;u<n.Cells.length;u++)if(n.Cells[u].Item.DataHeaderID==i.objChild.Item.DataHeaderID){for(e=o-1;e>=0;e--)for(s=0,f=0;f<r.Rows[e].Cells.length;f++)if(r.Rows[e].Cells[f].Item.ItemType=="colheader"&&(s=r.Rows[e].Cells[f].Colspan),r.Rows[e].Cells[f].Item.ItemType=="if")if(v=s+r.Rows[e].Cells[f].Colspan,v>u&&s<=u){t.EditPropertyValue(r.Rows[e].Cells[f].Colspan,r.Rows[e].Cells[f],"Colspan",r.Rows[e].Cells[f].Colspan-1);break}else s=s+r.Rows[e].Cells[f].Colspan;t.DeleteItem(n.Cells[u],n.Cells)}}else for(u=0;u<n.Cells.length;u++)n.Cells[u].Item.DataHeaderID==i.objChild.Item.DataHeaderID&&t.DeleteItem(n.Cells[u],n.Cells);for(e=o+1;e<r.Rows.length;e++)for(f=0;f<r.Rows[e].Cells.length;f++)r.Rows[e].Cells[f].Item.DataHeaderID==i.objChild.Item.DataHeaderID&&t.DeleteItem(r.Rows[e].Cells[f],r.Rows[e].Cells);t.UndRedoBulkOp("End")}},f=function(n,i,r,u){var c=u.Rows.indexOf(n),y,l,h,s,p,o,f,e;if(t.UndRedoBulkOp("Start"),i=="Right"){for(f=c;f<u.Rows.length;f++)for(e=0;e<u.Rows[f].Cells.length;e++)if(u.Rows[f].Cells[e].Item.ItemType=="rowheader"){if(r.objChild.Item.NodeID==u.Rows[f].Cells[e].Item.NodeID){o=generateUUID();var a=u.Rows[f].Cells[e].Item.Description,v=u.Rows[f].Cells[e].Item.Expression,s={Colspan:"1",Rowspan:"1",Item:{Description:a,Expression:v,ItemType:"rowheader",NodeID:o}};t.InsertItem(s,u.Rows[f].Cells,e+1)}}else if(u.Rows[f].Cells[e].Item.ItemType=="if"&&r.objChild.Item.NodeID==u.Rows[f].Cells[e].Item.HeaderID){var l=u.Rows[f].Cells[e].Rowspan,a=u.Rows[f].Cells[e].Item.Description,v=u.Rows[f].Cells[e].Item.Expression,s={Colspan:"1",Rowspan:l,Item:{Description:a,Expression:v,ItemType:"if",NodeID:generateUUID(),HeaderID:o}};t.InsertItem(s,u.Rows[f].Cells,e+1)}}else if(i=="Left")if(y=u.Rows[c].Cells.indexOf(r.objChild),y==0){for(o=generateUUID(),l=0,f=c;f<u.Rows.length;f++){for(e=0;e<u.Rows[f].Cells.length;e++)if(u.Rows[f].Cells[e].Item.ItemType=="rowheader"){if(r.objChild.Item.NodeID==u.Rows[f].Cells[e].Item.NodeID){s={Colspan:"1",Rowspan:"1",Item:{Description:"",Expression:"",ItemType:"rowheader",NodeID:o}};t.InsertItem(s,u.Rows[f].Cells,e);break}}else u.Rows[f].Cells[e].Item.ItemType=="if"&&r.objChild.Item.NodeID==u.Rows[f].Cells[e].Item.HeaderID&&(l+=u.Rows[f].Cells[e].Rowspan,h==undefined&&(h=f));u.Rows[f].Cells.length>u.Rows[f].conditionitemcount&&(u.Rows[f].conditionitemcount+=30)}s={Colspan:"1",Rowspan:l,Item:{Description:"",Expression:"",ItemType:"if",NodeID:generateUUID(),HeaderID:o}};u.Rows[h]&&u.Rows[h].Cells&&(t.InsertItem(s,u.Rows[h].Cells,0),u.Rows[h].Cells.length>u.Rows[h].conditionitemcount&&(u.Rows[h].conditionitemcount+=30))}else for(p=u.Rows[c].Cells[y-1],f=c;f<u.Rows.length;f++){for(e=0;e<u.Rows[f].Cells.length;e++)if(u.Rows[f].Cells[e].Item.ItemType=="rowheader"){if(p.Item.NodeID==u.Rows[f].Cells[e].Item.NodeID){o=generateUUID();var a=u.Rows[f].Cells[e].Item.Description,v=u.Rows[f].Cells[e].Item.Expression,s={Colspan:"1",Rowspan:"1",Item:{Description:a,Expression:v,ItemType:"rowheader",NodeID:o}};t.InsertItem(s,u.Rows[f].Cells,e+1);break}}else if(u.Rows[f].Cells[e].Item.ItemType=="if"&&p.Item.NodeID==u.Rows[f].Cells[e].Item.HeaderID){var l=u.Rows[f].Cells[e].Rowspan,a=u.Rows[f].Cells[e].Item.Description,v=u.Rows[f].Cells[e].Item.Expression,s={Colspan:"1",Rowspan:l,Item:{Description:a,Expression:v,ItemType:"if",NodeID:generateUUID(),HeaderID:o}};t.InsertItem(s,u.Rows[f].Cells,e+1);break}u.Rows[f].Cells.length>u.Rows[f].conditionitemcount&&(u.Rows[f].conditionitemcount+=30)}for(f=0;f<u.Rows.length;f++)for(e=0;e<u.Rows[f].Cells.length;e++)if(u.Rows[f].Cells[e].Item.ItemType=="colheader"){t.EditPropertyValue(u.Rows[f].Cells[e].Colspan,u.Rows[f].Cells[e],"Colspan",u.Rows[f].Cells[e].Colspan+1);break}t.UndRedoBulkOp("End")},u=function(n,i,r,u){var e=u.Rows.indexOf(n),h,o,f,s;if(t.UndRedoBulkOp("Start"),i=="Top")if(e>0){for(o={Cells:[]},f=0;f<u.Rows[e-1].Cells.length;f++)colspan=u.Rows[e-1].Cells[f].Colspan,rowspan=u.Rows[e-1].Cells[f].Rowspan,itemName=u.Rows[e-1].Cells[f].Item.ItemType,descriprion=u.Rows[e-1].Cells[f].Item.Description,expression=u.Rows[e-1].Cells[f].Item.Expression,itemName=="colheader"?(s=generateUUID(),cell={Colspan:colspan,Rowspan:rowspan,Item:{Description:descriprion,Expression:expression,ItemType:itemName,NodeID:s}}):cell={Colspan:colspan,Rowspan:rowspan,Item:{Description:descriprion,Expression:expression,ItemType:itemName,NodeID:generateUUID(),HeaderID:s}},o.Cells.splice(f,0,cell);t.InsertItem(o,u.Rows,e)}else{var o={Cells:[]},s=generateUUID(),c=0,l;for(f=0;f<u.Rows.length;f++)for(h=0;h<u.Rows[f].Cells.length;h++)u.Rows[f].Cells[h].Item.ItemType=="rowheader"&&(l=u.Rows[f].Cells.length,c++);u.Rows[e].Cells[0].Item.ItemType=="colheader"?(descriprion=u.Rows[e].Cells[0].Item.Description,expression=u.Rows[e].Cells[0].Item.Expression):(descriprion="",expression="");cell={Colspan:c,Rowspan:1,Item:{Description:descriprion,Expression:expression,ItemType:"colheader",NodeID:s}};o.Cells.push(cell);cell={Colspan:l-c,Rowspan:1,Item:{Description:"",Expression:"",ItemType:"if",NodeID:generateUUID(),HeaderID:s}};o.Cells.push(cell);t.InsertItem(o,u.Rows,0)}else if(i=="Bottom"){for(o={Cells:[]},f=0;f<u.Rows[e].Cells.length;f++)colspan=u.Rows[e].Cells[f].Colspan,rowspan=u.Rows[e].Cells[f].Rowspan,itemName=u.Rows[e].Cells[f].Item.ItemType,descriprion=u.Rows[e].Cells[f].Item.Description,expression=u.Rows[e].Cells[f].Item.Expression,itemName=="colheader"?(s=generateUUID(),cell={Colspan:colspan,Rowspan:rowspan,Item:{Description:descriprion,Expression:expression,ItemType:itemName,NodeID:s}}):cell={Colspan:colspan,Rowspan:rowspan,Item:{Description:descriprion,Expression:expression,ItemType:itemName,NodeID:generateUUID(),HeaderID:s}},o.Cells.splice(f,0,cell);t.InsertItem(o,u.Rows,e+1)}t.UndRedoBulkOp("End")},e=function(n,i,r){var e,v,y,d,st,h,l,a,ht,c,p,nt,k,ct,tt,it,rt,lt,o,yt,ft,s,et,w,ot,g,f,u;if(t.UndRedoBulkOp("Start"),e=r.Rows.indexOf(n),i.objChild.Item.ItemType=="colheader")if(r.Rows[e+1].Cells[0].Item.ItemType!="rowheader")t.DeleteItem(r.Rows[e],r.Rows);else{for(u=0;u<r.Rows[e+1].Cells.length;u++)if(r.Rows[e+1].Cells[u].Item.ItemType=="assignheader"||r.Rows[e+1].Cells[u].Item.ItemType=="notesheader"||r.Rows[e+1].Cells[u].Item.ItemType=="returnheader"){k=r.Rows[e+1].Cells[u];break}if(e==0||e>0&&r.Rows[e-1].Cells.length==2){for(f=e+1;f<r.Rows.length;f++)for(b=0,u=0;u<r.Rows[f].Cells.length;u++)r.Rows[f].Cells[u].Item.DataHeaderID==k.Item.DataHeaderID&&b++,b>1&&(t.DeleteItem(r.Rows[f].Cells[u],r.Rows[f].Cells),u--);e>0&&t.EditPropertyValue(r.Rows[e-1].Cells[1].Colspan,r.Rows[e-1].Cells[1],"Colspan",r.Rows[e+1].Cells.length-r.Rows[e-1].Cells[0].Colspan);t.DeleteItem(r.Rows[e],r.Rows)}else{for(f=0;f<r.Rows[e-1].Cells.length-1;f++){for(r.Rows[e-1].Cells[f].Item.ItemType=="colheader"&&(d=r.Rows[e-1].Cells[f].Colspan),r.Rows[e-1].Cells[f+1].Item.ItemType=="if"&&(st=d+r.Rows[e-1].Cells[f+1].Colspan),u=0;u<r.Rows[e].Cells.length-1;u++)if(r.Rows[e].Cells[u].Item.ItemType=="colheader"&&(h=r.Rows[e].Cells[u].Colspan),r.Rows[e].Cells[u+1].Item.ItemType=="if"&&(l=h+r.Rows[e].Cells[u+1].Colspan),d==h)if(v==undefined){for(v=[],o=e+1;o<r.Rows.length;o++){for(a=[],s=0;s<r.Rows[o].Cells.length;s++)y==undefined&&(y=r.Rows[o].Cells.length),y==r.Rows[o].Cells.length?(l>s&&h<=s&&a.push(r.Rows[o].Cells[s]),r.Rows[o].Cells[s].Item.ItemType=="rowheader"?a.push(r.Rows[o].Cells[s]):r.Rows[o].Cells[s].Item.ItemType=="if"&&a.push(r.Rows[o].Cells[s])):(p=y-r.Rows[o].Cells.length,l-p>s&&h-p<=s&&a.push(r.Rows[o].Cells[s]),r.Rows[o].Cells[s].Item.ItemType=="rowheader"?a.push(r.Rows[o].Cells[s]):r.Rows[o].Cells[s].Item.ItemType=="if"&&a.push(r.Rows[o].Cells[s]));ht={Cells:a};v.push(ht)}h=l}else{for(c=0,o=e+1;o<r.Rows.length;o++){for(s=0;s<r.Rows[o].Cells.length;s++)y==r.Rows[o].Cells.length?l>s&&h<=s&&v[c].Cells.push(r.Rows[o].Cells[s]):(p=y-r.Rows[o].Cells.length,l-p>s&&h-p<=s&&v[c].Cells.push(r.Rows[o].Cells[s]));c++}h=l}else h=l;d=st}for(nt=0,f=e+1;f<r.Rows.length;f++)r.Rows[f]=v[nt],nt++;for(t.DeleteItem(r.Rows[e],r.Rows),u=0;u<r.Rows[e+1].Cells.length;u++)if(r.Rows[e+1].Cells[u].Item.ItemType=="assignheader"||r.Rows[e+1].Cells[u].Item.ItemType=="notesheader"||r.Rows[e+1].Cells[u].Item.ItemType=="assignheader"){k=r.Rows[e+1].Cells[u];break}for(tt=0,u=0;u<r.Rows[e+1].Cells.length;u++)if(r.Rows[e+1].Cells[u].Item.DataHeaderID==k.Item.DataHeaderID)if(tt>0){ct=u;break}else tt++;for(rt=0,o=0;o<r.Rows[e-1].Cells.length;o++)r.Rows[e-1].Cells[o].Item.ItemType=="colheader"&&(it=ct-r.Rows[e-1].Cells[o].Colspan),r.Rows[e-1].Cells[o].Item.ItemType=="if"&&(t.EditPropertyValue(r.Rows[e-1].Cells[o].Colspan,r.Rows[e-1].Cells[o],"Colspan",it),rt+=it);if(e-1>0)for(f=e-2;f>=0;f--)for(u=0;u<r.Rows[f].Cells.length;u++)lt=rt/(r.Rows[f].Cells.length-1),r.Rows[f].Cells[u].Item.ItemType=="if"&&t.EditPropertyValue(r.Rows[f].Cells[u].Colspan,r.Rows[f].Cells[u],"Colspan",lt)}}else if(i.objChild.Item.ItemType=="rowheader"){var b=0,at=0,ut=n.Cells.indexOf(i.objChild),vt=!1;for(n.Cells[ut+1].Item.ItemType=="rowheader"&&(vt=!0),o=0;o<n.Cells.length;o++)i.objChild.Item.ItemType==n.Cells[o].Item.ItemType&&b++;if(b<2)alert("Atleast one  Row condition should be present");else{for(f=e;f<r.Rows.length;f++)for(u=0;u<r.Rows[f].Cells.length;u++)if(r.Rows[f].Cells[u].Item.ItemType=="rowheader"){if(r.Rows[f].Cells[u].Item.NodeID==i.objChild.Item.NodeID){t.DeleteItem(r.Rows[f].Cells[u],r.Rows[f].Cells);break}}else if(r.Rows[f].Cells[u].Item.ItemType=="if"&&r.Rows[f].Cells[u].Item.HeaderID==i.objChild.Item.NodeID){t.DeleteItem(r.Rows[f].Cells[u],r.Rows[f].Cells);at++;break}if(ut>0){for(yt=n.Cells[ut-1].Item.NodeID,ft=0,s=e+1;s<r.Rows.length;s++)for(c=0;c<r.Rows[s].Cells.length;c++)if(r.Rows[s].Cells[c].Item.HeaderID==yt&&r.Rows[s].Cells[c].Item.ItemType=="if"){ft++;break}for(et=0,w=0,f=0;f<r.Rows.length;f++)et<r.Rows[f].Cells.length&&(et=r.Rows[f].Cells.length),(w==0||w>r.Rows[f].Cells.length)&&(w=r.Rows[f].Cells.length);if(!vt&&ft!=at)for(f=r.Rows.length-1;f>=0;f--)if(r.Rows[f].Cells.length==w&&r.Rows[f].Cells[0].Item.ItemType!="rowheader"&&r.Rows[f].Cells[0].Item.ItemType!="colheader"){for(ot=w,g=undefined,u=f-1;u>=0;u--)if(r.Rows[u].Cells.length>ot&&r.Rows[u].Cells[0].Item.ItemType=="if")for(o=0;o<r.Rows[u].Cells.length;o++)if(r.Rows[u].Cells[o].Item.ItemType=="if"&&(g==undefined||r.Rows[u].Cells[o].Item.HeaderID!=g))t.EditPropertyValue(r.Rows[u].Cells[o].Rowspan,r.Rows[u].Cells[o],"Rowspan",r.Rows[u].Cells[o].Rowspan-1);else{ot=r.Rows[u].Cells.length;g=r.Rows[u].Cells[0].Item.HeaderID;break}t.DeleteItem(r.Rows[f],r.Rows)}}for(f=0;f<r.Rows.length;f++)for(u=0;u<r.Rows[f].Cells.length;u++)if(r.Rows[f].Cells[u].Item.ItemType=="colheader"){t.EditPropertyValue(r.Rows[f].Cells[u].Colspan,r.Rows[f].Cells[u],"Colspan",r.Rows[f].Cells[u].Colspan-1);break}}}t.UndRedoBulkOp("End")},o=function(n,i,r,u){var h,l,a,y,f,e;for(t.UndRedoBulkOp("Start"),h=0,f=0;f<u.Rows.length;f++)h<u.Rows[f].Cells.length&&(h=u.Rows[f].Cells.length);var s=u.Rows.indexOf(n),c=n.Cells.length,v=u.Rows[s].Cells.indexOf(r.objChild),o=[];if(i=="RowCondition"){for(f=s;f<u.Rows.length;f++)if(c==h&&v==0)if(u.Rows[f].Cells.length<c||f==s){var p={Cells:u.Rows[f].Cells},w=JSON.stringify(p),b=JSON.parse(w);o.push(b)}else break;else if(l=[],u.Rows[f].Cells.length<c-v||f==s){if(f==s)for(e=v;e<u.Rows[f].Cells.length;e++)l.push(u.Rows[f].Cells[e]);else for(e=0;e<u.Rows[f].Cells.length;e++)l.push(u.Rows[f].Cells[e]);var p={Cells:l},w=JSON.stringify(p),b=JSON.parse(w);o.push(b)}else break;for(f=0;f<o.length;f++)for(e=0;e<o[f].Cells.length;e++)o[f].Cells[e].Item.NodeID=generateUUID();for(a=0,f=s;f<u.Rows.length;f++)if(a<o.length)t.InsertItem(o[a],u.Rows,f+o.length),a++;else break;for(y=r.objChild.Item.HeaderID,f=s;f>=0;f--)if(u.Rows[f].Cells.length>=c){for(e=0;e<u.Rows[f].Cells.length;e++)if(u.Rows[f].Cells[e].Item.HeaderID==y){y=u.Rows[f].Cells[0].Item.HeaderID;c=u.Rows[f].Cells.length;break}else t.EditPropertyValue(u.Rows[f].Cells[e].Rowspan,u.Rows[f].Cells[e],"Rowspan",u.Rows[f].Cells[e].Rowspan+o.length);if(u.Rows[f].Cells.length==h)break}}t.UndRedoBulkOp("End")},s=function(n,i,r,u){for(var h,a,p,b,e,s=0,f=0;f<u.Rows.length;f++)s<u.Rows[f].Cells.length&&(s=u.Rows[f].Cells.length);for(h=0,e=0;e<u.Rows.length;e++)u.Rows[e].Cells.length==s&&u.Rows[e].Cells[0].Item.ItemType=="if"&&h++;if(h<2&&n.Cells.length==s)alert("Atleast one condition should be present");else{t.UndRedoBulkOp("Start");var o=u.Rows.indexOf(n),w=o,v=n.Cells.length,y=u.Rows[o].Cells.indexOf(r.objChild),h=0,c;if(i=="RowCondition"){for(f=o;f<u.Rows.length;f++)if(v==s&&y==0)if(u.Rows[f].Cells.length<v||f==o)t.DeleteItem(u.Rows[f],u.Rows),o-=1,w-=1,f--;else break;else if(u.Rows[f].Cells.length<v-y||f==o){if(h++,c==undefined)for(a=0;a<u.Rows[f].Cells.length;a++)if(u.Rows[f].Cells[a].Rowspan==r.objChild.Rowspan){y=a;c=u.Rows[f].Cells[a];break}if(y==0&&f==o)t.DeleteItem(u.Rows[f],u.Rows),w-=1,o-=1,f--;else if(f==o)if(r.objChild.Rowspan==u.Rows[f].Cells[0].Rowspan&&u.Rows[f].Cells.length==s)t.DeleteItem(u.Rows[f],u.Rows),h=0;else{for(e=y;e<u.Rows[f].Cells.length;e++)t.DeleteItem(u.Rows[f].Cells[e],u.Rows[f].Cells),e--;for(l=1;u.Rows.length;l++)if(u.Rows[f+l].Cells[0].Item.HeaderID==c.Item.HeaderID){for(p=0;p<u.Rows[f+l].Cells.length;p++)t.PushItem(u.Rows[f+l].Cells[p],u.Rows[f].Cells);break}else t.DeleteItem(u.Rows[f+l],u.Rows),l--;t.DeleteItem(u.Rows[f+l],u.Rows);h=c.Rowspan;break}else t.DeleteItem(u.Rows[f],u.Rows),f--}else break;for(b=c!=undefined?c.Item.HeaderID:r.objChild.Item.HeaderID,f=w;f>=0;f--)if(u.Rows[f].Cells.length>=v){for(e=0;e<u.Rows[f].Cells.length;e++)if(u.Rows[f].Cells[e].Item.HeaderID==b){b=u.Rows[f].Cells[0].Item.HeaderID;v=u.Rows[f].Cells.length;break}else t.EditPropertyValue(u.Rows[f].Cells[e].Rowspan,u.Rows[f].Cells[e],"Rowspan",u.Rows[f].Cells[e].Rowspan-h);if(u.Rows[f].Cells.length==s)break}}t.UndRedoBulkOp("End")}},h=function(n,i,r,u){for(var y,l,s,v,w,a,o,d,f,c,h,p=0,e=0;e<u.Rows.length;e++)p<u.Rows[e].Cells.length&&(p=u.Rows[e].Cells.length);for(s=[],f=0;f<n.Cells.length;f++)if(n.Cells[f].Item.ItemType=="colheader"&&(y=n.Cells[f].Colspan),n.Cells[f].Item.ItemType=="if"&&(l=y+n.Cells[f].Colspan),l!=undefined)if(r.objChild.Item.NodeID==n.Cells[f].Item.NodeID)break;else y=l;var b=u.Rows.indexOf(n),it=n.Cells.length,rt=u.Rows[b].Cells.indexOf(r.objChild);if(i=="ColumnCondition"){for(t.UndRedoBulkOp("Start"),e=b;e<u.Rows.length;e++){var c=0,h=0,k=[];for(f=0;f<u.Rows[e].Cells.length;f++)u.Rows[e].Cells[0].Item.ItemType=="colheader"?(u.Rows[e].Cells[f].Item.ItemType=="colheader"&&(c=u.Rows[e].Cells[f].Colspan),u.Rows[e].Cells[f].Item.ItemType=="if"&&(h=c+u.Rows[e].Cells[f].Colspan),h!=0&&(y<=c&&l>=h?(k.push(u.Rows[e].Cells[f]),c=h):c=h)):u.Rows[e].Cells.length==p?l>f&&y<=f&&k.push(u.Rows[e].Cells[f]):(w=p-u.Rows[e].Cells.length,l-w>f&&y-w<=f&&k.push(u.Rows[e].Cells[f]));var g={Cells:k},nt=JSON.stringify(g),tt=JSON.parse(nt);s.push(tt)}for(e=0;e<s.length;e++)for(f=0;f<s[e].Cells.length;f++)s[e].Cells[f].$$hashKey=generateUUID()+"",s[e].Cells[f].Item.NodeID=generateUUID();for(v=0,e=b;e<u.Rows.length;e++){var c=0,h=0,k=[];for(f=0;f<u.Rows[e].Cells.length;f++)if(u.Rows[e].Cells[0].Item.ItemType=="colheader"){if(u.Rows[e].Cells[f].Item.ItemType=="colheader"&&(c=u.Rows[e].Cells[f].Colspan),u.Rows[e].Cells[f].Item.ItemType=="if"&&(h=c+u.Rows[e].Cells[f].Colspan),h!=0)if(l==h){for(a=1,o=0;o<s[v].Cells.length;o++)t.InsertItem(s[v].Cells[o],u.Rows[e].Cells,f+a),a++;break}else c=h}else if(u.Rows[e].Cells.length==p){if(l-1==f){for(a=1,o=0;o<s[v].Cells.length;o++)t.InsertItem(s[v].Cells[o],u.Rows[e].Cells,f+a),a++;break}}else if(w=p-u.Rows[e].Cells.length,l-1-w==f){for(a=1,o=0;o<s[v].Cells.length;o++)t.InsertItem(s[v].Cells[o],u.Rows[e].Cells,f+a),a++;break}v++}for(d=0,e=0;e<s.length;e++)d<s[e].Cells.length&&(d=s[e].Cells.length);for(f=b-1;f>=0;f--)for(c=0,h=0,o=0;o<u.Rows[f].Cells.length;o++)if(u.Rows[f].Cells[0].Item.ItemType=="colheader"&&(u.Rows[f].Cells[o].Item.ItemType=="colheader"&&(c=u.Rows[f].Cells[o].Colspan),u.Rows[f].Cells[o].Item.ItemType=="if"&&(h=c+u.Rows[f].Cells[o].Colspan),h!=0))if(c<=y&&h>=l){t.EditPropertyValue(u.Rows[f].Cells[o].Colspan,u.Rows[f].Cells[o],"Colspan",u.Rows[f].Cells[o].Colspan+d);break}else c=h;t.UndRedoBulkOp("End")}},c=function(n,i,r,u){var l,h,c,v,p,f,o,s,w,e;if(n.Cells.length==2)alert("Atleast one condition should be present");else{for(t.UndRedoBulkOp("Start"),l=0,e=0;e<u.Rows.length;e++)l<u.Rows[e].Cells.length&&(l=u.Rows[e].Cells.length);for(v=[],f=0;f<n.Cells.length;f++)if(n.Cells[f].Item.ItemType=="colheader"&&(h=n.Cells[f].Colspan),n.Cells[f].Item.ItemType=="if"&&(c=h+n.Cells[f].Colspan),c!=undefined)if(r.objChild.Item.NodeID==n.Cells[f].Item.NodeID)break;else h=c;var y=u.Rows.indexOf(n),nt=n.Cells.length,tt=u.Rows[y].Cells.indexOf(r.objChild);if(i=="ColumnCondition")for(e=y;e<u.Rows.length;e++){var o=0,s=0,a=[];for(f=0;f<u.Rows[e].Cells.length;f++)u.Rows[e].Cells[0].Item.ItemType=="colheader"?(u.Rows[e].Cells[f].Item.ItemType=="colheader"&&(o=u.Rows[e].Cells[f].Colspan,a.push(u.Rows[e].Cells[f])),u.Rows[e].Cells[f].Item.ItemType=="if"&&(s=o+u.Rows[e].Cells[f].Colspan),s!=0&&(h<=o&&c>=s?o=s:(a.push(u.Rows[e].Cells[f]),o=s))):u.Rows[e].Cells.length==l?c>f&&h<=f||a.push(u.Rows[e].Cells[f]):(p=l-u.Rows[e].Cells.length,c-p>f&&h-p<=f||a.push(u.Rows[e].Cells[f]));var b={Cells:a},d=JSON.stringify(b),g=JSON.parse(d);v.push(g)}for(f=y-1;f>=0;f--)for(o=0,s=0,k=0;k<u.Rows[f].Cells.length;k++)if(u.Rows[f].Cells[0].Item.ItemType=="colheader"&&(u.Rows[f].Cells[k].Item.ItemType=="colheader"&&(o=u.Rows[f].Cells[k].Colspan),u.Rows[f].Cells[k].Item.ItemType=="if"&&(s=o+u.Rows[f].Cells[k].Colspan),s!=0))if(o<=h&&s>=c){u.Rows[f].Cells[k].Colspan!=r.objChild.Colspan?t.EditPropertyValue(u.Rows[f].Cells[k].Colspan,u.Rows[f].Cells[k],"Colspan",u.Rows[f].Cells[k].Colspan-r.objChild.Colspan):t.DeleteItem(u.Rows[f].Cells[k],u.Rows[f].Cells);break}else o=s;for(w=y;w<u.Rows.length;)t.DeleteItem(u.Rows[w],u.Rows);for(e=0;e<v.length;e++)t.PushItem(v[e],u.Rows);t.UndRedoBulkOp("End")}};return{restrict:"A",scope:{items:"=",logicalrule:"=",rcviewmode:"=",returntype:"="},template:'<td rowconditionitemdirective ng-repeat="objChild in items.Cells" items="objChild" context-menu="menuOptionsforitems" valign="top" rowspan={{objChild.Rowspan}} colspan={{objChild.Colspan}} class="dt-table-cell"  logicalrule="logicalrule" rciviewmode="rcviewmode" ng-mousedown="objStepSelectionChanged(objChild)"><\/td>',link:function(n){n.menuOptionsforitems=[["Add Condition ",function(t){var i=n.items;o(i,"RowCondition",t,n.logicalrule)},function(t){var i=n.items;return t.objChild.Item.ItemType=="if"&&i.Cells[0].Item.ItemType=="if"}],null,["Delete Condition",function(t){var i=n.items;s(i,"RowCondition",t,n.logicalrule)},function(t){var i=n.items;return t.objChild.Item.ItemType=="if"&&i.Cells[0].Item.ItemType=="if"}],null,["Add Condition ",function(t){var i=n.items;h(i,"ColumnCondition",t,n.logicalrule)},function(t){var i=n.items;return t.objChild.Item.ItemType=="if"&&i.Cells[0].Item.ItemType=="colheader"}],null,["Delete Condition",function(t){var i=n.items;c(i,"ColumnCondition",t,n.logicalrule)},function(t){var i=n.items;return t.objChild.Item.ItemType=="if"&&i.Cells[0].Item.ItemType=="colheader"}],null,["Add Action ",function(t){var r=n.items;i(r,"actions",t,n.logicalrule)},function(n){return(n.objChild.Item.ItemType.match(/assignheader/)||n.objChild.Item.ItemType.match(/returnheader/)||n.objChild.Item.ItemType.match(/notesheader/))!=null}],null,["Add Return ",function(t){var r=n.items;i(r,"return",t,n.logicalrule)},function(t){return(t.objChild.Item.ItemType.match(/assignheader/)||t.objChild.Item.ItemType.match(/returnheader/)||t.objChild.Item.ItemType.match(/notesheader/))!=null&&n.returntype}],null,["Add Notes ",function(t){var r=n.items;i(r,"notes",t,n.logicalrule)},function(n){return(n.objChild.Item.ItemType.match(/assignheader/)||n.objChild.Item.ItemType.match(/returnheader/)||n.objChild.Item.ItemType.match(/notesheader/))!=null}],null,["Delete Action ",function(t){var i=n.items;r(i,t,n.logicalrule)},function(n){return n.objChild.Item.ItemType.match(/assignheader/)!=null}],null,["Delete Return ",function(t){var i=n.items;r(i,t,n.logicalrule)},function(n){return n.objChild.Item.ItemType.match(/returnheader/)!=null}],null,["Delete Notes ",function(t){var i=n.items;r(i,t,n.logicalrule)},function(n){return n.objChild.Item.ItemType.match(/notesheader/)!=null}],null,["Add Horizantal Condition",function(t){var i=n.items;u(i,"Top",t,n.logicalrule)},function(t){var i=n.items,r=n.logicalrule.Rows.indexOf(i);return t.objChild.Item.ItemType.match(/rowheader/)&&r==0}],null,["Add Condition in Right",function(t){var i=n.items;f(i,"Right",t,n.logicalrule)},function(n){return n.objChild.Item.ItemType.match(/rowheader/)!=null}],null,["Add Condition in Left",function(t){var i=n.items;f(i,"Left",t,n.logicalrule)},function(n){return n.objChild.Item.ItemType.match(/rowheader/)!=null}],null,["Add Condition in Bottom",function(t){var i=n.items;u(i,"Bottom",t,n.logicalrule)},function(n){return n.objChild.Item.ItemType.match(/colheader/)!=null}],null,["Add Condition in Top",function(t){var i=n.items;u(i,"Top",t,n.logicalrule)},function(n){return n.objChild.Item.ItemType.match(/colheader/)!=null}],null,["Delete Condition",function(t){var i=n.items;e(i,t,n.logicalrule)},function(n){return(n.objChild.Item.ItemType.match(/colheader/)||n.objChild.Item.ItemType.match(/rowheader/))!=null}],null];n.objStepSelectionChanged=function(n){var t=getCurrentFileScope();t.onDecisionStepChange(n)}}}}]);app.directive("excelmatrixscrolldirective",["$interval",function(n){return{restrict:"A",link:function(t,i){var r=i[0];t.promise=null;t.LoadExcelMatrix=function(){t.LoadSomeRowsinExcelMatrix();(i.hasScrollBar()||t.objSelectedLogicalRule.objColumnValues.length==t.objSelectedLogicalRule.objExcelColumnValues.length)&&t.promise&&n.cancel(t.promise)};setTimeout(function(){t.promise=n(function(){t.LoadExcelMatrix()},500)},1e3);$(i).scroll(function(){r.scrollTop+r.offsetHeight>=r.scrollHeight&&(r.scrollHeight=r.scrollTop+r.scrollHeight,t.$apply(function(){t.LoadSomeRowsinExcelMatrix()}))})}}}]);app.directive("decisiontablescrolldirective",["$interval",function(n){return{restrict:"A",link:function(t,i){var r=i[0];t.promise=null;t.LoadDecisionTable=function(){(i.hasScrollBar()||t.objSelectedLogicalRule.Rows.length<=t.objSelectedLogicalRule.noConditionsDisplayed)&&t.promise?n.cancel(t.promise):t.objSelectedLogicalRule.Rows.length>t.objSelectedLogicalRule.noConditionsDisplayed&&(t.objSelectedLogicalRule.noConditionsDisplayed=t.objSelectedLogicalRule.noConditionsDisplayed+10)};setTimeout(function(){t.promise=n(function(){t.LoadDecisionTable()},500)},1e3);$(i).scroll(function(){r.scrollTop+r.offsetHeight>=r.scrollHeight-5&&(r.scrollHeight=r.scrollTop+r.scrollHeight,t.$apply(function(){t.objSelectedLogicalRule.Rows.length>t.objSelectedLogicalRule.noConditionsDisplayed&&(t.objSelectedLogicalRule.noConditionsDisplayed=t.objSelectedLogicalRule.noConditionsDisplayed+10)}))})}}}]);