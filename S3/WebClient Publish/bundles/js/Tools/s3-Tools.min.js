app.controller("configureSettingsController",["$scope","$http","ngDialog","ConfigurationFactory","hubcontext","$rootScope","$cookies","$EntityIntellisenseFactory","$timeout","CONSTANTS",function(n,t,r,u,f,e,o,s,h){var l,c,a;n.showTfsDetails=!1;n.showAddPortalDetailsTab=!1;n.showPoratlDetailsTab=!1;n.lstTempMappedUser=[];n.lstMappedUser=[];n.isSavePending=!1;n.selectedConfigureTab="ProjectSettings";n.projectTypes=[];l=o.getObject("UserDetails");c=JSON.parse(l);n.ShowUserTab=c.UserType=="owner"?!0:!1;n.projectTypes=u.getProjectTypeProvider().ProjectTypeList;n.configureSettingsDetails||(e.IsLoading=!0,t({method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/ConfigureSetting/GetConfigurationDetails?userId="+c.UserID}).then(function(t){var i,r;if(e.IsLoading=!1,n.configureSettingsDetails=t.data[0],n.configureSettingsDetails&&n.configureSettingsDetails.length>0&&(n.configureSettingsDetails.ClientID=n.configureSettingsDetails[0].ClientId),n.lstMappedUser=t.data[1]&&t.data[1].length>0?t.data[1]:[],n.lstUsers=t.data[2],n.objClientInfo=t.data[3],i=u.getLastProjectDetails(),i&&i.ProjectName&&i.ProjectName!="")for(r=0;r<n.configureSettingsDetails.length;r++)i.ProjectId==n.configureSettingsDetails[r].ProjectId&&i.ProjectName==n.configureSettingsDetails[r].ProjectName&&n.showProjectDetails(n.configureSettingsDetails[r]);n.getActiveDirectoryMappedUser(c.UserID)},function(n){e.IsLoading=!1;e.showExceptionDetails(n.data)}));n.getActiveDirectoryMappedUser=function(){t({method:"POST",data:{userID:c.UserID},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/ConfigureSetting/GetMappedADUser"}).then(function(t){n.lstAdMappedUser=t.data},function(n){e.showExceptionDetails(n.data)})};n.AddDBType=function(){var t=n.$new(),i,r;t.lstDBTypes=[];i={ID:"Oracle",IsSelected:"False",Attribute:"sfwOracle"};r={ID:"PostgreSQL",IsSelected:"False",Attribute:"sfwPostgre"};t.isValidQueryType=function(t){for(var r=!0,i=0;i<n.selectedProject.lstQueryTypes.length;i++)if(n.selectedProject.lstQueryTypes[i].ID==t){r=!1;break}return r};t.lstDBTypes.push(i);t.lstDBTypes.push(r);t.onAddQueryTypeOkClick=function(){for(var r,u,i=0;i<t.lstDBTypes.length;i++)t.lstDBTypes[i].IsSelected=="True"&&(r=t.isValidQueryType(t.lstDBTypes[i].ID),r&&n.selectedProject&&n.selectedProject.lstQueryTypes&&(u={ID:t.lstDBTypes[i].ID,Attribute:t.lstDBTypes[i].Attribute},e.PushItem(u,n.selectedProject.lstQueryTypes,"")));t.onCancelClick()};t.dialogOptions={height:300,width:350};t.addQuerydialog=e.showDialog(t,"Add Query Type","Tools/views/AddQueryType.html",t.dialogOptions);t.onCancelClick=function(){t.addQuerydialog.close()}};n.selectDBType=function(t){n.selectedProject.selectedDBType=t};n.DeleteDBType=function(){if(n.selectedProject.selectedDBType)for(var t=1;t<n.selectedProject.lstQueryTypes.length;t++)if(n.selectedProject.lstQueryTypes[t]==n.selectedProject.selectedDBType){e.DeleteItem(n.selectedProject.lstQueryTypes[t],n.selectedProject.lstQueryTypes,"");n.selectedProject.selectedDBType="";break}};n.concatDBTypesforAllProjects=function(t){var i,r;if(t)for(i=0;i<t.length;i++)t[i].lstQueryTypes&&t[i].lstQueryTypes.length>0&&(r=n.getStrQueryTypes(t[i].lstQueryTypes),t[i].QueryTypes=r)};n.getStrQueryTypes=function(n){var i,u,t,r;if(n&&n.length>0)for(i=[],u="",t=0;t<n.length;t++)n[t].ID&&n[t].ID.trim()!=""&&n[t].Attribute&&n[t].Attribute.trim()!=""&&(r=n[t].ID.trim()+":"+n[t].Attribute.trim(),i.push(r));return i.join(";")};n.showProjectDetails=function(t){var r,i;if(!n.selectedProject||!n.selectedProject.ProjectId||n.selectedProject.ProjectId!=t.ProjectId){if(n.selectedProject)for(i=0;i<n.configureSettingsDetails.length;i++)n.selectedProject.ProjectId==n.configureSettingsDetails[i].ProjectId&&n.selectedProject.ProjectName==n.configureSettingsDetails[i].ProjectName&&(n.configureSettingsDetails[i]=n.selectedProject);if(n.selectedProject=t,n.CheckValidParentEntity(),n.lstAssemblyNames=[],n.selectedProject.selectedDBType="",n.selectedProject.QueryTypes||(n.selectedProject.QueryTypes="SQL:sfwSql"),n.selectedProject.lstQueryTypes||(n.selectedProject.lstQueryTypes=[],n.selectedProject.lstQueryTypes=getlstQueryTypes(n.selectedProject.QueryTypes)),t.AssemblyNames!="")for(r=t.AssemblyNames.split(";"),i=0;i<r.length;i++)r[i]!=""&&i!=r.length-1&&n.lstAssemblyNames.push({isCheck:!0,Name:r[i]});t.DataObjectProjectLocation&&t.DataObjectProjectLocation==t.BusinessObjectProjectLocation&&(n.sameAsBussinesObj=!0);t.BaseDirectory&&t.BaseDirectory!=""&&f.hubMain.server.prepareFolderPath(t.BaseDirectory);n.selectedProject.IsHtxPortalTableExists?(n.showPoratlDetailsTab=n.selectedProject.IsHtxPortalTableExists,angular.isArray(n.selectedProject.htxPortals)&&n.selectedProject.htxPortals.length>0?(n.showPoratlDetails(n.selectedProject.htxPortals[0]),n.showAddPortalDetailsTab=!0):(n.showPoratlDetails(null),n.showAddPortalDetailsTab=!1)):n.showPoratlDetailsTab=!1;n.showPoratlDetailsTab&&n.ShowUserTab&&e.openFromHtx&&(n.selectedConfigureTab="HTXSettings");delete e.openFromHtx}};n.checkedUnchecked=function(t){return n.sameAsBussinesObj=t&&t.DataObjectProjectLocation&&t.DataObjectProjectLocation.trim()==t.BusinessObjectProjectLocation.trim()?!0:!1,n.IsDisable};n.IsEnableParentEntity=function(){if(n.selectedProject){var t=u.getLastProjectDetails();if(t&&t.ProjectId&&t.ProjectId!=""&&n.selectedProject.ProjectId==t.ProjectId)return!0}else return!1};n.addProject=function(){var t=n.$new(),r=e.showDialog(t,"Add New Project","Tools/views/AddNewProject.html");t.addProjectOkClick=function(i){var u,f,r;if(i){for(n.lstAssemblyNames=[],u=["ProjectID","BaseDirectory","XmlFileLocation","ScenarioXmlFileLocation","ApplicationExecutablesLocation","Solution","BusinessObjectLocation","DataObjectLocation","AssemblyNames","BusinessObjectProjectLocation","DataObjectProjectLocation","DefaultParentEntity","CorrespondenceTemplatesLocation","ReportsLocation","HtmlTemplatesLocation","BPMTemplatesLocation","IsTFS","IsRemoteLogin","TFSUrl","TFSSourceLocation","TFSScenarioSourceLocation","TFPath","TfsLocalPath","tfptPath","CheckPendingChanges","Website","IsWorkFlow","CorrespondenceTestsLocation","ProjectType"],f={},f.ProjectName=i,r=0;r<u.length;r++)f[u[r]]=u[r]==="ProjectType"?0:u[r]=="XmlFileLocation"?"XML":u[r]=="ScenarioXmlFileLocation"?"XMLScenario":u[r]=="ApplicationExecutablesLocation"?"Bin":u[r]=="Solution"?"slnNeoSpin":u[r]=="BusinessObjectLocation"?"NeoSpinBusinessObjects":u[r]=="ProjectID"?-1:u[r]=="IsTFS"||u[r]=="IsRemoteLogin"||u[r]=="CheckPendingChanges"?!1:"";f.htxPortals=[];f.IsHtxPortalTableExists=n.showPoratlDetailsTab;f.UserType="owner";t.closeDialog();n.configureSettingsDetails||(n.configureSettingsDetails=[]);e.UndRedoBulkOp("Start");e.PushItem(f,n.configureSettingsDetails,"showProjectDetails");n.showProjectDetails(f);e.UndRedoBulkOp("End")}};t.checkProjectNameNew=function(){if(t.ErrorMessage="",t.newprojectName&&t.newprojectName!=""){if(n.configureSettingsDetails&&n.configureSettingsDetails.length>0)for(i=0;i<n.configureSettingsDetails.length;i++)if(t.newprojectName.toLowerCase()==n.configureSettingsDetails[i].ProjectName.toLowerCase())return t.ErrorMessage="Error:Duplicate Project Name.",!0}else return t.ErrorMessage="Error:Project Name can not be empty.",!0};t.closeDialog=function(){r.close()}};n.deleteProject=function(){var t=n.$new(),i;t.IsDelete=!0;i=e.showDialog(t,"Delete Project","Tools/views/DeleteProject.html",{width:500,height:160});t.OkClick=function(){var i=n.configureSettingsDetails.indexOf(n.selectedProject);i>-1&&(e.DeleteItem(n.configureSettingsDetails[i],n.configureSettingsDetails,"showProjectDetails"),n.configureSettingsDetails.length>0&&i>0?n.showProjectDetails(n.configureSettingsDetails[i-1]):n.configureSettingsDetails.length>0&&n.showProjectDetails(n.configureSettingsDetails[n.configureSettingsDetails.length-1]));t.closeDialog()};t.closeDialog=function(){i.close()}};n.getFolderPathList=function(n){n&&n!=""&&f.hubMain.server.prepareFolderPath(n)};n.editProjectName=function(t){var u=n.configureSettingsDetails.indexOf(t),r=n.$new(),f;r.editprojectName=t.ProjectName;t&&t.UserType=="owner"&&(f=e.showDialog(r,"Edit Project Name","Tools/views/EditProjectName.html"),r.checkProjectName=function(){if(r.errorMessage="",r.editprojectName&&r.editprojectName!=""){if(r.editprojectName.toLowerCase()==n.configureSettingsDetails[u].ProjectName.toLowerCase())return!1;for(i=0;i<n.configureSettingsDetails.length;i++)if(i!=u&&r.editprojectName.toLowerCase()==n.configureSettingsDetails[i].ProjectName.toLowerCase())return r.errorMessage="Error:Duplicate Project Name.",!0}else return r.errorMessage="Error:Project Name can not be empty.",!0},r.saveEditProject=function(t){t!=""&&(e.EditPropertyValue(n.configureSettingsDetails[u].ProjectName,n.configureSettingsDetails[u],"ProjectName",t),r.closeDialog())},r.closeDialog=function(){f.close()})};n.getSelectedDetails=function(t,i,r,u,o){if(n.selectedProperty=t,i=="FilePath"){var s;n.selectedProject.BaseDirectory&&n.selectedProject.ApplicationExecutablesLocation&&(s=/\\+$/g.test(n.selectedProject.BaseDirectory)?n.selectedProject.BaseDirectory+n.selectedProject.ApplicationExecutablesLocation:n.selectedProject.BaseDirectory+"\\"+n.selectedProject.ApplicationExecutablesLocation);n.IsSingleOrMultiple=r;f.hubMain.server.getFilePath(r=="M","ProjectSettings",s,u)}else i=="FolderPath"&&f.hubMain.server.getFolderPath(t.BaseDirectory).done(function(t){n.$apply(function(){if(t!=undefined&&t!=""){var i=t;n.selectedProperty=="Website"&&(i=n.selectedProject.Website&&n.selectedProject.Website!=""?n.selectedProject.Website+";"+t.substring(t.lastIndexOf("\\")+1,t.length):t.substring(t.lastIndexOf("\\")+1,t.length));o?e.EditPropertyValue(o[n.selectedProperty],o,n.selectedProperty,i):e.EditPropertyValue(n.selectedProject[n.selectedProperty],n.selectedProject,n.selectedProperty,i)}})})};n.sameAsBussinessObjChange=function(t,i){t?i.BusinessObjectProjectLocation!=""&&(e.EditPropertyValue(n.selectedProject.DataObjectProjectLocation,n.selectedProject,"DataObjectProjectLocation",i.BusinessObjectProjectLocation),n.selectedProject.DataObjectLocation=""):(e.EditPropertyValue(n.selectedProject.DataObjectProjectLocation,n.selectedProject,"DataObjectProjectLocation",""),n.selectedProject.DataObjectLocation="")};n.setCheckBoxVariable=function(){n.selectedProject.DataObjectProjectLocation&&n.selectedProject.DataObjectProjectLocation!=""||(n.sameAsBussinesObj=!1)};n.receiveProjectSettingsFilePath=function(t){n.$evalAsync(function(){var r,i,u,f;if(t!=undefined&&t.length!=0){if(e.UndRedoBulkOp("Start"),n.IsSingleOrMultiple=="M")for(r=0;r<t.length;r++)i=t[r].substring(t[r].lastIndexOf("\\")+1,t[r].length),u=!0,n.lstAssemblyNames&&n.lstAssemblyNames.length>0&&(f=n.lstAssemblyNames.map(function(n){return n.Name}).indexOf(i),f>-1&&(u=!1)),u&&(n.selectedProject[n.selectedProperty]&&n.selectedProject[n.selectedProperty]!=""?e.EditPropertyValue(n.selectedProject[n.selectedProperty],n.selectedProject,""+n.selectedProperty+"",n.selectedProject[n.selectedProperty]+i+";"):e.EditPropertyValue(n.selectedProject[n.selectedProperty],n.selectedProject,""+n.selectedProperty+"",i+";"),n.selectedProperty=="AssemblyNames"&&e.PushItem({Name:i},n.lstAssemblyNames));else n.selectedProperty==="TFPath"||n.selectedProperty==="tfptPath"?e.EditPropertyValue(n.selectedProject[n.selectedProperty],n.selectedProject,""+n.selectedProperty+"",t[0]):(i=t[0].substring(t[0].lastIndexOf("\\")+1,t[0].length),u=!0,n.lstAssemblyNames&&n.lstAssemblyNames.length>0&&(f=n.lstAssemblyNames.map(function(n){return n.Name}).indexOf(i),f>-1&&(u=!1)),u&&(e.EditPropertyValue(n.selectedProject[n.selectedProperty],n.selectedProject,""+n.selectedProperty+"",i),n.selectedProperty=="AssemblyName"&&e.PushItem({Name:i},n.lstAssemblyNames)));e.UndRedoBulkOp("End")}})};n.selectAssemblyName=function(t){n.selectedAssembly=t};n.deleteAssemblyNames=function(){for(e.UndRedoBulkOp("Start"),i=0;i<n.lstAssemblyNames.length;i++)n.lstAssemblyNames[i]==n.selectedAssembly&&(e.DeleteItem(n.selectedAssembly,n.lstAssemblyNames),n.selectedAssembly=undefined);var t="";for(i=0;i<n.lstAssemblyNames.length;i++)t+=n.lstAssemblyNames[i].Name+";";e.EditPropertyValue(n.selectedProject.AssemblyNames,n.selectedProject,"AssemblyNames",t);e.UndRedoBulkOp("End")};n.getFolderPathIntellisense=function(t,i,r){$("#"+t).autocomplete({minLength:0,appendTo:"#dvIntellisense",open:function(n){$("#dvIntellisense > ul").css({width:"auto",height:"auto",overflow:"auto",maxWidth:"300px",maxHeight:"300px"});setIntellisensePosition(n);$(".tab-content").find(".settings-tab-content").css("pointer-events","none")},source:function(r,u){i&&i!=""&&(i=(t=="BusinessObjectLocation"||t=="DataObjectLocation")&&n.selectedProject.Solution&&n.selectedProject.Solution!=""?n.selectedProject.Solution:"",f.hubMain.server.getFolderPathIntellisense(r.term.trim(),i,!1).done(function(t){t!=""?(n.responseParsed=parsePathIntellisenseResult(t),u(n.responseParsed)):(n.responseParsed=[],u(n.responseParsed))}))},focus:function(n,t){$(".ui-autocomplete > li").attr("title",t.item.label)},search:function(){},select:function(t,i){n.selectedProject[""+$(this)[0].id+""]=i.item.value;$(this).trigger("change");$("#"+$(this)[0].id).click()},close:function(){$(".tab-content").find(".settings-tab-content").css("pointer-events","auto");$("#dvIntellisense")[0].innerHTML=""}});r.type=="click"&&($("#"+t).focus(),$("#"+t).data("ui-autocomplete")&&$("#"+t).autocomplete("search",$("#"+t).val()));r.ctrlKey&&r.keyCode==$.ui.keyCode.SPACE&&$("#"+t).data("ui-autocomplete")&&($("#"+t).autocomplete("search",$("#"+t).val()),r.preventDefault())};a=$('body[ng-controller="MainController"]');Mainscope=angular.element(a).scope();n.IsCloseEnable=function(){var n=u.getLastProjectDetails();return Mainscope.CurrentProjectName==undefined||Mainscope.CurrentProjectName==""?!0:!1};n.closeFile=function(i){var r,u;n.isDirty?!n.isSavePending&&n.configureSettingsDetails.length>0&&!n.IsDisable&&(r=n.$new(),r.IsSave=!0,u=e.showDialog(r,"UnSave Project","Tools/views/DeleteProject.html",{width:500,height:160}),r.OkClick=function(){var r,f;for(e.IsLoading=!0,n.isSavePending=!0,r=0;r<n.configureSettingsDetails.length;r++)n.selectedProject.ProjectName==n.configureSettingsDetails[r].ProjectName&&(n.configureSettingsDetails[r]=n.selectedProject);f=-1;i&&(f=i);t({method:"POST",data:JSON.stringify({lstProjectDetails:n.configureSettingsDetails,userID:c.UserID,projectID:f}),headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/SaveProjectDetails"}).then(function(t){u.close();e.IsLoading=!1;toastr.success("Project Detail Saved sucessfully.");n.saveAllprojectDetailsSettings(t.data)},function(t){e.IsLoading=!1;n.isSavePending=!1;e.IsProjectLoaded=!1;e.showExceptionDetails(t.data)})},r.closeDialog=function(){u.close();n.closeFileFunction()}):n.closeFileFunction()};n.closeFileFunction=function(){!n.IsCloseEnable()&&u.getLastProjectDetails()!=null&&u.getLastProjectDetails().ProjectName&&e.lstopenedfiles.length==0?(e.isConfigureSettingsVisible=!1,e.isstartpagevisible=!0,e.currentopenfile=undefined):!n.IsCloseEnable()&&u.getLastProjectDetails()!=null&&u.getLastProjectDetails().ProjectName&&(e.isConfigureSettingsVisible=!1,e.currentopenfile===undefined&&(e.isstartpagevisible=!0))};n.MapADUsers=function(){var i=n.$new();i.IsShowRole=!0;i.searchADUser=function(){e.IsLoading=!0;t({method:"POST",data:{userID:c.UserID,samAccounName:i.samAccountName,domainName:i.domainName,name:i.name,email:i.email},headers:{"Content-Type":"application/json; charset=utf-8"},async:!1,url:"api/ConfigureSetting/GetADUsersForMapping"}).then(function(n){e.IsLoading=!1;i.filterADUsers=n.data;i.removeMappedADUser(i.selectedADUsers,i.filterADUsers);i.selectedUserDisplayCount=i.filterUserDisplayCount=30;i.filterUserDisplayCount=30},function(n){e.IsLoading=!1;e.showExceptionDetails(n.data)})};i.OK=function(){var r,u;for(i.beforeOK(),n.mappedADUsers=[],r=0;r<i.selectedADUsers.length;r++)u={UserID:i.selectedADUsers[r].UserID,SAMAccountName:i.selectedADUsers[r].SAMAccountName,Name:i.selectedADUsers[r].Name,DomainName:i.selectedADUsers[r].DomainName,UserClientAssociation:{UserType:i.selectedADUsers[r].UserType},EmailId:i.selectedADUsers[r].EmailId},n.mappedADUsers.push(u);n.mappedADUsers&&n.mappedADUsers.length>0&&c&&c.UserID&&(e.IsLoading=!0,t({method:"POST",data:{ActiveDirectoryUsers:n.mappedADUsers,UserID:c.UserID},headers:{"Content-Type":"application/json; charset=utf-8"},async:!1,url:"api/ConfigureSetting/AddADUserMapping"}).then(function(t){e.IsLoading=!1;n.$evalAsync(function(){n.lstAdMappedUser=t.data})},function(n){e.IsLoading=!1;e.showExceptionDetails(n.data)}));i.closeDialog()};i.dialogMapuser=e.showDialog(i,"Assign Active Directory User","StartUp/views/GetActiveDirectoryUsers.html",{width:1200,height:550})};n.DeleteMappedUsed=function(i){n.selectedUser&&(e.IsLoading=!0,t({method:"POST",data:JSON.stringify({ClientID:n.selectedUser.ClientID,UserID:n.selectedUser.UserID,OwnerUserID:c.UserID,IsFromADUser:i}),headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/DeleteUserMapping"}).then(function(t){e.IsLoading=!1;i?n.lstAdMappedUser=t.data&&t.data.length>0?t.data:[]:n.lstMappedUser=t.data&&t.data.length>0?t.data:[];n.lstTempMappedUser=[];toastr.success("User Deleted sucessfully.")},function(n){e.IsLoading=!1;e.showExceptionDetails(n.data)}))};n.OpenAddUserDialog=function(){var i=n.$new(),r=e.showDialog(i,"Add User","StartUp/views/CreateUserDialog.html",{width:750,height:500});ComponentsPickers.init();i.CreateUserOkClick=function(){n.lstUsers.length>0&&(index=n.lstUsers.map(function(n){return n.UserName}).indexOf(this.UserName));n.lstUsers.length==0||index<0?t({method:"POST",data:{UserID:c.UserID,UserName:this.UserName,FirstName:this.FirstName,LastName:this.LastName,Status:this.Status,StartDate:this.StartDate,EndDate:this.EndDate,UserType:this.UserType,EmailId:this.EmailID},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/CreateAndMapUser"}).then(function(t){e.IsProjectLoaded=!1;t.data!="UserExist"?(r.close(),n.lstUsers=t.data[0],n.lstMappedUser=t.data[1]&&t.data[1].length?t.data[1]:[],toastr.success("User Mapped sucessfully.")):toastr.error("User already exist.")},function(n){e.IsProjectLoaded=!1;e.showExceptionDetails(n.data)}):toastr.error("User already exist.")};i.closeDialog=function(){r.close()};i.CheckValidUser=function(){if(i.UserName&&i.UserName!="")if(i.FirstName&&i.FirstName!="")if(i.LastName&&i.LastName!="")if(i.Status&&i.Status!="")if(i.StartDate&&i.StartDate!=null)if(ValidateDate(i.StartDate))if(new Date<Date.parse(i.StartDate))i.ErrorMessage="Start Date should be less than Or equal to current Date",i.IsError=!0;else if(i.EndDate&&!ValidateDate(i.EndDate))i.ErrorMessage="End Date should be mm/dd/yyyy or mm-dd-yyyy",i.IsError=!0;else if(i.EndDate&&Date.parse(i.StartDate)>Date.parse(i.EndDate))i.ErrorMessage="Start Date greater than End Date",i.IsError=!0;else{if(n.objClientInfo&&n.objClientInfo.EndDate!=""&&Date.parse(n.objClientInfo.EndDate)<Date.parse(i.EndDate))return i.ErrorMessage="End Date should be less than client End Date. i.e "+n.objClientInfo.EndDate,!0;i.UserType&&i.UserType!=""?i.EmailID&&i.EmailID!=""?validateEmail(i.EmailID)?(i.ErrorMessage="",i.IsError=!1):(i.ErrorMessage="Email-id not valid",i.IsError=!0):(i.ErrorMessage="Email-id Required",i.IsError=!0):(i.ErrorMessage="UserType Required",i.IsError=!0)}else i.ErrorMessage="Start Date should be mm/dd/yyyy or mm-dd-yyyy",i.IsError=!0;else i.ErrorMessage="Start Date Required",i.IsError=!0;else i.ErrorMessage="Status Required",i.IsError=!0;else i.ErrorMessage="Last Name Required",i.IsError=!0;else i.ErrorMessage="First Name Required",i.IsError=!0;else i.ErrorMessage="User Name Required",i.IsError=!0;return i.IsError}};n.onsavefileclick=function(){var i,r,f;!n.isSavePending&&n.configureSettingsDetails&&n.configureSettingsDetails.length>0&&!n.IsDisable&&(i=n.$new(),r=u.getLastProjectDetails(),r&&r.ProjectName&&r.ProjectId?i.IsSaveAndReLoad=!0:i.IsSave=!0,f=e.showDialog(i,"Save Project","Tools/views/DeleteProject.html",{width:500,height:160}),i.OkClick=function(){if(e.IsLoading=!0,n.isSavePending=!0,n.concatDBTypesforAllProjects(n.configureSettingsDetails),n.selectedProject)for(var r=0;r<n.configureSettingsDetails.length;r++)n.selectedProject.ProjectId==n.configureSettingsDetails[r].ProjectId&&n.selectedProject.ProjectName==n.configureSettingsDetails[r].ProjectName&&(n.configureSettingsDetails[r]=n.selectedProject);t({method:"POST",data:JSON.stringify({lstProjectDetails:n.configureSettingsDetails,userID:c.UserID}),headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/SaveProjectDetails"}).then(function(t){n.isDirty=!1;toastr.success("Project Detail Saved sucessfully.");n.saveAllprojectDetailsSettings(t.data);e.IsLoading=!1},function(t){e.IsProjectLoaded=!1;e.IsLoading=!1;n.isSavePending=!1;e.showExceptionDetails(t.data)});i.closeDialog()},i.closeDialog=function(){f.close()})};n.selectUserRow=function(t){n.selectedUser=t};n.saveAllprojectDetailsSettings=function(i){n.$evalAsync(function(){e.IsLoading=!0});n.configureSettingsDetails=i;var r=o.getObject("UserDetails");t({method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/GetPojectNamesAndProjectDetail?UserID="+JSON.parse(r).UserID}).then(function(t){if(t.data=="AccessError")toastr.error("Sorry, You have No Access.");else if(t.data=="InvalidRequest")toastr.error("Invalid Request.");else{t.data[0].length>0?t.data[1].ProjectName!=null?u.setConfigurationObject(t.data[0],t.data[1]):u.setConfigurationObject(t.data[0],null):e.isConfigureSettingsVisible=!0;var r=JSON.stringify(i);r.length<32e3?f.hubMain.server.updateAllProjectLoadDetails(i):n.sendDataInPackets(r,"UpdateAllProjectLoadDetails")}},function(n){e.IsLoading=!1;e.showExceptionDetails(n.data)})};n.sendDataInPackets=function(t,i){for(var u="",f=[],e=0,r=0,o=t.length;r<o;r++)e++,u=u+t[r],e==32e3&&(e=0,f.push(u),u="");for(e!=0&&f.push(u),r=0,o=f.length;r<o;r++)hubMain.server.receiveDataPackets(f[r],o,n.currentopenfile,r,i,[])};n.receiveAfterUpdateAllProjectLoadDetails=function(){var t,r,i;if(e.IsLogOut=!0,n.$evalAsync(function(){e.IsLoading=!1;n.isSavePending=!1}),t=u.getLastProjectDetails(),t&&t.ProjectName&&t.ProjectId){for(r=!1,i=0;i<n.configureSettingsDetails.length;i++)if(t.ProjectId==n.configureSettingsDetails[i].ProjectId){r=!0;n.$evalAsync(function(){e.IsLoading=!0});angular.equals(t,n.configureSettingsDetails[i])?(n.$evalAsync(function(){e.IsLoading=!1}),n.selectedProject=undefined,e.resetRootScopeVarible()):(n.$evalAsync(function(){e.IsLoading=!1;e.IsProjectLoaded=!0}),e.resetRootScopeVarible(),e.isConfigureSettingsVisible=!1,e.loadProjectData(n.configureSettingsDetails[i],!0));break}r||(n.selectedProject=undefined,n.configureSettingsDetails.length>0&&(n.selectedProject=n.configureSettingsDetails[0]),e.resetRootScopeVarible())}else n.selectedProject=undefined,n.configureSettingsDetails.length>0&&(n.selectedProject=n.configureSettingsDetails[0]),e.resetRootScopeVarible();e.updateProjectList()};n.isCurrentFileDirty=function(){var n=getScopeByFileName("SettingsPage");if(n)return n.isDirty};n.CheckValidParentEntity=function(){if(s.getEntityIntellisense()&&s.getEntityIntellisense().length>0){var t=s.getEntityIntellisense().filter(function(t){return t.DisplayName==n.selectedProject.DefaultParentEntity});n.ErrorMessage=t&&t.length>0&&t[0].ParentId?"Can not set "+n.selectedProject.DefaultParentEntity+" as Default parent Entity.":undefined}};n.UndoClick=function(){Mainscope&&Mainscope.UndoClick&&Mainscope.UndoClick()};n.RedoClick=function(){Mainscope&&Mainscope.RedoClick&&Mainscope.RedoClick()};n.showPoratlDetails=function(t){n.selectedPortalDetails=t;n.selectedCssFile=null;n.selectedJsFile=null;n.lstPortalCss=[];n.lstPortalJs=[];n.selectedPortalDetails&&n.selectedPortalDetails.CSSFiles&&(n.lstPortalCss=n.selectedPortalDetails.CSSFiles.split(","),n.lstPortalCss=n.lstPortalCss.unique());n.selectedPortalDetails&&n.selectedPortalDetails.JSFiles&&(n.lstPortalJs=n.selectedPortalDetails.JSFiles.split(","),n.lstPortalJs=n.lstPortalJs.unique())};n.addNewPortal=function(t){var i=n.$new(),r,u;i.title="Add New Portal";i.ErrorMessage="";i.portalName=null;r=null;t=="edit"&&(i.title="Edit Portal",i.portalName=n.selectedPortalDetails.PortalName,r=i.portalName);i.onPortalDialogOkClick=function(){if(t=="new"){var r={CSSFiles:"",PortalPath:"",JSFiles:"",IsDefault:"false"};r.PortalName=i.portalName;e.UndRedoBulkOp("Start");e.PushItem(r,n.selectedProject.htxPortals,"showPoratlDetails");n.showPoratlDetails(r);e.UndRedoBulkOp("End")}else t=="edit"&&(n.selectedPortalDetails.PortalName=i.portalName);angular.isArray(n.selectedProject.htxPortals)&&n.selectedProject.htxPortals.length>0&&(n.showAddPortalDetailsTab=!0);u.close()};i.checkPortalName=function(){if(i.ErrorMessage="",i.portalName){if(angular.isArray(n.selectedProject.htxPortals)&&n.selectedProject.htxPortals.length>0){if(t=="edit"&&i.portalName&&r.toLowerCase()==i.portalName.toLowerCase())return!1;var u=n.selectedProject.htxPortals.filter(function(n){return n.PortalName&&n.PortalName.toLowerCase()==i.portalName.toLowerCase()});return angular.isArray(u)&&u.length>0?(i.ErrorMessage="Error:Duplicate Portal Name.",!0):!1}}else return i.ErrorMessage="Error:Portal Name can not be empty.",!0};i.closeDialog=function(){t=="edit"&&(n.selectedPortalDetails.PortalName=r);u.close()};u=e.showDialog(i,i.title,"StartUp/views/add_new_portal_dialog.html",{height:300,width:450})};n.deletePortal=function(){if(n.selectedPortalDetails&&confirm("Are you sure you want to delete portal?")){var t=n.selectedProject.htxPortals.indexOf(n.selectedPortalDetails);t>-1&&e.DeleteItem(n.selectedPortalDetails,n.selectedProject.htxPortals,"showPoratlDetails");t<n.selectedProject.htxPortals.length?n.showPoratlDetails(n.selectedProject.htxPortals[t]):n.showPoratlDetails(n.selectedProject.htxPortals[n.selectedProject.htxPortals.length-1])}angular.isArray(n.selectedProject.htxPortals)&&n.selectedProject.htxPortals.length<=0&&(n.showAddPortalDetailsTab=!1)};n.addFiles=function(){var t=n.$new(!0),i,r,u;t.title="Add New CSS";t.ErrorMessage="";t.selectedAddedfile=null;t.lstCssFiles=[];t.cssFileList=[];t.selectedCssFileList=[];t.selectedAddedJsFiles=null;t.lstJsFiles=[];t.jsFileList=[];t.selectedJsFilesList=[];i=null;n.selectedPortalDetails.CSSFiles&&(r=n.selectedPortalDetails.CSSFiles.split(","),t.selectedCssFileList=r);n.selectedPortalDetails.JSFiles&&(u=n.selectedPortalDetails.JSFiles.split(","),t.selectedJsFilesList=u);t.getFileList=function(i,r,u){n.selectedPortalDetails.PortalPath&&(e.IsLoading=!0,f.hubMain.server.getCssFiles(n.selectedPortalDetails.PortalPath,i).done(function(n){t.$evalAsync(function(){angular.isArray(n)&&n.length==1&&n[0]=="failure"?toastr.warning("Select valid website location"):angular.isArray(n)&&t.filterCssFiles(n,r,u);e.IsLoading=!1})}))};t.getFileList("*.css",t.selectedCssFileList,t.lstCssFiles);t.selectFileTab=function(n){t.selectedFilesTab=n;t.selectedAddedfile=null;$("#selectedCssFiles").find("tr.selected").removeClass("selected");$("#selectedJsFiles").find("tr.selected").removeClass("selected");"JS"==n&&t.lstJsFiles.length==0&&t.getFileList("*.js",t.selectedJsFilesList,t.lstJsFiles)};t.filterCssFiles=function(n,t,i){var r=n.filter(function(n){return t.indexOf(n)==-1});angular.copy(r,i)};t.addCssFromWebConfig=function(i,r){n.selectedPortalDetails.PortalPath&&(e.IsLoading=!0,f.hubMain.server.getCssFileNameFromWebConfig(n.selectedPortalDetails.PortalPath).done(function(n){t.$evalAsync(function(){e.IsLoading=!1;angular.isArray(n)&&n.length==1&&n[0]=="failure"?toastr.warning("Select valid website location"):angular.isArray(n)&&(r.length=0,i.push.apply(r,n),r=r.unique(),t.selectedAddedfile=null)})}))};t.selectCssFile=function(n,t,i){var r=null,u;n&&(r=$(n.currentTarget),r&&r.hasClass("selected")?(r.removeClass("selected"),u=i.indexOf(t),u>-1&&i.splice(u,1)):r&&!r.hasClass("selected")&&(r.addClass("selected"),i.push(t)))};t.selectAllCssFile=function(n,t,i){n?($("#cssFileList").find("tr").addClass("selected"),angular.copy(t,i)):($("#cssFileList").find("tr.selected").removeClass("selected"),i=[])};t.addCssFiles=function(n,i,r,u){n=!1;u=="css"?i.push.apply(i,t.cssFileList):u=="js"&&i.push.apply(i,t.jsFileList);var f=[];$.each(i,function(n,t){$.inArray(t,f)===-1&&f.push(t)});angular.copy(f,i);t.$evalAsync(function(){t.filterCssFiles(r,i,r,"css");var n=null;u=="css"?($("#cssFileList").find("tr.selected").removeClass("selected"),n=$("#selectedCssFiles")):u=="js"&&($("#jsFileList").find("tr.selected").removeClass("selected"),n=$("#selectedJsFiles"));n.closest("div").scrollTop(n.height());n.find("tr.selected").removeClass("selected");h(function(){n.find("tr:last").addClass("selected");t.selectedAddedfile=i[i.length-1]});t.cssFileList=[];t.jsFileList=[]})};t.selectAddedCssFile=function(n,i,r){var u=null;n&&(t.selectedAddedfile=i,u=$(n.currentTarget),$(r).find("tr.selected").removeClass("selected"),u&&u.hasClass("selected")?u.removeClass("selected"):u&&!u.hasClass("selected")&&u.addClass("selected"))};t.deleteCssFile=function(n,i,r){if(t.selectedAddedfile){var u=n.indexOf(t.selectedAddedfile);u>-1&&(i.indexOf(t.selectedAddedfile)<0&&i.push(t.selectedAddedfile),n.splice(u,1),t.selectedAddedfile=null,h(function(){u>n.length-1&&(u=u-1);var i=$(r).find("tr").eq(u);i&&!i.hasClass("selected")&&(i.addClass("selected"),t.selectedAddedfile=i.find("span").text())}))}};t.canDeleteCssFile=function(){return t.selectedAddedfile?!0:!1};t.canDeleteJsFile=function(){return t.selectedAddedfile?!0:!1};t.onCssDialogOkClick=function(){n.selectedPortalDetails.CSSFiles=angular.isArray(t.selectedCssFileList)&&t.selectedCssFileList.length>0?t.selectedCssFileList.join():"";n.selectedPortalDetails.JSFiles=angular.isArray(t.selectedJsFilesList)&&t.selectedJsFilesList.length>0?t.selectedJsFilesList.join():"";n.showPoratlDetails(n.selectedPortalDetails);i.close()};t.closeDialog=function(){i.close()};i=e.showDialog(t,t.title,"StartUp/views/AddCssFiles.html",{height:500,width:750})};n.portalMenuOptions=[["Rename",function(){n.addNewPortal("edit")},function(n){return n&&n.selectedProject.UserType!="owner"?!1:!0}],["Set As Default",function(t){n.setAsDefaultPortal();t.portal&&(e.UndRedoBulkOp("Start"),e.EditPropertyValue(t.portal.IsDefault,t.portal,"IsDefault","true"),e.UndRedoBulkOp("End"))},function(n){return n&&n.selectedProject.UserType!="owner"?!1:n.portal&&n.portal.IsDefault=="true"?!1:!0}],["Unset Default",function(n){n.portal&&n.portal.IsDefault&&(e.UndRedoBulkOp("Start"),e.EditPropertyValue(n.portal.IsDefault,n.portal,"IsDefault","false"),e.UndRedoBulkOp("End"))},function(n){return n&&n.selectedProject.UserType!="owner"?!1:n.portal&&n.portal.IsDefault=="true"?!0:void 0}]];n.setAsDefaultPortal=function(){var i,r,t;if(n.selectedProject&&n.selectedProject.htxPortals.length)for(i=0,r=n.selectedProject.htxPortals.length;i<r;i++)t=n.selectedProject.htxPortals[i],t&&t.IsDefault&&(e.UndRedoBulkOp("Start"),e.EditPropertyValue(t.IsDefault,t,"IsDefault","false"),e.UndRedoBulkOp("End"))};n.selectedCssFile=null;n.selectedJsFile=null;n.selectPortalCssFile=function(t,i){var r=null;t&&(n.selectedCssFile=i,r=$(t.currentTarget),$("#cssPortalFileList").find("tr.selected").removeClass("selected"),r&&r.hasClass("selected")?r.removeClass("selected"):r&&!r.hasClass("selected")&&r.addClass("selected"))};n.canDeleteCssFile=function(){return n.selectedCssFile?!0:!1};n.canMoveCssFileUp=function(){if(n.canDeleteCssFile()&&n.selectedCssFile){var t=n.lstPortalCss.indexOf(n.selectedCssFile);if(t>0)return!0}else return!1};n.canMoveCssFileDown=function(){if(n.canDeleteCssFile()&&n.selectedCssFile){var t=n.lstPortalCss.indexOf(n.selectedCssFile);if(t<n.lstPortalCss.length-1)return!0}else return!1};n.moveCssFileNameUpOrDown=function(t){if(n.selectedCssFile){e.UndRedoBulkOp("Start");var i=n.lstPortalCss.indexOf(n.selectedCssFile);e.DeleteItem(n.selectedCssFile,n.lstPortalCss);t=="up"?i-=1:i+=1;e.InsertItem(n.selectedCssFile,n.lstPortalCss,i);n.selectedPortalDetails.CSSFiles=n.lstPortalCss.join();e.UndRedoBulkOp("End");h(function(){var n=$("#cssPortalFileList").closest(".entity-dashboard-inner-section-container");n.scrollTo(n.find("tr.selected"),{offsetTop:130,offsetLeft:0},null)})}};n.deleteCssFile=function(){if(n.selectedCssFile){var t=n.lstPortalCss.indexOf(n.selectedCssFile);t>-1&&(e.DeleteItem(n.selectedCssFile,n.lstPortalCss),n.selectedPortalDetails.CSSFiles=n.lstPortalCss.join(),n.selectedCssFile=null,h(function(){t>n.lstPortalCss.length-1&&(t=t-1);var i=$("#cssPortalFileList").find("tr").eq(t);i&&!i.hasClass("selected")&&(i.addClass("selected"),n.selectedCssFile=i.find("span").text())}))}};n.selectPortalJsFile=function(t,i){var r=null;t&&(n.selectedJsFile=i,r=$(t.currentTarget),$("#jsPortalFileList").find("tr.selected").removeClass("selected"),r&&r.hasClass("selected")?r.removeClass("selected"):r&&!r.hasClass("selected")&&r.addClass("selected"))};n.canDeleteJsFile=function(){return n.selectedJsFile?!0:!1};n.canMoveJsFileUp=function(){if(n.canDeleteJsFile()&&n.selectedJsFile){var t=n.lstPortalJs.indexOf(n.selectedJsFile);if(t>0)return!0}else return!1};n.canMoveJsFileDown=function(){if(n.canDeleteJsFile()&&n.selectedJsFile){var t=n.lstPortalJs.indexOf(n.selectedJsFile);if(t<n.lstPortalJs.length-1)return!0}else return!1};n.moveJsFileNameUpOrDown=function(t){if(n.selectedJsFile){e.UndRedoBulkOp("Start");var i=n.lstPortalJs.indexOf(n.selectedJsFile);e.DeleteItem(n.selectedJsFile,n.lstPortalJs);t=="up"?i-=1:i+=1;e.InsertItem(n.selectedJsFile,n.lstPortalJs,i);n.selectedPortalDetails.JSFiles=n.lstPortalJs.join();e.UndRedoBulkOp("End");h(function(){var n=$("#jsPortalFileList").closest(".entity-dashboard-inner-section-container");n.scrollTo(n.find("tr.selected"),{offsetTop:130,offsetLeft:0},null)})}};n.deleteJsFile=function(){if(n.selectedJsFile){var t=n.lstPortalJs.indexOf(n.selectedJsFile);t>-1&&(e.DeleteItem(n.selectedJsFile,n.lstPortalJs),n.selectedPortalDetails.JSFiles=n.lstPortalJs.join(),n.selectedJsFile=null,h(function(){t>n.lstPortalJs.length-1&&(t=t-1);var i=$("#jsPortalFileList").find("tr").eq(t);i&&!i.hasClass("selected")&&(i.addClass("selected"),n.selectedJsFile=i.find("span").text())}))}}}]);var ExecuteQueryCount=1;app.controller("executequerycontroller",["$scope","$rootScope","$interval",function(n,t,i){hubMain.server.getExecuteQueryDetails().done(function(i){n.$apply(function(){if(n.QueryHeader="Execute Query("+ExecuteQueryCount+++")",n.QueryDivID="ExecuteQuery"+ExecuteQueryCount,t.IsOracleDB&&(n.lstExecuteQueryTables=[],i&&i.length>0&&i[0].NAME))for(var r=0,u=i.length;r<u;r++)i[r].name=i[r].NAME;n.lstExecuteQueryTables=i;n.Query="";n.TableName="";n.chkbxFetchRows=!0;n.setValueToQueryEditor()})});n.setValueToQueryEditor=function(){if(n.QueryEditor)n.QueryEditor&&n.QueryEditor.getSession().setValue(n.Query);else var t="Queryeditor_"+n.QueryDivID,r=i(function(){if($("#"+t).length>0){n.QueryEditor=ace.edit(t);n.QueryEditor.getSession().setMode("ace/mode/sql");n.QueryEditor.resize(!0);n.QueryEditor.setFontSize(13);n.QueryEditor.renderer.setShowGutter(!1);n.QueryEditor.getSession().setValue(n.Query);n.QueryEditor.getSession().on("change",function(){var t=n.QueryEditor.getValue();n.QueryEditor.curOp&&n.QueryEditor.curOp.command.name?n.Query=t:t&&t!=n.Query&&n.setValueToQueryEditor()});i.cancel(r)}},500)};n.selectedTab="data";n.selectTab=function(t){n.selectedTab=t};n.selectedTable=undefined;n.selectTable=function(t){n.selectedTable=t};n.onChange=function(t){n.chkbxFetchRows=t};n.ExecutetableQuery=function(i){var u,r;n.btn=i;n.QueryEditor&&(r=n.QueryEditor.getSelectedText(),r||(r=n.QueryEditor.getValue()));r&&(u=r);n.chkbxFetchRows&&r&&!t.IsOracleDB&&r.indexOf("select")>-1&&(u=[r.slice(0,r.toLowerCase().indexOf("select")+7)," Top 50 ",r.slice(r.toLowerCase().indexOf("select")+7)].join(""));u?(t.IsLoading=!0,hubMain.server.executeQueryTool(u,!0,"")):n.lstExecuteQuery1=undefined};n.getQuery=function(n,i){var u,r,o=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#taQuery"),f,e;return r=o[0],n==i?(f=r.value.substr(0,r.selectionStart).split("\n").length,e=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#taQuery").val().split("\n"),e[f-1]):(u=r.value.substring(n,i),u.replace("\n","").replace("\r",""))};n.receieveExecuteQuery=function(i){n.$evalAsync(function(){n.lstdata=JSON.parse(i);t.IsLoading=!1;n.btn=="btn1"?n.lstExecuteQuery1=n.lstdata:n.lstExecuteQuery2=n.lstdata})};n.RunAll=function(){if(n.Query!=undefined&&n.Query!=""){var t=n.Query;hubMain.server.runAllQueries(t).done(function(t){n.$apply(function(){n.strErrorMsgdata=t;alert("Complete")})})}}}]);app.directive("customtabledraggable",[function(){return{restrict:"A",scope:{dragdata:"="},link:function(n,t){function r(t){n.dragdata!=undefined&&n.dragdata!=""&&(t.dataTransfer.setData("text",JSON.stringify(n.dragdata)),dragDropData=n.dragdata)}var i=t[0];i.localName=="li";i.draggable=!0;i.addEventListener("dragstart",r,!1)}}}]);app.directive("droptable",[function(){return{restrict:"A",scope:{dropdata:"="},link:function(n,t){function r(t){return t.dataTransfer.dropEffect="copy",n.dropdata!=undefined&&n.dropdata!=""&&t.preventDefault&&t.preventDefault(),!1}function u(n){var t=getCurrentFileScope(),i;n.preventDefault();i=dragDropData;t.$apply(function(){i&&(t.TableName=i.name,t.Query+=t.Query==""?"select * from "+i.name+";":"\r\nselect * from "+i.name+";",t.setValueToQueryEditor&&t.setValueToQueryEditor(),dragDropData=null)});n.stopPropagation&&n.stopPropagation()}var i=t[0];i.addEventListener("dragover",r,!1);i.addEventListener("drop",u,!1)}}}]);app.controller("auditlogcontroller",["$scope","$http","$rootScope","$timeout",function(n,t,i){n.currentfile=i.currentopenfile.file;n.selectedDesignSource=!1;i.IsLoading=!0;hubMain.server.getModel(n.currentfile.FilePath,n.currentfile.FileType).done(function(t){t?n.receiveauditlogmodel(t):i.closeFile(n.currentfile.FileName)});n.receiveauditlogmodel=function(t){n.AuditlogFiledata=t;n.tableCount=30;n.$evalAsync(function(){n.Auditlogtableslist=t.objExtraData;i.IsLoading=!1;n.Getlistoftable()})};n.selectedDesignSource=!1;n.ShowDesign=function(){var t,e;if(n.selectedDesignSource==!0&&(n.selectedDesignSource=!1,t=n.editor.getValue(),t!=null&&t!=""&&n.isSourceDirty)){if(i.IsLoading=!0,t.length<32e3)hubMain.server.getXmlString(t,n.currentfile);else{var u="",o=[],f=0;for(e=0;e<t.length;e++)f++,u=u+t[e],f==32e3&&(f=0,o.push(u),u="");f!=0&&o.push(u);r(o,n.currentfile,"SourceToDesignCommon")}n.receivexmlobject=function(t){n.isSourceDirty&&(n.receiveauditlogmodel(t),n.isSourceDirty=!1)}}};n.isSourceDirty;n.sourceChanged=function(){n.isSourceDirty=!0;n.isDirty=!0;n.SearchSource.IsSearchCriteriaChange=!0};var r=function(n,t,i){for(var r=0;r<n.length;r++)hubMain.server.receiveDataPackets(n[r],n.length,t,r,i,null)};n.ShowSource=function(){var o,t,e;if(n.selectedDesignSource==!1&&(n.selectedDesignSource=!0,n.updateAuditLogFiledata(),n.AuditlogFiledata&&(i.IsLoading=!0,o=GetBaseModel(n.AuditlogFiledata),o!=""))){if(t=JSON.stringify(o),t.length<32e3)hubMain.server.getXmlObject(t,n.currentfile);else{var u="",s=[],f=0;for(e=0;e<t.length;e++)f++,u=u+t[e],f==32e3&&(f=0,s.push(u),u="");f!=0&&s.push(u);r(s,n.currentfile,"DesignToSourceCommon")}n.receivexml=function(t){n.$apply(function(){n.xmlSource=t;setDataToEditor(n,t,1,"auditlog");n.$evalAsync(function(){i.IsLoading=!1});window.navigator.userAgent.toLowerCase().contains("chrome")&&n.$evalAsync(function(){i.IsLoading=!1})})}}};n.BeforeSaveToFile=function(){n.updateAuditLogFiledata()};n.updateAuditLogFiledata=function(){var s,i,r,e,u,t,o,f;for(n.AuditlogFiledata.Elements=[],s={Name:"users",value:"",dictAttributes:{Include:"*"},Elements:[],Children:[]},n.AuditlogFiledata.Elements.push(s),i=n.Auditlogtableslist.filter(function(n){return n.IsExcluded||n.OnInsert||n.OnUpdate||n.OnDelete}),i.some(function(n){return n.IsExcluded})&&(e={Name:"fullauditlog",value:"",dictAttributes:{},Elements:[],Children:[]},r={Name:"Exclude",value:"",dictAttributes:{},Elements:[],Children:[]},e.Elements.push(r),n.AuditlogFiledata.Elements.push(e)),u=0;u<i.length;u++)t=i[u],(t.OnInsert||t.OnUpdate||t.OnDelete)&&(o=t.lstAuditTableDetails.filter(function(n){return t.IncludeAll?!n.IsAudit:n.IsAudit}).map(function(n){return n.ColumnName}),f={Name:"table",value:"",dictAttributes:{name:t.TableName,OnInsert:t.OnInsert,OnUpdate:t.OnUpdate,OnDelete:t.OnDelete,Exclude:t.IncludeAll?o.join(";"):"*",Include:t.IncludeAll?"*":o.join(";")},Elements:[],Children:[]},n.AuditlogFiledata.Elements.push(f)),t.IsExcluded&&r&&(f={Name:"table",value:"",dictAttributes:{name:t.TableName},Elements:[],Children:[]},r.Elements.push(f))};n.selectTable=function(t){n.selectedTable=t;n.selectedTable.columnCount=30};n.btns=[{label:"On Insert",state:!1},{label:"On Update",state:!1},{label:"On Delete",state:!1},{label:"On Excluded",state:!1}];n.toggle=function(t){t.state=!t.state;n.Getlistoftable()};n.Getlistoftable=function(){if(i.IsLoading=!0,n.tableCount=30,n.lstTables=[],n.btns[0].state||n.btns[1].state||n.btns[2].state||n.btns[3].state)for(var t=0;t<n.Auditlogtableslist.length;t++)n.lstTables.indexOf(n.Auditlogtableslist[t])==-1&&(n.Auditlogtableslist[t].OnInsert==n.btns[0].state&&n.btns[0].state==!0?n.lstTables.push(n.Auditlogtableslist[t]):n.Auditlogtableslist[t].OnUpdate==n.btns[1].state&&n.btns[1].state==!0?n.lstTables.push(n.Auditlogtableslist[t]):n.Auditlogtableslist[t].OnDelete==n.btns[2].state&&n.btns[2].state==!0?n.lstTables.push(n.Auditlogtableslist[t]):n.Auditlogtableslist[t].IsExcluded==n.btns[3].state&&n.btns[3].state==!0&&n.lstTables.push(n.Auditlogtableslist[t]));else n.lstTables=n.Auditlogtableslist;i.IsLoading=!1};n.toggleSelectAll=function(){if(n.selectedTable&&n.selectedTable.lstAuditTableDetails)for(var t=0;t<n.selectedTable.lstAuditTableDetails.length;t++)n.selectedTable.lstAuditTableDetails[t].IsAudit=n.selectedTable.IncludeAll};n.onTableScroll=function(){n.tableCount<n.Auditlogtableslist.length&&(n.tableCount+20<n.Auditlogtableslist.length?n.$apply(function(){n.tableCount=n.tableCount+20}):n.$apply(function(){n.tableCount=n.Auditlogtableslist.length}))};n.onColumnScroll=function(){n.selectedTable.columnCount<n.selectedTable.lstAuditTableDetails.length&&(n.selectedTable.columnCount+10<n.selectedTable.lstAuditTableDetails.length?n.$evalAsync(function(){n.selectedTable.columnCount=n.selectedTable.columnCount+10}):n.$evalAsync(function(){n.selectedTable.columnCount=n.selectedTable.lstAuditTableDetails.length}))}}]);app.controller("customSettingsController",["$scope","$rootScope","$timeout",function(n,t){var r,i;n.currentfile=t.currentopenfile.file;n.IsBaseAppFile=n.currentfile.IsBaseAppFile;hubMain.server.getModel(n.currentfile.FilePath,n.currentfile.FileType).done(function(i){i?n.receiveCustomSettingsmodel(i):t.closeFile(n.currentfile.FileName)});n.receiveCustomSettingsmodel=function(t){n.$apply(function(){n.customsettingsfiledata=t;n.selectedTab="entity";n.SelectedCustomTab="Entity";for(var i=0;i<n.customsettingsfiledata.Elements.length;i++)n.customsettingsfiledata.Elements[i].Name=="Entity"?n.objEntity=n.customsettingsfiledata.Elements[i]:n.customsettingsfiledata.Elements[i].Name=="Rule"?n.objRule=n.customsettingsfiledata.Elements[i]:n.customsettingsfiledata.Elements[i].Name=="Form"?n.objForm=n.customsettingsfiledata.Elements[i]:n.customsettingsfiledata.Elements[i].Name=="HTML"?n.objFormHtml=n.customsettingsfiledata.Elements[i]:n.customsettingsfiledata.Elements[i].Name=="Correspondence"?n.objCorrespondence=n.customsettingsfiledata.Elements[i]:n.customsettingsfiledata.Elements[i].Name=="Scenario"?n.objScenario=n.customsettingsfiledata.Elements[i]:n.customsettingsfiledata.Elements[i].Name=="BPM"?n.objBPM=n.customsettingsfiledata.Elements[i]:n.customsettingsfiledata.Elements[i].Name=="Workflow"?n.objWorkflow=n.customsettingsfiledata.Elements[i]:n.customsettingsfiledata.Elements[i].Name=="File"?n.objFile=n.customsettingsfiledata.Elements[i]:n.customsettingsfiledata.Elements[i].Name=="Report"&&(n.objReport=n.customsettingsfiledata.Elements[i]);n.objEntity&&n.objEntity.Elements.length>0&&(n.objEntity.SelectedField=n.objEntity.Elements[0]);n.objForm&&n.objForm.Elements.length>0&&(n.objForm.SelectedField=n.objForm.Elements[0]);n.objFormHtml&&n.objFormHtml.Elements.length>0&&(n.objFormHtml.SelectedField=n.objFormHtml.Elements[0]);n.objCorrespondence&&n.objCorrespondence.Elements.length>0&&(n.objCorrespondence.SelectedField=n.objCorrespondence.Elements[0]);n.objScenario&&n.objScenario.Elements.length>0&&(n.objScenario.SelectedField=n.objScenario.Elements[0]);n.objBPM&&n.objBPM.Elements.length>0&&(n.objBPM.SelectedField=n.objBPM.Elements[0]);n.objWorkflow&&n.objWorkflow.Elements.length>0&&(n.objWorkflow.SelectedField=n.objWorkflow.Elements[0]);n.objFile&&n.objFile.Elements.length>0&&(n.objFile.SelectedField=n.objFile.Elements[0]);n.objReport&&n.objReport.Elements.length>0&&(n.objReport.SelectedField=n.objReport.Elements[0]);n.objRule&&n.objRule.Elements.length>0&&(n.objRule.SelectedField=n.objRule.Elements[0]);n.objEntity||(n.objEntity=n.CreateNewObject("Entity",n.customsettingsfiledata));n.objRule||(n.objRule=n.CreateNewObject("Rule",n.customsettingsfiledata));n.objForm||(n.objForm=n.CreateNewObject("Form",n.customsettingsfiledata));n.objFormHtml||(n.objFormHtml=n.CreateNewObject("HTML",n.customsettingsfiledata));n.objCorrespondence||(n.objCorrespondence=n.CreateNewObject("Correspondence",n.customsettingsfiledata));n.objScenario||(n.objScenario=n.CreateNewObject("Scenario",n.customsettingsfiledata));n.objBPM||(n.objBPM=n.CreateNewObject("BPM",n.customsettingsfiledata));n.objWorkflow||(n.objWorkflow=n.CreateNewObject("Workflow",n.customsettingsfiledata));n.objFile||(n.objFile=n.CreateNewObject("File",n.customsettingsfiledata));n.objReport||(n.objReport=n.CreateNewObject("Report",n.customsettingsfiledata))})};n.selectedDesignSource=!1;n.ShowDesign=function(){var i,e;if(n.selectedDesignSource==!0&&(i=n.editor.getValue(),i!=null&&i!="")){if(t.IsLoading=!0,i.length<32e3)hubMain.server.getXmlString(i,n.currentfile);else{var u="",o=[],f=0;for(e=0;e<i.length;e++)f++,u=u+i[e],f==32e3&&(f=0,o.push(u),u="");f!=0&&o.push(u);r(o,n.currentfile,"SourceToDesignCommon")}n.receivexmlobject=function(i){n.selectedDesignSource=!1;n.isSourceDirty&&(n.receiveCustomSettingsmodel(i),n.isSourceDirty=!1);n.$evalAsync(function(){t.IsLoading=!1})}}};n.isSourceDirty;n.sourceChanged=function(){n.isSourceDirty=!0;n.isDirty=!0;n.SearchSource.IsSearchCriteriaChange=!0};r=function(n,t,i){for(var r=0;r<n.length;r++)hubMain.server.receiveDataPackets(n[r],n.length,t,r,i,null)};n.ShowSource=function(){var o,i,e;if(n.selectedDesignSource==!1&&(n.selectedDesignSource=!0,n.customsettingsfiledata&&(t.IsLoading=!0,o=GetBaseModel(n.customsettingsfiledata),o!=""))){if(i=JSON.stringify(o),i.length<32e3)hubMain.server.getXmlObject(i,n.currentfile);else{var u="",s=[],f=0;for(e=0;e<i.length;e++)f++,u=u+i[e],f==32e3&&(f=0,s.push(u),u="");f!=0&&s.push(u);r(s,n.currentfile,"DesignToSourceCommon")}n.receivexml=function(i){n.$apply(function(){n.xmlSource=i;setDataToEditor(n,i,1,"customsettings");n.$evalAsync(function(){t.IsLoading=!1});window.navigator.userAgent.toLowerCase().contains("chrome")&&n.$evalAsync(function(){t.IsLoading=!1})})}}};n.selectTab=function(t){n.selectedTab=t};n.CreateNewObject=function(n,t){var i={Name:n,Value:"",dictAttributes:{},Elements:[]};return t.Elements.push(i),i};n.AddExtraFields=function(i){var r={dictAttributes:{value:"",Description:"",ControlType:"TextBox",IsRequired:!1},Elements:[],Children:[],Name:"ColumnName",Value:""};i=="Entity"?(t.PushItem(r,n.objEntity.Elements),n.selectedField(n.objEntity,r)):i=="Form"?(t.PushItem(r,n.objForm.Elements),n.selectedField(n.objForm,r)):i=="HTML"?(t.PushItem(r,n.objFormHtml.Elements),n.selectedField(n.objFormHtml,r)):i=="Correspondence"?(t.PushItem(r,n.objCorrespondence.Elements),n.selectedField(n.objCorrespondence,r)):i=="Scenario"?(t.PushItem(r,n.objScenario.Elements),n.selectedField(n.objScenario,r)):i=="BPM"?(t.PushItem(r,n.objBPM.Elements),n.selectedField(n.objBPM,r)):i=="Workflow"?(t.PushItem(r,n.objWorkflow.Elements),n.selectedField(n.objWorkflow,r)):i=="File"?(t.PushItem(r,n.objFile.Elements),n.selectedField(n.objFile,r)):i=="Report"?(t.PushItem(r,n.objReport.Elements),n.selectedField(n.objReport,r)):i=="Rule"&&(t.PushItem(r,n.objRule.Elements),n.selectedField(n.objRule,r));r.IsFieldVisibility=!0};n.selectedField=function(n,t){n.SelectedField&&n.SelectedField!=t&&(n.SelectedField.IsFieldVisibility=!1);n.SelectedField=t};n.DeleteExtraFields=function(t){t=="Entity"?n.objEntity.SelectedField&&i(n.objEntity):t=="Form"?n.objForm.SelectedField&&i(n.objForm):t=="HTML"?n.objFormHtml.SelectedField&&i(n.objFormHtml):t=="Correspondence"?n.objCorrespondence.SelectedField&&i(n.objCorrespondence):t=="Scenario"?n.objScenario.SelectedField&&i(n.objScenario):t=="BPM"?n.objBPM.SelectedField&&i(n.objBPM):t=="Workflow"?n.objWorkflow.SelectedField&&i(n.objWorkflow):t=="File"?n.objFile.SelectedField&&i(n.objFile):t=="Report"?n.objReport.SelectedField&&i(n.objReport):n.objRule.SelectedField&&i(n.objRule)};i=function(n){var i=n.Elements.indexOf(n.SelectedField);t.DeleteItem(n.SelectedField,n.Elements);i<n.Elements.length?n.SelectedField=n.Elements[i]:n.Elements.length>0&&(n.SelectedField=n.Elements[i-1])};n.updateModelForBaseAppModel=function(t){n.IsBaseAppFile&&n.customsettingsfiledata&&n.customsettingsfiledata.BaseAppModel&&n.$evalAsync(function(){updateModelForBaseAppModel(n.customsettingsfiledata,n.customsettingsfiledata.BaseAppModel,t)})};n.revertToBaseAppModel=function(t){n.$evalAsync(function(){revertToBaseAppModel(t)})}}]);app.directive("customSetttingsDirective",["$rootScope","$timeout",function(n,t){return{restrict:"AE",replace:!0,scope:{currentFileObject:"="},link:function(i){i.objSettings=i.currentFileObject;i.ControlTypes=["TextBox","ComboBox","CheckBox","CheckBoxList","HyperLink"];i.selectedObjectfield=function(n){i.objSettings.SelectedField&&i.objSettings.SelectedField!=n&&(i.objSettings.SelectedField.IsFieldVisibility=!1);i.objSettings.SelectedField=n};i.getBoolValueForEnablingOrDisabling=function(n){return n.dictAttributes.ControlType=="TextBox"||n.dictAttributes.ControlType=="CheckBox"||n.dictAttributes.ControlType=="HyperLink"?(n.Elements=[],n.dictAttributes.ControlType=="CheckBox"&&delete n.dictAttributes.IsRequired,!0):!1};i.slectFirstObjectValue=function(n){n.SelectedValue=n.Elements[0]};i.selectedObjectValueIndex=function(n,t,i){var r=n;t.SelectedValue=i};i.AddValues=function(i){n.PushItem({dictAttributes:{Text:"",Description:""},Elements:[],Children:[],Name:"Value",Value:""},i.Elements);i.SelectedValue=i.Elements[i.Elements.length-1];t(function(){var n=$(".cust-setting-panel-body table tr:last");n&&$(".cust-setting-panel-body table > tbody").scrollTo(n,null,null)})};i.DeleteValues=function(t){var i=t.Elements.indexOf(t.SelectedValue);n.DeleteItem(t.Elements[i],t.Elements);t.SelectedValue=i>0?t.Elements[i-1]:t.Elements[i]};i.updateModelForBaseAppModel=function(){var n=getCurrentFileScope();n&&n.updateModelForBaseAppModel&&n.updateModelForBaseAppModel()};i.revertToBaseAppModel=function(n){var t=getCurrentFileScope();t&&t.revertToBaseAppModel&&t.revertToBaseAppModel(n)}},templateUrl:"Tools/views/CustomSettingsExtraField.html"}}]);app.controller("projectconfigurationcontroller",["$scope","$rootScope","$EntityIntellisenseFactory","$getEnitityXmlMethods","$filter","$timeout",function(n,t,i,r,u,f){n.objCommonproperties={};n.stdBookmarksModel={};n.objServerMethods={};n.remoteObjCollection={};n.objBusinessObject={};n.objBusinessObject.ObjTree=undefined;n.objBusinessObject.BusObjectName="";n.isSourceDirty=!1;n.serverMethodFilters={isServiceFilterVisible:!1,isServerMethodFilterVisible:!1};n.loadedTabs=[];n.IsBaseAppFile=!1;n.initialize=function(){function i(t){t&&(n.remoteObjCollection=t)}t.IsLoading=!0;n.currentfile=t.currentopenfile.file;n.IsBaseAppFile=n.currentfile.IsBaseAppFile;hubMain.server.getModel(t.currentopenfile.file.FilePath,t.currentopenfile.file.FileType).done(function(i){i?n.receiveProjectConfigurationmodel(i):t.closeFile(n.currentfile.FileName)});hubMain.server.getRemoteObjectCollection().done(i)};n.receiveProjectConfigurationmodel=function(i){n.$evalAsync(function(){var r,f;for(n.projectconfigurationfiledata=i,r=u("filter")(n.projectconfigurationfiledata.Elements,{Name:"commonproperties"},!0),n.objCommonproperties=r&&r.length>0?r[0]:n.CreateNewObject("commonproperties",n.projectconfigurationfiledata),r=u("filter")(n.objCommonproperties.Elements,{Name:"properties"},!0),n.propertiesModel=r&&r.length>0?r[0]:n.CreateNewObject("properties",n.objCommonproperties),r=u("filter")(n.projectconfigurationfiledata.Elements,{Name:"correspondence"},!0),n.correspondenceModel=r&&r.length>0?r[0]:n.CreateNewObject("correspondence",n.projectconfigurationfiledata),r=u("filter")(n.correspondenceModel.Elements,{Name:"stdbookmarks"},!0),n.stdBookmarksModel=r&&r.length>0?r[0]:n.CreateNewObject("stdbookmarks",n.correspondenceModel),r=u("filter")(n.projectconfigurationfiledata.Elements,{Name:"servermethods"},!0),n.objServerMethods=r&&r.length>0?r[0]:n.CreateNewObject("servermethods",n.projectconfigurationfiledata),r=u("filter")(n.projectconfigurationfiledata.Elements,{Name:"globalparameters"},!0),n.globalParametersModel=r&&r.length>0?r[0]:n.CreateNewObject("globalparameters",n.projectconfigurationfiledata),r=u("filter")(n.projectconfigurationfiledata.Elements,{Name:"applicationportals"},!0),n.portalsModel=r&&r.length>0?r[0]:n.CreateNewObject("applicationportals",n.projectconfigurationfiledata),f=0;f<n.stdBookmarksModel.Elements.length;f++)n.onCorrespondanceEntityChanged(n.stdBookmarksModel.Elements[f]);n.selectCommonPropertiesTab();n.objServerMethods.Elements&&n.objServerMethods.Elements.length>0&&n.getCurrentSrvMethod(n.objServerMethods.Elements[0]);n.validatePortals();t.IsLoading=!1})};n.CreateNewObject=function(n,t){var i={Name:n,Value:"",dictAttributes:{},Elements:[]};return t.Elements.push(i),i};n.showSource=!1;n.selectedDesignSource=!1;n.ShowDesign=function(){var i,r,s,o;if(n.selectedDesignSource==!0&&(n.selectedDesignSource=!1,i=n.editor.getValue(),r=n.editor.selection.getCursor().row,r=r+1,i!=null&&i!="")){if(t.IsLoading=!0,i.length<32e3)hubMain.server.getDesignXmlString(i,t.currentopenfile.file,r);else{s=[];s[0]=r>0?r:1;var u="",h=[],f=0;for(o=0;o<i.length;o++)f++,u=u+i[o],f==32e3&&(f=0,h.push(u),u="");f!=0&&h.push(u);e(h,t.currentopenfile.file,"Source-Design",s)}n.receivedesignxmlobject=function(i,r){n.isSourceDirty?(n.receiveProjectConfigurationmodel(i),n.$evalAsync(function(){n.selectItemByPath(r)}),n.isSourceDirty=!1):n.selectItemByPath(r);n.$evalAsync(function(){t.IsLoading=!1})}}};n.sourceChanged=function(){n.isSourceDirty=!0;n.isDirty=!0;n.SearchSource.IsSearchCriteriaChange=!0};var e=function(n,t,i,r){for(var u=0;u<n.length;u++)hubMain.server.receiveDataPackets(n[u],n.length,t,u,i,r)};n.ShowSource=function(){var s,u,y,a,v,h,c,i,o;if(n.selectedDesignSource==!1&&(n.selectedDesignSource=!0,n.projectconfigurationfiledata!=null&&n.projectconfigurationfiledata!=undefined&&(t.IsLoading=!0,s=GetBaseModel(n.projectconfigurationfiledata),s!=""))){if(u=[],t.IsLoading=!0,a=[],h=n.getSelectedItem(),h&&(c=[],y=n.FindDeepNode(n.projectconfigurationfiledata,h,c),v=n.getPathSource(n.projectconfigurationfiledata,c,a),angular.copy(v,u)),i=JSON.stringify(s),i.length<32e3)hubMain.server.getSourceXmlObject(i,t.currentopenfile.file,u);else{var r="",l=[],f=0;for(o=0;o<i.length;o++)f++,r=r+i[o],f==32e3&&(f=0,l.push(r),r="");f!=0&&l.push(r);e(l,t.currentopenfile.file,"Design-Source",u)}n.receivesourcexml=function(i,r){n.$apply(function(){n.xmlSource=i;setDataToEditor(n,i,r,"projectconfiguration");n.$evalAsync(function(){t.IsLoading=!1});window.navigator.userAgent.toLowerCase().contains("chrome")&&n.$evalAsync(function(){t.IsLoading=!1})})}}};n.getSelectedItem=function(){var t=null;switch(n.SelectedTab){case"CommonProperties":n.selectedCommonProperty&&(t=n.selectedCommonProperty);n.selectedObject&&(t=n.selectedObjectItem?n.selectedObjectItem:n.selectedObject);break;case"Correspondance":n.selectedStandardBookmark&&(t=n.selectedStandardBookmarkItem?n.selectedStandardBookmarkItem:n.selectedStandardBookmark);break;case"ServerMethods":n.currentSrvMethod&&(t=n.currentMethod?n.currentMethod:n.currentSrvMethod);break;case"GlobalParameters":n.selectedGlobalParameter&&(t=n.selectedGlobalParameter);break;default:t=n.selectedCommonProperty}return t};n.selectItemByPath=function(t){var r,u,i;if(console.log(t),t!=null&&t!=""){if(r=[],t.contains("-")||t.contains(","))for(u=n.projectconfigurationfiledata,i=0;i<t.split(",").length;i++)u=n.FindNodeHierarchy(u,t.split(",")[i].substring(t.split(",")[i].lastIndexOf("-")+1)),r.push(u);if(r.length>1)for(i=0;i<r.length;i++){if(r[i].Name=="commonproperties"){n.selectCommonPropertiesTab();continue}if(n.SelectedTab=="CommonProperties"&&i>0&&r[i-1].Name=="properties"&&r[i].Name=="item"){n.selectCommonProperty(r[i]);continue}if(n.SelectedTab=="CommonProperties"&&r[i].Name=="object"){n.selectObject(r[i]);n.toggleObjectExpander(r[i],!0);continue}if(n.SelectedTab=="CommonProperties"&&i>0&&r[i-1].Name=="object"&&r[i].Name=="item"){n.selectObjectItem(r[i-1],r[i]);continue}if(r[i].Name=="correspondence"){n.selectCorrespondanceTab();continue}if(n.SelectedTab!="Correspondance"||r[i].Name!="stdbookmarks"){if(n.SelectedTab=="Correspondance"&&i>0&&r[i-1].Name=="stdbookmarks"&&r[i].Name=="object"){n.selectStandardBookmark(r[i]);n.toggleStandardBookmarkExpander(r[i],!0);continue}if(n.SelectedTab=="Correspondance"&&i>1&&r[i-1].Name=="object"&&r[i].Name=="item"){n.selectStandardBookmarkItem(r[i-1],r[i]);continue}if(r[i].Name=="servermethods"){n.selectServerMethods();continue}if(n.SelectedTab=="ServerMethods"&&r[i].Name=="methodgroup"){n.getCurrentSrvMethod(r[i]);continue}if(n.SelectedTab=="ServerMethods"&&i>0&&r[i-1].Name=="methodgroup"&&r[i].Name=="method"){n.getCurrentMethod(r[i]);continue}if(r[i].Name=="globalparameters"){n.selectGlobalParametersTab();continue}if(n.SelectedTab=="GlobalParameters"&&r[i].Name=="globlarparameter"){n.selectGlobalParameter(r[i]);continue}}}else r.length==1&&(n.selectCommonPropertiesTab(),n.selectCommonProperty(r[0]))}};n.FindNodeHierarchy=function(n,t){if(n&&n.Elements){var i=n.Elements[t];return i==undefined&&(i=n.Elements[t-1]),i}};n.FindDeepNode=function(t,i,r){return t&&angular.forEach(t.Elements,function(t){var u=n.isValidObject(t,i);return(u&&r.push(t),t==i)?i:t.Elements&&t.Elements.length>0?i=n.FindDeepNode(t,i,r):void 0}),i};n.isValidObject=function(t,i){var u,r;if(t==i)return!0;for(r in t.Elements){if(t.Elements[r]==i)return!0;if(t.Elements[r].Elements&&t.Elements[r].Elements.length>0)for(iele in t.Elements[r].Elements)if(u=n.isValidObject(t.Elements[r].Elements[iele],i),u==!0)return u}return u};n.getPathSource=function(n,t,i){for(var u,r=0;r<t.length;r++)r==0?(u=n.Elements.indexOf(t[r]),i.push(u)):(u=t[r-1].Elements.indexOf(t[r]),i.push(u));return i};n.selectCommonPropertiesTab=function(){n.SelectedTab="CommonProperties";n.loadedTabs.indexOf("CommonProperties")==-1&&n.loadedTabs.push("CommonProperties")};n.selectCorrespondanceTab=function(){n.SelectedTab="Correspondance";n.loadedTabs.indexOf("Correspondance")==-1&&n.loadedTabs.push("Correspondance")};n.selectServerMethods=function(){n.SelectedTab="ServerMethods";n.loadedTabs.indexOf("ServerMethods")==-1&&n.loadedTabs.push("ServerMethods")};n.selectGlobalParametersTab=function(){n.SelectedTab="GlobalParameters";n.loadedTabs.indexOf("GlobalParameters")==-1&&n.loadedTabs.push("GlobalParameters")};n.selectPortalsTab=function(){n.SelectedTab="Portals";n.loadedTabs.indexOf("Portals")==-1&&n.loadedTabs.push("Portals")};n.onBusObjectChanged=function(t,i){t&&t.IsObjectVisibility&&n.$evalAsync(function(){n.objBusinessObject.BusObjectName=t.dictAttributes.ID;n.objBusinessObject.ObjTree=undefined});i&&n.loadXmlMethods(t)};n.loadObjectTreeForExpandedObject=function(t){if(t&&t.length>0){var i=u("filter")(t,{IsObjectVisibility:!0},!0);i&&i.length>0&&i[0].dictAttributes&&i[0].dictAttributes.ID&&i[0].dictAttributes.ID.trim().length>0&&n.objBusinessObject.ObjTree.ObjName!=i[0].dictAttributes.ID&&n.$evalAsync(function(){n.objBusinessObject.BusObjectName=i[0].dictAttributes.ID;n.objBusinessObject.ObjTree=undefined})}};n.receiveObjectTree=function(t,i){n.$evalAsync(function(){var u=JSON.parse(t),r;i!=undefined&&i!=""?(r=getBusObjectByPath(i,n.objBusinessObject.ObjTree),r&&r.ItemType.Name==u.ObjName&&(r.ChildProperties=u.ChildProperties,r.lstMethods=u.lstMethods,r.HasLoadedProp=!0),SetParentForObjTreeChild(r)):(n.objBusinessObject.ObjTree=u,n.objBusinessObject.ObjTree.IsMainBusObject=!0,n.objBusinessObject.ObjTree.IsVisible=!0,SetParentForObjTreeChild(n.objBusinessObject.ObjTree))})};n.selectCommonProperty=function(i,r){n.selectedObject&&(n.selectedObject.IsObjectVisibility=!1,n.selectedObject=null);r?t.EditPropertyValue(n.selectedCommonProperty,n,"selectedCommonProperty",i):n.selectedCommonProperty=i};n.addEditCommonProperty=function(i){var r=n.$new();i?(r.id=i.dictAttributes.ID,r.description=i.dictAttributes.sfwDescription,r.BaseAppModel=i.BaseAppModel,r.IsBaseAppModel=i.IsBaseAppModel):(r.id="",r.description="");r.validateID=function(){r.errorMessage="";r.id&&r.id.trim().length>0?n.propertiesModel.Elements.some(function(n){return i?n.dictAttributes.ID==r.id&&n!=i:n.dictAttributes.ID==r.id})&&(r.errorMessage="Duplicate ID."):r.errorMessage="ID cannot be blank or whitespace(s)."};r.updateCommonProperty=function(){if(t.UndRedoBulkOp("Start"),i)t.EditPropertyValue(i.dictAttributes.ID,i.dictAttributes,"ID",r.id),t.EditPropertyValue(i.dictAttributes.sfwDescription,i.dictAttributes,"sfwDescription",r.description);else{var u={Name:"item",Value:"",dictAttributes:{ID:r.id,sfwDescription:r.description},Elements:[]};t.PushItem(u,n.propertiesModel.Elements);n.selectCommonProperty(u,!0)}t.UndRedoBulkOp("End");r.cancel()};r.cancel=function(){r.dialog&&r.dialog.close&&r.dialog.close()};r.dialog=t.showDialog(r,i?"Edit Common Property":"Add Common Property","Tools/views/AddEditCommonProperty.html",{width:500,height:300});r.validateID()};n.canDeleteCommonProperty=function(){return n.selectedCommonProperty&&!n.selectedCommonProperty.IsBaseAppModel};n.deleteCommonProperty=function(){var i=n.propertiesModel.Elements.indexOf(n.selectedCommonProperty);i>-1&&(t.UndRedoBulkOp("Start"),t.DeleteItem(n.selectedCommonProperty,n.propertiesModel.Elements),n.propertiesModel.Elements.length>0?(i==n.propertiesModel.Elements.length&&i--,n.selectCommonProperty(n.propertiesModel.Elements[i],!0)):n.selectCommonProperty(null,!0),t.UndRedoBulkOp("End"))};n.selectObject=function(i,r){n.selectedCommonProperty=null;r?t.EditPropertyValue(n.selectedObject,n,"selectedObject",i):n.selectedObject=i};n.addObject=function(){var i={dictAttributes:{},Elements:[],Children:[],Name:"object",Value:""};t.UndRedoBulkOp("Start");t.PushItem(i,n.objCommonproperties.Elements);n.selectObject(i,!0);n.toggleObjectExpander(i);t.UndRedoBulkOp("End")};n.canDeleteObject=function(){return n.selectedObject&&!n.selectedObject.IsBaseAppModel};n.deleteObject=function(){var i=n.objCommonproperties.Elements.filter(function(n){return n.Name=="object"}),u,r;i&&i.length>0&&(u=n.objCommonproperties.Elements.indexOf(n.selectedObject),r=i.indexOf(n.selectedObject),u>-1&&r>-1&&(t.UndRedoBulkOp("Start"),t.DeleteItem(n.selectedObject,n.objCommonproperties.Elements),i=n.objCommonproperties.Elements.filter(function(n){return n.Name=="object"}),i&&i.length>0?(r==i.length&&r--,n.selectObject(i[r],!0)):n.selectObject(null,!0),t.UndRedoBulkOp("End")))};n.toggleObjectExpander=function(t,i){if(t)for(var r=0;r<n.objCommonproperties.Elements.length;r++){n.objCommonproperties.Elements[r].Name=="object"&&(n.objCommonproperties.Elements[r].IsObjectVisibility=n.objCommonproperties.Elements[r]==t?i?!0:!n.objCommonproperties.Elements[r].IsObjectVisibility:!1);n.onEntityChanged(t.dictAttributes.ID)}};n.selectObjectItem=function(i,r,u){u?t.EditPropertyValue(i.selectedObjectItem,i,"selectedObjectItem",r):(i.selectedObjectItem=r,n.selectedObjectItem=r)};n.addObjectItem=function(i){var r={dictAttributes:{},Elements:[],Children:[],Name:"item",Value:""};t.UndRedoBulkOp("Start");t.PushItem(r,i.Elements);n.selectObjectItem(i,r,!0);t.UndRedoBulkOp("End")};n.canDeleteObjectItem=function(n){return n.selectedObjectItem&&!n.selectedObjectItem.IsBaseAppModel};n.deleteObjectItem=function(i){var r=i.Elements.indexOf(i.selectedObjectItem);r>-1&&(t.UndRedoBulkOp("Start"),t.DeleteItem(i.selectedObjectItem,i.Elements),i.Elements.length>0?(r==i.Elements.length&&r--,n.selectObjectItem(i,i.Elements[r],!0)):n.selectObjectItem(i,null,!0),t.UndRedoBulkOp("End"))};n.onObjectFieldChanged=function(t){t.dictAttributes.sfwEntityField&&t.dictAttributes.sfwEntityField.trim().length>0&&(t.dictAttributes.sfwObjectMethod="");n.updateModelForBaseAppModel()};n.onObjectMethodChanged=function(t){t.dictAttributes.sfwObjectMethod&&t.dictAttributes.sfwObjectMethod.trim().length>0&&(t.dictAttributes.sfwEntityField="");n.updateModelForBaseAppModel()};n.getObjectMethodList=function(t,i){if(i.ctrlKey&&i.keyCode==$.ui.keyCode.SPACE&&$(i.currentTarget).data("ui-autocomplete")&&$(i.currentTarget).val()!="")$(i.currentTarget).autocomplete("search",$(i.currentTarget).val()),i.preventDefault();else if(i.ctrlKey&&i.keyCode==$.ui.keyCode.SPACE){n.onEntityChanged(t);setSingleLevelAutoComplete($(i.currentTarget),n.lstObjectMethod,n,"ID","ID");$(i.currentTarget).data("ui-autocomplete")&&$(i.currentTarget).autocomplete("search",$(i.currentTarget).val());i.preventDefault()}else $(i.currentTarget).data("ui-autocomplete")&&$(i.currentTarget).val()!=""&&$(i.currentTarget).autocomplete("search",$(i.currentTarget).val())};n.showObjectMethodList=function(t,i){if(n.inputElement=$(i.target).prevAll("input[type='text']"),n.inputElement){if($(n.inputElement).focus(),$(n.inputElement).val()=="")n.onEntityChanged(t);if(n.lstObjectMethod&&n.lstObjectMethod.length>0)setSingleLevelAutoComplete(n.inputElement,n.lstObjectMethod,n,"ID","ID"),$(n.inputElement).data("ui-autocomplete")&&$(n.inputElement).autocomplete("search",$(n.inputElement).val());else n.onEntityChanged(t)}i&&i.stopPropagation()};n.onEntityChanged=function(t){var e=i.getEntityIntellisense(),r,f,u;for(parententityName=t,n.lstObjectMethod=[];parententityName;){if(r=e.filter(function(n){return n.ID==parententityName}),r.length>0&&r[0].ObjectMethods&&r[0].ObjectMethods.length>0){for(f=[],u=0;u<r[0].ObjectMethods.length;u++)r[0].ObjectMethods[u].Parameters&&r[0].ObjectMethods[u].Parameters.length==0&&r[0].ObjectMethods[u].ReturnType!="Void"&&r[0].ObjectMethods[u].ID&&f.push(r[0].ObjectMethods[u]);n.lstObjectMethod=n.lstObjectMethod.concat(f)}parententityName=r.length>0?r[0].ParentId:""}};n.selectStandardBookmark=function(i,r){r?t.EditPropertyValue(n.selectedStandardBookmark,n,"selectedStandardBookmark",i):n.selectedStandardBookmark=i};n.addStandardBookmark=function(){var i={Name:"object",Value:"",dictAttributes:{},Elements:[]};t.UndRedoBulkOp("Start");t.PushItem(i,n.stdBookmarksModel.Elements);n.selectStandardBookmark(i,!0);t.UndRedoBulkOp("End");n.toggleStandardBookmarkExpander(i)};n.canDeleteStandardBookmark=function(){return n.selectedStandardBookmark&&!n.selectedStandardBookmark.IsBaseAppModel};n.deleteStandardBookmark=function(){var i=n.stdBookmarksModel.Elements.indexOf(n.selectedStandardBookmark);i>-1&&(t.UndRedoBulkOp("Start"),t.DeleteItem(n.selectedStandardBookmark,n.stdBookmarksModel.Elements),n.stdBookmarksModel.Elements.length>0&&(i==n.stdBookmarksModel.Elements.length&&i--,n.selectStandardBookmark(n.stdBookmarksModel.Elements[i],!0)),t.UndRedoBulkOp("End"))};n.toggleStandardBookmarkExpander=function(t,i){if(t){for(var r=0;r<n.stdBookmarksModel.Elements.length;r++)n.stdBookmarksModel.Elements[r].IsObjectVisibility=n.stdBookmarksModel.Elements[r]==t?i?!0:!n.stdBookmarksModel.Elements[r].IsObjectVisibility:!1;n.onCorrespondanceEntityChanged(t)}};n.loadXmlMethods=function(n){var f=i.getEntityIntellisense(),t=u("filter")(f,{BusinessObjectName:n.dictAttributes.ID},!0);t&&t.length>0&&(n.xmlMethods=r.get(t[0].ID))};n.onCorrespondanceEntityChanged=function(n){var r,t;if(n)for(r=i.getEntityIntellisense(),parententityName=n.dictAttributes.ID,n.xmlMethods=[];parententityName;)t=r.filter(function(n){return n.ID==parententityName}),t.length>0&&t[0].XmlMethods&&t[0].XmlMethods.length>0&&(n.xmlMethods=n.xmlMethods.concat(t[0].XmlMethods)),parententityName=t.length>0?t[0].ParentId:"";else n.xmlMethods=[]};n.selectStandardBookmarkItem=function(i,r,u){i&&(u?(t.EditPropertyValue(i.selectedStandardBookmarkItem,i,"selectedStandardBookmarkItem",r),i.selectedStandardBookmarkItem=r):i.selectedStandardBookmarkItem=r,n.selectedStandardBookmarkItem=r)};n.addStandardBookmarkItem=function(t){if(t)n.AddOrEditStandardBookMark(t,{Name:"item",Value:"",dictAttributes:{},Elements:[]},"Add")};n.canDeleteStandardBookmarkItem=function(n){return n.selectedStandardBookmarkItem&&!n.selectedStandardBookmarkItem.IsBaseAppModel};n.deleteStandardBookmarkItem=function(i){var r=i.Elements.indexOf(i.selectedStandardBookmarkItem);r>-1&&(t.UndRedoBulkOp("Start"),t.DeleteItem(i.selectedStandardBookmarkItem,i.Elements),i.Elements.length>0&&(r==i.Elements.length&&r--,n.selectStandardBookmarkItem(i.Elements[r],!0)),t.UndRedoBulkOp("End"))};n.AddOrEditStandardBookMark=function(i,r,u){var f=n.$new(),e;f.objBookMark={};f.objBookMark.Entity=i.dictAttributes.ID;r?(f.objBookMark.id=r.dictAttributes.ID,f.objBookMark.EntityField=r.dictAttributes.sfwEntityField):(f.objBookMark.id="",f.objBookMark.EntityField="");f.errorMessage="";f.IsBaseAppModel=r.IsBaseAppModel||r.BaseAppModel;f.validateID=function(){var t,i;if(f.errorMessage="",f.objBookMark.id&&f.objBookMark.id.trim().length>0){if(f.objBookMark.id&&f.objBookMark.id.substring(0,3)!="std")f.errorMessage="ID should start with 'std' prefix .";else if(f.objBookMark.id&&f.objBookMark.id.substring(0,3)=="std"&&f.objBookMark.id.length==3)f.errorMessage="'std' is prefix , Enter valid ID.";else if(n.stdBookmarksModel&&n.stdBookmarksModel.Elements.length)for(t=0;t<n.stdBookmarksModel.Elements.length;t++){for(i=0;i<n.stdBookmarksModel.Elements[t].Elements.length;i++)if(n.stdBookmarksModel.Elements[t].Elements[i]!=r&&f.objBookMark.id==n.stdBookmarksModel.Elements[t].Elements[i].dictAttributes.ID){f.errorMessage="Duplicate ID.";break}if(f.errorMessage)break}}else f.errorMessage="ID cannot be blank or whitespace(s)."};f.cancel=function(){f.dialog&&f.dialog.close&&f.dialog.close()};f.updateStandardBookMark=function(){t.UndRedoBulkOp("Start");u=="Add"?(r.dictAttributes.ID=f.objBookMark.id,r.dictAttributes.sfwEntityField=f.objBookMark.EntityField,t.PushItem(r,i.Elements),n.selectStandardBookmarkItem(i,r,!0)):u=="Edit"&&(t.EditPropertyValue(r.dictAttributes.ID,r.dictAttributes,"ID",f.objBookMark.id),t.EditPropertyValue(r.dictAttributes.sfwEntityField,r.dictAttributes,"sfwEntityField",f.objBookMark.EntityField));t.UndRedoBulkOp("End");n.updateModelForBaseAppModel();f.cancel()};e="";e=u=="Edit"?"Edit Standard Book Mark":"Add Standard Book Mark";f.dialog=t.showDialog(f,e,"Tools/views/AddEditStandardBookMark.html",{width:500,height:300});f.validateID()};n.clearServerMethodFilter=function(){n.serverMethodFilters.isServerMethodFilterVisible=!1};n.selectAndScrollSrvMethod=function(t,i){n.getCurrentSrvMethod(t,i);f(function(){var n=$("#server-method-list").find(".searchrowSelected");n&&n.length&&n[0].scrollIntoView()})};n.getCurrentSrvMethod=function(i,r){r?(t.EditPropertyValue(n.currentSrvMethod,n,"currentSrvMethod",i),t.EditPropertyValue(n.currentMethod,n,"currentMethod",null)):(n.currentSrvMethod=i,n.currentMethod=null);n.clearServerMethodFilter()};n.selectAndScrollRemoteMethod=function(t,i){n.getCurrentMethod(t,i);f(function(){var n=$("#remote-method-list").find(".searchrowSelected");n&&n.length&&n[0].scrollIntoView()})};n.getCurrentMethod=function(i,r){r?t.EditPropertyValue(n.currentMethod,n,"currentMethod",i):n.currentMethod=i};n.refreshAllRemoteObjects=function(){var r,i,u;if(n.objServerMethods.Elements.length>0){for(t.ClearUndoRedoListByFileName(t.currentopenfile.file.FileName),r=n.objServerMethods.Elements.indexOf(n.currentSrvMethod),i=n.objServerMethods.Elements.length-1;i>=0;i--)n.remoteObjCollection.indexOf(n.objServerMethods.Elements[i].dictAttributes.ID)<0&&(r>=i&&(r-=1),n.isDirty=!0,n.objServerMethods.Elements.splice(i,1));n.objServerMethods.Elements.length>0?(u=!1,n.objServerMethods.Elements.forEach(function(t){n.currentSrvMethod&&n.currentSrvMethod.dictAttributes.ID==t.dictAttributes.ID&&(u=!0);n.refreshRemoteObject(t,!0)}),u||n.getCurrentSrvMethod(n.objServerMethods.Elements[r]?n.objServerMethods.Elements[r]:n.objServerMethods.Elements[0])):n.getCurrentSrvMethod(undefined)}};n.refreshRemoteObject=function(i,r){t.ClearUndoRedoListByFileName(t.currentopenfile.file.FileName);var u=i.Elements.indexOf(n.currentMethod);t.IsLoading=!0;$.connection.hubMain.server.getRemoteObjectMethods(i.dictAttributes.ID).done(function(f){n.$evalAsync(function(){var o,e;if(f)if(f.length>0){for(e=i.Elements.length-1;e>=0;e--){function s(n){if(n.MethodName==i.Elements[e].dictAttributes.ID)return!0}f.some(s)||(u>=e&&(u-=1),n.isDirty=!0,i.Elements.splice(e,1))}i.Elements.length>0?(o=!1,i.Elements.forEach(function(t){n.currentMethod&&t.dictAttributes.ID==n.currentMethod.dictAttributes.ID&&(o=!0);n.refreshRemoteMethod(i.dictAttributes.ID,t)}),r?n.getCurrentMethod(undefined):o||n.getCurrentMethod(i.Elements[u]?i.Elements[u]:i.Elements[0])):n.getCurrentMethod(undefined)}else{for(n.isDirty=!0,e=i.Elements.length-1;e>=0;e--)i.Elements.splice(e,1);n.getCurrentMethod(undefined)}else toastr.warning(i.dictAttributes.ID+" is not a valid method group");t.IsLoading=!1})})};n.refreshRemoteMethod=function(i,r){t.currentopenfile&&t.ClearUndoRedoListByFileName(t.currentopenfile.file.FileName);t.IsLoading=!0;$.connection.hubMain.server.getRemoteMethod(i,r.dictAttributes.ID).done(function(i){n.$evalAsync(function(){var u,f;if(i)for(n.isDirty=!0,r.Elements=[],u=0;u<i.Parameters.length;u++)f={Name:"parameter",Value:"",dictAttributes:{ID:i.Parameters[u].ParameterName,sfwDataType:i.Parameters[u].ParameterType.FullName},Elements:[]},r.Elements.push(f);else toastr.warning(r.dictAttributes.ID+" is not a valid method");t.IsLoading=!1})})};n.OpenAddMethodWindow=function(){var i=n.$new();$.connection.hubMain.server.getRemoteObjectMethods(n.currentSrvMethod.dictAttributes.ID).done(function(t){n.$evalAsync(function(){i.lstRemoteObjMethod=t})});i.templateUrl="Tools/views/AddServerMethod.html";i.methodMessage="Please select method.";i.OnOkClick=function(){t.UndRedoBulkOp("Start");var r={Name:"method",Value:"",dictAttributes:{ID:i.selectedMethodName.MethodName,sfwMode:i.sfwMode},Elements:[]};angular.forEach(i.lstParameters,function(n){var i={Name:"parameter",Value:"",dictAttributes:{ID:n.ParameterName,sfwDataType:n.ParameterType.FullName},Elements:[]};t.PushItem(i,r.Elements);i={}});i.selectedMethodName&&i.sfwMode&&angular.forEach(n.objServerMethods.Elements,function(u){u.dictAttributes.ID==n.currentSrvMethod.dictAttributes.ID&&(t.PushItem(r,u.Elements),i.OnCancelClick())});n.getCurrentMethod(r,!0);t.UndRedoBulkOp("End")};i.OnCancelClick=function(){i.dialog&&i.dialog.close()};i.getParameters=function(){i.lstParameters=i.selectedMethodName.Parameters};i.validateServerMethod=function(){if(i.methodMessage="",i.selectedMethodName){if(i.sfwMode){if(i.currentSrvMethod){var t=!1;return n.currentSrvMethod.Elements.length==0?!1:(angular.forEach(n.currentSrvMethod.Elements,function(n){n.dictAttributes.ID==i.selectedMethodName.MethodName&&(i.methodMessage="This method already exists.",t=!0)}),t)}return!1}return i.methodMessage="Please select Mode.",!0}return i.methodMessage="Please select method.",!0};i.templateUrl&&i.templateUrl.trim().length>0&&(i.dialog=t.showDialog(i,"Add Method",i.templateUrl,{width:500,height:300}))};n.OpenAddMethodGroup=function(){function r(n){var t=i.remoteObjCollection.indexOf(n.dictAttributes.ID);t>=0&&i.remoteObjCollection.splice(t,1)}var i=n.$new();i.templateUrl="Tools/views/AddServerMethodGroup.html";i.remoteObjCollection=angular.copy(n.remoteObjCollection);n.objServerMethods.Elements.forEach(r);i.srvMethodMessage="Please select method.";i.validData=!0;i.OnOkClick=function(){if(t.UndRedoBulkOp("Start"),i.selectedMethodGroup){var r={Name:"methodgroup",Value:"",dictAttributes:{ID:i.selectedMethodGroup},Elements:[]};t.PushItem(r,n.objServerMethods.Elements);i.OnCancelClick()}n.getCurrentSrvMethod(r,!0);t.UndRedoBulkOp("End")};i.OnCancelClick=function(){i.dialog&&i.dialog.close()};i.checkMethodGroupValidity=function(){i.validData=!1;angular.forEach(n.objServerMethods.Elements,function(n){if(n.dictAttributes.ID==i.selectedMethodGroup)return i.srvMethodMessage="This server method already exists.",i.validData=!0,!1})};i.templateUrl&&i.templateUrl.trim().length>0&&(i.dialog=t.showDialog(i,"Add Method Group",i.templateUrl,{width:500,height:300}))};n.DeleteMethodGroup=function(){var i=n.objServerMethods.Elements.indexOf(n.currentSrvMethod);i>-1&&(toastr.success("Server group deleted Successfully"),t.UndRedoBulkOp("Start"),t.DeleteItem(n.currentSrvMethod,n.objServerMethods.Elements),n.objServerMethods.Elements.length>0&&(i==n.objServerMethods.Elements.length&&i--,n.getCurrentSrvMethod(n.objServerMethods.Elements[i],!0)),t.UndRedoBulkOp("End"))};n.DeleteMethod=function(){var i=n.currentSrvMethod.Elements.indexOf(n.currentMethod);i>-1&&(toastr.success("Method deleted Successfully"),t.UndRedoBulkOp("Start"),t.DeleteItem(n.currentMethod,n.currentSrvMethod.Elements),n.currentSrvMethod.Elements.length>0&&(i==n.currentSrvMethod.Elements.length&&i--,n.getCurrentMethod(n.currentSrvMethod.Elements[i],!0)),t.UndRedoBulkOp("End"))};n.removeOldID=function(n){t.EditPropertyValue(n.dictAttributes.OldID,n.dictAttributes,"OldID","")};n.selectGlobalParameter=function(i,r){r?t.EditPropertyValue(n.selectedGlobalParameter,n,"selectedGlobalParameter",i):n.selectedGlobalParameter=i};n.addGlobalParameter=function(){var i={Name:"globlarparameter",Value:"",dictAttributes:{},Elements:[]};t.UndRedoBulkOp("Start");t.PushItem(i,n.globalParametersModel.Elements);n.selectGlobalParameter(i,!0);t.UndRedoBulkOp("End")};n.canDeleteGlobalParameter=function(){return n.selectedGlobalParameter&&!n.selectedGlobalParameter.IsBaseAppModel};n.deleteGlobalParameter=function(){var i=n.globalParametersModel.Elements.indexOf(n.selectedGlobalParameter);i>-1&&(t.UndRedoBulkOp("Start"),t.DeleteItem(n.selectedGlobalParameter,n.globalParametersModel.Elements),n.globalParametersModel.Elements.length>0&&(i==n.globalParametersModel.Elements.length&&i--,n.selectGlobalParameter(n.globalParametersModel.Elements[i],!0)),t.UndRedoBulkOp("End"))};n.selectPortal=function(i,r){r?t.EditPropertyValue(n.selectedPortal,n,"selectedPortal",i):n.selectedPortal=i};n.addPortal=function(){var i={Name:"portal",Value:"",dictAttributes:{sfwPortalType:"MVVM"},Elements:[]};t.UndRedoBulkOp("Start");t.PushItem(i,n.portalsModel.Elements);n.selectPortal(i,!0);t.UndRedoBulkOp("End");n.validatePortals()};n.canDeletePortal=function(){return n.selectedPortal&&!n.selectedPortal.IsBaseAppModel};n.deletePortal=function(){var i=n.portalsModel.Elements.indexOf(n.selectedPortal);i>-1&&(t.UndRedoBulkOp("Start"),t.DeleteItem(n.selectedPortal,n.portalsModel.Elements),n.portalsModel.Elements.length>0&&(i==n.portalsModel.Elements.length&&i--,n.selectPortal(n.portalsModel.Elements[i],!0)),t.UndRedoBulkOp("End"));n.validatePortals()};n.validatePortal=function(t){t.dictAttributes.ID?n.portalsModel.Elements.some(function(n){return n.dictAttributes.ID===t.dictAttributes.ID&&n!==t})?(t.errors||(t.errors={}),t.errors.ID="Duplicate Portal ID. Please provide a different Portal ID."):t.errors&&(t.errors.ID=null):(t.errors||(t.errors={}),t.errors.ID="Portal ID cannot be empty.");t.dictAttributes.sfwPortalName?n.portalsModel.Elements.some(function(n){return n.dictAttributes.sfwPortalName===t.dictAttributes.sfwPortalName&&n!==t})?(t.errors||(t.errors={}),t.errors.sfwPortalName="Duplicate Portal Name. Please provide a different Portal Name."):t.errors&&(t.errors.sfwPortalName=null):(t.errors||(t.errors={}),t.errors.sfwPortalName="Portal Name cannot be empty.")};n.validatePortals=function(){for(var t=0,i=n.portalsModel.Elements.length;t<i;t++)n.validatePortal(n.portalsModel.Elements[t])};n.initialize();n.updateModelForBaseAppModel=function(t){n.IsBaseAppFile&&n.projectconfigurationfiledata&&n.projectconfigurationfiledata.BaseAppModel&&n.$evalAsync(function(){updateModelForBaseAppModel(n.projectconfigurationfiledata,n.projectconfigurationfiledata.BaseAppModel,t)})};n.revertToBaseAppModel=function(t){n.$evalAsync(function(){revertToBaseAppModel(t)})}}]);app.controller("ConvertToHtxController",["$scope","hubcontext","$rootScope","$cookies","$DashboardFactory",function(n,t,i,r,u){i.IsLoading=!0;n.SearchText="";n.location="";n.IsMaintenance=!0;n.IsLookup=!0;n.IsWizard=!0;n.IsProcessing=!0;n.IsConverting=!1;n.isCheckAllFiles=!1;n.lstFileDetails=[];n.pageIndex=1;n.lstSelectedFiles=[];n.changeFileList=function(){n.pageIndex=1;n.filetype="";n.IsMaintenance?n.filetype="Maintenance":n.RemoveSelectedFiles("Maintenance");n.IsLookup?n.filetype!=""?n.filetype+=",Lookup":n.filetype="Lookup":n.RemoveSelectedFiles("Lookup");n.IsWizard?n.filetype!=""?n.filetype+=",Wizard":n.filetype="Wizard":n.RemoveSelectedFiles("Wizard");n.getFilterList()};n.RemoveSelectedFiles=function(t){if(n.lstSelectedFiles.length>0)for(var i=n.lstSelectedFiles.length;i--;)n.lstSelectedFiles[i].File&&n.lstSelectedFiles[i].File.FileType&&n.lstSelectedFiles[i].File.FileType==t&&n.lstSelectedFiles.splice(i,1)};n.getFilterList=function(){n.lstWfmFiles&&n.lstWfmFiles.length>0&&angular.forEach(n.lstWfmFiles,function(t){t.IsSelected&&(n.lstSelectedFiles.some(function(n){return n.FileName==t.File.FileName})||n.lstSelectedFiles.push(t))});t.hubConvertToHtx.server.getWfmFormList(n.pageIndex,n.filetype,n.SearchText,n.location).done(function(t){n.$evalAsync(function(){n.IsProcessing=!1;t?(n.lstWfmFiles=t,n.lstSelectedFiles.length>0&&n.lstWfmFiles&&n.lstWfmFiles.length>0&&angular.forEach(n.lstSelectedFiles,function(t){if(t&&t.File&&t.File.FileName){var i=n.lstWfmFiles.filter(function(n){return n.File&&n.File.FileName==t.File.FileName});i&&i.length>0&&(i[0].IsSelected=!0,i[0].Status=t.Status)}}),n.isCheckAllFiles&&n.checkAllFiles(!0)):n.lstWfmFiles=[];i.IsLoading=!1})})};n.changeFileList();n.checkAllFiles=function(t){n.isCheckAllFiles=t;n.lstWfmFiles&&n.lstWfmFiles.length>0&&angular.forEach(n.lstWfmFiles,function(n){n.Status&&n.Status=="Completed"||(n.IsSelected=t)})};n.convertToHtxClick=function(){var u=[],r,h,e,f,o,s,c;if(n.lstWfmFiles&&n.lstWfmFiles.length>0&&angular.forEach(n.lstWfmFiles,function(n){n.IsSelected&&(n.Status="Pending",u.push(n.File.FileName))}),u.length>0){if(r=n.$new(),r.lstDirtyFiles=[],h=JSON.stringify(i.lstopenedfiles),e=JSON.parse(h),i.lstopenedfiles&&i.lstopenedfiles.length>0)for(f=0;f<e.length;f++)for(o=0;o<u.length;o++)e[f].file.FileName===u[o]&&(s=getScopeByFileName(e[f].file.FileName),s&&(s.isDirty?r.lstDirtyFiles.push(e[f]):i.closeFile(e[f].file.FileName)));r.lstDirtyFiles.length>0?(c=i.showDialog(r,"UnSaved File List","Common/views/UnsavedFileListDialog.html"),r.closeSaveListDialog=function(f){var o=angular.element($('div[ng-controller="PageLayoutController"]')).scope(),e;if(f=="Yes")for(e=0;e<r.lstDirtyFiles.length;e++){o.onsavefileclick(r.lstDirtyFiles[e]);i.closeFile(r.lstDirtyFiles[e].file.FileName)}else if(f=="No")for(e=0;e<r.lstDirtyFiles.length;e++)i.closeFile(r.lstDirtyFiles[e].file.FileName);n.IsProcessing=!0;n.IsConverting=!0;n.lstSelectedFiles=[];t.hubConvertToHtx.server.convertToHtx(u,n.isCheckAllFiles,n.filetype,n.SearchText,n.location);c.close()}):u&&u.length>0&&(n.IsProcessing=!0,n.IsConverting=!0,n.lstSelectedFiles=[],t.hubConvertToHtx.server.convertToHtx(u,n.isCheckAllFiles,n.filetype,n.SearchText,n.location))}};n.receiveFileStatus=function(t){n.$evalAsync(function(){var r,i;if(t!="ConversionCompleted"&&t!="ConversionCanceled"){if(r=!1,n.lstWfmFiles&&n.lstWfmFiles.length>0)for(i=0;i<n.lstWfmFiles.length;i++)if(t.File&&t.File.FileName&&n.lstWfmFiles[i].File.FileName===t.File.FileName){n.lstWfmFiles[i].IsSelected=!1;n.lstWfmFiles[i].Status=t.Status;r=!0;break}!r&&t.File&&t.File.FileName&&n.lstWfmFiles.push(t)}else t=="ConversionCompleted"?(t.Status&&t.Status=="Completed"&&toastr.success("Selected Files are succesfully converted."),n.IsConverting=!1,n.updateUserFiles(n.lstSelectedFiles)):t=="ConversionCanceled"&&(n.IsConverting=!1,n.updateUserFiles(n.lstSelectedFiles));t.File&&t.File.FileName&&t.Status=="Completed"&&n.lstSelectedFiles.push(t)})};n.OnFormScroll=function(){n.IsProcessing||(n.IsProcessing=!0,n.pageIndex=n.pageIndex+1,n.getFilterList())};n.SearchFormList=function(){n.lstSelectedFiles=[];n.IsConverting||(n.pageIndex=1,n.IsProcessing=!0,n.getFilterList())};n.updateUserFiles=function(t){var f,o,e,s;if(t.length>0){for(f=[],e=0;e<t.length;e++)f.push(t[e].File);for(o=r.getObject("UserDetails"),e=0;e<f.length;e++)f[e].UserId=JSON.parse(o).UserID,f[e].Data=null;s=u.deleteUserFiles({pinnedFiles:f,recentFiles:f});s.then(function(t){t&&n.$evalAsync(function(){i.IsFilesAddedDelete=!0;i.IsTfsUpdated=!0;for(var t=0;t<f.length;t++)n.$parent.addanddeleteuserfile("Unpin",f[t]),n.$parent.addanddeleteuserfile("Unrecent",f[t]);i.isstartpagevisible&&(u.getFileTypeData(),u.getTfsStatusData(),n.$broadcast("updateUserFiles"))})})}};$('div[ng-controller="ConvertToHtxController"]').on("keydown",function(t){t.keyCode==13&&n.SearchFormList()});n.selectCurrentRow=function(t){n.selectedCurrentRow=t};n.getClass=function(t){return t&&t.IsSelected?"selected":t&&t==n.selectedCurrentRow?"select-cell-control":""}}]);app.controller("SelectEntitiesDiagram",["$scope","$rootScope","$EntityIntellisenseFactory","$Chart",function(n,t,i,r){function e(n,t){var r=!1,i;if(t.length>0)for(i=0;i<t.length;i++)if(t[i].file.FileName==n){r=!0;break}return r}function o(n,t,i){for(var r=String.format("{0}{1}",n,i.toString());e(r,t);)i++,r=String.format("{0}{1}",n,i.toString());return r}t.IsLoading=!0;var u=i.getEntityIntellisense(),f=JSON.stringify(u);n.lstEntity=JSON.parse(f);t.IsLoading=!1;n.onShowEntityDiagramClick=function(){var i,u,f;n.objEntityDiagram=[];n.lstCreatedEntity=[];n.exampleNodes=[];n.exampleLinks=[];i=n.lstEntity.filter(function(n){return n.IsSelected==!0});i.length>0?angular.forEach(i,function(t){n.CreateEntityDiagram(t,n.objEntityDiagram)}):toastr.warning("Please select entity.");angular.forEach(n.objEntityDiagram,function(t){n.CreateEntityDiagramLinks(t)});u=o("ERDiagram",t.lstopenedfiles,0);r.setData(n.exampleNodes,n.exampleLinks);i.length>0&&(f={Data:null,FileName:u,FilePath:"",FileType:"ERDiagram",TFSState:"None",TimeModified:null},t.openFile(f),n.onEntityDiagramCancelClick())};n.CreateEntityDiagram=function(t,i){var s=n.lstCreatedEntity.filter(function(n){return n&&n.toLowerCase()==t.EntityName.toLowerCase()}),r,o,e,u,f;s.length==0?(r={lstOneToOne:[],lstOneToMany:[],entityName:t.EntityName,lstActiveAttributes:[]},i.push(r),o=[],angular.forEach(t.Attributes,function(n){n.ID&&n.Type&&(n.Type=="Object"||n.Type=="Collection"||n.Type=="List"||n.Type=="CDOCollection")&&o.push(n.ID)}),n.exampleNodes.push({type:"Entity",id:t.EntityName,name:t.EntityName,attributes:o}),n.lstCreatedEntity.push(t.EntityName),t.Attributes&&(u=t.Attributes.filter(function(n){return n.Type&&n.Type.toLowerCase()=="object"}),u.length>0&&angular.forEach(u,function(t){var i,f,e,u;t.Entity&&(i=n.lstEntity.filter(function(n){return n.EntityName&&n.EntityName==t.Entity}),i.length>0&&(r.lstActiveAttributes.push(t),f=n.lstCreatedEntity.filter(function(n){return n&&n.toLowerCase()==t.Entity.toLowerCase()}),f.length==0&&(e={lstOneToOne:[],lstOneToMany:[],entityName:i[0].EntityName,lstActiveAttributes:[]},r.lstOneToOne.push(e),u=[],angular.forEach(i[0].Attributes,function(n){n.ID&&n.Type&&(n.Type=="Object"||n.Type=="Collection"||n.Type=="List")&&u.push(n.ID)}),n.exampleNodes.push({type:"Entity",id:i[0].EntityName,name:i[0].EntityName,attributes:u}),n.lstCreatedEntity.push(i[0].EntityName))))}),f=t.Attributes.filter(function(n){return n.Type&&(n.Type.toLowerCase()=="collection"||n.Type.toLowerCase()=="list"||n.Type.toLowerCase()=="cdocollection")}),f.length>0&&angular.forEach(f,function(t){var i,f,e,u;t.Entity&&(i=n.lstEntity.filter(function(n){return n.EntityName==t.Entity}),i.length>0&&(r.lstActiveAttributes.push(t),f=n.lstCreatedEntity.filter(function(n){return n&&n.toLowerCase()==t.Entity.toLowerCase()}),f.length==0&&(e={lstOneToOne:[],lstOneToMany:[],entityName:i[0].EntityName,lstActiveAttributes:[]},r.lstOneToMany.push(e),u=[],angular.forEach(i[0].Attributes,function(n){u.length<10&&n.ID&&n.Type&&(n.Type=="Object"||n.Type=="Collection"||n.Type=="List"||n.Type=="CDOCollection")&&u.push(n.ID)}),n.exampleNodes.push({type:"Entity",id:i[0].EntityName,name:i[0].EntityName,attributes:u}),n.lstCreatedEntity.push(i[0].EntityName))))}))):(e=n.GetCreatedEntityObject(t),t.Attributes&&e&&(u=t.Attributes.filter(function(n){return n.Type&&n.Type.toLowerCase()=="object"}),u.length>0&&angular.forEach(u,function(t){var i,u,f,r;t.Entity&&(i=n.lstEntity.filter(function(n){return n.EntityName&&n.EntityName==t.Entity}),i.length>0&&(e.lstActiveAttributes.push(t),u=n.lstCreatedEntity.filter(function(n){return n&&n.toLowerCase()==t.Entity.toLowerCase()}),u.length==0&&(f={lstOneToOne:[],lstOneToMany:[],entityName:i[0].EntityName,lstActiveAttributes:[]},e.lstOneToOne.push(f),r=[],angular.forEach(i[0].Attributes,function(n){r.length<5&&n.ID&&n.Type&&(n.Type=="Object"||n.Type=="Collection"||n.Type=="List"||n.Type=="CDOCollection")&&r.push(n.ID)}),n.exampleNodes.push({type:"Entity",id:i[0].EntityName,name:i[0].EntityName,attributes:r}),n.lstCreatedEntity.push(i[0].EntityName))))}),f=t.Attributes.filter(function(n){return n.Type&&(n.Type.toLowerCase()=="collection"||n.Type.toLowerCase()=="list"||n.Type.toLowerCase()=="cdocollection")}),f.length>0&&angular.forEach(f,function(t){var i,u,f,r;t.Entity&&(i=n.lstEntity.filter(function(n){return n.EntityName==t.Entity}),i.length>0&&(e.lstActiveAttributes.push(t),u=n.lstCreatedEntity.filter(function(n){return n&&n.toLowerCase()==t.Entity.toLowerCase()}),u.length==0&&(f={lstOneToOne:[],lstOneToMany:[],entityName:i[0].EntityName,lstActiveAttributes:[]},e.lstOneToMany.push(f),r=[],angular.forEach(i[0].Attributes,function(n){n.ID&&n.Type&&(n.Type=="Object"||n.Type=="Collection"||n.Type=="List"||n.Type=="CDOCollection")&&r.push(n.ID)}),n.exampleNodes.push({type:"Entity",id:i[0].EntityName,name:i[0].EntityName,attributes:r}),n.lstCreatedEntity.push(i[0].EntityName))))})))};n.CreateEntityDiagramLinks=function(t){t.lstActiveAttributes&&t.lstActiveAttributes.length>0&&(angular.forEach(t.lstActiveAttributes,function(i){var r={source:t.entityName,target:i.Entity,value:5,type:""},u;i.Type&&i.Type=="Object"?r.type="onetoone":i.Type&&(i.Type=="Collection"||i.Type=="List"||i.Type=="CDOCollection")&&(r.type="onetomany");u=n.exampleLinks.filter(function(n){return n.source==r.source&&n.target==r.target&&n.type==r.type});u.length==0&&n.exampleLinks.push(r)}),t.lstOneToOne&&t.lstOneToOne.length>0&&angular.forEach(t.lstOneToOne,function(t){n.CreateEntityDiagramLinks(t)}),t.lstOneToMany&&t.lstOneToMany.length>0&&angular.forEach(t.lstOneToMany,function(t){n.CreateEntityDiagramLinks(t)}))};n.GetCreatedEntityObject=function(t){for(var f,u,e,o,r=null,i=0;i<n.objEntityDiagram.length;i++){if(n.objEntityDiagram[i].entityName.toLowerCase()==t.EntityName.toLowerCase()&&(r=n.objEntityDiagram[i]),!r&&n.objEntityDiagram[i].lstOneToOne&&n.objEntityDiagram[i].lstOneToOne.length>0)for(f=n.objEntityDiagram[i].lstOneToOne,u=0;u<f.length;u++)if(f[u].entityName.toLowerCase()==t.EntityName.toLowerCase()){r=f[u];break}if(!r&&n.objEntityDiagram[i].lstOneToMany&&n.objEntityDiagram[i].lstOneToMany.length>0)for(e=n.objEntityDiagram[i].lstOneToMany,o=0;o<e.length;o++)if(e[o].entityName.toLowerCase()==t.EntityName.toLowerCase()){r=e[u];break}}return r}}]);app.controller("NewERDiagram",["$scope","$rootScope","$Chart","$timeout",function(n,t,i,r){n.currentOpenFileName=angular.copy(t.currentopenfile.file.FileName);n.init=function(){r(function(){i.drawErDiagram(n.currentOpenFileName)})};n.init()}]);app.controller("AddCodeGroupController",["$scope","hubcontext","$rootScope","$cookies","$DashboardFactory",function(n,t,i,r,u){n.SelectAllCheckBoxChange=function(){n.IsEntity=n.IsForm=n.IsHtmlForm=n.IsCorrespondence=n.IsReport=n.IsFile=n.IsSelectAll};n.FileTypeCheckBoxChange=function(){n.IsSelectAll=n.IsEntity&&n.IsForm&&n.IsHtmlForm&&n.IsCorrespondence&&n.IsReport&&n.IsFile?!0:!1};n.GetInvalidCodeGroup=function(){var r=[];n.IsEntity&&r.push("Entity");n.IsForm&&(r.push("Lookup"),r.push("Maintenance"),r.push("Wizard"),r.push("UserControl"),r.push("Tooltip"));n.IsHtmlForm&&(r.push("FormLinkLookup"),r.push("FormLinkMaintenance"),r.push("FormLinkWizard"));n.IsCorrespondence&&r.push("Correspondence");n.IsReport&&r.push("Report");n.IsFile&&r.push("InboundFile");r.length>0?(i.IsLoading=!0,t.hubTools.server.getInvalidCodeGroup(r.join(",")).done(function(t){n.$evalAsync(function(){i.IsLoading=!1;n.lstInvalidCodeGroups=t})})):toastr.warning("Select at least one file type!")};n.CloseAddCodeGroupDialog=function(){n.CodeGroupDialog.close()};n.onSaveCodeGroups=function(){n.lstInvalidCodeGroups&&n.lstInvalidCodeGroups.length>0&&(i.IsLoading=!0,t.hubMain.server.saveCodeGroups(n.lstInvalidCodeGroups).done(function(t){if(n.$evalAsync(function(){i.IsLoading=!1}),n.CloseAddCodeGroupDialog(),t.length){i.IsTfsUpdated=!0;i.isstartpagevisible&&u.getTfsStatusData();for(var r=0;r<t.length;r++)i.updateUserFileDetails(t[r]);toastr.success(t.length+" file(s) saved successfully.")}}))};i.checkAndCloseFilesAndSaveCodeGroups=function(){var t=n.$new(),e,u,f,o,r;if(t.lstDirtyFiles=[],t.lstNotDirtyFiles=[],e=JSON.stringify(i.lstopenedfiles),u=JSON.parse(e),i.lstopenedfiles&&i.lstopenedfiles.length>0)for(r=0;r<u.length;r++)f=getScopeByFileName(u[r].file.FileName),f&&(f.isDirty?t.lstDirtyFiles.push(u[r]):t.lstNotDirtyFiles.push(u[r]));if(t.lstDirtyFiles.length>0)o=i.showDialog(t,"UnSaved File List","Common/views/UnsavedFileListDialog.html"),t.closeSaveListDialog=function(i){var u=angular.element($('div[ng-controller="PageLayoutController"]')).scope(),r;if(i=="Yes"){for(r=0;r<t.lstDirtyFiles.length;r++){u.onsavefileclick(t.lstDirtyFiles[r]);n.CheckInvalidCodeGroupFileAndClose(t.lstDirtyFiles[r].file.FileName)}for(r=0;r<t.lstNotDirtyFiles.length;r++)n.CheckInvalidCodeGroupFileAndClose(t.lstNotDirtyFiles[r].file.FileName);n.onSaveCodeGroups()}else if(i=="No"){for(r=0;r<t.lstDirtyFiles.length;r++)n.CheckInvalidCodeGroupFileAndClose(t.lstDirtyFiles[r].file.FileName);for(r=0;r<t.lstNotDirtyFiles.length;r++)n.CheckInvalidCodeGroupFileAndClose(t.lstNotDirtyFiles[r].file.FileName);n.onSaveCodeGroups()}o.close()};else{for(r=0;r<t.lstNotDirtyFiles.length;r++)n.CheckInvalidCodeGroupFileAndClose(t.lstNotDirtyFiles[r].file.FileName);n.onSaveCodeGroups()}};n.CheckInvalidCodeGroupFileAndClose=function(t){if(n.lstInvalidCodeGroups&&n.lstInvalidCodeGroups.length>0&&t){var r=n.lstInvalidCodeGroups.filter(function(n){return n.FileName&&n.FileName.toLowerCase()==t.toLowerCase()});r.length>0&&i.closeFile(t)}}}]);app.controller("ValidationUtilityControl",["$scope","hubcontext","$Errors","$ModuleValidationService","$rootScope",function(n,t,i,r,u){n.moduleType="Form";n.istrStatusMessage="";n.iblnFailed=!1;n.lstValidatedFiles=[];n.istrFilevalidatedMsg="";n.totalFileCount;n.fileValidatedCount;n.iobjModel;n.lobjResponseData=[];n.iblnProcessing=!1;n.onModuleTypeChange=function(t){n.iblnProcessing||(n.moduleType=t)};n.Validate=function(){u.IsLoading=!0;n.lstValidatedFiles=[];n.istrStatusMessage="Getting the files for Validation....";n.istrFilevalidatedMsg="";n.totalFileCount=0;n.fileValidatedCount=0;n.lobjResponseData=[];t.hubValidationUtility.server.getFileList(1,n.moduleType).done(function(t){n.$evalAsync(function(){u.IsLoading=!1;t&&t.length>0?(n.iblnProcessing=!0,n.lobjResponseData=t,n.totalFileCount=t.length,n.lstValidatedFiles=[],n.istrStatusMessage="Validation started....",n.iobjModel=t[0],t.splice(0,1),n.fileValidatedCount=n.totalFileCount-t.length,n.iobjModel.Model.istrStatus="Pending",n.istrStatusMessage="Validating "+n.iobjModel.FileName+" File....",r.validate(n.iobjModel.Model,n,n.moduleType)):n.istrStatusMessage="No files for validation...."})})};n.validateFile=function(t){var e,u,o,c;if(t==="Failed")n.iblnFailed=!0,n.iblnProcessing=!1,n.istrStatusMessage="Cannot validate further due to error.";else if(t==="Completed"){if(n.istrFilevalidatedMsg=n.fileValidatedCount+" out of "+n.totalFileCount,i.validationListObj.length>0&&i.validationListObj[0].FileName===n.iobjModel.FileName){var f={FileName:n.iobjModel.FileName,status:t,errorList:[],warningList:[]},s=i.validationListObj[0].errorList,h=i.validationListObj[0].warningList;if(s&&s.length)for(u=0;u<s.length;u++)e=s[u],c=e.dictAttributes.ID?e.dictAttributes.ID:"",f.errorList.push({istrControl:e.Name,istrControlID:c,errors:e.errors});if(h&&h.length)for(u=0;u<h.length;u++)o=h[u],c=o.dictAttributes.ID?o.dictAttributes.ID:"",f.warningList.push({istrControl:o.Name,istrControlID:c,errors:o.warnings});(f.errorList.length>0||f.warningList.length>0)&&n.lstValidatedFiles.push(f)}i.validationListObj=[];n.lobjResponseData.length>0?(n.iobjModel=n.lobjResponseData[0],n.lobjResponseData.splice(0,1),n.fileValidatedCount=n.totalFileCount-n.lobjResponseData.length,n.iobjModel.Model.istrStatus="Pending",n.istrStatusMessage="Validating "+n.iobjModel.FileName+" File....",r.validate(n.iobjModel.Model,n,n.moduleType)):n.lobjResponseData.length==0&&(n.iblnProcessing=!1,n.istrStatusMessage="All files are validated.")}};n.sendDataInPackets=function(t,i){for(var u="",f=[],e=0,r=0,o=t.length;r<o;r++)e++,u=u+t[r],e==32e3&&(e=0,f.push(u),u="");for(e!=0&&f.push(u),r=0,o=f.length;r<o;r++)hubMain.server.receiveDataPackets(f[r],o,n.currentopenfile,r,i,[])};n.ExportvalidationReport=function(){var i=JSON.stringify(n.lstValidatedFiles);i.length<32e3?t.hubMain.server.exportValidationReport(n.lstValidatedFiles):n.sendDataInPackets(i,"GeneratevalidationReport")};n.receiveExportvalidationReport=function(n){n&&alert("Validation report generated at "+n+" path.")}}]);