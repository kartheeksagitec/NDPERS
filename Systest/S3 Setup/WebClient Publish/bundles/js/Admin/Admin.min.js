app.controller("AdminController",["$scope","$http","$rootScope","ConfigurationFactory","$cookies","$timeout","$SgMessagesService",function(n,t,i,r,u,f,e){n.ilstClients=[];n.iobjSelectedClient=null;n.ilstUsers=[];n.iobjSelecteduser=null;n.ilstAllUsers=[];n.iobjUserTabSelectedUser=null;n.iobjUserTabSelectedClient=null;n.isRefreshRequired=!0;var o=(new Date).getUTCMonth()+1;n.iobjNewClient={ClientID:-1,ClientName:"",SDSLicenseType:"S",SASLicenseType:"S",SMSLicenseType:"S",ActiveUserLimit:-1,Status:"active",StartDate:o+"/"+(new Date).getUTCDate()+"/"+(new Date).getUTCFullYear(),EndDate:null,Domains:[],UserTypes:[]};n.iobjNewDomain={DomainID:-1,DomainName:"",LDAPPath:""};n.ilstLicenseTypes=[{ID:"S",Description:"Standard"},{ID:"A",Description:"Advanced"},{ID:"E",Description:"Enterprise"},{ID:"N",Description:"None"}];n.init=function(){var t=u.getObject("UserDetails");n.LoginName=JSON.parse(t).UserName;n.getClients();n.getUserInfo()};n.getClients=function(){t({method:"POST",data:{},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Admin/GetClients"}).then(function(t){i.IsProjectLoaded=!1;t.data&&t.data.length&&(n.ilstClients=t.data)},function(n){i.IsProjectLoaded=!1;i.showExceptionDetails(n.data)})};n.saveClient=function(t,r,u){$.ajax({url:"api/Admin/SaveClient",type:"POST",async:!0,dataType:"json",data:t,success:function(i){i&&t.ClientID===-1&&(t.ClientID=i);u?n.$broadcast("stUpdateRowBroadcast",{objUpdated:t,stid:r}):n.$broadcast("stAddRowBroadcast",{objAdded:t,stid:r})},error:function(n){i.showExceptionDetails(n)}})};n.deleteClient=function(t){t&&e.Message("Delete","ClientID :"+t.ClientName+" will be deleted, Do you want to continue?",!0,function(r){r&&(!t||t.Domains&&t.Domains.length!=0||t.UserTypes&&t.UserTypes!=0?e.Message("Alert","Please un-map users and domains for this client"):$.ajax({url:"api/Login/DeleteClient",type:"POST",async:!0,dataType:"json",data:t,success:function(){n.$broadcast("stDeleteRowBroadcast",{objDeleted:t})},error:function(n){i.showExceptionDetails(n)}}))})};n.selectClient=function(t){n.iobjSelectedClient=t;n.iobjNewDomain.ClientID=t.ClientID};n.initializeComponentPicker=function(){ComponentsPickers.init()};n.validateClient=function(t){if(n.iobjClientValidation="",t){if(t.ClientName)for(var i=0;i<n.ilstClients.length;i++)if(n.ilstClients[i].ClientName&&t.ClientName.toLowerCase()==n.ilstClients[i].ClientName.toLowerCase()&&t.ClientID!=n.ilstClients[i].ClientID){n.iobjClientValidation="Client Name cannot be duplicate.";break}t.ClientName&&t.ClientName.trim().length>0?t.SDSLicenseType&&t.SDSLicenseType.trim().length>0?t.SASLicenseType&&t.SASLicenseType.trim().length>0?t.SMSLicenseType&&t.SMSLicenseType.trim().length>0?t.ActiveUserLimit?t.Status&&t.Status.trim().length>0?t.StartDate&&t.StartDate.trim().length>0||(n.iobjClientValidation="Start Date cannot be empty."):n.iobjClientValidation="Status cannot be empty.":n.iobjClientValidation="Active User Limit cannot be empty or 0. Set -1 for unlimited.":n.iobjClientValidation="SMS License Type cannot be empty.":n.iobjClientValidation="SAS License Type cannot be empty.":n.iobjClientValidation="SDS License Type cannot be empty.":n.iobjClientValidation="Client Name cannot be empty."}};n.saveDomain=function(t){$.ajax({url:"api/Admin/SaveDomainClientMapping",type:"POST",async:!0,dataType:"json",data:t,success:function(i){i&&(i==="DUPLICATE_DOMAIN"?toastr.error("Domain Name with a different LDAP Path already exists."):t.DomainID===-1&&n.$evalAsync(function(){t.DomainID=i;n.selectDomain(t)}))},error:function(n){i.showExceptionDetails(n)}})};n.deleteDomain=function(){n.iobjSelectedDomain&&e.Message("Delete","Domain Name :"+n.iobjSelectedDomain.DomainName+" will be deleted, Do you want to continue?",!0,function(r){r&&(i.IsLoading=!0,t({method:"POST",data:{clientID:n.iobjSelectedClient.ClientID,domainID:n.iobjSelectedDomain.DomainID},headers:{"Content-Type":"application/json; charset=utf-8"},async:!1,url:"api/Admin/DeleteDomain"}).then(function(t){t.data&&t.data=="SUCCESS"&&n.$evalAsync(function(){var t=n.iobjSelectedClient.Domains.indexOf(n.iobjSelectedDomain);t>-1&&n.iobjSelectedClient.Domains.splice(t,1);n.iobjSelectedDomain=null});i.IsLoading=!1},function(n){i.IsLoading=!1;i.showExceptionDetails(n.data)}))})};n.selectDomain=function(t){n.iobjSelectedDomain=t};n.validateDomain=function(t){n.domainValidationMessage="";t&&(t.DomainName&&t.DomainName.trim().length>0?t.LDAPPath&&t.LDAPPath.trim().length>0||(n.domainValidationMessage="LDAP Path cannot be empty."):n.domainValidationMessage="Domain Name cannot be empty.")};n.getUserInfo=function(){n.isRefreshRequired&&(i.IsLoading=!0,t({method:"POST",data:{},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Admin/GetUserInfo"}).then(function(t){n.$evalAsync(function(){i.IsLoading==!1;t.data&&t.data.length>0&&(n.ilstAllUsers=t.data,n.isRefreshRequired=!1)})},function(n){i.IsLoading=!1;i.showExceptionDetails(n.data)}))};n.addUserTabNewUser=function(){var r=n.$new(!0);r.selectedUser={UserID:-1,UserName:"",FirstName:"",LastName:"",EmailID:""};r.createUser=function(){i.IsLoading=!0;t({method:"POST",data:{UserID:r.selectedUser.UserID,UserName:r.selectedUser.UserName,FirstName:r.selectedUser.FirstName,LastName:r.selectedUser.LastName,EmailId:r.selectedUser.EmailId},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Admin/CreateNewUser"}).then(function(t){i.IsLoading=!1;t.data==-1?toastr.error("User already exist."):(r.closeAddUserDialog(),toastr.success("User created sucessfully."),t.data&&t.data.length>0&&(n.ilstAllUsers=t.data,n.selectUserTabUser(n.ilstAllUsers[0])))},function(n){i.IsLoading=!1;i.showExceptionDetails(n.data)})};r.checkValidUser=function(){r.selectedUser.UserName?r.selectedUser.FirstName?r.selectedUser.LastName?r.selectedUser.EmailId?validateEmail(r.selectedUser.EmailId)?(r.ErrorMessage="",r.IsError=!1):(r.ErrorMessage="Invalid emailid",r.IsError=!0):(r.ErrorMessage="EmailId Required",r.IsError=!0):(r.ErrorMessage="Last Name Required",r.IsError=!0):(r.ErrorMessage="First Name Required",r.IsError=!0):(r.ErrorMessage="User Name Required",r.IsError=!0)};r.closeAddUserDialog=function(){r.dialog.close()};r.dialog=i.showDialog(r,"Create User","Admin/views/AddNewUser.html",{width:650,height:350});r.checkValidUser()};n.selectUserTabUser=function(t){n.iobjUserTabSelectedUser=t;n.iobjUserTabSelectedClient=null;t.Clients&&t.Clients.length>0&&n.selectUserTablClient(t.Clients[0])};n.selectUserTablClient=function(t){n.iobjUserTabSelectedClient=t};n.reSendActivationMailForUser=function(n){n&&n.UserID?t({method:"POST",data:{UserID:n.UserID},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Admin/ReSendActivationMail"}).then(function(n){n.data&&n.data.length},function(n){i.showExceptionDetails(n.data)}):i.showExceptionDetails("User ID not found.")};n.init()}]);