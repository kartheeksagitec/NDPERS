function onKeyDownInSVG(n){var t=angular.element(n.currentTarget).scope();t&&t.$apply(function(){if(t.activeTab=="MAP"){if(n.keyCode==46)t.onDeleteKeyDown(n,"");else n.keyCode==40?t.MoveElementUsingKeyBoard("Down"):n.keyCode==38?t.MoveElementUsingKeyBoard("Top"):n.keyCode==37?t.MoveElementUsingKeyBoard("Left"):n.keyCode==39&&t.MoveElementUsingKeyBoard("Right");(n&&n.keyCode==40||n.keyCode==39||n.keyCode==37||n.keyCode==38)&&n.preventDefault()}})}function getHtmlForContextMenu(n){var t="";if(n.ShapeName=="BPMNShape")switch(n.ShapeType){case"participant":t='<li onclick="AddLaneToPoolFromContextMenu(event)">Add Lane To Pool<\/li>';break;case"callActivity":t='<li onclick="OnOpenCalledElementClick(event)">Open Called Process<\/li>';break;case"task":case"userTask":case"serviceTask":case"businessRuleTask":case"manualTask":t='<li> Task Type >> <ul><li onclick="OnChangeTaskTypeClick(event,\'Task\')"><img src="images/BPM/Bpm_Contextmenu_Task.svg" /> Task<\/li><li onclick="OnChangeTaskTypeClick(event,\'Service Task\')"><img src="images/BPM/Bpm_Contextmenu_Service_task.svg" />Service Task<\/li><li onclick="OnChangeTaskTypeClick(event,\'User Task\')"><img src="images/BPM/Bpm_Contextmenu_User_task.svg" />User Task<\/li><li onclick="OnChangeTaskTypeClick(event,\'Business Rule Task\')"><img src="images/BPM/Bpm_Contextmenu_Business_rule_task.svg" />Business Rule Task<\/li><\/ul><\/li>';break;case"intermediateCatchEvent":t="<li> Event Type >> <ul><li onclick=\"OnChangeCatchEventClick(event,'Message Event')\">Message Event<\/li><li onclick=\"OnChangeCatchEventClick(event,'Timer Event')\">Timer Event<\/li><\/ul><\/li>";break;case"exclusiveGateway":case"inclusiveGateway":case"parallelGateway":case"eventBasedGateway":t="<li> Gateway Type >> <ul><li  onclick=\"OnChangeGatewayTypeClick(event,'Exclusive Gateway')\">Exclusive Gateway<\/li><li onclick=\"OnChangeGatewayTypeClick(event,'Inclusive Gateway')\">Inclusive Gateway<\/li><li onclick=\"OnChangeGatewayTypeClick(event,'Parallel Gateway')\">Parallel Gateway<\/li><li onclick=\"OnChangeGatewayTypeClick(event,'Event Gateway')\">Event Gateway<\/li><\/ul><\/li>"}return n.ShapeName=="BPMNEdge"&&(t='<li onclick="OnFixEdgeButtonClick(event)">Fix Edge<\/li>',n.ShapeType=="messageFlow"&&(t+="<li>Message Kind >> <ul><li onclick=\"OnMessageKindChangeClick(event,'initiating')\">Initiating<\/li><li onclick=\"OnMessageKindChangeClick(event,'non_initiating')\">Non-Initiating<\/li><li onclick=\"OnMessageKindChangeClick(event,'None')\">None<\/li><\/ul> <\/li>")),t+'<li onclick="OnDeleteButtonClick(event)">Delete<\/li>'}function showContextMenuForSVG(n){scopeforexecutionvaraibles=angular.element(n.currentTarget).scope();n.preventDefault();n.stopPropagation();var t="";scopeforexecutionvaraibles.activeTab!="MAP"||scopeforexecutionvaraibles.IsVersionDisplay||(t='<li onclick="EditSVGBoundsButtonClick(event)">Edit SVG Height/Width<\/li>');$("#container-menu").find("li").remove();$("#container-menu").append(t);$("#container-menu").finish().toggle(100).css({top:n.pageY+"px",left:n.pageX+"px"});$(".page-header-fixed").css("pointer-events","none");$("#container-menu").css("pointer-events","auto")}function showContextMenu(n){scopeforexecutionvaraibles=angular.element(n.currentTarget).scope();n.preventDefault();n.stopPropagation();n.currentTarget.id!="line"?selectElement(n,n.currentTarget):selectedlineElement(n,n.target);var t="";scopeforexecutionvaraibles.activeTab!="MAP"||scopeforexecutionvaraibles.IsVersionDisplay?scopeforexecutionvaraibles.activeTab=="EXECUTION"&&(t='<li onclick="ShowVariables(event)">Show Varaibles<\/li>'):scopeforexecutionvaraibles.selectedShape&&(t=getHtmlForContextMenu(scopeforexecutionvaraibles.selectedShape));$("#container-menu").find("li").remove();$("#container-menu").append(t);$("#container-menu").finish().toggle(100).css({top:n.pageY+"px",left:n.pageX+"px"});$(".page-header-fixed").css("pointer-events","none");$("#container-menu").css("pointer-events","auto")}function ShowVariables(n){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),scopeforexecutionvaraibles.$evalAsync(function(){scopeforexecutionvaraibles.ShowVariables();scopeforexecutionvaraibles=undefined}));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function OnDeleteButtonClick(n){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),scopeforexecutionvaraibles.$evalAsync(function(){scopeforexecutionvaraibles.isDirty=!0;scopeforexecutionvaraibles.onDeleteKeyDown(n,"Delete")}));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function EditSVGBoundsButtonClick(n){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),scopeforexecutionvaraibles.$evalAsync(function(){scopeforexecutionvaraibles.EditSVGheightandwidth(n)}));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function AddLaneToPoolFromContextMenu(n){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),scopeforexecutionvaraibles.isDirty=!0,AddLaneToPool(n,scopeforexecutionvaraibles));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function OnOpenCalledElementClick(n){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),OpenCalledElement(scopeforexecutionvaraibles));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function OnChangeTaskTypeClick(n,t){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),scopeforexecutionvaraibles.isDirty=!0,ChangeTaskFromContextMenu(scopeforexecutionvaraibles,t));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function OnChangeGatewayTypeClick(n,t){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),scopeforexecutionvaraibles.isDirty=!0,ChangeGatewayFromContextMenu(scopeforexecutionvaraibles,t));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function OnChangeCatchEventClick(n,t){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),scopeforexecutionvaraibles.isDirty=!0,ChangeEventTypeFromContextMenu(scopeforexecutionvaraibles,t));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function OnFixEdgeButtonClick(n){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),scopeforexecutionvaraibles.isDirty=!0,FixEdgeFromContextMenu(scopeforexecutionvaraibles));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function OnMessageKindChangeClick(n,t){scopeforexecutionvaraibles&&(n&&(n.stopPropagation(),n.preventDefault()),scopeforexecutionvaraibles.isDirty=!0,OnChangeMessageKindFromContextMenu(scopeforexecutionvaraibles,t));$(".custom-menu").hide(100);$(".page-header-fixed").css("pointer-events","auto")}function removeExistingTextNodeAndAddNewNode(n){var f="",i,r,t,u,e,o;if(n.selectedShape&&n.selectedElemForResize){for(i=0;i<n.selectedElemForResize.childNodes.length;i++)n.selectedElemForResize.childNodes[i].nodeName=="text"?(n.selectedElemForResize.removeChild(n.selectedElemForResize.childNodes[i]),i--):n.selectedElemForResize.childNodes[i].id=="MainElement"&&(f=n.selectedElemForResize.childNodes[i]);r="";n.selectedElemForResize.id=="textAnnotation"&&(r="textAnnotation");t=document.createElementNS(n.svgNS,"text");t.setAttributeNS(null,"id","text");n.selectedShape.ShapeType=="participant"||n.selectedShape.ShapeType=="lane"?(r="Participant",t.setAttribute("x",n.selectedShape.Left),t.setAttribute("y",n.selectedShape.Top)):(t.setAttribute("x",n.selectedShape.LabelLeft),t.setAttribute("y",n.selectedShape.LabelTop));t.setAttribute("width",n.selectedShape.LabelWidth);t.setAttribute("height",n.selectedShape.LabelHeight);t.setAttribute("class","textbpmn");t.setAttribute("fill","black");n.selectedShape.ShapeType&&n.selectedShape.ShapeType!="task"&&n.selectedShape.ShapeType!="userTask"&&n.selectedShape.ShapeType!="serviceTask"&&n.selectedShape.ShapeType!="businessRuleTask"&&n.selectedShape.ShapeType!="manualTask"&&n.selectedShape.ShapeType!="callActivity"&&n.selectedShape.ShapeType!="participant"&&n.selectedShape.ShapeType!="lane"&&n.selectedShape.ShapeType!="textAnnotation"&&(t.setAttribute("elementid",n.selectedShape.Id),t.setAttribute("onmousedown","setResizeraroudtext(evt)"));t.textContent=n.selectedShape.Text;n.selectedElemForResize.appendChild(t);u=wraptorect(t,f,0,.5,r,n);(n.selectedShape.ShapeType=="participant"||n.selectedShape.ShapeType=="lane")&&(e="-90  "+n.selectedShape.Left+","+n.selectedShape.Top+" ",o="10 "+n.selectedShape.Height/2,u.setAttribute("transform","translate("+o+") rotate("+e+")"),u.setAttribute("text-anchor","middle"))}}function RemoveExistingTextAndAddNewNodeForFlowLines(n){var i,r,t,u;if(n.selectedLineEle&&n.selectedShape&&n.selectedLineEle.parentNode.id=="line"){for(i=0;i<n.selectedLineEle.parentNode.childNodes.length;i++)n.selectedLineEle.parentNode.childNodes[i].nodeName=="text"&&(n.selectedLineEle.parentNode.removeChild(n.selectedLineEle.parentNode.childNodes[i]),i--);(n.selectedShape.LabelLeft<=0||n.selectedShape.LabelTop<=0||n.selectedShape.LabelHeight<=0||n.selectedShape.LabelWidth<=0)&&(r=getCoordinatesForMessageEvent(n),n.selectedShape.LabelLeft=r.Left,n.selectedShape.LabelTop=r.Top);t=document.createElementNS(n.svgNS,"text");t.setAttributeNS(null,"id","text");t.setAttribute("x",n.selectedShape.LabelLeft);t.setAttribute("y",n.selectedShape.LabelTop);t.setAttribute("width",n.selectedShape.LabelWidth);t.setAttribute("height",n.selectedShape.LabelHeight);t.setAttribute("class","textbpmn");t.setAttribute("elementid",n.selectedShape.Id);t.setAttribute("onmousedown","setResizeraroudtext(evt)");t.setAttribute("font-size",11);t.textContent=n.selectedShape.Text;n.selectedLineEle.parentNode.appendChild(t);u=wraptorect(t,null,0,.5,undefined,n)}}function removeElementFromSvg(n,t){for(var i=0;i<t.svgElement.childNodes.length;i++)if(t.svgElement.childNodes[i].id!=undefined&&n!=""&&t.svgElement.childNodes[i].id==n.ShapeType){var r=parseFloat(t.svgElement.childNodes[i].getAttribute("x")),u=parseFloat(t.svgElement.childNodes[i].getAttribute("y")),f=parseFloat(t.svgElement.childNodes[i].getAttribute("height")),e=parseFloat(t.svgElement.childNodes[i].getAttribute("width"));if(n.Left==r&&n.Top==u&&n.Height==f&&n.Width==e){t.svgElement.removeChild(t.svgElement.childNodes[i]);break}}}function getShapeCoordinatesBasedOnResizerLine(n){var t={Left:0,Top:0};return angular.forEach(n.svgElement.childNodes,function(i){var e,r,u,f;i.nodeName!="#text"&&i.nodeName!="#comment"&&i.nodeName!="defs"&&i.getAttribute("id")=="linedraggablegroup"&&(i.childNodes.length>2?(e=i.childNodes.length/2,e=e.toFixed(0)-1,t.Left=i.childNodes[e].childNodes[0].getAttribute("x")-7.5,t.Top=i.childNodes[e].childNodes[0].getAttribute("y")-7.5):(r=n.objData.lstShapes[n.indexOfSelectedLine].lstWayPoints,r.length>2?r[1].Left-r[2].Left>-.1&&r[1].Left-r[2].Left<.1?(r[1].Top>r[2].Top?(u=r[2].Top+(r[1].Top-r[2].Top)/2,t.Top=u-10):(u=r[1].Top+(r[2].Top-r[1].Top)/2,t.Top=u-10),t.Left=r[1].Left-10):(r[1].Left>r[2].Left?(f=r[2].Left+(r[1].Left-r[2].Left)/2,t.Left=f-10):(f=r[1].Left+(r[2].Left-r[1].Left)/2,t.Left=f-10),t.Top=r[1].Top-10):r.length==2&&(r[0].Left-r[1].Left>-.1&&r[0].Left-r[1].Left<.1?(r[0].Top>r[1].Top?(u=r[1].Top+(r[0].Top-r[1].Top)/2,t.Top=u-10):(u=r[0].Top+(r[1].Top-r[0].Top)/2,t.Top=u-10),t.Left=r[0].Left-10):(r[0].Left>r[1].Left?(f=r[1].Left+(r[0].Left-r[1].Left)/2,t.Left=f-10):(f=r[0].Left+(r[1].Left-r[0].Left)/2,t.Left=f-10),t.Top=r[0].Top-10))))}),t}function ChangeImageOfTheShape(n,t,i){for(var u,r=0;r<t.svgElement.childNodes.length;r++)if(t.svgElement.childNodes[r].id=="message"){var e=parseFloat(t.svgElement.childNodes[r].getAttribute("x")),o=parseFloat(t.svgElement.childNodes[r].getAttribute("y")),s=parseFloat(t.svgElement.childNodes[r].getAttribute("height")),h=parseFloat(t.svgElement.childNodes[r].getAttribute("width")),f=!1;if(i.Left==e&&i.Top==o&&i.Height==s&&i.Width==h)for(f=!0,u=0;u<t.svgElement.childNodes[r].childNodes.length;u++)if(t.svgElement.childNodes[r].childNodes[u].nodeName=="image")if(n=="initiating"){t.svgElement.childNodes[r].childNodes[u].setAttribute("href","images/BPM/initiating-message-icon.svg");break}else if(n=="non_initiating"){t.svgElement.childNodes[r].childNodes[u].setAttribute("href","images/BPM/non-initiating-message-icon.svg");break}if(f)break}}function drawInitiatingorNonInitiatingMessage(n,t,i){var e=getMessageType(t,i),r,f,u,o;e!=""&&(r=document.createElementNS(i.svgNS,"g"),r.setAttributeNS(null,"x",t.Left),r.setAttributeNS(null,"y",t.Top),r.setAttribute("elementtype",t.ShapeType),r.setAttributeNS(null,"height",t.Height),r.setAttributeNS(null,"width",t.Width),r.setAttribute("class","draggable"),r.setAttribute("id",t.ShapeType),r.setAttribute("onmousedown","selectElement(evt,this)"),generateTitletoElement(t,r,i),f=document.createElementNS(i.svgNS,"image"),f.setAttribute("id","img"),f.setAttribute("x",t.Left),f.setAttribute("y",t.Top),f.setAttribute("height","20"),f.setAttribute("width","20"),e=="initiating"?f.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/initiating-message-icon.svg"):f.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/non-initiating-message-icon.svg"),r.appendChild(f),u=document.createElementNS(i.svgNS,"text"),u.setAttributeNS(null,"id","text"),u.setAttribute("x",t.LabelLeft),u.setAttribute("y",t.LabelTop),u.setAttribute("height",t.LabelHeight),u.setAttribute("width",t.LabelWidth),u.setAttribute("fill","black"),u.setAttribute("class","textbpmn"),u.setAttribute("elementid",t.Id),u.setAttribute("onmousedown","setResizeraroudtext(evt)"),u.textContent=t.Text,r.appendChild(u),o=wraptorect(u,null,0,.5,undefined,i),n.appendChild(r),$(r).bind("contextmenu",function(n){showContextMenu(n)}))}function getMessageType(n,t){for(var r="",i=0;i<t.objData.lstShapes.length;i++)if(t.objData.lstShapes[i].ShapeType=="messageFlow"&&n.Id==t.objData.lstShapes[i].MessageReference){r=t.objData.lstShapes[i].MessageVisibleKind;break}return r}function AddLineArray(n,t,i){var c,s,r,v,u,l,f,h,e,a,o;if(t.lstWayPoints){for(c=!1,s=document.createElementNS(i.svgNS,"g"),s.setAttribute("id","line"),s.setAttribute("elementtype","linegroup"),r=document.createElementNS(i.svgNS,"text"),r.setAttributeNS(null,"id","text"),r.setAttribute("x",t.LabelLeft),r.setAttribute("y",t.LabelTop),r.setAttribute("height",t.LabelHeight),r.setAttribute("width",t.LabelWidth),r.setAttribute("fill","black"),r.setAttribute("font-size",11),r.setAttribute("elementid",t.Id),r.setAttribute("onmousedown","setResizeraroudtext(evt)"),r.setAttribute("class","textbpmn"),r.textContent=t.Text,s.appendChild(r),v=wraptorect(r,null,0,.5,undefined,i),u=document.createElementNS(i.svgNS,"g"),u.setAttribute("onmousedown","selectedlineElement(evt,this)"),i.activeTab!="Execution"&&u.setAttribute("ondblclick","selectPropertiesTab(evt)"),l=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.SourceElement,i,"Element"),l.ShapeType=="exclusiveGateway"||l.ShapeType=="inclusiveGateway"?(u.setAttribute("elementtype","GatewayExpression"),s.setAttribute("elementtype","GatewayExpression")):(u.setAttribute("elementtype",t.ShapeType),s.setAttribute("elementtype",t.ShapeType)),u.setAttribute("id","line"),i.activeTab!="EXECUTION"?c=!0:i.CheckStepisExceutedOrNot(t.Id,u)&&i.BPMExceutionTabDetails.Mode!="Demo"&&(c=!0),f=0;f<t.lstWayPoints.length;f++)f<t.lstWayPoints.length-1&&(h=document.createElementNS(i.svgNS,"g"),h.setAttribute("id",t.Id),h.setAttribute("elementtype","linegroup"),e=document.createElementNS(i.svgNS,"line"),e.setAttribute("id",t.Id),e.setAttribute("x1",t.lstWayPoints[f].Left),e.setAttribute("y1",t.lstWayPoints[f].Top),e.setAttribute("x2",t.lstWayPoints[f+1].Left),e.setAttribute("y2",t.lstWayPoints[f+1].Top),(t.ShapeType=="dataOutputAssociation"||t.ShapeType=="association"||t.ShapeType=="messageFlow"||t.ShapeType=="dataInputAssociation")&&(e.setAttribute("stroke-dasharray","6,4"),t.ShapeType=="messageFlow"&&(u.setAttribute("ondragover","SetDragOverLineElement(evt)"),u.setAttribute("ondragleave","SetNullOnDragleaveLineElement(evt)"))),c?e.setAttributeNS(null,"stroke","#3a3a3a"):e.setAttributeNS(null,"stroke","#d3d3d3"),(f==t.lstWayPoints.length-2||t.lstWayPoints.length==1)&&t.ShapeType!="association"&&(a="url(#arrow_"+i.$root.currentopenfile.file.FileName.trim()+")",i.activeTab=="EXECUTION"&&(a="url(#arrow_"+i.Guid+")"),e.setAttribute("marker-end",a)),o=document.createElementNS(i.svgNS,"line"),o.setAttribute("id",t.Id),o.setAttribute("x1",t.lstWayPoints[f].Left),o.setAttribute("y1",t.lstWayPoints[f].Top),o.setAttribute("x2",t.lstWayPoints[f+1].Left),o.setAttribute("y2",t.lstWayPoints[f+1].Top),o.setAttribute("stroke-width",15),(t.ShapeType=="dataOutputAssociation"||t.ShapeType=="association"||t.ShapeType=="messageFlow"||t.ShapeType=="dataInputAssociation")&&(e.setAttribute("stroke-dasharray","6,4"),t.ShapeType=="messageFlow"&&(u.setAttribute("ondragover","SetDragOverLineElement(evt)"),u.setAttribute("ondragleave","SetNullOnDragleaveLineElement(evt)"))),o.setAttributeNS(null,"stroke","transparent"),h.appendChild(e),h.appendChild(o),u.appendChild(h));s.appendChild(u);n.appendChild(s);$(u).bind("contextmenu",function(n){showContextMenu(n)})}}function drawDiamond(n,t,i){var r=document.createElementNS(i.svgNS,"g"),o,e,a,u,v;r.setAttributeNS(null,"x",t.Left);r.setAttributeNS(null,"y",t.Top);r.setAttribute("elementtype",t.ShapeType);r.setAttributeNS(null,"height",t.Height);r.setAttributeNS(null,"width",t.Width);r.setAttribute("class","draggable");r.setAttribute("id",t.ShapeType);r.setAttribute("onmousedown","selectElement(evt,this)");i.activeTab!="Execution"&&r.setAttribute("ondblclick","selectPropertiesTab(evt)");r.setAttribute("onmouseout","removehoverCircle(evt,this)");generateTitletoElement(t,r,i);var f=document.createElementNS(i.svgNS,"polygon"),s={X:t.Left,Y:t.Top+t.Height/2},h={X:t.Left+t.Width/2,Y:t.Top},c={X:t.Left+t.Width,Y:t.Top+t.Height/2},l={X:t.Left+t.Width/2,Y:t.Top+t.Height};points=s.X+","+s.Y+"  "+h.X+","+h.Y+"  "+c.X+","+c.Y+"  "+l.X+","+l.Y;f.setAttributeNS(null,"x",t.Left);f.setAttributeNS(null,"y",t.Top);f.setAttributeNS(null,"height",t.Height);f.setAttributeNS(null,"width",t.Width);f.setAttribute("id","MainElement");f.setAttribute("onmouseout","removehoverCircle(evt,this)");f.setAttribute("onmouseover","hoverOnElement(evt,this)");o="url(#rectshadow_"+i.$root.currentopenfile.file.FileName.trim()+")";i.activeTab=="EXECUTION"&&(o="url(#rectshadow_"+i.Guid+")");f.setAttributeNS(null,"filter",o);f.setAttribute("points",points);e="url(#exclusive_"+i.$root.currentopenfile.file.FileName.trim()+")";i.activeTab=="EXECUTION"&&(r.setAttribute("ondblclick","showElementProperties(evt,this)"),i.CheckStepisExceutedOrNot(t.Id,r)&&i.BPMExceutionTabDetails.Mode!="Demo"?(e="url(#exclusive_"+i.Guid+")",r.iterationCount>1&&drawCirclewithCount(r,i)):e="#d3d3d3");f.setAttribute("fill",e);r.appendChild(f);t.ShapeType!="exclusiveGateway"&&(a=getImageDependOnType(t,r,i),a.setAttribute("onmouseover","hoverOnElement(evt,this)"));u=document.createElementNS(i.svgNS,"text");u.setAttributeNS(null,"id","text");u.setAttribute("x",t.LabelLeft);u.setAttribute("y",t.LabelTop);u.setAttribute("height",t.LabelHeight);u.setAttribute("width",t.LabelWidth);u.setAttribute("fill","black");u.setAttribute("class","textbpmn");u.setAttribute("elementid",t.Id);u.setAttribute("onmousedown","setResizeraroudtext(evt)");u.textContent=t.Text;r.appendChild(u);v=wraptorect(u,f,0,.5,undefined,i);n.appendChild(r);$(r).bind("contextmenu",function(n){showContextMenu(n)})}function drawCircle(n,t,i){var r=document.createElementNS(i.svgNS,"g"),u,e,o,s,f,h;r.setAttributeNS(null,"x",t.Left);r.setAttributeNS(null,"y",t.Top);r.setAttribute("elementtype",t.ShapeType);r.setAttributeNS(null,"height",t.Height);r.setAttributeNS(null,"width",t.Width);r.setAttribute("class","draggable");r.setAttribute("id",t.ShapeType);r.setAttribute("onmousedown","selectElement(evt,this)");i.activeTab!="Execution"&&r.setAttribute("ondblclick","selectPropertiesTab(evt)");r.setAttribute("onmouseout","removehoverCircle(evt,this)");generateTitletoElement(t,r,i);u=document.createElementNS(i.svgNS,"circle");u.setAttributeNS(null,"id","MainElement");u.setAttributeNS(null,"cx",t.Left+15);u.setAttributeNS(null,"cy",t.Top+15);u.setAttribute("onmouseout","removehoverCircle(evt,this)");u.setAttribute("onmouseover","hoverOnElement(evt,this)");u.setAttributeNS(null,"r",t.Width/2);e="";t.ShapeType=="startEvent"?(e="url(#start_"+i.$root.currentopenfile.file.FileName.trim()+")",i.activeTab=="EXECUTION"&&(r.setAttribute("ondblclick","showElementProperties(evt,this)"),i.CheckStepisExceutedOrNot(t.Id,r)&&i.BPMExceutionTabDetails.Mode!="Demo"?(e="url(#start_"+i.Guid+")",r.iterationCount>1&&drawCirclewithCount(r,i)):e="#d3d3d3")):t.ShapeType=="endEvent"?(u.setAttribute("stroke-width",2),e="url(#end_"+i.$root.currentopenfile.file.FileName.trim()+")",i.activeTab=="EXECUTION"&&(r.setAttribute("ondblclick","showElementProperties(evt,this)"),i.CheckStepisExceutedOrNot(t.Id,r)&&i.BPMExceutionTabDetails.Mode!="Demo"?(e="url(#end_"+i.Guid+")",r.iterationCount>1&&drawCirclewithCount(r,i)):e="#d3d3d3")):t.ShapeType=="intermediateCatchEvent"&&(e="url(#intermediate_"+i.$root.currentopenfile.file.FileName.trim()+")",i.activeTab=="EXECUTION"&&(r.setAttribute("ondblclick","showElementProperties(evt,this)"),i.CheckStepisExceutedOrNot(t.Id,r)&&i.BPMExceutionTabDetails.Mode!="Demo"?(e="url(#intermediate_"+i.Guid+")",r.iterationCount>1&&drawCirclewithCount(r,i)):e="#d3d3d3"));u.setAttributeNS(null,"fill",e);u.setAttributeNS(null,"stroke","black");o="url(#circleShadow_"+i.$root.currentopenfile.file.FileName.trim()+")";i.activeTab=="EXECUTION"&&(o="url(#circleShadow_"+i.Guid+")");u.setAttributeNS(null,"filter",o);r.appendChild(u);t.ShapeType=="intermediateCatchEvent"&&(s=getImageDependOnType(t,r,i),s.setAttribute("onmouseover","hoverOnElement(evt,this)"));f=document.createElementNS(i.svgNS,"text");f.setAttributeNS(null,"id","text");f.setAttribute("x",t.LabelLeft);f.setAttribute("y",t.LabelTop);f.setAttribute("height",t.LabelHeight);f.setAttribute("width",t.LabelWidth);f.setAttribute("fill","black");f.setAttribute("class","textbpmn");f.setAttribute("elementid",t.Id);f.setAttribute("onmousedown","setResizeraroudtext(evt)");f.textContent=t.Text;r.appendChild(f);h=wraptorect(f,u,0,.5,undefined,i);n.appendChild(r);$(r).bind("contextmenu",function(n){showContextMenu(n)})}function drawCirclewithCount(n,t){var o=parseFloat(n.getAttribute("x")),u=parseFloat(n.getAttribute("y")),s=parseFloat(n.getAttribute("width")),f=o+s,r=document.createElementNS(t.svgNS,"circle"),e,i;r.setAttributeNS(null,"id","circle");r.setAttributeNS(null,"cx",f+3);r.setAttributeNS(null,"cy",u-2);r.setAttributeNS(null,"r",8);e="#FFA500";r.setAttributeNS(null,"fill",e);n.appendChild(r);i=document.createElementNS(t.svgNS,"text");i.setAttributeNS(null,"id","textcount");i.setAttribute("x",f);i.setAttribute("y",u);i.setAttribute("height",7);i.setAttribute("width",7);i.setAttribute("fill","white");i.setAttribute("font-size",10);i.textContent=n.iterationCount;n.appendChild(i)}function drawTask(n,t,i){var r=document.createElementNS(i.svgNS,"g"),u,e,o,f,s,h;r.setAttributeNS(null,"x",t.Left);r.setAttributeNS(null,"y",t.Top);r.setAttributeNS(null,"height",t.Height);r.setAttribute("elementtype",t.ShapeType);r.setAttributeNS(null,"width",t.Width);r.setAttribute("id",t.ShapeType);r.setAttribute("class","draggable");r.setAttribute("onmousedown","selectElement(evt,this)");i.activeTab!="Execution"&&r.setAttribute("ondblclick","selectPropertiesTab(evt)");r.setAttribute("onmouseout","removehoverCircle(evt,this)");generateTitletoElement(t,r,i);u=document.createElementNS(i.svgNS,"rect");u.setAttributeNS(null,"id","MainElement");u.setAttributeNS(null,"rx",5);u.setAttributeNS(null,"ry",5);u.setAttribute("onmouseover","hoverOnElement(evt,this)");u.setAttribute("onmouseout","removehoverCircle(evt,this)");u.setAttributeNS(null,"x",t.Left);u.setAttributeNS(null,"y",t.Top);u.setAttributeNS(null,"height",t.Height);u.setAttributeNS(null,"width",t.Width);r.appendChild(u);e="";o="";i.activeTab!="EXECUTION"?(e="url(#task_"+i.$root.currentopenfile.file.FileName.trim()+")",o="url(#rectshadow_"+i.$root.currentopenfile.file.FileName.trim()+")"):i.activeTab=="EXECUTION"&&(r.setAttribute("ondblclick","showElementProperties(evt,this)"),i.CheckStepisExceutedOrNot(t.Id,r)&&i.BPMExceutionTabDetails.Mode!="Demo"?(o="url(#rectshadow_"+i.Guid+")",e="url(#task_"+i.Guid+")",r.iterationCount>1&&drawCirclewithCount(r,i)):(e="#d3d3d3",o="url(#rectshadow_"+i.Guid+")"));u.setAttributeNS(null,"filter",o);u.setAttributeNS(null,"fill",e);f=document.createElementNS(i.svgNS,"text");f.setAttributeNS(null,"id","text");f.setAttribute("class","textbpmn");f.setAttribute("x",t.LabelLeft);f.setAttribute("y",t.LabelTop);f.setAttribute("width",t.LabelWidth);f.setAttribute("height",t.LabelHeight);f.setAttribute("fill","black");f.textContent=t.Text;r.appendChild(f);s=wraptorect(f,u,0,.5,undefined,i);s.setAttribute("onmouseover","hoverOnElement(evt,this)");t.ShapeType!="task"&&(h=getImageDependOnType(t,r,i),h.setAttribute("onmouseover","hoverOnElement(evt,this)"));n.appendChild(r);$(r).bind("contextmenu",function(n){showContextMenu(n)})}function drawSquareParam(n,t,i){var u,o,r,e,f;Left=t.Left;Top=t.Top;Bottom=t.Height;Right=t.Width;u=document.createElementNS(i.svgNS,"g");u.setAttributeNS(null,"x",t.Left);u.setAttributeNS(null,"y",t.Top);u.setAttributeNS(null,"height",t.Height);u.setAttribute("elementtype",t.ShapeType);u.setAttributeNS(null,"width",t.Width);u.setAttribute("onmousedown","selectElement(evt,this)");i.activeTab!="Execution"&&u.setAttribute("ondblclick","selectPropertiesTab(evt)");t.ShapeType!="lane"&&u.setAttribute("onmouseout","removehoverCircle(evt,this)");u.setAttribute("id",t.ShapeType);u.setAttribute("onmousedown","selectElement(evt,this)");generateTitletoElement(t,u,i);r=document.createElementNS(i.svgNS,"rect");r.setAttributeNS(null,"id","MainElement");t.ShapeType!="lane"&&r.setAttribute("onmouseover","hoverOnElement(evt,this)");r.setAttributeNS(null,"x",t.Left);r.setAttributeNS(null,"y",t.Top);r.setAttributeNS(null,"height",t.Height);r.setAttributeNS(null,"width",t.Width);t.ShapeType!="lane"?r.setAttributeNS(null,"fill","#fefef2"):(r.setAttributeNS(null,"fill","transparent"),r.setAttribute("onmouseover","removehoverCircle(evt,this)"));r.setAttributeNS(null,"stroke","black");t.ShapeType!="lane"&&(o="url(#rectshadow_"+i.$root.currentopenfile.file.FileName.trim()+")",i.activeTab=="EXECUTION"&&(o="url(#rectshadow_"+i.Guid+")"),r.setAttributeNS(null,"filter",o));u.appendChild(r);t.ShapeType=="lane"?(r=document.createElementNS(i.svgNS,"rect"),r.setAttributeNS(null,"id","rectangleinsquareparam"),r.setAttributeNS(null,"x",t.Left),r.setAttributeNS(null,"y",t.Top),r.setAttributeNS(null,"height",t.Height),r.setAttributeNS(null,"width",40),r.setAttributeNS(null,"fill","#f7ede1"),r.setAttributeNS(null,"stroke","black"),u.appendChild(r)):(r=document.createElementNS(i.svgNS,"rect"),r.setAttributeNS(null,"id","rectangleinsquareparam"),r.setAttribute("onmouseover","hoverOnElement(evt,this)"),r.setAttributeNS(null,"x",t.Left),r.setAttributeNS(null,"y",t.Top),r.setAttributeNS(null,"height",t.Height),r.setAttributeNS(null,"width",40),e="",i.activeTab!="EXECUTION"?e="url(#headerRect_"+i.$root.currentopenfile.file.FileName.trim()+")":i.activeTab=="EXECUTION"&&(e=i.CheckStepisExceutedOrNot(t.Id,u)&&i.BPMExceutionTabDetails.Mode!="Demo"?"url(#headerRect_"+i.Guid+")":"#d3d3d3"),r.setAttributeNS(null,"fill",e),r.setAttributeNS(null,"stroke","black"),u.appendChild(r));f=document.createElementNS(i.svgNS,"text");f.setAttributeNS(null,"id","text");f.setAttribute("x",t.Left);f.setAttribute("y",t.Top);f.setAttribute("fill","black");f.setAttribute("class","textbpmn");f.textContent=t.Text;u.appendChild(f);var s=wraptorect(f,r,0,.5,"Participant",i),h="-90  "+t.Left+","+t.Top+" ",c="10 "+t.Height/2;s.setAttribute("transform","translate("+c+") rotate("+h+")");s.setAttribute("text-anchor","middle");n.appendChild(u);$(u).bind("contextmenu",function(n){showContextMenu(n)})}function drawdataStoreReference(n,t,i){var r=document.createElementNS(i.svgNS,"g"),u,e,f;r.setAttributeNS(null,"x",t.Left);r.setAttributeNS(null,"y",t.Top);r.setAttributeNS(null,"height",t.Height);r.setAttributeNS(null,"width",t.Width);r.setAttribute("elementtype",t.ShapeType);r.setAttribute("id",t.ShapeType);r.setAttribute("class","draggable");r.setAttribute("onmousedown","selectElement(evt,this)");r.setAttribute("onmouseout","removehoverCircle(evt,this)");generateTitletoElement(t,r,i);u=document.createElementNS(i.svgNS,"text");u.setAttributeNS(null,"id","text");u.setAttribute("x",t.LabelLeft);u.setAttribute("y",t.LabelTop);u.setAttribute("class","textbpmn");u.setAttribute("width",t.LabelWidth);u.setAttribute("height",t.LabelHeight);u.setAttribute("fill","black");u.textContent=t.Text;u.setAttribute("elementid",t.Id);u.setAttribute("onmousedown","setResizeraroudtext(evt)");r.appendChild(u);e=wraptorect(u,r,0,.5,undefined,i);f=getImageDependOnType(t,r,i);f.setAttribute("onmouseover","hoverOnElement(evt,this)");f.setAttribute("onmouseout","removehoverCircle(evt,this)");n.appendChild(r);$(r).bind("contextmenu",function(n){showContextMenu(n)})}function drawdataObjectReference(n,t,i){var r=document.createElementNS(i.svgNS,"g"),u,e,f;r.setAttributeNS(null,"x",t.Left);r.setAttributeNS(null,"y",t.Top);r.setAttributeNS(null,"height",t.Height);r.setAttributeNS(null,"width",t.Width);r.setAttribute("elementtype",t.ShapeType);r.setAttribute("id",t.ShapeType);r.setAttribute("class","draggable");r.setAttribute("onmousedown","selectElement(evt,this)");r.setAttribute("onmouseout","removehoverCircle(evt,this)");generateTitletoElement(t,r,i);u=document.createElementNS(i.svgNS,"text");u.setAttributeNS(null,"id","text");u.setAttribute("x",t.LabelLeft);u.setAttribute("y",t.LabelTop);u.setAttribute("width",t.LabelWidth);u.setAttribute("height",t.LabelHeight);u.setAttribute("class","textbpmn");u.setAttribute("fill","black");u.setAttribute("elementid",t.Id);u.setAttribute("onmousedown","setResizeraroudtext(evt)");u.textContent=t.Text;r.appendChild(u);e=wraptorect(u,r,0,.5,undefined,i);f=getImageDependOnType(t,r,i);f.setAttribute("onmouseover","hoverOnElement(evt,this)");f.setAttribute("onmouseout","removehoverCircle(evt,this)");n.appendChild(r);$(r).bind("contextmenu",function(n){showContextMenu(n)})}function drawtextAnnotation(n,t,i){var r=document.createElementNS(i.svgNS,"g"),u,h,f,c,l,a,v,s,o,e,y;for(r.setAttributeNS(null,"x",t.Left),r.setAttributeNS(null,"y",t.Top),r.setAttribute("elementtype",t.ShapeType),r.setAttributeNS(null,"height",t.Height),r.setAttributeNS(null,"width",t.Width),r.setAttribute("id",t.ShapeType),r.setAttribute("class","draggable"),r.setAttribute("onmousedown","selectElement(evt,this)"),i.activeTab!="Execution"&&r.setAttribute("ondblclick","selectPropertiesTab(evt)"),r.setAttribute("onmouseout","removehoverCircle(evt,this)"),generateTitletoElement(t,r,i),u=document.createElementNS(i.svgNS,"rect"),u.setAttributeNS(null,"id","MainElement"),u.setAttributeNS(null,"rx",5),u.setAttributeNS(null,"ry",5),u.setAttribute("onmouseover","hoverOnElement(evt,this)"),u.setAttribute("onmouseout","removehoverCircle(evt,this)"),u.setAttributeNS(null,"x",t.Left),u.setAttributeNS(null,"y",t.Top),u.setAttributeNS(null,"height",t.Height),u.setAttributeNS(null,"width",t.Width),u.setAttributeNS(null,"fill","transparent"),u.setAttributeNS(null,"stroke","none"),r.appendChild(u),h=document.createElementNS(i.svgNS,"g"),h.setAttribute("id","textAnnotationLineGroup"),f=[],c={Left:t.Left+t.Width/2,Top:t.Top},f.push(c),l={Left:t.Left,Top:t.Top},f.push(l),a={Left:t.Left,Top:t.Top+t.Height},f.push(a),v={Left:t.Left+t.Width/2,Top:t.Top+t.Height},f.push(v),s=0;s<f.length;s++)s<f.length-1&&(o=document.createElementNS(i.svgNS,"line"),o.setAttribute("id","line"),o.setAttribute("stroke-width",1),o.setAttribute("x1",f[s].Left),o.setAttribute("y1",f[s].Top),o.setAttribute("x2",f[s+1].Left),o.setAttribute("y2",f[s+1].Top),o.setAttributeNS(null,"stroke","black"),h.appendChild(o));r.appendChild(h);e=document.createElementNS(i.svgNS,"text");e.setAttributeNS(null,"id","text");e.setAttribute("x",t.Left+2);e.setAttribute("y",t.Top+2);e.setAttribute("width",t.Width);e.setAttribute("height",t.Height);e.setAttribute("fill","black");e.setAttribute("class","textbpmn");e.textContent=t.Text;r.appendChild(e);y=wraptorect(e,u,0,.5,"textAnnotation",i);y.setAttribute("onmouseover","hoverOnElement(evt,this)");i.svgElement.appendChild(r);$(r).bind("contextmenu",function(n){showContextMenu(n)})}function getlabelWidth(n,t,i,r,u){var s=0,h=0,l,e,f,o,c,a,v;return t!=null&&(s=parseFloat(t.getAttribute("x")),h=parseFloat(t.getAttribute("y"))),fz=12,l=fz+r,e=n.cloneNode(!1),e.setAttributeNS(null,"x",s+i),e.setAttributeNS(null,"y",h+i),f=e.cloneNode(!1),f.setAttributeNS(null,"visibility","hidden"),o=document.createElementNS(null,"tspan"),c=document.createTextNode(n.textContent),o.appendChild(c),f.appendChild(o),u.activeTab=="EXECUTION"?$("div[id='"+u.Guid+"']").find("#ExecutionSVG")[0].appendChild(f):$("div[id='"+u.$root.currentopenfile.file.FileName+"']").find("#mySVG")[0].appendChild(f),a=n.textContent.split(""),v=0,f.textContent=n.textContent+"",testwidth=f.getBBox().width}function getImageDependOnType(n,t,i){var r=document.createElementNS(i.svgNS,"image"),f,u;if(r.setAttribute("id","img"),r.setAttribute("x",n.Left),r.setAttribute("y",n.Top),n.ShapeType=="userTask")r.setAttribute("height","25"),r.setAttribute("width","25"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/user-task.svg");else if(n.ShapeType=="serviceTask")r.setAttribute("height","20"),r.setAttribute("width","20"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/service-task.svg");else if(n.ShapeType=="businessRuleTask")r.setAttribute("height","20"),r.setAttribute("width","20"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/business-rule-task.svg");else if(n.ShapeType=="businessRuleTask")r.setAttribute("height","20"),r.setAttribute("width","20"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/business-rule-task.svg");else if(n.ShapeType=="manualTask")r.setAttribute("height","20"),r.setAttribute("width","20"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/manual-task.svg");else if(n.ShapeType=="callActivity")r.setAttribute("x",n.Left+n.Width/2-10),r.setAttribute("y",n.Top+n.Height-20),r.setAttribute("height","20"),r.setAttribute("width","20"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/calling-process.svg");else if(n.ShapeType=="intermediateCatchEvent"){for(f=!1,r.setAttribute("x",n.Left+2),r.setAttribute("y",n.Top+2),r.setAttribute("height","25"),r.setAttribute("width","25"),u=0;u<n.ShapeModel.Elements.length;u++)n.ShapeModel.Elements[u].Name=="messageEventDefinition"?(f=!0,r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/messageEventDefinition.svg")):n.ShapeModel.Elements[u].Name=="timerEventDefinition"&&(f=!0,r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/timerEventDefinition.svg"));f||r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/intermediateCatchEvent.svg")}else n.ShapeType=="eventBasedGateway"?(r.setAttribute("x",n.Left+8.5),r.setAttribute("y",n.Top+8),r.setAttribute("height","25"),r.setAttribute("width","25"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/event-gateway.svg")):n.ShapeType=="inclusiveGateway"?(r.setAttribute("x",n.Left+5.5),r.setAttribute("y",n.Top+5.5),r.setAttribute("height","30"),r.setAttribute("width","30"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/inclusive-gateway.svg")):n.ShapeType=="parallelGateway"?(r.setAttribute("x",n.Left+5.5),r.setAttribute("y",n.Top+5.5),r.setAttribute("height","30"),r.setAttribute("width","30"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/parallel-gateway.svg")):n.ShapeType=="dataStoreReference"?(r.setAttribute("id","MainElement"),r.setAttribute("x",n.Left),r.setAttribute("y",n.Top),r.setAttribute("height","32"),r.setAttribute("width","32"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/bpmn-data-source-icon.svg")):n.ShapeType=="dataObjectReference"&&(r.setAttribute("id","MainElement"),r.setAttribute("x",n.Left),r.setAttribute("y",n.Top),r.setAttribute("height","38"),r.setAttribute("width","29"),r.setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/bpmn-data-object-icon.svg"));return t.appendChild(r),r}function wraptorect(n,t,i,r,u,f){var k=0,p=0,w,d=0,y,c,l,nt,v,e,h,s,a;t&&t!=null&&t.nodeName!="circle"&&t.nodeName!="polygon"&&t.nodeName!="g"&&t.nodeName!="image"?(k=parseFloat(t.getAttribute("x")),p=u!="textAnnotation"&&u!="Participant"?parseFloat(t.getAttribute("y"))+25:parseFloat(t.getAttribute("y")),u!="Participant"?(d=parseFloat(t.getAttribute("width")),w=parseFloat(t.getAttribute("y"))+parseFloat(t.getAttribute("height"))):(d=parseFloat(t.getAttribute("height")),w=parseFloat(t.getAttribute("y"))+35)):(k=parseFloat(n.getAttribute("x")),p=parseFloat(n.getAttribute("y")),d=parseFloat(n.getAttribute("width")),w=parseFloat(n.getAttribute("y"))+parseFloat(n.getAttribute("height")));fz=14;y=fz+r;c=n.cloneNode(!1);c.setAttributeNS(null,"x",k+i);c.setAttributeNS(null,"y",p+i);l=c.cloneNode(!1);l.setAttributeNS(null,"visibility","hidden");s=document.createElementNS(null,"tspan");a=document.createTextNode(n.textContent);s.appendChild(a);l.appendChild(s);nt="";f.activeTab!="EXECUTION"?nt=$("div[id='"+f.$root.currentopenfile.file.FileName+"']").find("#mySVG")[0].appendChild(l):f.activeTab=="EXECUTION"&&(nt=$("div[id='"+f.Guid+"']").find("#ExecutionSVG")[0].appendChild(l));var b=n.textContent.split(""),o=line2="",tt=0,it,g=0;for(v=0;v<b.length;v++)if(line2=o+b[v],l.textContent=line2,it=l.getBBox().width,it+2*i>d)if(s=document.createElementNS(f.svgNS,"tspan"),s.setAttributeNS(null,"x",k+i),s.setAttributeNS(null,"dy",y),g+=y,t!=null){if(w>p+g+y||t.nodeName=="circle"||t.nodeName=="polygon"||t.nodeName=="image"||t.nodeName=="g"){for(e=o.split(" "),o="",h=0;h<e.length;h++)h<e.length-1?o+=e[h]+" ":e.length==1&&(o+=e[h]+" ");a=document.createTextNode(o);s.appendChild(a);c.appendChild(s);o=e.length>1?e[e.length-1]+b[v]:b[v];tt++}}else{for(e=o.split(" "),o="",h=0;h<e.length;h++)h<e.length-1?o+=e[h]+" ":e.length==1&&(o+=e[h]+" ");a=document.createTextNode(o);s.appendChild(a);c.appendChild(s);o=e.length>1?e[e.length-1]+b[v]:b[v];tt++}else t!=null?(w>p+g+y||t.nodeName=="g"||t.nodeName=="image")&&(o=line2):w>p+g+y&&(o=line2);return s=document.createElementNS(f.svgNS,"tspan"),s.setAttributeNS(null,"x",k+i),s.setAttributeNS(null,"dy",y),a=document.createTextNode(o),s.appendChild(a),c.appendChild(s),l.parentNode.removeChild(l),n.parentNode.replaceChild(c,n),c}function generateTitletoElement(n,t,i){var r=document.createElementNS(i.svgNS,"title");r.textContent=n.ShapeType;t.appendChild(r)}function setToolTipToLine(n){var t=n.currentTarget,r=checkTitleIsPresentOrDeleteTitle(t,"bool");if(!r){var u=angular.element(t).scope(),f=t.getAttribute("elementtype"),i=document.createElementNS(u.svgNS,"title");i.textContent=f;t.appendChild(i)}}function checkTitleIsPresentOrDeleteTitle(n,t){for(var r=!1,i=0;i<n.childNodes.length;i++)if(n.childNodes[i].nodeName=="title"){r=!0;t=="Delete"&&n.removeChild(n.childNodes[i]);break}return r}function onElementDragOver(n){n.preventDefault&&n.preventDefault();n.dataTransfer.dropEffect="move"}function onCriteriaFieldDrag(n){var t=angular.element($(n.target).closest(".portlet-body")).scope();t.dragDropData=t.selectedCriteriaField}function onCriteriaFieldDragOver(n){n.preventDefault&&n.preventDefault();n.dataTransfer.dropEffect="move"}function onCriteriaFieldDrop(n){var t=angular.element($(n.target).closest(".portlet-body")).scope();t.dragDropData&&t.$apply(function(){t.parameters.some(function(n){return n.name==t.dragDropData.name})||t.parameters.push(t.dragDropData);t.dragDropData=undefined})}function GetNewConditonName(n,t,i){for(var r=String.format("{0}{1}",n,"("+i.toString()+")");CheckForDuplicateIDForConditions(r,t);)i++,r=String.format("{0}{1}",n,"("+i.toString()+")");return r}function CheckForDuplicateIDForConditions(n,t){var i=!1;return angular.forEach(t.Elements,function(t){t.dictAttributes.sfwName&&n&&t.dictAttributes.sfwName.toLowerCase()==n.toLowerCase()&&(i=!0)}),i}function CheckForDuplicateIDForConditionsWhileEdit(n,t,i){for(var u=!1,f=0,r=0;r<t.Elements.length;r++)t.Elements[r].dictAttributes.sfwName&&n&&t.Elements[r].dictAttributes.sfwName.toLowerCase()==n.toLowerCase()&&i!=r&&f++;return f>0&&(u=!0),u}function SetDragOverLineElement(n){var t=angular.element(n.currentTarget).scope(),r,i;checkTitleIsPresentOrDeleteTitle(n.currentTarget,"Delete");t.DragOverElement=n.currentTarget;r=t.DragOverElement.childNodes[0].getAttribute("id");i=getObjShapeoftheLine("Line",t,r);i.MessageReference==null||i.MessageReference==""||i.MessageReference==undefined?(t.DraggableElement=="Initiating Message"||t.DraggableElement=="Non Initiating Message")&&t.DragOverElement!=undefined&&t.DragOverElement!=null&&(t.DragOverElement.childNodes[t.DragOverElement.childNodes.length-1].childNodes[0].removeAttributeNS(null,"marker-end"),angular.forEach(t.DragOverElement.childNodes,function(n){n.getAttribute("elementtype")=="linegroup"&&(n.childNodes[0].setAttribute("stroke-width",5),n.childNodes[0].setAttribute("stroke","#723837"))})):t.DragOverElement=null}function resetNodeProperties(n,t){if(n!=undefined&&n!=null){angular.forEach(n.childNodes,function(n){n.getAttribute("elementtype")=="linegroup"&&(n.childNodes[0].setAttribute("stroke-width",1),n.childNodes[0].setAttribute("stroke","black"))});var i="url(#arrow_"+t.$root.currentopenfile.file.FileName.trim()+")";t.activeTab=="EXECUTION"&&(i="url(#arrow_"+t.Guid+")");n.childNodes[n.childNodes.length-1].childNodes[0].setAttribute("marker-end",i)}}function SetNullOnDragleaveLineElement(n){var i=angular.element(n.currentTarget).scope(),t,r;checkTitleIsPresentOrDeleteTitle(n.currentTarget,"Delete");i.DragOverElement=null;t=n.currentTarget;t!=undefined&&t!=null&&(angular.forEach(t.childNodes,function(n){n.getAttribute("elementtype")=="linegroup"&&(n.childNodes[0].setAttribute("stroke-width",1),n.childNodes[0].setAttribute("stroke","black"))}),r="url(#arrow_"+i.$root.currentopenfile.file.FileName.trim()+")",i.activeTab=="EXECUTION"&&(fillcolor="url(#arrow_"+i.Guid+")"),t.childNodes[t.childNodes.length-1].childNodes[0].setAttribute("marker-end",r))}function getCoordinatesForMessageEvent(n){var t="",i,r,u;return t=n.objDragOverLineElement!=null?n.objDragOverLineElement.lstWayPoints:n.selectedShape.lstWayPoints,i={Left:0,Top:0},t.length>2?t[1].Left-t[2].Left>-.1&&t[1].Left-t[2].Left<.1?(t[1].Top>t[2].Top?(r=t[2].Top+(t[1].Top-t[2].Top)/2,i.Top=r-10):(r=t[1].Top+(t[2].Top-t[1].Top)/2,i.Top=r-10),i.Left=t[1].Left-10):(t[1].Left>t[2].Left?(u=t[2].Left+(t[1].Left-t[2].Left)/2,i.Left=u-10):(u=t[1].Left+(t[2].Left-t[1].Left)/2,i.Left=u-10),i.Top=t[1].Top-10):t.length==2&&(t[0].Left-t[1].Left>-.1&&t[0].Left-t[1].Left<.1?(t[0].Top>t[1].Top?(r=t[1].Top+(t[0].Top-t[1].Top)/2,i.Top=r-10):(r=t[0].Top+(t[1].Top-t[0].Top)/2,i.Top=r-10),i.Left=t[0].Left-10):(t[0].Left>t[1].Left?(u=t[1].Left+(t[0].Left-t[1].Left)/2,i.Left=u-10):(u=t[0].Left+(t[1].Left-t[0].Left)/2,i.Left=u-10),i.Top=t[0].Top-10)),i}function AddNewElementToBPM(n){onBodyClick();var t=angular.element(n.currentTarget).scope(),i=n.offsetX,r=n.offsetY;t.DraggableElement!=null&&(t.activeTab=="MAP"&&DrawShape(t.DraggableElement,n,t),t.DraggableElement=null,removeSelection("NewElement",t),removeSelectionForLane(t),removeRearrangingLinePoints(t),removeResizerAroundElement(t),t.selectedShape=undefined,t.$apply());t.svgElement.removeAttributeNS(null,"onmouseup");angular.element(t.svgElement.parentNode).removeAttr("ondrop");angular.element(t.svgElement.parentNode).removeAttr("ondragover")}function DrawShape(n,t,i){var r=getProcessRefId(t,i);n=="Pool"?(CreatePoolandLaneObjects(t,i),i.isDirty=!0):r?(i.isDirty=!0,n=="Lane"?CreateLaneObject(t,i,r):n=="Start Event"||n=="End Event"||n=="Intermediate Catch Event"?CreateEventObject(t,i,n,!1,r):n=="Exclusive Gateway"||n=="Inclusive Gateway"||n=="Parallel Gateway"||n=="Event Gateway"?CreateGatewayObject(t,i,n,!1,r):n=="Task"||n=="Manual Task"||n=="User Task"||n=="Business Rule Task"||n=="Service Task"?CreateTaskObject(t,i,n,!1,r):n=="Data Store"?CreateDataStoreObject(t,i,r):n=="Data object"?CreateDataObjReferenceObject(t,i,r):n=="Text Annotation"?CreateTextAnnotationObject(t,i,!1,r):n=="SubProcess"||n=="Calling Process"&&CreateCallActivityObject(t,i,r)):(n=="Initiating Message"||n=="Non Initiating Message")&&(i.isDirty=!0,i.DragOverElement!=null&&(CreateMessageReferenceObject(t,i,n),resetNodeProperties(i.DragOverElement,i),i.DragOverElement=null))}function CreatePoolandLaneObjects(n,t){var i="PROCESS_"+generateUUID(),u="PARTICIPANT_"+generateUUID(),f=generateUUID(),r={Height:200,Width:800,Left:n.offsetX,Top:n.offsetY,LabelHeight:21,LabelWidth:62,LabelLeft:0,LabelTop:0,ShapeName:"BPMNShape",ShapeType:"participant",processRef:i,lstWayPoints:[],Text:"Participant",Id:u,ShapeId:f},e={dictAttributes:{id:u,name:"Participant",processRef:i},Elements:[{dictAttributes:{minimum:"0",maximum:"1"},Elements:[],Children:[],Name:"participantMultiplicity",prefix:null,Value:""},{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"participant",prefix:null,Value:""},o={dictAttributes:{id:i,isClosed:"false",isExecutable:"true",processType:"None",name:"Participant"},Elements:[{dictAttributes:{sfwExcludeHolidays:"True",sfwExcludeWeekends:"True"},Elements:[],Children:[],Name:"extraSettings",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"laneSet",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"process",prefix:"",IsValueInCDATAFormat:!1,Value:""};r.ProcessModel=o;r.ShapeModel=e;t.objData.lstShapes.push(r);t.objData.Processes.push(i);drawSquareParam(t.svgElement,r,t);t.PaticipantIndex=undefined;CreateLaneObject(n,t,i)}function CreateLaneObject(n,t,i){var u="",f="",o;if((t.PaticipantIndex||t.PaticipantIndex==0)&&(u=t.objData.lstShapes[t.PaticipantIndex].Left+40,f=t.objData.lstShapes[t.PaticipantIndex].Top+t.objData.lstShapes[t.PaticipantIndex].Height),i!=""){var e="Lane_"+generateUUID(),s=generateUUID(),r={Height:200,Width:760,Left:u,Top:f,LabelHeight:21,LabelWidth:62,LabelLeft:0,LabelTop:0,ShapeName:"BPMNShape",ShapeType:"lane",processRef:i,lstWayPoints:[],Text:"Lane",Id:e,ShapeId:s};u==""&&f==""?(r.Left=n.offsetX+40,r.Top=n.offsetY):(t.objData.lstShapes[t.PaticipantIndex].Height=t.objData.lstShapes[t.PaticipantIndex].Height+r.Height,r.Width=t.objData.lstShapes[t.PaticipantIndex].Width-40);o={dictAttributes:{id:e,name:"Lane"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"userrole",prefix:"sbpmn",Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"lane",prefix:null,Value:""};r.ShapeModel=o;t.objData.lstShapes.push(r);RedrawingElementsAndEdges(t)}}function ChangeCatchEventImageBasedonType(n,t){for(var i=0;i<n.childNodes.length;i++)n.childNodes[i].nodeName=="image"&&(t=="Message"?n.childNodes[i].setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/messageEventDefinition.svg"):t=="Timer"?n.childNodes[i].setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/timerEventDefinition.svg"):n.childNodes[i].setAttributeNS("http://www.w3.org/1999/xlink","href","images/BPM/intermediateCatchEvent.svg"))}function DrawCatchEventSvg(n){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("fill","none");t.setAttribute("stroke","#333333");t.setAttribute("stroke-width","0.5");t.setAttribute("stroke-miterlimit","10");t.setAttribute("cx","12.912");t.setAttribute("cy","12.646");t.setAttribute("r","9.25");n.appendChild(t)}function DrawTimerEventSvg(n){var i="http://www.w3.org/2000/svg",r=document.createElementNS(i,"circle"),t,e,o,s,h,u,f;r.setAttribute("fill","none");r.setAttribute("stroke","#333333");r.setAttribute("stroke-width","0.5");r.setAttribute("stroke-miterlimit","10");r.setAttribute("cx","12.912");r.setAttribute("cy","12.646");r.setAttribute("r","11.5");n.appendChild(r);t=document.createElementNS(i,"circle");t.setAttribute("fill","none");t.setAttribute("stroke","#333333");t.setAttribute("stroke-width","0.5");t.setAttribute("stroke-miterlimit","10");t.setAttribute("cx","13.051");t.setAttribute("cy","12.808");t.setAttribute("r","9");n.appendChild(t);e=document.createElementNS(i,"rect");e.setAttribute("x","12");e.setAttribute("y","5");e.setAttribute("fill","#333333");e.setAttribute("width","1");e.setAttribute("height","3");n.appendChild(e);o=document.createElementNS(i,"rect");o.setAttribute("x","12");o.setAttribute("y","18");o.setAttribute("fill","#333333");o.setAttribute("width","1");o.setAttribute("height","3");n.appendChild(o);s=document.createElementNS(i,"rect");s.setAttribute("x","18");s.setAttribute("y","12");s.setAttribute("fill","#333333");s.setAttribute("width","3");s.setAttribute("height","1");n.appendChild(s);h=document.createElementNS(i,"rect");h.setAttribute("x","12");h.setAttribute("y","5");h.setAttribute("fill","#333333");h.setAttribute("width","3");h.setAttribute("height","1");n.appendChild(h);u=document.createElementNS(i,"rect");u.setAttribute("x","10.732");u.setAttribute("y","9.768");u.setAttribute("transform","matrix(0.7071 -0.7071 0.7071 0.7071 -5.3847 11.5354)");u.setAttribute("fill","#333333");u.setAttribute("width","1");u.setAttribute("height","5");n.appendChild(u);f=document.createElementNS(i,"rect");f.setAttribute("x","11.414");f.setAttribute("y","11.414");f.setAttribute("transform","matrix(0.7071 -0.7071 0.7071 0.7071 -4.2027 13.6818)");f.setAttribute("fill","#333333");f.setAttribute("width","6");f.setAttribute("height","1");n.appendChild(f)}function DrawMessageEventSvg(n){var f="http://www.w3.org/2000/svg",r=document.createElementNS(f,"circle"),t,u,i;r.setAttribute("fill","none");r.setAttribute("stroke","#333333");r.setAttribute("stroke-width","0.5");r.setAttribute("stroke-miterlimit","10");r.setAttribute("cx","12.912");r.setAttribute("cy","12.646");r.setAttribute("r","11.5");n.appendChild(r);t=document.createElementNS(f,"rect");t.setAttribute("x","4.5");t.setAttribute("y","8.5");t.setAttribute("fill","none");t.setAttribute("stroke","#333333");t.setAttribute("stroke-miterlimit","10");t.setAttribute("width","16");t.setAttribute("height","10");n.appendChild(t);u=document.createElementNS(f,"polyline");u.setAttribute("fill","none");u.setAttribute("stroke","#333333");u.setAttribute("stroke-miterlimit","10");u.setAttribute("points","4.75,8.935 12.281,14 20.5,8.625");n.appendChild(u);i=document.createElementNS(f,"line");i.setAttribute("x1","205");i.setAttribute("y1","8.5");i.setAttribute("fill","#FFFFFF");i.setAttribute("stroke","#333333");i.setAttribute("stroke-miterlimit","10");i.setAttribute("x2","5");i.setAttribute("y2","8.5");n.appendChild(i)}function getTimerEventModel(){var t={prefix:"",Name:"timerEventDefinition",Value:"",dictAttributes:{id:generateUUID()},Elements:[],Children:[]},i={prefix:"",Name:"timeDuration",Value:"",dictAttributes:{},Elements:[],Children:[]},n={prefix:"",Name:"extensionElements",Value:"",dictAttributes:{},Elements:[],Children:[]};return n.Elements.push({prefix:"",Name:"Duration",Value:"",dictAttributes:{sfwExcludeHolidays:"True",sfwExcludeWeekends:"True"},Elements:[],Children:[]}),n.Elements.push({prefix:"sbpmn",Name:"isSynchronous",Value:"False",dictAttributes:{},Elements:[],Children:[]}),i.Elements.push(n),t.Elements.push(i),t}function getMessageEventModel(){return{prefix:"",Name:"messageEventDefinition",Value:"",dictAttributes:{id:generateUUID()},Elements:[],Children:[]}}function getProcessRefId(n,t){var r="",i;for(t.PaticipantIndex=null,i=0;i<t.objData.lstShapes.length;i++)if(t.objData.lstShapes[i].ShapeType=="participant"&&t.objData.lstShapes[i].Left<=n.offsetX&&t.objData.lstShapes[i].Left+t.objData.lstShapes[i].Width>=n.offsetX&&t.objData.lstShapes[i].Top<=n.offsetY&&t.objData.lstShapes[i].Top+t.objData.lstShapes[i].Height>=n.offsetY){r=t.objData.lstShapes[i].processRef;t.PaticipantIndex=i;break}if(t.LaneIndex=null,t.PaticipantIndex!=null)for(i=0;i<t.objData.lstShapes.length;i++)if(t.objData.lstShapes[i].ShapeType=="lane"&&t.objData.lstShapes[i].Left<=n.offsetX&&t.objData.lstShapes[i].Left+t.objData.lstShapes[i].Width>=n.offsetX&&t.objData.lstShapes[i].Top<=n.offsetY&&t.objData.lstShapes[i].Top+t.objData.lstShapes[i].Height>=n.offsetY){t.LaneIndex=i;break}return r}function AddFlowNodeModelInLaneShapeModel(n,t){if(t.LaneIndex!=null){var i={dictAttributes:{},Elements:[],Children:[],Name:"flowNodeRef",prefix:null,Value:n.Id};t.objData.lstShapes[t.LaneIndex].ShapeModel.Elements.push(i)}}function CreateEventObject(n,t,i,r,u){var s;if(u!=""&&t.LaneIndex!=null){var o=generateUUID(),h=generateUUID(),f={Height:32,Width:32,Left:n.offsetX,Top:n.offsetY,LabelHeight:21,LabelWidth:62,LabelLeft:n.offsetX-10,LabelTop:n.offsetY+38,ShapeName:"BPMNShape",ShapeType:"",processRef:u,lstWayPoints:[],Text:"",Id:o,ShapeId:h},e={dictAttributes:{id:o,name:"Start Event"},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"startEvent",prefix:null,Value:""};i=="Start Event"?(f.Text="Start Event",f.ShapeType="startEvent",e.dictAttributes.name="Start Event",e.Name="startEvent",e.dictAttributes.isInterrupting="true"):i=="End Event"?(f.Text="End Event",f.ShapeType="endEvent",f.LabelLeft=n.offsetX-8,e.dictAttributes.name="End Event",e.Name="endEvent"):i=="Intermediate Catch Event"&&(f.Text="Intermediate Catch Event",f.ShapeType="intermediateCatchEvent",f.LabelLeft=n.offsetX-50,f.LabelWidth=138,e={dictAttributes:{id:o,name:"Intermediate Catch Event"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:null,Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"intermediateCatchEvent",prefix:null,Value:""});f.ShapeModel=e;AddFlowNodeModelInLaneShapeModel(f,t);t.objData.lstShapes.push(f);drawCircle(t.svgElement,f,t);r&&(s=isvalidEdgeForNewAddedElement(t.objData.lstShapes[t.indexofResizerElement],f),s&&((t.objData.lstShapes[t.indexofResizerElement].ShapeType=="parallelGateway"||t.objData.lstShapes[t.indexofResizerElement].ShapeType=="inclusiveGateway")&&(t.objData.lstShapes[t.indexofResizerElement].ShapeModel.dictAttributes.gatewayDirection="Unspecified"),DrawLineForNewAddedElement(t.objData.lstShapes[t.indexofResizerElement],f,t)))}}function isvalidEdgeForNewAddedElement(n,t){var r=!1,u,i;return n.ShapeType=="startEvent"?n.processRef!=t.processRef?t.ShapeType=="intermediateCatchEvent"?alert("The startEvent must not have any outgoing message flows. Only Message Intermediate Event may have incoming or outgoing message flows."):t.ShapeType=="exclusiveGateway"?(i="The GateWay must not have any incoming or outgoing message flows.",n.ShapeType=="startEvent"?alert("The StartEvent must not have any outgoing message flows. "+i):alert(i)):t.ShapeType=="task"?alert("The StartEvent must not have any outgoing message flows"):t.ShapeType=="textAnnotation"&&alert("The StartEvent must not have any outgoing message flows"):r=!0:n.ShapeType=="endEvent"?n.processRef==t.processRef?alert("The EndEvent must not have any outgoing sequence flows"):t.ShapeType=="intermediateCatchEvent"?alert(" Only Message Intermediate Event may have incoming or outgoing message flows."):t.ShapeType=="exclusiveGateway"?(i="The GateWay must not have any incoming or outgoing message flows.",alert(i)):r=!0:n.ShapeType=="intermediateCatchEvent"?n.processRef!=t.processRef?t.ShapeType=="intermediateCatchEvent"||t.ShapeType=="task"||t.ShapeType=="textAnnotation"?alert("Only Message Intermediate Event may have incoming or outgoing message flows."):t.ShapeType=="exclusiveGateway"&&(i="The GateWay must not have any incoming or outgoing message flows.",n.ShapeType=="intermediateCatchEvent"?alert("Only Message Intermediate Event may have incoming or outgoing message flows. "+i):alert(i)):r=!0:n.ShapeType=="exclusiveGateway"||n.ShapeType=="inclusiveGateway"||n.ShapeType=="parallelGateway"||n.ShapeType=="eventBasedGateway"?n.processRef!=t.processRef?(i="The GateWay must not have any incoming or outgoing message flows.",t.ShapeType=="intermediateCatchEvent"?alert("Only Message Intermediate Event may have incoming or outgoing message flows. "+i):alert(i)):r=!0:n.ShapeType=="task"||n.ShapeType=="manualTask"||n.ShapeType=="userTask"||n.ShapeType=="businessRuleTask"||n.ShapeType=="serviceTask"||n.ShapeType=="callActivity"?n.processRef!=t.processRef?t.ShapeType=="intermediateCatchEvent"?alert("Only Message Intermediate Event may have incoming or outgoing message flows. "):t.ShapeType=="exclusiveGateway"?alert("The GateWay must not have any incoming or outgoing message flows."):r=!0:r=!0:(n.ShapeType=="dataStoreReference"||n.ShapeType=="dataObjectReference")&&(t.ShapeType!="task"?(u="The source or the target of the Data Association Connected to the DataStore must be an actitvity. ",t.ShapeType=="intermediateCatchEvent"?(i="Only Message Intermediate Event may have incoming or outgoing message flows.",alert(u+i)):t.ShapeType=="exclusiveGateway"?(i="The GateWay must not have any incoming or outgoing message flows.",alert(u+i)):alert(u)):r=!0),r}function getGateWayTypeModel(n,t){var i="";return n=="Exclusive Gateway"?i={dictAttributes:{id:t,name:"Exclusive Gateway",gatewayDirection:"Unspecified"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:null,Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"exclusiveGateway",prefix:null,Value:""}:n=="Inclusive Gateway"?i={dictAttributes:{id:t,name:"Inclusive Gateway",gatewayDirection:"Unspecified"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"inclusiveGateway",prefix:null,Value:""}:n=="Parallel Gateway"?i={dictAttributes:{id:t,name:"Parallel Gateway",gatewayDirection:"Unspecified"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"parallelGateway",prefix:null,Value:""}:n=="Event Gateway"&&(i={dictAttributes:{id:t,name:"Event Gateway",gatewayDirection:"Unspecified",eventGatewayType:"Exclusive",instantiate:"false"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"eventBasedGateway",prefix:null,Value:""}),i}function CreateGatewayObject(n,t,i,r,u){var o;if(u!=""&&t.LaneIndex!=null){var e=generateUUID(),s=generateUUID(),f={Id:e,ShapeType:"",lstWayPoints:[],Left:n.offsetX,Width:42,Height:42,Top:n.offsetY,ShapeName:"BPMNShape",Text:"",LabelLeft:n.offsetX-28,LabelWidth:100,LabelHeight:21,LabelTop:n.offsetY+47,processRef:u,lstWayPoints:[],ShapeId:s},h=getGateWayTypeModel(i,e);i=="Exclusive Gateway"?(f.ShapeType="exclusiveGateway",f.Text="Exclusive Gateway"):i=="Inclusive Gateway"?(f.ShapeType="inclusiveGateway",f.Text="Inclusive Gateway"):i=="Parallel Gateway"?(f.ShapeType="parallelGateway",f.Text="Parallel Gateway"):i=="Event Gateway"&&(f.ShapeType="eventBasedGateway",f.Text="Event Gateway");f.ShapeModel=h;AddFlowNodeModelInLaneShapeModel(f,t);t.objData.lstShapes.push(f);drawDiamond(t.svgElement,f,t);r&&(o=isvalidEdgeForNewAddedElement(t.objData.lstShapes[t.indexofResizerElement],f),o&&((t.objData.lstShapes[t.indexofResizerElement].ShapeType=="parallelGateway"||t.objData.lstShapes[t.indexofResizerElement].ShapeType=="inclusiveGateway")&&(t.objData.lstShapes[t.indexofResizerElement].ShapeModel.dictAttributes.gatewayDirection="Unspecified"),DrawLineForNewAddedElement(t.objData.lstShapes[t.indexofResizerElement],f,t)))}}function getTaskTypeModel(n,t){var i;return n=="Task"?i={dictAttributes:{id:t,name:"Task",completionQuantity:"1",isForCompensation:"false",startQuantity:"1"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""},{dictAttributes:{sfwExcludeHolidays:"True",sfwExcludeWeekends:"True"},Elements:[],Children:[],Name:"extraSettings",prefix:null,Value:""}],Children:[],Name:"task",prefix:null,Value:""}:n=="Manual Task"?i={dictAttributes:{id:t,name:"Manual Task",completionQuantity:"1",isForCompensation:"false",startQuantity:"1"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""},{dictAttributes:{sfwExcludeHolidays:"True",sfwExcludeWeekends:"True"},Elements:[],Children:[],Name:"extraSettings",prefix:null,Value:""}],Children:[],Name:"manualTask",prefix:null,Value:""}:n=="User Task"?i={dictAttributes:{id:t,name:"User Task",completionQuantity:"1",implementation:"##unspecified",isForCompensation:"false",startQuantity:"1"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"actions",prefix:"sbpmn",Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"ReferenceId",prefix:"sbpmn",Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"userTaskExtension",prefix:"sbpmn",Value:""},{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"defaultcondition",prefix:"sbpmn",Value:""}],Children:[],Name:"performers",prefix:"sbpmn",Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""},{dictAttributes:{sfwExcludeHolidays:"True",sfwExcludeWeekends:"True",sfwCanExecuteBpmTaskOnSoftErrors:"True"},Elements:[],Children:[],Name:"extraSettings",prefix:null,Value:""}],Children:[],Name:"userTask",prefix:null,Value:""}:n=="Business Rule Task"?i={dictAttributes:{id:t,name:"Business Rule Task",completionQuantity:"1",implementation:"##unspecified",isForCompensation:"false",startQuantity:"1"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"rule",prefix:"sbpmn",Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""},{dictAttributes:{sfwExcludeHolidays:"True",sfwExcludeWeekends:"True"},Elements:[],Children:[],Name:"extraSettings",prefix:null,Value:""}],Children:[],Name:"businessRuleTask",prefix:null,Value:""}:n=="Service Task"&&(i={dictAttributes:{id:t,name:"Service Task",completionQuantity:"1",implementation:"##WebService",isForCompensation:"false",startQuantity:"1"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""},{dictAttributes:{sfwExcludeHolidays:"True",sfwExcludeWeekends:"True"},Elements:[],Children:[],Name:"extraSettings",prefix:null,Value:""}],Children:[],Name:"serviceTask",prefix:null,Value:""}),i}function CreateTaskObject(n,t,i,r,u){var o,s;if(u!=""&&t.LaneIndex!=null){var e=generateUUID(),h=generateUUID(),f={Id:e,ShapeType:"",lstWayPoints:[],Left:n.offsetX,Width:85,Height:55,Top:n.offsetY,ShapeName:"BPMNShape",Text:"",LabelLeft:n.offsetX+1,LabelWidth:90,LabelHeight:37,LabelTop:n.offsetY+25,processRef:u,lstWayPoints:[],ShapeId:h},c=getTaskTypeModel(i,e);i=="Task"?(f.ShapeType="task",f.Text="Task"):i=="Manual Task"?(f.ShapeType="manualTask",f.Text="Manual Task"):i=="User Task"?(f.ShapeType="userTask",f.Text="User Task"):i=="Business Rule Task"?(f.ShapeType="businessRuleTask",f.Text="Business Rule Task"):i=="Service Task"&&(f.ShapeType="serviceTask",f.Text="Service Task");f.ShapeModel=c;AddFlowNodeModelInLaneShapeModel(f,t);t.objData.lstShapes.push(f);drawTask(t.svgElement,f,t);r&&(o=isvalidEdgeForNewAddedElement(t.objData.lstShapes[t.indexofResizerElement],f),o&&((t.objData.lstShapes[t.indexofResizerElement].ShapeType=="inclusiveGateway"||t.objData.lstShapes[t.indexofResizerElement].ShapeType=="parallelGateway")&&(t.objData.lstShapes[t.indexofResizerElement].ShapeModel.dictAttributes.gatewayDirection="Unspecified",s=getgateWaydirectionbasedOnEdges(t.objData.lstShapes[t.indexofResizerElement].Id,t,"Out"),t.objData.lstShapes[t.indexofResizerElement].ShapeModel.dictAttributes.gatewayDirection=s),DrawLineForNewAddedElement(t.objData.lstShapes[t.indexofResizerElement],f,t)))}}function CreateCallActivityObject(n,t,i){if(i!=""&&t.LaneIndex!=null){var u=generateUUID(),f=generateUUID(),r={Id:u,ShapeType:"callActivity",lstWayPoints:[],Left:n.offsetX,Width:85,Height:55,Top:n.offsetY,ShapeName:"BPMNShape",Text:"Call Activity",LabelLeft:n.offsetX+1,LabelWidth:90,LabelHeight:37,LabelTop:n.offsetY+25,processRef:i,lstWayPoints:[],ShapeId:f},e={dictAttributes:{id:u,name:"Call Activity",completionQuantity:"1",isForCompensation:"false",startQuantity:"1"},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"callActivity",prefix:null,Value:""};r.ShapeModel=e;AddFlowNodeModelInLaneShapeModel(r,t);t.objData.lstShapes.push(r);drawTask(t.svgElement,r,t)}}function CreateDataStoreObject(n,t,i){if(i!=""&&t.LaneIndex!=null){var u=generateUUID(),e=generateUUID(),f="DS_"+generateUUID(),r={Id:u,ShapeType:"dataStoreReference",lstWayPoints:[],Left:n.offsetX,Width:32,Height:32,Top:n.offsetY,ShapeName:"BPMNShape",Text:"Data Store",LabelLeft:n.offsetX-12,LabelWidth:60,LabelHeight:21,LabelTop:n.offsetY+37,processRef:i,lstWayPoints:[],ShapeId:e},o={dictAttributes:{id:u,name:"Data Store",dataStoreRef:f},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"dataStoreReference",prefix:null,Value:""},s={dictAttributes:{id:f,name:"Data Store",isUnlimited:"false"},Elements:[],Children:[],Name:"dataStore",prefix:null,Value:""};r.ShapeModel=o;r.DataStoreModel=s;AddFlowNodeModelInLaneShapeModel(r,t);t.objData.lstShapes.push(r);drawdataStoreReference(t.svgElement,r,t)}}function CreateDataObjReferenceObject(n,t,i){if(i!=""&&t.LaneIndex!=null){var u=generateUUID(),e=generateUUID(),f="DO_"+generateUUID(),r={Id:u,ShapeType:"dataObjectReference",lstWayPoints:[],Left:n.offsetX,Width:29,Height:38,Top:n.offsetY,ShapeName:"BPMNShape",Text:"Data Object",LabelLeft:n.offsetX-15,LabelWidth:60,LabelHeight:21,LabelTop:n.offsetY+43,processRef:i,lstWayPoints:[],ShapeId:e},o={dictAttributes:{id:u,name:"Data Object",dataObjectRef:f},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",Value:"False"}],Children:[],Name:"extensionElements",prefix:null,Value:""}],Children:[],Name:"dataObjectReference",prefix:null,Value:""},s={dictAttributes:{id:f,name:"Data Object",isCollection:"false"},Elements:[],Children:[],Name:"dataObject",prefix:null,Value:""};r.ShapeModel=o;AddFlowNodeModelInLaneShapeModel(r,t);r.DataObjectModel=s;t.objData.lstShapes.push(r);drawdataObjectReference(t.svgElement,r,t)}}function CreateTextAnnotationObject(n,t,i,r){var e;if(r!=""&&t.LaneIndex!=null){var f=generateUUID(),o=generateUUID(),u={Id:f,ShapeType:"textAnnotation",lstWayPoints:[],Left:n.offsetX,Width:85,Height:55,Top:n.offsetY,ShapeName:"BPMNShape",Text:"",LabelLeft:n.offsetX,LabelWidth:85,LabelHeight:55,LabelTop:n.offsetY,processRef:r,lstWayPoints:[],ShapeId:o},s={dictAttributes:{id:f,textFormat:"text/plain"},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"text",prefix:null,Value:""}],Children:[],Name:"textAnnotation",prefix:null,Value:""};u.ShapeModel=s;AddFlowNodeModelInLaneShapeModel(u,t);t.objData.lstShapes.push(u);drawtextAnnotation(t.svgElement,u,t);i&&(e=isvalidEdgeForNewAddedElement(t.objData.lstShapes[t.indexofResizerElement],u),e&&((t.objData.lstShapes[t.indexofResizerElement].ShapeType=="parallelGateway"||t.objData.lstShapes[t.indexofResizerElement].ShapeType=="inclusiveGateway")&&(t.objData.lstShapes[t.indexofResizerElement].ShapeModel.dictAttributes.gatewayDirection="Unspecified"),DrawLineForNewAddedElement(t.objData.lstShapes[t.indexofResizerElement],u,t)))}}function CreateMessageReferenceObject(n,t,i){var f="",r,o;f=i=="Initiating Message"?"initiating":"non_initiating";var u=generateUUID(),s=generateUUID(),e=getCoordinatesForMessageEvent(t);t.objDragOverLineElement.ShapeModel.dictAttributes.messageRef=u;r={Height:20,Width:20,Left:e.Left,Top:e.Top,LabelLeft:n.offsetX-15,LabelWidth:60,LabelHeight:21,LabelTop:n.offsetY+30,ShapeName:"BPMNShape",ShapeType:"message",processRef:"",lstWayPoints:[],Text:"",Id:u,ShapeId:s};t.objDragOverLineElement.MessageVisibleKind=f;t.objDragOverLineElement.MessageReference=u;o={prefix:"",Name:"message",Value:"",dictAttributes:{id:t.objDragOverLineElement.ShapeModel.dictAttributes.messageRef},Elements:[],children:[]};r.ShapeModel=o;t.objData.lstShapes.push(r);drawInitiatingorNonInitiatingMessage(t.svgElement,r,t)}function drawNewTask(n){var i,r;if(n&&n.buttons!=2){var t=angular.element(n.currentTarget).scope(),u=parseFloat(t.selectedElemForResize.getAttribute("x")),f=parseFloat(t.selectedElemForResize.getAttribute("y")),e=parseFloat(t.selectedElemForResize.getAttribute("width")),o=parseFloat(t.selectedElemForResize.getAttribute("height")),s=f+o/2-30;objShape={Height:55,Width:85,Left:u+e+100,Top:s};i={offsetX:objShape.Left,offsetY:objShape.Top};r=getProcessRefId(i,t);CreateTaskObject(i,t,"Task",!0,r);removeSelection("NewElement",t);removeRearrangingLinePoints(t);removeResizerAroundElement(t);t.isDirty=!0}}function drawExclusiveGate(n){var i,r;if(n&&n.buttons!=2){var t=angular.element(n.currentTarget).scope(),u=parseFloat(t.selectedElemForResize.getAttribute("x")),f=parseFloat(t.selectedElemForResize.getAttribute("y")),e=parseFloat(t.selectedElemForResize.getAttribute("width")),o=parseFloat(t.selectedElemForResize.getAttribute("height")),s=f+o/2-30;objShape={Height:42,Width:42,Left:u+e+100,Top:s};i={offsetX:objShape.Left,offsetY:objShape.Top};r=getProcessRefId(i,t);CreateGatewayObject(i,t,"Exclusive Gateway",!0,r);removeSelection("NewElement",t);removeRearrangingLinePoints(t);removeResizerAroundElement(t);t.isDirty=!0}}function drawintermediateCatchEvent(n){var i,r;if(n&&n.buttons!=2){var t=angular.element(n.currentTarget).scope(),u=parseFloat(t.selectedElemForResize.getAttribute("x")),f=parseFloat(t.selectedElemForResize.getAttribute("y")),e=parseFloat(t.selectedElemForResize.getAttribute("width")),o=parseFloat(t.selectedElemForResize.getAttribute("height")),s=f+o/2-30;objShape={Height:32,Width:32,Left:u+e+100,Top:s};i={offsetX:objShape.Left,offsetY:objShape.Top};r=getProcessRefId(i,t);CreateEventObject(i,t,"Intermediate Catch Event",!0,r);removeSelection("NewElement",t);removeRearrangingLinePoints(t);removeResizerAroundElement(t);t.isDirty=!0}}function drawtextAnnotationFromPanel(n){var i,r;if(n&&n.buttons!=2){var t=angular.element(n.currentTarget).scope(),u=parseFloat(t.selectedElemForResize.getAttribute("x")),f=parseFloat(t.selectedElemForResize.getAttribute("y")),e=parseFloat(t.selectedElemForResize.getAttribute("width")),o=parseFloat(t.selectedElemForResize.getAttribute("height")),s=f+o/2-30;objShape={Height:32,Width:32,Left:u+e+100,Top:s};i={offsetX:objShape.Left,offsetY:objShape.Top};r=getProcessRefId(i,t);CreateTextAnnotationObject(i,t,!0,r);removeSelection("NewElement",t);removeRearrangingLinePoints(t);removeResizerAroundElement(t);t.isDirty=!0}}function DrawLineForNewAddedElement(n,t,i){var u=GetEdgeWayPointsForDottedLine(n,t),o,c,y,l,h,p,w,b,s;u=setShapeNameToWayPoints(u);var f=n.Id,a="EDGE_"+generateUUID(),v=!1;if(f!=""){o="";n.processRef==t.processRef&&n.ShapeType!="dataStoreReference"&&n.ShapeType!="dataObjectReference"?(o=n.processRef,v=!0):(i.objData.CollaborationId==""&&(i.objData.CollaborationId="COLLABORATION_"+generateUUID()),o=i.objData.CollaborationId);var e=generateUUID(),r={Id:e,lstWayPoints:u,ShapeName:"BPMNEdge",ShapeType:"sequenceFlow",SourceElement:f,TargetElement:t.Id,LabelLeft:0,LabelTop:0,LabelHeight:0,LabelWidth:0,Text:"",processRef:o,ShapeId:a},s="";t.ShapeType=="textAnnotation"?(r.ShapeType="association",c=u.length,c>2&&(y=c-2,u.splice(1,y),r.lstWayPoints=u),s={dictAttributes:{id:e,sourceRef:f,targetRef:t.Id,associationDirection:"None"},Elements:[],Children:[],Name:"association",prefix:null,Value:""}):v?(l=GetElementProcessIdorElementBasedOnIdorDeleteElement(r.SourceElement,i,"Element"),s=l.ShapeType=="exclusiveGateway"||l.ShapeType=="inclusiveGateway"?{dictAttributes:{id:e,sourceRef:f,targetRef:t.Id},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"leftside",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"rightside",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"conditionExpression",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"sequenceFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""}:{dictAttributes:{id:e,sourceRef:f,targetRef:t.Id,associationDirection:"None"},Elements:[],Children:[],Name:"sequenceFlow",prefix:null,Value:""}):n.ShapeType=="dataStoreReference"||n.ShapeType=="dataObjectReference"?(h=generateUUID(),p={dictAttributes:{},Elements:[{dictAttributes:{id:h,isCollection:"false"},Elements:[],Children:[],Name:"dataInput",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"dataInputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:h}],Children:[],Name:"inputSet",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"ioSpecification",prefix:"",IsValueInCDATAFormat:!1,Value:""},t.ShapeModel.Elements.push(p),r={Id:e,lstWayPoints:u,ShapeName:"BPMNEdge",ShapeType:"dataInputAssociation",SourceElement:f,TargetElement:t.Id,LabelLeft:0,LabelTop:0,LabelHeight:0,LabelWidth:0,Text:"",processRef:o,ShapeId:a},w=e,b={dictAttributes:{id:w},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"sourceRef",prefix:"",IsValueInCDATAFormat:!1,Value:n.Id},{dictAttributes:{},Elements:[],Children:[],Name:"targetRef",prefix:"",IsValueInCDATAFormat:!1,Value:h}],Children:[],Name:"dataInputAssociation",prefix:"",IsValueInCDATAFormat:!1,Value:""},s=b):(r.ShapeType="messageFlow",s={dictAttributes:{id:e,sourceRef:f,targetRef:t.Id},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"docTypes",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"messageFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""});r.ShapeModel=s;AddLineArray(i.svgElement,r,i);i.objData.lstShapes.push(r)}}function setShapeNameToWayPoints(n){for(var t=0;t<n.length;t++)n[t].ShapeName="waypoint";return n}function AddLaneToPool(n,t){if(t)for(var i=0;i<t.objData.lstShapes.length;i++)if(t.selectedShape.Id==t.objData.lstShapes[i].Id){t.PaticipantIndex=i;CreateLaneObject(n,t,t.selectedShape.processRef);break}}function ChangeTaskFromContextMenu(n,t){var u,i,r,f;if(n.selectedShape){if(u=getTaskTypeModel(t,n.selectedShape.Id),u.dictAttributes.name=n.selectedShape.Text,t=="Task"?n.selectedShape.ShapeType="task":t=="Manual Task"?n.selectedShape.ShapeType="manualTask":t=="User Task"?n.selectedShape.ShapeType="userTask":t=="Business Rule Task"?n.selectedShape.ShapeType="businessRuleTask":t=="Service Task"&&(n.selectedShape.ShapeType="serviceTask"),i=n.selectedElemForResize,i)for(i.setAttribute("id",n.selectedShape.ShapeType),i.setAttribute("elementtype",n.selectedShape.ShapeType),r=0;r<i.childNodes.length;r++)if(i.childNodes[r].nodeName=="image"){i.removeChild(i.childNodes[r]);break}n.selectedShape.ShapeModel=u;f=getImageDependOnType(n.selectedShape,i,n);f.setAttribute("onmouseover","hoverOnElement(evt,this)")}}function ChangeGatewayFromContextMenu(n,t){var r,f,i,u,e;if(n.selectedShape){if(r=getGateWayTypeModel(t,n.selectedShape.Id),r.dictAttributes.name=n.selectedShape.Text,r.Name=="inclusiveGateway"||r.Name=="parallelGateway"?(f=getgateWaydirectionbasedOnEdges(r.dictAttributes.id,n,""),r.dictAttributes.gatewayDirection=f):r.dictAttributes.gatewayDirection=n.selectedShape.ShapeModel.dictAttributes.gatewayDirection,t=="Exclusive Gateway"?n.selectedShape.ShapeType="exclusiveGateway":t=="Inclusive Gateway"?n.selectedShape.ShapeType="inclusiveGateway":t=="Parallel Gateway"?n.selectedShape.ShapeType="parallelGateway":t=="Event Gateway"&&(n.selectedShape.ShapeType="eventBasedGateway"),i=n.selectedElemForResize,i)for(i.setAttribute("id",n.selectedShape.ShapeType),i.setAttribute("elementtype",n.selectedShape.ShapeType),u=0;u<i.childNodes.length;u++)if(i.childNodes[u].nodeName=="image"){i.removeChild(i.childNodes[u]);break}n.$evalAsync(function(){n.selectedShape.ShapeModel=r});e=getImageDependOnType(n.selectedShape,i,n);e.setAttribute("onmouseover","hoverOnElement(evt,this)")}}function ChangeEventTypeFromContextMenu(n,t){var i,r,u;if(n.selectedShape&&n.selectedElemForResize){for(i=0;i<n.selectedShape.ShapeModel.Elements.length;i++)if(n.selectedShape.ShapeModel.Elements[i].Name=="extensionElements"||n.selectedShape.ShapeModel.Elements[i].Name=="messageEventDefinition"||n.selectedShape.ShapeModel.Elements[i].Name=="timerEventDefinition"){n.selectedShape.ShapeModel.Elements.splice(i,1);break}t=="Message Event"?(r=getMessageEventModel(),n.selectedShape.ShapeModel.Elements.push(r),ChangeCatchEventImageBasedonType(n.selectedElemForResize,"Message")):t=="Timer Event"&&(u=getTimerEventModel(),n.selectedShape.ShapeModel.Elements.push(u),ChangeCatchEventImageBasedonType(n.selectedElemForResize,"Timer"))}}function OpenCalledElement(n){var i,t,r;n.selectedShape&&(i=n.selectedShape.ShapeModel.dictAttributes.calledElement,i&&(t=i.split("."),t&&t.length>0&&(r=t[0],n.NavigateToCalledElementFromContextMenu(r))))}function FixEdgeFromContextMenu(n){var f,e,t,i;if(n&&n.selectedShape&&n.selectedLineEle){var r=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.selectedShape.SourceElement,n,"Element"),u=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.selectedShape.TargetElement,n,"Element"),o=GetEdgeWayPointsForDottedLine(r,u);Newpoints=setShapeNameToWayPoints(o);(r.ShapeType=="textAnnotation"||u.ShapeType=="textAnnotation")&&(f=Newpoints.length,Newpoints.length>2&&(e=f-2,Newpoints.splice(1,e)));GenerateClonedLine(Newpoints,n.selectedLineEle,n);removeRearrangingLinePoints(n);n.selectedShape.lstWayPoints=Newpoints;n.selectedShape.ShapeType=="messageFlow"&&n.selectedShape.ShapeModel.dictAttributes&&n.selectedShape.ShapeModel.dictAttributes.messageRef&&n.selectedShape.ShapeModel.dictAttributes.messageRef.trim().length>0&&(t=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.selectedShape.ShapeModel.dictAttributes.messageRef,n,"Element"),removeElementFromSvg(t,n),i=getCoordinatesForMessageEvent(n),t.Left=i.Left,t.Top=i.Top,drawInitiatingorNonInitiatingMessage(n.svgElement,t,n))}}function OnChangeMessageKindFromContextMenu(n,t){n&&n.selectedShape&&n.$apply(function(){if(t=="initiating"||t=="non_initiating")if(n.selectedShape.ShapeModel.dictAttributes&&n.selectedShape.ShapeModel.dictAttributes.messageRef&&n.selectedShape.ShapeModel.dictAttributes.messageRef.trim().length>0){n.selectedShape.MessageVisibleKind=t;var i=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.selectedShape.ShapeModel.dictAttributes.messageRef,n,"Element");ChangeImageOfTheShape(t,n,i)}else AddMessageKind(t,n);else RemoveMessageKind(n)})}function AddMessageKind(n,t){var r=generateUUID(),e=generateUUID(),u=getShapeCoordinatesBasedOnResizerLine(t),i,f;t.selectedShape.ShapeModel.dictAttributes.messageRef=r;i={Height:20,Width:20,Left:u.Left,Top:u.Top,LabelHeight:0,LabelWidth:0,LabelLeft:0,LabelTop:0,ShapeName:"BPMNShape",ShapeType:"message",processRef:"",lstWayPoints:[],Text:"",Id:r,ShapeId:e};t.selectedShape.MessageVisibleKind=n;t.selectedShape.MessageReference=r;f={prefix:"",Name:"message",Value:"",dictAttributes:{id:t.selectedShape.ShapeModel.dictAttributes.messageRef},Elements:[],children:[]};i.ShapeModel=f;t.objData.lstShapes.push(i);drawInitiatingorNonInitiatingMessage(t.svgElement,i,t)}function RemoveMessageKind(n){if(n.selectedShape.ShapeModel.dictAttributes.messageRef&&n.selectedShape.ShapeModel.dictAttributes.messageRef.trim().length>0){var t=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.selectedShape.ShapeModel.dictAttributes.messageRef,n,"Delete");removeElementFromSvg(t,n);n.selectedShape.MessageVisibleKind="";n.selectedShape.MessageReference="";n.selectedShape.ShapeModel.dictAttributes.messageRef=""}}function toggleOpenBPMEventsList(n){onBodyClick();$("div[class='displayblock main-parent']").find("#BPMEvents").is(":visible")?$("div[class='displayblock main-parent']").find("#BPMEvents").slideUp():$("div[class='displayblock main-parent']").find("#BPMEvents").slideDown();n.stopPropagation()}function closeBPMEventList(){$("div[class='displayblock main-parent']").find("#BPMEvents").is(":visible")&&$("div[class='displayblock main-parent']").find("#BPMEvents").slideUp()}function toggleOpenBPMGatewayList(n){onBodyClick();$("div[class='displayblock main-parent']").find("#BPMGateway").is(":visible")?$("div[class='displayblock main-parent']").find("#BPMGateway").slideUp():$("div[class='displayblock main-parent']").find("#BPMGateway").slideDown();n.stopPropagation()}function closeBPMGatewayList(){$("div[class='displayblock main-parent']").find("#BPMGateway").is(":visible")&&$("div[class='displayblock main-parent']").find("#BPMGateway").slideUp()}function toggleOpenBPMTasksList(n){onBodyClick();$("div[class='displayblock main-parent']").find("#BPMTasks").is(":visible")?$("div[class='displayblock main-parent']").find("#BPMTasks").slideUp():$("div[class='displayblock main-parent']").find("#BPMTasks").slideDown();n.stopPropagation()}function closeBPMTasksList(){$("div[class='displayblock main-parent']").find("#BPMTasks").is(":visible")&&$("div[class='displayblock main-parent']").find("#BPMTasks").slideUp()}function toggleOpenBPMDataList(n){onBodyClick();$("div[class='displayblock main-parent']").find("#BPMData").is(":visible")?$("div[class='displayblock main-parent']").find("#BPMData").slideUp():$("div[class='displayblock main-parent']").find("#BPMData").slideDown();n.stopPropagation()}function closeBPMDataList(){$("div[class='displayblock main-parent']").find("#BPMData").is(":visible")&&$("div[class='displayblock main-parent']").find("#BPMData").slideUp()}function toggleOpenBPMCallActivity(n){onBodyClick();$("div[class='displayblock main-parent']").find("#BPMCallActivity").is(":visible")?$("div[class='displayblock main-parent']").find("#BPMCallActivity").slideUp():$("div[class='displayblock main-parent']").find("#BPMCallActivity").slideDown();n.stopPropagation()}function closeBPMCallActivityList(){$("div[class='displayblock main-parent']").find("#BPMCallActivity").is(":visible")&&$("div[class='displayblock main-parent']").find("#BPMCallActivity").slideUp()}function CheckandAddExtrasettingsModel(n){var t=n.ShapeModel.Elements.filter(function(n){return n.Name=="extraSettings"});t&&t.length==0&&(t={dictAttributes:{sfwExcludeHolidays:"True",sfwExcludeWeekends:"True"},Elements:[],Children:[],Name:"extraSettings",prefix:null,Value:""},n.ShapeModel.Elements.push(t))}function removeSelection(n,t){for(var u=!1,r=$("div[id='"+t.$root.currentopenfile.file.FileName+"']").find("#mySVG  #SelectionElement"),i=0;i<r.length;i++)t.selectedElement!=r[i].parentNode||n=="line"||n=="NewElement"?(r[i].parentNode.removeChild(r[i]),n=="NewElement"&&(t.selectedElemForResize=null)):u=!0;return u}function removeSelectionForLane(n){for(var i,r=$("div[id='"+n.$root.currentopenfile.file.FileName+"']").find("#mySVG  #lane"),t=0;t<r.length;t++)for(i=0;i<r[t].childNodes.length;i++)(r[t].childNodes[i].nodeName=="rect"||r[t].childNodes[i].nodeName=="line")&&(r[t].childNodes[i].setAttribute("stroke","black"),r[t].childNodes[i].setAttribute("stroke-width","1"))}function selectElement(n,t){var i=angular.element(t).scope();if(i){if(i.selectedElementID){function r(){i.selectedElementID=undefined}i.$apply(r)}i.selectedLineEle&&i.activeTab=="MAP"&&setColorToSelectedLine(i.selectedLineEle,"remove");i.$apply(function(){var e,o,f,u,s,r;if(i.selectedElement=n.currentTarget,i.isElementMoved=!1,i.selectedLineEle=null,i.selectedElemForResize=i.selectedElement,e=!1,o=!1,i.activeTab!="EXECUTION"){for(n.ctrlKey?i.selectedShape&&i.selectedShape.ShapeType!="lane"&&i.selectedShape.ShapeType!="participant"&&i.selectedShape.ShapeName!="BPMNEdge"&&i.selectedShape.ShapeType!="message"&&(i.lstMultipleSelectedShapes.push(i.selectedShape),i.selectedShape=undefined,i.OnSelectLeftBPMTab("Toolbox")):(e=removeSelection(undefined,i),removeSelectionForLane(i),i.lstMultipleSelectedShapes=[]),r=0;r<i.objData.lstShapes.length;r++)if(i.objData.lstShapes[r].Left==parseFloat(i.selectedElemForResize.getAttribute("x"))&&i.objData.lstShapes[r].Top==parseFloat(i.selectedElemForResize.getAttribute("y")))if(i.indexofResizerElement=r,n.ctrlKey){if(i.objData.lstShapes[r]&&i.objData.lstShapes[r].ShapeType!="lane"&&i.objData.lstShapes[r].ShapeType!="participant"&&i.objData.lstShapes[r].ShapeType!="message"){if(checkShapeAlreadyPresentinListorNot(i.lstMultipleSelectedShapes,i.objData.lstShapes[r]))for(f=$(i.selectedElement).find("#SelectionElement"),u=0;u<f.length;u++)f[u].parentNode.removeChild(f[u]),o=!0;else i.lstMultipleSelectedShapes.push(i.objData.lstShapes[r]);i.CheckAndSetBoolAllSelectedShapesInSameLane(i.lstMultipleSelectedShapes)}}else i.selectedShape=i.objData.lstShapes[r]}else for(r=0;r<i.lstExecutionTabShapes.length;r++)i.lstExecutionTabShapes[r].Left==parseFloat(i.selectedElemForResize.getAttribute("x"))&&i.lstExecutionTabShapes[r].Top==parseFloat(i.selectedElemForResize.getAttribute("y"))&&(i.indexofResizerElement=r,i.selectedShape=i.lstExecutionTabShapes[r]);if(i.activeTab!="EXECUTION"){if(i.selectedElementTop=i.selectedElement.getAttribute("y"),i.selectedElementLeft=i.selectedElement.getAttribute("x"),i.selectedElemstartLeft=i.selectedElementLeft,i.selectedElemstartTop=i.selectedElementTop,i.selectedElemPrevBounds={Left:parseFloat(i.selectedElementLeft),Top:parseFloat(i.selectedElementTop),Width:parseFloat(i.selectedElement.getAttribute("width")),Height:parseFloat(i.selectedElement.getAttribute("height"))},i.selectedElement.getAttribute("id")!="lane"&&i.selectedElement.getAttribute("id")!="participant"){for(s=!1,r=0;r<i.svgElement.childNodes.length;r++)if(i.svgElement.childNodes[r].nodeName!="#text"&&i.svgElement.childNodes[r].nodeName!="#comment"&&i.svgElement.childNodes[r].nodeName!="defs"&&i.svgElement.childNodes[r].getAttribute("id")=="lane"){var h=parseFloat(i.svgElement.childNodes[r].getAttribute("x")),c=parseFloat(i.svgElement.childNodes[r].getAttribute("y")),l=parseFloat(i.svgElement.childNodes[r].getAttribute("height")),a=parseFloat(i.svgElement.childNodes[r].getAttribute("width"));if(h<i.objData.lstShapes[i.indexofResizerElement].Left&&i.objData.lstShapes[i.indexofResizerElement].Left<h+a&&i.objData.lstShapes[i.indexofResizerElement].Top>c&&i.objData.lstShapes[i.indexofResizerElement].Top<c+l){i.PrevlaneElement=i.svgElement.childNodes[r];i.SelectedElementLane=i.svgElement.childNodes[r];s=!0;break}}s||(i.SelectedElementLane=null)}else i.SelectedElementLane=null;if(removeRearrangingLinePoints(i),removeResizerAroundElement(i),i.activeTab!="MAP"||!i.IsMapEditable||i.IsVersionDisplay||n.ctrlKey||GenerateBoundsDynamicallyToElement(i.selectedElement,!1,i),i.selectedElement.getAttribute("id")!="lane")n.ctrlKey?o||generateSelectionRectangleDynamically(i.selectedElement,i):e||generateSelectionRectangleDynamically(i.selectedElement,i),i.activeTab!="MAP"||!i.IsMapEditable||i.IsVersionDisplay||n.ctrlKey||(i.svgElement.setAttributeNS(null,"onmouseup","deselectElement(evt,this)"),i.svgElement.setAttributeNS(null,"onmousemove","moveElement(evt,this)"));else for(i.svgElement.removeAttributeNS(null,"onmousemove"),r=0;r<i.selectedElement.childNodes.length;r++)(i.selectedElement.childNodes[r].nodeName=="rect"||i.selectedElement.childNodes[r].nodeName=="line")&&(i.selectedElement.childNodes[r].setAttribute("stroke","#dd4205"),i.selectedElement.childNodes[r].setAttribute("stroke-width","2"));i.isMouseDown=!0;i.currentX=n.offsetX;i.currentY=n.offsetY}i.activeTab!="EXECUTION"&&showElementProperties(n,t);i.selectedShape&&(i.selectedElementID=i.selectedShape.Id)})}}function getMaxResizeLimitsOfParticipantorLane(n){var t;if(n.objMaxResizeLimits={},n.selectedShape&&n.selectedShape.ShapeType=="participant")for(t=0;t<n.objData.lstShapes.length;t++)n.objData.lstShapes[t].ShapeName=="BPMNShape"&&n.objData.lstShapes[t].ShapeType!="participant"&&n.objData.lstShapes[t].processRef==n.selectedShape.processRef&&(n.objData.lstShapes[t].ShapeType!="lane"?((!n.objMaxResizeLimits.Top||n.objData.lstShapes[t].Top<n.objMaxResizeLimits.Top)&&(n.objMaxResizeLimits.Top=n.objData.lstShapes[t].Top),(!n.objMaxResizeLimits.Right||n.objData.lstShapes[t].Left+n.objData.lstShapes[t].Width>n.objMaxResizeLimits.Right)&&(n.objMaxResizeLimits.Right=n.objData.lstShapes[t].Left+n.objData.lstShapes[t].Width),(!n.objMaxResizeLimits.Left||n.objData.lstShapes[t].Left<n.objMaxResizeLimits.Left)&&(n.objMaxResizeLimits.Left=n.objData.lstShapes[t].Left),(!n.objMaxResizeLimits.Bottom||n.objData.lstShapes[t].Top+n.objData.lstShapes[t].Height>n.objMaxResizeLimits.Bottom)&&(n.objMaxResizeLimits.Bottom=n.objData.lstShapes[t].Top+n.objData.lstShapes[t].Height)):(n.objData.lstShapes[n.indexofResizerElement].Top-n.objData.lstShapes[t].Top>-1&&n.objData.lstShapes[n.indexofResizerElement].Top-n.objData.lstShapes[t].Top<1&&(n.objMaxResizeLimits.LaneTopLimit=n.objData.lstShapes[t].Top+n.objData.lstShapes[t].Height-50),n.objData.lstShapes[n.indexofResizerElement].Top+n.objData.lstShapes[n.indexofResizerElement].Height-(n.objData.lstShapes[t].Top+n.objData.lstShapes[t].Height)>-1&&n.objData.lstShapes[n.indexofResizerElement].Top+n.objData.lstShapes[n.indexofResizerElement].Height-(n.objData.lstShapes[t].Top+n.objData.lstShapes[t].Height)<1&&(n.objMaxResizeLimits.LaneBottomLimit=n.objData.lstShapes[t].Top+50)));else if(n.selectedShape&&n.selectedShape.ShapeType=="lane")for(n.objMaxResizeLimits.Bottom=n.selectedShape.Top+150,n.objMaxResizeLimits.Bottom>n.selectedShape.Top+n.selectedShape.Height&&(n.objMaxResizeLimits.Bottom=n.selectedShape.Top+n.selectedShape.Height),t=0;t<n.objData.lstShapes.length;t++)n.objData.lstShapes[t].ShapeName=="BPMNShape"&&n.objData.lstShapes[t].ShapeType!="participant"&&n.objData.lstShapes[t].ShapeType!="lane"&&n.objData.lstShapes[t].Top>n.selectedShape.Top&&n.objData.lstShapes[t].Top<n.selectedShape.Top+n.selectedShape.Height&&n.objData.lstShapes[t].Top+n.objData.lstShapes[t].Height>n.objMaxResizeLimits.Bottom&&(n.objMaxResizeLimits.Bottom=n.objData.lstShapes[t].Top+n.objData.lstShapes[t].Height)}function showElementProperties(n,t){var i=angular.element(t).scope();i&&i.selectedShape&&i.showDetails&&i.showDetails()}function selectPropertiesTab(n){if(n){var t=angular.element(n.currentTarget).scope();t&&t.selectedShape&&t.$apply(function(){t.ActiveTabForBPM="Properties";t.IsToolsDivCollapsed=!1})}}function moveElement(n,t){var i=angular.element(t).scope();i&&n.buttons==1?i.$apply(function(){var u,f,s,r,l,e,g,nt;if(i.isMouseDown&&(i.currentX!=n.offsetX||i.currentY!=n.offsetY))if(i.isDirty=!0,i.ClonedElement==null&&(i.ClonedElement=i.selectedElement.cloneNode(!0),i.ClonedElement.setAttribute("style","opacity: 0.5;"),i.svgElement.appendChild(i.ClonedElement)),u=n.offsetX-i.currentX,f=n.offsetY-i.currentY,i.selectedElement!=0&&i.ClonedElement!=null&&parseFloat(i.ClonedElement.getAttribute("x"))+u>0&&parseFloat(i.ClonedElement.getAttribute("y"))+f>0){i.objData.lstShapes[i.indexofResizerElement].ShapeType!="participant"&&setLaneBorderBasedOnElementPosition(i.ClonedElement,i);i.ClonedElement.setAttribute("x",parseFloat(i.ClonedElement.getAttribute("x"))+u);i.ClonedElement.setAttribute("y",parseFloat(i.ClonedElement.getAttribute("y"))+f);var y=!1,o="";for(s=0;s<$(i.ClonedElement).children().length;s++){if(r=$(i.ClonedElement).children()[s],r.getAttribute("id")=="MainElement"&&(o=r),r.nodeName=="polygon"){y=!0;var h=parseFloat(i.ClonedElement.getAttribute("x")),c=parseFloat(i.ClonedElement.getAttribute("y")),a=parseFloat(i.ClonedElement.getAttribute("height")),v=parseFloat(i.ClonedElement.getAttribute("width")),p,w={X:h,Y:c+a/2},b={X:h+v/2,Y:c},k={X:h+v,Y:c+a/2},d={X:h+v/2,Y:c+a};p=w.X+","+w.Y+"  "+b.X+","+b.Y+"  "+k.X+","+k.Y+"  "+d.X+","+d.Y;r.setAttribute("points",p);r.setAttribute("x",parseFloat(r.getAttribute("x"))+u);r.setAttribute("y",parseFloat(r.getAttribute("y"))+f)}else if(r.nodeName=="circle")r.setAttribute("cx",parseFloat(r.getAttribute("cx"))+u),r.setAttribute("cy",parseFloat(r.getAttribute("cy"))+f),y=!0;else if(r.nodeName!="text"&&r.getAttribute("id")!="SelectionElement"&&r.nodeName!="line"&&r.nodeName!="g")r.setAttribute("x",parseFloat(r.getAttribute("x"))+u),r.setAttribute("y",parseFloat(r.getAttribute("y"))+f);else if(r.getAttribute("id")=="SelectionElement")r.setAttribute("x",parseFloat(r.getAttribute("x"))+u),r.setAttribute("y",parseFloat(r.getAttribute("y"))+f);else if(r.nodeName=="line")r.setAttribute("x1",parseFloat(r.getAttribute("x1"))+u),r.setAttribute("y1",parseFloat(r.getAttribute("y1"))+f),r.setAttribute("x2",parseFloat(r.getAttribute("x2"))+u),r.setAttribute("y2",parseFloat(r.getAttribute("y2"))+f);else if(r.nodeName=="g")for(j=0;j<$(r).children().length;j++)e=$(r).children()[j],e.nodeName=="line"&&(e.setAttribute("x1",parseFloat(e.getAttribute("x1"))+u),e.setAttribute("y1",parseFloat(e.getAttribute("y1"))+f),e.setAttribute("x2",parseFloat(e.getAttribute("x2"))+u),e.setAttribute("y2",parseFloat(e.getAttribute("y2"))+f));if(r.nodeName=="text")if(i.ClonedElement.id!="participant")for(r.setAttribute("x",parseFloat(r.getAttribute("x"))+u),r.setAttribute("y",parseFloat(r.getAttribute("y"))+f),l=0;l<$(r).children().length;l++)e=$(r).children()[l],e.setAttribute("x",parseFloat(e.getAttribute("x"))+u);else if(r.setAttribute("x",parseFloat(r.getAttribute("x"))+u),r.setAttribute("y",parseFloat(r.getAttribute("y"))+f),g=parseFloat(r.getAttribute("x")),nt=parseFloat(r.getAttribute("y")),o){var it=parseFloat(o.getAttribute("height")),rt="-90  "+g+","+nt+" ",tt=wraptorect(r,o,0,.5,"Participant",i),ut="10 "+it/2;tt.setAttribute("transform","translate("+ut+") rotate("+rt+")");tt.setAttribute("text-anchor","middle")}}i.isElementMoved=!0;i.currentX=n.offsetX;i.currentY=n.offsetY}else deselectElement(n,t)}):deselectElement(n,t)}function setLaneBorderBasedOnElementPosition(n,t){var u=parseFloat(n.getAttribute("x")),f=parseFloat(n.getAttribute("y")),e=!1,i,r;if(t.LaneElement!=null){var o=parseFloat(t.LaneElement.getAttribute("x")),s=parseFloat(t.LaneElement.getAttribute("y")),h=parseFloat(t.LaneElement.getAttribute("height")),c=parseFloat(t.LaneElement.getAttribute("width"));if(u>=o&&u<=o+c&&f>=s&&f<=s+h)e=!0;else{for(r=0;r<t.LaneElement.childNodes.length;r++)if(t.LaneElement.childNodes[r].id=="MainElement"){t.LaneElement.childNodes[r].setAttribute("stroke-width",1);t.LaneElement.childNodes[r].setAttribute("stroke","Black");break}t.LaneElement=null}}if(!e)for(i=0;i<t.svgElement.childNodes.length;i++)if(t.svgElement.childNodes[i].id=="lane"){var l=parseFloat(t.svgElement.childNodes[i].getAttribute("x")),a=parseFloat(t.svgElement.childNodes[i].getAttribute("y")),h=parseFloat(t.svgElement.childNodes[i].getAttribute("height")),c=parseFloat(t.svgElement.childNodes[i].getAttribute("width"));if(u>=l&&u<=l+c&&f>=a&&f<=a+h){for(t.LaneElement=t.svgElement.childNodes[i],r=0;r<t.svgElement.childNodes[i].childNodes.length;r++)if(t.svgElement.childNodes[i].childNodes[r].id=="MainElement"){t.svgElement.childNodes[i].childNodes[r].setAttribute("stroke-width",5);t.svgElement.childNodes[i].childNodes[r].setAttribute("stroke","#723837");break}break}}}function deselectElement(n,t){var i=angular.element(t).scope(),r,f,l,a,v,u,e,w;if(i.isMouseDown=!1,i.selectedElement&&i.selectedElement!=0&&i.ClonedElement!=null){setLaneBorderBasedOnElementPosition(i.ClonedElement,i);i.ClonedElement.removeAttributeNS(null,"style");i.svgElement.removeAttributeNS(null,"onmousemove");i.svgElement.removeAttributeNS(null,"onmouseup");var o=parseFloat(i.ClonedElement.getAttribute("x")),s=parseFloat(i.ClonedElement.getAttribute("y")),y=i.objData.lstShapes[i.indexofResizerElement].Left,p=i.objData.lstShapes[i.indexofResizerElement].Top,h=y-o,c=p-s;if((isElementInsideTheLane(i.ClonedElement,i)||i.ClonedElement.id=="participant")&&(h>10||h<-10||c>10||c<-10)){for(removeResizerAroundElement(i),i.selectedElement.setAttribute("x",o),i.selectedElement.setAttribute("y",s),i.selectedElement.setAttribute("height",parseFloat(i.ClonedElement.getAttribute("height"))),i.selectedElement.setAttribute("width",parseFloat(i.ClonedElement.getAttribute("width"))),r=0;r<i.selectedElement.childNodes.length;r++)if(i.selectedElement.childNodes[r].nodeName=="rect"||i.selectedElement.childNodes[r].nodeName=="polygon"||i.selectedElement.childNodes[r].nodeName=="image")i.selectedElement.childNodes[r].setAttribute("x",parseFloat(i.ClonedElement.childNodes[r].getAttribute("x"))),i.selectedElement.childNodes[r].setAttribute("y",parseFloat(i.ClonedElement.childNodes[r].getAttribute("y"))),i.selectedElement.childNodes[r].setAttribute("height",parseFloat(i.ClonedElement.childNodes[r].getAttribute("height"))),i.selectedElement.childNodes[r].setAttribute("width",parseFloat(i.ClonedElement.childNodes[r].getAttribute("width"))),i.selectedElement.childNodes[r].nodeName=="polygon"&&i.selectedElement.childNodes[r].setAttribute("points",i.ClonedElement.childNodes[r].getAttribute("points"));else if(i.selectedElement.childNodes[r].nodeName=="circle")i.selectedElement.childNodes[r].setAttribute("cx",parseFloat(i.ClonedElement.childNodes[r].getAttribute("cx"))),i.selectedElement.childNodes[r].setAttribute("cy",parseFloat(i.ClonedElement.childNodes[r].getAttribute("cy"))),i.selectedElement.childNodes[r].setAttribute("r",parseFloat(i.ClonedElement.childNodes[r].getAttribute("r")));else if(i.selectedElement.childNodes[r].nodeName=="text"){if(i.selectedElement.childNodes[r].setAttribute("x",parseFloat(i.ClonedElement.childNodes[r].getAttribute("x"))),i.selectedElement.childNodes[r].setAttribute("y",parseFloat(i.ClonedElement.childNodes[r].getAttribute("y"))),i.selectedElement.childNodes[r].childNodes.length>0)for(f=0;f<i.selectedElement.childNodes[r].childNodes.length;f++)i.selectedElement.childNodes[r].childNodes[f].nodeName=="tspan"&&i.selectedElement.childNodes[r].childNodes[f].setAttribute("x",parseFloat(i.ClonedElement.childNodes[r].childNodes[f].getAttribute("x")))}else if(i.selectedElement.childNodes[r].nodeName=="line")i.selectedElement.childNodes[r].setAttribute("x1",parseFloat(i.ClonedElement.childNodes[r].getAttribute("x1"))),i.selectedElement.childNodes[r].setAttribute("y1",parseFloat(i.ClonedElement.childNodes[r].getAttribute("y1"))),i.selectedElement.childNodes[r].setAttribute("x2",parseFloat(i.ClonedElement.childNodes[r].getAttribute("x2"))),i.selectedElement.childNodes[r].setAttribute("y2",parseFloat(i.ClonedElement.childNodes[r].getAttribute("y2")));else if(i.selectedElement.childNodes[r].nodeName=="g")for(u=0;u<i.selectedElement.childNodes[r].childNodes.length;u++)i.selectedElement.childNodes[r].childNodes[u].nodeName=="line"&&(i.selectedElement.childNodes[r].childNodes[u].setAttribute("x1",parseFloat(i.ClonedElement.childNodes[r].childNodes[u].getAttribute("x1"))),i.selectedElement.childNodes[r].childNodes[u].setAttribute("y1",parseFloat(i.ClonedElement.childNodes[r].childNodes[u].getAttribute("y1"))),i.selectedElement.childNodes[r].childNodes[u].setAttribute("x2",parseFloat(i.ClonedElement.childNodes[r].childNodes[u].getAttribute("x2"))),i.selectedElement.childNodes[r].childNodes[u].setAttribute("y2",parseFloat(i.ClonedElement.childNodes[r].childNodes[u].getAttribute("y2"))));if(i.svgElement.removeChild(i.ClonedElement,!1),i.ClonedElement=null,l=parseFloat(i.selectedElement.getAttribute("x"))-i.objData.lstShapes[i.indexofResizerElement].Left,a=parseFloat(i.selectedElement.getAttribute("y"))-i.objData.lstShapes[i.indexofResizerElement].Top,angular.forEach(i.selectedElement.childNodes,function(n){n.nodeName=="text"&&(i.objData.lstShapes[i.indexofResizerElement].LabelLeft=parseFloat(n.getAttribute("x")),i.objData.lstShapes[i.indexofResizerElement].LabelTop=parseFloat(n.getAttribute("y")))}),dx=n.offsetX-i.currentX,dy=n.offsetY-i.currentY,i.isElementMoved){if(i.objData.lstShapes[i.indexofResizerElement].Left=parseFloat(i.selectedElement.getAttribute("x")),i.objData.lstShapes[i.indexofResizerElement].Top=parseFloat(i.selectedElement.getAttribute("y")),i.objData.lstShapes[i.indexofResizerElement].Height=parseFloat(i.selectedElement.getAttribute("height")),i.objData.lstShapes[i.indexofResizerElement].Width=parseFloat(i.selectedElement.getAttribute("width")),i.objData.lstShapes[i.indexofResizerElement].ShapeType=="participant")for(v=i.objData.lstShapes[i.indexofResizerElement].processRef,UdjustCoordinatesForChildElementsOfParticipant(l,a,v,i),RedrawingElementsAndEdges(i),u=0;u<i.svgElement.childNodes.length;u++)if(i.svgElement.childNodes[u].nodeName!="defs"&&i.objData.lstShapes[i.indexofResizerElement].Left==parseFloat(i.svgElement.childNodes[u].getAttribute("x"))&&i.objData.lstShapes[i.indexofResizerElement].Top==parseFloat(i.svgElement.childNodes[u].getAttribute("y"))&&i.objData.lstShapes[i.indexofResizerElement].Height==parseFloat(i.svgElement.childNodes[u].getAttribute("height"))&&i.objData.lstShapes[i.indexofResizerElement].Width==parseFloat(i.svgElement.childNodes[u].getAttribute("width"))){generateSelectionRectangleDynamically(i.svgElement.childNodes[u],i);i.selectedElement=i.svgElement.childNodes[u];i.selectedElemForResize=i.selectedElement;break}ResetlaneStrokeWidth(i);i.selectedShape&&i.selectedShape.ShapeType!="participant"&&(i.LaneElement!=null&&i.PrevlaneElement!=null?(e=!1,parseFloat(i.PrevlaneElement.getAttribute("x"))==parseFloat(i.LaneElement.getAttribute("x"))&&parseFloat(i.PrevlaneElement.getAttribute("y"))==parseFloat(i.LaneElement.getAttribute("y"))&&parseFloat(i.PrevlaneElement.getAttribute("height"))==parseFloat(i.LaneElement.getAttribute("height"))&&parseFloat(i.PrevlaneElement.getAttribute("width"))==parseFloat(i.LaneElement.getAttribute("width"))&&(e=!0),e||RemoveAndAddnodeInThelaneShapeModel(i.PrevlaneElement,i.LaneElement,i),i.PrevlaneElement=null,i.LaneElement=null):i.LaneElement!=null&&i.PrevlaneElement==null?(RemoveAndAddnodeInThelaneShapeModel(i.PrevlaneElement,i.LaneElement,i),i.LaneElement=null):i.LaneElement==null&&i.PrevlaneElement!=null&&(RemoveAndAddnodeInThelaneShapeModel(i.PrevlaneElement,i.LaneElement,i),i.PrevlaneElement=null));i.selectedElement.id!="message"&&ResetEdgePoints(i.selectedElement,w,i)}GenerateBoundsDynamicallyToElement(i.selectedElement,!1,i);i.selectedElement=0}else i.svgElement.removeChild(i.ClonedElement,!1),ResetlaneStrokeWidth(i),i.ClonedElement=null}i.selectedElement&&i.selectedElement!=0&&(i.svgElement.removeAttributeNS(null,"onmousemove"),i.svgElement.removeAttributeNS(null,"onmouseup"));ResetlaneStrokeWidth(i)}function ResetlaneStrokeWidth(n){if(n&&n.LaneElement!=null)for(var t=0;t<n.LaneElement.childNodes.length;t++)if(n.LaneElement.childNodes[t].id=="MainElement"){n.LaneElement.childNodes[t].setAttribute("stroke-width",1);n.LaneElement.childNodes[t].setAttribute("stroke","Black");break}}function isElementInsideTheLane(n,t){for(var r=parseFloat(n.getAttribute("x")),u=parseFloat(n.getAttribute("y")),f=!1,i=0;i<t.objData.lstShapes.length;i++)if(t.objData.lstShapes[i].ShapeType=="lane"&&t.objData.lstShapes[i].Left<=r&&t.objData.lstShapes[i].Left+t.objData.lstShapes[i].Width>=r&&t.objData.lstShapes[i].Top<=u&&t.objData.lstShapes[i].Top+t.objData.lstShapes[i].Height>=u){f=!0;break}return f}function RemoveAndAddnodeInThelaneShapeModel(n,t,i){for(var u,f,r=0;r<i.objData.lstShapes.length;r++)if(i.objData.lstShapes[r].ShapeType=="lane"){if(n!=null&&-.1<i.objData.lstShapes[r].Left-parseFloat(n.getAttribute("x"))&&i.objData.lstShapes[r].Left-parseFloat(n.getAttribute("x"))<.1&&-.1<i.objData.lstShapes[r].Top-parseFloat(n.getAttribute("y"))&&i.objData.lstShapes[r].Top-parseFloat(n.getAttribute("y"))<.1&&-.1<i.objData.lstShapes[r].Height-parseFloat(n.getAttribute("height"))&&i.objData.lstShapes[r].Height-parseFloat(n.getAttribute("height"))<.1&&-.1<i.objData.lstShapes[r].Width-parseFloat(n.getAttribute("width"))&&i.objData.lstShapes[r].Width-parseFloat(n.getAttribute("width"))<.1)for(u=0;u<i.objData.lstShapes[r].ShapeModel.Elements.length;u++)if(i.objData.lstShapes[r].ShapeModel.Elements[u].Value==i.objData.lstShapes[i.indexofResizerElement].Id){i.objData.lstShapes[r].ShapeModel.Elements.splice(u,1);break}t!=null&&-.1<i.objData.lstShapes[r].Left-parseFloat(t.getAttribute("x"))&&i.objData.lstShapes[r].Left-parseFloat(t.getAttribute("x"))<.1&&-.1<i.objData.lstShapes[r].Top-parseFloat(t.getAttribute("y"))&&i.objData.lstShapes[r].Top-parseFloat(t.getAttribute("y"))<.1&&-.1<i.objData.lstShapes[r].Height-parseFloat(t.getAttribute("height"))&&i.objData.lstShapes[r].Height-parseFloat(t.getAttribute("height"))<.1&&-.1<i.objData.lstShapes[r].Width-parseFloat(t.getAttribute("width"))&&i.objData.lstShapes[r].Width-parseFloat(t.getAttribute("width"))<.1&&(f={dictAttributes:{},Elements:[],Children:[],Name:"flowNodeRef",prefix:null,Value:i.objData.lstShapes[i.indexofResizerElement].Id},i.objData.lstShapes[r].ShapeModel.Elements.push(f),i.objData.lstShapes[i.indexofResizerElement].processRef=i.objData.lstShapes[r].processRef,i.SelectedElementLane=t)}}function clearShapes(n){for(var t=0;t<n.svgElement.childNodes.length;t++)if(n.svgElement.childNodes[t].nodeName!="defs")n.svgElement.removeChild(n.svgElement.childNodes[t]),t--;else if(n.svgElement.childNodes.length==1)break}function RedrawingElementsAndEdges(n){clearShapes(n);n.FilterTheElementsBasedOnTypeAndLoadShapes(n.objData.lstShapes)}function UdjustCoordinatesForChildElementsOfParticipant(n,t,i,r){for(var f,o,s,e,h,c,u=0;u<r.objData.lstShapes.length;u++)if(r.objData.lstShapes[u].ShapeType!="participant"&&r.objData.lstShapes[u].processRef==i)if(r.objData.lstShapes[u].ShapeName=="BPMNEdge"){if(r.objData.lstShapes[u].lstWayPoints){for(f=0;f<r.objData.lstShapes[u].lstWayPoints.length;f++)r.objData.lstShapes[u].lstWayPoints[f].Left=r.objData.lstShapes[u].lstWayPoints[f].Left+n,r.objData.lstShapes[u].lstWayPoints[f].Top=r.objData.lstShapes[u].lstWayPoints[f].Top+t;r.objData.lstShapes[u].LabelLeft=r.objData.lstShapes[u].LabelLeft+n;r.objData.lstShapes[u].LabelTop=r.objData.lstShapes[u].LabelTop+t}}else r.objData.lstShapes[u].ShapeName=="BPMNShape"&&(r.objData.lstShapes[u].Left=r.objData.lstShapes[u].Left+n,r.objData.lstShapes[u].Top=r.objData.lstShapes[u].Top+t,r.objData.lstShapes[u].LabelLeft=r.objData.lstShapes[u].LabelLeft+n,r.objData.lstShapes[u].LabelTop=r.objData.lstShapes[u].LabelTop+t);for(u=0;u<r.objData.lstShapes.length;u++)r.objData.lstShapes[u].ShapeName=="BPMNEdge"&&(o=GetElementProcessIdorElementBasedOnIdorDeleteElement(r.objData.lstShapes[u].SourceElement,r,"Element"),s=GetElementProcessIdorElementBasedOnIdorDeleteElement(r.objData.lstShapes[u].TargetElement,r,"Element"),o.processRef!=s.processRef&&(o.processRef==i||s.processRef==i)&&(e=GetEdgeWayPointsForDottedLine(o,s),e=setShapeNameToWayPoints(e),(o.ShapeType=="textAnnotation"||s.ShapeType=="textAnnotation")&&(h=e.length,e.length>2&&(c=h-2,e.splice(1,c))),r.objData.lstShapes[u].lstWayPoints=e))}function ResetEdgePoints(n,t,i){var f,e,u,r,o;if(t||typeof t!="undefined")f=0,e=-t,u=n;else for(f=parseFloat(n.getAttribute("x"))-parseFloat(i.selectedElemstartLeft),e=parseFloat(n.getAttribute("y"))-parseFloat(i.selectedElemstartTop),r=0;r<i.objData.lstShapes.length;r++)if(n.firstChild.nodeName=="circle"){if(parseFloat(n.getAttribute("x"))==i.objData.lstShapes[r].Left&&i.objData.lstShapes[r].Top==parseFloat(n.getAttribute("y"))){u=i.objData.lstShapes[r];break}}else if(parseFloat(n.getAttribute("x"))==i.objData.lstShapes[r].Left&&i.objData.lstShapes[r].Top==parseFloat(n.getAttribute("y"))){u=i.objData.lstShapes[r];break}o=!1;u.processRef==i.objData.DefaultProcessId&&(o=!0);resetEdgePointsForSelectedShape(u,f,e,i,t)}function resetEdgePointsForSelectedShape(n,t,i,r,u){var o,s,e,h,c,f;if(n!=undefined){if(o=[],s=[],o=getSourcePointsofElement(n,r),o.length>0)for(e=0;e<o.length;e++){for(h=null,c=null,f=0;f<r.objData.lstShapes.length;f++)r.objData.lstShapes[f].Id==o[e].SourceElement?h=r.objData.lstShapes[f]:r.objData.lstShapes[f].Id==o[e].TargetElement&&(c=r.objData.lstShapes[f]);UpdateEdgeBound1(!1,o[e],t,i,h,c,r)}if(s=getTargetPointsofElement(n,r),s.length>0)for(e=0;e<s.length;e++){for(h=null,c=null,f=0;f<r.objData.lstShapes.length;f++)r.objData.lstShapes[f].Id==s[e].SourceElement?h=r.objData.lstShapes[f]:r.objData.lstShapes[f].Id==s[e].TargetElement&&(c=r.objData.lstShapes[f]);UpdateEdgeBound1(!0,s[e],t,i,h,c,r)}u||ReDrawingEdges(r)}}function getTargetPointsofElement(n,t){for(var e,o,s,f=[],i=0;i<t.objData.lstShapes.length;i++)if(n.Id==t.objData.lstShapes[i].TargetElement){if(isValidEdge=!0,t.objData.lstShapes[i].ShapeType!="association"&&t.objData.lstShapes[i].ShapeType!="dataOutputAssociation"&&t.objData.lstShapes[i].ShapeType!="dataInputAssociation"){var h=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[i].SourceElement,t,"processId"),r=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[i].SourceElement,t,"Element"),u=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[i].TargetElement,t,"Element");h==n.processRef?t.objData.lstShapes[i].ShapeType!="sequenceFlow"&&t.objData.lstShapes[i].ShapeType!="association"&&(t.objData.lstShapes[i].MessageReference!=""&&t.objData.lstShapes[i].MessageVisibleKind!=""&&(e=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[i].MessageReference,t,"Delete"),t.objData.lstShapes[i].MessageReference="",t.objData.lstShapes[i].MessageVisibleKind="",removeElementFromSvg(e,t)),(u.ShapeType=="startEvent"||r.ShapeType=="endEvent"||u.ShapeType=="endEvent"||r.ShapeType=="startEvent")&&t.objData.lstShapes[i].ShapeType!="sequenceFlow"?(t.objData.lstShapes.splice(i,1),i--,DisplayMessage(r,u),isValidEdge=!1):(t.objData.lstShapes[i].ShapeType="sequenceFlow",EdgeShapeModel={dictAttributes:{name:t.objData.lstShapes[i].Text,id:t.objData.lstShapes[i].ShapeModel.dictAttributes.id,sourceRef:t.objData.lstShapes[i].SourceElement,targetRef:t.objData.lstShapes[i].TargetElement},Elements:[],Children:[],Name:"sequenceFlow",prefix:null,Value:""},t.objData.lstShapes[i].ShapeModel=EdgeShapeModel,t.objData.lstShapes[i].processRef=n.processRef)):t.objData.lstShapes[i].ShapeType!="messageFlow"&&t.objData.lstShapes[i].ShapeType!="association"&&r.ShapeType!="inclusiveGateway"&&r.ShapeType!="exclusiveGateway"&&r.ShapeType!="parallelGateway"&&r.ShapeType!="eventBasedGateway"&&u.ShapeType!="inclusiveGateway"&&u.ShapeType!="exclusiveGateway"&&u.ShapeType!="parallelGateway"&&u.ShapeType!="eventBasedGateway"?(r.ShapeType=="startEvent"||r.ShapeType=="endEvent"||u.ShapeType=="startEvent"||u.ShapeType=="endEvent")&&t.objData.lstShapes[i].ShapeType!="messageFlow"?(t.objData.lstShapes.splice(i,1),i--,DisplayMessage(r,u),isValidEdge=!1):(t.objData.lstShapes[i].ShapeType="messageFlow",o=t.objData.lstShapes[i].ShapeModel.dictAttributes.id,s={dictAttributes:{id:o,name:t.objData.lstShapes[i].Text,sourceRef:t.objData.lstShapes[i].SourceElement,targetRef:t.objData.lstShapes[i].TargetElement},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"docTypes",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"messageFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""},t.objData.lstShapes[i].ShapeModel=s,t.objData.CollaborationId==""&&(t.objData.CollaborationId="COLLABORATION_"+generateUUID()),t.objData.lstShapes[i].processRef=t.objData.CollaborationId):(r.ShapeType=="inclusiveGateway"||r.ShapeType=="exclusiveGateway"||r.ShapeType=="parallelGateway"||r.ShapeType=="eventBasedGateway"||u.ShapeType=="inclusiveGateway"||u.ShapeType=="exclusiveGateway"||u.ShapeType=="parallelGateway"||u.ShapeType=="eventBasedGateway")&&(alert("The gateway must not have any incoming or outgoing message"),t.objData.lstShapes.splice(i,1),i--,isValidEdge=!1)}isValidEdge&&f.push(t.objData.lstShapes[i])}return f}function getSourcePointsofElement(n,t){for(var o,s,h,f=!0,e=[],i=0;i<t.objData.lstShapes.length;i++)if(n.Id==t.objData.lstShapes[i].SourceElement){if(f=!0,t.objData.lstShapes[i].ShapeType!="association"&&t.objData.lstShapes[i].ShapeType!="dataOutputAssociation"&&t.objData.lstShapes[i].ShapeType!="dataInputAssociation"){var c=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[i].TargetElement,t,"processId"),r=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[i].SourceElement,t,"Element"),u=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[i].TargetElement,t,"Element");c==n.processRef?t.objData.lstShapes[i].ShapeType!="sequenceFlow"&&t.objData.lstShapes[i].ShapeType!="association"&&(t.objData.lstShapes[i].MessageReference!=""&&t.objData.lstShapes[i].MessageVisibleKind!=""&&(o=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[i].MessageReference,t,"Delete"),t.objData.lstShapes[i].MessageReference="",t.objData.lstShapes[i].MessageVisibleKind="",removeElementFromSvg(o,t)),(u.ShapeType=="startEvent"||r.ShapeType=="endEvent"||u.ShapeType=="endEvent"||r.ShapeType=="startEvent")&&t.objData.lstShapes[i].ShapeType!="sequenceFlow"?(t.objData.lstShapes.splice(i,1),i--,DisplayMessage(r,u),f=!1):(t.objData.lstShapes[i].ShapeType="sequenceFlow",EdgeShapeModel={dictAttributes:{id:t.objData.lstShapes[i].ShapeModel.dictAttributes.id,name:t.objData.lstShapes[i].Text,sourceRef:t.objData.lstShapes[i].SourceElement,targetRef:t.objData.lstShapes[i].TargetElement},Elements:[],Children:[],Name:"sequenceFlow",prefix:null,Value:""},t.objData.lstShapes[i].ShapeModel=EdgeShapeModel,t.objData.lstShapes[i].processRef=n.processRef)):t.objData.lstShapes[i].ShapeType!="messageFlow"&&t.objData.lstShapes[i].ShapeType!="association"&&r.ShapeType!="inclusiveGateway"&&r.ShapeType!="exclusiveGateway"&&r.ShapeType!="parallelGateway"&&r.ShapeType!="eventBasedGateway"&&u.ShapeType!="inclusiveGateway"&&u.ShapeType!="exclusiveGateway"&&u.ShapeType!="parallelGateway"&&u.ShapeType!="eventBasedGateway"?(u.ShapeType=="startEvent"||r.ShapeType=="endEvent"||u.ShapeType=="endEvent"||r.ShapeType=="startEvent")&&t.objData.lstShapes[i].ShapeType!="messageFlow"?(t.objData.lstShapes.splice(i,1),i--,DisplayMessage(r,u),f=!1):(t.objData.lstShapes[i].ShapeType="messageFlow",s=t.objData.lstShapes[i].ShapeModel.dictAttributes.id,h={dictAttributes:{id:s,name:t.objData.lstShapes[i].Text,sourceRef:t.objData.lstShapes[i].SourceElement,targetRef:t.objData.lstShapes[i].TargetElement},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"docTypes",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"messageFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""},t.objData.lstShapes[i].ShapeModel=h,t.objData.CollaborationId==""&&(t.objData.CollaborationId="COLLABORATION_"+generateUUID()),t.objData.lstShapes[i].processRef=t.objData.CollaborationId):(r.ShapeType=="inclusiveGateway"||r.ShapeType=="exclusiveGateway"||r.ShapeType=="parallelGateway"||r.ShapeType=="eventBasedGateway"||u.ShapeType=="inclusiveGateway"||u.ShapeType=="exclusiveGateway"||u.ShapeType=="parallelGateway"||u.ShapeType=="eventBasedGateway")&&(alert("The gateway must not have any incoming or outgoing message"),t.objData.lstShapes.splice(i,1),i--,f=!1)}f&&e.push(t.objData.lstShapes[i])}return e}function DisplayMessage(n,t){n.ShapeType=="startEvent"||t.ShapeType=="startEvent"?n.ShapeType=="startEvent"?alert("The Start Event must not have any outgoing messageflows"):alert("The Start Event must not have any incoming messageflows"):n.ShapeType=="endEvent"?alert("The End Event must not have any outgoing messageflows"):alert("The End Event must not have any incoming messageflows")}function GetElementProcessIdorElementBasedOnIdorDeleteElement(n,t,i){for(var u="",r=0;r<t.objData.lstShapes.length;r++)if(t.objData.lstShapes[r].Id==n){i=="processId"?u=t.objData.lstShapes[r].processRef:i=="Delete"?(u=t.objData.lstShapes[r],t.objData.lstShapes.splice(r,1)):u=t.objData.lstShapes[r];break}return u}function generateSelectionRectangleDynamically(n,t){var u=parseFloat(n.getAttribute("x")),f=parseFloat(n.getAttribute("y")),e=parseFloat(n.getAttribute("height")),o=parseFloat(n.getAttribute("width")),i=document.createElementNS(t.svgNS,"rect"),r;i.setAttributeNS(null,"id","SelectionElement");i.setAttributeNS(null,"rx",5);i.setAttributeNS(null,"ry",5);t.selectedElement!=0&&t.selectedElement.getAttribute("id")!="message"&&i.setAttribute("onmouseout","removehoverCircle(evt,this)");i.setAttributeNS(null,"x",u-15);i.setAttributeNS(null,"y",f-15);i.setAttributeNS(null,"height",e+30);i.setAttributeNS(null,"width",o+30);r="url(#selectionRect_"+t.$root.currentopenfile.file.FileName+")";i.setAttributeNS(null,"fill",r);i.setAttribute("stroke-width",.5);i.setAttributeNS(null,"stroke","black");n.insertBefore(i,n.childNodes[0])}function UpdateEdgeBound1(n,t,i,r,u,f,e){var s=t.lstWayPoints,h,c,o,a,v,l;if(e!=undefined&&s.length>1){for(h={Left:s[0].Left,Top:s[0].Top},c={Left:s[s.length-1].Left,Top:s[s.length-1].Top},n?(c.Left+=i,c.Top+=r):(h.Left+=i,h.Top+=r),o=GetEdgeWayPoints(u,f,h,c);o.length==2&&h.Left!=c.Left&&h.Top!=c.Top;)o=n?GetEdgeWayPointsForDottedLine(u,f):GetEdgeWayPointsForDottedLine(u,f);for((u.ShapeType=="textAnnotation"||f.ShapeType=="textAnnotation")&&(a=o.length,o.length>2&&(v=a-2,o.splice(1,v))),o=setShapeNameToWayPoints(o),l=0;l<e.objData.lstShapes.length;l++)if(e.objData.lstShapes[l].Id==t.Id){e.objData.lstShapes[l].lstWayPoints=o;break}}}function ReDrawingEdges(n){for(var t,i=0;i<n.svgElement.childNodes.length;i++)n.svgElement.childNodes[i].id=="line"&&(n.svgElement.removeChild(n.svgElement.childNodes[i]),i--);for(t=0;t<n.objData.lstShapes.length;t++)(n.objData.lstShapes[t].ShapeType=="sequenceFlow"||n.objData.lstShapes[t].ShapeType=="dataOutputAssociation"||n.objData.lstShapes[t].ShapeType=="association"||n.objData.lstShapes[t].ShapeType=="messageFlow"||n.objData.lstShapes[t].ShapeType=="dataInputAssociation")&&AddLineArray(n.svgElement,n.objData.lstShapes[t],n)}function GetEdgeWayPoints(n,t,i,r){return PointCorrection(n,i),PointCorrection(t,r),GetEdgeWayNewPoints(n,t,i,r)}function PointCorrection(n,t){IsSame(t.Left,n.Left)?t.Left=n.Left:IsSame(t.Left,n.Left+n.Width)&&(t.Left=n.Left+n.Width);IsSame(t.Top,n.Top)?t.Top=n.Top:IsSame(t.Top,n.Top+n.Height)&&(t.Top=n.Top+n.Height)}function IsSame(n,t){return Math.abs(n-t)<2}function GetEdgeWayNewPoints(n,t,i,r){var e=[];if(n!=null&&t!=null){var h=n.Top,c=n.Left,l=n.Width,a=n.Height,v=h+a/2,y=c+l/2,u=t.Top,f=t.Left,o=t.Width,s=t.Height;e.push(i);r.Left>i.Left?r.Top==u?CreateWaypointsPointsForTargetYvalEqualtoTop(i,r,e,h,c,l,a,u,f,s,o):r.Left==f+o?CreateWaypointsForTargetXvalEqualtoWidth(i,r,e,h,c,l,a,u,f,s,o):r.Top==u+s?CreateWaypointsPointsForTargetYvalEqualtoHeight(i,r,e,h,c,l,a,u,f,s,o):r.Left==f&&CreateWaypointsForTargetXvalEqualtoLeft(i,r,e,h,c,l,a,u,f,s,o):i.Left>r.Left&&(r.Top==u?CreateWaypointsPointsForTargetYvalEqualtoTop1(i,r,e,h,c,l,a,u,f,s,o):r.Left==f+o?CreateWaypointsForTargetXvalEqualtoWidth1(i,r,e,h,c,l,a,u,f,s,o):r.Top==u+s?CreateWaypointsPointsForTargetYvalEqualtoHeight1(i,r,e,h,c,l,a,u,f,s,o):r.Left==f&&CreateWaypointsForTargetXvalEqualtoLeft1(i,r,e,h,c,l,a,u,f,s,o));e.push(r)}return e}function CreateWaypointsPointsForTargetYvalEqualtoTop(n,t,i,r,u,f,e,o,s,h,c){var a,l;n.Left>u&&n.Left<u+f?n.Top==r?n.Top<t.Top?(a={Left:n.Left,Top:n.Top-20},i.push(a),s>u+f?(a={Left:t.Left,Top:n.Top-20},i.push(a)):(i.push({Left:u+f+20,Top:n.Top-20}),i.push({Left:u+f+20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left,Top:r+e+(o-(r+e))/2}))):s>u+f?(i.push({Left:n.Left,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20})):(i.push({Left:n.Left,Top:o+h+(r-(o+h))/2}),i.push({Left:s-20,Top:o+h+(r-(o+h))/2}),i.push({Left:s-20,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20})):n.Top==r+e&&(n.Top<t.Top?(i.push({Left:n.Left,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left,Top:r+e+(o-(r+e))/2})):s>u+f?(i.push({Left:n.Left,Top:n.Top+20}),i.push({Left:u+f+(s-(u+f))/2,Top:n.Top+20}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20})):(i.push({Left:n.Left,Top:n.Top+20}),i.push({Left:s+c+20,Top:n.Top+20}),i.push({Left:s+c+20,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20}))):n.Left==u?n.Top<t.Top?(i.push({Left:n.Left-20,Top:n.Top}),o>r+e?(i.push({Left:n.Left-20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left,Top:r+e+(o-(r+e))/2})):(i.push({Left:n.Left-20,Top:r-20}),i.push({Left:t.Left,Top:r-20}))):s>u+f?(i.push({Left:n.Left-20,Top:n.Top}),i.push({Left:n.Left-20,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20})):(l=s-20,l>u&&(l=u-20),i.push({Left:l,Top:n.Top}),i.push({Left:l,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20})):n.Left==u+f&&(n.Top<t.Top?i.push({Left:t.Left,Top:n.Top}):(s>u+f?(i.push({Left:u+f+(s-(u+f))/2,Top:n.Top}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top-20})):(i.push({Left:s+c+20,Top:n.Top}),i.push({Left:s+c+20,Top:t.Top-20})),i.push({Left:t.Left,Top:t.Top-20})))}function CreateWaypointsForTargetXvalEqualtoWidth(n,t,i,r,u,f,e,o,s,h,c){if(n.Left>u&&n.Left<u+f)if(n.Top==r)if(n.Top<t.Top)if(o>r+e-20){i.push({Left:n.Left,Top:n.Top-20});var l=t.Left+20;l<u+f&&(l=u+f+20);i.push({Left:l,Top:n.Top-20});i.push({Left:l,Top:t.Top})}else i.push({Left:n.Left,Top:r-20}),i.push({Left:t.Left+20,Top:r-20}),i.push({Left:t.Left+20,Top:t.Top});else r>o+h?(i.push({Left:n.Left,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left+20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left+20,Top:t.Top})):(i.push({Left:n.Left,Top:o-20}),i.push({Left:t.Left+20,Top:o-20}),i.push({Left:t.Left+20,Top:t.Top}));else n.Top==r+e&&(n.Top<t.Top?o>r+e?(i.push({Left:n.Left,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left+20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left+20,Top:t.Top})):(i.push({Left:n.Left,Top:o+h+20}),i.push({Left:s+c+20,Top:o+h+20}),i.push({Left:s+c+20,Top:t.Top})):n.Top>o+h?(i.push({Left:n.Left,Top:n.Top+20}),i.push({Left:t.Left+20,Top:n.Top+20}),i.push({Left:t.Left+20,Top:t.Top})):(i.push({Left:n.Left,Top:o+h+20}),i.push({Left:t.Left+20,Top:o+h+20}),i.push({Left:t.Left+20,Top:t.Top})));else n.Left==u?n.Top<t.Top?(i.push({Left:n.Left-20,Top:n.Top}),o>r+e?(i.push({Left:n.Left-20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left+20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left+20,Top:t.Top})):(i.push({Left:n.Left-20,Top:r-20}),i.push({Left:t.Left+20,Top:r-20}),i.push({Left:t.Left+20,Top:t.Top}))):(i.push({Left:n.Left-20,Top:n.Top}),r>o+h?(i.push({Left:n.Left-20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left+20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left+20,Top:t.Top})):(i.push({Left:n.Left-20,Top:o+h+20}),i.push({Left:t.Left+20,Top:o+h+20}),i.push({Left:t.Left+20,Top:t.Top}))):n.Left==u+f&&(n.Top<t.Top?n.Top<o?(i.push({Left:t.Left+20,Top:n.Top}),i.push({Left:t.Left+20,Top:t.Top})):(i.push({Left:u+f+(s-(u+f))/2,Top:n.Top}),i.push({Left:u+f+(s-(u+f))/2,Top:o-20}),i.push({Left:t.Left+20,Top:o-20}),i.push({Left:t.Left+20,Top:t.Top})):n.Top>o+h?(i.push({Left:t.Left+20,Top:n.Top}),i.push({Left:t.Left+20,Top:t.Top})):(i.push({Left:u+f+(s-(u+f))/2,Top:n.Top}),i.push({Left:u+f+(s-(u+f))/2,Top:o+h+20}),i.push({Left:t.Left+20,Top:o+h+20}),i.push({Left:t.Left+20,Top:t.Top})))}function CreateWaypointsPointsForTargetYvalEqualtoHeight(n,t,i,r,u,f,e,o,s,h,c){var a,l;n.Left>u&&n.Left<u+f?n.Top==r?n.Top<t.Top?(i.push({Left:n.Left,Top:n.Top-20}),s>u+f?(i.push({Left:u+f+(s-(u+f))/2,Top:n.Top-20}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(l=u-20,l>s&&(l=s-20),i.push({Left:l,Top:n.Top-20}),i.push({Left:l,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20}))):(i.push({Left:n.Left,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left,Top:o+h+(r-(o+h))/2})):n.Top==r+e&&(n.Top<t.Top?s>u+f?(i.push({Left:n.Left,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(i.push({Left:n.Left,Top:r+e+(o-(r+e))/2}),i.push({Left:s-20,Top:r+e+(o-(r+e))/2}),i.push({Left:s-20,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(i.push({Left:n.Left,Top:n.Top+20}),t.Left>u+f?i.push({Left:t.Left,Top:n.Top+20}):(i.push({Left:u+f+20,Top:n.Top+20}),i.push({Left:u+f+20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left,Top:o+h+(r-(o+h))/2})))):n.Left==u?n.Top<t.Top?s>u+f?(i.push({Left:n.Left-20,Top:n.Top}),a=t.Top+20,a<=r+e&&(a=r+e+20),i.push({Left:n.Left-20,Top:a}),i.push({Left:t.Left,Top:a})):(l=s-20,l>u&&(l=u-20),i.push({Left:l,Top:n.Top}),i.push({Left:l,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(i.push({Left:n.Left-20,Top:n.Top}),r>o+h?(i.push({Left:n.Left-20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left,Top:o+h+(r-(o+h))/2})):(i.push({Left:n.Left-20,Top:r+e+20}),i.push({Left:t.Left,Top:r+e+20}))):n.Left==u+f&&(n.Top<t.Top?s>u+f?(i.push({Left:u+f+(s-(u+f))/2,Top:n.Top}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(i.push({Left:s+c+20,Top:n.Top}),i.push({Left:s+c+20,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):i.push({Left:t.Left,Top:n.Top}))}function CreateWaypointsForTargetXvalEqualtoLeft(n,t,i,r,u,f,e,o,s){if(n.Left>u&&n.Left<u+f)if(n.Top==r)if(n.Top<t.Top)if(i.push({Left:n.Left,Top:n.Top-20}),s>u+f)i.push({Left:u+f+(s-(u+f))/2,Top:n.Top-20}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top});else{var h=u-20;h>s&&(h=s-20);i.push({Left:h,Top:n.Top-20});i.push({Left:h,Top:t.Top})}else i.push({Left:n.Left,Top:t.Top});else n.Top==r+e&&(n.Top<t.Top?i.push({Left:n.Left,Top:t.Top}):(i.push({Left:n.Left,Top:n.Top+20}),s>u+f?(i.push({Left:u+f+(s-(u+f))/2,Top:n.Top+20}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top})):(i.push({Left:u-20,Top:n.Top+20}),i.push({Left:u-20,Top:t.Top}))));else n.Left==u?n.Top<t.Top?(i.push({Left:n.Left-20,Top:n.Top}),t.Top>r+e?i.push({Left:n.Left-20,Top:t.Top}):(i.push({Left:n.Left-20,Top:r+e+20}),i.push({Left:u+f+(s-(u+f))/2,Top:r+e+20}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top}))):(i.push({Left:n.Left-20,Top:n.Top}),t.Top<r?i.push({Left:n.Left-20,Top:t.Top}):(i.push({Left:n.Left-20,Top:r-20}),i.push({Left:u+f+(s-(u+f))/2,Top:r-20}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top}))):n.Left==u+f&&(n.Top<t.Top?(i.push({Left:u+f+(s-(u+f))/2,Top:n.Top}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top})):(i.push({Left:u+f+(s-(u+f))/2,Top:n.Top}),i.push({Left:u+f+(s-(u+f))/2,Top:t.Top})))}function CreateWaypointsPointsForTargetYvalEqualtoTop1(n,t,i,r,u,f,e,o,s,h,c){if(n.Left>u&&n.Left<u+f)n.Top==r?n.Top<t.Top?(i.push({Left:n.Left,Top:n.Top-20}),t.Left<u?i.push({Left:t.Left,Top:n.Top-20}):(i.push({Left:u-20,Top:n.Top-20}),i.push({Left:u-20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left,Top:r+e+(o-(r+e))/2}))):n.Left>s+c?(i.push({Left:n.Left,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20})):(i.push({Left:n.Left,Top:r+e+(o-(r+e))/2}),i.push({Left:s+c+20,Top:r+e+(o-(r+e))/2}),i.push({Left:s+c+20,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20})):n.Top==r+e&&(n.Top<t.Top?(i.push({Left:n.Left,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left,Top:r+e+(o-(r+e))/2})):(i.push({Left:n.Left,Top:n.Top+20}),s+c<u?(i.push({Left:s+c+(u-(s+c))/2,Top:n.Top+20}),i.push({Left:s+c+(u-(s+c))/2,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20})):(i.push({Left:s-20,Top:n.Top+20}),i.push({Left:s-20,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20}))));else if(n.Left==u)n.Top<t.Top?i.push({Left:t.Left,Top:n.Top}):u>s+c?(i.push({Left:s+c+(u-(s+c))/2,Top:n.Top}),i.push({Left:s+c+(u-(s+c))/2,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20})):(i.push({Left:s-20,Top:n.Top}),i.push({Left:s-20,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20}));else if(n.Left==u+f)if(n.Top<t.Top)i.push({Left:n.Left+20,Top:n.Top}),t.Top>r+e?(i.push({Left:n.Left+20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left,Top:r+e+(o-(r+e))/2})):(i.push({Left:n.Left+20,Top:r-20}),i.push({Left:t.Left,Top:r-20}));else if(u>s+c)i.push({Left:n.Left+20,Top:n.Top}),i.push({Left:n.Left+20,Top:t.Top-20}),i.push({Left:t.Left,Top:t.Top-20});else{var l=u+f+20;l<s+c&&(l=s+c+20);i.push({Left:l,Top:n.Top});i.push({Left:l,Top:t.Top-20});i.push({Left:t.Left,Top:t.Top-20})}}function CreateWaypointsForTargetXvalEqualtoWidth1(n,t,i,r,u,f,e,o,s,h,c){if(n.Left>u&&n.Left<u+f)if(n.Top==r)if(n.Top<t.Top)if(i.push({Left:n.Left,Top:n.Top-20}),s+c<u){var l=s+c+(u-(s+c))/2;i.push({Left:l,Top:n.Top-20});i.push({Left:l,Top:t.Top})}else i.push({Left:u+f+20,Top:n.Top-20}),i.push({Left:u+f+20,Top:t.Top});else i.push({Left:n.Left,Top:t.Top});else n.Top==r+e&&(n.Top<t.Top?i.push({Left:n.Left,Top:t.Top}):(i.push({Left:n.Left,Top:n.Top+20}),u>s+c?(i.push({Left:s+c+(u-(s+c))/2,Top:n.Top+20}),i.push({Left:s+c+(u-(s+c))/2,Top:t.Top})):(i.push({Left:u+f+20,Top:n.Top+20}),i.push({Left:u+f+20,Top:t.Top}))));else n.Left==u?n.Top<t.Top?(i.push({Left:s+c+(u-(s+c))/2,Top:n.Top}),i.push({Left:s+c+(u-(s+c))/2,Top:t.Top})):(i.push({Left:s+c+(u-(s+c))/2,Top:n.Top}),i.push({Left:s+c+(u-(s+c))/2,Top:t.Top})):n.Left==u+f&&(n.Top<t.Top?(i.push({Left:n.Left+20,Top:n.Top}),t.Top>r+e?i.push({Left:n.Left+20,Top:t.Top}):(i.push({Left:n.Left+20,Top:r+e+20}),i.push({Left:s+c+(u-(s+c))/2,Top:r+e+20}),i.push({Left:s+c+(u-(s+c))/2,Top:t.Top}))):(i.push({Left:n.Left+20,Top:n.Top}),n.Top>o+h?i.push({Left:n.Left+20,Top:t.Top}):(i.push({Left:n.Left+20,Top:r-20}),i.push({Left:s+c+(u-(s+c))/2,Top:r-20}),i.push({Left:s+c+(u-(s+c))/2,Top:t.Top}))))}function CreateWaypointsPointsForTargetYvalEqualtoHeight1(n,t,i,r,u,f,e,o,s,h,c){var l,a;n.Left>u&&n.Left<u+f?n.Top==r?n.Top<t.Top?(i.push({Left:n.Left,Top:n.Top-20}),u>s+c?(i.push({Left:s+c+(u-(s+c))/2,Top:n.Top-20}),i.push({Left:s+c+(u-(s+c))/2,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(l=u+f+20,l<s+c&&(l=s+c+20),i.push({Left:l,Top:n.Top-20}),i.push({Left:l,Top:t.Top+20}),i.push({Left:t.Top,Top:t.Top+20}))):(i.push({Left:n.Left,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left,Top:o+h+(r-(o+h))/2})):n.Top==r+e&&(n.Top<t.Top?u>s+c?(i.push({Left:n.Left,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(i.push({Left:n.Left,Top:r+e+(o-(r+e))/2}),i.push({Left:s+c+20,Top:r+e+(o-(r+e))/2}),i.push({Left:s+c+20,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(i.push({Left:n.Left,Top:n.Top+20}),u>t.Left?i.push({Left:t.Left,Top:n.Top+20}):(i.push({Left:u-20,Top:n.Top+20}),i.push({Left:u-20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left,Top:o+h+(r-(o+h))/2})))):n.Left==u?n.Top<t.Top?u>s+c?(i.push({Left:s+c+(u-(s+c))/2,Top:n.Top}),i.push({Left:s+c+(u-(s+c))/2,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(i.push({Left:s-20,Top:n.Top}),i.push({Left:s-20,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):i.push({Left:t.Left,Top:n.Top}):n.Left==u+f&&(n.Top<t.Top?n.Left>s+c?(i.push({Left:n.Left+20,Top:n.Top}),a=t.Top+20,a<r+e&&(a=r+e+20),i.push({Left:n.Left+20,Top:a}),i.push({Left:t.Left,Top:a})):(i.push({Left:s+c+20,Top:n.Top}),i.push({Left:s+c+20,Top:t.Top+20}),i.push({Left:t.Left,Top:t.Top+20})):(i.push({Left:n.Left+20,Top:n.Top}),t.Top<r?(i.push({Left:n.Left+20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left,Top:o+h+(r-(o+h))/2})):(i.push({Left:n.Left+20,Top:r+e+20}),i.push({Left:t.Left,Top:r+e+20}))))}function CreateWaypointsForTargetXvalEqualtoLeft1(n,t,i,r,u,f,e,o,s,h,c){var l;n.Left>u&&n.Left<u+f?n.Top==r?n.Top<t.Top?o>n.Top?(i.push({Left:n.Left,Top:n.Top-20}),l=t.Left-20,l>u&&(l=u-20),i.push({Left:l,Top:n.Top-20}),i.push({Left:l,Top:t.Top})):(i.push({Left:n.Left,Top:o-20}),i.push({Left:t.Left-20,Top:o-20}),i.push({Left:t.Left-20,Top:t.Top})):n.Top>o+h?(i.push({Left:n.Left,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left-20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left-20,Top:t.Top})):(i.push({Left:n.Left,Top:o-20}),i.push({Left:t.Left-20,Top:o-20}),i.push({Left:t.Left-20,Top:t.Top})):n.Top==r+e&&(n.Top<t.Top?o>n.Top?(i.push({Left:n.Left,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left-20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left-20,Top:t.Top})):(i.push({Left:n.Left,Top:o+h+20}),i.push({Left:t.Left-20,Top:o+h+20}),i.push({Left:t.Left-20,Top:t.Top})):n.Top>o+h?(i.push({Left:n.Left,Top:n.Top+20}),l=t.Left-20,l>u&&(l=u-20),i.push({Left:l,Top:n.Top+20}),i.push({Left:l,Top:t.Top})):(i.push({Left:n.Left,Top:o+h+20}),i.push({Left:t.Left-20,Top:o+h+20}),i.push({Left:t.Left-20,Top:t.Top}))):n.Left==u?n.Top<t.Top?o>n.Top?(i.push({Left:t.Left-20,Top:n.Top}),i.push({Left:t.Left-20,Top:t.Top})):(i.push({Left:s+c+(u-(s+c))/2,Top:n.Top}),i.push({Left:s+c+(u-(s+c))/2,Top:o-20}),i.push({Left:t.Left-20,Top:o-20}),i.push({Left:t.Left-20,Top:t.Top})):n.Top>o+h?(i.push({Left:t.Left-20,Top:n.Top}),i.push({Left:t.Left-20,Top:t.Top})):(i.push({Left:s+c+(u-(s+c))/2,Top:n.Top}),i.push({Left:s+c+(u-(s+c))/2,Top:o+h+20}),i.push({Left:t.Left-20,Top:o+h+20}),i.push({Left:t.Left-20,Top:t.Top})):n.Left==u+f&&(n.Top<t.Top?(i.push({Left:n.Left+20,Top:n.Top}),o>r+e?(i.push({Left:n.Left+20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left-20,Top:r+e+(o-(r+e))/2}),i.push({Left:t.Left-20,Top:t.Top})):(i.push({Left:n.Left+20,Top:o+h+20}),i.push({Left:t.Left-20,Top:o+h+20}),i.push({Left:t.Left-20,Top:t.Top}))):(i.push({Left:n.Left+20,Top:n.Top}),r>o+h?(i.push({Left:n.Left+20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left-20,Top:o+h+(r-(o+h))/2}),i.push({Left:t.Left-20,Top:t.Top})):(i.push({Left:n.Left+20,Top:o-20}),i.push({Left:t.Left-20,Top:o-20}),i.push({Left:t.Left-20,Top:t.Top}))))}function checkShapeAlreadyPresentinListorNot(n,t){isPresent=!1;for(var i=0;i<n.length;i++)if(n[i].Id==t.Id){isPresent=!0;n.splice(i,1);break}return isPresent}function moveElementUsingKeyBoard(n,t,i){var e,s,r,f,it,rt,ft,u;if(n.selectedElemForResize&&parseFloat(n.selectedElemForResize.getAttribute("x"))+t>0&&parseFloat(n.selectedElemForResize.getAttribute("y"))+i>0){if(e=!1,n.objData.lstShapes[n.indexofResizerElement].ShapeType!="participant"){if(n.SelectedElementLane){var v=parseFloat(n.selectedElemForResize.getAttribute("x"))+t,y=parseFloat(n.selectedElemForResize.getAttribute("y"))+i,p=parseFloat(n.SelectedElementLane.getAttribute("x")),w=parseFloat(n.SelectedElementLane.getAttribute("y")),et=parseFloat(n.SelectedElementLane.getAttribute("height")),ot=parseFloat(n.SelectedElementLane.getAttribute("width"));v>p+40&&y>w&&y<w+et&&v<p+ot&&(e=!0)}}else e=!0;if(e){n.isDirty=!0;n.selectedElemForResize.setAttribute("x",parseFloat(n.selectedElemForResize.getAttribute("x"))+t);n.selectedElemForResize.setAttribute("y",parseFloat(n.selectedElemForResize.getAttribute("y"))+i);var b=!1,o="";for(s=0;s<$(n.selectedElemForResize).children().length;s++){if(r=$(n.selectedElemForResize).children()[s],r.getAttribute("id")=="MainElement"&&(o=r),r.nodeName=="polygon"){b=!0;var h=parseFloat(n.selectedElemForResize.getAttribute("x")),c=parseFloat(n.selectedElemForResize.getAttribute("y")),l=parseFloat(n.selectedElemForResize.getAttribute("height")),a=parseFloat(n.selectedElemForResize.getAttribute("width")),k,d={X:h,Y:c+l/2},g={X:h+a/2,Y:c},nt={X:h+a,Y:c+l/2},tt={X:h+a/2,Y:c+l};k=d.X+","+d.Y+"  "+g.X+","+g.Y+"  "+nt.X+","+nt.Y+"  "+tt.X+","+tt.Y;r.setAttribute("points",k);r.setAttribute("x",parseFloat(r.getAttribute("x"))+t);r.setAttribute("y",parseFloat(r.getAttribute("y"))+i)}else if(r.nodeName=="circle")r.setAttribute("cx",parseFloat(r.getAttribute("cx"))+t),r.setAttribute("cy",parseFloat(r.getAttribute("cy"))+i),b=!0;else if(r.nodeName!="text"&&r.getAttribute("id")!="SelectionElement"&&r.nodeName!="line"&&r.nodeName!="g")r.setAttribute("x",parseFloat(r.getAttribute("x"))+t),r.setAttribute("y",parseFloat(r.getAttribute("y"))+i);else if(r.getAttribute("id")=="SelectionElement")r.setAttribute("x",parseFloat(r.getAttribute("x"))+t),r.setAttribute("y",parseFloat(r.getAttribute("y"))+i);else if(r.nodeName=="line")r.setAttribute("x1",parseFloat(r.getAttribute("x1"))+t),r.setAttribute("y1",parseFloat(r.getAttribute("y1"))+i),r.setAttribute("x2",parseFloat(r.getAttribute("x2"))+t),r.setAttribute("y2",parseFloat(r.getAttribute("y2"))+i);else if(r.nodeName=="g")for(j=0;j<$(r).children().length;j++)f=$(r).children()[j],f.nodeName=="line"&&(f.setAttribute("x1",parseFloat(f.getAttribute("x1"))+t),f.setAttribute("y1",parseFloat(f.getAttribute("y1"))+i),f.setAttribute("x2",parseFloat(f.getAttribute("x2"))+t),f.setAttribute("y2",parseFloat(f.getAttribute("y2"))+i));if(r.nodeName=="text")if(n.selectedElemForResize.id!="participant")for(r.setAttribute("x",parseFloat(r.getAttribute("x"))+t),r.setAttribute("y",parseFloat(r.getAttribute("y"))+i),u=0;u<$(r).children().length;u++)f=$(r).children()[u],f.setAttribute("x",parseFloat(f.getAttribute("x"))+t);else if(r.setAttribute("x",parseFloat(r.getAttribute("x"))+t),r.setAttribute("y",parseFloat(r.getAttribute("y"))+i),it=parseFloat(r.getAttribute("x")),rt=parseFloat(r.getAttribute("y")),o){var st=parseFloat(o.getAttribute("height")),ht="-90  "+it+","+rt+" ",ut=wraptorect(r,o,0,.5,"Participant",n),ct="10 "+st/2;ut.setAttribute("transform","translate("+ct+") rotate("+ht+")");ut.setAttribute("text-anchor","middle")}}if(n.objData.lstShapes[n.indexofResizerElement]&&(n.objData.lstShapes[n.indexofResizerElement].Left=parseFloat(n.selectedElemForResize.getAttribute("x")),n.objData.lstShapes[n.indexofResizerElement].Top=parseFloat(n.selectedElemForResize.getAttribute("y")),n.objData.lstShapes[n.indexofResizerElement].Height=parseFloat(n.selectedElemForResize.getAttribute("height")),n.objData.lstShapes[n.indexofResizerElement].Width=parseFloat(n.selectedElemForResize.getAttribute("width"))),n.objData.lstShapes[n.indexofResizerElement].ShapeType=="participant"){for(ft=n.objData.lstShapes[n.indexofResizerElement].processRef,UdjustCoordinatesForChildElementsOfParticipant(t,i,ft,n),RedrawingElementsAndEdges(n),u=0;u<n.svgElement.childNodes.length;u++)if(n.svgElement.childNodes[u].nodeName!="defs"&&n.objData.lstShapes[n.indexofResizerElement].Left==parseFloat(n.svgElement.childNodes[u].getAttribute("x"))&&n.objData.lstShapes[n.indexofResizerElement].Top==parseFloat(n.svgElement.childNodes[u].getAttribute("y"))&&n.objData.lstShapes[n.indexofResizerElement].Height==parseFloat(n.svgElement.childNodes[u].getAttribute("height"))&&n.objData.lstShapes[n.indexofResizerElement].Width==parseFloat(n.svgElement.childNodes[u].getAttribute("width"))){generateSelectionRectangleDynamically(n.svgElement.childNodes[u],n);n.selectedElement=n.svgElement.childNodes[u];n.selectedElemForResize=n.selectedElement;break}}else resetEdgePointsForSelectedShape(n.objData.lstShapes[n.indexofResizerElement],t,i,n,undefined);removehovercirclefromsvgElement(n);removeResizerAroundElement(n);GenerateBoundsDynamicallyToElement(n.selectedElemForResize,!1,n)}}}function hoverOnElement(n,t){var i,r,f,a,u;if(i=n&&n!=null?angular.element(t).scope():t,i&&i.activeTab=="MAP"&&i.IsMapEditable&&!i.IsVersionDisplay&&i.ClonedElement==null){r="";i.sourceElementOnMouseHover!=null&&n!=null&&i.sourceElementOnMouseHover!=n.currentTarget.parentNode&&(i.targetElementOnMouseHover=n.currentTarget.parentNode);n!=null&&n.currentTarget.parentNode.getAttribute("id")!="resizergroup"?(i.hoverElement=n.currentTarget.parentNode,r=n.currentTarget.parentNode):r=i.hoverElement;i.ClonedLineElement!=null&&(i.targetElementForLine=r);var h=parseFloat(r.getAttribute("x")),c=parseFloat(r.getAttribute("y")),l=parseFloat(r.getAttribute("height")),v=parseFloat(r.getAttribute("width")),e,o,s=null;for(f=0;f<r.childNodes.length;f++)if(r.childNodes[f].getAttribute("id")=="MainElement"){s=r.childNodes[f];break}s.nodeName!="circle"&&i.hoverElement.id!="participant"?(e=h+v/2,o=c+l/2):i.hoverElement.id=="participant"?(e=h+20,o=c+l/2):(e=s.getAttribute("cx"),o=s.getAttribute("cy"));a=!1;removehovercirclefromsvgElement(i);a||(u=document.createElementNS(i.svgNS,"circle"),u.setAttributeNS(null,"id","hovercircle"),u.setAttributeNS(null,"cx",e),u.setAttributeNS(null,"cy",o),u.setAttributeNS(null,"r",6),u.setAttribute("onmousedown","selectoncircle(evt)"),u.setAttributeNS(null,"fill","gray"),u.setAttributeNS(null,"stroke","black"),i.svgElement.appendChild(u))}}function removehovercirclefromsvgElement(n){for(var t=0;t<n.svgElement.childNodes.length;t++)if(n.svgElement.childNodes[t].nodeName=="circle"&&n.svgElement.childNodes[t].getAttribute("id")=="hovercircle"){n.svgElement.removeChild(n.svgElement.childNodes[t]);break}}function removehoverCircle(n,t){var i=angular.element(t).scope(),f=n.offsetX,e=n.offsetY,u=null,r;if(i&&i.hoverElement!=null){for(r=0;r<i.hoverElement.childNodes.length;r++)if(i.hoverElement.childNodes[r].getAttribute("id")=="MainElement"){u=i.hoverElement.childNodes[r];break}if(u==null&&i.hoverElement.id=="MainElement"&&(u=i.hoverElement),u.nodeName!="circle"){var o=parseFloat(i.hoverElement.getAttribute("x")),s=parseFloat(i.hoverElement.getAttribute("y")),h=parseFloat(i.hoverElement.getAttribute("height")),c=parseFloat(i.hoverElement.getAttribute("width"));if(!(o+c>f)||!(f>o)||!(s+h>e)||!(e>s))for(i.sourceElementOnMouseHover!=null&&(i.targetElementOnMouseHover=null),i.targetElementForLine=null,r=i.svgElement.childNodes.length-1;r>0;r--)if(i.svgElement.childNodes[r].nodeName=="circle"&&i.svgElement.childNodes[r].getAttribute("id")=="hovercircle"){i.svgElement.removeChild(i.svgElement.childNodes[r]);break}}else{var a=parseFloat(u.getAttribute("cx")),v=parseFloat(u.getAttribute("cy")),l=parseFloat(u.getAttribute("r")),o=a-15,s=v-15,h=2*l,c=2*l;if(!(o+c>f)||!(f>o)||!(s+h>e)||!(e>s))for(i.sourceElementOnMouseHover!=null&&(i.targetElementOnMouseHover=null),i.targetElementForLine=null,r=0;r<i.svgElement.childNodes.length;r++)i.svgElement.childNodes[r].nodeName=="circle"&&i.svgElement.childNodes[r].getAttribute("id")=="hovercircle"&&(i.svgElement.removeChild(i.svgElement.childNodes[r]),r--)}}}function selectoncircle(n){var t=angular.element(n.currentTarget).scope();createDummyLine(t);t._previousPosition={Left:0,Top:0};setMouseEventsOnElement(t.svgElement,t)}function setMouseEventsOnElement(n,t){var i=n;t.sourceElementOnMouseHover=t.hoverElement;i.setAttributeNS(null,"onmousemove","movecursorfordrawingLine(evt)");i.setAttributeNS(null,"onmouseup","removeMouseMoveEvent(evt)")}function createDummyLine(n){var i=document.createElementNS(n.svgNS,"g"),t;i.setAttribute("id","dottedline");t=document.createElementNS(n.svgNS,"line");t.setAttribute("stroke-width",2);t.setAttribute("stroke-dasharray","5,5");t.setAttribute("x1",0);t.setAttribute("y1",0);t.setAttribute("x2",0);t.setAttribute("y2",0);t.setAttributeNS(null,"stroke","#3a3a3a");i.appendChild(t);n.svgElement.appendChild(i)}function movecursorfordrawingLine(n){var t=angular.element(n.currentTarget).scope(),h,r,u,f,o,s,i,e;if(t&&n.buttons==1){for(h=!1,r="",i=0;i<t.svgElement.childNodes.length;i++)if(t.svgElement.childNodes[i].id=="dottedline"){h=!0;r=i;break}if(t.sourceElementOnMouseHover!=null){for(u=null,i=0;i<t.sourceElementOnMouseHover.childNodes.length;i++)if(t.sourceElementOnMouseHover.childNodes[i].getAttribute("id")=="MainElement"){u=t.sourceElementOnMouseHover.childNodes[i];break}var c=parseFloat(u.getAttribute("x")),l=parseFloat(u.getAttribute("y")),a=parseFloat(u.getAttribute("height")),v=parseFloat(u.getAttribute("width"));if(u.nodeName=="circle"){var w=parseFloat(u.getAttribute("cx")),b=parseFloat(u.getAttribute("cy")),y=parseFloat(u.getAttribute("r"));c=w-15;l=b-15;a=2*y;v=2*y}if(o={Left:c,Top:l,Height:a,Width:v},t.targetElementOnMouseHover!=null&&t.svgElement.childNodes[r]&&t.svgElement.childNodes[r].childNodes&&t.svgElement.childNodes[r].childNodes.length>0){var k={Left:parseFloat(t.svgElement.childNodes[r].childNodes[0].getAttribute("x1")),Top:parseFloat(t.svgElement.childNodes[r].childNodes[0].getAttribute("y1"))},d={Left:n.offsetX,Top:n.offsetY},s={Left:parseFloat(t.targetElementOnMouseHover.getAttribute("x")),Top:parseFloat(t.targetElementOnMouseHover.getAttribute("y")),Height:parseFloat(t.targetElementOnMouseHover.getAttribute("height")),Width:parseFloat(t.targetElementOnMouseHover.getAttribute("width"))},p=UpdateTargetPoint(d,s,o,t);p!=undefined&&(f=GetEdgeWayPoints(o,s,k,p))}else t._previousPosition={Left:n.offsetX,Top:n.offsetY},s={Left:n.offsetX,Top:n.offsetY,Height:10,Width:10},f=GetEdgeWayPointsForDottedLine(o,s);if(r!=""&&f!=undefined){for(i=0;i<t.svgElement.childNodes[r].childNodes.length;i++)t.svgElement.childNodes[r].removeChild(t.svgElement.childNodes[r].childNodes[i]),i--;for(t.NewEdgeWayPoints=f,t.NewEdgeWayPoints=setShapeNameToWayPoints(t.NewEdgeWayPoints),i=0;i<f.length;i++)i<f.length-1&&(e=document.createElementNS(t.svgNS,"line"),e.setAttribute("id","line"),e.setAttribute("stroke-width",2),e.setAttribute("stroke-dasharray","5,5"),e.setAttribute("x1",f[i].Left),e.setAttribute("y1",f[i].Top),e.setAttribute("x2",f[i+1].Left),e.setAttribute("y2",f[i+1].Top),e.setAttributeNS(null,"stroke","#3a3a3a"),t.svgElement.childNodes[r].appendChild(e))}}t.currentX=n.offsetX;t.currentY=n.offsetY}else removeMouseMoveEvent(n)}function UpdateTargetPoint(n,t,i,r){var u=n,e=10,f,o;if(r._previousPosition.Left==0&&r._previousPosition.Top==0){r._previousPosition=n;return}if(null!=t)if(f=!1,IsLeftLimitReached(t,n,r,e))f?(u.Left=t.Left,u.Top=t.Top+t.Height/2):(u.Left=t.Left,u.Top=n.Top);else if(IsTopLimitReached(t,n,r,e))f?(u.Left=t.Left+t.Width/2,u.Top=t.Top):(u.Left=n.Left,u.Top=t.Top);else if(IsRightLimitReached(t,n,r,e))f?(u.Left=t.Left+t.Width,u.Top=t.Top+t.Height/2):(u.Left=t.Left+t.Width,u.Top=n.Top);else if(IsBottomLimitReached(t,n,r,e))f?(u.Left=t.Left+t.Width/2,u.Top=t.Top+t.Height):(u.Left=n.Left,u.Top=t.Top+t.Height);else if(o=!1,(u.Left==t.Left||u.Left==t.Left+t.Left)&&(u.Top=f?t.Top+t.Height/2:n.Top,o=!0),(u.Top==t.Top||u.Top==t.Top+t.Height)&&(u.Left=f?t.Left+t.Width/2:n.Left,o=!0),!o&&UpdateEndpoint(n,t,i,u))return u;return r._previousPosition=n,u}function IsLeftLimitReached(n,t,i,r){var u=!1,f=t.Left-n.Left;return f>=0&&n.Left>=i._previousPosition.Left-r&&(u=!0),u}function IsRightLimitReached(n,t,i,r){var u=!1,f=n.Left+n.Width-t.Left;return f>=0&&n.Left+n.Width<=i._previousPosition.Left+r&&(u=!0),u}function IsTopLimitReached(n,t,i,r){var u=!1,f=t.Top-n.Top;return f>=0&&i._previousPosition.Top-r<=n.Top&&(u=!0),u}function IsBottomLimitReached(n,t,i,r){var u=!1,f=n.Top+n.Height-t.Top;return f>=0&&n.Top+n.Height<=i._previousPosition.Top+r&&(u=!0),u}function UpdateEndpoint(n,t,i,r){if(null!=t&&i!=null){var f=i,u=t;if(u.Left<n.Left&&u.Top<n.Top&&u.Top+u.Height>n.Top&&u.Left+u.Width>n.Left)return f.Left+f.Width<u.Left?n.Left=u.Left:f.Left>u.Left+u.Width?n.Left=u.Left+u.Width:f.Top+f.Height<u.Top?n.Top=u.Top:f.Top>u.Top+u.Height&&(n.Top=u.Top+u.Height),this.targetPoint=n,r}}function GetEdgeWayPointsForDottedLine(n,t){var r=[],i;if(n!=null&&t!=null){var u=n.Top,f=n.Left,h=n.Width,o=n.Height,e=t.Top,s=t.Left,a=t.Width,v=t.Height,y=u+o/2,c=f+h/2,p=e+v/2,l=s+a/2,w=0;s>f+h+w?(i={Left:f+h,Top:y},r.push(i),i={Left:f+h+(s-(f+h))/2,Top:y},isPointNotFound(i,r)&&r.push(i),i={Left:f+h+(s-(f+h))/2,Top:p},isPointNotFound(i,r)&&r.push(i),i={Left:s,Top:p},isPointNotFound(i,r)&&r.push(i)):e>u+o+w?(i={Left:c,Top:u+o},r.push(i),i={Left:c,Top:u+o+(e-(u+o))/2},isPointNotFound(i,r)&&r.push(i),i={Left:l,Top:u+o+(e-(u+o))/2},isPointNotFound(i,r)&&r.push(i),i={Left:l,Top:e},isPointNotFound(i,r)&&r.push(i)):f>s+a+w?(i={Left:f,Top:y},r.push(i),i={Left:f-(f-(s+a))/2,Top:y},isPointNotFound(i,r)&&r.push(i),i={Left:f-(f-(s+a))/2,Top:p},isPointNotFound(i,r)&&r.push(i),i={Left:s+a,Top:p},isPointNotFound(i,r)&&r.push(i)):u>e+v+w?(i={Left:c,Top:u},r.push(i),i={Left:c,Top:u-(u-(e+v))/2},isPointNotFound(i,r)&&r.push(i),i={Left:l,Top:u-(u-(e+v))/2},isPointNotFound(i,r)&&r.push(i),i={Left:l,Top:e+v},isPointNotFound(i,r)&&r.push(i)):(r.push({Left:c,Top:u+o}),r.push({Left:c+(l-c),Top:u+o}),r.push({Left:l,Top:e}))}return r}function isPointNotFound(n,t){isNotFound=!0;for(var i=0;i<t.length;i++)if(t[i].Left==n.Left&&t[i].Top==n.Top){isNotFound=!1;break}return isNotFound}function removeMouseMoveEvent(n){var t=angular.element(n.currentTarget).scope(),c,l,it,g,v,b,nt,tt,rt,ut,ft,st,ht,ct,f,y,at,vt,yt,pt,i;if(n.currentTarget.removeAttributeNS(null,"onmousemove"),t.sourceElementOnMouseHover!=null&&t.targetElementOnMouseHover!=null){for(t.isDirty=!0,c=null,i=0;i<t.sourceElementOnMouseHover.childNodes.length;i++)if(t.sourceElementOnMouseHover.childNodes[i].getAttribute("id")=="MainElement"){c=t.sourceElementOnMouseHover.childNodes[i];break}for(l=null,i=0;i<t.targetElementOnMouseHover.childNodes.length;i++)if(t.targetElementOnMouseHover.childNodes[i].getAttribute("id")=="MainElement"){l=t.targetElementOnMouseHover.childNodes[i];break}var e="",o="",p="",d="",r="",u="";for(i=0;i<t.objData.lstShapes.length;i++)if(e==""||o=="")-.1<t.objData.lstShapes[i].Left-parseFloat(c.getAttribute("x"))&&t.objData.lstShapes[i].Left-parseFloat(c.getAttribute("x"))<.1&&-.1<t.objData.lstShapes[i].Top-parseFloat(c.getAttribute("y"))&&t.objData.lstShapes[i].Top-parseFloat(c.getAttribute("y"))<.1&&e==""&&(e=t.objData.lstShapes[i].Id,p=t.objData.lstShapes[i].processRef,r=t.objData.lstShapes[i]),-.1<t.objData.lstShapes[i].Left-parseFloat(l.getAttribute("x"))&&t.objData.lstShapes[i].Left-parseFloat(l.getAttribute("x"))<.1&&-.1<t.objData.lstShapes[i].Top-parseFloat(l.getAttribute("y"))&&t.objData.lstShapes[i].Top-parseFloat(l.getAttribute("y"))<.1&&o==""&&(o=t.objData.lstShapes[i].Id,d=t.objData.lstShapes[i].processRef,u=t.objData.lstShapes[i]),c.nodeName=="circle"&&e==""&&-.1<t.objData.lstShapes[i].Left-(parseFloat(c.getAttribute("cx"))-15)&&t.objData.lstShapes[i].Left-(parseFloat(c.getAttribute("cx"))-15)<.1&&-.1<t.objData.lstShapes[i].Top-(parseFloat(c.getAttribute("cy"))-15)&&t.objData.lstShapes[i].Top-(parseFloat(c.getAttribute("cy"))-15)<.1&&(e=t.objData.lstShapes[i].Id,p=t.objData.lstShapes[i].processRef,r=t.objData.lstShapes[i]),l.nodeName=="circle"&&o==""&&-.1<t.objData.lstShapes[i].Left-(parseFloat(l.getAttribute("cx"))-15)&&t.objData.lstShapes[i].Left-(parseFloat(l.getAttribute("cx"))-15)<.1&&-.1<t.objData.lstShapes[i].Top-(parseFloat(l.getAttribute("cy"))-15)&&t.objData.lstShapes[i].Top-(parseFloat(l.getAttribute("cy"))-15)<.1&&(o=t.objData.lstShapes[i].Id,d=t.objData.lstShapes[i].processRef,u=t.objData.lstShapes[i]);else break;if(it=CheckIsValidFlowNodeOrNot(r,u),it&&e!=""&&o!=""){for(g=!1,v=0;v<t.objData.lstShapes.length;v++)if((t.objData.lstShapes[v].ShapeType=="sequenceFlow"||t.objData.lstShapes[v].ShapeType=="dataOutputAssociation"||t.objData.lstShapes[v].ShapeType=="association"||t.objData.lstShapes[v].ShapeType=="messageFlow"||t.objData.lstShapes[v].ShapeType=="dataInputAssociation")&&t.objData.lstShapes[v].SourceElement==e&&t.objData.lstShapes[v].TargetElement==o){g=!0;break}if(g)alert("Nodes Already Connected..");else{u.ShapeType=="inclusiveGateway"||u.ShapeType=="parallelGateway"?(u.ShapeModel.dictAttributes.gatewayDirection="Unspecified",b=getgateWaydirectionbasedOnEdges(u.Id,t,"In"),u.ShapeModel.dictAttributes.gatewayDirection=b):(r.ShapeType=="inclusiveGateway"||r.ShapeType=="parallelGateway")&&(r.ShapeModel.dictAttributes.gatewayDirection="Unspecified",b=getgateWaydirectionbasedOnEdges(r.Id,t,"Out"),r.ShapeModel.dictAttributes.gatewayDirection=b);var w="EDGE_"+generateUUID(),a=generateUUID(),s=null;if(p==d&&t.targetElementOnMouseHover.id!="textAnnotation"&&t.sourceElementOnMouseHover.id!="textAnnotation"&&r.ShapeType!="dataStoreReference"&&u.ShapeType!="dataStoreReference"&&r.ShapeType!="dataObjectReference"&&u.ShapeType!="dataObjectReference")s={Id:a,lstWayPoints:t.NewEdgeWayPoints,ShapeName:"BPMNEdge",ShapeType:"sequenceFlow",SourceElement:e,TargetElement:o,LabelLeft:0,LabelTop:0,LabelHeight:50,LabelWidth:50,Text:"",processRef:p,ShapeId:w},nt=null,nt=r.ShapeType!="exclusiveGateway"&&r.ShapeType!="inclusiveGateway"?{dictAttributes:{id:a,sourceRef:e,targetRef:o},Elements:[],Children:[],Name:"sequenceFlow",prefix:null,Value:""}:{dictAttributes:{id:a,sourceRef:e,targetRef:o},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"leftside",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"rightside",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"conditionExpression",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"sequenceFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""},s.ShapeModel=nt;else if(t.targetElementOnMouseHover.id=="textAnnotation"||t.sourceElementOnMouseHover.id=="textAnnotation")tt=t.NewEdgeWayPoints.length,tt>2&&(rt=tt-2,t.NewEdgeWayPoints.splice(1,rt)),s={Id:a,lstWayPoints:t.NewEdgeWayPoints,ShapeName:"BPMNEdge",ShapeType:"association",SourceElement:e,TargetElement:o,LabelLeft:0,LabelTop:0,LabelHeight:50,LabelWidth:50,Text:"",processRef:p,ShapeId:w},ut={dictAttributes:{id:a,sourceRef:e,targetRef:o,associationDirection:"None"},Elements:[],Children:[],Name:"association",prefix:null,Value:""},s.ShapeModel=ut;else if(r.ShapeType=="dataStoreReference"||u.ShapeType=="dataStoreReference"||r.ShapeType=="dataObjectReference"||u.ShapeType=="dataObjectReference"){if(ft=IsValidShapeForAssociation(r,u),ft)if(r.ShapeType=="dataStoreReference"||r.ShapeType=="dataObjectReference"){var h=generateUUID(),et={dictAttributes:{},Elements:[{dictAttributes:{id:h,isCollection:"false"},Elements:[],Children:[],Name:"dataInput",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"dataInputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:h}],Children:[],Name:"inputSet",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"ioSpecification",prefix:"",IsValueInCDATAFormat:!1,Value:""},k=!1;for(f=0;f<u.ShapeModel.Elements.length;f++)if(u.ShapeModel.Elements[f].Name=="ioSpecification"){var wt={dictAttributes:{id:h,isCollection:"false"},Elements:[],Children:[],Name:"dataInput",prefix:"",IsValueInCDATAFormat:!1,Value:""},bt={dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"dataInputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:h}],Children:[],Name:"inputSet",prefix:"",IsValueInCDATAFormat:!1,Value:""},ot=!1;for(y=0;y<u.ShapeModel.Elements[f].Elements.length;y++)u.ShapeModel.Elements[f].Elements[y].Name=="inputSet"&&(st={dictAttributes:{},Elements:[],Children:[],Name:"dataInputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:h},u.ShapeModel.Elements[f].Elements[y].Elements.push(st),ot=!0);u.ShapeModel.Elements[f].Elements.push(wt);ot||u.ShapeModel.Elements[f].Elements.push(bt);k=!0}k||u.ShapeModel.Elements.push(et);s={Id:a,lstWayPoints:t.NewEdgeWayPoints,ShapeName:"BPMNEdge",ShapeType:"dataInputAssociation",SourceElement:e,TargetElement:o,LabelLeft:0,LabelTop:0,LabelHeight:50,LabelWidth:50,Text:"",processRef:p,ShapeId:w};ht=a;ct={dictAttributes:{id:ht},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"sourceRef",prefix:"",IsValueInCDATAFormat:!1,Value:r.Id},{dictAttributes:{},Elements:[],Children:[],Name:"targetRef",prefix:"",IsValueInCDATAFormat:!1,Value:h}],Children:[],Name:"dataInputAssociation",prefix:"",IsValueInCDATAFormat:!1,Value:""};s.ShapeModel=ct}else if(u.ShapeType=="dataStoreReference"||u.ShapeType=="dataObjectReference"){var h=generateUUID(),et={dictAttributes:{},Elements:[{dictAttributes:{id:h,isCollection:"false"},Elements:[],Children:[],Name:"dataOutput",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"dataOutputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:h}],Children:[],Name:"outputSet",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"ioSpecification",prefix:"",IsValueInCDATAFormat:!1,Value:""},k=!1;for(f=0;f<r.ShapeModel.Elements.length;f++)if(r.ShapeModel.Elements[f].Name=="ioSpecification"){var kt={dictAttributes:{id:h,isCollection:"false"},Elements:[],Children:[],Name:"dataOutput",prefix:"",IsValueInCDATAFormat:!1,Value:""},dt={dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"dataOutputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:h}],Children:[],Name:"outputSet",prefix:"",IsValueInCDATAFormat:!1,Value:""},lt=!1;for(y=0;y<r.ShapeModel.Elements[f].Elements.length;y++)r.ShapeModel.Elements[f].Elements[y].Name=="outputSet"&&(at={dictAttributes:{},Elements:[],Children:[],Name:"dataOutputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:h},r.ShapeModel.Elements[f].Elements[y].Elements.push(at),lt=!0);r.ShapeModel.Elements[f].Elements.push(kt);lt||r.ShapeModel.Elements[f].Elements.push(dt);k=!0}k||r.ShapeModel.Elements.push(et);s={Id:a,lstWayPoints:t.NewEdgeWayPoints,ShapeName:"BPMNEdge",ShapeType:"dataOutputAssociation",SourceElement:e,TargetElement:o,LabelLeft:0,LabelTop:0,LabelHeight:50,LabelWidth:50,Text:"",processRef:p,ShapeId:w};vt={dictAttributes:{id:a},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"sourceRef",prefix:"",IsValueInCDATAFormat:!1,Value:h},{dictAttributes:{},Elements:[],Children:[],Name:"targetRef",prefix:"",IsValueInCDATAFormat:!1,Value:u.Id}],Children:[],Name:"dataOutputAssociation",prefix:"",IsValueInCDATAFormat:!1,Value:""};s.ShapeModel=vt}}else r.ShapeType!="exclusiveGateway"&&r.ShapeType!="inclusiveGateway"&&u.ShapeType!="exclusiveGateway"&&u.ShapeType!="inclusiveGateway"&&r.ShapeType!="eventBasedGateway"&&r.ShapeType!="parallelGateway"&&u.ShapeType!="eventBasedGateway"&&u.ShapeType!="parallelGateway"&&(t.objData.CollaborationId==""&&(t.objData.CollaborationId="COLLABORATION_"+generateUUID()),yt=t.objData.CollaborationId,s={Id:a,lstWayPoints:t.NewEdgeWayPoints,ShapeName:"BPMNEdge",ShapeType:"messageFlow",SourceElement:e,TargetElement:o,LabelLeft:0,LabelTop:0,LabelHeight:50,LabelWidth:50,Text:"",processRef:yt,ShapeId:w},pt={dictAttributes:{id:a,sourceRef:e,targetRef:o},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"docTypes",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"messageFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""},s.ShapeModel=pt);s!=null&&t.$apply(function(){t.objData.lstShapes.push(s);AddLineArray(t.svgElement,s,t)})}}}for(i=0;i<t.svgElement.childNodes.length;i++)if(t.svgElement.childNodes[i].id=="dottedline"){t.svgElement.removeChild(t.svgElement.childNodes[i]);break}t.sourceElementOnMouseHover=null;t.targetElementOnMouseHover=null}function getgateWaydirectionbasedOnEdges(n,t,i){for(var r=0,u=0,f=0;f<t.objData.lstShapes.length;f++)t.objData.lstShapes[f].ShapeName=="BPMNEdge"&&(t.objData.lstShapes[f].SourceElement==n?r++:t.objData.lstShapes[f].TargetElement==n&&u++);return i=="In"?u=u+1:i=="Out"&&(r=r+1),u>1&&r>1?"Mixed":u>1&&u>r?"Converging":r>1&&r>u?"Diverging":"Unspecified"}function IsValidShapeForAssociation(n,t){var i=!1;return(n.ShapeType=="task"||n.ShapeType=="userTask"||n.ShapeType=="serviceTask"||n.ShapeType=="businessRuleTask"||n.ShapeType=="manualTask"||n.ShapeType=="callActivity"||t.ShapeType=="task"||t.ShapeType=="userTask"||t.ShapeType=="serviceTask"||t.ShapeType=="businessRuleTask"||t.ShapeType=="manualTask"||t.ShapeType=="callActivity")&&(i=!0),i}function CheckIsValidFlowNodeOrNot(n,t){var i=!1;return(n.ShapeType=="startEvent"||t.ShapeType=="startEvent")&&n.ShapeType!="participant"&&t.ShapeType!="participant"?n.ShapeType!=t.ShapeType&&(n.ShapeType=="startEvent"?t.processRef==n.processRef&&t.ShapeType!="dataObjectReference"&&t.ShapeType!="dataStoreReference"&&(i=!0):t.processRef!=n.processRef&&(n.ShapeType=="participant"||n.ShapeType=="task"||n.ShapeType=="serviceTask"||n.ShapeType=="userTask"||n.ShapeType=="businessRuleTask"||n.ShapeType=="callActivity"||n.ShapeType=="manualTask")&&(i=!0)):(n.ShapeType=="endEvent"||t.ShapeType=="endEvent")&&n.ShapeType!="participant"&&t.ShapeType!="participant"?n.ShapeType!=t.ShapeType&&(n.ShapeType=="endEvent"?t.processRef!=n.processRef&&(t.ShapeType=="participant"||t.ShapeType=="task"||t.ShapeType=="serviceTask"||t.ShapeType=="userTask"||t.ShapeType=="businessRuleTask"||t.ShapeType=="callActivity"||t.ShapeType=="manualTask")&&(i=!0):t.processRef==n.processRef&&n.ShapeType!="dataObjectReference"&&n.ShapeType!="dataStoreReference"&&(i=!0)):(n.ShapeType=="dataStoreReference"||t.ShapeType=="dataStoreReference"||n.ShapeType=="dataObjectReference"||t.ShapeType=="dataObjectReference")&&n.ShapeType!="participant"&&t.ShapeType!="participant"?n.ShapeType=="dataStoreReference"||n.ShapeType=="dataObjectReference"?(t.ShapeType=="participant"||t.ShapeType=="task"||t.ShapeType=="userTask"||t.ShapeType=="serviceTask"||t.ShapeType=="businessRuleTask"||t.ShapeType=="manualTask"||t.ShapeType=="callActivity")&&(i=!0):(n.ShapeType=="participant"||n.ShapeType=="task"||n.ShapeType=="userTask"||n.ShapeType=="serviceTask"||n.ShapeType=="businessRuleTask"||n.ShapeType=="manualTask"||n.ShapeType=="callActivity")&&(i=!0):n.ShapeType=="participant"||t.ShapeType=="participant"?n.processRef!=t.processRef&&(i=!0):i=!0,i}function GenerateBoundsDynamicallyToElement(n,t,i){var a=0,v=0,k=0,d=0,r,w,u,f,b,e,o,y,s,h,p,c,l;return a=parseFloat(n.getAttribute("x"))-5,v=parseFloat(n.getAttribute("y"))-5,k=parseFloat(n.getAttribute("height"))+10,d=parseFloat(n.getAttribute("width"))+10,r=document.createElementNS(i.svgNS,"g"),r.setAttributeNS(null,"id","resizergroup"),r.setAttributeNS(null,"class","layer-resizers"),t&&r.setAttribute("style","opacity: 0.5;"),n.getAttribute("id")!="message"&&n.getAttribute("id")!="endEvent"&&n.getAttribute("id")!="startEvent"&&n.getAttribute("id")!="intermediateCatchEvent"&&n.getAttribute("id")!="exclusiveGateway"&&n.getAttribute("id")!="inclusiveGateway"&&n.getAttribute("id")!="parallelGateway"&&n.getAttribute("id")!="eventBasedGateway"&&n.getAttribute("id")!="dataStoreReference"&&n.getAttribute("id")!="dataObjectReference"&&(n.getAttribute("id")!="lane"&&(w=document.createElementNS(i.svgNS,"g"),w.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-nw"),w.setAttributeNS(null,"id","nw"),w.setAttribute("onmousedown","selectedResizergtagElement(evt)"),u=document.createElementNS(i.svgNS,"rect"),u.setAttributeNS(null,"id","rectanglenw"),u.setAttributeNS(null,"class","djs-resizer-visual"),u.setAttributeNS(null,"x",a-3),u.setAttributeNS(null,"y",v-3),u.setAttributeNS(null,"height",6),u.setAttributeNS(null,"width",6),u.setAttributeNS(null,"fill","white"),u.setAttributeNS(null,"stroke","none"),w.appendChild(u),f=document.createElementNS(i.svgNS,"rect"),f.setAttributeNS(null,"id","rectanglenw"),f.setAttributeNS(null,"class","djs-resizer-hit"),f.setAttributeNS(null,"x",a-10),f.setAttributeNS(null,"y",v-10),f.setAttributeNS(null,"height",20),f.setAttributeNS(null,"width",20),f.setAttributeNS(null,"fill","white"),f.setAttributeNS(null,"stroke","none"),w.appendChild(f),r.appendChild(w),b=document.createElementNS(i.svgNS,"g"),b.setAttribute("onmousedown","selectedResizergtagElement(evt)"),b.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-ne"),b.setAttributeNS(null,"id","ne"),e=document.createElementNS(i.svgNS,"rect"),e.setAttributeNS(null,"id","rectanglene"),e.setAttributeNS(null,"class","djs-resizer-visual"),e.setAttributeNS(null,"x",a+d-3),e.setAttributeNS(null,"y",v-3),e.setAttributeNS(null,"height",6),e.setAttributeNS(null,"width",6),e.setAttributeNS(null,"fill","white"),e.setAttributeNS(null,"stroke","none"),b.appendChild(e),o=document.createElementNS(i.svgNS,"rect"),o.setAttributeNS(null,"id","rectanglene"),o.setAttributeNS(null,"class","djs-resizer-hit"),o.setAttributeNS(null,"x",a+d-10),o.setAttributeNS(null,"y",v-10),o.setAttributeNS(null,"height",20),o.setAttributeNS(null,"width",20),o.setAttributeNS(null,"fill","white"),o.setAttributeNS(null,"stroke","none"),b.appendChild(o),r.appendChild(b)),y=document.createElementNS(i.svgNS,"g"),y.setAttribute("onmousedown","selectedResizergtagElement(evt)"),n.getAttribute("id")!="lane"?(y.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-se"),y.setAttributeNS(null,"id","se")):(y.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-s"),y.setAttributeNS(null,"id","nse")),s=document.createElementNS(i.svgNS,"rect"),s.setAttributeNS(null,"id","rectanglese"),s.setAttributeNS(null,"class","djs-resizer-visual"),s.setAttributeNS(null,"x",a+d-3),s.setAttributeNS(null,"y",v+k-3),s.setAttributeNS(null,"height",6),s.setAttributeNS(null,"width",6),s.setAttributeNS(null,"fill","orange"),s.setAttributeNS(null,"stroke","none"),y.appendChild(s),h=document.createElementNS(i.svgNS,"rect"),h.setAttributeNS(null,"id","rectanglese"),h.setAttributeNS(null,"class","djs-resizer-hit"),h.setAttributeNS(null,"x",a+d-10),h.setAttributeNS(null,"y",v+k-10),h.setAttributeNS(null,"height",20),h.setAttributeNS(null,"width",20),h.setAttributeNS(null,"fill","orange"),h.setAttributeNS(null,"stroke","none"),y.appendChild(h),r.appendChild(y),p=document.createElementNS(i.svgNS,"g"),p.setAttribute("onmousedown","selectedResizergtagElement(evt)"),n.getAttribute("id")!="lane"?(p.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-sw"),p.setAttributeNS(null,"id","sw")):(p.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-s"),p.setAttributeNS(null,"id","nsw")),c=document.createElementNS(i.svgNS,"rect"),c.setAttributeNS(null,"id","rectanglesw"),c.setAttributeNS(null,"class","djs-resizer-visual"),c.setAttributeNS(null,"x",a-3),c.setAttributeNS(null,"y",v+k-3),c.setAttributeNS(null,"height",6),c.setAttributeNS(null,"width",6),c.setAttributeNS(null,"fill","orange"),c.setAttributeNS(null,"stroke","none"),p.appendChild(c),l=document.createElementNS(i.svgNS,"rect"),l.setAttributeNS(null,"id","rectanglesw"),l.setAttributeNS(null,"class","djs-resizer-hit"),l.setAttributeNS(null,"x",a-10),l.setAttributeNS(null,"y",v+k-10),l.setAttributeNS(null,"height",20),l.setAttributeNS(null,"width",20),l.setAttributeNS(null,"fill","orange"),l.setAttributeNS(null,"stroke","none"),p.appendChild(l),r.appendChild(p)),t||n.getAttribute("id")!="lane"&&n.getAttribute("id")!="participant"&&n.getAttribute("id")!="textAnnotation"&&n.getAttribute("id")!="message"&&GenerateRightPanelForAddingElements(r,n,i),i.svgElement.appendChild(r),r}function GenerateRightPanelForAddingElements(n,t,i){for(var r,l,e,u,h,y,p,w,a,f=0;f<n.childNodes.length;f++)if(n.childNodes[f].id=="RightPanel"){n.removeChild(n.childNodes[f]);break}var b=0,k=0,nt=0,d=0;b=parseFloat(t.getAttribute("x"));k=parseFloat(t.getAttribute("y"));nt=parseFloat(t.getAttribute("height"));d=parseFloat(t.getAttribute("width"));r=document.createElementNS(i.svgNS,"g");r.setAttributeNS(null,"id","RightPanel");l=document.createElementNS(i.svgNS,"rect");l.setAttributeNS(null,"id","rectRight");l.setAttributeNS(null,"x",b+d+10);l.setAttributeNS(null,"y",k);l.setAttributeNS(null,"height",70);l.setAttributeNS(null,"width",20);l.setAttributeNS(null,"fill","#908282");l.setAttributeNS(null,"stroke","#4f4231");r.appendChild(l);e=document.createElementNS(i.svgNS,"rect");e.setAttributeNS(null,"id","task");e.setAttribute("rx",3);e.setAttribute("ry",3);e.setAttributeNS(null,"x",b+d+10+2.5);e.setAttribute("onmousedown","drawNewTask(evt)");e.setAttributeNS(null,"y",k+5);e.setAttributeNS(null,"height",10);e.setAttributeNS(null,"width",15);e.setAttributeNS(null,"fill","#f7ce98");e.setAttributeNS(null,"stroke","#4f4231");r.appendChild(e);var v=document.createElementNS(i.svgNS,"polygon"),o=parseFloat(r.childNodes[r.childNodes.length-1].getAttribute("x")),s=parseFloat(r.childNodes[r.childNodes.length-1].getAttribute("y"))+parseFloat(r.childNodes[r.childNodes.length-1].getAttribute("height"))+6,g={X:o,Y:s+15/2},y={X:o+15/2,Y:s},p={X:o+15,Y:s+15/2},w={X:o+15/2,Y:s+15},tt=g.X+","+g.Y+"  "+y.X+","+y.Y+"  "+p.X+","+p.Y+"  "+w.X+","+w.Y;v.setAttribute("id","ExclusivGate");v.setAttribute("points",tt);v.setAttribute("onmousedown","drawExclusiveGate(evt)");v.setAttribute("stroke","#4f4231");v.setAttribute("fill","#f7ede1");r.appendChild(v);u=document.createElementNS(i.svgNS,"circle");u.setAttributeNS(null,"id","cacheouter");u.setAttributeNS(null,"cx",o+7.5);u.setAttributeNS(null,"cy",s+20+5);u.setAttribute("onmousedown","drawintermediateCatchEvent(evt)");u.setAttributeNS(null,"r",6);u.setAttributeNS(null,"fill","#f8cd98");u.setAttributeNS(null,"stroke","#4f4231");r.appendChild(u);u=document.createElementNS(i.svgNS,"circle");u.setAttributeNS(null,"id","cacheinner");u.setAttributeNS(null,"cx",o+7.5);u.setAttribute("onmousedown","drawintermediateCatchEvent(evt)");u.setAttributeNS(null,"cy",s+20+5);u.setAttributeNS(null,"r",4);u.setAttributeNS(null,"fill","#f8cd98");u.setAttributeNS(null,"stroke","#4f4231");r.appendChild(u);h=document.createElementNS(i.svgNS,"rect");h.setAttributeNS(null,"id","textAnnotation");h.setAttributeNS(null,"x",o);h.setAttributeNS(null,"y",s+30+5);h.setAttributeNS(null,"height",10);h.setAttributeNS(null,"width",15);h.setAttribute("onmousedown","drawtextAnnotationFromPanel(evt)");h.setAttributeNS(null,"fill","#f7ede1");h.setAttributeNS(null,"stroke","none");r.appendChild(h);var o=parseFloat(r.childNodes[r.childNodes.length-1].getAttribute("x")),s=parseFloat(r.childNodes[r.childNodes.length-1].getAttribute("y")),c=[],g={Left:o+15/2,Top:s};for(c.push(g),y={Left:o,Top:s},c.push(y),p={Left:o,Top:s+10},c.push(p),w={Left:o+15/2,Top:s+10},c.push(w),f=0;f<c.length;f++)f<c.length-1&&(a=document.createElementNS(i.svgNS,"line"),a.setAttribute("id","line"),a.setAttribute("stroke-width",1),a.setAttribute("x1",c[f].Left),a.setAttribute("y1",c[f].Top),a.setAttribute("x2",c[f+1].Left),a.setAttribute("y2",c[f+1].Top),a.setAttributeNS(null,"stroke","#000000"),r.appendChild(a));n.appendChild(r)}function removeResizerAroundElement(n){for(var i,t=n.svgElement.childNodes.length-1;t>0;t--)n.svgElement.childNodes[t].nodeName!="#text"&&n.svgElement.childNodes[t].nodeName!="#comment"&&(i=n.svgElement.childNodes[t].getAttribute("id"),i=="resizergroup"&&(n.svgElement.removeChild(n.svgElement.childNodes[t]),t--))}function selectedResizergtagElement(n){var t=angular.element(n.currentTarget).scope();t&&(t.selectedResizergElement=n.currentTarget,t.currentX=n.offsetX,t.currentY=n.offsetY,t.isMouseDown=!0,getMaxResizeLimitsOfParticipantorLane(t),t.svgElement.setAttributeNS(null,"onmouseup","deselectResizergElement(evt)"),t.svgElement.setAttributeNS(null,"onmousemove","moveResizergElement(evt)"))}function deselectResizergElement(n){var t=angular.element(n.currentTarget).scope(),r,i;if(t.isMouseDown=!1,t.selectedResizergElement!=0){if(t.selectedElemForResize.id=="participant"&&AdjustLanePositions(t.selectedResizergElement,t.selectedElemForResize,t),t.selectedElemForResize.id=="lane"&&(r=parseFloat(t.selectedElemForResize.getAttribute("height"))-t.objData.lstShapes[t.indexofResizerElement].Height,AjustLanePositionAndElements(r,t)),angular.forEach($(t.selectedElemForResize).children(),function(n){n.nodeName=="rect"?(t.objData.lstShapes[t.indexofResizerElement].Left=parseFloat(t.selectedElemForResize.getAttribute("x")),t.objData.lstShapes[t.indexofResizerElement].Top=parseFloat(t.selectedElemForResize.getAttribute("y")),t.objData.lstShapes[t.indexofResizerElement].Height=parseFloat(t.selectedElemForResize.getAttribute("height")),t.objData.lstShapes[t.indexofResizerElement].Width=parseFloat(t.selectedElemForResize.getAttribute("width"))):n.nodeName=="text"&&(t.objData.lstShapes[t.indexofResizerElement].LabelLeft=parseFloat(n.getAttribute("x")),t.objData.lstShapes[t.indexofResizerElement].LabelTop=parseFloat(n.getAttribute("y")))}),ReArrangeEdges(t.objData.lstShapes[t.indexofResizerElement],t),t.selectedElemForResize.id=="participant")for(RedrawingElementsAndEdges(t),i=0;i<t.svgElement.childNodes.length;i++)if(t.svgElement.childNodes[i].nodeName!="defs"&&t.objData.lstShapes[t.indexofResizerElement].Left==parseFloat(t.svgElement.childNodes[i].getAttribute("x"))&&t.objData.lstShapes[t.indexofResizerElement].Top==parseFloat(t.svgElement.childNodes[i].getAttribute("y"))&&t.objData.lstShapes[t.indexofResizerElement].Height==parseFloat(t.svgElement.childNodes[i].getAttribute("height"))&&t.objData.lstShapes[t.indexofResizerElement].Width==parseFloat(t.svgElement.childNodes[i].getAttribute("width"))){generateSelectionRectangleDynamically(t.svgElement.childNodes[i],t);t.selectedElement=t.svgElement.childNodes[i];t.selectedElemForResize=t.selectedElement;GenerateBoundsDynamicallyToElement(t.selectedElement,!1,t);break}t.selectedElemForResize.id=="lane"&&RedrawingElementsAndEdges(t);t.svgElement.removeAttributeNS(null,"onmousemove");t.svgElement.removeAttributeNS(null,"onmouseup");t.selectedResizergElement=0}}function AdjustLanePositions(n,t,i){for(var f=parseFloat(t.getAttribute("x"))-i.objData.lstShapes[i.indexofResizerElement].Left,o=parseFloat(t.getAttribute("y"))-i.objData.lstShapes[i.indexofResizerElement].Top,e=parseFloat(t.getAttribute("height"))-i.objData.lstShapes[i.indexofResizerElement].Height,u=parseFloat(t.getAttribute("width"))-i.objData.lstShapes[i.indexofResizerElement].Width,r=0;r<i.objData.lstShapes.length;r++)i.objData.lstShapes[r].ShapeType=="lane"&&(i.objData.lstShapes[r].Top-i.objData.lstShapes[i.indexofResizerElement].Top>-.1&&i.objData.lstShapes[r].Top-i.objData.lstShapes[i.indexofResizerElement].Top<.1&&(n.getAttribute("id")=="nw"||n.getAttribute("id")=="ne")||i.objData.lstShapes[r].Top+i.objData.lstShapes[r].Height-(i.objData.lstShapes[i.indexofResizerElement].Top+i.objData.lstShapes[i.indexofResizerElement].Height)>-.1&&i.objData.lstShapes[r].Top+i.objData.lstShapes[r].Height-(i.objData.lstShapes[i.indexofResizerElement].Top+i.objData.lstShapes[i.indexofResizerElement].Height)<.1&&(n.getAttribute("id")=="sw"||n.getAttribute("id")=="se")&&i.objData.lstShapes[i.indexofResizerElement].processRef==i.objData.lstShapes[r].processRef)?n.getAttribute("id")=="nw"||n.getAttribute("id")=="ne"?(i.objData.lstShapes[r].Left=i.objData.lstShapes[r].Left+f,i.objData.lstShapes[r].Top=i.objData.lstShapes[r].Top+o,i.objData.lstShapes[r].Width=i.objData.lstShapes[r].Width+u,i.objData.lstShapes[r].Height=i.objData.lstShapes[r].Height+e):(n.getAttribute("id")=="sw"||n.getAttribute("id")=="se")&&(i.objData.lstShapes[r].Width=i.objData.lstShapes[r].Width+u,i.objData.lstShapes[r].Height=i.objData.lstShapes[r].Height+e,i.objData.lstShapes[r].Left=i.objData.lstShapes[r].Left+f):i.objData.lstShapes[r].ShapeType=="lane"&&i.objData.lstShapes[i.indexofResizerElement].processRef==i.objData.lstShapes[r].processRef&&((n.getAttribute("id")=="nw"||n.getAttribute("id")=="sw")&&(i.objData.lstShapes[r].Width=i.objData.lstShapes[r].Width+u,i.objData.lstShapes[r].Left=i.objData.lstShapes[r].Left+f),(n.getAttribute("id")=="ne"||n.getAttribute("id")=="se")&&(i.objData.lstShapes[r].Width=i.objData.lstShapes[r].Width+u))}function AjustLanePositionAndElements(n,t){var r=t.objData.lstShapes[t.indexofResizerElement],o=r.processRef,s=r.Id,h=t.getLaneCountinPool(o),e=t.objData.lstShapes[h.PoolIndex],i,u,f;for(e&&(e.Height=e.Height+n),ResetEdgePoints(e,-n,t),i=0;i<t.objData.lstShapes.length;i++)if(t.objData.lstShapes[i].ShapeName!="BPMNEdge"&&t.objData.lstShapes[i].processRef==o&&t.objData.lstShapes[i].ShapeType=="lane"&&t.objData.lstShapes[i].Id!=s&&(t.objData.lstShapes[i].Top>r.Top||t.objData.lstShapes[i].Top-(r.Top+r.Height)<=.2&&t.objData.lstShapes[i].Top-(r.Top+r.Height)>=-.2))for(t.objData.lstShapes[i].Top=t.objData.lstShapes[i].Top+n,u=0;u<t.objData.lstShapes[i].ShapeModel.Elements.length;u++)t.objData.lstShapes[i].ShapeModel.Elements[u].Name=="flowNodeRef"&&t.objData.lstShapes[i].ShapeModel.Elements[u].Value&&t.objData.lstShapes[i].ShapeModel.Elements[u].Value!=""&&(f=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[i].ShapeModel.Elements[u].Value,t,"Element"),f.Top=f.Top+n,f.LabelTop>0&&(f.LabelTop=f.LabelTop+n),ydiffislaneChanged=-n,ResetEdgePoints(f,ydiffislaneChanged,t))}function ReArrangeEdges(n,t){for(var u,f,e,a,o,r,v,y,h,c=[],l=[],i=0;i<t.objData.lstShapes.length;i++)t.objData.lstShapes[i].ShapeName=="BPMNEdge"&&n.Id==t.objData.lstShapes[i].SourceElement&&c.push(t.objData.lstShapes[i]);if(c.length>0)for(u=0;u<c.length;u++){for(f=null,e=null,i=0;i<t.objData.lstShapes.length;i++)if(f==null||e==null)t.objData.lstShapes[i].Id==c[u].SourceElement?f=t.objData.lstShapes[i]:t.objData.lstShapes[i].Id==c[u].TargetElement&&(e=t.objData.lstShapes[i]);else break;var a=c[u].lstWayPoints,o=a[a.length-1],s=a[0];for(UpdateCurPoint(t.selectedElemPrevBounds,s,f),s=GetNewPointOnShapeResize(t.selectedElemPrevBounds,s,f),r=GetEdgeWayPoints(f,e,s,o);r.length==2&&s.Left!=o.Left&&s.Top!=o.Top;)r=GetEdgeWayPointsForDottedLine(f,e);for(r=setShapeNameToWayPoints(r),c[u].ShapeType=="association"&&(v=r.length,r.length>2&&(y=v-2,r.splice(1,y))),h=0;h<t.objData.lstShapes.length;h++)if(t.objData.lstShapes[h].Id==c[u].Id){t.objData.lstShapes[h].lstWayPoints=r;break}ReDrawingEdges(t)}for(i=0;i<t.objData.lstShapes.length;i++)t.objData.lstShapes[i].ShapeName=="BPMNEdge"&&n.Id==t.objData.lstShapes[i].TargetElement&&l.push(t.objData.lstShapes[i]);if(l.length>0)for(u=0;u<l.length;u++){for(f=null,e=null,i=0;i<t.objData.lstShapes.length;i++)if(f==null||e==null)t.objData.lstShapes[i].Id==l[u].SourceElement?f=t.objData.lstShapes[i]:t.objData.lstShapes[i].Id==l[u].TargetElement&&(e=t.objData.lstShapes[i]);else break;for(a=l[u].lstWayPoints,o=a[a.length-1],UpdateCurPoint(t.selectedElemPrevBounds,o,e),o=GetNewPointOnShapeResize(t.selectedElemPrevBounds,o,e),s=a[0],r=GetEdgeWayPoints(f,e,s,o);r.length==2&&s.Left!=o.Left&&s.Top!=o.Top;)r=GetEdgeWayPointsForDottedLine(f,e);for(r=setShapeNameToWayPoints(r),l[u].ShapeType=="association"&&(v=r.length,r.length>2&&(y=v-2,r.splice(1,y))),h=0;h<t.objData.lstShapes.length;h++)if(t.objData.lstShapes[h].Id==l[u].Id){t.objData.lstShapes[h].lstWayPoints=r;break}ReDrawingEdges(t)}t.selectedElemPrevBounds.Left=n.Left;t.selectedElemPrevBounds.Top=n.Top;t.selectedElemPrevBounds.Height=n.Height;t.selectedElemPrevBounds.Width=n.Width}function GenerateNewWaypoints(n,t,i,r,u){return n?(r.Left>t.Left+t.Width?r.Left=t.Left+t.Width:r.Left<t.Left?r.Left=t.Left:r.Left>t.Left&&r.Left<t.Left+t.Width&&(r.Top>t.Top+t.Height?r.Top=t.Top+t.Height:r.Top<t.Top?r.Top=t.Top:r.Top<t.Top+t.Height&&r.Top>t.Top&&(r.Top=u.Top>t.Top+t.Height?t.Top+t.Height:t.Top)),r.Top<t.Top?r.Top=t.Top:r.Top>t.Top+t.Height&&(r.Top=t.Top+t.Height)):(u.Left>i.Left+i.Width?u.Left=i.Left+i.Width:u.Left<i.Left?u.Left=i.Left:u.Left>i.Left&&u.Left<i.Left+i.Width&&(u.Top>i.Top+i.Height?u.Top=i.Top+i.Height:u.Top<i.Top?u.Top=i.Top:u.Top<i.Top+i.Height&&u.Top>i.Top&&(u.Top=r.Top>i.Top+i.Height?i.Top+i.Height:i.Top)),u.Top<i.Top?u.Top=i.Top:u.Top>i.Top+i.Height&&(u.Top=i.Top+i.Height)),newPoints=GetEdgeWayPoints(t,i,r,u)}function UpdateCurPoint(n,t,i){t.Left==n.Left?t.Left=i.Left:t.Left==n.Left+n.Width&&(t.Left=i.Left+i.Width);t.Top==n.Top?t.Top=i.Top:t.Top==n.Top+n.Height&&(t.Top=i.Top+i.Height)}function GetNewPointOnShapeResize(n,t,i){var f={Left:t.Left,Top:t.Top},u,r;return t.Left==i.Left||t.Left==i.Left+i.Width?(u=(i.Top+i.Height)/(n.Top+n.Height)*100,r=u*t.Top/100,(r<i.Top||r>i.Top+i.Height)&&(r=i.Top+i.Height/2),f.Top=r):(t.Top==i.Top||t.Top==i.Top+i.Height)&&(u=(i.Left+i.Width)/(n.Left+n.Width)*100,r=u*t.Left/100,(r<i.Left||r>i.Left+i.Width)&&(r=i.Left+i.Width/2),f.Left=r),f}function moveResizergElement(n){var t=angular.element(n.currentTarget).scope(),f,ft,p,o,k,tt,s,nt,h,it,et,ot,st,v,c;if(t&&t.isMouseDown&&n.buttons==1){if(dx=n.offsetX-t.currentX,dy=n.offsetY-t.currentY,f=!1,t.SelectedElementLane!=null||t.selectedShape.ShapeType=="participant"||t.selectedShape.ShapeType=="lane"){var w=0,b=0,rt=0,ut=0,d=0,g=0;t.SelectedElementLane!=null&&(w=parseFloat(t.SelectedElementLane.getAttribute("x")),b=parseFloat(t.SelectedElementLane.getAttribute("y")),rt=parseFloat(t.SelectedElementLane.getAttribute("height")),ut=parseFloat(t.SelectedElementLane.getAttribute("width")),d=w+ut,g=b+rt);var r="",i="",e="",u="",l=0,a=0;t.selectedResizergElement.getAttribute("id")=="nw"?(r=parseFloat(t.selectedElemForResize.getAttribute("x"))+dx,i=parseFloat(t.selectedElemForResize.getAttribute("y"))+dy,e=parseFloat(t.selectedElemForResize.getAttribute("height"))-dy,u=parseFloat(t.selectedElemForResize.getAttribute("width"))-dx,l=r+u-r,a=i+e-i,t.selectedShape.ShapeType!="participant"?w<r&&d>r&&b<i&&g>i&&l>20&&a>20&&(f=!0):t.objMaxResizeLimits&&t.objMaxResizeLimits.Left&&t.objMaxResizeLimits.Top&&t.objMaxResizeLimits.Right&&t.objMaxResizeLimits.Bottom&&t.objMaxResizeLimits.LaneTopLimit&&t.objMaxResizeLimits.LaneBottomLimit?r<=t.objMaxResizeLimits.Left-80&&i<=t.objMaxResizeLimits.Top&&i<t.objMaxResizeLimits.LaneTopLimit&&u>200&&(f=!0):t.objMaxResizeLimits&&t.objMaxResizeLimits.LaneTopLimit&&t.objMaxResizeLimits.LaneBottomLimit?i<t.objMaxResizeLimits.LaneTopLimit&&u>200&&(f=!0):f=!0):t.selectedResizergElement.getAttribute("id")=="ne"?(r=parseFloat(t.selectedElemForResize.getAttribute("x")),i=parseFloat(t.selectedElemForResize.getAttribute("y"))+dy,e=parseFloat(t.selectedElemForResize.getAttribute("height"))-dy,u=parseFloat(t.selectedElemForResize.getAttribute("width"))+dx,l=r+u-r,a=i+e-i,t.selectedShape.ShapeType!="participant"?w<r+u&&d>r+u&&b<i&&g>i&&l>20&&a>20&&(f=!0):t.objMaxResizeLimits&&t.objMaxResizeLimits.Left&&t.objMaxResizeLimits.Top&&t.objMaxResizeLimits.Right&&t.objMaxResizeLimits.Bottom&&t.objMaxResizeLimits.LaneTopLimit&&t.objMaxResizeLimits.LaneBottomLimit?u+r>=t.objMaxResizeLimits.Right&&i<=t.objMaxResizeLimits.Top&&i<t.objMaxResizeLimits.LaneTopLimit&&u>200&&(f=!0):t.objMaxResizeLimits&&t.objMaxResizeLimits.LaneTopLimit&&t.objMaxResizeLimits.LaneBottomLimit?i<t.objMaxResizeLimits.LaneTopLimit&&u>200&&(f=!0):f=!0):t.selectedResizergElement.getAttribute("id")=="sw"?(r=parseFloat(t.selectedElemForResize.getAttribute("x"))+dx,i=parseFloat(t.selectedElemForResize.getAttribute("y")),e=parseFloat(t.selectedElemForResize.getAttribute("height"))+dy,u=parseFloat(t.selectedElemForResize.getAttribute("width"))-dx,l=r+u-r,a=i+e-i,t.selectedShape.ShapeType!="participant"?w<r&&d>r&&b<i+e&&g>i+e&&l>20&&a>20&&(f=!0):t.objMaxResizeLimits&&t.objMaxResizeLimits.Left&&t.objMaxResizeLimits.Top&&t.objMaxResizeLimits.Right&&t.objMaxResizeLimits.Bottom&&t.objMaxResizeLimits.LaneTopLimit&&t.objMaxResizeLimits.LaneBottomLimit?r<=t.objMaxResizeLimits.Left-80&&i+e>=t.objMaxResizeLimits.Bottom&&i+e>t.objMaxResizeLimits.LaneBottomLimit&&u>200?f=!0:parseFloat(t.selectedElemForResize.getAttribute("x"))>=r&&i+e>=parseFloat(t.selectedElemForResize.getAttribute("y"))+parseFloat(t.selectedElemForResize.getAttribute("height"))&&(f=!0):t.objMaxResizeLimits&&t.objMaxResizeLimits.LaneTopLimit&&t.objMaxResizeLimits.LaneBottomLimit?i+e>t.objMaxResizeLimits.LaneBottomLimit&&u>200&&(f=!0):f=!0):t.selectedResizergElement.getAttribute("id")=="se"?(r=parseFloat(t.selectedElemForResize.getAttribute("x")),i=parseFloat(t.selectedElemForResize.getAttribute("y")),e=parseFloat(t.selectedElemForResize.getAttribute("height"))+dy,u=parseFloat(t.selectedElemForResize.getAttribute("width"))+dx,l=r+u-r,a=i+e-i,t.selectedShape.ShapeType!="participant"?w<r+u&&d>r+u&&b<i+e&&g>i+e&&l>20&&a>20&&(f=!0):t.objMaxResizeLimits&&t.objMaxResizeLimits.Left&&t.objMaxResizeLimits.Top&&t.objMaxResizeLimits.Right&&t.objMaxResizeLimits.Bottom&&t.objMaxResizeLimits.LaneTopLimit&&t.objMaxResizeLimits.LaneBottomLimit?u+r>=t.objMaxResizeLimits.Right&&i+e>=t.objMaxResizeLimits.Bottom&&i+e>t.objMaxResizeLimits.LaneBottomLimit&&u>200?f=!0:u+r>=parseFloat(t.selectedElemForResize.getAttribute("x"))+parseFloat(t.selectedElemForResize.getAttribute("width"))&&i+e>=parseFloat(t.selectedElemForResize.getAttribute("y"))+parseFloat(t.selectedElemForResize.getAttribute("height"))&&(f=!0):t.objMaxResizeLimits&&t.objMaxResizeLimits.LaneTopLimit&&t.objMaxResizeLimits.LaneBottomLimit?i+e>t.objMaxResizeLimits.LaneBottomLimit&&u>200&&(f=!0):f=!0):(t.selectedResizergElement.getAttribute("id")=="nse"||t.selectedResizergElement.getAttribute("id")=="nsw")&&(i=parseFloat(t.selectedElemForResize.getAttribute("y")),e=parseFloat(t.selectedElemForResize.getAttribute("height"))+dy,ft=i+e,t.objMaxResizeLimits&&ft>t.objMaxResizeLimits.Bottom&&(f=!0))}else f=!0;if(f){for(t.isDirty=!0,p=t.selectedResizergElement.parentNode,t.selectedResizergElement.getAttribute("id")!="nse"&&t.selectedResizergElement.getAttribute("id")!="nsw"&&t.selectedResizergElement.setAttribute("x",parseFloat(t.selectedResizergElement.getAttribute("x"))+dx),t.selectedResizergElement.setAttribute("y",parseFloat(t.selectedResizergElement.getAttribute("y"))+dy),angular.forEach($(t.selectedResizergElement).children(),function(n){t.selectedResizergElement.getAttribute("id")!="nse"&&t.selectedResizergElement.getAttribute("id")!="nsw"&&n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx);n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy)}),o=null,s=0;s<t.selectedElemForResize.childNodes.length;s++)if(t.selectedElemForResize.childNodes[s].getAttribute("id")=="MainElement"){o=t.selectedElemForResize.childNodes[s];break}for(k="",t.selectedElemForResize.id=="textAnnotation"&&(k="textAnnotation"),t.selectedResizergElement.getAttribute("id")=="nw"&&(t.selectedElemForResize!=0&&(t.selectedElemForResize.setAttribute("width",parseFloat(t.selectedElemForResize.getAttribute("width"))-dx),t.selectedElemForResize.setAttribute("height",parseFloat(t.selectedElemForResize.getAttribute("height"))-dy),t.selectedElemForResize.setAttribute("y",parseFloat(t.selectedElemForResize.getAttribute("y"))+dy),t.selectedElemForResize.setAttribute("x",parseFloat(t.selectedElemForResize.getAttribute("x"))+dx),angular.forEach($(t.selectedElemForResize).children(),function(n){var i,r,u,f;if(n.nodeName=="rect")n.id!="rectangleinsquareparam"&&n.setAttribute("width",parseFloat(n.getAttribute("width"))-dx),n.setAttribute("height",parseFloat(n.getAttribute("height"))-dy),n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy),n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx);else if(n.nodeName=="text")if(t.selectedElemForResize.id!="participant"){for(n.setAttribute("width",parseFloat(n.getAttribute("width"))-dx),n.setAttribute("height",parseFloat(n.getAttribute("height"))-dy),n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy),n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx),i=0;i<n.childNodes.length;i++)n.removeChild(n.childNodes[i]);n.textContent=t.objData.lstShapes[t.indexofResizerElement].Text;r=wraptorect(n,o,0,.5,k,t)}else{n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx);n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy);var e=parseFloat(n.getAttribute("x")),s=parseFloat(n.getAttribute("y")),h=parseFloat(o.getAttribute("height")),c="-90  "+e+","+s+" ",r=wraptorect(n,o,0,.5,"Participant",t),l="10 "+h/2;r.setAttribute("transform","translate("+l+") rotate("+c+")");r.setAttribute("text-anchor","middle")}else n.nodeName=="image"?t.objData.lstShapes[t.indexofResizerElement].ShapeType=="callActivity"?(u=parseFloat(t.selectedElemForResize.getAttribute("x"))+parseFloat(t.selectedElemForResize.getAttribute("width"))/2-10,f=parseFloat(t.selectedElemForResize.getAttribute("y"))+parseFloat(t.selectedElemForResize.getAttribute("height"))-20,n.setAttribute("x",u),n.setAttribute("y",f)):(n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy),n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx)):n.nodeName=="line"&&t.selectedElemForResize.id=="participant"?(n.setAttribute("y1",parseFloat(n.getAttribute("y1"))+dy),n.setAttribute("x1",parseFloat(n.getAttribute("x1"))+dx),n.setAttribute("x2",parseFloat(n.getAttribute("x2"))+dx)):n.nodeName=="g"&&t.selectedElemForResize.id=="textAnnotation"&&n.id=="textAnnotationLineGroup"&&(n.childNodes[0].setAttribute("y1",parseFloat(n.childNodes[0].getAttribute("y1"))+dy),n.childNodes[0].setAttribute("y2",parseFloat(n.childNodes[0].getAttribute("y2"))+dy),n.childNodes[0].setAttribute("x1",parseFloat(n.childNodes[0].getAttribute("x1"))+dx),n.childNodes[0].setAttribute("x2",parseFloat(n.childNodes[0].getAttribute("x2"))+dx),n.childNodes[1].setAttribute("y1",parseFloat(n.childNodes[1].getAttribute("y1"))+dy),n.childNodes[1].setAttribute("x1",parseFloat(n.childNodes[1].getAttribute("x1"))+dx),n.childNodes[1].setAttribute("x2",parseFloat(n.childNodes[1].getAttribute("x2"))+dx),n.childNodes[2].setAttribute("x1",parseFloat(n.childNodes[2].getAttribute("x1"))+dx),n.childNodes[2].setAttribute("x2",parseFloat(n.childNodes[2].getAttribute("x2"))+dx))})),angular.forEach($(p).children(),function(n){n.getAttribute("id")=="ne"&&(n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy),angular.forEach($(n).children(),function(n){n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy)}));n.getAttribute("id")=="sw"&&(n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx),angular.forEach($(n).children(),function(n){n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx)}))})),t.selectedResizergElement.getAttribute("id")=="ne"&&(t.selectedElemForResize!=0&&(t.selectedElemForResize.setAttribute("width",parseFloat(t.selectedElemForResize.getAttribute("width"))+dx),t.selectedElemForResize.setAttribute("height",parseFloat(t.selectedElemForResize.getAttribute("height"))-dy),t.selectedElemForResize.setAttribute("y",parseFloat(t.selectedElemForResize.getAttribute("y"))+dy),angular.forEach($(t.selectedElemForResize).children(),function(n){var i,r,u,f;if(n.nodeName=="rect")n.id!="rectangleinsquareparam"&&n.setAttribute("width",parseFloat(n.getAttribute("width"))+dx),n.setAttribute("height",parseFloat(n.getAttribute("height"))-dy),n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy);else if(n.nodeName=="text")if(t.selectedElemForResize.id!="participant"){for(n.setAttribute("width",parseFloat(n.getAttribute("width"))+dx),n.setAttribute("height",parseFloat(n.getAttribute("height"))-dy),n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy),i=0;i<n.childNodes.length;i++)n.removeChild(n.childNodes[i]);n.textContent=t.objData.lstShapes[t.indexofResizerElement].Text;r=wraptorect(n,o,0,.5,k,t)}else{n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy);var e=parseFloat(n.getAttribute("x")),s=parseFloat(n.getAttribute("y")),h=parseFloat(o.getAttribute("height")),c="-90  "+e+","+s+" ",r=wraptorect(n,o,0,.5,"Participant",t),l="10 "+h/2;r.setAttribute("transform","translate("+l+") rotate("+c+")");r.setAttribute("text-anchor","middle")}else n.nodeName=="image"?t.objData.lstShapes[t.indexofResizerElement].ShapeType=="callActivity"?(u=parseFloat(t.selectedElemForResize.getAttribute("x"))+parseFloat(t.selectedElemForResize.getAttribute("width"))/2-10,f=parseFloat(t.selectedElemForResize.getAttribute("y"))+parseFloat(t.selectedElemForResize.getAttribute("height"))-20,n.setAttribute("x",u),n.setAttribute("y",f)):n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy):n.nodeName=="line"&&t.selectedElemForResize.id=="participant"?n.setAttribute("y1",parseFloat(n.getAttribute("y1"))+dy):n.nodeName=="g"&&t.selectedElemForResize.id=="textAnnotation"&&n.id=="textAnnotationLineGroup"&&(n.childNodes[0].setAttribute("y1",parseFloat(n.childNodes[0].getAttribute("y1"))+dy),n.childNodes[0].setAttribute("y2",parseFloat(n.childNodes[0].getAttribute("y2"))+dy),n.childNodes[1].setAttribute("y1",parseFloat(n.childNodes[1].getAttribute("y1"))+dy))})),angular.forEach($(p).children(),function(n){n.getAttribute("id")=="nw"&&(n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy),angular.forEach($(n).children(),function(n){n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy)}));n.getAttribute("id")=="se"&&(n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx),angular.forEach($(n).children(),function(n){n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx)}))})),t.selectedResizergElement.getAttribute("id")=="sw"&&(t.selectedElemForResize!=0&&(t.selectedElemForResize.setAttribute("width",parseFloat(t.selectedElemForResize.getAttribute("width"))-dx),t.selectedElemForResize.setAttribute("height",parseFloat(t.selectedElemForResize.getAttribute("height"))+dy),t.selectedElemForResize.setAttribute("x",parseFloat(t.selectedElemForResize.getAttribute("x"))+dx),angular.forEach($(t.selectedElemForResize).children(),function(n){var i,r,u,f;if(n.nodeName=="rect")n.id!="rectangleinsquareparam"&&n.setAttribute("width",parseFloat(n.getAttribute("width"))-dx),n.setAttribute("height",parseFloat(n.getAttribute("height"))+dy),n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx);else if(n.nodeName=="text")if(t.selectedElemForResize.id!="participant"){for(n.setAttribute("width",parseFloat(n.getAttribute("width"))-dx),n.setAttribute("height",parseFloat(n.getAttribute("height"))+dy),n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx),i=0;i<n.childNodes.length;i++)n.removeChild(n.childNodes[i]);n.textContent=t.objData.lstShapes[t.indexofResizerElement].Text;r=wraptorect(n,o,0,.5,k,t)}else{n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx);n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy);var e=parseFloat(n.getAttribute("x")),s=parseFloat(n.getAttribute("y")),h=parseFloat(o.getAttribute("height")),c="-90  "+e+","+s+" ",r=wraptorect(n,o,0,.5,"Participant",t),l="10 "+h/2;r.setAttribute("transform","translate("+l+") rotate("+c+")");r.setAttribute("text-anchor","middle")}else n.nodeName=="image"?t.objData.lstShapes[t.indexofResizerElement].ShapeType=="callActivity"?(u=parseFloat(t.selectedElemForResize.getAttribute("x"))+parseFloat(t.selectedElemForResize.getAttribute("width"))/2-10,f=parseFloat(t.selectedElemForResize.getAttribute("y"))+parseFloat(t.selectedElemForResize.getAttribute("height"))-20,n.setAttribute("x",u),n.setAttribute("y",f)):n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx):n.nodeName=="line"&&t.selectedElemForResize.id=="participant"?(n.setAttribute("y2",parseFloat(n.getAttribute("y2"))+dy),n.setAttribute("x1",parseFloat(n.getAttribute("x1"))+dx),n.setAttribute("x2",parseFloat(n.getAttribute("x2"))+dx)):n.nodeName=="g"&&t.selectedElemForResize.id=="textAnnotation"&&n.id=="textAnnotationLineGroup"&&(n.childNodes[2].setAttribute("y1",parseFloat(n.childNodes[2].getAttribute("y1"))+dy),n.childNodes[2].setAttribute("y2",parseFloat(n.childNodes[2].getAttribute("y2"))+dy),n.childNodes[2].setAttribute("x1",parseFloat(n.childNodes[2].getAttribute("x1"))+dx),n.childNodes[2].setAttribute("x2",parseFloat(n.childNodes[2].getAttribute("x2"))+dx),n.childNodes[1].setAttribute("y2",parseFloat(n.childNodes[1].getAttribute("y2"))+dy),n.childNodes[1].setAttribute("x2",parseFloat(n.childNodes[1].getAttribute("x2"))+dx),n.childNodes[1].setAttribute("x1",parseFloat(n.childNodes[1].getAttribute("x1"))+dx),n.childNodes[0].setAttribute("x2",parseFloat(n.childNodes[0].getAttribute("x2"))+dx),n.childNodes[0].setAttribute("x1",parseFloat(n.childNodes[0].getAttribute("x1"))+dx))})),angular.forEach($(p).children(),function(n){n.getAttribute("id")=="se"&&(n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy),angular.forEach($(n).children(),function(n){n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy)}));n.getAttribute("id")=="nw"&&(n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx),angular.forEach($(n).children(),function(n){n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx)}))})),t.selectedResizergElement.getAttribute("id")=="se"&&(t.selectedElemForResize!=0&&(t.selectedElemForResize.setAttribute("width",parseFloat(t.selectedElemForResize.getAttribute("width"))+dx),t.selectedElemForResize.setAttribute("height",parseFloat(t.selectedElemForResize.getAttribute("height"))+dy),angular.forEach($(t.selectedElemForResize).children(),function(n){var i,r,u,f;if(n.nodeName=="rect")n.id!="rectangleinsquareparam"&&n.setAttribute("width",parseFloat(n.getAttribute("width"))+dx),n.setAttribute("height",parseFloat(n.getAttribute("height"))+dy);else if(n.nodeName=="text")if(t.selectedElemForResize.id!="participant"){for(n.setAttribute("width",parseFloat(n.getAttribute("width"))+dx),n.setAttribute("height",parseFloat(n.getAttribute("height"))+dy),i=0;i<n.childNodes.length;i++)n.removeChild(n.childNodes[i]);n.textContent=t.objData.lstShapes[t.indexofResizerElement].Text;r=wraptorect(n,o,0,.5,k,t)}else{n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy);var e=parseFloat(n.getAttribute("x")),s=parseFloat(n.getAttribute("y")),h=parseFloat(o.getAttribute("height")),c="-90  "+e+","+s+" ",r=wraptorect(n,o,0,.5,"Participant",t),l="10 "+h/2;r.setAttribute("transform","translate("+l+") rotate("+c+")");r.setAttribute("text-anchor","middle")}else n.nodeName=="image"?t.objData.lstShapes[t.indexofResizerElement].ShapeType=="callActivity"&&(u=parseFloat(t.selectedElemForResize.getAttribute("x"))+parseFloat(t.selectedElemForResize.getAttribute("width"))/2-10,f=parseFloat(t.selectedElemForResize.getAttribute("y"))+parseFloat(t.selectedElemForResize.getAttribute("height"))-20,n.setAttribute("x",u),n.setAttribute("y",f)):n.nodeName=="line"&&t.selectedElemForResize.id=="participant"?n.setAttribute("y2",parseFloat(n.getAttribute("y2"))+dy):n.nodeName=="g"&&t.selectedElemForResize.id=="textAnnotation"&&n.id=="textAnnotationLineGroup"&&(n.childNodes[2].setAttribute("y1",parseFloat(n.childNodes[2].getAttribute("y1"))+dy),n.childNodes[2].setAttribute("y2",parseFloat(n.childNodes[2].getAttribute("y2"))+dy),n.childNodes[1].setAttribute("y2",parseFloat(n.childNodes[1].getAttribute("y2"))+dy))})),angular.forEach($(p).children(),function(n){n.getAttribute("id")=="sw"&&(n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy),angular.forEach($(n).children(),function(n){n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy)}));n.getAttribute("id")=="ne"&&(n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx),angular.forEach($(n).children(),function(n){n.setAttribute("x",parseFloat(n.getAttribute("x"))+dx)}))})),(t.selectedResizergElement.getAttribute("id")=="nse"||t.selectedResizergElement.getAttribute("id")=="nsw")&&t.selectedElemForResize!=0&&(t.selectedElemForResize.setAttribute("height",parseFloat(t.selectedElemForResize.getAttribute("height"))+dy),angular.forEach($(t.selectedElemForResize).children(),function(n){if(n.nodeName=="rect")n.setAttribute("height",parseFloat(n.getAttribute("height"))+dy);else if(n.nodeName=="text"){n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy);var r=parseFloat(n.getAttribute("x")),u=parseFloat(n.getAttribute("y")),f=parseFloat(o.getAttribute("height")),e="-90  "+r+","+u+" ",i=wraptorect(n,o,0,.5,"Participant",t),s="10 "+f/2;i.setAttribute("transform","translate("+s+") rotate("+e+")");i.setAttribute("text-anchor","middle")}}),tt="nse",t.selectedResizergElement.getAttribute("id")=="nse"&&(tt="nsw"),angular.forEach($(p).children(),function(n){n.getAttribute("id")==tt&&(n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy),angular.forEach($(n).children(),function(n){n.setAttribute("y",parseFloat(n.getAttribute("y"))+dy)}))})),t.hoverElement=t.selectedElemForResize,hoverOnElement(null,t),s=0;s<t.selectedResizergElement.parentNode.childNodes.length;s++)if(t.selectedResizergElement.parentNode.childNodes[s].id=="resizerborder"){for(x=parseFloat(t.selectedElemForResize.getAttribute("x"))-5,y=parseFloat(t.selectedElemForResize.getAttribute("y"))-5,Height=parseFloat(t.selectedElemForResize.getAttribute("height"))+10,Width=parseFloat(t.selectedElemForResize.getAttribute("width"))+10,nt=0;nt<t.selectedResizergElement.parentNode.childNodes[s].childNodes.length;nt++)t.selectedResizergElement.parentNode.childNodes[s].removeChild(t.selectedResizergElement.parentNode.childNodes[s].childNodes[nt]),nt--;for(h=[],it={Left:x,Top:y},h.push(it),et={Left:x+Width,Top:y},h.push(et),ot={Left:x+Width,Top:y+Height},h.push(ot),st={Left:x,Top:y+Height},h.push(st),h.push(it),v=0;v<h.length;v++)v<h.length-1&&(c=document.createElementNS(t.svgNS,"line"),c.setAttribute("id","resizerline"),c.setAttribute("x1",h[v].Left),c.setAttribute("y1",h[v].Top),c.setAttribute("x2",h[v+1].Left),c.setAttribute("y2",h[v+1].Top),c.setAttribute("stroke-width",2),c.setAttributeNS(null,"stroke","#4c4c4c"),t.selectedResizergElement.parentNode.childNodes[s].appendChild(c));break}t.selectedElemForResize.id!="participant"&&t.selectedElemForResize.id!="textAnnotation"&&t.selectedElemForResize.id!="lane"&&GenerateRightPanelForAddingElements(p,t.selectedElemForResize,t);t.currentX=n.offsetX;t.currentY=n.offsetY}}else deselectResizergElement(n)}function removeRearrangingLinePoints(n){for(k=0;k<n.svgElement.childNodes.length;k++)if(n.svgElement.childNodes[k].nodeName!="#text"&&n.svgElement.childNodes[k].nodeName!="#comment"&&n.svgElement.childNodes[k].getAttribute("id")=="linedraggablegroup"){n.svgElement.removeChild(n.svgElement.childNodes[k]);break}}function getObjShapeoftheLine(n,t,i){var r;if(t.activeTab=="EXECUTION"){for(r=0;r<t.lstExecutionTabShapes.length;r++)if((t.lstExecutionTabShapes[r].ShapeType=="sequenceFlow"||t.lstExecutionTabShapes[r].ShapeType=="dataOutputAssociation"||t.lstExecutionTabShapes[r].ShapeType=="association"||t.lstExecutionTabShapes[r].ShapeType=="messageFlow"||t.lstExecutionTabShapes[r].ShapeType=="dataInputAssociation")&&t.lstExecutionTabShapes[r].Id==i){n==""?(t.indexOfSelectedLine=r,t.selectedShape=t.lstExecutionTabShapes[r]):t.objDragOverLineElement=t.lstExecutionTabShapes[r];break}}else for(r=0;r<t.objData.lstShapes.length;r++)if((t.objData.lstShapes[r].ShapeType=="sequenceFlow"||t.objData.lstShapes[r].ShapeType=="dataOutputAssociation"||t.objData.lstShapes[r].ShapeType=="association"||t.objData.lstShapes[r].ShapeType=="messageFlow"||t.objData.lstShapes[r].ShapeType=="dataInputAssociation")&&t.objData.lstShapes[r].Id==i){n==""?(t.indexOfSelectedLine=r,t.selectedShape=t.objData.lstShapes[r]):t.objDragOverLineElement=t.objData.lstShapes[r];break}if(n!="")return t.objDragOverLineElement}function selectedlineElement(n,t){var i,o,r,c,l,s,h,f,e,u;if(i=n&&n!=null?angular.element(t).scope():t,i.selectedElementID){function y(){i.selectedElementID=undefined}i.$apply(y)}i.selectedLineEle&&i.activeTab=="MAP"&&setColorToSelectedLine(i.selectedLineEle,"remove");removeRearrangingLinePoints(i);removeSelection("line",i);removeSelectionForLane(i);i.selectedElemForResize=null;i._previousPosition={Left:0,Top:0};i.linecount=0;removeResizerAroundElement(i);o=document.createElementNS(i.svgNS,"g");o.setAttribute("id","linedraggablegroup");i.svgElement.appendChild(o);n!=null&&n!=undefined&&(i.selectedLineEle=n.currentTarget);i.activeTab=="MAP"&&setColorToSelectedLine(i.selectedLineEle,"set");checkTitleIsPresentOrDeleteTitle(i.selectedLineEle,"Delete");var a="",v="",p=i.selectedLineEle.childNodes[0].getAttribute("id");if(getObjShapeoftheLine("",i,p),i.selectedShape!=null&&i.selectedShape!=undefined&&i.selectedShape!=""&&(a=i.selectedShape.SourceElement,v=i.selectedShape.TargetElement),a!=""&&v!="")for(r=0;r<i.objData.lstShapes.length;r++)i.objData.lstShapes[r].Id==a?i.selectedLineSourceElement=i.objData.lstShapes[r]:i.objData.lstShapes[r].Id==v&&(i.selectedLineTargetElement=i.objData.lstShapes[r]);if(i.activeTab=="MAP"&&i.IsMapEditable&&!i.IsVersionDisplay)if(i.selectedLineEle.childNodes.length>1)for(r=0;r<i.selectedLineEle.childNodes.length;r++)if(c=0,l=0,r==0)f=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("x1")),e=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("y1")),c=f,l=e,s=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("x2")),h=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("y2")),f-s>=-1&&f-s<=1?(u="crosshair",generateBoundsDynamicallyToLine(u,c,l,o,i)):e-h>=-1&&e-h<=1&&(u="crosshair",generateBoundsDynamicallyToLine(u,c,l,o,i));else if(r==i.selectedLineEle.childNodes.length-1)s=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("x2")),h=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("y2")),c=s,l=h,f=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("x1")),e=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("y1")),f-s>=-1&&f-s<=1?(u="crosshair",generateBoundsDynamicallyToLine(u,c,l,o,i)):e-h>=-1&&e-h<=1&&(u="crosshair",generateBoundsDynamicallyToLine(u,c,l,o,i));else{var f=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("x1")),e=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("y1")),s=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("x2")),h=parseFloat(i.selectedLineEle.childNodes[r].childNodes[0].getAttribute("y2"));f-s>=-1&&f-s<=1?(c=f,l=(e+h)/2,u="ew",generateBoundsDynamicallyToLine(u,c,l,o,i)):e-h>=-1&&e-h<=1&&(l=e,c=(f+s)/2,u="ns",generateBoundsDynamicallyToLine(u,c,l,o,i))}else{var f=parseFloat(i.selectedLineEle.childNodes[0].childNodes[0].getAttribute("x1")),e=parseFloat(i.selectedLineEle.childNodes[0].childNodes[0].getAttribute("y1")),s=parseFloat(i.selectedLineEle.childNodes[0].childNodes[0].getAttribute("x2")),h=parseFloat(i.selectedLineEle.childNodes[0].childNodes[0].getAttribute("y2"));f-s>=-1&&f-s<=1?(u="crosshair",generateBoundsDynamicallyToLine(u,f,e,o,i),generateBoundsDynamicallyToLine(u,s,h,o,i)):e-h>=-1&&e-h<=1?(u="crosshair",generateBoundsDynamicallyToLine(u,f,e,o,i),generateBoundsDynamicallyToLine(u,s,h,o,i)):(u="crosshair",generateBoundsDynamicallyToLine(u,f,e,o,i),generateBoundsDynamicallyToLine(u,s,h,o,i))}i.showDetails();i.selectedShape&&(i.selectedElementID=i.selectedShape.Id);i.$apply()}function setColorToSelectedLine(n,t){if(n)for(var i=0;i<n.childNodes.length;i++)n.childNodes[i].nodeName=="g"&&(t=="set"?(n.childNodes[i].childNodes[0].setAttribute("stroke","#dd4205"),n.childNodes[i].childNodes[0].setAttribute("stroke-width",1),n.childNodes[i].childNodes[1].setAttributeNS(null,"stroke","#dd4205"),n.childNodes[i].childNodes[1].setAttributeNS(null,"stroke-opacity",.1)):(n.childNodes[i].childNodes[0].setAttribute("stroke","#3a3a3a"),n.childNodes[i].childNodes[0].setAttribute("stroke-width",1),n.childNodes[i].childNodes[1].setAttributeNS(null,"stroke","transparent")))}function generateBoundsDynamicallyToLine(n,t,i,r,u){var o=document.createElementNS(u.svgNS,"g"),f,e;o.setAttribute("id",u.linecount);u.linecount++;o.setAttribute("onmousedown","selectedlinegtagElement(evt)");n=="ns"?o.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-n"):n=="ew"?o.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-e"):n=="crosshair"&&o.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-crosshair");f=document.createElementNS(u.svgNS,"rect");f.setAttributeNS(null,"id","rectanglene");f.setAttributeNS(null,"class","djs-resizer-visual");f.setAttributeNS(null,"x",t-2.5);f.setAttributeNS(null,"y",i-2.5);f.setAttributeNS(null,"height",5);f.setAttributeNS(null,"width",5);f.setAttributeNS(null,"fill","orange");f.setAttributeNS(null,"stroke","none");o.appendChild(f);e=document.createElementNS(u.svgNS,"rect");e.setAttributeNS(null,"id","rectanglene");e.setAttributeNS(null,"class","djs-resizer-hit");e.setAttributeNS(null,"x",t-5);e.setAttributeNS(null,"y",i-5);e.setAttributeNS(null,"height",10);e.setAttributeNS(null,"width",10);e.setAttributeNS(null,"fill","orange");e.setAttributeNS(null,"stroke","none");o.appendChild(e);r.appendChild(o)}function selectedlinegtagElement(n){var t=angular.element(n.currentTarget).scope();t.activeTab!="EXECUTION"&&(t.selectedlinegtagEle=n.currentTarget,t.selectedlineindex=parseFloat(t.selectedlinegtagEle.getAttribute("id")),t.currentX=n.offsetX,t.currentY=n.offsetY,t.isMouseDown=!0,t.cursorPositionOnElement="",t.svgElement.setAttributeNS(null,"onmousemove","movelinegElement(evt)"),t.svgElement.setAttributeNS(null,"onmouseup","deselectlinegElementonMouseUp(evt)"))}function getLastlaneIndex(n){for(var i,r,t=0;t<n.svgElement.childNodes.length;t++)if(r=0,n.svgElement.childNodes[t].getAttribute&&(i=n.svgElement.childNodes[t].getAttribute("elementtype")),i&&i!="participant"&&i!="lane"){r=t;break}return r}function getEdgePosition(n,t,i,r){var u;return r?n>=t.Top&&n<=t.Top+i?u="Top":n<=t.Top+t.Height&&n>=t.Top+t.Height-i&&(u="Bottom"):n>=t.Left&&n<=t.Left+i?u="Left":n<=t.Left+t.Width&&n>=t.Left+t.Width-i&&(u="Right"),u}function movelinegElement(n){var t=angular.element(n.currentTarget).scope(),ut,w,tt,p,o,s,c,l,b;if(t.isMouseDown&&n.buttons==1){t.ClonedLineElement==null&&(t.isDirty=!0,t.ClonedLineElement=t.selectedLineEle.cloneNode(!0),t.$apply(function(){t.DraggableElement=!0}),t.selectedLineEle.setAttribute("style","opacity: 0.5;"),t.ClonedLineElement.setAttribute("id","ClonedLine"),ut=getLastlaneIndex(t),t.svgElement.insertBefore(t.ClonedLineElement,t.svgElement.childNodes[ut]));t.hoverElement!=null&&removehoverCircle(n,n.currentTarget);dx=n.offsetX-t.currentX;dy=n.offsetY-t.currentY;var i=0,r=0,u=0,f=0,k=0,d=0,g=0,nt=0,a=4,it=7,e;if(t.selectedlinegtagEle!=0&&(w="",t.ClonedLineElement.childNodes.length>1&&(w=t.selectedlineindex==t.selectedLineEle.childNodes.length-1||t.selectedlineindex==1&&t.selectedLineEle.childNodes.length==1?t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1]:t.ClonedLineElement.childNodes[t.selectedlineindex],w?(i=parseFloat(w.childNodes[0].getAttribute("x1")),r=parseFloat(w.childNodes[0].getAttribute("y1")),u=parseFloat(w.childNodes[0].getAttribute("x2")),f=parseFloat(w.childNodes[0].getAttribute("y2"))):deselectlinegElementonMouseUp(n)),t.ClonedLineElement&&t.ClonedLineElement.childNodes))if(t.ClonedLineElement.childNodes.length==1){if(t.selectedlineindex==0){t.ClonedLineElement.childNodes[0].childNodes[0].setAttribute("x1",parseFloat(t.ClonedLineElement.childNodes[0].childNodes[0].getAttribute("x1"))+dx);t.ClonedLineElement.childNodes[0].childNodes[0].setAttribute("y1",parseFloat(t.ClonedLineElement.childNodes[0].childNodes[0].getAttribute("y1"))+dy);t.ClonedLineElement.childNodes[0].childNodes[1].setAttribute("x1",parseFloat(t.ClonedLineElement.childNodes[0].childNodes[1].getAttribute("x1"))+dx);t.ClonedLineElement.childNodes[0].childNodes[1].setAttribute("y1",parseFloat(t.ClonedLineElement.childNodes[0].childNodes[1].getAttribute("y1"))+dy);t.ClonedLineSourceElement=t.targetElementForLine!=null?{Left:parseFloat(t.targetElementForLine.getAttribute("x")),Top:parseFloat(t.targetElementForLine.getAttribute("y")),Height:parseFloat(t.targetElementForLine.getAttribute("height")),Width:parseFloat(t.targetElementForLine.getAttribute("width"))}:t.selectedLineSourceElement;var h=t.ClonedLineSourceElement,rt={Left:parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("x2")),Top:parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("y2"))},v={Left:n.offsetX,Top:n.offsetY},y=t.selectedLineTargetElement;if(t._previousPosition=v,t.targetElementForLine==null&&(h={Left:n.offsetX,Top:n.offsetY,Height:10,Width:10}),c=UpdateTargetPoint(v,y,h,t),c!=undefined){for(l=GetEdgeWayPoints(y,h,rt,c),tt=[],p=l.length-1;p>=0;p--)tt.push(l[p]);GenerateClonedLine(tt,t.ClonedLineElement,t)}}else if(t.selectedlineindex==1){t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].setAttribute("x2",parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("x2"))+dx);t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].setAttribute("y2",parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("y2"))+dy);t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].setAttribute("x2",parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].getAttribute("x2"))+dx);t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].setAttribute("y2",parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].getAttribute("y2"))+dy);t.ClonedLineTargetElement=t.targetElementForLine!=null?{Left:parseFloat(t.targetElementForLine.getAttribute("x")),Top:parseFloat(t.targetElementForLine.getAttribute("y")),Height:parseFloat(t.targetElementForLine.getAttribute("height")),Width:parseFloat(t.targetElementForLine.getAttribute("width"))}:t.selectedLineTargetElement;var h=t.selectedLineSourceElement,rt={Left:parseFloat(t.ClonedLineElement.childNodes[0].childNodes[0].getAttribute("x1")),Top:parseFloat(t.ClonedLineElement.childNodes[0].childNodes[0].getAttribute("y1"))},v={Left:n.offsetX,Top:n.offsetY},y=t.ClonedLineTargetElement;t._previousPosition=v;t.targetElementForLine==null&&(h={Left:n.offsetX,Top:n.offsetY,Height:10,Width:10});c=UpdateTargetPoint(v,y,h,t);c!=undefined&&(l=GetEdgeWayPoints(h,y,rt,c),GenerateClonedLine(l,t.ClonedLineElement,t))}b="";t.targetElementForLine!=null?(b=t.selectedlineindex==0?GetIntersectionPoint(t.ClonedLineElement,"First",t):GetIntersectionPoint(t.ClonedLineElement,"Last",t),removeIntersectionPoint(t),generatePointAtintersectionOflineandElement(b,t)):removeIntersectionPoint(t)}else if(t.selectedlineindex==0){if(t.ClonedLineSourceElement=t.targetElementForLine!=null?{Left:parseFloat(t.targetElementForLine.getAttribute("x")),Top:parseFloat(t.targetElementForLine.getAttribute("y")),Height:parseFloat(t.targetElementForLine.getAttribute("height")),Width:parseFloat(t.targetElementForLine.getAttribute("width"))}:t.selectedLineSourceElement,i=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].getAttribute("x1")),u=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].getAttribute("x2")),r=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].getAttribute("y1")),f=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].getAttribute("y2")),t.ClonedLineElement.childNodes[t.selectedlineindex+1]!=undefined&&(k=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[0].getAttribute("x1")),d=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[0].getAttribute("y1")),g=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[0].getAttribute("x2")),nt=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[0].getAttribute("y2"))),i-u>=-1&&i-u<=1&&d-nt>-1&&d-nt<1?(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("x2",u+dx),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("x2",u+dx),t.ClonedLineElement.childNodes[t.selectedlineindex+1]!=undefined&&(t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[0].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[1].setAttribute("x1",i+dx)),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("y1",r+dy),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("y1",r+dy),t.isEdgeChanged=!1,e=getEdgePosition(r,t.ClonedLineSourceElement,it,!0),t.cursorPositionOnElement||(t.cursorPositionOnElement=e),o=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].getAttribute("x1")),s=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].getAttribute("y1")),s<=t.ClonedLineSourceElement.Top+t.ClonedLineSourceElement.Height+1&&s>=t.ClonedLineSourceElement.Top-1?o<=t.ClonedLineSourceElement.Left+t.ClonedLineSourceElement.Width-a&&o>=t.ClonedLineSourceElement.Left+a?(t.isEdgeChanged=!1,e&&t.cursorPositionOnElement!=e&&(t.isEdgeChanged=!0,t.cursorPositionOnElement="")):t.isEdgeChanged=!0:t.isEdgeChanged=o>t.ClonedLineSourceElement.Left+t.ClonedLineSourceElement.Width||o<t.ClonedLineSourceElement.Left?!0:!0):r-f>=-1&&r-f<=1&&k-g>-1&&k-g<1&&(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("y1",r+dy),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("y2",f+dy),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("y1",r+dy),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("y2",f+dy),t.ClonedLineElement.childNodes[t.selectedlineindex+1]!=undefined&&(t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[0].setAttribute("y1",r+dy),t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[1].setAttribute("y1",r+dy)),o=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].getAttribute("x1")),s=parseFloat(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].getAttribute("y1")),t.isEdgeChanged=!1,e=getEdgePosition(i,t.ClonedLineSourceElement,it,!1),t.cursorPositionOnElement||(t.cursorPositionOnElement=e),o<=t.ClonedLineSourceElement.Left+t.ClonedLineSourceElement.Width+1&&o>=t.ClonedLineSourceElement.Left-1?s<=t.ClonedLineSourceElement.Top+t.ClonedLineSourceElement.Height-a&&s>=t.ClonedLineSourceElement.Top+a?(t.isEdgeChanged=!1,e&&t.cursorPositionOnElement!=e&&(t.isEdgeChanged=!0,t.cursorPositionOnElement="")):t.isEdgeChanged=!0:t.isEdgeChanged=s>t.ClonedLineSourceElement.Top+t.ClonedLineSourceElement.Height||s<t.ClonedLineSourceElement.Top?!0:!0),t.isEdgeChanged&&t.targetElementForLine!=null){var h=t.ClonedLineSourceElement,rt={Left:parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("x2")),Top:parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("y2"))},v={Left:n.offsetX,Top:n.offsetY},y=t.selectedLineTargetElement;if(t._previousPosition=v,t.targetElementForLine==null&&(h={Left:n.offsetX,Top:n.offsetY,Height:10,Width:10}),c=UpdateTargetPoint(v,h,y,t),c!=undefined){for(l=GetEdgeWayPoints(y,h,rt,c),tt=[],p=l.length-1;p>=0;p--)tt.push(l[p]);GenerateClonedLine(tt,t.ClonedLineElement,t)}}t.targetElementForLine!=null?(b=GetIntersectionPoint(t.ClonedLineElement,"First",t),removeIntersectionPoint(t),generatePointAtintersectionOflineandElement(b,t)):removeIntersectionPoint(t)}else if(t.selectedlineindex==t.selectedLineEle.childNodes.length-1||t.selectedLineEle.childNodes.length==1&&t.selectedlineindex==1){if(t.ClonedLineTargetElement=t.targetElementForLine!=null?{Left:parseFloat(t.targetElementForLine.getAttribute("x")),Top:parseFloat(t.targetElementForLine.getAttribute("y")),Height:parseFloat(t.targetElementForLine.getAttribute("height")),Width:parseFloat(t.targetElementForLine.getAttribute("width"))}:t.selectedLineTargetElement,i=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("x1")),u=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("x2")),r=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("y1")),f=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("y2")),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2]!=undefined&&(k=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2].childNodes[0].getAttribute("x1")),d=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2].childNodes[0].getAttribute("y1")),g=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2].childNodes[0].getAttribute("x2")),nt=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2].childNodes[0].getAttribute("y2"))),i-u>=-1&&i-u<=1&&d-nt>-1&&d-nt<1?(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].setAttribute("x2",u+dx),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].setAttribute("x2",u+dx),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2]!=undefined&&(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2].childNodes[0].setAttribute("x2",u+dx),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2].childNodes[1].setAttribute("x2",u+dx)),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].setAttribute("y2",f+dy),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].setAttribute("y2",f+dy),o=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("x2")),s=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("y2")),t.isEdgeChanged=!1,e=getEdgePosition(f,t.ClonedLineTargetElement,it,!0),t.cursorPositionOnElement||(t.cursorPositionOnElement=e),s<=t.ClonedLineTargetElement.Top+t.ClonedLineTargetElement.Height+1&&s>=t.ClonedLineTargetElement.Top-1?o<=t.ClonedLineTargetElement.Left+t.ClonedLineTargetElement.Width-a&&o>=t.ClonedLineTargetElement.Left+a?(t.isEdgeChanged=!1,e&&t.cursorPositionOnElement!=e&&(t.isEdgeChanged=!0,t.cursorPositionOnElement="")):t.isEdgeChanged=!0:t.isEdgeChanged=o>t.ClonedLineTargetElement.Left+t.ClonedLineTargetElement.Width||o<t.ClonedLineTargetElement.Left?!0:!0):r-f>=-1&&r-f<=1&&k-g>-1&&k-g<1&&(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].setAttribute("y2",f+dy),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].setAttribute("x2",u+dx),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].setAttribute("y1",r+dy),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].setAttribute("y2",f+dy),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].setAttribute("x2",u+dx),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[1].setAttribute("y1",r+dy),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2]!=undefined&&(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2].childNodes[0].setAttribute("y2",f+dy),t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-2].childNodes[1].setAttribute("y2",f+dy)),o=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("x2")),s=parseFloat(t.ClonedLineElement.childNodes[t.ClonedLineElement.childNodes.length-1].childNodes[0].getAttribute("y2")),t.isEdgeChanged=!1,e=getEdgePosition(u,t.ClonedLineTargetElement,it,!1),t.cursorPositionOnElement||(t.cursorPositionOnElement=e),o<=t.ClonedLineTargetElement.Left+t.ClonedLineTargetElement.Width+1&&o>=t.ClonedLineTargetElement.Left-1?s<=t.ClonedLineTargetElement.Top+t.ClonedLineTargetElement.Height-a&&s>=t.ClonedLineTargetElement.Top+a?(t.isEdgeChanged=!1,e&&t.cursorPositionOnElement!=e&&(t.isEdgeChanged=!0,t.cursorPositionOnElement="")):t.isEdgeChanged=!0:t.isEdgeChanged=s>t.ClonedLineTargetElement.Top+t.ClonedLineTargetElement.Height||s<t.ClonedLineTargetElement.Top?!0:!0),t.isEdgeChanged&&t.targetElementForLine!=null){var h=t.selectedLineSourceElement,rt={Left:parseFloat(t.ClonedLineElement.childNodes[0].childNodes[0].getAttribute("x1")),Top:parseFloat(t.ClonedLineElement.childNodes[0].childNodes[0].getAttribute("y1"))},v={Left:n.offsetX,Top:n.offsetY},y=t.ClonedLineTargetElement;t._previousPosition=v;t.targetElementForLine==null&&(h={Left:n.offsetX,Top:n.offsetY,Height:10,Width:10});c=UpdateTargetPoint(v,y,h,t);c!=undefined&&(l=GetEdgeWayPoints(h,y,rt,c),GenerateClonedLine(l,t.ClonedLineElement,t))}t.targetElementForLine!=null?(b=GetIntersectionPoint(t.ClonedLineElement,"Last",t),removeIntersectionPoint(t),generatePointAtintersectionOflineandElement(b,t)):removeIntersectionPoint(t)}else i-u>=-1&&i-u<=1?t.selectedlineindex!=0&&t.selectedlineindex!=t.selectedLineEle.childNodes.length-1&&(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("x2",u+dx),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("x2",u+dx),t.selectedlineindex!=0&&(t.ClonedLineElement.childNodes[t.selectedlineindex-1].childNodes[0].setAttribute("x2",u+dx),t.ClonedLineElement.childNodes[t.selectedlineindex-1].childNodes[1].setAttribute("x2",u+dx)),t.selectedlineindex!=t.ClonedLineElement.childNodes.length-1&&(t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[0].setAttribute("x1",i+dx),t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[1].setAttribute("x1",i+dx))):r-f>=-1&&r-f<=1&&t.selectedlineindex!=0&&t.selectedlineindex!=t.selectedLineEle.childNodes.length-1&&(t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("y1",r+dy),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[0].setAttribute("y2",f+dy),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("y1",r+dy),t.ClonedLineElement.childNodes[t.selectedlineindex].childNodes[1].setAttribute("y2",f+dy),t.selectedlineindex!=0&&(t.ClonedLineElement.childNodes[t.selectedlineindex-1].childNodes[0].setAttribute("y2",f+dy),t.ClonedLineElement.childNodes[t.selectedlineindex-1].childNodes[1].setAttribute("y2",f+dy)),t.selectedlineindex!=t.ClonedLineElement.childNodes.length-1&&(t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[0].setAttribute("y1",r+dy),t.ClonedLineElement.childNodes[t.selectedlineindex+1].childNodes[1].setAttribute("y1",r+dy)));t.currentX=n.offsetX;t.currentY=n.offsetY}else deselectlinegElementonMouseUp(n)}function GetIntersectionPoint(n,t,i){var r={Left:parseFloat(i.targetElementForLine.getAttribute("x")),Top:parseFloat(i.targetElementForLine.getAttribute("y")),Height:parseFloat(i.targetElementForLine.getAttribute("height")),Width:parseFloat(i.targetElementForLine.getAttribute("width"))},u={Left:-20,Top:0},f;return t=="First"?(x1=parseFloat(n.childNodes[0].childNodes[0].getAttribute("x1")),y1=parseFloat(n.childNodes[0].childNodes[0].getAttribute("y1")),x2=parseFloat(n.childNodes[0].childNodes[0].getAttribute("x2")),y2=parseFloat(n.childNodes[0].childNodes[0].getAttribute("y2")),f=!1,y1<=r.Top+r.Height&&y1>=r.Top&&x1>=r.Left&&x1<=r.Left+r.Width&&(y1-y2>-1&&y1-y2<1?x2>r.Left+r.Width&&x1<r.Left+r.Width?(u.Left=r.Left+r.Width,u.Top=y1):x2<r.Left&&x1>r.Left&&(u.Left=r.Left,u.Top=y1):x1-x2>-1&&x1-x2<1&&(y2>r.Top+r.Height&&y1<r.Top+r.Height?(u.Left=x1,u.Top=r.Top+r.Height):y2<r.Top&&y1>r.Top&&(u.Left=x1,u.Top=r.Top)))):t=="Last"&&(x1=parseFloat(n.childNodes[n.childNodes.length-1].childNodes[0].getAttribute("x1")),y1=parseFloat(n.childNodes[n.childNodes.length-1].childNodes[0].getAttribute("y1")),x2=parseFloat(n.childNodes[n.childNodes.length-1].childNodes[0].getAttribute("x2")),y2=parseFloat(n.childNodes[n.childNodes.length-1].childNodes[0].getAttribute("y2")),y2<=r.Top+r.Height&&y2>=r.Top&&x2<=r.Left+r.Width&&x2>=r.Left&&(y1-y2>-1&&y1-y2<1?x1>r.Left+r.Width&&x2<r.Left+r.Width?(u.Left=r.Left+r.Width,u.Top=y2):x1<r.Left&&x2>r.Left&&(u.Left=r.Left,u.Top=y2):x1-x2>-1&&x1-x2<1&&(y1>r.Top+r.Height&&y2<r.Top+r.Height?(u.Left=x2,u.Top=r.Top+r.Height):y1<r.Top&&y2>r.Top&&(u.Left=x2,u.Top=r.Top)))),u}function generatePointAtintersectionOflineandElement(n,t){var i=document.createElementNS(t.svgNS,"circle");i.setAttributeNS(null,"id","intersectionPoint");i.setAttributeNS(null,"cx",n.Left);i.setAttributeNS(null,"cy",n.Top);i.setAttributeNS(null,"r",3);i.setAttribute("onmousedown","selectoncircle(evt)");i.setAttributeNS(null,"fill","red");i.setAttributeNS(null,"stroke","black");t.svgElement.appendChild(i)}function removeIntersectionPoint(n){for(var i,t=n.svgElement.childNodes.length-1;t>0;t--)n.svgElement.childNodes[t].nodeName!="#text"&&n.svgElement.childNodes[t].nodeName!="#comment"&&(i=n.svgElement.childNodes[t].getAttribute("id"),i=="intersectionPoint"&&(n.svgElement.removeChild(n.svgElement.childNodes[t]),t--))}function GenerateClonedLine(n,t,i){for(var s="",r,e,u,h,f,s=i.ClonedLineElement?i.ClonedLineElement.childNodes[0].getAttribute("id"):t.childNodes[0].getAttribute("id"),o=0;o<t.childNodes.length;o++)t.removeChild(t.childNodes[o]),o--;for(r=0;r<n.length;r++)r<n.length-1&&(e=document.createElementNS(i.svgNS,"g"),e.setAttribute("id",s),e.setAttribute("elementtype","linegroup"),u=document.createElementNS(i.svgNS,"line"),u.setAttribute("id",s),u.setAttribute("x1",n[r].Left),u.setAttribute("y1",n[r].Top),u.setAttribute("x2",n[r+1].Left),u.setAttribute("y2",n[r+1].Top),(i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="dataOutputAssociation"||i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="association"||i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="messageFlow"||i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="dataInputAssociation")&&(u.setAttribute("stroke-dasharray","6,4"),i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="messageFlow"&&(t.setAttribute("ondragover","SetDragOverLineElement(evt)"),t.setAttribute("ondragleave","SetNullOnDragleaveLineElement(evt)"))),u.setAttributeNS(null,"stroke-width",1),u.setAttributeNS(null,"stroke","#dd4205"),(r==n.length-2||n.length==2)&&i.objData.lstShapes[i.indexOfSelectedLine].ShapeType!="association"&&(h="url(#arrow_"+i.$root.currentopenfile.file.FileName+")",u.setAttribute("marker-end",h)),f=document.createElementNS(i.svgNS,"line"),f.setAttribute("id",s),f.setAttribute("x1",n[r].Left),f.setAttribute("y1",n[r].Top),f.setAttribute("x2",n[r+1].Left),f.setAttribute("y2",n[r+1].Top),f.setAttribute("stroke-width",15),(i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="dataOutputAssociation"||i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="association"||i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="messageFlow"||i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="dataInputAssociation")&&(u.setAttribute("stroke-dasharray","6,4"),i.objData.lstShapes[i.indexOfSelectedLine].ShapeType=="messageFlow"&&(t.setAttribute("ondragover","SetDragOverLineElement(evt)"),t.setAttribute("ondragleave","SetNullOnDragleaveLineElement(evt)"))),f.setAttributeNS(null,"stroke","#dd4205"),f.setAttributeNS(null,"stroke-opacity",.1),e.appendChild(u),e.appendChild(f),t.appendChild(e))}function removeClonedLine(n){for(var i,t=n.svgElement.childNodes.length-1;t>0;t--)n.svgElement.childNodes[t].nodeName!="#text"&&n.svgElement.childNodes[t].nodeName!="#comment"&&(i=n.svgElement.childNodes[t].getAttribute("id"),i=="ClonedLine"&&(n.svgElement.removeChild(n.svgElement.childNodes[t]),t--))}function deselectlinegElementonMouseUp(n){var t=angular.element(n.currentTarget).scope(),c,l,p,y,a,u,g,h,f,nt,v,e,tt,s,it,rt;if(t.isMouseDown=!1,c="",l="",t.selectedLineEle&&(c=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[t.indexOfSelectedLine].SourceElement,t,"Element"),l=GetElementProcessIdorElementBasedOnIdorDeleteElement(t.objData.lstShapes[t.indexOfSelectedLine].TargetElement,t,"Element")),checkTitleIsPresentOrDeleteTitle(t.selectedLineEle,"Delete"),removeIntersectionPoint(t),p=GetWayPointsFromLine(t.selectedLineEle),t.ClonedLineElement!=null)if(checkTitleIsPresentOrDeleteTitle(t.ClonedLineElement,"Delete"),y=GetWayPointsFromLine(t.ClonedLineElement),t.selectedlineindex!=0&&t.selectedlineindex!=t.selectedlinegtagEle.parentNode.childNodes.length-1&&(t.targetElementForLine=null),t.targetElementForLine!=null){var o=!1,r={Left:parseFloat(t.targetElementForLine.getAttribute("x")),Top:parseFloat(t.targetElementForLine.getAttribute("y")),Height:parseFloat(t.targetElementForLine.getAttribute("height")),Width:parseFloat(t.targetElementForLine.getAttribute("width"))},i=getElementBasedOnObject(r,t),w=t.selectedLineEle.getAttribute("elementtype");if((w=="dataInputAssociation"||w=="dataOutputAssociation")&&(a="",(t.selectedlineindex==0||t.selectedlineindex==t.selectedlinegtagEle.parentNode.childNodes.length-1||t.selectedLineEle.childNodes.length==1&&t.selectedlineindex==1)&&(h=!0,h=t.selectedlineindex==0?CheckIsValidFlowNodeOrNot(i,t.selectedLineTargetElement):CheckIsValidFlowNodeOrNot(t.selectedLineSourceElement,i),h)))if(t.selectedLineSourceElement.ShapeType!="dataObjectReference"||t.selectedLineSourceElement.ShapeType!="dataStoreReference"){for(u=0;u<t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel.Elements.length;u++)if(t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel.Elements[u].Name=="sourceRef"){a=t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel.Elements[u].Value;break}(r.Left!=t.selectedLineTargetElement.Left||r.Top!=t.selectedLineTargetElement.Top||r.Height!=t.selectedLineTargetElement.Height||r.Width!=t.selectedLineTargetElement.Width)&&(r.Left!=t.selectedLineSourceElement.Left||r.Top!=t.selectedLineSourceElement.Top||r.Height!=t.selectedLineSourceElement.Height||r.Width!=t.selectedLineSourceElement.Width)&&RemoveDataAssociationIOspecificationFromtask(t.selectedLineSourceElement,a,"output")}else if(t.selectedLineTargetElement.ShapeType!="dataObjectReference"||t.selectedLineTargetElement.ShapeType!="dataStoreReference"){for(u=0;u<t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel.Elements.length;u++)if(t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel.Elements[u].Name=="targetRef"){a=t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel.Elements[u].Value;break}(r.Left!=t.selectedLineSourceElement.Left||r.Top!=t.selectedLineSourceElement.Top||r.Height!=t.selectedLineSourceElement.Height||r.Width!=t.selectedLineSourceElement.Width)&&(r.Left!=t.selectedLineTargetElement.Left||r.Top!=t.selectedLineTargetElement.Top||r.Height!=t.selectedLineTargetElement.Height||r.Width!=t.selectedLineTargetElement.Width)&&RemoveDataAssociationIOspecificationFromtask(t.selectedLineTargetElement,a,"input")}if(t.selectedlineindex==0){if(h=CheckIsValidFlowNodeOrNot(i,t.selectedLineTargetElement),h&&(r.Left!=t.selectedLineTargetElement.Left||r.Top!=t.selectedLineTargetElement.Top||r.Height!=t.selectedLineTargetElement.Height||r.Width!=t.selectedLineTargetElement.Width))if(r.Left!=t.selectedLineSourceElement.Left||r.Top!=t.selectedLineSourceElement.Top||r.Height!=t.selectedLineSourceElement.Height||r.Width!=t.selectedLineSourceElement.Width){if(i!=null&&t.selectedLineSourceElement.ShapeType!="textAnnotation"&&t.selectedLineTargetElement.ShapeType!="textAnnotation"){var b=i.Id,k=t.selectedLineTargetElement.Id,d=getNodeAlreadyConnected(b,k,t);d?alert("Nodes Already Connected"):(o=!0,g=t.selectedLineSourceElement,t.selectedLineSourceElement=i,f=t.ClonedLineElement.childNodes[0].getAttribute("id"),t.selectedLineSourceElement.processRef==t.selectedLineTargetElement.processRef&&t.objData.lstShapes[t.indexOfSelectedLine].ShapeType!="association"&&t.selectedLineSourceElement.ShapeType!="dataStoreReference"&&t.selectedLineTargetElement.ShapeType!="dataStoreReference"&&t.selectedLineSourceElement.ShapeType!="dataObjectReference"&&t.selectedLineTargetElement.ShapeType!="dataObjectReference"?(t.objData.lstShapes[t.indexOfSelectedLine].ShapeType="sequenceFlow",i.ShapeType!="exclusiveGateway"&&i.ShapeType!="inclusiveGateway"?(t.selectedLineEle.setAttribute("elementtype","sequenceFlow"),EdgeShapeModel={dictAttributes:{id:f,sourceRef:i.Id,name:t.selectedShape.Text,targetRef:t.objData.lstShapes[t.indexOfSelectedLine].TargetElement},Elements:[],Children:[],Name:"sequenceFlow",prefix:null,Value:""}):(t.selectedLineEle.setAttribute("elementtype","GatewayExpression"),EdgeShapeModel={dictAttributes:{id:f,sourceRef:i.Id,targetRef:t.objData.lstShapes[t.indexOfSelectedLine].TargetElement,name:t.selectedShape.Text},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"leftside",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"rightside",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"conditionExpression",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"sequenceFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""}),t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel=EdgeShapeModel,t.objData.lstShapes[t.indexOfSelectedLine].processRef=t.selectedLineSourceElement.processRef,t.objData.lstShapes[t.indexOfSelectedLine].SourceElement=i.Id):t.selectedLineSourceElement.ShapeType=="dataStoreReference"||t.selectedLineTargetElement.ShapeType=="dataStoreReference"||t.selectedLineSourceElement.ShapeType=="dataObjectReference"||t.selectedLineTargetElement.ShapeType=="dataObjectReference"?(setDataOutPutAndDataInPutAssociationToShapeModel(t.selectedLineSourceElement,t.selectedLineTargetElement,f,t),t.objData.lstShapes[t.indexOfSelectedLine].processRef=t.selectedLineSourceElement.processRef,t.objData.lstShapes[t.indexOfSelectedLine].SourceElement=i.Id):t.objData.lstShapes[t.indexOfSelectedLine].ShapeType!="association"&&i.ShapeType!="exclusiveGateway"&&i.ShapeType!="inclusiveGateway"&&t.selectedLineTargetElement.ShapeType!="exclusiveGateway"&&t.selectedLineTargetElement.ShapeType!="inclusiveGateway"&&i.ShapeType!="eventBasedGateway"&&i.ShapeType!="parallelGateway"&&t.selectedLineTargetElement.ShapeType!="eventBasedGateway"&&t.selectedLineTargetElement.ShapeType!="parallelGateway"?(t.objData.lstShapes[t.indexOfSelectedLine].ShapeType="messageFlow",t.selectedLineEle.setAttribute("elementtype","messageFlow"),v={dictAttributes:{id:f,sourceRef:t.objData.lstShapes[t.indexOfSelectedLine].SourceElement,targetRef:t.objData.lstShapes[t.indexOfSelectedLine].TargetElement,name:t.selectedShape.Text},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"docTypes",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"messageFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""},t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel=v,t.objData.lstShapes[t.indexOfSelectedLine].processRef=t.objData.CollaborationId,t.objData.lstShapes[t.indexOfSelectedLine].SourceElement=i.Id):(i.ShapeType=="exclusiveGateway"||i.ShapeType=="inclusiveGateway"||t.selectedLineTargetElement.ShapeType=="exclusiveGateway"||t.selectedLineTargetElement.ShapeType=="inclusiveGateway"||i.ShapeType=="eventBasedGateway"||i.ShapeType=="parallelGateway"||t.selectedLineTargetElement.ShapeType=="eventBasedGateway"||t.selectedLineTargetElement.ShapeType=="parallelGateway")&&(o=!1,t.selectedLineSourceElement=g))}}else o=!0}else if((t.selectedlineindex==t.selectedlinegtagEle.parentNode.childNodes.length-1||t.selectedLineEle.childNodes.length==1&&t.selectedlineindex==1)&&(h=CheckIsValidFlowNodeOrNot(t.selectedLineSourceElement,i),h&&(r.Left!=t.selectedLineSourceElement.Left||r.Top!=t.selectedLineSourceElement.Top||r.Height!=t.selectedLineSourceElement.Height||r.Width!=t.selectedLineSourceElement.Width)))if(r.Left!=t.selectedLineTargetElement.Left||r.Top!=t.selectedLineTargetElement.Top||r.Height!=t.selectedLineTargetElement.Height||r.Width!=t.selectedLineTargetElement.Width){if(i!=null&&t.selectedLineSourceElement.ShapeType!="textAnnotation"&&t.selectedLineTargetElement.ShapeType!="textAnnotation"){var b=t.selectedLineSourceElement.Id,k=i.Id,d=getNodeAlreadyConnected(b,k,t);d?alert("Nodes Already Connected"):(o=!0,f=t.ClonedLineElement.childNodes[0].getAttribute("id"),nt=t.selectedLineTargetElement,t.selectedLineTargetElement=i,t.selectedLineSourceElement.processRef==t.selectedLineTargetElement.processRef&&t.objData.lstShapes[t.indexOfSelectedLine].ShapeType!="association"&&t.selectedLineSourceElement.ShapeType!="dataStoreReference"&&t.selectedLineTargetElement.ShapeType!="dataStoreReference"&&t.selectedLineSourceElement.ShapeType!="dataObjectReference"&&t.selectedLineTargetElement.ShapeType!="dataObjectReference"?(t.objData.lstShapes[t.indexOfSelectedLine].ShapeType="sequenceFlow",i.ShapeType!="exclusiveGateway"&&i.ShapeType!="inclusiveGateway"?(t.selectedLineEle.setAttribute("elementtype","sequenceFlow"),EdgeShapeModel={dictAttributes:{id:f,sourceRef:t.objData.lstShapes[t.indexOfSelectedLine].SourceElement,targetRef:i.Id,name:t.selectedShape.Text},Elements:[],Children:[],Name:"sequenceFlow",prefix:null,Value:""}):(t.selectedLineEle.setAttribute("elementtype","GatewayExpression"),EdgeShapeModel={dictAttributes:{id:f,sourceRef:t.objData.lstShapes[t.indexOfSelectedLine].SourceElement,targetRef:i.Id,name:t.selectedShape.Text},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"leftside",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"rightside",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"conditionExpression",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"sequenceFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""}),t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel=EdgeShapeModel,t.objData.lstShapes[t.indexOfSelectedLine].processRef=t.selectedLineSourceElement.processRef,t.objData.lstShapes[t.indexOfSelectedLine].TargetElement=i.Id):t.selectedLineSourceElement.ShapeType=="dataStoreReference"||t.selectedLineTargetElement.ShapeType=="dataStoreReference"||t.selectedLineSourceElement.ShapeType=="dataObjectReference"||t.selectedLineTargetElement.ShapeType=="dataObjectReference"?(setDataOutPutAndDataInPutAssociationToShapeModel(t.selectedLineSourceElement,t.selectedLineTargetElement,f,t),t.objData.lstShapes[t.indexOfSelectedLine].processRef=t.selectedLineSourceElement.processRef,t.objData.lstShapes[t.indexOfSelectedLine].TargetElement=i.Id):t.objData.lstShapes[t.indexOfSelectedLine].ShapeType!="association"&&i.ShapeType!="exclusiveGateway"&&i.ShapeType!="inclusiveGateway"&&t.selectedLineSourceElement.ShapeType!="exclusiveGateway"&&t.selectedLineSourceElement.ShapeType!="inclusiveGateway"&&i.ShapeType!="eventBasedGateway"&&i.ShapeType!="parallelGateway"&&t.selectedLineSourceElement.ShapeType!="eventBasedGateway"&&t.selectedLineSourceElement.ShapeType!="parallelGateway"?(t.objData.lstShapes[t.indexOfSelectedLine].ShapeType="messageFlow",t.selectedLineEle.setAttribute("elementtype","messageFlow"),v={dictAttributes:{id:f,sourceRef:t.objData.lstShapes[t.indexOfSelectedLine].SourceElement,targetRef:t.objData.lstShapes[t.indexOfSelectedLine].TargetElement,name:t.selectedShape.Text},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"docTypes",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"messageFlow",prefix:"",IsValueInCDATAFormat:!1,Value:""},t.objData.lstShapes[t.indexOfSelectedLine].ShapeModel=v,t.objData.lstShapes[t.indexOfSelectedLine].processRef=t.objData.CollaborationId,t.objData.lstShapes[t.indexOfSelectedLine].TargetElement=i.Id):(i.ShapeType=="exclusiveGateway"||i.ShapeType=="inclusiveGateway"||t.selectedLineSourceElement.ShapeType=="exclusiveGateway"||t.selectedLineSourceElement.ShapeType=="inclusiveGateway"||i.ShapeType=="eventBasedGateway"||i.ShapeType=="parallelGateway"||t.selectedLineSourceElement.ShapeType=="eventBasedGateway"||t.selectedLineSourceElement.ShapeType=="parallelGateway")&&(o=!1,t.selectedLineTargetElement=nt))}}else o=!0;o&&(t.selectedLineTargetElement.ShapeType=="inclusiveGateway"||t.selectedLineTargetElement.ShapeType=="parallelGateway"?t.ChangeDirectionifElementisGateWay(t.selectedLineSourceElement,t.selectedLineTargetElement):(t.selectedLineSourceElement.ShapeType=="inclusiveGateway"||t.selectedLineSourceElement.ShapeType=="parallelGateway")&&t.ChangeDirectionifElementisGateWay(t.selectedLineSourceElement,t.selectedLineTargetElement),GenerateClonedLine(y,t.selectedLineEle,t),l.ShapeType=="inclusiveGateway"||l.ShapeType=="parallelGateway"?t.ChangeDirectionifElementisGateWay(c,l):(c.ShapeType=="inclusiveGateway"||c.ShapeType=="parallelGateway")&&t.ChangeDirectionifElementisGateWay(c,l))}else t.targetElementForLine==null&&t.selectedlineindex!=0&&t.selectedlineindex!=t.selectedlinegtagEle.parentNode.childNodes.length-1&&GenerateClonedLine(y,t.selectedLineEle,t);t.selectedLineEle.removeAttributeNS(null,"style");removeClonedLine(t);o&&(e=!1,t.selectedlineindex==0?(x1=parseFloat(t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].getAttribute("x1")),y1=parseFloat(t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].getAttribute("y1")),x2=parseFloat(t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].getAttribute("x2")),y2=parseFloat(t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].getAttribute("y2")),tt=!1,y1<=t.selectedLineSourceElement.Top+t.selectedLineSourceElement.Height&&y1>=t.selectedLineSourceElement.Top&&x1>=t.selectedLineSourceElement.Left&&x1<=t.selectedLineSourceElement.Left+t.selectedLineSourceElement.Width&&(y1-y2>-1&&y1-y2<1?x2>t.selectedLineSourceElement.Left+t.selectedLineSourceElement.Width&&x1<t.selectedLineSourceElement.Left+t.selectedLineSourceElement.Width?(t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].setAttribute("x1",t.selectedLineSourceElement.Left+t.selectedLineSourceElement.Width),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].setAttribute("y1",y1),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[1].setAttribute("x1",t.selectedLineSourceElement.Left+t.selectedLineSourceElement.Width),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[1].setAttribute("y1",y1),e=!0):x2<t.selectedLineSourceElement.Left&&x1>t.selectedLineSourceElement.Left&&(t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].setAttribute("x1",t.selectedLineSourceElement.Left),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].setAttribute("y1",y1),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[1].setAttribute("x1",t.selectedLineSourceElement.Left),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[1].setAttribute("y1",y1),e=!0):x1-x2>-1&&x1-x2<1&&(y2>t.selectedLineSourceElement.Top+t.selectedLineSourceElement.Height&&y1<t.selectedLineSourceElement.Top+t.selectedLineSourceElement.Height?(t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].setAttribute("x1",x1),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].setAttribute("y1",t.selectedLineSourceElement.Top+t.selectedLineSourceElement.Height),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[1].setAttribute("x1",x1),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[1].setAttribute("y1",t.selectedLineSourceElement.Top+t.selectedLineSourceElement.Height),e=!0):y2<t.selectedLineSourceElement.Top&&y1>t.selectedLineSourceElement.Top&&(t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].setAttribute("x1",x1),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[0].setAttribute("y1",t.selectedLineSourceElement.Top),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[1].setAttribute("x1",x1),t.selectedLineEle.childNodes[t.selectedlineindex].childNodes[1].setAttribute("y1",t.selectedLineSourceElement.Top),e=!0)))):t.selectedlineindex==t.selectedlinegtagEle.parentNode.childNodes.length-1&&(x1=parseFloat(t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].getAttribute("x1")),y1=parseFloat(t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].getAttribute("y1")),x2=parseFloat(t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].getAttribute("x2")),y2=parseFloat(t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].getAttribute("y2")),tt=!1,y2<=t.selectedLineTargetElement.Top+t.selectedLineTargetElement.Height&&y2>=t.selectedLineTargetElement.Top&&x2<=t.selectedLineTargetElement.Left+t.selectedLineTargetElement.Width&&x2>=t.selectedLineTargetElement.Left&&(y1-y2>-1&&y1-y2<1?x1>t.selectedLineTargetElement.Left+t.selectedLineTargetElement.Width&&x2<t.selectedLineTargetElement.Left+t.selectedLineTargetElement.Width?(t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].setAttribute("x2",t.selectedLineTargetElement.Left+t.selectedLineTargetElement.Width),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].setAttribute("y2",y2),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[1].setAttribute("x2",t.selectedLineTargetElement.Left+t.selectedLineTargetElement.Width),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[1].setAttribute("y2",y2),e=!0):x1<t.selectedLineTargetElement.Left&&x2>t.selectedLineTargetElement.Left&&(t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].setAttribute("x2",t.selectedLineTargetElement.Left),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].setAttribute("y2",y2),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[1].setAttribute("x2",t.selectedLineTargetElement.Left),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[1].setAttribute("y2",y2),e=!0):x1-x2>-1&&x1-x2<1&&(y1>t.selectedLineTargetElement.Top+t.selectedLineTargetElement.Height&&y2<t.selectedLineTargetElement.Top+t.selectedLineTargetElement.Height?(t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].setAttribute("x2",x2),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].setAttribute("y2",t.selectedLineTargetElement.Top+t.selectedLineTargetElement.Height),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[1].setAttribute("x2",x2),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[1].setAttribute("y2",t.selectedLineTargetElement.Top+t.selectedLineTargetElement.Height),e=!0):y1<t.selectedLineTargetElement.Top&&y2>t.selectedLineTargetElement.Top&&(t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].setAttribute("x2",x2),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[0].setAttribute("y2",t.selectedLineTargetElement.Top),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[1].setAttribute("x2",x2),t.selectedLineEle.childNodes[t.selectedLineEle.childNodes.length-1].childNodes[1].setAttribute("y2",t.selectedLineTargetElement.Top),e=!0)))),e||GenerateClonedLine(p,t.selectedLineEle,t));t.ClonedLineElement!=null&&(s=GetWayPointsFromLine(t.selectedLineEle),s=setShapeNameToWayPoints(s),t.selectedLineEle.getAttribute("elementtype")=="association"&&(it=s.length,s.length>2&&(rt=it-2,s.splice(1,rt),GenerateClonedLine(s,t.selectedLineEle,t))),t.objData.lstShapes[t.indexOfSelectedLine].lstWayPoints=s);t.ClonedLineElement=null;t.$apply(function(){t.DraggableElement=null});selectedlineElement(null,t);t.svgElement.removeAttributeNS(null,"onmouseup");t.svgElement.removeAttributeNS(null,"onmouseout");t.svgElement.removeAttributeNS(null,"onmousemove");t.selectedlinegtagEle=0}function RemoveDataAssociationIOspecificationFromtask(n,t,i){for(var u,f,r=0;r<n.ShapeModel.Elements.length;r++)if(n.ShapeModel.Elements[r].Name=="ioSpecification")for(u=0;u<n.ShapeModel.Elements[r].Elements.length;u++)if(i=="output")if(n.ShapeModel.Elements[r].Elements[u].Name=="outputSet")for(f=0;f<n.ShapeModel.Elements[r].Elements[u].Elements.length;f++)n.ShapeModel.Elements[r].Elements[u].Elements[f].Value==t&&(n.ShapeModel.Elements[r].Elements[u].Elements.splice(f,1),f--);else n.ShapeModel.Elements[r].Elements[u].dictAttributes.id==t&&(n.ShapeModel.Elements[r].Elements.splice(u,1),u--);else if(n.ShapeModel.Elements[r].Elements[u].Name=="inputSet")for(f=0;f<n.ShapeModel.Elements[r].Elements[u].Elements.length;f++)n.ShapeModel.Elements[r].Elements[u].Elements[f].Value==t&&(n.ShapeModel.Elements[r].Elements[u].Elements.splice(f,1),f--);else n.ShapeModel.Elements[r].Elements[u].dictAttributes.id==t&&(n.ShapeModel.Elements[r].Elements.splice(u,1),u--)}function setDataOutPutAndDataInPutAssociationToShapeModel(n,t,i,r){var w=IsValidShapeForAssociation(n,t),l,d,a,u,e,y,s,p;if(w)if(n.ShapeType=="dataStoreReference"||n.ShapeType=="dataObjectReference"){r.selectedLineEle.setAttribute("elementtype","dataInputAssociation");r.objData.lstShapes[r.indexOfSelectedLine].ShapeType="dataInputAssociation";var f=generateUUID(),h={dictAttributes:{},Elements:[{dictAttributes:{id:f,isCollection:"false"},Elements:[],Children:[],Name:"dataInput",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"dataInputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:f}],Children:[],Name:"inputSet",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"ioSpecification",prefix:"",IsValueInCDATAFormat:!1,Value:""},o=!1;for(u=0;u<t.ShapeModel.Elements.length;u++)if(t.ShapeModel.Elements[u].Name=="ioSpecification"){var b={dictAttributes:{id:f,isCollection:"false"},Elements:[],Children:[],Name:"dataInput",prefix:"",IsValueInCDATAFormat:!1,Value:""},k={dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"dataInputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:f}],Children:[],Name:"inputSet",prefix:"",IsValueInCDATAFormat:!1,Value:""},c=!1;for(e=0;e<t.ShapeModel.Elements[u].Elements.length;e++)t.ShapeModel.Elements[u].Elements[e].Name=="inputSet"&&(l={dictAttributes:{},Elements:[],Children:[],Name:"dataInputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:f},t.ShapeModel.Elements[u].Elements[e].Elements.push(l),c=!0);t.ShapeModel.Elements[u].Elements.push(b);c||t.ShapeModel.Elements[u].Elements.push(k);o=!0}o||t.ShapeModel.Elements.push(h);d=generateUUID();a={dictAttributes:{id:s},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"sourceRef",prefix:"",IsValueInCDATAFormat:!1,Value:t.Id},{dictAttributes:{},Elements:[],Children:[],Name:"targetRef",prefix:"",IsValueInCDATAFormat:!1,Value:f}],Children:[],Name:"dataInputAssociation",prefix:"",IsValueInCDATAFormat:!1,Value:""};r.objData.lstShapes[r.indexOfSelectedLine].ShapeModel=a}else if(t.ShapeType=="dataStoreReference"||t.ShapeType=="dataObjectReference"){r.selectedLineEle.setAttribute("elementtype","dataOutputAssociation");r.objData.lstShapes[r.indexOfSelectedLine].ShapeType="dataOutputAssociation";var f=generateUUID(),h={dictAttributes:{},Elements:[{dictAttributes:{id:f,isCollection:"false"},Elements:[],Children:[],Name:"dataOutput",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"dataOutputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:f}],Children:[],Name:"outputSet",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"ioSpecification",prefix:"",IsValueInCDATAFormat:!1,Value:""},o=!1;for(u=0;u<n.ShapeModel.Elements.length;u++)if(n.ShapeModel.Elements[u].Name=="ioSpecification"){var g={dictAttributes:{id:f,isCollection:"false"},Elements:[],Children:[],Name:"dataOutput",prefix:"",IsValueInCDATAFormat:!1,Value:""},nt={dictAttributes:{},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"dataOutputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:f}],Children:[],Name:"outputSet",prefix:"",IsValueInCDATAFormat:!1,Value:""},v=!1;for(e=0;e<n.ShapeModel.Elements[u].Elements.length;e++)n.ShapeModel.Elements[u].Elements[e].Name=="outputSet"&&(y={dictAttributes:{},Elements:[],Children:[],Name:"dataOutputRefs",prefix:"",IsValueInCDATAFormat:!1,Value:f},n.ShapeModel.Elements[u].Elements[e].Elements.push(y),v=!0);n.ShapeModel.Elements[u].Elements.push(g);v||n.ShapeModel.Elements[u].Elements.push(nt);o=!0}o||n.ShapeModel.Elements.push(h);s=generateUUID();p={dictAttributes:{id:s},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"sourceRef",prefix:"",IsValueInCDATAFormat:!1,Value:f},{dictAttributes:{},Elements:[],Children:[],Name:"targetRef",prefix:"",IsValueInCDATAFormat:!1,Value:n.Id}],Children:[],Name:"dataOutputAssociation",prefix:"",IsValueInCDATAFormat:!1,Value:""};r.objData.lstShapes[r.indexOfSelectedLine].ShapeModel=p}}function getNodeAlreadyConnected(n,t,i){for(var u=!1,r=0;r<i.objData.lstShapes.length;r++)if((i.objData.lstShapes[r].ShapeType=="sequenceFlow"||i.objData.lstShapes[r].ShapeType=="dataOutputAssociation"||i.objData.lstShapes[r].ShapeType=="association"||i.objData.lstShapes[r].ShapeType=="messageFlow"||i.objData.lstShapes[r].ShapeType=="dataInputAssociation")&&i.objData.lstShapes[r].SourceElement==n&&i.objData.lstShapes[r].TargetElement==t){u=!0;break}return u}function getElementBasedOnObject(n,t){for(var r=null,i=0;i<t.objData.lstShapes.length;i++)if(t.objData.lstShapes[i].Left==n.Left&&t.objData.lstShapes[i].Top==n.Top&&t.objData.lstShapes[i].Height==n.Height&&t.objData.lstShapes[i].Width==n.Width){r=t.objData.lstShapes[i];break}return r}function GetWayPointsFromLine(n){for(var i=[],t=0;t<n.childNodes.length;t++)waypoint={Left:parseFloat(n.childNodes[t].childNodes[0].getAttribute("x1")),Top:parseFloat(n.childNodes[t].childNodes[0].getAttribute("y1"))},i.push(waypoint),t==n.childNodes.length-1&&(waypoint={Left:parseFloat(n.childNodes[t].childNodes[0].getAttribute("x2")),Top:parseFloat(n.childNodes[t].childNodes[0].getAttribute("y2"))},i.push(waypoint));return i}function setResizeraroudtext(n){scope=angular.element(n.currentTarget).scope();scope.IsVersionDisplay||scope.activeTab=="EXECUTION"||scope.$apply(function(){var i,t;scope.selectedText=n.currentTarget;i=scope.selectedText.getAttribute("elementid");removeSelection("NewElement",scope);removeRearrangingLinePoints(scope);removeResizerAroundElement(scope);removeSelectionForLane(scope);scope.selectedLineEle&&scope.activeTab=="MAP"&&setColorToSelectedLine(scope.selectedLineEle,"remove");t=GetElementProcessIdorElementBasedOnIdorDeleteElement(i,scope,"Element");t&&(scope.selectedShapeofText=t,scope.selectedShape=undefined,scope.selectedLineEle=null,scope.OnSelectLeftBPMTab("Toolbox"));GenerateBoundsDynamicallyToText(scope.selectedText,!0,scope);n&&n.stopPropagation&&n.stopPropagation();scope.isresizerRemoved=!1;scope.svgElement.setAttributeNS(null,"onmouseup","deselectTextElement(evt,this)");scope.svgElement.setAttributeNS(null,"onmousemove","moveTextElement(evt)");scope.currentX=n.offsetX;scope.currentY=n.offsetY})}function moveTextElement(n){var t=angular.element(n.currentTarget).scope(),f=n.offsetX-t.currentX,e=n.offsetY-t.currentY,i,r,u;if(t&&n.buttons==1&&t.selectedShapeofText&&t.selectedText){if(t.currentX!=n.offsetX||t.currentY!=n.offsetY){for(t.isresizerRemoved||(removeResizerAroundElement(t),t.isresizerRemoved=!0),i=t.selectedText,i.setAttribute("x",parseFloat(i.getAttribute("x"))+f),i.setAttribute("y",parseFloat(i.getAttribute("y"))+e),r=0;r<$(i).children().length;r++)u=$(i).children()[r],u.setAttribute("x",parseFloat(u.getAttribute("x"))+f);t.currentX=n.offsetX;t.currentY=n.offsetY}}else deselectTextElement(n)}function GenerateBoundsDynamicallyToText(n,t,i){var l=0,a=0,k=0,d=0,v,y,r,u,p,f,e,w,o,s,b,h,c;return l=parseFloat(n.getAttribute("x"))-5,a=parseFloat(n.getAttribute("y"))-5,k=parseFloat(n.getAttribute("height"))+10,d=parseFloat(n.getAttribute("width"))+10,v=document.createElementNS(i.svgNS,"g"),v.setAttributeNS(null,"id","resizergroup"),v.setAttributeNS(null,"class","layer-resizers"),n.getAttribute("id")!="lane"&&n.getAttribute("id")!="message"&&n.getAttribute("id")!="endEvent"&&n.getAttribute("id")!="startEvent"&&n.getAttribute("id")!="intermediateCatchEvent"&&n.getAttribute("id")!="exclusiveGateway"&&n.getAttribute("id")!="inclusiveGateway"&&n.getAttribute("id")!="parallelGateway"&&n.getAttribute("id")!="eventBasedGateway"&&n.getAttribute("id")!="dataStoreReference"&&n.getAttribute("id")!="dataObjectReference"&&(y=document.createElementNS(i.svgNS,"g"),y.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-nw"),y.setAttributeNS(null,"id","nw"),y.setAttribute("onmousedown","selectedResizergtagText(evt)"),r=document.createElementNS(i.svgNS,"rect"),r.setAttributeNS(null,"id","rectanglenw"),r.setAttributeNS(null,"class","djs-resizer-visual"),r.setAttributeNS(null,"x",l-3),r.setAttributeNS(null,"y",a-3),r.setAttributeNS(null,"height",6),r.setAttributeNS(null,"width",6),r.setAttributeNS(null,"fill","white"),r.setAttributeNS(null,"stroke","none"),y.appendChild(r),u=document.createElementNS(i.svgNS,"rect"),u.setAttributeNS(null,"id","rectanglenw"),u.setAttributeNS(null,"class","djs-resizer-hit"),u.setAttributeNS(null,"x",l-10),u.setAttributeNS(null,"y",a-10),u.setAttributeNS(null,"height",20),u.setAttributeNS(null,"width",20),u.setAttributeNS(null,"fill","white"),u.setAttributeNS(null,"stroke","none"),y.appendChild(u),v.appendChild(y),p=document.createElementNS(i.svgNS,"g"),p.setAttribute("onmousedown","selectedResizergtagText(evt)"),p.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-ne"),p.setAttributeNS(null,"id","ne"),f=document.createElementNS(i.svgNS,"rect"),f.setAttributeNS(null,"id","rectanglene"),f.setAttributeNS(null,"class","djs-resizer-visual"),f.setAttributeNS(null,"x",l+d-3),f.setAttributeNS(null,"y",a-3),f.setAttributeNS(null,"height",6),f.setAttributeNS(null,"width",6),f.setAttributeNS(null,"fill","white"),f.setAttributeNS(null,"stroke","none"),p.appendChild(f),e=document.createElementNS(i.svgNS,"rect"),e.setAttributeNS(null,"id","rectanglene"),e.setAttributeNS(null,"class","djs-resizer-hit"),e.setAttributeNS(null,"x",l+d-10),e.setAttributeNS(null,"y",a-10),e.setAttributeNS(null,"height",20),e.setAttributeNS(null,"width",20),e.setAttributeNS(null,"fill","white"),e.setAttributeNS(null,"stroke","none"),p.appendChild(e),v.appendChild(p),w=document.createElementNS(i.svgNS,"g"),w.setAttributeNS(null,"id","se"),w.setAttribute("onmousedown","selectedResizergtagText(evt)"),w.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-se"),o=document.createElementNS(i.svgNS,"rect"),o.setAttributeNS(null,"id","rectanglese"),o.setAttributeNS(null,"class","djs-resizer-visual"),o.setAttributeNS(null,"x",l+d-3),o.setAttributeNS(null,"y",a+k-3),o.setAttributeNS(null,"height",6),o.setAttributeNS(null,"width",6),o.setAttributeNS(null,"fill","orange"),o.setAttributeNS(null,"stroke","none"),w.appendChild(o),s=document.createElementNS(i.svgNS,"rect"),s.setAttributeNS(null,"id","rectanglese"),s.setAttributeNS(null,"class","djs-resizer-hit"),s.setAttributeNS(null,"x",l+d-10),s.setAttributeNS(null,"y",a+k-10),s.setAttributeNS(null,"height",20),s.setAttributeNS(null,"width",20),s.setAttributeNS(null,"fill","orange"),s.setAttributeNS(null,"stroke","none"),w.appendChild(s),v.appendChild(w),b=document.createElementNS(i.svgNS,"g"),b.setAttributeNS(null,"id","sw"),b.setAttribute("onmousedown","selectedResizergtagText(evt)"),b.setAttributeNS(null,"class","djs-resizer djs-resizer-Participant_1uqgzki djs-resizer-sw"),h=document.createElementNS(i.svgNS,"rect"),h.setAttributeNS(null,"id","rectanglesw"),h.setAttributeNS(null,"class","djs-resizer-visual"),h.setAttributeNS(null,"x",l-3),h.setAttributeNS(null,"y",a+k-3),h.setAttributeNS(null,"height",6),h.setAttributeNS(null,"width",6),h.setAttributeNS(null,"fill","orange"),h.setAttributeNS(null,"stroke","none"),b.appendChild(h),c=document.createElementNS(i.svgNS,"rect"),c.setAttributeNS(null,"id","rectanglesw"),c.setAttributeNS(null,"class","djs-resizer-hit"),c.setAttributeNS(null,"x",l-10),c.setAttributeNS(null,"y",a+k-10),c.setAttributeNS(null,"height",20),c.setAttributeNS(null,"width",20),c.setAttributeNS(null,"fill","orange"),c.setAttributeNS(null,"stroke","none"),b.appendChild(c),v.appendChild(b)),i.svgElement.appendChild(v),v}function selectedResizergtagText(n){var t=angular.element(n.currentTarget).scope();t&&(t.selectedResizergText=n.currentTarget,t.currentX=n.offsetX,t.currentY=n.offsetY,t.isMouseDown=!0,t.svgElement.setAttributeNS(null,"onmouseup","deselectResizergText(evt)"),t.svgElement.setAttributeNS(null,"onmousemove","moveResizergText(evt)"))}function moveResizergText(n){var i=angular.element(n.currentTarget).scope(),b,t,f,v;if(i&&i.isMouseDown&&n.buttons==1&&i.selectedShapeofText){var r=n.offsetX-i.currentX,u=n.offsetY-i.currentY,y=i.selectedResizergText.parentNode,s=!1,e=parseFloat(i.selectedText.getAttribute("x")),o=parseFloat(i.selectedText.getAttribute("y")),h=parseFloat(i.selectedText.getAttribute("height")),c=parseFloat(i.selectedText.getAttribute("width"));if(i.selectedResizergText.getAttribute("id")=="nw"){ElementXpos1=e+r;ElementYpos1=o+u;ElementHeight1=h-u;ElementWidth1=c-r;var l=ElementXpos1+ElementWidth1-ElementXpos1,a=ElementYpos1+ElementHeight1-ElementYpos1,p=e+c-e,w=o+h-o;l>15&&a>15?s=!0:l>=p&&a>=w&&(s=!0)}else if(i.selectedResizergText.getAttribute("id")=="ne"){ElementXpos1=e;ElementYpos1=o+u;ElementHeight1=h-u;ElementWidth1=c+r;var l=ElementXpos1+ElementWidth1-ElementXpos1,a=ElementYpos1+ElementHeight1-ElementYpos1,p=e+c-e,w=o+h-o;l>15&&a>15?s=!0:l>=p&&a>=w&&(s=!0)}else if(i.selectedResizergText.getAttribute("id")=="sw"){ElementXpos1=e+r;ElementYpos1=o;ElementHeight1=h+u;ElementWidth1=c-r;var l=ElementXpos1+ElementWidth1-ElementXpos1,a=ElementYpos1+ElementHeight1-ElementYpos1,p=e+c-e,w=o+h-o;l>15&&a>15?s=!0:l>=p&&a>=w&&(s=!0)}else if(i.selectedResizergText.getAttribute("id")=="se"){ElementXpos1=e;ElementYpos1=o;ElementHeight1=h+u;ElementWidth1=c+r;var l=ElementXpos1+ElementWidth1-ElementXpos1,a=ElementYpos1+ElementHeight1-ElementYpos1,p=e+c-e,w=o+h-o;l>15&&a>15?s=!0:l>=p&&a>=w&&(s=!0)}if(s){if(i.isDirty=!0,i.selectedResizergText.setAttribute("x",parseFloat(i.selectedResizergText.getAttribute("x"))+r),i.selectedResizergText.setAttribute("y",parseFloat(i.selectedResizergText.getAttribute("y"))+u),angular.forEach($(i.selectedResizergText).children(),function(n){n.setAttribute("x",parseFloat(n.getAttribute("x"))+r);n.setAttribute("y",parseFloat(n.getAttribute("y"))+u)}),i.selectedResizergText.getAttribute("id")=="nw"){if(i.selectedText!=0){for(t=i.selectedText,t.parentNode==null&&(b=10),t.setAttribute("width",parseFloat(t.getAttribute("width"))-r),t.setAttribute("height",parseFloat(t.getAttribute("height"))-u),t.setAttribute("y",parseFloat(t.getAttribute("y"))+u),t.setAttribute("x",parseFloat(t.getAttribute("x"))+r),f=0;f<t.childNodes.length;f++)t.removeChild(t.childNodes[f]);t.textContent=i.selectedShapeofText.Text;v=wraptorect(t,null,0,.5,undefined,i);i.selectedText=v}angular.forEach($(y).children(),function(n){n.getAttribute("id")=="ne"&&(n.setAttribute("y",parseFloat(n.getAttribute("y"))+u),angular.forEach($(n).children(),function(n){n.setAttribute("y",parseFloat(n.getAttribute("y"))+u)}));n.getAttribute("id")=="sw"&&(n.setAttribute("x",parseFloat(n.getAttribute("x"))+r),angular.forEach($(n).children(),function(n){n.setAttribute("x",parseFloat(n.getAttribute("x"))+r)}))})}if(i.selectedResizergText.getAttribute("id")=="ne"){if(i.selectedText!=0){for(t=i.selectedText,t.setAttribute("width",parseFloat(t.getAttribute("width"))+r),t.setAttribute("height",parseFloat(t.getAttribute("height"))-u),t.setAttribute("y",parseFloat(t.getAttribute("y"))+u),f=0;f<t.childNodes.length;f++)t.removeChild(t.childNodes[f]);t.textContent=i.selectedShapeofText.Text;v=wraptorect(t,null,0,.5,undefined,i);i.selectedText=v}angular.forEach($(y).children(),function(n){n.getAttribute("id")=="nw"&&(n.setAttribute("y",parseFloat(n.getAttribute("y"))+u),angular.forEach($(n).children(),function(n){n.setAttribute("y",parseFloat(n.getAttribute("y"))+u)}));n.getAttribute("id")=="se"&&(n.setAttribute("x",parseFloat(n.getAttribute("x"))+r),angular.forEach($(n).children(),function(n){n.setAttribute("x",parseFloat(n.getAttribute("x"))+r)}))})}if(i.selectedResizergText.getAttribute("id")=="sw"){if(i.selectedText!=0){for(t=i.selectedText,t.setAttribute("width",parseFloat(t.getAttribute("width"))-r),t.setAttribute("height",parseFloat(t.getAttribute("height"))+u),t.setAttribute("x",parseFloat(t.getAttribute("x"))+r),f=0;f<t.childNodes.length;f++)t.removeChild(t.childNodes[f]);t.textContent=i.selectedShapeofText.Text;v=wraptorect(t,null,0,.5,undefined,i);i.selectedText=v}angular.forEach($(y).children(),function(n){n.getAttribute("id")=="se"&&(n.setAttribute("y",parseFloat(n.getAttribute("y"))+u),angular.forEach($(n).children(),function(n){n.setAttribute("y",parseFloat(n.getAttribute("y"))+u)}));n.getAttribute("id")=="nw"&&(n.setAttribute("x",parseFloat(n.getAttribute("x"))+r),angular.forEach($(n).children(),function(n){n.setAttribute("x",parseFloat(n.getAttribute("x"))+r)}))})}if(i.selectedResizergText.getAttribute("id")=="se"){if(i.selectedText!=0){for(t=i.selectedText,t.setAttribute("width",parseFloat(t.getAttribute("width"))+r),t.setAttribute("height",parseFloat(t.getAttribute("height"))+u),f=0;f<t.childNodes.length;f++)t.removeChild(t.childNodes[f]);t.textContent=i.selectedShapeofText.Text;v=wraptorect(t,null,0,.5,undefined,i);i.selectedText=v}angular.forEach($(y).children(),function(n){n.getAttribute("id")=="sw"&&(n.setAttribute("y",parseFloat(n.getAttribute("y"))+u),angular.forEach($(n).children(),function(n){n.setAttribute("y",parseFloat(n.getAttribute("y"))+u)}));n.getAttribute("id")=="ne"&&(n.setAttribute("x",parseFloat(n.getAttribute("x"))+r),angular.forEach($(n).children(),function(n){n.setAttribute("x",parseFloat(n.getAttribute("x"))+r)}))})}i.currentX=n.offsetX;i.currentY=n.offsetY}}else deselectResizergText(n)}function deselectTextElement(n){var t=angular.element(n.currentTarget).scope();t.selectedShapeofText&&t.selectedText&&(t.selectedShapeofText.LabelLeft=parseFloat(t.selectedText.getAttribute("x")),t.selectedShapeofText.LabelTop=parseFloat(t.selectedText.getAttribute("y")),t.selectedShapeofText.LabelHeight=parseFloat(t.selectedText.getAttribute("height")),t.selectedShapeofText.LabelWidth=parseFloat(t.selectedText.getAttribute("width")),t.svgElement.removeAttributeNS(null,"onmousemove"),t.svgElement.removeAttributeNS(null,"onmouseup"))}function deselectResizergText(n){var t=angular.element(n.currentTarget).scope();t.isMouseDown=!1;t.selectedResizergText!=0&&t.selectedShapeofText&&t.selectedText&&(t.selectedShapeofText.LabelLeft=parseFloat(t.selectedText.getAttribute("x")),t.selectedShapeofText.LabelTop=parseFloat(t.selectedText.getAttribute("y")),t.selectedShapeofText.LabelHeight=parseFloat(t.selectedText.getAttribute("height")),t.selectedShapeofText.LabelWidth=parseFloat(t.selectedText.getAttribute("width")),t.svgElement.removeAttributeNS(null,"onmousemove"),t.svgElement.removeAttributeNS(null,"onmouseup"),t.selectedResizergText=0)}function bpmUsertaskProcessMapPropertiesController(n){this.initialize=function(){if(this.model&&this.model.Elements){function t(n){return n.Name=="extraSettings"}var n=this.model.Elements.filter(t);n&&n.length>0&&(this.model.extraSettingsModel=n[0],this.model.extraSettingsModel.dictAttributes.sfwCanExecuteBpmTaskOnSoftErrors||(this.model.extraSettingsModel.dictAttributes.sfwCanExecuteBpmTaskOnSoftErrors="True"))}this.mapvariablesmodel&&(this.dateTypeVariables=this.mapvariablesmodel.Elements.filter(function(n){return n.dictAttributes.dataType==="datetime"}).map(function(n){return n.dictAttributes.id}),this.intTypeVariables=this.mapvariablesmodel.Elements.filter(function(n){return n.dictAttributes.dataType==="int"}).map(function(n){return n.dictAttributes.id}))};this.onChangeSLAFromVariable=function(){n.UndRedoBulkOp("Start");n.EditPropertyValue(this.model.dictAttributes.Days,this.model.dictAttributes,"Days","");n.EditPropertyValue(this.model.dictAttributes.Hours,this.model.dictAttributes,"Hours","");n.EditPropertyValue(this.model.dictAttributes.Minutes,this.model.dictAttributes,"Minutes","");n.UndRedoBulkOp("End")};this.initialize()}function intermediateCatchEventMapPropertiesController(n,t,i){this.initialize=function(){var n;this.selected={valueSource:undefined,eventType:undefined};this.durationModel=undefined;this.mapvariablesmodel&&(this.queryParametersValues=i.getMapVariableIds(this.mapvariablesmodel.Elements));n=t("filter")(this.model.Elements,{Name:"timerEventDefinition"});n&&n.length>0&&(this.selected.eventType="Timer",n=t("filter")(n[0].Elements,{Name:"timeDuration"}),n&&n.length>0&&(n=t("filter")(n[0].Elements,{Name:"extensionElements"}),n&&n.length>0&&(n=t("filter")(n[0].Elements,{Name:"Duration"}),n&&n.length>0&&(this.durationModel=n[0],this.selected.valueSource=this.durationModel.dictAttributes.sfwValueSource))));n=t("filter")(this.model.Elements,{Name:"messageEventDefinition"});n&&n.length>0?this.selected.eventType="Message":this.selected.eventType==undefined&&(this.selected.eventType="")};this.onEventTypeChanged=function(){this.selected.eventType=="Message"?(this.addMessageEvent(),this.ChangeImageBasedOnType("Message")):this.selected.eventType=="Timer"?(this.addTimerEvent(),this.ChangeImageBasedOnType("Timer")):(this.addDefaultEvent(),this.ChangeImageBasedOnType("Default"));this.initialize()};this.removeMessageEvent=function(){var i=t("filter")(this.model.Elements,{Name:"messageEventDefinition"});i&&i.length>0&&n.DeleteItem(i[0],this.model.Elements,null)};this.removeDefaultEvent=function(){var i=t("filter")(this.model.Elements,{Name:"extensionElements"});i&&i.length>0&&n.DeleteItem(i[0],this.model.Elements,null)};this.ChangeImageBasedOnType=function(n){ChangeCatchEventImageBasedonType(this.selectedelemforresize,n)};this.addMessageEvent=function(){n.UndRedoBulkOp("Start");this.removeTimerEvent();this.removeDefaultEvent();var t=getMessageEventModel();n.PushItem(t,this.model.Elements);n.UndRedoBulkOp("End")};this.removeTimerEvent=function(){var i=t("filter")(this.model.Elements,{Name:"timerEventDefinition"});i&&i.length>0&&n.DeleteItem(i[0],this.model.Elements,null)};this.addDefaultEvent=function(){var t,i,r;n.UndRedoBulkOp("Start");this.removeTimerEvent();this.removeMessageEvent();t={prefix:"",Name:"extensionElements",Value:"",dictAttributes:{},Elements:[],Children:[]};i={prefix:"sbpmn",Name:"isSynchronous",Value:"False",dictAttributes:{},Elements:[],Children:[]};t.Elements.push(i);r=t;n.PushItem(r,this.model.Elements);n.UndRedoBulkOp("End")};this.addTimerEvent=function(){n.UndRedoBulkOp("Start");this.removeMessageEvent();this.removeDefaultEvent();var t=getTimerEventModel();n.PushItem(t,this.model.Elements);n.UndRedoBulkOp("End")};this.calculateValue=function(){if(this.durationModel){var t=parseInt(this.durationModel.dictAttributes.Days)||0,i=parseInt(this.durationModel.dictAttributes.Hours)||0,r=parseInt(this.durationModel.dictAttributes.Minutes)||0,u=parseInt(this.durationModel.dictAttributes.Seconds)||0,f=u*1e7+r*6e8+i*36e9+t*864e9;n.EditPropertyValue(this.durationModel.dictAttributes.sfwParameterValue,this.durationModel.dictAttributes,"sfwParameterValue",f)}};this.onValueSourceChanged=function(){this.durationModel&&(n.UndRedoBulkOp("Start"),n.EditPropertyValue(this.durationModel.dictAttributes.sfwValueSource,this.durationModel.dictAttributes,"sfwValueSource",this.selected.valueSource),this.selected.valueSource=="Parameter"&&(n.EditPropertyValue(this.durationModel.dictAttributes.Days,this.durationModel.dictAttributes,"Days",""),n.EditPropertyValue(this.durationModel.dictAttributes.Hours,this.durationModel.dictAttributes,"Hours",""),n.EditPropertyValue(this.durationModel.dictAttributes.Minutes,this.durationModel.dictAttributes,"Minutes",""),n.EditPropertyValue(this.durationModel.dictAttributes.Seconds,this.durationModel.dictAttributes,"Seconds","")),n.EditPropertyValue(this.durationModel.dictAttributes.sfwParameterValue,this.durationModel.dictAttributes,"sfwParameterValue",""),n.UndRedoBulkOp("End"))};this.initialize()}function messageflowMapPropertiesController(n,t){var i=getCurrentFileScope(),e=n("filter")(this.model.Elements,{Name:"extensionElements"}),u,f,r;if(e&&e.length>0&&(this.extensionElementModel=e[0]),this.selectedShape=i.selectedShape,this.extensionElementModel&&(u=n("filter")(this.extensionElementModel.Elements,{Name:"docTypes"},!0)),u&&u.length>0&&(this.docTypesModel=u[0]),this.addDocType=function(){var i=this.obj.selectedDocType,n;this.docTypesModel.Elements.some(function(n){return n.Value==i.Code})||(n={prefix:"sbpmn",Name:"docType",Value:this.obj.selectedDocType.Code,dictAttributes:{},Elements:[],Children:[]},t.UndRedoBulkOp("Start"),t.PushItem(n,this.docTypesModel.Elements),t.PushItem(this.obj.selectedDocType.CodeDescription,this.obj.docTypes),t.UndRedoBulkOp("End"))},this.canAddDocType=function(){var n=this.obj.selectedDocType;return n!=undefined&&!this.docTypesModel.Elements.some(function(t){return t.Value==n.Code})},this.deleteDocType=function(){var i=n("filter")(this.docTypes,{CodeDescription:this.obj.selectedDocTypeFromGrid},!0);t.UndRedoBulkOp("Start");i&&i.length>0&&(i=n("filter")(this.docTypesModel.Elements,{Value:i[0].Code},!0),i&&i.length>0&&t.DeleteItem(i[0],this.docTypesModel.Elements,null));t.DeleteItem(this.obj.selectedDocTypeFromGrid,this.obj.docTypes,null);t.UndRedoBulkOp("End");this.obj.selectedDocTypeFromGrid=undefined},this.canDeleteDocType=function(){return this.obj.selectedDocTypeFromGrid&&this.obj.selectedDocTypeFromGrid.trim().length>0},this.selectDocType=function(n){this.obj.selectedDocTypeFromGrid=n},this.onMessageKindChange=function(n){if(n=="initiating"||n=="non_initiating")if(this.model.dictAttributes.messageRef&&this.model.dictAttributes.messageRef.trim().length>0){i.selectedShape.MessageVisibleKind=n;var t=GetElementProcessIdorElementBasedOnIdorDeleteElement(this.model.dictAttributes.messageRef,i,"Element");ChangeImageOfTheShape(n,i,t)}else this.addMessage(n);else this.removeMessage()},this.addMessage=function(n){var r=generateUUID(),e=generateUUID(),u=getShapeCoordinatesBasedOnResizerLine(i),t,f;this.model.dictAttributes.messageRef=r;t={Height:20,Width:20,Left:u.Left,Top:u.Top,LabelHeight:0,LabelWidth:0,LabelLeft:0,LabelTop:0,ShapeName:"BPMNShape",ShapeType:"message",processRef:"",lstWayPoints:[],Text:"",Id:r,ShapeId:e};i.selectedShape.MessageVisibleKind=n;i.selectedShape.MessageReference=r;f={prefix:"",Name:"message",Value:"",dictAttributes:{id:this.model.dictAttributes.messageRef},Elements:[],children:[]};t.ShapeModel=f;i.objData.lstShapes.push(t);drawInitiatingorNonInitiatingMessage(i.svgElement,t,i)},this.removeMessage=function(){if(this.model.dictAttributes.messageRef&&this.model.dictAttributes.messageRef.trim().length>0){var n=GetElementProcessIdorElementBasedOnIdorDeleteElement(this.model.dictAttributes.messageRef,i,"Delete");removeElementFromSvg(n,i);i.selectedShape.MessageVisibleKind="";i.selectedShape.MessageReference="";this.model.dictAttributes.messageRef=""}},this.obj={docTypes:[],selectedDocType:undefined,selectedDocTypeFromGrid:""},this.docTypesModel&&this.docTypesModel.Elements.length)for(f=0;f<this.docTypesModel.Elements.length;f++)if(this.docTypes&&this.docTypes.length)for(r=0;r<this.docTypes.length;r++)if(this.docTypesModel.Elements[f].Value==this.docTypes[r].Code){this.obj.docTypes.push(this.docTypes[r].CodeDescription);break}}function bpmCallactivityMapPropertiesController(n,t){var i=this;this.navigateToCallElement=function(t){t=t?t:"";var i=t.split(".");Object.prototype.toString.call(i)==="[object Array]"&&i.length>1&&$.connection.hubMain.server.navigateToFile(i[0],"").done(function(t){n.openFile(t,undefined)})};this.openVersionCallActivity=function(){if(i.calledCaseBpmModel){var r=t.$new();r.calledCaseBpmModel=i.calledCaseBpmModel;r.closeDialog=function(){r.dialog&&r.dialog.close&&r.dialog.close()};r.dialog=n.showDialog(r,"","BPM/views/BPMVersion.html",{width:1e3,height:600,showclose:!0,closeOnEscape:!0})}};this.selectCallElement=function(){if(!i.isDisabledforVersioning){var r=t.$new();function u(t){function i(t){return t.BpmName!=n.currentopenfile.file.FileName}if(Object.prototype.toString.call(t)==="[object Array]"){function u(){r.reUsableBpm=t.filter(i)}r.$evalAsync(u)}}$.connection.hubBPMN.server.getReusableBpmns().done(u);r.selectProcess=function(n,t){r.selectedProcessName=n.BpmName+"."+t.ProcessID};r.closeDialog=function(){r.dialog&&r.dialog.close()};r.dialog=n.showDialog(r,"Select Process","BPM/views/Map/CallElementSearchTemplate.html",{height:400,width:800});r.onOKClick=function(){if(r.selectedProcessName){n.UndRedoBulkOp("Start");n.EditPropertyValue(i.model.dictAttributes.calledElement,i.model.dictAttributes,"calledElement",r.selectedProcessName);function u(n){return n.Name=="extensionElements"}var t=i.model.Elements.filter(u),f=r.selectedProcessName.split(".");i.setCalledelementparameters({mapName:f[0],extensionElementModel:t?t[0]:null});n.UndRedoBulkOp("End")}r.closeDialog()}}}}function bpmTextAnnotationMapPropertiesController(){var n=this;this.$onInit=function(){var t=n.shapeModel.Elements.filter(function(n){return n.Name=="text"});t&&t.length>0&&(n.shapeModel.textModel=t[0])}}function bpmInclusiveGatewayController(n,t){var u=this,f,r,i,e,o,s;if(u.shapeModel.Name=="inclusiveGateway"&&u.shapeModel.dictAttributes.gatewayDirection=="Converging"){for(f=t("filter")(u.shapeModel.Elements,{Name:"extensionElements"}),f&&f.length>0&&(n.extensionElementModel=f[0]),n.SyncWithModel=null,r=getCurrentFileScope(),n.onChangeDivergingGateWay=function(){var t,i,s,f,l,h,u,e,o,c;if(n.SyncWithModel&&(this.selectedShape=r.selectedShape,this.selectedShape&&this.selectedShape.ShapeType=="inclusiveGateway"&&(t=getTargetPointsofElement(this.selectedShape,r),t&&t.length>0)))for(i=0;i<t.length;i++)if(s=!1,n.SyncWithModel.Value&&(f={},t[i].SourceElement!=n.SyncWithModel.Value?(l=GetElementProcessIdorElementBasedOnIdorDeleteElement(t[i].SourceElement,r,"Element"),f.initiationElementId="",s=n.SetInitiatorForInicomingEdge(n.SyncWithModel.Value,l,f)):(s=!0,f.initiationElementId=t[i].Id)),s){if(h=!1,u=undefined,t[i].ShapeModel.Elements&&t[i].ShapeModel.Elements.length>0)for(e=0;e<t[i].ShapeModel.Elements.length;e++)if(t[i].ShapeModel.Elements[e].Name="extensionElements"){u=t[i].ShapeModel.Elements[e];h=!0;break}if(h||(u={dictAttributes:{},Elements:[{dictAttributes:{},Elements:[{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"leftside",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{type:"Variable"},Elements:[],Children:[],Name:"rightside",prefix:"",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"conditionExpression",prefix:"",IsValueInCDATAFormat:!1,Value:""},{dictAttributes:{},Elements:[],Children:[],Name:"isSynchronous",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"False"}],Children:[],Name:"extensionElements",prefix:"",IsValueInCDATAFormat:!1,Value:""},t[i].ShapeModel.Elements.push(u)),o=undefined,c=!1,u)for(k=0;k<u.Elements.length;k++)if(u.Elements[k].Name=="initiator"){c=!0;o=u.Elements[k];break}c||(o={prefix:"sbpmn",Name:"initiator",Value:"",dictAttributes:{},Elements:[],Children:[]},u.Elements.push(o));o.Value=f.initiationElementId}else n.RemoveInitiatorModel(t[i].ShapeModel)},n.RemoveInitiatorModel=function(n){for(var t=0;t<n.Elements.length;t++)if(n.Elements[t].Name=="extensionElements"){for(i=0;i<n.Elements[t].Elements.length;i++)if(n.Elements[t].Elements[i].Name=="initiator"){n.Elements[t].Elements.splice(i,1);break}break}},n.SetInitiatorForInicomingEdge=function(t,i,u){var o=!1,f=getTargetPointsofElement(i,r),e,i;if(f&&f.length>0)for(e=0;e<f.length;e++)if(f[e].SourceElement!=t)i=GetElementProcessIdorElementBasedOnIdorDeleteElement(f[e].SourceElement,r,"Element"),o=n.SetInitiatorForInicomingEdge(t,i,u);else{o=!0;u.initiationElementId=f[e].Id;break}return o},n.lstDivergingGateWays=u.getDivergingGatewaysCallback(),i=0;i<n.extensionElementModel.Elements.length;i++)if(n.extensionElementModel.Elements[i].Name=="syncwith"){if(n.SyncWithModel=n.extensionElementModel.Elements[i],n.lstDivergingGateWays.length==0)n.extensionElementModel.Elements.splice(i,1);else if(n.SyncWithModel.Value)for(e=0;e<n.lstDivergingGateWays.length;e++){if(o=!1,n.lstDivergingGateWays[e].ID==n.SyncWithModel.Value){o=!0;break}o||(n.SyncWithModel.Value="")}break}n.lstDivergingGateWays.length>0&&n.SyncWithModel==null&&(s={prefix:"sbpmn",Name:"syncwith",Value:"",dictAttributes:{},Elements:[],Children:[]},n.extensionElementModel.Elements.push(s),n.SyncWithModel=s)}}function userTaskAssociationPropertiesController(n,t,i){var r=this;r.$onInit=function(){r.init()};r.init=function(){var i,n;r.currentUserTaskData={selectedEntity:"BpmActivityInstance",formList:[]};i=t("filter")(r.shapeModel.Elements,{Name:"extensionElements"});i&&i.length>0&&(r.extensionElementModel=i[0]);r.extensionElementModel&&(n=t("filter")(r.extensionElementModel.Elements,{Name:"ReferenceId"}),n&&n.length>0&&(r.referenceIDModel=n[0]),n=t("filter")(r.extensionElementModel.Elements,{Name:"form",dictAttributes:{sfwMode:"new"}}),n&&n.length>0?r.enterFormModel=n[0]:(r.enterFormModel=r.getNewEnterReEnterModel("new"),r.enterFormModel.dictAttributes.sfwFormMode="new"),n=t("filter")(r.extensionElementModel.Elements,{Name:"form",dictAttributes:{sfwMode:"update"}}),r.reEnterFormModel=n&&n.length>0?n[0]:r.getNewEnterReEnterModel("update"),n=t("filter")(r.extensionElementModel.Elements,{Name:"actions"}),n&&n.length>0&&(r.actionsModel=n[0]))};r.onModeChange=function(){var n,t;if(r.enterFormModel&&r.enterFormModel.Elements.length>0){for(i.UndRedoBulkOp("Start"),n=r.enterFormModel.Elements.length-1;n>=0;n--)t=r.enterFormModel.Elements[n],i.DeleteItem(t,r.enterFormModel.Elements);i.UndRedoBulkOp("End")}};r.getNewEnterReEnterModel=function(n){return{prefix:"sbpmn",Name:"form",Value:"",dictAttributes:{sfwMode:n},Elements:[],Children:[]}}}function businessRuleTaskAssociationController(n,t,r,u,f,e){var s=this,o;s.$onInit=function(){n.init()};o={};n.init=function(){var e,f,r,a,i;if(n.arrMapVariableforEntity=[],e=t("filter")(s.shapeModel.Elements,{Name:"extensionElements"})[0],f=t("filter")(e.Elements,{Name:"rule"})[0],n.model=f,r=t("filter")(n.model.Elements,{Name:"parameters"},!0),r&&r.length>0&&(n.model.parameterschild=r[0]),n.model.dictAttributes.sfwType==="BusinessRule"){if(n.model.baseChild=t("filter")(f.Elements,{Name:"ServiceBusinessObject"},!0)[0],n.model.baseChild&&n.model.baseChild.Elements&&(n.model.baseChild.dictAttributes.variable?(n.model.baseChild.FailOverServiceModel=t("filter")(n.model.baseChild.Elements,{Name:"FailOverServiceBusinessObject"},!0)[0],n.model.baseChild.initializeModel=t("filter")(n.model.baseChild.FailOverServiceModel.Elements,{Name:"initialize"},!0)[0],n.selectedTab="FailOverServiceBusinessObject"):n.model.baseChild.initializeModel=t("filter")(n.model.baseChild.Elements,{Name:"initialize"},!0)[0],n.model.baseChild.entryModel=t("filter")(n.model.baseChild.Elements,{Name:"OnEnter"},!0)[0],n.model.baseChild.exitModel=t("filter")(n.model.baseChild.Elements,{Name:"OnExit"},!0)[0],n.model.baseChild.dictAttributes.sfwEntity&&n.model.baseChild.entryModel&&n.model.baseChild.exitModel)){var h=n.model.baseChild.entryModel.Elements,c=n.model.baseChild.exitModel.Elements,l=n.model.baseChild.dictAttributes.sfwNavigationParameter;n.getMapVariableEntityWise();n.isBusinessRuleTypeValid&&(n.model.baseChild.initializeModel&&(n.model.baseChild.initializeModel.xmlmethodModel=t("filter")(n.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0)[0]),n.model.baseChild.initializeModel.xmlmethodModel&&n.model.baseChild.initializeModel.xmlmethodModel.dictAttributes&&n.model.baseChild.initializeModel.xmlmethodModel.dictAttributes.ID&&(a=t("filter")(n.model.baseChild.initializeModel.xmlMethods,{ID:n.model.baseChild.initializeModel.xmlmethodModel.dictAttributes.ID},!0)[0],n.model.baseChild.initializeModel.xmlmethodItems=a.Items,l&&(n.model.baseChild.dictAttributes.sfwNavigationParameter=l)),h.length>0&&(n.model.baseChild.entryModel.Elements=h),c.length>0&&(n.model.baseChild.exitModel.Elements=c))}n.model.dictAttributes.ID&&(o=u.getWithParam(n.model.baseChild.dictAttributes.sfwEntity,n.model.dictAttributes.sfwType==="StaticRule"?!0:!1,"LogicalRule,DecisionTable"),n.arrRuleIds=o.ruleIds,i=t("filter")(o.objRule,{ID:n.model.dictAttributes.ID},!0)[0],i&&(n.returnType=i.ReturnType))}n.model.dictAttributes.sfwEntity&&n.model.dictAttributes.sfwType==="StaticRule"&&(o=u.getWithParam(n.model.dictAttributes.sfwEntity,n.model.dictAttributes.sfwType==="StaticRule"?!0:!1,"LogicalRule,DecisionTable"),n.arrRuleIds=o.ruleIds,i=t("filter")(o.objRule,{ID:n.model.dictAttributes.ID},!0)[0],i&&(n.returnType=i.ReturnType))};n.onChangeType=function(r){var f,s,h,c,e,l,a;n.model.dictAttributes.sfwType=r;n.Clear("baserule");n.isBusinessRuleTypeValid=!1;f=new objElements;switch(n.model.dictAttributes.sfwType.toLowerCase()){case"staticrule":f.Name="parameters";break;case"businessrule":for(s=["initialize","OnEnter","OnExit"],f.Name="ServiceBusinessObject",i=0;i<s.length;i++)h=new objElements,h.Name=s[i],f.Elements.push(h)}n.model.Elements.push(f);c=t("filter")(n.model.Elements,{Name:"ServiceBusinessObject"});e=t("filter")(n.model.Elements,{Name:"parameters"});e&&e.length>0&&(n.model.parameterschild=e[0]);n.model.dictAttributes.sfwType==="BusinessRule"&&c.length==1?(n.model.baseChild=c[0],n.model.baseChild.initializeModel=t("filter")(n.model.baseChild.Elements,{Name:"initialize"},!0)[0],n.model.baseChild.initializeModel.dictAttributes.ObjectType="XmlMethod",n.model.baseChild.entryModel=t("filter")(n.model.baseChild.Elements,{Name:"OnEnter"},!0)[0],n.model.baseChild.exitModel=t("filter")(n.model.baseChild.Elements,{Name:"OnExit"},!0)[0],n.model.baseChild.initializeModel&&(l=new objElements,l.Name="XMLMethod",n.model.baseChild.initializeModel.Elements.push(l),n.model.baseChild.initializeModel.xmlmethodModel=t("filter")(n.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0)[0]),n.model.baseChild.dictAttributes.sfwEntity&&(a=new objElements,a.Name="parameters",n.model.Elements.push(a),o=u.getWithParam(n.model.baseChild.dictAttributes.sfwEntity,n.model.dictAttributes.sfwType==="StaticRule"?!0:!1,"LogicalRule,DecisionTable"),n.arrRuleIds=o.ruleIds)):n.model.baseChild=e[0]};n.onVariableChanged=function(){n.model&&n.model.baseChild&&n.model.baseChild.dictAttributes&&(n.model.baseChild.dictAttributes.variable&&n.model.baseChild.dictAttributes.variable.trim().length>0?(n.model.baseChild.dictAttributes.sfwNavigationParameter="",n.RemoveInitializeorFailOverModel("initialize"),n.PrepareFailOverServiceBusObjModel(),n.model.baseChild.Elements.splice(0,0,n.model.baseChild.FailOverServiceModel),n.selectedTab="FailOverServiceBusinessObject"):(n.RemoveInitializeorFailOverModel("FailOverServiceBusinessObject"),n.PrepareInitializeModel(),n.model.baseChild.Elements.splice(0,0,n.model.baseChild.initializeModel),n.selectedTab="Initialize"))};n.RemoveInitializeorFailOverModel=function(t){for(var i=0;i<n.model.baseChild.Elements.length;i++)if(n.model.baseChild.Elements[i].Name==t){n.model.baseChild.Elements.splice(i,1);break}};n.PrepareInitializeModel=function(){var r,i;n.model.baseChild.initializeModel={dictAttributes:{ObjectType:"XmlMethod"},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"XMLMethod",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"initialize",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""};n.loadXmlmethods();r=t("filter")(n.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0);r.length<=0&&(i=new objElements,i.Name="XMLMethod",n.model.baseChild.initializeModel.Elements.push(i));n.model.baseChild.initializeModel.xmlmethodModel=t("filter")(n.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0)[0];n.isBusinessRuleTypeValid=!0};n.PrepareFailOverServiceBusObjModel=function(){n.PrepareInitializeModel();var t={dictAttributes:{sfwNavigationParameter:""},Elements:[],Children:[],Name:"FailOverServiceBusinessObject",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""};t.Elements.push(n.model.baseChild.initializeModel);n.model.baseChild.FailOverServiceModel=t};n.loadXmlmethods=function(){n.model.baseChild.initializeModel.xmlMethods=e.get(n.model.baseChild.dictAttributes.sfwEntity.trim())};n.Clear=function(t){switch(t){case"baserule":n.model.dictAttributes.sfwEntity="";case"type":n.model.baseChild={};n.model.Elements=[];n.model.dictAttributes.sfwReturnField="";n.model.dictAttributes.ID="";n.returnType="";n.arrRuleIds=""}};n.getRuledetails=function(){n.model.dictAttributes.sfwType==="BusinessRule"?o=u.getWithParam(n.model.baseChild.dictAttributes.sfwEntity,n.model.dictAttributes.sfwType==="StaticRule"?!0:!1,"LogicalRule,DecisionTable"):n.model.dictAttributes.sfwType==="StaticRule"&&(n.Clear("type"),o=u.getWithParam(n.model.dictAttributes.sfwEntity,n.model.dictAttributes.sfwType==="StaticRule"?!0:!1,"LogicalRule,DecisionTable"));n.arrRuleIds=o.ruleIds};n.getRuleParmeters=function(){var f,u,i;if(n.returnType="",n.model.dictAttributes.ID||r.EditPropertyValue(n.model.dictAttributes.sfwReturnField,n.model.dictAttributes,"sfwReturnField",""),n.model.parameterschild?n.model.parameterschild.Elements=[]:(i=new objElements,i.Name="parameters",n.model.Elements.push(i),n.model.parameterschild=i),f=t("filter")(o.objRule,{ID:n.model.dictAttributes.ID},!0)[0],f&&(n.returnType=f.ReturnType,f.Parameters.length>0&&(n.model.Elements.length>0||n.model.dictAttributes.sfwType==="BusinessRule"||(u=new objElements,u.Name="parameters",n.model.Elements.push(u)),n.model.Elements.length>1||n.model.dictAttributes.sfwType!=="BusinessRule"||(u=new objElements,u.Name="parameters",n.model.Elements.push(u)),i=t("filter")(n.model.Elements,{Name:"parameters"}),i.length==1))){n.model.parameterschild=i[0];n.model.parameterschild.Elements=[];function e(n){var t=new objElements;t.Name="parameter";t.dictAttributes.sfwParamaterName=n.DisplayName;t.dictAttributes.sfwDirection=n.Direction;t.dictAttributes.sfwDataType=n.DataType;this.Elements.push(t)}angular.forEach(f.Parameters,e,i[0])}};n.selectTab=function(t){n.selectedTab=t};n.getMapVariableEntityWise=function(){var r,e,s,h,i;if(n.arrMapVariableforEntity=[],n.model.baseChild.dictAttributes&&n.model.baseChild.dictAttributes.sfwEntity&&n.model.baseChild.dictAttributes.sfwEntity.trim().length>0&&n.model.dictAttributes.sfwType.toLowerCase()==="businessrule")if(r=f.getEntityIntellisense(),e=t("filter")(r,{ID:n.model.baseChild.dictAttributes.sfwEntity.trim()},!0),e.length==1){n.loadXmlmethods();n.model.baseChild.entryModel.Elements=[];n.model.baseChild.exitModel.Elements=[];n.model.baseChild.dictAttributes.sfwNavigationParameter="";o=u.getWithParam(n.model.baseChild.dictAttributes.sfwEntity,n.model.dictAttributes.sfwType==="StaticRule"?!0:!1,"LogicalRule,DecisionTable");n.arrRuleIds=o.ruleIds;s=t("filter")(n.$parent.mapVariablesModel.Elements,{dictAttributes:{sfwEntity:n.model.baseChild.dictAttributes.sfwEntity.trim()}},!0);function c(n){this.push(n.dictAttributes.id)}angular.forEach(s,c,n.arrMapVariableforEntity);h=t("filter")(n.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0);h.length<=0&&(i=new objElements,i.Name="XMLMethod",n.model.baseChild.initializeModel.Elements.push(i),n.model.baseChild.initializeModel.xmlmethodModel=t("filter")(n.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0)[0]);n.isBusinessRuleTypeValid=!0}else n.model.baseChild.initializeModel.Elements=[],n.model.baseChild.initializeModel.xmlMethods=[],n.model.baseChild.initializeModel.xmlmethodItems=[],n.model.baseChild.dictAttributes.sfwNavigationParameter="",n.returnType="",n.model.dictAttributes.sfwReturnField="",n.model.dictAttributes.ID="",n.model.parameterschild&&(n.model.parameterschild.Elements=[]),n.arrRuleIds=[],n.isBusinessRuleTypeValid=!1;else n.isBusinessRuleTypeValid=!1};n.refreshRuleParameters=function(i){var l="",c,e,f,s,h,a;if(n.model.baseChild&&n.model.baseChild.dictAttributes&&(l=n.model.baseChild.dictAttributes?n.model.baseChild.dictAttributes.sfwEntity:undefined),n.model.dictAttributes.sfwType==="StaticRule"&&(l=n.model.dictAttributes.sfwEntity),o=u.getWithParam(l,n.model.dictAttributes.sfwType==="StaticRule"?!0:!1,"LogicalRule,DecisionTable"),c=t("filter")(o.objRule,{ID:n.model.dictAttributes.ID},!0)[0],c){for(n.returnType=c.ReturnType,e=angular.copy(c.Parameters),f=n.model.parameterschild,f||(s=new objElements,s.prefix="",s.Name="parameters",f=s,r.PushItem(s,n.model.Elements)),h=f.Elements.length-1;h>=0;h--)items=t("filter")(e,{ID:f.Elements[h].dictAttributes.sfwParamaterName}),items&&items.length>0?(a=e.indexOf(items[0]),e.splice(a,1)):r.DeleteItem(f.Elements[h],f.Elements);function v(n){var t=new objElements;t.Name="parameter";t.dictAttributes.ID=n.ID;t.dictAttributes.sfwParamaterName=n.DisplayName;t.dictAttributes.sfwDirection=n.Direction;t.dictAttributes.sfwDataType=n.DataType;this.Elements.push(t)}angular.forEach(e,v,f)}i.preventDefault();i.stopPropagation()};n.NavigateToFile=function(n){n&&n!=""&&hubMain.server.navigateToFile(n,"").done(function(n){r.openFile(n,undefined)})};n.selectMethodClick=function(n,t,i){i&&i!=""&&$NavigateToFileService.NavigateToFile(n,t,i)};n.setEnterExitActions=function(t){n.$parent.showEnterExitDialog&&n.$parent.showEnterExitDialog(t,t?n.model.baseChild.entryModel:n.model.baseChild.exitModel,n.model.baseChild.dictAttributes.sfwEntity)}}function initializeController(n,t,i,r,u,f){var e=this;n.getXmlMethods=function(){n.$ctrl.callbackFunction&&n.$ctrl.callbackFunction()};n.onXmlMethodChange=function(){var n,r;if(e.model.baseChild.initializeModel.xmlmethodModel.dictAttributes.ID){if(n=t("filter")(e.model.baseChild.initializeModel.xmlMethods,{ID:e.model.baseChild.initializeModel.xmlmethodModel.dictAttributes.ID},!0)[0],n){e.model.baseChild.initializeModel.xmlmethodItems=n.Items;r=[];function u(n){this.push(n.ID+"="+(n.Value?n.Value:""))}angular.forEach(n.Parameters,u,r);e.model.baseChild.dictAttributes.variable&&e.model.baseChild.dictAttributes.variable.trim().length>0?i.EditPropertyValue(e.model.baseChild.FailOverServiceModel.dictAttributes.sfwNavigationParameter,e.model.baseChild.FailOverServiceModel.dictAttributes,"sfwNavigationParameter",r.join(",")):i.EditPropertyValue(e.model.baseChild.dictAttributes.sfwNavigationParameter,e.model.baseChild.dictAttributes,"sfwNavigationParameter",r.join(","))}}else e.model.baseChild.dictAttributes.variable&&e.model.baseChild.dictAttributes.variable.trim().length>0?e.model.baseChild.FailOverServiceModel&&e.model.baseChild.FailOverServiceModel.dictAttributes&&i.EditPropertyValue(e.model.baseChild.FailOverServiceModel.dictAttributes.sfwNavigationParameter,e.model.baseChild.FailOverServiceModel.dictAttributes,"sfwNavigationParameter",""):i.EditPropertyValue(e.model.baseChild.dictAttributes.sfwNavigationParameter,e.model.baseChild.dictAttributes,"sfwNavigationParameter","")};n.selectMethodClick=function(n,t,i){i&&i!=""&&u.NavigateToFile(n,t,i)};n.setXmlparameters=function(){var u=n.$new(!0);u.DialogConstants={queryParamsName:"sfwNavigationParameter"};u.mapObj={};u.queryValues=e.queryParametersValues;u.queryParameters=e.model.baseChild.dictAttributes.variable&&e.model.baseChild.dictAttributes.variable.trim().length>0?r.getQueryparamfromString(e.model.baseChild.FailOverServiceModel.dictAttributes,"sfwNavigationParameter",","):r.getQueryparamfromString(e.model.baseChild.dictAttributes,"sfwNavigationParameter",",");u.QueryDialog=i.showDialog(u,"Set Xml Method Parameters","Common/views/SetQueryParameters.html",{width:500,height:500});u.setQueryParameters=function(){function t(n){this.push(n.ID+"="+(n.Value?n.Value:""))}var n=[];angular.forEach(u.queryParameters,t,n);e.model.baseChild.dictAttributes.variable&&e.model.baseChild.dictAttributes.variable.trim().length>0?i.EditPropertyValue(e.model.baseChild.FailOverServiceModel.dictAttributes.sfwNavigationParameter,e.model.baseChild.FailOverServiceModel.dictAttributes,"sfwNavigationParameter",n.join(",")):i.EditPropertyValue(e.model.baseChild.dictAttributes.sfwNavigationParameter,e.model.baseChild.dictAttributes,"sfwNavigationParameter",n.join(","));u.QueryDialog.close()};u.onRefreshParams=function(){var h=f.get(e.model.baseChild.dictAttributes.sfwEntity.trim()),s,c,r,n,o;if(h.length>0&&(s=t("filter")(h,{ID:e.model.baseChild.initializeModel.xmlmethodModel.dictAttributes.ID},!0),s&&s.length>0)){c=s[0];r=u.queryParameters;u.queryParameters=[];function l(n){var t=new objElements;t.Name="parameter";t.ID=n.ID;t.Value=n.Value;u.queryParameters.length>0&&!u.queryParameters.some(function(t){return t.dictAttributes.ID==n.ID})&&i.PushItem(t,u.queryParameters);u.queryParameters.length==0&&i.PushItem(t,u.queryParameters)}for(angular.forEach(c.Parameters,l,u.queryParameters),n=0;n<r.length;n++)r[n]&&r[n]&&r[n].ID&&(o=u.queryParameters.filter(function(t){return t.ID==r[n].ID}),o&&o.length>0&&r[n].Value&&i.EditPropertyValue(o[0].Value,o[0],"Value",r[n].Value))}}}}function bpmCallactivityAssociationPropertiesController(n,t){var i=this;i.$onInit=function(){function t(n){function r(n){return n.Name=="parameters"}if(n.Name=="extensionElements"&&n.Elements&&Object.prototype.toString.call(n.Elements)==="[object Array]"&&n.Elements.length>0){i.objExtensionModel=n;var t=n.Elements.filter(r)[0];if(t)return i.objParameterModel=t,!0}}if(i.model.Elements.some(t),i.objParameterModel)for(var n=0;n<i.objParameterModel.Elements.length;n++)i.objParameterModel.Elements[n].dictAttributes.sfwDataType=="Object"&&i.objParameterModel.Elements[n].dictAttributes.sfwValueSource=="Constant"&&i.checkAndUpdateParamChildModels({param:i.objParameterModel.Elements[n],fromUndoRedoBlock:!1})};i.refreshParameters=function(){var t=i.model.dictAttributes.calledElement?i.model.dictAttributes.calledElement.split(".")[0]:null;if(t){if(n.UndRedoBulkOp("Start"),i.setCalledelementparameters({mapName:t,extensionElementModel:i.objExtensionModel?i.objExtensionModel:null}),i.objExtensionModel){function r(n){if(n.Name=="parameters")return i.objParameterModel=n,!0}i.objExtensionModel.Elements.some(r)}n.UndRedoBulkOp("End")}};i.setVParamEntityValue=function(n){i.setParamEntityValue({parentScope:t,param:n})}}function bpmServiceRuleAssociationPropertiesController(n,t,r,u,f,e,o,s){var h=this;h.$onInit=function(){function n(n){function t(n){function u(n){n.Name=="initialize"&&(h.model.baseChild.initializeModel=n)}function o(n){n.Name=="FailOverServiceBusinessObject"&&(h.model.baseChild.FailOverServiceModel=n,n.Elements.some(u))}function r(n){n.Name=="OnEnter"?h.model.baseChild.entryModel=n:n.Name=="OnExit"?h.model.baseChild.exitModel=n:n.Name=="ServiceMethod"?h.model.baseChild.ServiceMethodmodel=n:n.Name=="XMLMethod"&&(h.model.baseChild.initializeModel.xmlmethodModel=n)}function s(n){if(n.ID==h.model.baseChild.initializeModel.xmlmethodModel.dictAttributes.ID){var t=h.model.baseChild.initializeModel.xmlmethodModel;h.model.baseChild.initializeModel.xmlmethodItems=t.Items;i&&(h.model.baseChild.dictAttributes.variable?h.model.baseChild.FailOverServiceModel.dictAttributes.sfwNavigationParameter=i:h.model.baseChild.dictAttributes.sfwNavigationParameter=i)}}var t;if(n.Name=="ServiceBusinessObject"){if(h.baseType="entity",h.model.baseChild=n,h.model.baseChild.dictAttributes.variable?(h.model.baseChild.Elements.forEach(o),h.selectedTab="FailOverServiceBusinessObject"):(h.model.baseChild.Elements.forEach(u),h.selectedTab="Initialize"),h.model.baseChild.Elements.forEach(r),h.model.baseChild.dictAttributes.variable&&!h.model.baseChild.FailOverServiceModel&&h.PrepareFailOverServiceBusObjModel(),h.model.baseChild.dictAttributes.sfwEntity){var f=h.model.baseChild.entryModel.Elements,e=h.model.baseChild.exitModel.Elements,i="";if(i=h.model.baseChild.dictAttributes.variable&&h.model.baseChild.FailOverServiceModel?h.model.baseChild.FailOverServiceModel.dictAttributes.sfwNavigationParameter:h.model.baseChild.dictAttributes.sfwNavigationParameter,h.getMapVariableEntityWise(),h.isBusinessRuleTypeValid){if(h.model.baseChild.initializeModel&&h.model.baseChild.initializeModel.Elements.some(r),h.model&&h.model.baseChild&&h.model.baseChild.ServiceMethodmodel)for(t=0;t<h.model.baseChild.ServiceMethodmodel.Elements.length;t++)h.model.baseChild.ServiceMethodmodel.Elements[t].Name=="parameter"&&h.model.baseChild.ServiceMethodmodel.Elements[t].dictAttributes&&h.model.baseChild.ServiceMethodmodel.Elements[t].dictAttributes.sfwDataType=="Object"&&h.model.baseChild.ServiceMethodmodel.Elements[t].dictAttributes.sfwValueSource=="Constant"&&h.checkAndUpdateParamChildModels({param:h.model.baseChild.ServiceMethodmodel.Elements[t],fromUndoRedoBlock:!1});h.model.baseChild.initializeModel&&h.model.baseChild.initializeModel.xmlmethodModel&&h.model.baseChild.initializeModel.xmlmethodModel.dictAttributes&&h.model.baseChild.initializeModel.xmlmethodModel.dictAttributes.ID&&h.model.baseChild.initializeModel.xmlMethods.forEach(s);h.model.baseChild.Elements.some(r);f.length>0&&(h.model.baseChild.entryModel.Elements=f);e.length>0&&(h.model.baseChild.exitModel.Elements=e)}}}else n.Name=="Queries"&&(h.model.baseChild=n,h.baseType="query")}if(n.Name=="extensionElements"&&n.Elements&&Object.prototype.toString.call(n.Elements)==="[object Array]"&&n.Elements.length>0)return h.model=n,n.Elements.forEach(t),!0}h.isBusinessRuleTypeValid=!1;h.shapeModel.Elements.some(n);h.model.lstrInitVariable=h.model.baseChild&&h.model.baseChild.dictAttributes.variable?h.model.baseChild.dictAttributes.variable:""};h.onChangebaseType=function(n){var f,e,o,s,t,u,c;h.baseType=n;h.isBusinessRuleTypeValid=!1;h.model.baseChild={};f=new objElements;switch(n){case"query":f.Name="Queries";t=r("filter")(h.model.Elements,{Name:"ServiceBusinessObject"});t.length>0&&(e=h.model.Elements.indexOf(t[0]),h.model.Elements.splice(e,1));break;case"entity":for(u=r("filter")(h.model.Elements,{Name:"Queries"}),u.length>0&&(e=h.model.Elements.indexOf(u[0]),h.model.Elements.splice(e,1)),o=["initialize","ServiceMethod","OnEnter","OnExit"],f.Name="ServiceBusinessObject",i=0;i<o.length;i++)s=new objElements,s.Name=o[i],f.Elements.push(s)}h.model.Elements.push(f);t=r("filter")(h.model.Elements,{Name:"ServiceBusinessObject"});u=r("filter")(h.model.Elements,{Name:"Queries"});t.length==1&&u.length<=0?(h.model.baseChild=t[0],h.model.baseChild.initializeModel=r("filter")(h.model.baseChild.Elements,{Name:"initialize"},!0)[0],h.model.baseChild.initializeModel.dictAttributes.ObjectType="XmlMethod",h.model.baseChild.entryModel=r("filter")(h.model.baseChild.Elements,{Name:"OnEnter"},!0)[0],h.model.baseChild.exitModel=r("filter")(h.model.baseChild.Elements,{Name:"OnExit"},!0)[0],h.model.baseChild.ServiceMethodmodel=r("filter")(h.model.baseChild.Elements,{Name:"ServiceMethod"},!0)[0],h.model.baseChild.initializeModel&&(c=new objElements,c.Name="XMLMethod",h.model.baseChild.initializeModel.Elements.push(c),h.model.baseChild.initializeModel.xmlmethodModel=r("filter")(h.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0)[0])):h.model.baseChild=u[0]};h.NavigateToFile=function(t){t&&$.connection.hubMain.server.navigateToFile(t,"").done(function(t){n.openFile(t,null)})};h.loadXmlmethods=function(){h.model.baseChild&&h.model.baseChild.dictAttributes&&h.model.baseChild.dictAttributes.sfwEntity&&(h.model.baseChild.initializeModel&&(h.model.baseChild.initializeModel.xmlMethods=f.get(h.model.baseChild.dictAttributes.sfwEntity.trim())),h.model.baseChild.ServiceMethodmodel.objectMethods=e.get(h.model.baseChild.dictAttributes.sfwEntity.trim()))};h.getMapVariableEntityWise=function(){var i,f,n,t;h.model.baseChild.dictAttributes&&h.model.baseChild.dictAttributes.sfwEntity&&h.model.baseChild.dictAttributes.sfwEntity.trim().length>0&&h.baseType.toLowerCase()==="entity"?(i=u.getEntityIntellisense(),f=r("filter")(i,{ID:h.model.baseChild.dictAttributes.sfwEntity.trim()},!0),f.length==1?(h.loadXmlmethods(),h.model.baseChild.entryModel.Elements=[],h.model.baseChild.exitModel.Elements=[],h.model.baseChild.dictAttributes.sfwNavigationParameter="",h.model.baseChild.initializeModel&&(n=r("filter")(h.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0)),n&&n.length<=0&&(t=new objElements,t.Name="XMLMethod",h.model.baseChild.initializeModel.Elements.push(t),h.model.baseChild.initializeModel.xmlmethodModel=r("filter")(h.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0)[0]),h.isBusinessRuleTypeValid=!0):(h.model.baseChild.initializeModel.Elements=[],h.model.baseChild.ServiceMethodmodel.Elements=[],h.model.baseChild.ServiceMethodmodel.dictAttributes={},h.model.baseChild.initializeModel.xmlMethods=[],h.model.baseChild.initializeModel.xmlmethodItems=[],h.model.baseChild.dictAttributes.sfwNavigationParameter="",h.isBusinessRuleTypeValid=!1)):h.isBusinessRuleTypeValid=!1};h.RemoveInitializeorFailOverModel=function(t){for(var i=0;i<h.model.baseChild.Elements.length;i++)if(h.model.baseChild.Elements[i].Name==t){n.DeleteItem(h.model.baseChild.Elements[i],h.model.baseChild.Elements);break}};h.PrepareInitializeModel=function(){var i,t;h.model.baseChild.initializeModel={dictAttributes:{ObjectType:"XmlMethod"},Elements:[{dictAttributes:{},Elements:[],Children:[],Name:"XMLMethod",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"initialize",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""};h.loadXmlmethods();i=r("filter")(h.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0);i.length<=0&&(t=new objElements,t.Name="XMLMethod",n.PushItem(t,h.model.baseChild.initializeModel.Elements));h.model.baseChild.initializeModel.xmlmethodModel=r("filter")(h.model.baseChild.initializeModel.Elements,{Name:"XMLMethod"},!0)[0];h.isBusinessRuleTypeValid=!0};h.PrepareFailOverServiceBusObjModel=function(){h.PrepareInitializeModel();var t={dictAttributes:{sfwNavigationParameter:""},Elements:[],Children:[],Name:"FailOverServiceBusinessObject",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""};n.PushItem(h.model.baseChild.initializeModel,t.Elements);h.model.baseChild.FailOverServiceModel=t};h.onVariableChanged=function(){if(h.model&&h.model.baseChild&&h.model.baseChild.dictAttributes){var t=h.model.baseChild.dictAttributes.variable;n.UndRedoBulkOp("Start");n.EditPropertyValue(t,h.model.baseChild.dictAttributes,"variable",h.model.lstrInitVariable);n.EditPropertyValue(t,h.model,"lstrInitVariable",h.model.lstrInitVariable);h.model.baseChild.dictAttributes.variable&&h.model.baseChild.dictAttributes.variable.trim().length>0?(n.EditPropertyValue(h.model.baseChild.dictAttributes.sfwNavigationParameter,h.model.baseChild.dictAttributes,"sfwNavigationParameter",""),h.RemoveInitializeorFailOverModel("initialize"),h.PrepareFailOverServiceBusObjModel(),n.InsertItem(h.model.baseChild.FailOverServiceModel,h.model.baseChild.Elements,0),h.selectedTab="FailOverServiceBusinessObject"):(h.RemoveInitializeorFailOverModel("FailOverServiceBusinessObject"),h.PrepareInitializeModel(),n.InsertItem(h.model.baseChild.initializeModel,h.model.baseChild.Elements,0),h.selectedTab="Initialize");n.UndRedoBulkOp("End")}};h.setEnterExitActions=function(n){t.$parent.showEnterExitDialog&&t.$parent.showEnterExitDialog(n,n?h.model.baseChild.entryModel:h.model.baseChild.exitModel,h.model.baseChild.dictAttributes.sfwEntity)};h.selectMethodClick=function(n,t,i){i&&i!=""&&o.NavigateToFile(n,t,i)};h.getServiceMethodparameters=function(){var t,i;if(n.UndRedoBulkOp("Start"),n.EditPropertyValue(h.model.baseChild.ServiceMethodmodel.Elements,h.model.baseChild.ServiceMethodmodel,"Elements",[]),n.EditPropertyValue(h.model.baseChild.ServiceMethodmodel.dictAttributes.sfwReturnType,h.model.baseChild.ServiceMethodmodel.dictAttributes,"sfwReturnType",""),h.model.baseChild.ServiceMethodmodel.dictAttributes.sfwObjectMethod&&(t=r("filter")(h.model.baseChild.ServiceMethodmodel.objectMethods,{ID:h.model.baseChild.ServiceMethodmodel.dictAttributes.sfwObjectMethod},!0),t&&t.length>0)){i=t[0];function u(t){var i=new objElements;i.Name="parameter";i.dictAttributes.sfwParamaterName=t.ID;i.dictAttributes.sfwDataType=t.DataType;i.dictAttributes.sfwEntity=t.Entity;i.dictAttributes.sfwValueSource="Parameter";i.dictAttributes.sfwParameterValue=t.Value;n.PushItem(i,this.Elements)}angular.forEach(i.Parameters,u,h.model.baseChild.ServiceMethodmodel);n.EditPropertyValue(h.model.baseChild.ServiceMethodmodel.dictAttributes.sfwReturnType,h.model.baseChild.ServiceMethodmodel.dictAttributes,"sfwReturnType",i.ReturnType)}n.UndRedoBulkOp("End")};h.setServiceMethodParameter=function(){var i=t.$new();i.model=angular.copy(h.model.baseChild.ServiceMethodmodel);i.queryParametersValues=h.queryParametersvalues;i.IsDisabledforVersioning=h.isDisabledforVersioning;i.onValueSourceChanged=function(n){h.onValueSourceChanged({param:n})};i.setParamEntityValue=function(n){h.setParamEntityValue({parentScope:t,param:n})};i.onOKClick=function(){while(h.model.baseChild.ServiceMethodmodel.Elements.length>0)n.DeleteItem(h.model.baseChild.ServiceMethodmodel.Elements[0],h.model.baseChild.ServiceMethodmodel.Elements,null);for(var t=0;t<i.model.Elements.length;t++)n.PushItem(i.model.Elements[t],h.model.baseChild.ServiceMethodmodel.Elements);i.closeDialog()};i.closeDialog=function(){i.dialog&&i.dialog.close()};i.onRefreshParams=function(){var s=e.get(h.model.baseChild.dictAttributes.sfwEntity.trim()),o,c,u,t,f;if(s.length>0&&(o=r("filter")(s,{ID:i.model.dictAttributes.sfwObjectMethod},!0),o&&o.length>0)){c=o[0];u=i.model.Elements;i.model.Elements=[];function l(t){var i=new objElements;i.Name="parameter";i.dictAttributes.sfwParamaterName=t.ID;i.dictAttributes.sfwDataType=t.DataType;i.dictAttributes.sfwEntity=t.Entity;i.dictAttributes.sfwValueSource="Parameter";i.dictAttributes.sfwParameterValue=t.Value;this.Elements.length==0?n.PushItem(i,this.Elements):this.Elements.some(function(n){return n.dictAttributes.sfwParamaterName==t.ID})||n.PushItem(i,this.Elements)}for(angular.forEach(c.Parameters,l,i.model),t=0;t<u.length;t++)u[t]&&u[t].dictAttributes&&u[t].dictAttributes.sfwParamaterName&&(f=i.model.Elements.filter(function(n){return n.dictAttributes.sfwParamaterName==u[t].dictAttributes.sfwParamaterName&&n.dictAttributes.sfwDataType==u[t].dictAttributes.sfwDataType}),f&&f.length>0&&(u[t].dictAttributes.sfwValueSource&&n.EditPropertyValue(f[0].dictAttributes.sfwValueSource,f[0].dictAttributes,"sfwValueSource",u[t].dictAttributes.sfwValueSource),u[t].dictAttributes.sfwParameterValue&&n.EditPropertyValue(f[0].dictAttributes.sfwParameterValue,f[0].dictAttributes,"sfwParameterValue",u[t].dictAttributes.sfwParameterValue),u[t].Elements.length>0&&u[t].Elements[0].Name=="value"&&(n.EditPropertyValue(f[0].valueModel,f[0],"valueModel",u[t].Elements[0]),n.PushItem(f[0].valueModel,f[0].Elements))))}};i.dialog=n.showDialog(i,"Set Method Parameter","BPM/views/Association/SetServiceMethodParameter.html",{height:400,width:800})};h.setscalarquery=function(){var i=t.$new();i.model=angular.copy(h.model.baseChild);i.IsDisabledforVersioning=h.isDisabledforVersioning;i.queryParametersValues=h.queryParametersvalues;i.queryParameterallowedValues=h.queryParameterallowedValues;i.addQuery=function(){var n=new objElements;n.Name="Query";i.model.Elements.push(n)};i.getQueryParam_dialog=function(t){var r=i.$new(!0);r.DialogConstants={queryParamsName:"sfwNavigationParameter"};r.mapObj={};r.queryValues=i.queryParameterallowedValues;r.queryParameters=s.getQueryparamfromString(t.dictAttributes,"sfwQueryParameters",";");r.QueryDialog=n.showDialog(r,"Set Query Parameters","Common/views/SetQueryParameters.html",{width:500,height:500});r.setQueryParameters=function(){function i(n){this.push(n.ID+"="+(n.Value?n.Value:""))}var n=[];angular.forEach(r.queryParameters,i,n);t.dictAttributes.sfwQueryParameters=n.join(";");r.QueryDialog.close()}};i.onOKClick=function(){for(n.UndRedoBulkOp("Start");h.model.baseChild.Elements.length>0;)n.DeleteItem(h.model.baseChild.Elements[0],h.model.baseChild.Elements,null);for(var t=0;t<i.model.Elements.length;t++)n.PushItem(i.model.Elements[t],h.model.baseChild.Elements);n.UndRedoBulkOp("End");i.closeDialog()};i.closeDialog=function(){i.dialog&&i.dialog.close()};i.NavigateToEntityQuery=function(n){if(n&&n!=""&&n.contains(".")){i.onOKClick();var t=n.split(".");o.NavigateToFile(t[0],"queries",t[1])}};i.deleteQuery=function(){var n=i.model.Elements.indexOf(i.selectedqueryNode);i.model.Elements.splice(n,1);i.selectedqueryNode=undefined};i.dialog=n.showDialog(i,"Set Scalar Queries","BPM/views/Association/SetScalarQueries.html",{height:400,width:800})};h.showVariablesByEntity=function(){return function(n){var t=!1;return h.model.baseChild.dictAttributes.sfwEntity&&h.model.baseChild.dictAttributes.sfwEntity.trim().length>0&&(t=n.dictAttributes.sfwEntity===h.model.baseChild.dictAttributes.sfwEntity),t}}}function bpmSequenceFlowAssociationPropertiesController(){var n=this;n.$onInit=function(){function t(t){if(t.Name=="extensionElements"&&t.Elements&&Object.prototype.toString.call(t.Elements)==="[object Array]"&&t.Elements.length>0){function i(t){if(t.Name=="conditionExpression"){n.gatewayOperator=t.dictAttributes;function i(t){t.Name=="leftside"?n.leftSideExpression=t.dictAttributes:t.Name=="rightside"&&(n.rightSideExpression=t.dictAttributes)}return t.Elements.forEach(i),!0}}return t.Elements.forEach(i),!0}}n.model.Elements.some(t)}}function setValueByConstantVariableQueryController(n,t){var i=this;i.onTypechange=function(){n.UndRedoBulkOp("Start");n.EditPropertyValue(i.model.sfwQueryID,i.model,"sfwQueryID","");n.EditPropertyValue(i.model.sfwQueryParameters,i.model,"sfwQueryParameters","");n.EditPropertyValue(i.model.value,i.model,"value","");n.UndRedoBulkOp("End")};i.getParamfromQueryId=function(r){n.UndRedoBulkOp("Start");n.EditPropertyValue(i.model.value,i.model,"value","");n.EditPropertyValue(i.model.sfwQueryParameters,i.model,"sfwQueryParameters",t.get(r));n.UndRedoBulkOp("End")}}function enterReEnterController(n,t,i,r,u){var f=this,e;f.model.SelectActiveFormType="Single";f.ActiveFormType="Lookup,Maintenance,Wizard";f.model.dictAttributes.sfwFormName!=undefined&&f.model.dictAttributes.sfwFormName!=""&&f.model.dictAttributes.sfwFormName.contains("=")&&(f.model.SelectActiveFormType="Multiple");f.onChangeActiveForm=function(){var n,r,u,e,o;for(t.UndRedoBulkOp("Start"),f.model.SelectActiveFormType=="Single"?t.EditPropertyValue("Multiple",f.model,"SelectActiveFormType","Single"):t.EditPropertyValue("Single",f.model,"SelectActiveFormType","Multiple"),t.EditPropertyValue(f.model.dictAttributes.sfwVariableName,f.model.dictAttributes,"sfwVariableName",""),t.EditPropertyValue(f.model.dictAttributes.sfwFormName,f.model.dictAttributes,"sfwFormName",""),t.EditPropertyValue(f.model.dictAttributes.sfwFocusControlID,f.model.dictAttributes,"sfwFocusControlID","");f.model.Elements.length>0;)t.DeleteItem(f.model.Elements[0],f.model.Elements);while(f.model.dictAttributes.sfwMode=="update"&&f.parent.actionsModel&&f.parent.actionsModel.Elements.length>0)t.DeleteItem(f.parent.actionsModel.Elements[0],f.parent.actionsModel.Elements);if(f.model.dictAttributes.sfwMode=="update"&&f.parent.extensionElementModel&&(n=i("filter")(f.parent.extensionElementModel.Elements,{Name:"performers"},!0),n&&n.length>0&&n[0].Elements&&n[0].Elements.length>0))if(n[0].Elements[0].Name=="preconditions"){for(r=f.parent.extensionElementModel.Elements.length-1;r>=0;r--)f.parent.extensionElementModel.Elements[r].Name=="performers"&&t.DeleteItem(f.parent.extensionElementModel.Elements[r],f.parent.extensionElementModel.Elements);u={Children:[],dictAttributes:{},Elements:[],Value:"",Name:"performers"};e={dictAttributes:{},Elements:[{dictAttributes:{sfwName:"Always"},Elements:[],Children:[],Name:"precondition",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"preconditions",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""};u.Elements.push(e);t.InsertItem(u,f.parent.extensionElementModel.Elements,0)}else if(n[0].Elements[0].Name=="defaultcondition"){for(o={dictAttributes:{},Elements:[],Children:[],Name:"defaultcondition",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""};n[0].Elements.length>0;)t.DeleteItem(n[0].Elements[0],n[0].Elements);t.InsertItem(o,n[0].Elements,0)}f.setFormType(!0);t.UndRedoBulkOp("End")};f.lstActiveForm=[];f.setlstActiveForms=function(){var n,t,i;if(f.lstActiveForm=[],f.model.dictAttributes.sfwFormName&&f.model.dictAttributes.sfwFormName.contains("=")&&(n=f.model.dictAttributes.sfwFormName.split(";"),n))for(t=0;t<n.length;t++)i=n[t].split("="),f.lstActiveForm.push({FieldValue:i[0],ActiveForm:i[1]})};f.setlstActiveForms();f.setVisibleRulesForMultipleForms=function(i){var r=n.$new(!0),u,o,e,s;for(r.lstActiveForm=f.lstActiveForm,r.model=f.model,r.lstVisibleRules=[],r.getlstVisibleRules=function(n){var u=r.model.dictAttributes[n],t,i,f;if(u&&u.contains("=")&&(t=u.split(";"),t))for(i=0;i<t.length;i++)f=t[i].split("="),r.lstVisibleRules.push({ActiveForm:f[0],VisibleRule:f[1]})},r.getlstVisibleRules(i),u=r.lstVisibleRules.length-1;u>=0;u--){for(o=!1,e=0;e<r.lstActiveForm.length;e++)if(r.lstVisibleRules[u].ActiveForm==r.lstActiveForm[e].ActiveForm){o=!0;break}o||r.lstVisibleRules.splice(u,1)}for(u=0;u<r.lstActiveForm.length;u++){for(o=!1,e=0;e<r.lstVisibleRules.length;e++)if(r.lstVisibleRules[e].ActiveForm==r.lstActiveForm[u].ActiveForm){o=!0;break}o||(s={},s.ActiveForm=r.lstActiveForm[u].ActiveForm,s.VisibleRule="",r.lstVisibleRules.push(s))}r.selectActiveFormRow=function(n){r.selectedActiveForm=n};r.OkClick=function(){var u="",e=f.model.dictAttributes[i],n;if(r.lstVisibleRules.length>0){for(n=0;n<r.lstVisibleRules.length;n++)r.lstVisibleRules[n].ActiveForm!=""&&r.lstVisibleRules[n].VisibleRule!=""&&(u==""?u=r.lstVisibleRules[n].ActiveForm+"="+r.lstVisibleRules[n].VisibleRule:u+=";"+r.lstVisibleRules[n].ActiveForm+"="+r.lstVisibleRules[n].VisibleRule);t.EditPropertyValue(f.model.dictAttributes[i],f.model.dictAttributes,i,u)}else t.EditPropertyValue(f.model.dictAttributes[i],f.model.dictAttributes,i,"");r.CancelClick()};r.CancelClick=function(){r.VisibleRuleFormDialog.close()};r.onVisibleRuleChange=function(n,t){var i;(t.keyCode&&t.keyCode!=13&&t.key!="Down"&&t.key!="Up"&&t.key!="Left"&&t.key!="Right"||t.type=="click")&&(i=t.type&&t.type=="click"?$(t.target).prevAll("input[type='text']"):$(t.target),n&&!n.VisibleRules&&n.ActiveForm&&n.ActiveForm.contains("Maintenance")&&$.connection.hubBPMN.server.getFormModel(n.ActiveForm).done(function(t){n&&t&&(n.VisibleRules=t.VisibleRules,setSingleLevelAutoComplete(i,n.VisibleRules,r,"Code","Description"))}),n.VisibleRules&&(t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&$(i).data("ui-autocomplete")?($(i).autocomplete("search",$(i).val()),t.preventDefault()):(setSingleLevelAutoComplete(i,n.VisibleRules,r,"Code","Description"),$(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val())),t.type&&t.type=="click"&&(i.focus(),$(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val()))));t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&t.preventDefault()};r.IsDisabledforVersioning=f.IsDisabledforVersioning;r.VisibleRuleFormDialog=t.showDialog(r,"Set Visible Rules","BPM/views/Association/BpmVisibleRulesForMultipleActiveForms.html",{width:800,height:500})};f.onAddMultipleActiveFormClick=function(){var i=n.$new(!0);i.model=f.model;f.setlstActiveForms();i.ActiveFormType=f.ActiveFormType;i.lstActiveForm=f.lstActiveForm;i.AddActiveForm=function(){i.lstActiveForm.push({FieldValue:"",ActiveForm:""})};i.DeleteActiveForm=function(){if(i.selectedActiveForm&&i.selectedActiveForm!=""){var n=i.lstActiveForm.indexOf(i.selectedActiveForm);n>-1?i.lstActiveForm.splice(n,1):i.selectedActiveForm=undefined}};i.selectActiveFormRow=function(n){i.selectedActiveForm=n};i.validateActiveForms=function(){return(i.ErrorMessageForDisplay="",i.lstActiveForm.length==0)?(i.ErrorMessageForDisplay="Atleast one active form has to be added.",!0):i.lstActiveForm.length>0&&i.lstActiveForm.some(function(n){return n.FieldValue===""})?(i.ErrorMessageForDisplay="Field Value can not be null.",!0):i.lstActiveForm.length>0&&i.lstActiveForm.some(function(n){return n.ActiveForm===""})?(i.ErrorMessageForDisplay="Active Form can not be null.",!0):!1};i.OkClick=function(){var r="",u=f.model.dictAttributes.sfwFormName,n;if(i.lstActiveForm.length>0){for(n=0;n<i.lstActiveForm.length;n++)i.lstActiveForm[n].FieldValue!=""&&i.lstActiveForm[n].ActiveForm!=""&&(r==""?r=i.lstActiveForm[n].FieldValue+"="+i.lstActiveForm[n].ActiveForm:r+=";"+i.lstActiveForm[n].FieldValue+"="+i.lstActiveForm[n].ActiveForm);t.EditPropertyValue(f.model.dictAttributes.sfwFormName,f.model.dictAttributes,"sfwFormName",r)}else t.EditPropertyValue(f.model.dictAttributes.sfwFormName,f.model.dictAttributes,"sfwFormName","");u!=r&&f.onFormNameChanged();i.CancelClick()};i.CancelClick=function(){i.ActiveFormDialog.close()};i.IsDisabledforVersioning=f.IsDisabledforVersioning;i.ActiveFormDialog=t.showDialog(i,"Active Forms","BPM/views/BpmActiveForms.html",{width:800,height:500})};f.$onInit=function(){f.refreshParam=!1;f.formData={entityID:"",formTitle:"",controlTree:[],initialLoadModel:{},visibleRules:[]};f.setNewActiveFormData();f.parent.currentUserTaskData.formList.length==0&&($.connection.hubMain.server.getFilesByType("Maintenance,Lookup,Wizard","ScopeId_"+n.$id,null),n.receiveList=function(n){f.parent.currentUserTaskData.formList=n});f.setFormType()};f.setNewActiveFormData=function(){f.model.dictAttributes.sfwFormName&&f.model.dictAttributes.sfwFormName.trim().length>0&&(f.model.dictAttributes.sfwFormName.contains("=")&&f.lstActiveForm.length>0?$.connection.hubBPMN.server.getFormModel(f.lstActiveForm[0].ActiveForm).done(e):$.connection.hubBPMN.server.getFormModel(f.model.dictAttributes.sfwFormName).done(e))};e=function(t){if(t){var i=function(){updateCurrentUserTaskData(f,t)};n.$evalAsync(i);f.refreshParam&&n.$evalAsync(function(){n.initParam()})}};f.onFormNameChanged=function(){var n,i;t.UndRedoBulkOp("Start");f.model.dictAttributes.sfwFormName&&f.model.dictAttributes.sfwFormName.trim().length>0?(f.addModel(),f.resetModel(),n=f.model.dictAttributes.sfwFormName,n.contains("=")&&f.lstActiveForm.length>0&&f.lstActiveForm[0].ActiveForm&&(n=f.lstActiveForm[0].ActiveForm),i=f.isValidFile(n),i?$.connection.hubBPMN.server.getFormModel(n).done(e):(f.removeModel(),f.resetModel())):(f.removeModel(),f.resetModel());t.UndRedoBulkOp("End")};f.addModel=function(){var n=f.extelementmodel.Elements.indexOf(f.model);n==-1&&t.PushItem(f.model,f.extelementmodel.Elements)};f.removeModel=function(){var n=f.extelementmodel.Elements.indexOf(f.model);n>-1&&t.DeleteItem(f.model,f.extelementmodel.Elements)};f.resetModel=function(){t.EditPropertyValue(f.model.dictAttributes.FormTitle,f.model.dictAttributes,"FormTitle","");t.EditPropertyValue(f.model.dictAttributes.sfwFocusControlID,f.model.dictAttributes,"sfwFocusControlID","");t.EditPropertyValue(f.model.dictAttributes.sfwBpmSubmitButtonVisibleRule,f.model.dictAttributes,"sfwBpmSubmitButtonVisibleRule","");t.EditPropertyValue(f.model.dictAttributes.sfwBpmApproveButtonVisibleRule,f.model.dictAttributes,"sfwBpmApproveButtonVisibleRule","");t.EditPropertyValue(f.model.dictAttributes.sfwBpmRejectButtonVisibleRule,f.model.dictAttributes,"sfwBpmRejectButtonVisibleRule","");t.EditPropertyValue(f.model.Elements,f.model,"Elements",[]);f.setFormType(!0);f.formData.initialLoadModel=null;f.formData.entityID=null;f.formData.remoteObject=null;f.formData.formTitle=null;f.formData.controlTree=null;f.formData.visibleRules=null;f.formData.lookupParameters=null};f.setFormType=function(n){var i="";i=f.model.dictAttributes.sfwFormName&&f.model.dictAttributes.sfwFormName.contains("=")&&f.lstActiveForm.length>0?f.lstActiveForm[0].ActiveForm:f.model.dictAttributes.sfwFormName;i&&i.trim().length>0?n?i.indexOf("Lookup")==i.length-6?t.EditPropertyValue(f.formType,f,"formType","lookup"):i.indexOf("Maintenance")==i.length-11?t.EditPropertyValue(f.formType,f,"formType","maintenance"):i.indexOf("Wizard")==i.length-6?t.EditPropertyValue(f.formType,f,"formType","wizard"):t.EditPropertyValue(f.formType,f,"formType",""):f.formType=i.indexOf("Lookup")==i.length-6?"lookup":i.indexOf("Maintenance")==i.length-11?"maintenance":i.indexOf("Wizard")==i.length-6?"wizard":"":t.EditPropertyValue(f.formType,f,"formType","")};f.onFormNameKeyDown=function(n){var t=$(n.target),i=f.parent.currentUserTaskData.formList;setSingleLevelAutoComplete(t,i);n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")&&($(t).autocomplete("search",$(t).val()),n.preventDefault())};f.showFormNameIntellisenseList=function(n){var t=$(n.target).prevAll("input[type='text']"),i;t.focus();i=f.parent.currentUserTaskData.formList;setSingleLevelAutoComplete(t,i);$(t).data("ui-autocomplete")&&$(t).autocomplete("search",$(t).val())};f.setNavigationParameters=function(){var i=n.$new(),r=getCurrentFileScope();i.lstGlobalParameters=r.lstGlobalParameters;r&&(i.variables=r.mapVariablesModel.Elements);i.formType=f.formType;n.initParam=function(){var n,t,u,r;if(i.parameters=f.getParameters(),f.formType=="lookup")i.criteriaFields=f.formData.lookupParameters,i.selectCriteriaField=function(n){i.selectedCriteriaField=n},i.deleteParameter=function(){var n=i.parameters.indexOf(i.selectedParameter);n>-1&&i.parameters.splice(n,1)},i.canDeleteParameter=function(){return i.selectedParameter?!0:!1};else if(i.parameters&&i.parameters.length!=0||(i.parameters=[],n={},n.fieldName="",n.name=f.model.dictAttributes.sfwFormMode!="new"?"aintPrimaryKey":"ParentKey",n.source="",n.value="",i.parameters.push(n),f.model.dictAttributes.sfwFormMode=="new"&&(n={},n.fieldName="",n.name="ParentKeyName",n.source="",n.value="",i.parameters.push(n))),i.parameters)for(t=f.model.Elements.length-1;t>-1;t--){if(u=!1,f.model.Elements[t].Name=="parameter")for(r=0;r<i.parameters.length;r++)if(f.model.Elements[t].dictAttributes.sfwParamaterName==i.parameters[r].name){u=!0;i.parameters[r].value=f.model.Elements[t].dictAttributes.sfwParameterValue;i.parameters[r].source=f.model.Elements[t].dictAttributes.sfwValueSource;break}u||f.model.Elements.splice(t,1)}};i.selectParameter=function(n){i.selectedParameter=n};i.onSaveClick=function(){function n(n){t.PushItem({prefix:"",Name:"parameter",dictAttributes:{sfwParamaterName:n.name,sfwValueSource:n.source,sfwParameterValue:n.value,sfwFieldName:n.fieldName,sfwDataType:n.dataType},Elements:[],Children:[]},f.model.Elements)}t.UndRedoBulkOp("Start");t.EditPropertyValue(f.model.Elements,f.model,"Elements",[]);angular.forEach(i.parameters,n);i.onCancelClick();t.UndRedoBulkOp("End")};i.onCancelClick=function(){i.dialog&&i.dialog.close()};i.IsDisabledforVersioning=f.IsDisabledforVersioning;i.setActiveFormData=function(){f.setNewActiveFormData();f.refreshParam=!0};n.initParam();i.dialog=t.showDialog(i,"Set Navigation Parameters","BPM/views/Association/UserTaskSetNavigationParametersTemplate.html",{height:450,width:1100})};f.getParameters=function(){var e,c,t,n,o,s;if(f.formType=="lookup")return n=f.model.Elements.map(function(n){return{name:n.dictAttributes.sfwParamaterName,source:n.dictAttributes.sfwValueSource,value:n.dictAttributes.sfwParameterValue,dataType:n.dictAttributes.sfwDataType,fieldName:n.dictAttributes.sfwFieldName}});var u=f.formData.initialLoadModel,l=f.formData.entityID,h=f.formData.remoteObject;if(u)if(c=f.isenter&&(f.model.dictAttributes.sfwFormMode==undefined||f.model.dictAttributes.sfwFormMode=="new")?"New":"Update",t=undefined,u.Elements&&u.Elements.length>0&&(t=u.Elements.filter(function(n){return n.Name=="callmethods"&&(!n.dictAttributes.hasOwnProperty("sfwMode")||n.dictAttributes.sfwMode==c)})),t&&t.length>0&&(e=t[0].dictAttributes.sfwMethodName),e){if(h?(o=i("filter")(h.Elements,{dictAttributes:{ID:e}},!0),o&&o.length>0&&(n=o[0].Elements.map(function(n){return{name:n.dictAttributes.ID,source:"",value:"",fieldName:n.ID}}))):(s=r.getXmlMethodParameters(l,e,!0),s&&s.length>0&&(n=s.map(function(n){return{name:n.ID,source:"",value:"",fieldName:n.ID}}))),n&&n.length>0){function a(n){var t=i("filter")(f.model.Elements,{dictAttributes:{sfwParamaterName:n.name}},!0);t&&t.length>0&&(n.source=t[0].dictAttributes.sfwValueSource,n.value=t[0].dictAttributes.sfwParameterValue)}return angular.forEach(n,a),n}}else if(f.model.Elements.length>0)return f.model.Elements.map(function(n){return{name:n.dictAttributes.sfwParamaterName,source:n.dictAttributes.sfwValueSource,value:n.dictAttributes.sfwParameterValue,fieldName:n.dictAttributes.sfwFieldName}})};f.setFocusControlID=function(){focusControlDialogScope=n.$new();focusControlDialogScope.controlTree=f.formData.controlTree;focusControlDialogScope.onSaveClick=function(){t.EditPropertyValue(f.model.dictAttributes.sfwFocusControlID,f.model.dictAttributes,"sfwFocusControlID",focusControlDialogScope.selectedControlID);focusControlDialogScope.onCancelClick()};focusControlDialogScope.onCancelClick=function(){focusControlDialogScope.dialog&&focusControlDialogScope.dialog.close()};focusControlDialogScope.selectControlID=function(n){focusControlDialogScope.selectedControlID=n.ID};focusControlDialogScope.dialog=t.showDialog(focusControlDialogScope,"","BPM/views/SelectFocusControlTemplate.html")};f.onVisibleRuleKeyDown=function(n){var i=[],t=$(n.target);n.key!="Down"&&n.key!="Up"&&n.key!="Left"&&n.key!="Right"&&(i=f.formData.visibleRules,n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")?($(t).autocomplete("search",$(t).val()),n.preventDefault()):setSingleLevelAutoComplete($(n.target),i,f,"Code","Description"))};f.showVisibleRuleIntellisenseList=function(n){var t=$(n.target).prevAll("input[type='text']"),i=[];i=f.formData.visibleRules;t.focus();setSingleLevelAutoComplete(t,i,f,"Code","CodeDescription");$(t).data("ui-autocomplete")&&$(t).autocomplete("search",$(t).val())};f.NavigateToForm=function(n){n&&n!=""&&(n.contains("=")&&f.lstActiveForm.length>0&&f.lstActiveForm[0].ActiveForm&&(n=f.lstActiveForm[0].ActiveForm),hubMain.server.navigateToFile(n,"").done(function(n){t.openFile(n,undefined)}))};f.NavigateToFormControl=function(n,t){t.contains("=")&&f.lstActiveForm.length>0&&f.lstActiveForm[0].ActiveForm&&(t=f.lstActiveForm[0].ActiveForm);n&&t&&t!=""&&n!=""&&u.NavigateToFile(t,"",n)};f.NavigateToVisibleRule=function(n){var t=f.formData.entityID;n&&n!=""&&u.NavigateToFile(t,"initialload",n)};f.setTaskActions=function(){var i,r,u;if(f.model&&f.model.dictAttributes.sfwFormName&&f.model.dictAttributes.sfwFormName.trim().length>0&&(i=f.model.dictAttributes.sfwFormName,f.model.dictAttributes.sfwFormName.contains("=")&&(f.setlstActiveForms(),f.lstActiveForm.length>0&&f.lstActiveForm[0].ActiveForm&&(i=f.lstActiveForm[0].ActiveForm)),f.isValidFile(i))){if(taskActionsScope=n.$new(),taskActionsScope.ActiveFormType=f.model.SelectActiveFormType,taskActionsScope.lstActiveForm=f.lstActiveForm,f.parent.actionsModel){taskActionsScope.actionsModel=JSON.parse(JSON.stringify(f.parent.actionsModel));r=taskActionsScope.actionsModel.Elements.filter(function(n){return n.Elements.length>0});function e(n){n.selectedVariable=n.Elements[0];n.selectedVariableID=n.selectedVariable.dictAttributes.ID}angular.forEach(r,e)}taskActionsScope.IsDisabledforVersioning=f.IsDisabledforVersioning;taskActionsScope.isObjectbased=f.isObjectbased;u=function(n){var t=function(){taskActionsScope.entities=n[0];taskActionsScope.buttons=n[1]};taskActionsScope.$evalAsync(t)};taskActionsScope.variables=f.parent.queryParametersValues;$.connection.hubBPMN.server.getAssociatedFormData(i).done(u);taskActionsScope.onEntityChanged=function(n){n&&n.selectedVariable&&(n.selectedVariable.dictAttributes.sfwEntityField="")};taskActionsScope.onProcessVariableChanged=function(n){n&&(n.Elements.length>0&&n.Elements.splice(0,1),n.dictAttributes.sfwButtonID&&n.dictAttributes.sfwButtonID.trim().length>0&&(n.selectedVariable={prefix:"sbpmn",Name:"variable",Value:"",Elements:[],Children:[],dictAttributes:{ID:n.selectedVariableID,sfwEntity:n.dictAttributes.sfwEntity}},n.Elements.push(n.selectedVariable)))};taskActionsScope.onIsConstantChanged=function(n){n&&(n.dictAttributes.sfwEntity="",n.selectedVariable&&(n.selectedVariable.dictAttributes.sfwEntity="",n.selectedVariable.dictAttributes.sfwEntityField=""))};taskActionsScope.getButtonsAndEntitiesFromActiveForm=function(n){n&&n.dictAttributes&&n.dictAttributes.sfwActiveForm?$.connection.hubBPMN.server.getAssociatedFormData(n.dictAttributes.sfwActiveForm).done(function(t){taskActionsScope.$evalAsync(function(){n.entities=t[0];n.buttons=t[1]})}):n&&(n.entities=[],n.buttons=[])};taskActionsScope.selectAction=function(n,t){if(t){var i=taskActionsScope.actionsModel.Elements.filter(function(n){return n.isSelected});i&&i.length>0&&(i[0].isSelected=!1);n.isSelected=!0}else{function r(t){t.isSelected=t==n}angular.forEach(taskActionsScope.actionsModel.Elements,r)}};taskActionsScope.addAction=function(){var n={prefix:"sbpmn",Name:"action",dictAttributes:{},Elements:[],Value:"",Children:[]};taskActionsScope.actionsModel.Elements.push(n);taskActionsScope.selectAction(n,!0)};taskActionsScope.canDeleteAction=function(){if(taskActionsScope.actionsModel!=undefined&&taskActionsScope.actionsModel.Elements!=undefined)return taskActionsScope.actionsModel.Elements.some(function(n){return n.isSelected})};taskActionsScope.deleteAction=function(){var t=taskActionsScope.actionsModel.Elements.filter(function(n){return n.isSelected}),n,i;t&&t.length>0&&(n=taskActionsScope.actionsModel.Elements.indexOf(t[0]),n>-1&&(i=n+1==taskActionsScope.actionsModel.Elements.length?taskActionsScope.actionsModel.Elements[n-1]:taskActionsScope.actionsModel.Elements[n+1],i&&taskActionsScope.selectAction(i,!0),taskActionsScope.actionsModel.Elements.splice(n,1)))};taskActionsScope.onOKClick=function(){for(t.UndRedoBulkOp("Start");f.parent.actionsModel.Elements.length>0;)t.DeleteItem(f.parent.actionsModel.Elements[0],f.parent.actionsModel.Elements,null);for(var n=0;n<taskActionsScope.actionsModel.Elements.length;n++)t.PushItem(taskActionsScope.actionsModel.Elements[n],f.parent.actionsModel.Elements);t.UndRedoBulkOp("End");taskActionsScope.closeDialog()};taskActionsScope.closeDialog=function(){taskActionsScope.dialog&&taskActionsScope.dialog.close()};taskActionsScope.dialog=t.showDialog(taskActionsScope,"Task Actions","BPM/views/Association/SetUserTaskActions.html",{width:1100});taskActionsScope.OnChangeOfActiveForms=function(n){n&&(n.dictAttributes.sfwButtonID="",n.selectedVariable&&n.selectedVariable.dictAttributes&&(n.selectedVariable.dictAttributes.sfwEntity="",n.selectedVariable.dictAttributes.sfwEntityField="",n.selectedVariableID=""))}}};f.isValidFile=function(n){for(var i=!1,t=0;t<f.parent.currentUserTaskData.formList.length;t++)if(f.parent.currentUserTaskData.formList[t]&&n&&f.parent.currentUserTaskData.formList[t].toLowerCase()==n.toLowerCase().trim()){i=!0;break}return i}}function updateCurrentUserTaskData(n,t){n.formData.entityID=t.EntityID;n.model.dictAttributes.FormTitle=t.FormTitle;n.formData.controlTree=t.ControlTree;n.formData.initialLoadModel=t.InitialLoadModel;n.formData.visibleRules=t.VisibleRules;n.formData.lookupParameters=t.LookupParameters;n.formData.remoteObject=t.RemoteObject}function bpmLanePerformersPropertiesController(n){var i=n("filter")(this.shapeModel.Elements,{Name:"extensionElements"}),t;i&&i.length>0&&(this.extensionElementModel=i[0]);t=n("filter")(this.extensionElementModel.Elements,{Name:"userrole"})[0];t==null||t==undefined?(t={prefix:"sbpmn",Name:"userrole",dictAttributes:{roles:""},IsValueInCDATAFormat:!1,Elements:[],Children:[]},this.extensionElementModel.Elements.push(t)):t.dictAttributes.roles==undefined&&(t.dictAttributes.roles="");this.userRoleModel=t}function bpmUserTaskPerformersProperties(n,t,i,r){var u=this,o,s,f,e,h;u.queryParametersValues=t.getMapVariableIds(u.mapvariablesmodel.Elements);o=n("filter")(u.shapeModel.Elements,{Name:"extraSettings"});o&&o.length>0&&(u.ExtraSettingsModel=o[0]);u.ExtraSettingsModel&&!u.ExtraSettingsModel.dictAttributes.sfwCanCompleteFromLeftPanel&&(u.ExtraSettingsModel.dictAttributes.sfwCanCompleteFromLeftPanel="False");s=n("filter")(u.shapeModel.Elements,{Name:"extensionElements"});s&&s.length>0&&(u.extensionElementModel=s[0]);f=n("filter")(u.extensionElementModel.Elements,{Name:"performers"});f&&f.length>0&&(u.PerformersModel=f[0],u.PerformersModels=f);u.PerformersModel&&(e=n("filter")(u.PerformersModel.Elements,{Name:"defaultcondition"}),e&&e.length>0&&(u.defaultConditionModel=e[0],u.defaultConditionModels=e));u.PerformersModel&&u.PerformersModel.dictAttributes.sfwFollowAssignmentUsingParameter==undefined&&(u.PerformersModel.dictAttributes.sfwFollowAssignmentUsingParameter="False");u.AssignmentOptions=["By Load","Everyone","Sequential"];u.ObjConditonAndExternaltask={IsPreCondition:!1,IsExternaltask:!1};u.PerformersModel&&u.PerformersModel.Elements[0].Name=="preconditions"&&(u.ObjConditonAndExternaltask.IsPreCondition=!0,u.objPreconditonsModel=u.PerformersModel.Elements[0],u.objPreconditonModel=u.objPreconditonsModel.Elements[0]);h=n("filter")(u.extensionElementModel.Elements,{Name:"externalTask"});h&&h.length>0&&(u.ObjConditonAndExternaltask.IsExternaltask=!0,u.externalTaskModel=h[0]);u.onChangeConstant=function(){u.PerformersModel.dictAttributes.sfwFollowAssignment="";u.populateFollowAssignmentValues()};u.populateFollowAssignmentValues=function(){if(u.FollowAssignmentOptions=[],u.PerformersModel.dictAttributes.sfwFollowAssignmentUsingParameter&&u.PerformersModel.dictAttributes.sfwFollowAssignmentUsingParameter!="False"){var n=u.mapvariablesmodel.Elements.filter(function(n){return n.dictAttributes.dataType=="bool"});n&&n.length>0&&(u.FollowAssignmentOptions=n.map(function(n){return n.dictAttributes.id}))}else u.FollowAssignmentOptions=["True","False"]};u.setPreConditionOrDefaultCondition=function(){var t=i.$new(),e,o,f,h,s,c,a,v,y,p;if(t.obj={},e=n("filter")(u.extensionElementModel.Elements,{Name:"performers"}),e&&e.length>0&&(u.PerformersModel=e[0],u.PerformersModels=e),u.PerformersModel&&(o=n("filter")(u.PerformersModel.Elements,{Name:"defaultcondition"}),o&&o.length>0&&(u.defaultConditionModel=o[0],u.defaultConditionModels=o)),u.extensionElementModel&&u.extensionElementModel.Elements.length>0&&(f=n("filter")(u.extensionElementModel.Elements,{Name:"form"},!0)),f&&f.length>0)for(s=0;s<f.length;s++)if(f[s].dictAttributes.sfwMode=="update"){h=f[s];break}if(t.lstActiveForm=[],t.setActiveFomList=function(n){var i,r,u;if(n&&n.contains("=")&&(i=n.split(";"),i))for(r=0;r<i.length;r++)u=i[r].split("="),t.lstActiveForm.push(u[1])},h&&t.setActiveFomList(h.dictAttributes.sfwFormName),t.AddDefaultConditionModelsForMultipleForms=function(n,t,i){var e,o,r,s,f,u,h;if(i=="Default"){for(e=n.length-1;e>=0;e--)if(n[e].dictAttributes.sfwActiveForm){for(u=!1,r=0;r<t.length>0;r++)if(n[e].dictAttributes.sfwActiveForm==t[r]){u=!0;break}u||n.splice(e,1)}else n.splice(e,1);for(f=0;f<t.length;f++){for(u=!1,l=0;l<n.length;l++)if(n[l].dictAttributes.sfwActiveForm==t[f]){u=!0;break}u||(o={dictAttributes:{},Elements:[],Children:[],Name:"defaultcondition",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},o.dictAttributes.sfwActiveForm=t[f],n.push(o))}}else{for(r=n.Elements.length-1;r>=0;r--)if(n.Elements[r].dictAttributes.sfwActiveForm){for(u=!1,r=0;r<t.length>0;r++)if(n.Elements[r].dictAttributes.sfwActiveForm==t[r]){u=!0;break}u||n.Elements.splice(e,1)}else n.Elements.splice(r,1);for(s=n,f=0;f<t.length;f++){for(u=!1,m=0;m<n.Elements.length;m++)if(n.Elements[m].dictAttributes.sfwActiveForm==t[f]){u=!0;break}!u&&s&&(h={dictAttributes:{},Elements:[{dictAttributes:{sfwName:"Always"},Elements:[],Children:[],Name:"precondition",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"preconditions",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},h.dictAttributes.sfwActiveForm=t[f],s.Elements.push(h))}}},c=JSON.stringify(u.ObjConditonAndExternaltask),t.ObjConditonAndExternaltask=JSON.parse(c),u.defaultConditionModel&&!u.ObjConditonAndExternaltask.IsPreCondition&&(t.lstActiveForm&&t.lstActiveForm.length==0?(a=JSON.stringify(u.defaultConditionModel),t.defaultConditionModel=JSON.parse(a)):(v=JSON.stringify(u.defaultConditionModels),t.defaultConditionModels=JSON.parse(v),t.AddDefaultConditionModelsForMultipleForms(t.defaultConditionModels,t.lstActiveForm,"Default"))),t.onChangePreconditionsActiveForm=function(n){for(var r,i=0;i<t.PerformersModels.length;i++)for(r=0;r<t.PerformersModels[i].Elements.length;r++)if(t.PerformersModels[i].Elements[r].dictAttributes.sfwActiveForm==n){t.objPreconditonsModel=t.PerformersModels[i].Elements[r];t.objPreconditonModel=t.objPreconditonsModel.Elements[0];break}},u.PerformersModel&&u.ObjConditonAndExternaltask.IsPreCondition&&(y=JSON.stringify(u.PerformersModel),t.PerformersModel=JSON.parse(y),t.PerformersModel&&t.PerformersModel.Elements[0].Name=="preconditions"))if(t.ObjConditonAndExternaltask.IsPreCondition=!0,t.lstActiveForm&&t.lstActiveForm.length==0)t.objPreconditonsModel=t.PerformersModel.Elements[0],t.objPreconditonModel=t.objPreconditonsModel.Elements[0];else{p=JSON.stringify(u.PerformersModels);t.PerformersModels=JSON.parse(p);t.AddDefaultConditionModelsForMultipleForms(t.PerformersModels[0],t.lstActiveForm,"PreConditions");t.PerformersModels.sfwActiveForm=t.lstActiveForm[0];t.onChangePreconditionsActiveForm(t.PerformersModels.sfwActiveForm)}t.mapvariablesmodel=u.mapvariablesmodel;t.IsDisabledforVersioning=u.isdisabledforversioning;t.queryParametersValues=u.queryParametersValues;t.UserRoles=u.userRoles;t.operatorsList=["GreaterThan","GreaterThanEqual","Equal","NotEqual","LessThan","LessThanEqual","StartsWith","EndsWith"];t.setClasstoSelectedObj=function(n){t.obj.selectedobjindex=n};t.lstBPMNRelatedCodeValues=u.lstBpmnRelatedCodeValues;t.addPerformersDefaultCondition=function(){var i={dictAttributes:{roleoperator:"Equal",skilloperator:"Equal",locationoperator:"Equal",authorityLeveloperator:"Equal",positionoperator:"Equal",useroperator:"Equal"},Elements:[],Children:[],Name:"condition",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},n;if(t.defaultConditionModel&&t.lstActiveForm.length==0)t.defaultConditionModel.Elements.push(i);else if(t.defaultConditionModels.sfwActiveForm)for(n=0;n<t.defaultConditionModels.length;n++)if(t.defaultConditionModels[n].dictAttributes.sfwActiveForm==t.defaultConditionModels.sfwActiveForm){t.defaultConditionModels[n].Elements.push(i);break}i.IsUsertaskConditionVisibility=!0};t.deletePerformersDefaultCondition=function(){var i,n,r;if(t.defaultConditionModel&&t.defaultConditionModel.selectedCondition&&t.lstActiveForm.length==0)i=t.defaultConditionModel.Elements.indexOf(t.defaultConditionModel.selectedCondition),t.defaultConditionModel.Elements.splice(i,1),t.defaultConditionModel.selectedCondition=undefined;else if(t.defaultConditionModels&&t.defaultConditionModels.sfwActiveForm)for(n=0;n<t.defaultConditionModels.length;n++)if(t.defaultConditionModels[n].dictAttributes.sfwActiveForm==t.defaultConditionModels.sfwActiveForm){r=t.defaultConditionModels[n].Elements.indexOf(t.defaultConditionModels[n].selectedCondition);t.defaultConditionModels[n].Elements.splice(r,1);t.defaultConditionModels[n].selectedCondition=undefined;break}};t.changePreConditionModelBasedonselectedtab=function(n){t.objPreconditonModel=n;t.obj.selectedobjindex=undefined};t.addPerformersPreCondition=function(){if(t.objPreconditonModel!=null&&t.objPreconditonModel!=undefined){var n={dictAttributes:{roleoperator:"Equal",skilloperator:"Equal",locationoperator:"Equal",authorityLeveloperator:"Equal",positionoperator:"Equal",useroperator:"Equal"},Elements:[],Children:[],Name:"condition",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""};t.objPreconditonModel.Elements.push(n);t.objPreconditonModel.selectedCondition=n;t.objPreconditonModel.selectedCondition.IsUsertaskConditionVisibility=!0}};t.deletePerformersPreCondition=function(){if(t.objPreconditonModel!=null&&t.objPreconditonModel.selectedCondition){var n=t.objPreconditonModel.Elements.indexOf(t.objPreconditonModel.selectedCondition);t.objPreconditonModel.Elements.splice(n,1);t.objPreconditonModel.selectedCondition=undefined}};t.AddNewTabForPreConditonsClick=function(){var u=GetNewConditonName("PreCondition",t.objPreconditonsModel,1),n=i.$new();n.objConditon={};n.objConditon.PreConditionName=u;n.dialog=r.showDialog(n,"","BPM/views/Performer/NewPreConditionTemplate.html");n.setNewPreConditionDetails=function(){var u=!1,i="",r;n.objConditon.PreConditionName?(u=CheckForDuplicateIDForConditions(n.objConditon.PreConditionName,t.objPreconditonsModel),i="Duplicate ID Present. Please enter another ID"):(u=!0,i="ID cannot be blank.");u?i&&alert(i):(r={dictAttributes:{sfwName:"PreCondition"},Elements:[],Children:[],Name:"precondition",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},r.dictAttributes.sfwName=n.objConditon.PreConditionName,t.objPreconditonsModel.Elements.push(r),t.objPreconditonModel=r,t.obj.selectedobjindex=undefined,n.dialog.close())};n.closeNewConditionDialog=function(){n.dialog.close()}};t.removePreconditonfromPreconditionsModel=function(n){t.objPreconditonsModel.Elements.splice(n,1);t.objPreconditonsModel.Elements.length>0&&(t.objPreconditonModel=t.objPreconditonsModel.Elements[t.objPreconditonsModel.Elements.length-1],t.obj.selectedobjindex=undefined)};t.scrollLeft=function(n){n.preventDefault();$element=$(n.target);$element.next("ul").animate({scrollLeft:"-=200px"},"slow")};t.scrollRight=function(n){n.preventDefault();$element=$(n.target);$element.prev("ul").animate({scrollLeft:"+=200px"},"slow")};t.lstActiveForm&&t.defaultConditionModels&&t.lstActiveForm.length>0&&(t.defaultConditionModels.sfwActiveForm=t.lstActiveForm[0]);t.templateName="BPM/views/Performer/UserTaskDefaultandPreconditions.html";t.dialogOptions={height:600,width:800};t.editNameForPreCondition=function(n){if(n&&!t.IsDisabledforVersioning){var f=n.dictAttributes.sfwName,u=i.$new();u.objConditon={};u.objConditon.PreConditionName=f;u.dialog=r.showDialog(u,"","BPM/views/Performer/NewPreConditionTemplate.html");u.setNewPreConditionDetails=function(){var r=!1,i="",f;u.objConditon.PreConditionName?(f=t.objPreconditonsModel.Elements.indexOf(n),r=CheckForDuplicateIDForConditionsWhileEdit(u.objConditon.PreConditionName,t.objPreconditonsModel,f),i="Duplicate ID Present. Please enter another ID"):(r=!0,i="ID cannot be blank.");r?i&&alert(i):(n.dictAttributes.sfwName=u.objConditon.PreConditionName,u.dialog.close())};u.closeNewConditionDialog=function(){u.dialog.close()}}};t.onOKClick=function(){var n,i;if(u.ObjConditonAndExternaltask=t.ObjConditonAndExternaltask,r.UndRedoBulkOp("Start"),t.lstActiveForm.length>0&&!u.ObjConditonAndExternaltask.IsPreCondition?r.EditPropertyValue(u.PerformersModel.Elements,u.PerformersModel,"Elements",t.defaultConditionModels):u.defaultConditionModel&&!u.ObjConditonAndExternaltask.IsPreCondition&&r.EditPropertyValue(u.defaultConditionModel.Elements,u.defaultConditionModel,"Elements",t.defaultConditionModel.Elements),u.PerformersModels&&u.ObjConditonAndExternaltask.IsPreCondition&&t.lstActiveForm.length>0){for(n=u.extensionElementModel.Elements.length-1;n>=0;n--)u.extensionElementModel.Elements[n].Name=="performers"&&r.DeleteItem(u.extensionElementModel.Elements[n],u.extensionElementModel.Elements,null);for(i=0;i<t.PerformersModels.length;i++)r.InsertItem(t.PerformersModels[i],u.extensionElementModel.Elements,0,null)}else u.PerformersModel&&u.ObjConditonAndExternaltask.IsPreCondition&&(r.DeleteItem(u.PerformersModel.Elements[0],u.PerformersModel.Elements,null),r.InsertItem(t.PerformersModel.Elements[0],u.PerformersModel.Elements,0,null));r.UndRedoBulkOp("End");t.dialog.close()};t.onCancelClick=function(){t.dialog.close()};t.dialog=r.showDialog(t,"Condition",t.templateName,t.dialogOptions)};u.removeOrAddModelBasedOnExternaltaskCondition=function(){if(u.ObjConditonAndExternaltask.IsExternaltask)u.externalTaskModel={dictAttributes:{},Elements:[],Children:[],Name:"externalTask",prefix:"",IsValueInCDATAFormat:!1,Value:""},u.extensionElementModel.Elements.push(u.externalTaskModel);else for(var n=0;n<u.extensionElementModel.Elements.length;n++)if(u.extensionElementModel.Elements[n].Name=="externalTask"){u.extensionElementModel.Elements.splice(n,1);break}};u.changeModelBasedOnConditionInPreformers=function(){var t,n;if(u.ObjConditonAndExternaltask.IsPreCondition){for(t={dictAttributes:{},Elements:[{dictAttributes:{sfwName:"Always"},Elements:[],Children:[],Name:"precondition",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""}],Children:[],Name:"preconditions",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""};u.PerformersModel.Elements.length>0;)u.PerformersModel.Elements.splice(0,1);u.PerformersModel.Elements.splice(0,0,t);u.defaultConditionModel=null;u.objPreconditonsModel=u.PerformersModel.Elements[0];u.objPreconditonModel=u.objPreconditonsModel.Elements[0]}else{for(n={dictAttributes:{},Elements:[],Children:[],Name:"defaultcondition",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""};u.PerformersModel.Elements.length>0;)u.PerformersModel.Elements.splice(0,1);u.PerformersModel.Elements.splice(0,0,n);u.defaultConditionModel=n}};u.populateFollowAssignmentValues()}var objElements,scopeforexecutionvaraibles;app.controller("BPMNController",["$scope","$rootScope","$filter","$getQueryparam","$getMultiIndexofArray","$getEnitityRule","$getEnitityXmlMethods","$cssFunc","$EntityIntellisenseFactory","$NavigateToFileService","$getEnitityObjectMethods","hubcontext",function(n,t,i,r,u,f,e,o,s,h,c,l){var y,v,a;t.IsLoading=!0;n.currentfile=t.currentopenfile.file;n.rules=[];y=function(){return{Children:[],Elements:[],Name:"variable",Value:"",dictAttributes:{},prefix:"sbpmn"}};n.BPMNContextMenu=[["Edit SVG Bounds",function(){n.EditSVGheightandwidth()},function(){return!0}]];n.init=function(){n.selectedDesignSource=!1;n.initVariables();n.initSvgVariables();hubMain.server.getModel(t.currentopenfile.file.FilePath,t.currentopenfile.file.FileType).done(function(i){i?n.receiveBpmnModel(i):t.closeFile(n.currentfile.FileName)})};n.initVariables=function(){n.isDirty=!1;n.activeTab="MAP";n.associationActiveTab="FORM";n.datatypes=["bool","datetime","decimal","double","float","int","long","short","string","Object"];n.types=["local","in","out"];n.Requiredtypes=["","true","false"];n.dvtypes=["Query","Constant","CodeGroup"];n.mandatoryElementIds=["PersonId","OrgId","ReferenceId","Source","InstanceInfo1","InstanceInfo2"];n.queryParameterallowedValues=["PersonId","OrgId","ReferenceId","Source"];n.currentUserTaskData={enterFormData:{entityID:"",formTitle:"",controlTree:[],initialLoadModel:{},visibleRules:[]},reEnterFormData:{entityID:"",formTitle:"",controlTree:[],entities:[],buttons:[],initialLoadModel:{},visibleRules:[]},selectedEntity:"BpmActivityInstance",formList:[]};n.selectedCallActivityData={reUsableBpm:[],CalledMapVariable:[]};n.operatorsList=["GreaterThan","GreaterThanEqual","Equal","NotEqual","LessThan","LessThanEqual","StartsWith","EndsWith"];n.TargetSiteList=undefined;n.isExecutionTabLoaded=!1;n.lstMultipleSelectedShapes=[];n.isShowTopandBottomAlignButtons=!0;n.IsDisabledforVersioning=!1;n.selectedElementID=undefined};n.initSvgVariables=function(){n.svgNS="http://www.w3.org/2000/svg";n.selectedElement=0;n.currentX=0;n.currentY=0;n.selectedElementTop=0;n.selectedElementLeft=0;n.selectedElemstartLeft=0;n.selectedElemstartTop=0;n.indexofResizerElement;n.selectedElemPrevBounds=0;n.isElementMoved=!1;n.ClonedElement=null;n.ClonedResizer=null;n.LaneElement=null;n.SelectedElementLane=null;n.selectedResizergElement=0;n.selectedElemForResize=0;n.selectedlineEle=0;n.linecount=0;n.selectedLineSourceElement=0;n.selectedLineTargetElement=0;n.indexOfSelectedLine;n.ClonedLineElement=null;n.selectedlinegtagEle=0;n.selectedlineindex=0;n.isEdgeChanged=!1;n.ClonedLineSourceElement=null;n.ClonedLineTargetElement=null;n.sourceElementOnMouseHover=null;n.targetElementOnMouseHover=null;n.hoverElement=null;n.targetElementForLine=null;n._previousPosition;n.NewEdgeWayPoints;n.PaticipantIndex;n.LaneIndex;n.PrevlaneElement=null;n.objDragOverLineElement=null};n.ShowSource=function(){var s,i,r,e;if(n.selectedDesignSource==!1){if(n.selectedDesignSource=!0,t.IsLoading=!0,t.ClearUndoRedoListByFileName(t.currentopenfile.file.FileName),s=n.BPMNModel,i=JSON.stringify(s),r=[],n.activeTab=="MAP"&&n.selectedShape?r[0]=n.selectedShape.ShapeModel.dictAttributes.id:n.activeTab=="VARIABLES"&&n.selectedVariable&&(r[0]=n.selectedVariable.dictAttributes.id),i.length<32e3)hubMain.server.getBPMSourceXmlObject(i,r);else{var u="",o=[],f=0;for(e=0;e<i.length;e++)f++,u=u+i[e],f==32e3&&(f=0,o.push(u),u="");f!=0&&o.push(u);v(o,n.currentfile,"Design-Source-BPM",r)}n.receivebpmsourcexml=function(i,r){n.$apply(function(){var u=n.currentfile.FileName;setDataToEditor(n,i,r,u);n.$evalAsync(function(){t.IsLoading=!1})})}}};n.ShowDesign=function(){var i,r,o,e;if(n.selectedDesignSource==!0&&(i=n.editor.getValue(),i!=null&&i!="")){if(r=n.editor.selection.getCursor().row,r=r+1,i.length<32e3)hubMain.server.getBPMDesignXmlString(i,r);else{o=[];o[0]=r>0?r:1;var u="",s=[],f=0;for(e=0;e<i.length;e++)f++,u=u+i[e],f==32e3&&(f=0,s.push(u),u="");f!=0&&s.push(u);v(s,t.currentopenfile.file,"Source-Design-BPM",o)}n.receivebpmdesignxmlstring=function(){n.$evalAsync(function(){n.selectedDesignSource=!1})}}};n.navigateToFileService=h;v=function(n,t,i,r){for(var u=0;u<n.length;u++)hubMain.server.receiveDataPackets(n[u],n.length,t,u,i,r)};n.getMaxHeightAndWidthofSvg=function(n){var i={},t;for(i.Height=0,i.Width=0,t=0;t<n.length;t++)n[t].ShapeName=="BPMNShape"&&(i.Height<n[t].Top+n[t].Height&&(i.Height=n[t].Top+n[t].Height),i.Width<n[t].Left+n[t].Width&&(i.Width=n[t].Left+n[t].Width));return i};n.receiveBpmnModel=function(u){n.$apply(function(){var f,e,h,o,s,c;if(t.IsLoading=!1,n.objBPMExtraFields=undefined,n.BpmFileDetails=t.currentopenfile.file,n.BPMNModel=u,n.objData=n.BPMNModel,n.BPMNModel.Type!="BPMTemplate"&&(n.mapVariablesModel=i("filter")(n.BPMNModel.ExtensionElementsModel.Elements,{Name:"mapVariables"})[0]),n.svgElement=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#mySVG")[0],f={},f.Height=2500,f.Width=2500,n.objSvgLimits=n.getMaxHeightAndWidthofSvg(n.BPMNModel.lstShapes),n.objSvgLimits.Height&&n.objSvgLimits.Height>f.Height&&(f.Height=n.objSvgLimits.Height+100),n.objSvgLimits.Width&&n.objSvgLimits.Width>f.Width&&(f.Width=n.objSvgLimits.Width+100),n.svgElement.setAttribute("height",f.Height),n.svgElement.setAttribute("width",f.Width),$(n.svgElement).bind("contextmenu",function(n){showContextMenuForSVG(n)}),e=null,n.BPMNModel.ExtensionElementsModel&&(e=i("filter")(n.BPMNModel.ExtensionElementsModel.Elements,{Name:"extraDetails"})[0]),e||n.BPMNModel.Type=="BPMTemplate"||(e={objExtraData:null,dictAttributes:{},Elements:[{objExtraData:null,dictAttributes:{},Elements:[],Children:[],Name:"editable",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:"True"}],Children:[],Name:"extraDetails",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},n.BPMNModel.ExtensionElementsModel.Elements.push(e)),h=null,e&&(h=i("filter")(e.Elements,{Name:"editable"})[0]),n.IsMapEditable=h?h.Value&&h.Value.toLowerCase()=="true"?!0:!1:!0,n.SetUniqueIdtoGradientsInsideSVG(),n.FilterTheElementsBasedOnTypeAndLoadShapes(n.objData.lstShapes),o=n.BPMNModel.ExtraFields,o&&o.length>0)for(n.objBPMExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]},s=0;s<o.length;s++)c={Name:"ExtraField",Value:"",dictAttributes:{},Elements:[]},c.dictAttributes.ID=o[s].ID,c.dictAttributes.Value=o[s].Value,c.dictAttributes.URL=o[s].URL,n.objBPMExtraFields.Elements.push(c);else n.objBPMExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]};$.connection.hubBPMN.server.getInitialData().done(function(t){var i=t;i.length==4&&(n.docTypes=i[0],n.UserRoles=i[1],n.lstBPMNRelatedCodeValues=i[2],n.lstGlobalParameters=i[3])});hubMain.server.getCodeValues("","2035");n.ProcessTypes=[];$.connection.hubBPMN.server.getProcessTypes().done(function(t){n.ProcessTypes=t});n.mapVariablesModel&&(n.queryParametersValues=r.getMapVariableIds(n.mapVariablesModel.Elements));n.rules=n.BPMNModel.objExtraData.Rules})};n.receiveList=function(t){n.TargetSiteList=t};n.onDetailClick=function(){n.showMapDetails();ComponentsPickers.init()};n.SetUniqueIdtoGradientsInsideSVG=function(){for(var r,i=0;i<n.svgElement.childNodes.length;i++)if(n.svgElement.childNodes[i].nodeName=="defs")for(r=0;r<n.svgElement.childNodes[i].childNodes.length;r++)n.svgElement.childNodes[i].childNodes[r].nodeName!="#text"&&n.svgElement.childNodes[i].childNodes[r].nodeName!="#comment"&&n.svgElement.childNodes[i].childNodes[r].setAttribute("id",n.svgElement.childNodes[i].childNodes[r].getAttribute("id")+"_"+t.currentopenfile.file.FileName.trim())};n.FilterTheElementsBasedOnTypeAndLoadShapes=function(t){for(var r=[],u=[],i=0;i<t.length;i++)t[i].ShapeType=="participant"||t[i].ShapeType=="lane"?r.push(t[i]):u.push(t[i]);n.LoadShapes(n.svgElement,r);n.LoadShapes(n.svgElement,u)};n.LoadShapes=function(t,i){for(var r,f,e,u=0;u<i.length;u++){if(r=i[u],r.IsExecuted=!0,r.ShapeName=="BPMNShape"){f=!1;e=!1;switch(r.ShapeType){case"participant":case"lane":drawSquareParam(t,r,n);r.ShapeName!="lane"&&CheckandAddExtrasettingsModel(r);f=!0;break;case"task":case"userTask":case"serviceTask":case"businessRuleTask":case"manualTask":case"callActivity":drawTask(t,r,n);e=!0;r.ShapeName!="callActivity"&&CheckandAddExtrasettingsModel(r);break;case"endEvent":case"startEvent":case"intermediateCatchEvent":drawCircle(t,r,n);break;case"exclusiveGateway":case"inclusiveGateway":case"parallelGateway":case"eventBasedGateway":drawDiamond(t,r,n);break;case"dataStoreReference":drawdataStoreReference(t,r,n);break;case"dataObjectReference":drawdataObjectReference(t,r,n);break;case"textAnnotation":drawtextAnnotation(t,r,n);break;case"message":drawInitiatingorNonInitiatingMessage(t,r,n);break;default:drawTask(t,r,n)}}r.ShapeName=="BPMNEdge"&&AddLineArray(t,r,n)}};n.setActiveTab=function(t){n.DraggableElement=null;n.activeTab=t;n.activeTab=="EXECUTION"&&n.InitExecutionTab();n.SetallSvgelementEnable(!1);n.activeTab!=="MAP"?(n.SetallSvgelementDisable(!0),n.SVGstateWrapper(n.activeTab),removehovercirclefromsvgElement(n),removeRearrangingLinePoints(n),removeResizerAroundElement(n)):(n.SetallSvgelementDisable(!1),n.mapVariablesModel&&(n.queryParametersValues=r.getMapVariableIds(n.mapVariablesModel.Elements)))};n.InitExecutionTab=function(){n.isExecutionTabLoaded||(n.isExecutionTabLoaded=!0,n.BPMExceutionTabDetails={},n.BPMExceutionTabDetails.CaseVersion="",n.BPMExceutionTabDetails.CaseVersionID="",n.BPMExceutionTabDetails.CaseVersionList=[],n.BPMExceutionTabDetails.PersonID="",n.BPMExceutionTabDetails.OrgID="",n.BPMExceutionTabDetails.Status="",n.BPMExceutionTabDetails.FromDate="",n.BPMExceutionTabDetails.ToDate="",n.selectedCaseInstance="",n.BPMExceutionTabDetails.lstPersonId=[],n.BPMExceutionTabDetails.lstOrgID=[],n.BPMExceutionTabDetails.lstStatusValue=[],n.SelectCaseResult=function(t){n.selectedCaseInstance=t},ComponentsPickers.init(),n.RefreshCaseVesrsion=function(){n.BPMExceutionTabDetails.PersonID="";n.BPMExceutionTabDetails.OrgID="";n.BPMExceutionTabDetails.Status="";n.BPMExceutionTabDetails.FromDate="";n.BPMExceutionTabDetails.ToDate="";n.onChangeCaseVersion()},n.onChangeCaseVersion=function(){var t,i;if(n.BPMExceutionTabDetails.CaseVersionID){for(n.BPMExceutionTabDetails.lstPersonId=[],n.BPMExceutionTabDetails.lstOrgID=[],n.BPMExceutionTabDetails.lstStatusValue=[],t=0;t<n.BPMExceutionTabDetails.CaseVersionList.length;t++)if(n.BPMExceutionTabDetails.CaseVersionID==n.BPMExceutionTabDetails.CaseVersionList[t].Version){n.BPMExceutionTabDetails.CaseVersion=n.BPMExceutionTabDetails.CaseVersionList[t];break}n.BPMExceutionTabDetails.CaseVersion&&(i=n.BPMExceutionTabDetails.CaseVersion.CaseID,$.connection.hubBPMN.server.getCaseSelectionInstances(i).done(function(t){n.$evalAsync(function(){n.BPMExceutionTabDetails.lstCaseInstances=[];t?(n.selectedCaseInstance=t.length>0?t[0]:null,n.BPMExceutionTabDetails.lstCaseInstances=t,n.BPMExceutionTabDetails.lstInstances=t,n.uniqueList(t,n.BPMExceutionTabDetails.lstPersonId,"PersonId"),n.uniqueList(t,n.BPMExceutionTabDetails.lstOrgID,"OrgId"),n.uniqueList(t,n.BPMExceutionTabDetails.lstStatusValue,"statusValue")):n.selectedCaseInstance=null})}))}else n.selectedCaseInstance=null,n.BPMExceutionTabDetails.CaseVersion=null,n.BPMExceutionTabDetails.lstCaseInstances=[],n.BPMExceutionTabDetails.lstInstances=[],n.BPMExceutionTabDetails.lstPersonId=[],n.BPMExceutionTabDetails.lstOrgID=[],n.BPMExceutionTabDetails.lstStatusValue=[]},n.uniqueList=function(n,t,i){for(var r=0;r<n.length;r++)t.indexOf(n[r][i])==-1&&t.push(n[r][i])},n.onSearchCaseInstancesClick=function(){var t=n.BPMExceutionTabDetails.lstCaseInstances;t&&t.length>0&&(n.BPMExceutionTabDetails.PersonID&&(t=t.filter(function(t){return t.PersonId==n.BPMExceutionTabDetails.PersonID})),n.BPMExceutionTabDetails.OrgID&&(t=t.filter(function(t){return t.OrgId==n.BPMExceutionTabDetails.OrgID})),n.BPMExceutionTabDetails.Status&&(t=t.filter(function(t){return t.statusValue==n.BPMExceutionTabDetails.Status})),n.BPMExceutionTabDetails.FromDate&&(t=t.filter(function(t){return new Date(t.Date)>=new Date(n.BPMExceutionTabDetails.FromDate)})),n.BPMExceutionTabDetails.ToDate&&(t=t.filter(function(t){return new Date(t.Date)<=new Date(n.BPMExceutionTabDetails.ToDate)})),n.BPMExceutionTabDetails.lstInstances=t,n.selectedCaseInstance=n.BPMExceutionTabDetails.lstInstances.length>0?n.BPMExceutionTabDetails.lstInstances[0]:"")},$.connection.hubBPMN.server.loadCaseData(t.currentopenfile.file.FileName).done(function(t){n.$evalAsync(function(){t&&(n.BPMExceutionTabDetails.CaseVersionList=t)})}),n.OpenExecutedBPM=function(i){if(n.selectedCaseInstance&&n.BPMExceutionTabDetails&&n.BPMExceutionTabDetails.CaseVersion){var r=n.BPMExceutionTabDetails.CaseVersion.CaseID,u=n.BPMExceutionTabDetails.CaseVersion.Version,f=n.selectedCaseInstance.caseInstanceId;r&&u&&f&&$.connection.hubBPMN.server.getVersionAndLoadedExecutedSteps(r,u,f).done(function(r){n.$evalAsync(function(){if(r){n.BPMExceutionTabDetails.ExecutedData=r;var u=n.$new();n.BPMExceutionTabDetails.Mode=i;n.BPMExceutionTabDetails.isChildWindow=!1;u.BPMExceutionTabDetails=n.BPMExceutionTabDetails;u.templateName="BPM/views/Execution/BPMExecutionDialog.html";u.dialogOptions={height:700,width:1300,showclose:!0};u.dialog=t.showDialog(u,"Execution Result",u.templateName,u.dialogOptions);u.close=function(){n.$evalAsync(function(){u.dialog.close()})}}})})}})};n.SVGstateWrapper=function(i){switch(i.toLowerCase()){case"association":n.SetSvgelementEnable();break;case"performers":var r=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#mySVG [elementtype= lane]"),u=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#mySVG [elementtype= userTask]");o.TogglecssClass(r,"customDisableElement","customEnableElement");o.TogglecssClass(u,"customDisableElement","customEnableElement")}};n.SetallSvgelementDisable=function(n){var i=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#mySVG").children();n?o.addEachcssClass(i,"customDisableElement"):o.removeEachcssClass(i,"customDisableElement")};n.SetallSvgelementEnable=function(n){var i=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#mySVG").children();n?o.addEachcssClass(i,"customEnableElement"):o.removeEachcssClass(i,"customEnableElement")};n.SetSvgelementEnable=function(){var i="",r;switch(n.associationActiveTab){case"CALLACTIVITY":i="callActivity";break;case"GATEWAYEXPRESSION":i="GatewayExpression ";break;case"SERVICETASK":i="serviceTask";break;case"RULE":i="businessRuleTask";break;case"FORM":i="userTask"}i!=""&&(r=$("div[id='"+t.currentopenfile.file.FileName+"']").find("#mySVG [elementtype= "+i+"]"),o.TogglecssClass(r,"customDisableElement","customEnableElement"))};n.onChangeofText=function(){n.selectedShape&&(n.selectedShape.ShapeModel.dictAttributes.name!=undefined&&n.selectedShape.ShapeName!="BPMNEdge"&&n.selectedShape.ShapeModel.Name!="textAnnotation"?(n.selectedShape.Text=n.selectedShape.ShapeModel.dictAttributes.name,removeExistingTextNodeAndAddNewNode(n)):n.selectedShape.ShapeModel.Name=="textAnnotation"?n.selectedShape.ShapeModel.Elements[0].Value!=n.selectedShape.Text&&(n.selectedShape.Text=n.selectedShape.ShapeModel.Elements[0].Value,removeExistingTextNodeAndAddNewNode(n)):n.selectedShape.ShapeModel.dictAttributes.name!=undefined&&n.selectedShape.ShapeName=="BPMNEdge"&&(n.selectedShape.Text=n.selectedShape.ShapeModel.dictAttributes.name,RemoveExistingTextAndAddNewNodeForFlowLines(n)))};n.setAssociationTab=function(t){n.associationActiveTab=t;n.SetallSvgelementEnable(!1);n.SetallSvgelementDisable(!0);n.SetSvgelementEnable()};n.selectVariable=function(t){n.selectedVariable=t;n.setAllVariableReadOnlyExceptThis(t)};n.addVariable=function(){t.UndRedoBulkOp("Start");var i=new y;t.PushItem(i,n.mapVariablesModel.Elements);t.EditPropertyValue(n.selectedVariable,n,"selectedVariable",i);n.setVariableEditable(i);t.UndRedoBulkOp("End")};n.deleteVariable=function(){if(n.selectedVariable&&n.mandatoryElementIds.indexOf(n.selectedVariable.dictAttributes.id)==-1){var i=n.mapVariablesModel.Elements.indexOf(n.selectedVariable);i>-1&&(t.UndRedoBulkOp("Start"),t.DeleteItem(n.selectedVariable,n.mapVariablesModel.Elements,null),i<n.mapVariablesModel.length-1&&i--,t.EditPropertyValue(n.selectedVariable,n,"selectedVariable",n.mapVariablesModel.Elements[i]),t.UndRedoBulkOp("End"))}};n.canDeleteVariable=function(){return n.selectedVariable&&n.mandatoryElementIds.indexOf(n.selectedVariable.dictAttributes.id)==-1};n.changeMapType=function(n){n.dictAttributes.dataType=="Object"?(t.UndRedoBulkOp("Start"),t.EditPropertyValue(n.dictAttributes.sfwDefaultValueType,n.dictAttributes,"sfwDefaultValueType",""),t.EditPropertyValue(n.dictAttributes.sfwDefaultValue,n.dictAttributes,"sfwDefaultValue",""),t.EditPropertyValue(n.dictAttributes.sfwQueryID,n.dictAttributes,"sfwQueryID",""),t.EditPropertyValue(n.dictAttributes.sfwQueryParameters,n.dictAttributes,"sfwQueryParameters",""),t.EditPropertyValue(n.dictAttributes.sfwCodeID,n.dictAttributes,"sfwCodeID",""),t.UndRedoBulkOp("End")):t.EditPropertyValue(n.dictAttributes.sfwEntity,n.dictAttributes,"sfwEntity","")};n.changeMapdvType=function(n){n.dictAttributes.sfwDefaultValueType=="Query"?(t.UndRedoBulkOp("Start"),t.EditPropertyValue(n.dictAttributes.sfwDefaultValue,n.dictAttributes,"sfwDefaultValue",""),t.EditPropertyValue(n.dictAttributes.sfwCodeID,n.dictAttributes,"sfwCodeID",""),t.UndRedoBulkOp("End")):n.dictAttributes.sfwDefaultValueType==="CodeGroup"?(t.UndRedoBulkOp("Start"),t.EditPropertyValue(n.dictAttributes.sfwDefaultValue,n.dictAttributes,"sfwDefaultValue",""),t.EditPropertyValue(n.dictAttributes.sfwQueryID,n.dictAttributes,"sfwQueryID",""),t.EditPropertyValue(n.dictAttributes.sfwQueryParameters,n.dictAttributes,"sfwQueryParameters",""),t.UndRedoBulkOp("End")):(t.UndRedoBulkOp("Start"),n.dictAttributes.sfwDefaultValueType||t.EditPropertyValue(n.dictAttributes.sfwDefaultValue,n.dictAttributes,"sfwDefaultValue",""),t.EditPropertyValue(n.dictAttributes.sfwQueryID,n.dictAttributes,"sfwQueryID",""),t.EditPropertyValue(n.dictAttributes.sfwQueryParameters,n.dictAttributes,"sfwQueryParameters",""),t.EditPropertyValue(n.dictAttributes.sfwCodeID,n.dictAttributes,"sfwCodeID",""),t.UndRedoBulkOp("End"))};n.setVariableEditable=function(t){n.mandatoryElementIds.indexOf(t.dictAttributes.id)==-1?(t.isEditable=!0,t.isMandatory=!0):(t.isEditable=!0,t.isMandatory=!1)};n.setVariableReadOnly=function(n){n.isEditable=!1;n.isMandatory=!0};n.checkAndSetVariableReadOnly=function(t,i){t.keyCode==$.ui.keyCode.ESCAPE&&n.setVariableReadOnly(i)};n.validateVariable=function(t){var i=!1;return angular.forEach(n.mapVariablesModel.Elements,function(n){n.dictAttributes.id&&t.dictAttributes.id&&n.dictAttributes.id.toLowerCase()==t.dictAttributes.id.toLowerCase()&&n!=t&&(i=!0)}),i?(alert("Duplicate Id present.Please change the id"),t.dictAttributes.id="",!1):void 0};n.setAllVariableReadOnlyExceptThis=function(t){angular.forEach(n.mapVariablesModel.Elements.filter(function(n){return n!=t}),function(t){n.setVariableReadOnly(t)})};n.getDivergingGateWays=function(){for(var r,i=[],t=0;t<n.objData.lstShapes.length;t++)n.objData.lstShapes[t].ShapeName=="BPMNShape"&&n.objData.lstShapes[t].ShapeType=="inclusiveGateway"&&(n.objData.lstShapes[t].ShapeModel.dictAttributes.gatewayDirection=="Diverging"||n.objData.lstShapes[t].ShapeModel.dictAttributes.gatewayDirection=="Mixed")&&(r={Name:n.objData.lstShapes[t].ShapeModel.dictAttributes.name,ID:n.objData.lstShapes[t].ShapeModel.dictAttributes.id},i.push(r));return i};n.EditSVGheightandwidth=function(){var i=n.$new();i.svgHeight=n.svgElement.getAttribute("height");i.svgWidth=n.svgElement.getAttribute("width");i.templateName="BPM/views/EditSvgTemplate.html";i.dialogOptions={height:200,width:350};i.onOKClick=function(){n.svgElement.setAttribute("height",i.svgHeight);n.svgElement.setAttribute("width",i.svgWidth);i.dialog.close()};i.onCancelClick=function(){i.dialog.close()};i.dialog=t.showDialog(i,"Edit SVG Bounds",i.templateName,i.dialogOptions)};n.showDetails=function(){var t,r;n.selectedShape&&(t=i("filter")(n.selectedShape.ShapeModel.Elements,{Name:"extensionElements"}),t&&t.length>0&&(r=i("filter")(t[0].Elements,{Name:"isSynchronous"}),r&&r.length>0&&(n.selectedShape.ShapeModel.isSynchronousModel=r[0])))};n.deployMap=function(i){if(i){var r=n.$new();r.templateName="BPM/views/ReDeployDialog.html";r.dialogOptions={height:245,width:600};r.onOKClick=function(){t.IsLoading=!0;$.connection.hubBPMN.server.deployMap(t.currentopenfile.file.FilePath,r.selectedCaseID).done(function(i){n.$evalAsync(function(){t.IsLoading=!1});n.showValidationResult(i,r.selectedCaseID);i&&i.length||n.ActiveTabForBPM=="Versions"&&n.loadVersions()});r.closeDialog()};r.closeDialog=function(){r.dialog&&r.dialog.close()};$.connection.hubBPMN.server.loadCaseData(t.currentopenfile.file.FileName).done(function(t){n.$evalAsync(function(){r.versionList=t})});r.dialog=t.showDialog(r,"Re-Deploy - Select Case ID",r.templateName,r.dialogOptions)}else t.IsLoading=!0,$.connection.hubBPMN.server.deployMap(t.currentopenfile.file.FilePath,0).done(function(i){n.$evalAsync(function(){t.IsLoading=!1});n.showValidationResult(i);i&&i.length||(n.ActiveTabForBPM=="Versions"&&n.loadVersions(),n.BPMExceutionTabDetails&&n.BPMExceutionTabDetails.CaseVersionList&&$.connection.hubBPMN.server.loadCaseData(t.currentopenfile.file.FileName).done(function(t){n.$evalAsync(function(){n.BPMExceutionTabDetails.CaseVersionList=t})}))})};n.showValidationResult=function(i,r){if(i&&i.length){var u=n.$new();u.errorList=i;u.templateName="BPM/views/BPMValidationErrors.html";u.dialogOptions={height:245,width:600,showclose:!0};u.onOKClick=function(){u.closeDialog()};u.closeDialog=function(){u.dialog&&u.dialog.close()};u.dialog=t.showDialog(u,"Validation Errors",u.templateName,u.dialogOptions)}else r?toastr.success(string.format("Map for Case ID '{0}' re-deployed successfully.",r)):toastr.success("Map deployed successfully.")};n.loadVersions=function(){n.$evalAsync(function(){t.IsLoading=!0});l.hubBPMN.server.loadCaseData(t.currentopenfile.file.FileName).done(function(i){n.$evalAsync(function(){t.IsLoading=!1;n.versionList=i})}).fail(function(){n.$evalAsync(function(){t.IsLoading=!1})})};n.showMapDetails=function(){var r=n.$new();r.bpmnModel={};r.objExtraFields=[];r.objDirFunctions={};r.showExtraFieldsTab=!1;r.formName="BPM";r.Init=function(){var t,f,e,u;if(r.BPMNModel=n.BPMNModel,r.bpmnModel.Title=n.BPMNModel.Title,r.bpmnModel.ResourceID=n.BPMNModel.ResourceID,r.bpmnModel.Type=n.BPMNModel.Type,r.bpmnModel.IsReusable=n.BPMNModel.IsReusable,$.connection.hubBPMN.server.isBPMReused(n.currentfile.FileName).done(function(n){r.bpmnModel.isReused=n}),n.BPMNModel.ExtensionElementsModel)for(r.bpmnModel.ExtensionElementsModel={Elements:[]},t=0;t<n.BPMNModel.ExtensionElementsModel.Elements.length;t++)f={},angular.copy(n.BPMNModel.ExtensionElementsModel.Elements[t],f),r.bpmnModel.ExtensionElementsModel.Elements.push(f);r.bpmnModel.ExtensionElementsModel&&(r.effectiveDateModel=i("filter")(r.bpmnModel.ExtensionElementsModel.Elements,{Name:"effectiveDate"})[0]);!r.effectiveDateModel&&r.bpmnModel.ExtensionElementsModel&&(e={objExtraData:null,dictAttributes:{},Elements:[],Children:[],Name:"effectiveDate",prefix:"sbpmn",IsValueInCDATAFormat:!1,Value:""},r.bpmnModel.ExtensionElementsModel.Elements.push(e),r.effectiveDateModel=e);u=null;r.bpmnModel.ExtensionElementsModel&&(u=i("filter")(r.bpmnModel.ExtensionElementsModel.Elements,{Name:"extraDetails"})[0]);u&&(r.editableModel=i("filter")(u.Elements,{Name:"editable"})[0])};r.onChangeEditableModel=function(){r.editableModel&&r.editableModel.Value.toLowerCase()!="true"?(t.EditPropertyValue(n.IsMapEditable,n,"IsMapEditable",!1),removeRearrangingLinePoints(n),removeResizerAroundElement(n),removehovercirclefromsvgElement(n)):t.EditPropertyValue(n.IsMapEditable,n,"IsMapEditable",!0)};r.onOKClick=function(){var u,f,e,o;t.UndRedoBulkOp("Start");r.onChangeEditableModel();r.objDirFunctions.prepareExtraFieldData&&r.objDirFunctions.prepareExtraFieldData();t.EditPropertyValue(n.BPMNModel.Title,n.BPMNModel,"Title",r.bpmnModel.Title);t.EditPropertyValue(n.BPMNModel.ResourceID,n.BPMNModel,"ResourceID",r.bpmnModel.ResourceID);t.EditPropertyValue(n.BPMNModel.IsReusable,n.BPMNModel,"IsReusable",r.bpmnModel.IsReusable);n.BPMNModel.ExtensionElementsModel&&(u=i("filter")(n.BPMNModel.ExtensionElementsModel.Elements,{Name:"effectiveDate"})[0],f=i("filter")(r.bpmnModel.ExtensionElementsModel.Elements,{Name:"effectiveDate"})[0],u?t.EditPropertyValue(u.Value,u,"Value",f.Value):t.PushItem(f,n.BPMNModel.ExtensionElementsModel.Elements),e=i("filter")(n.BPMNModel.ExtensionElementsModel.Elements,{Name:"extraDetails"})[0],e&&(o=i("filter")(e.Elements,{Name:"editable"})[0],o.Value=r.editableModel.Value));r.$broadcast("UpdateBpmTerminate",null);t.UndRedoBulkOp("End");r.closeDialog()};r.closeDialog=function(){r.dialog&&r.dialog.close()};r.validateBPMDetails=function(){r.FormDetailsErrorMessage="";r.objDirFunctions.getExtraFieldData&&(r.objExtraFields=r.objDirFunctions.getExtraFieldData());return validateExtraFields(r)};r.dialog=t.showDialog(r,"Details","BPM/views/BpmDetailsTemplate.html",{width:700,height:350});r.Init()};a=function(){var i=n.$new();return i.DialogConstants={queryIdParamName:"sfwQueryID",queryParamsName:"sfwQueryParameters"},{setnewScope:function(){i=n.$new();i.DialogConstants={queryIdParamName:"sfwQueryID",queryParamsName:"sfwQueryParameters"}},loadDialog:function(r,u){i.DialogConstants=u?u:i.DialogConstants;i.strSelectedQuery=r.dictAttributes[i.DialogConstants.queryIdParamName];i.mapObj=r;i.IsBPM=!0;i.queryValues=n.queryParameterallowedValues;i.QueryDialog=t.showDialog(i,"Browse Queries","Form/views/BrowseForQuery.html",{width:1e3,height:700})},afterDialog:function(n,r){if(angular.isDefined(i.mapObj&&i.mapObj.dictAttributes))if(t.EditPropertyValue(i.mapObj.dictAttributes[i.DialogConstants.queryIdParamName],i.mapObj.dictAttributes,i.DialogConstants.queryIdParamName,n.Id),r){var u=[],f=[];function e(n){f.push(n);this.push(n.ID+"="+(n.Value?n.Value:""))}angular.forEach(n.Parameters,e,u);t.EditPropertyValue(i.mapObj.dictAttributes[i.DialogConstants.queryParamsName],i.mapObj.dictAttributes,i.DialogConstants.queryParamsName,u.join(";")+";")}else i.$destroy()},setQueryParam:function(u){angular.isDefined(u)&&(i.mapObj={},i.queryParameters=r.getQueryparamfromString(u,"sfwQueryParameters",";"),i.queryValues=n.queryParameterallowedValues,i.QueryDialog=t.showDialog(i,"Set Query Parameters","Common/views/SetQueryParameters.html",{width:500,height:500}),i.setQueryParameters=function(){function r(n){this.push(n.ID+"="+(n.Value?n.Value:""))}var n=[];angular.forEach(i.queryParameters,r,n);i.mapObj.dictAttributes?t.EditPropertyValue(i.mapObj.dictAttributes[i.DialogConstants.queryParamsName],i.mapObj.dictAttributes,i.DialogConstants.queryParamsName,n.join(";")+";"):t.EditPropertyValue(u.sfwQueryParameters,u,"sfwQueryParameters",n.join(";")+";");i.QueryDialog.close()})}}}();n.getQuery_dialog=function(n){a.setnewScope();a.loadDialog(n,null)};n.getQueryParam_dialog=function(n){a.setnewScope();a.setQueryParam(n)};n.SetCalledElementParameters=function(i,r){if(i&&r){function u(i){n.$evalAsync(function(){function c(n){return n.Name=="parameters"}var h=i,o=r.Elements.filter(c)[0],s,f,u,e;if(t.UndRedoBulkOp("Start"),o||(s=new objElements,s.prefix="",s.Name="parameters",o=s,t.PushItem(s,r.Elements)),f=o.Elements,t.EditPropertyValue(o.Elements,o,"Elements",[]),Object.prototype.toString.call(h)==="[object Array]"){function l(n){if(n&&n.dictAttributes&&n.dictAttributes.id){var i={prefix:"",Name:"parameter",dictAttributes:{sfwParamaterName:n.dictAttributes.id,sfwDataType:n.dictAttributes.dataType,sfwEntity:n.dictAttributes.sfwEntity,sfwDirection:n.dictAttributes.type,sfwValueSource:"Parameter"},Elements:[],Children:[]};t.PushItem(i,o.Elements)}}angular.forEach(h,l)}for(u=0;u<f.length;u++)f[u]&&f[u].dictAttributes&&f[u].dictAttributes.sfwParamaterName&&(e=o.Elements.filter(function(n){return n.dictAttributes.sfwParamaterName==f[u].dictAttributes.sfwParamaterName}),e&&e.length>0&&(e[0].dictAttributes.sfwDirection.toLowerCase()=="in"?t.EditPropertyValue(e[0].dictAttributes.sfwValueSource,e[0].dictAttributes,"sfwValueSource",f[u].dictAttributes.sfwValueSource):t.EditPropertyValue(e[0].dictAttributes.sfwValueSource,e[0].dictAttributes,"sfwValueSource","Parameter"),e[0].dictAttributes.sfwDataType=="Object"&&e[0].dictAttributes.sfwValueSource=="Constant"?(f[u].dictAttributes.sfwDataType=="Object"&&e[0].dictAttributes.sfwEntity==f[u].dictAttributes.sfwEntity&&f[u].Elements&&f[u].Elements.length>0&&f[u].Elements[0].Name=="value"&&t.PushItem(f[u].Elements[0],e[0].Elements),n.checkAndUpdateParamChildModels(e[0],!0)):e[0].dictAttributes.sfwParameterValue=f[u].dictAttributes.sfwParameterValue));t.UndRedoBulkOp("End")})}$.connection.hubBPMN.server.getReusableBpmnParamterlist(i).done(u)}};n.setParamEntityValue=function(u,f){var o,h;f&&f.valueModel?(o=u.$new(),o.objSetParam={},o.validEntities=f.dictAttributes.sfwEntity&&f.dictAttributes.sfwEntity!="entBase"?s.getDescendentEntitiesIncludingThis(f.dictAttributes.sfwEntity):s.getEntityIntellisense(),o.businessObjectModel=f.valueModel.businessObjectModel,o.getSrvObjects=function(t){$.connection.hubForm.server.getRemoteObjectList().done(function(i){n.$evalAsync(function(){o.businessObjectModel.initializeModel.srvObjects=i;o.businessObjectModel.initializeModel.srvMethodModel&&o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.srvName&&o.populateSrvMethods();t&&t()})})},o.onObjectTypeChanged=function(){var n;t.UndRedoBulkOp("Start");o.businessObjectModel.initializeModel.dictAttributes.ObjectType&&o.businessObjectModel.initializeModel.dictAttributes.ObjectType==="SrvMethod"?(o.businessObjectModel.initializeModel.xmlMethodModel&&(n=o.businessObjectModel.initializeModel.Elements.indexOf(o.businessObjectModel.initializeModel.xmlMethodModel),n>-1&&(t.DeleteItem(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel.Elements),t.EditPropertyValue(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel,"xmlMethodModel",null))),t.EditPropertyValue(o.businessObjectModel.initializeModel.srvMethodModel,o.businessObjectModel.initializeModel,"srvMethodModel",{Name:"SrvMethod",dictAttributes:{},Elements:[]}),t.PushItem(o.businessObjectModel.initializeModel.srvMethodModel,o.businessObjectModel.initializeModel.Elements)):(o.businessObjectModel.initializeModel.srvMethodModel&&(n=o.businessObjectModel.initializeModel.Elements.indexOf(o.businessObjectModel.initializeModel.srvMethodModel),n>-1&&(t.DeleteItem(o.businessObjectModel.initializeModel.srvMethodModel,o.businessObjectModel.initializeModel.Elements),t.EditPropertyValue(o.businessObjectModel.initializeModel.srvMethodModel,o.businessObjectModel.initializeModel,"srvMethodModel",null))),t.EditPropertyValue(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel,"xmlMethodModel",{Name:"XMLMethod",dictAttributes:{},Elements:[]}),t.PushItem(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel.Elements));t.EditPropertyValue(o.businessObjectModel.dictAttributes.sfwNavigationParameter,o.businessObjectModel.dictAttributes,"sfwNavigationParameter","");t.UndRedoBulkOp("End")},o.populateSrvMethods=function(){var n,i,t;if(o.businessObjectModel.initializeModel.srvMethods=[],o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.srvName)for(n=0,t=o.businessObjectModel.initializeModel.srvObjects.length;n<t;n++)if(o.businessObjectModel.initializeModel.srvObjects[n].dictAttributes.ID===o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.srvName){for(i=0,t=o.businessObjectModel.initializeModel.srvObjects[n].Elements.length;i<t;i++)o.businessObjectModel.initializeModel.srvMethods.push(o.businessObjectModel.initializeModel.srvObjects[n].Elements[i]);break}},o.onSrvObjectChanged=function(){var n,r,i;if(t.UndRedoBulkOp("Start"),o.businessObjectModel.initializeModel.srvMethods)for(n=0,i=o.businessObjectModel.initializeModel.srvMethods.length;n<i;n++)t.DeleteItem(o.businessObjectModel.initializeModel.srvMethods[n],o.businessObjectModel.initializeModel.srvMethods);else o.businessObjectModel.initializeModel.srvMethods=[];if(o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.srvName)for(n=0,i=o.businessObjectModel.initializeModel.srvObjects.length;n<i;n++)if(o.businessObjectModel.initializeModel.srvObjects[n].dictAttributes.ID===o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.srvName){for(r=0,i=o.businessObjectModel.initializeModel.srvObjects[n].Elements.length;r<i;r++)t.PushItem(o.businessObjectModel.initializeModel.srvObjects[n].Elements[r],o.businessObjectModel.initializeModel.srvMethods);break}o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.ID="";t.UndRedoBulkOp("End")},o.onSrvMethodChanged=function(){var n,r;if(o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.ID&&(n=i("filter")(o.businessObjectModel.initializeModel.srvMethods,{dictAttributes:{ID:o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.ID}},!0)[0],n)){o.businessObjectModel.initializeModel.xmlmethodItems=n.Elements;r=[];function u(n){this.push(n.dictAttributes.ID+"=")}angular.forEach(n.Elements,u,r);t.EditPropertyValue(o.businessObjectModel.dictAttributes.sfwNavigationParameter,o.businessObjectModel.dictAttributes,"sfwNavigationParameter",r.join(";"))}},o.getSrvObjects(),o.loadXmlmethods=function(){o.xmlMethods=e.get(o.businessObjectModel.dictAttributes.sfwEntity,"load","")},o.onXmlMethodChange=function(){o.objSetParam.selectedXmlMethodID&&o.objSetParam.selectedXmlMethodID.trim().length>0?o.addUpdatedXmlMethod():o.removeXmlMethod()},o.addUpdatedXmlMethod=function(){var n,r;if(t.UndRedoBulkOp("Start"),o.businessObjectModel.initializeModel.xmlMethodModel||i("filter")(o.businessObjectModel.initializeModel.Elements,{Name:"XMLMethod"},!0).length!=0||(t.EditPropertyValue(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel,"xmlMethodModel",{prefix:"",Name:"XMLMethod",Value:"",dictAttributes:{},Elements:[],Children:[]}),t.PushItem(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel.Elements)),t.EditPropertyValue(o.businessObjectModel.initializeModel.xmlMethodModel.dictAttributes.ID,o.businessObjectModel.initializeModel.xmlMethodModel.dictAttributes,"ID",o.objSetParam.selectedXmlMethodID),n=i("filter")(o.xmlMethods,{ID:o.businessObjectModel.initializeModel.xmlMethodModel.dictAttributes.ID},!0),n&&n.length>0){o.xmlMethodParameters=n[0].Items;r=[];function u(n){this.push(n.ID+"="+(n.Value?n.Value:""))}angular.forEach(n[0].Parameters,u,r);t.EditPropertyValue(o.businessObjectModel.dictAttributes.sfwNavigationParameter,o.businessObjectModel.dictAttributes,"sfwNavigationParameter",r.join(";"))}t.UndRedoBulkOp("End")},o.removeXmlMethod=function(){o.businessObjectModel.initializeModel.xmlMethodModel&&i("filter")(o.businessObjectModel.initializeModel.Elements,{Name:"XMLMethod"},!0).length>0&&(t.UndRedoBulkOp("Start"),t.DeleteItem(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel.Elements),t.EditPropertyValue(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel,"xmlMethodModel",undefined),t.EditPropertyValue(o.xmlMethodParameters,o,"xmlMethodParameters",[]),t.EditPropertyValue(o.businessObjectModel.dictAttributes.sfwNavigationParameter,o.businessObjectModel.dictAttributes,"sfwNavigationParameter",undefined),t.UndRedoBulkOp("End"))},o.setXmlMethodParameters=function(){var u=o.$new();u.DialogConstants={queryParamsName:"parameterValue"};u.mapObj={};u.queryValues=r.getMapVariableIds(n.mapVariablesModel.Elements);u.queryParameters=r.getQueryparamfromString(o.businessObjectModel.dictAttributes,"sfwNavigationParameter",";");u.onRefreshParams=function(){var t,n,r;o.businessObjectModel.initializeModel&&o.businessObjectModel.initializeModel.dictAttributes.ObjectType==="SrvMethod"?o.getSrvObjects(u.refreshSrvParameters):(t=e.get(o.businessObjectModel.dictAttributes.sfwEntity.trim()),t.length>0&&(n=i("filter")(t,{ID:o.businessObjectModel.initializeModel.xmlMethodModel.dictAttributes.ID},!0),n&&n.length>0&&(r=n[0],u.refreshParams(r.Parameters))))};u.refreshSrvParameters=function(){if(o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.ID){var n=i("filter")(o.businessObjectModel.initializeModel.srvMethods,{dictAttributes:{ID:o.businessObjectModel.initializeModel.srvMethodModel.dictAttributes.ID}},!0);n&&n.length&&u.refreshParams(n[0].Elements)}};u.refreshParams=function(n){function e(n){var i=new objElements,r;i.Name="parameter";r="";r=n.dictAttributes?n.dictAttributes.ID:n.ID;i.ID=r;u.queryParameters.length>0&&!u.queryParameters.some(function(n){return n.dictAttributes.ID==r})&&t.PushItem(i,u.queryParameters);u.queryParameters.length==0&&t.PushItem(i,u.queryParameters)}var r=u.queryParameters,i,f;for(u.queryParameters=[],angular.forEach(n,e,u.queryParameters),i=0;i<r.length;i++)r[i]&&r[i].ID&&(f=u.queryParameters.filter(function(n){return n.ID==r[i].ID}),f&&f.length>0&&r[i].Value&&t.EditPropertyValue(f[0].Value,f[0],"Value",r[i].Value))};u.QueryDialog=t.showDialog(u,"Set Method Parameters","Common/views/SetQueryParameters.html",{width:500,height:500});u.setQueryParameters=function(){function i(n){this.push(n.ID+"="+(n.Value?n.Value:""))}var n=[];angular.forEach(u.queryParameters,i,n);t.EditPropertyValue(o.businessObjectModel.dictAttributes.sfwNavigationParameter,o.businessObjectModel.dictAttributes,"sfwNavigationParameter",n.join(";"));u.QueryDialog.close()}},o.onEntityChanged=function(){o.loadXmlmethods();o.businessObjectModel.initializeModel.xmlMethodModel&&(t.UndRedoBulkOp("Start"),t.DeleteItem(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel.Elements),t.EditPropertyValue(o.businessObjectModel.initializeModel.xmlMethodModel,o.businessObjectModel.initializeModel,"xmlMethodModel",undefined),t.EditPropertyValue(o.objSetParam.selectedXmlMethodID,o.objSetParam,"selectedXmlMethodID",undefined),t.EditPropertyValue(o.xmlMethodParameters,o,"xmlMethodParameters",[]),t.EditPropertyValue(o.businessObjectModel.dictAttributes.sfwNavigationParameter,o.businessObjectModel.dictAttributes,"sfwNavigationParameter",undefined),t.UndRedoBulkOp("End"))},o.businessObjectModel&&o.businessObjectModel.dictAttributes&&o.businessObjectModel.dictAttributes.sfwEntity&&o.loadXmlmethods(),o.businessObjectModel.initializeModel&&(items=o.businessObjectModel.initializeModel.Elements.filter(function(n){return n.Name=="XMLMethod"}),items&&items.length>0?(o.businessObjectModel.initializeModel.xmlMethodModel=items[0],o.objSetParam.selectedXmlMethodID=o.businessObjectModel.initializeModel.xmlMethodModel.dictAttributes.ID,h=i("filter")(o.xmlMethods,{ID:o.businessObjectModel.initializeModel.xmlMethodModel.dictAttributes.ID},!0),h&&h.length>0&&(o.xmlMethodParameters=h[0].Items)):(items=o.businessObjectModel.initializeModel.Elements.filter(function(n){return n.Name=="SrvMethod"}),items&&items.length>0&&(o.businessObjectModel.initializeModel.srvMethodModel=items[0]))),o.onOKClick=function(){o.businessObjectModel.initializeModel.xmlMethodModel&&t.EditPropertyValue(o.businessObjectModel.initializeModel.xmlMethodModel.dictAttributes.ID,o.businessObjectModel.initializeModel.xmlMethodModel.dictAttributes,"ID",o.objSetParam.selectedXmlMethodID);o.dialog.close()},o.closeDialog=function(){o.dialog&&o.dialog.close&&o.dialog.close()},o.dialog=t.showDialog(o,"Set Xml Method","BPM/views/SetXmlMethod.html",{width:500,height:500})):alert("Invalid Data Type")};n.checkAndUpdateParamChildModels=function(n,i){var r=n.Elements.filter(function(n){return n.Name=="value"});r&&r.length>0?i?t.EditPropertyValue(n.valueModel,n,"valueModel",r[0]):n.valueModel=r[0]:i?(t.EditPropertyValue(n.valueModel,n,"valueModel",{prefix:"",Name:"value",Value:"",dictAttributes:{},Elements:[],Children:[]}),t.PushItem(n.valueModel,n.Elements)):(n.valueModel={prefix:"",Name:"value",Value:"",dictAttributes:{},Elements:[],Children:[]},n.Elements.push(n.valueModel));r=n.valueModel.Elements.filter(function(n){return n.Name=="BusinessObject"});r&&r.length>0?i?t.EditPropertyValue(n.valueModel.businessObjectModel,n.valueModel,"businessObjectModel",r[0]):n.valueModel.businessObjectModel=r[0]:i?(t.EditPropertyValue(n.valueModel.businessObjectModel,n.valueModel,"businessObjectModel",{prefix:"",Name:"BusinessObject",Value:"",dictAttributes:{},Elements:[],Children:[]}),t.PushItem(n.valueModel.businessObjectModel,n.valueModel.Elements)):(n.valueModel.businessObjectModel={prefix:"",Name:"BusinessObject",Value:"",dictAttributes:{},Elements:[],Children:[]},n.valueModel.Elements.push(n.valueModel.businessObjectModel));r=n.valueModel.businessObjectModel.Elements.filter(function(n){return n.Name=="initialize"});r&&r.length>0?i?t.EditPropertyValue(n.valueModel.businessObjectModel.initializeModel,n.valueModel.businessObjectModel,"initializeModel",r[0]):n.valueModel.businessObjectModel.initializeModel=r[0]:i?(t.EditPropertyValue(n.valueModel.businessObjectModel.initializeModel,n.valueModel.businessObjectModel,"initializeModel",{prefix:"",Name:"initialize",Value:"",dictAttributes:{ObjectType:"XmlMethod"},Elements:[],Children:[]}),t.PushItem(n.valueModel.businessObjectModel.initializeModel,n.valueModel.businessObjectModel.Elements)):(n.valueModel.businessObjectModel.initializeModel={prefix:"",Name:"initialize",Value:"",dictAttributes:{ObjectType:"XmlMethod"},Elements:[],Children:[]},n.valueModel.businessObjectModel.Elements.push(n.valueModel.businessObjectModel.initializeModel))};n.onValueSourceChanged=function(i){t.UndRedoBulkOp("Start");t.EditPropertyValue(i.dictAttributes.sfwParameterValue,i.dictAttributes,"sfwParameterValue","");i.dictAttributes.sfwDataType=="Object"&&(i.dictAttributes.sfwValueSource=="Constant"?n.checkAndUpdateParamChildModels(i,!0):i.valueModel&&(t.DeleteItem(i.valueModel,i.Elements,null),t.EditPropertyValue(i.valueModel,i,"valueModel",undefined)));t.UndRedoBulkOp("End")};n.setDraggableElement=function(t){onBodyClick();n.DraggableElement=t!="Pointer"?t:null;n.svgElement.setAttribute("onmouseup","AddNewElementToBPM(evt)");angular.element(n.svgElement.parentNode).attr("ondrop","AddNewElementToBPM(event)");angular.element(n.svgElement.parentNode).attr("ondragover","onElementDragOver(event)")};n.onChangeOfTitle=function(i){n.BPMNModel.HeaderID=i?i:t.currentopenfile.file.FileName};n.onDeleteKeyDown=function(t,i){var h,f,r,u,e,l,a;if((t.keyCode==46||i=="Delete")&&n.activeTab=="MAP"){if(n.selectedElemForResize!=null)if(n.isDirty=!0,n.objData.lstShapes[n.indexofResizerElement].ShapeType!="participant"&&n.objData.lstShapes[n.indexofResizerElement].ShapeType!="lane"){if(h=n.objData.lstShapes[n.indexofResizerElement].Id,n.objData.lstShapes[n.indexofResizerElement].ShapeType=="message")for(r=0;r<n.objData.lstShapes.length;r++)n.objData.lstShapes[r].ShapeType=="messageFlow"&&n.objData.lstShapes[n.indexofResizerElement].Id==n.objData.lstShapes[r].ShapeModel.dictAttributes.messageRef&&(n.objData.lstShapes[r].MessageVisibleKind="",n.objData.lstShapes[r].MessageReference="",n.objData.lstShapes[r].ShapeModel.dictAttributes.messageRef="");n.objData.lstShapes.splice(n.indexofResizerElement,1);n.DeleteFlowNodesBasedOnID(h);n.DeleteRefNodeFromLaneModel(h);n.selectedElemForResize=null;RedrawingElementsAndEdges(n)}else if(n.objData.lstShapes[n.indexofResizerElement].ShapeType=="participant")confirm("Do you want to remove Selected pool ?")&&n.DeletePoolanditsElements();else if(n.objData.lstShapes[n.indexofResizerElement].ShapeType=="lane"){var c=n.objData.lstShapes[n.indexofResizerElement].processRef,h=n.objData.lstShapes[n.indexofResizerElement].Id,o=n.getLaneCountinPool(c);if(o.LaneCount>1){if(confirm("Do you want to remove Selected Lane ?")){var p=n.objData.lstShapes[n.indexofResizerElement].Left,v=n.objData.lstShapes[n.indexofResizerElement].Top,w=n.objData.lstShapes[n.indexofResizerElement].Width,s=n.objData.lstShapes[n.indexofResizerElement].Height,y=n.objData.lstShapes[o.PoolIndex].Top;for(n.objData.lstShapes[o.PoolIndex].Height=n.objData.lstShapes[o.PoolIndex].Height-s,f=n.objData.lstShapes[n.indexofResizerElement],u=0;u<f.ShapeModel.Elements.length;u++)f.ShapeModel.Elements[u].Name=="flowNodeRef"&&f.ShapeModel.Elements[u].Value&&f.ShapeModel.Elements[u].Value!=""&&(n.DeleteFlowNodesBasedOnID(f.ShapeModel.Elements[u].Value),GetElementProcessIdorElementBasedOnIdorDeleteElement(f.ShapeModel.Elements[u].Value,n,"Delete"));for(GetElementProcessIdorElementBasedOnIdorDeleteElement(f.Id,n,"Delete"),r=0;r<n.objData.lstShapes.length;r++)if(n.objData.lstShapes[r].ShapeName!="BPMNEdge"&&n.objData.lstShapes[r].processRef==c&&n.objData.lstShapes[r].ShapeType=="lane"&&n.objData.lstShapes[r].Top!=y&&n.objData.lstShapes[r].Top>v)for(n.objData.lstShapes[r].Top=n.objData.lstShapes[r].Top-s,u=0;u<n.objData.lstShapes[r].ShapeModel.Elements.length;u++)n.objData.lstShapes[r].ShapeModel.Elements[u].Name=="flowNodeRef"&&n.objData.lstShapes[r].ShapeModel.Elements[u].Value&&n.objData.lstShapes[r].ShapeModel.Elements[u].Value!=""&&(e=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.objData.lstShapes[r].ShapeModel.Elements[u].Value,n,"Element"),e.Top=e.Top-s,e.LabelTop>0&&(e.LabelTop=e.LabelTop-s),ydiffislanedeleted=s,ResetEdgePoints(e,ydiffislanedeleted,n))}}else confirm("This is the last lane in current pool. Removing the lane will also remove the pool.Do you want to remove selected lane ?")&&o.PoolIndex>-1&&(n.indexofResizerElement=o.PoolIndex,n.DeletePoolanditsElements());n.selectedElemForResize=null;RedrawingElementsAndEdges(n)}n.selectedLineEle!=null&&(l=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.objData.lstShapes[n.indexOfSelectedLine].SourceElement,n,"Element"),a=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.objData.lstShapes[n.indexOfSelectedLine].TargetElement,n,"Element"),n.objData.lstShapes.splice(n.indexOfSelectedLine,1),n.ChangeDirectionifElementisGateWay(l,a),RedrawingElementsAndEdges(n),n.selectedLineEle=null);n.selectedShape=undefined;n.OnSelectLeftBPMTab("Toolbox")}};n.ChangeDirectionifElementisGateWay=function(t,i){var r;i&&i.ShapeType=="inclusiveGateway"||i.ShapeType=="parallelGateway"?(r=getgateWaydirectionbasedOnEdges(i.Id,n,""),i.ShapeModel.dictAttributes.gatewayDirection=r):(t&&t.ShapeType=="inclusiveGateway"||t.ShapeType=="parallelGateway")&&(r=getgateWaydirectionbasedOnEdges(t.Id,n,""),t.ShapeModel.dictAttributes.gatewayDirection=r);(i&&i.ShapeType=="inclusiveGateway"||t&&t.ShapeType=="inclusiveGateway")&&(i&&i.ShapeModel.dictAttributes.gatewayDirection!="Converging"||i&&i.ShapeModel.dictAttributes.gatewayDirection!="Mixed"||t&&t.ShapeModel.dictAttributes.gatewayDirection!="Converging"||t&&t.ShapeModel.dictAttributes.gatewayDirection!="Mixed")&&(i&&i.ShapeType=="inclusiveGateway"?n.DeleteSyncWithifweUsedinAnyinclusiveGateBasedOnID(i.Id):t&&n.DeleteSyncWithifweUsedinAnyinclusiveGateBasedOnID(t.Id));i.ShapeType=="inclusiveGateway"&&i.ShapeModel.dictAttributes.gatewayDirection!="Converging"&&n.DeleteSyncWithFromExtensionElements(i.ShapeModel,"");t.ShapeType=="inclusiveGateway"&&t.ShapeModel.dictAttributes.gatewayDirection!="Converging"&&n.DeleteSyncWithFromExtensionElements(t.ShapeModel,"")};n.DeleteSyncWithifweUsedinAnyinclusiveGateBasedOnID=function(t){for(var i=0;i<n.objData.lstShapes.length;i++)n.objData.lstShapes[i].ShapeType=="inclusiveGateway"&&n.objData.lstShapes[i].ShapeModel.dictAttributes.gatewayDirection=="Converging"&&n.DeleteSyncWithFromExtensionElements(n.objData.lstShapes[i].ShapeModel,t)};n.DeleteSyncWithFromExtensionElements=function(n,t){var f=i("filter")(n.Elements,{Name:"extensionElements"}),u,r;if(f&&f.length>0)for(u=f[0],r=0;r<u.Elements.length;r++)if(u.Elements[r].Name=="syncwith"){t!=""?t==u.Elements[r].Value&&u.Elements.splice(r,1):u.Elements.splice(r,1);break}};n.getLaneCountinPool=function(t){for(var r={LaneCount:"",PoolIndex:-1},u=0,f,e=!1,i=0;i<n.objData.lstShapes.length;i++)n.objData.lstShapes[i].ShapeType=="lane"?n.objData.lstShapes[i].processRef==t&&u++:n.objData.lstShapes[i].ShapeType=="participant"&&n.objData.lstShapes[i].processRef==t&&(f=i,e=!0);return e&&(r.PoolIndex=f),r.LaneCount=u,r};n.DeletePoolanditsElements=function(){var i=n.objData.lstShapes[n.indexofResizerElement].processRef,r=n.objData.lstShapes[n.indexofResizerElement].Id,u=n.objData.lstShapes[n.indexofResizerElement].ShapeType=="participant",t;n.objData.lstShapes.splice(n.indexofResizerElement,1);n.DeleteFlowNodesBasedOnID(r);n.DeleteElementsBasedOnProcessID(i);n.selectedElemForResize=null;u&&(t=n.objData.Processes.indexOf(i),t>-1&&n.objData.Processes.splice(t,1));RedrawingElementsAndEdges(n)};n.DeleteFlowNodesBasedOnID=function(t){for(var r,u,i=0;i<n.objData.lstShapes.length;i++)n.objData.lstShapes[i].ShapeName=="BPMNEdge"&&(n.objData.lstShapes[i].SourceElement==t||n.objData.lstShapes[i].TargetElement==t)&&(r=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.objData.lstShapes[i].SourceElement,n,"Element"),u=GetElementProcessIdorElementBasedOnIdorDeleteElement(n.objData.lstShapes[i].TargetElement,n,"Element"),n.objData.lstShapes.splice(i,1),n.ChangeDirectionifElementisGateWay(r,u),i--)};n.DeleteRefNodeFromLaneModel=function(t){var u,i,r;if(n.SelectedElementLane!=null&&(u={Left:parseFloat(n.SelectedElementLane.getAttribute("x")),Top:parseFloat(n.SelectedElementLane.getAttribute("y")),Height:parseFloat(n.SelectedElementLane.getAttribute("height")),Width:parseFloat(n.SelectedElementLane.getAttribute("width"))},i=getElementBasedOnObject(u,n),i!=null))for(r=0;r<i.ShapeModel.Elements.length;r++)if(i.ShapeModel.Elements[r].Value==t){i.ShapeModel.Elements.splice(r,1);break}};n.DeleteElementsBasedOnProcessID=function(t){for(var r,i=0;i<n.objData.lstShapes.length;i++)n.objData.lstShapes[i].ShapeName!="BPMNEdge"&&n.objData.lstShapes[i].processRef==t&&(r=n.objData.lstShapes[i].Id,n.DeleteFlowNodesBasedOnID(r),n.objData.lstShapes.splice(i,1),i=-1)};n.receiveReusableBpm=function(t){n.selectedCallActivityData.reUsableBpm=t};n.versionWiseDisplay=function(){n.setActiveTab("MAP");n.ActiveTabForBPM="Versions";n.isVersionsLoaded=!0;n.loadVersions()};n.openVersionedFile=function(n){var i={FileName:t.currentopenfile.file.FileName+"-"+n.CaseID+"-"+n.Version,FileType:"VersionBPM"};t.openFile(i)};n.init();n.openEntityClick=function(n){n&&n!=""&&h.NavigateToFile(n,"","")};n.addExtraFieldsDataInToMainModel=function(){var i,r,t;if(n.objBPMExtraFields&&n.objBPMExtraFields.Elements.length>0){for(r=[],t=0;t<n.objBPMExtraFields.Elements.length;t++)i={},i.ID=n.objBPMExtraFields.Elements[t].dictAttributes.ID,i.Value=n.objBPMExtraFields.Elements[t].dictAttributes.Value,i.URL=n.objBPMExtraFields.Elements[t].dictAttributes.URL,r.push(i);n.BPMNModel.ExtraFields=r}else n.BPMNModel.ExtraFields=[]};n.BeforeSaveToFile=function(){n.addExtraFieldsDataInToMainModel()};n.CheckAndSetBoolAllSelectedShapesInSameLane=function(t){for(var e,f,o,r,i=null,u=0;u<n.objData.lstShapes.length;u++)if(i=null,n.objData.lstShapes[u].ShapeType=="lane"&&(i=n.objData.lstShapes[u]),i){for(e=0,f=0;f<t.length;f++)for(o=!0,r=0;r<i.ShapeModel.Elements.length;r++)if(i.ShapeModel.Elements[r].Name=="flowNodeRef"&&i.ShapeModel.Elements[r].Value)if(i.ShapeModel.Elements[r].Value==t[f].Id){o=!0;e++;break}else o=!1;if(e!=t.length)n.isShowTopandBottomAlignButtons=!1;else{n.isShowTopandBottomAlignButtons=!0;break}}};n.OnMakeSameWidthClick=function(){n.UpdateShapeBoundsDependsOnParameter("width")};n.OnMakeSameHeightClick=function(){n.UpdateShapeBoundsDependsOnParameter("height")};n.OnMakeSameSizeClick=function(){n.UpdateShapeBoundsDependsOnParameter("samesize")};n.UpdateShapeBoundsDependsOnParameter=function(t){var f,u,r,i;if(n.lstMultipleSelectedShapes&&n.lstMultipleSelectedShapes.length>1)for(n.isDirty=!0,f=n.objData.lstShapes.length,u=null,r=0;r<n.objData.lstShapes.length;r++)if(i=n.objData.lstShapes[r],i.ShapeName!="BPMNEdge"&&(i.ShapeType=="task"||i.ShapeType=="userTask"||i.ShapeType=="serviceTask"||i.ShapeType=="businessRuleTask"||i.ShapeType=="manualTask"||i.ShapeType=="callActivity")&&n.lstMultipleSelectedShapes.indexOf(i)>-1&&n.lstMultipleSelectedShapes[0]==i){u=i;break}if(u!=null){for(r=0;r<n.objData.lstShapes.length;r++)i=n.objData.lstShapes[r],n.lstMultipleSelectedShapes.indexOf(i)>-1&&i.ShapeName!="BPMNEdge"&&(i.ShapeType=="task"||i.ShapeType=="userTask"||i.ShapeType=="serviceTask"||i.ShapeType=="businessRuleTask"||i.ShapeType=="manualTask"||i.ShapeType=="callActivity")&&(t=="width"?i.Width=u.Width:t=="height"?i.Height=u.Height:t=="samesize"&&(i.Width=u.Width,i.Height=u.Height),ReArrangeEdges(i,n));RedrawingElementsAndEdges(n)}n.lstMultipleSelectedShapes=[]};n.OnLeftAlignClick=function(){var i,r,u,t,f;if(n.lstMultipleSelectedShapes&&n.lstMultipleSelectedShapes.length>1&&(n.isDirty=!0,i=parseFloat(n.svgElement.getAttribute("width")),r=i,n.lstMultipleSelectedShapes[0]&&(r=n.lstMultipleSelectedShapes[0].Left)),r<i)for(u=0;u<n.objData.lstShapes.length;u++)t=n.objData.lstShapes[u],n.lstMultipleSelectedShapes.indexOf(t)>-1&&t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(f=r-t.Left,t.Left=r,t.LabelLeft=t.LabelLeft&&t.LabelLeft<i&&t.LabelLeft+f<i?t.LabelLeft+f:t.Left+1,ReArrangeEdges(t,n));RedrawingElementsAndEdges(n);n.lstMultipleSelectedShapes=[]};n.OnRightAlignClick=function(){var i=0,r,t,u;if(n.lstMultipleSelectedShapes&&n.lstMultipleSelectedShapes.length>1&&(n.isDirty=!0,n.lstMultipleSelectedShapes[0]&&(i=n.lstMultipleSelectedShapes[0].Left+n.lstMultipleSelectedShapes[0].Width)),i>0)for(r=0;r<n.objData.lstShapes.length;r++)t=n.objData.lstShapes[r],n.lstMultipleSelectedShapes.indexOf(t)>-1&&t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(u=i-t.Width-t.Left,t.Left=i-t.Width,t.LabelLeft=t.LabelLeft&&t.LabelLeft>0&&t.LabelLeft+u>0?t.LabelLeft+u:t.Left+1,ReArrangeEdges(t,n));RedrawingElementsAndEdges(n);n.lstMultipleSelectedShapes=[]};n.OnTopAlignClick=function(){var i,r,u,t,f;if(n.lstMultipleSelectedShapes&&n.lstMultipleSelectedShapes.length>1&&(n.isDirty=!0,i=parseFloat(n.svgElement.getAttribute("height")),r=i,n.lstMultipleSelectedShapes[0]&&(r=n.lstMultipleSelectedShapes[0].Top)),r<i)for(u=0;u<n.objData.lstShapes.length;u++)t=n.objData.lstShapes[u],n.lstMultipleSelectedShapes.indexOf(t)>-1&&t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(f=r-t.Top,t.Top=r,t.LabelTop=t.LabelTop&&t.LabelTop<i&&t.LabelTop+f<i?t.LabelTop+f:t.Top+25,ReArrangeEdges(t,n));RedrawingElementsAndEdges(n);n.lstMultipleSelectedShapes=[]};n.OnBottomAlignClick=function(){var i,r,t,u;if(n.lstMultipleSelectedShapes&&n.lstMultipleSelectedShapes.length>1&&(n.isDirty=!0,i=0,n.lstMultipleSelectedShapes[0]&&(i=n.lstMultipleSelectedShapes[0].Top+n.lstMultipleSelectedShapes[0].Height)),i>0)for(r=0;r<n.objData.lstShapes.length;r++)t=n.objData.lstShapes[r],n.lstMultipleSelectedShapes.indexOf(t)>-1&&t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(u=i-t.Height-t.Top,t.Top=i-t.Height,t.LabelTop=t.LabelTop&&t.LabelTop>0&&t.LabelTop+u>0?t.LabelTop+u:t.Top+25,ReArrangeEdges(t,n));RedrawingElementsAndEdges(n);n.lstMultipleSelectedShapes=[]};n.OnCenterVerticallyClick=function(){var r,u,i,t,f;if(n.lstMultipleSelectedShapes&&n.lstMultipleSelectedShapes.length>1)for(n.isDirty=!0,r=null,i=0;i<n.objData.lstShapes.length;i++)if(t=n.objData.lstShapes[i],t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&n.lstMultipleSelectedShapes.indexOf(t)>-1&&n.lstMultipleSelectedShapes[0]==t){r=t;break}if(r!=null)for(u=r.Left+r.Width/2,i=0;i<n.objData.lstShapes.length;i++)t=n.objData.lstShapes[i],n.lstMultipleSelectedShapes.indexOf(t)>-1&&t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(f=u-t.Width/2-t.Left,t.Left=u-t.Width/2,t.LabelLeft=t.LabelLeft&&t.LabelLeft>0&&t.LabelLeft+f>0?t.LabelLeft+f:t.Left+1);n.$evalAsync(function(){for(var t=0;t<n.lstMultipleSelectedShapes.length;t++)ReArrangeEdges(n.lstMultipleSelectedShapes[t],n);RedrawingElementsAndEdges(n);n.lstMultipleSelectedShapes=[]})};n.OnCenterHorizontallyClick=function(){var r,u,i,t,f;if(n.lstMultipleSelectedShapes&&n.lstMultipleSelectedShapes.length>1)for(n.isDirty=!0,r=null,i=0;i<n.objData.lstShapes.length;i++)if(t=n.objData.lstShapes[i],t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&n.lstMultipleSelectedShapes.indexOf(t)>-1&&n.lstMultipleSelectedShapes[0]==t){r=t;break}if(r!=null)for(u=r.Top+r.Height/2,i=0;i<n.objData.lstShapes.length;i++)t=n.objData.lstShapes[i],n.lstMultipleSelectedShapes.indexOf(t)>-1&&t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(f=u-t.Height/2-t.Top,t.Top=u-t.Height/2,t.LabelTop=t.LabelTop&&t.LabelTop>0&&t.LabelTop+f>0?t.LabelTop+f:t.Top+25,ReArrangeEdges(t,n));RedrawingElementsAndEdges(n);n.lstMultipleSelectedShapes=[]};n.OnDistributeHorizontalClick=function(){var h,r,u,i,f,t,l;if(n.lstMultipleSelectedShapes&&n.lstMultipleSelectedShapes.length>1){for(h=parseFloat(n.svgElement.getAttribute("width")),n.isDirty=!0,r=h,u=0,i=0;i<n.lstMultipleSelectedShapes.length;i++)t=n.lstMultipleSelectedShapes[i],t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(r>t.Left&&(r=t.Left),u<t.Left&&(u=t.Left));if(u>0&&r<h){sortNumbersBasedOnproperty(n.lstMultipleSelectedShapes,"","Left");var e=n.lstMultipleSelectedShapes,c=(u-r)/(e.length-1),o=c,s=0;for(i=0;i<e.length;i++)for(f=0;f<n.objData.lstShapes.length;f++)e[i].Id==n.objData.lstShapes[f].Id&&(t=n.objData.lstShapes[f],t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(s==0?o=c+t.Left:s>0&&s<e.length&&(l=o-t.Left,t.Left=o,t.LabelLeft=t.LabelLeft&&t.LabelLeft>0&&t.LabelLeft+l>0?t.LabelLeft+l:t.Left+1,ReArrangeEdges(t,n),o+=c),s++))}RedrawingElementsAndEdges(n);n.lstMultipleSelectedShapes=[]}};n.OnDistributeVerticalClick=function(){var i,r,t,l;if(n.lstMultipleSelectedShapes&&n.lstMultipleSelectedShapes.length>1){n.isDirty=!0;var u=parseFloat(n.svgElement.getAttribute("height")),f=u,e=0;for(i=0;i<n.lstMultipleSelectedShapes.length;i++)t=n.lstMultipleSelectedShapes[i],t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(f>t.Top&&(f=t.Top),e<t.Top&&(e=t.Top));if(e>0&&f<u){sortNumbersBasedOnproperty(n.lstMultipleSelectedShapes,"","Top");var o=n.lstMultipleSelectedShapes,c=(e-f)/(o.length-1),s=c,h=0;for(i=0;i<o.length;i++)for(r=0;r<n.objData.lstShapes.length;r++)o[i].Id==n.objData.lstShapes[r].Id&&(t=n.objData.lstShapes[r],t.ShapeName!="BPMNEdge"&&t.ShapeType!="message"&&(h==0?s=c+t.Top:h>0&&h<o.length&&(l=s-t.Top,t.Top=s,t.LabelTop=t.LabelTop&&t.LabelTop<u&&t.LabelTop+l<u?t.LabelTop+l:t.Top+25,ReArrangeEdges(t,n),s+=c),h++))}RedrawingElementsAndEdges(n);n.lstMultipleSelectedShapes=[]}};n.NavigateToCalledElementFromContextMenu=function(n){$.connection.hubBPMN.server.getBPMNFileInfo(n).done(function(n){var i=n;i&&t.openFile(i)})};n.MoveElementUsingKeyBoard=function(t){n.selectedShape&&n.selectedElemForResize&&n.selectedShape.ShapeType!="lane"&&(t=="Down"?moveElementUsingKeyBoard(n,0,2):t=="Top"?moveElementUsingKeyBoard(n,0,-2):t=="Left"?moveElementUsingKeyBoard(n,-2,0):t=="Right"&&moveElementUsingKeyBoard(n,2,0))};n.OnSelectLeftBPMTab=function(t){t=="Properties"?(n.ActiveTabForBPM="Properties",n.IsPropsExpanded||(n.IsPropsExpanded=!0)):t=="Toolbox"?n.ActiveTabForBPM="Toolbox":t=="Versions"&&(n.ActiveTabForBPM="Versions",n.versionWiseDisplay())};n.toggleSideBar=function(){n.IsToolsDivCollapsed=!n.IsToolsDivCollapsed};n.showEnterExitDialog=function(i,u,f){var e=n.$new();e.isEnter=i;e.model=JSON.parse(JSON.stringify(u));e.mapvarids=r.getMapVariableIds(n.mapVariablesModel.Elements);e.getquerydialog=n.getQuery_dialog;e.entityid=f;e.parameterallowedvalues=n.queryParameterallowedValues;e.IsDisabledforVersioning=n.IsDisabledforVersioning;e.addVariable=function(){var n={prefix:"sbpmn",Name:"variable",dictAttributes:{},Elements:[],Value:"",Children:[]};e.model.Elements.push(n);e.SelectedVariable=n};e.deleteVariable=function(){if(e.SelectedVariable){var n=e.model.Elements.indexOf(e.SelectedVariable);n>-1&&(e.SelectedVariable=n+1==e.model.Elements.length?e.model.Elements[n-1]:e.model.Elements[n+1],e.model.Elements.splice(n,1))}};e.onVariableTypeChanged=function(n){n.dictAttributes.sfwEntityField="";n.dictAttributes.sfwQueryID=""};e.onOKClick=function(){for(t.UndRedoBulkOp("Start");u.Elements.length>0;)t.DeleteItem(u.Elements[0],u.Elements,null);for(var n=0;n<e.model.Elements.length;n++)t.PushItem(e.model.Elements[n],u.Elements);t.UndRedoBulkOp("End");e.closeDialog()};e.closeDialog=function(){e.dialog&&e.dialog.close()};e.dialog=t.showDialog(e,"Set "+(i?"Enter":"Exit")+" Actions","BPM/views/Association/EnterExitTemplate.html",{width:1100})};n.saveBPMNAsPng=function(){var u,i,r,o;t.isIEBrowser=!1;u=window.navigator.userAgent;(u.indexOf("MSIE ")>-1||u.indexOf("Trident/")>-1||u.indexOf("Edge/")>-1)&&(t.isIEBrowser=!0);var h=n.svgElement,s=(new XMLSerializer).serializeToString(n.svgElement),e="data:image/svg+xml;base64,"+btoa(s),f=open("");f?(n.objSvgLimits=n.getMaxHeightAndWidthofSvg(n.BPMNModel.lstShapes),i=new Image,i.crossOrigin="Anonymous",t.isIEBrowser?(u.indexOf("Edge/")>-1?(i.style.width=n.objSvgLimits.Width+100,i.style.height=n.objSvgLimits.Height+100):(i.width=n.objSvgLimits.Width+100,i.height=n.objSvgLimits.Height+100),i.src=e,i.onload=function(){f.document.write(i.outerHTML)}):(r=document.createElement("canvas"),r.width=n.objSvgLimits.Width+100,r.height=n.objSvgLimits.Height+100,document.body.appendChild(r),o=r.getContext("2d"),i.src=e,i.onload=function(){var t,n;o.drawImage(i,0,0);t=r.toDataURL("image/png");document.body.removeChild(r);n=new Image;n.src=t;f.document.write(n.outerHTML)})):alert("please allow pop-up")};n.validateFileData=function(){$.connection.hubBPMN.server.validateMap().done(function(t){t&&t.length?n.showValidationResult(t):toastr.success("Map validated successfully.")})};n.createRule=function(t){var i=getScopeByFileName("MainPage");i&&i.addRules("LogicalRule",n,t.Entity,t.RuleName.substr(3),!1)}}]);objElements=function(){return{dictAttributes:{},Elements:[],Children:[],Name:"",prefix:"sbpmn"}};app.controller("VersionController",["$scope","$rootScope","$filter","$cssFunc","$getQueryparam","$getEnitityXmlMethods","$getEnitityRule","hubcontext","$timeout",function(n,t,i,r,u,f,e,o,s){n.init=function(){if(n.initVariables(),n.initSvgVariables(),t.IsLoading=!0,n.$parent.calledCaseBpmModel)n.receiveBpmnModel(n.$parent.calledCaseBpmModel);else{var i=t.currentopenfile.file.FileName.split("-");o.hubBPMN.server.getVersionBpmModel(i[1],i[2]).done(function(t){n.$evalAsync(function(){n.receiveBpmnModel(t)})})}};n.initVariables=function(){n.versionList=[];n.activeTab="MAP";n.currentfilename=t.currentopenfile.file.FileName;n.IsVersionDisplay=!0;n.IsToolsDivCollapsed=!0;n.IsDisabledforVersioning=!0;n.associationActiveTab="FORM";n.datatypes=["bool","datetime","decimal","double","float","int","long","short","string","Object","BusinessObject"];n.types=["local","in","out"];n.Requiredtypes=["","true","false"];n.dvtypes=["Query","Constant"];n.mandatoryElementIds=["PersonId","OrgId","ReferenceId","Source","InstanceInfo1","InstanceInfo2"];n.queryParameterallowedValues=["PersonId","OrgId","ReferenceId","Source"];n.currentUserTaskData={enterFormData:{entityID:"",formTitle:"",controlTree:[],initialLoadModel:{},visibleRules:[]},reEnterFormData:{entityID:"",formTitle:"",controlTree:[],entities:[],buttons:[],initialLoadModel:{},visibleRules:[]},selectedEntity:"BpmActivityInstance",formList:[]};n.selectedCallActivityData={reUsableBpm:[],CalledMapVariable:[]};n.operatorsList=["GreaterThan","GreaterThanEqual","Equal","NotEqual","LessThan","LessThanEqual","StartsWith","EndsWith"];n.TargetSiteList=undefined;n.BPMNModel=undefined;n.objData=undefined;n.mapVariablesModel=undefined};n.initSvgVariables=function(){n.svgNS="http://www.w3.org/2000/svg";n.selectedElement=0;n.currentX=0;n.currentY=0;n.selectedElementTop=0;n.selectedElementLeft=0;n.selectedElemstartLeft=0;n.selectedElemstartTop=0;n.indexofResizerElement;n.selectedElemPrevBounds=0;n.isElementMoved=!1;n.ClonedElement=null;n.ClonedResizer=null;n.LaneElement=null;n.SelectedElementLane=null;n.selectedResizergElement=0;n.selectedElemForResize=0;n.selectedlineEle=0;n.linecount=0;n.selectedLineSourceElement=0;n.selectedLineTargetElement=0;n.indexOfSelectedLine;n.ClonedLineElement=null;n.selectedlinegtagEle=0;n.selectedlineindex=0;n.isEdgeChanged=!1;n.ClonedLineSourceElement=null;n.ClonedLineTargetElement=null;n.sourceElementOnMouseHover=null;n.targetElementOnMouseHover=null;n.hoverElement=null;n.targetElementForLine=null;n._previousPosition;n.NewEdgeWayPoints;n.LaneIndex;n.PrevlaneElement=null;n.objDragOverLineElement=null};n.receiveBpmnModel=function(r){n.$evalAsync(function(){r!=undefined&&(n.objBPMExtraFields=undefined,n.BPMNModel=r,n.objData=n.BPMNModel,n.BPMNModel.Type!="BPMTemplate"&&(n.mapVariablesModel=i("filter")(n.BPMNModel.ExtensionElementsModel.Elements,{Name:"mapVariables"})[0]),s(function(){n.svgElement=$("div[id='versionBPMN-"+n.$id+"']").find("#mySVG")[0];n.SetUniqueIdtoGradientsInsideSVG();n.FilterTheElementsBasedOnTypeAndLoadShapes(n.objData.lstShapes)},0),n.mapVariablesModel&&(n.queryParametersValues=u.getMapVariableIds(n.mapVariablesModel.Elements)),n.ProcessTypes=[],$.connection.hubBPMN.server.getProcessTypes().done(function(t){n.ProcessTypes=t}));t.IsLoading=!1})};n.SetUniqueIdtoGradientsInsideSVG=function(){for(var r,i=0;i<n.svgElement.childNodes.length;i++)if(n.svgElement.childNodes[i].nodeName=="defs")for(r=0;r<n.svgElement.childNodes[i].childNodes.length;r++)n.svgElement.childNodes[i].childNodes[r].nodeName!="#text"&&n.svgElement.childNodes[i].childNodes[r].nodeName!="#comment"&&n.svgElement.childNodes[i].childNodes[r].setAttribute("id",n.svgElement.childNodes[i].childNodes[r].getAttribute("id")+"_"+t.currentopenfile.file.FileName.trim())};n.FilterTheElementsBasedOnTypeAndLoadShapes=function(t){for(var r=[],u=[],i=0;i<t.length;i++)t[i].ShapeType=="participant"||t[i].ShapeType=="lane"?r.push(t[i]):u.push(t[i]);n.LoadShapes(n.svgElement,r);n.LoadShapes(n.svgElement,u)};n.LoadShapes=function(t,i){for(var r,f,e,u=0;u<i.length;u++){if(r=i[u],r.IsExecuted=!0,r.ShapeName=="BPMNShape"){f=!1;e=!1;switch(r.ShapeType){case"participant":case"lane":drawSquareParam(t,r,n);f=!0;break;case"task":case"userTask":case"serviceTask":case"businessRuleTask":case"manualTask":case"callActivity":drawTask(t,r,n);e=!0;break;case"endEvent":case"startEvent":case"intermediateCatchEvent":drawCircle(t,r,n);break;case"exclusiveGateway":case"inclusiveGateway":case"parallelGateway":case"eventBasedGateway":drawDiamond(t,r,n);break;case"dataStoreReference":drawdataStoreReference(t,r,n);break;case"dataObjectReference":drawdataObjectReference(t,r,n);break;case"textAnnotation":drawtextAnnotation(t,r,n);break;case"message":drawInitiatingorNonInitiatingMessage(t,r,n);break;default:drawTask(t,r,n)}}r.ShapeName=="BPMNEdge"&&AddLineArray(t,r,n)}};n.setActiveTab=function(t){n.DraggableElement=null;n.activeTab=t};n.selectVariable=function(t){n.selectedVariable=t};n.showEnterExitDialog=function(i,r,f){var e=n.$new();e.model=JSON.parse(JSON.stringify(r));e.mapvarids=u.getMapVariableIds(n.mapVariablesModel.Elements);e.entityid=f;e.IsDisabledforVersioning=n.IsDisabledforVersioning;e.isObjectbased=n.BPMNModel.IsObjectBased;e.closeDialog=function(){e.dialog&&e.dialog.close()};e.dialog=t.showDialog(e,"Set "+(i?"Enter":"Exit")+" Actions","BPM/views/Association/EnterExitTemplate.html",{width:1100})};n.checkAndUpdateParamChildModels=function(n,i){var r=n.Elements.filter(function(n){return n.Name=="value"});r&&r.length>0?i?t.EditPropertyValue(n.valueModel,n,"valueModel",r[0]):n.valueModel=r[0]:i?(t.EditPropertyValue(n.valueModel,n,"valueModel",{prefix:"",Name:"value",Value:"",dictAttributes:{},Elements:[],Children:[]}),t.PushItem(n.valueModel,n.Elements)):(n.valueModel={prefix:"",Name:"value",Value:"",dictAttributes:{},Elements:[],Children:[]},n.Elements.push(n.valueModel));r=n.valueModel.Elements.filter(function(n){return n.Name=="BusinessObject"});r&&r.length>0?i?t.EditPropertyValue(n.valueModel.businessObjectModel,n.valueModel,"businessObjectModel",r[0]):n.valueModel.businessObjectModel=r[0]:i?(t.EditPropertyValue(n.valueModel.businessObjectModel,n.valueModel,"businessObjectModel",{prefix:"",Name:"BusinessObject",Value:"",dictAttributes:{},Elements:[],Children:[]}),t.PushItem(n.valueModel.businessObjectModel,n.valueModel.Elements)):(n.valueModel.businessObjectModel={prefix:"",Name:"BusinessObject",Value:"",dictAttributes:{},Elements:[],Children:[]},n.valueModel.Elements.push(n.valueModel.businessObjectModel));r=n.valueModel.businessObjectModel.Elements.filter(function(n){return n.Name=="Initialize"});r&&r.length>0?i?t.EditPropertyValue(n.valueModel.businessObjectModel.initializeModel,n.valueModel.businessObjectModel,"initializeModel",r[0]):n.valueModel.businessObjectModel.initializeModel=r[0]:i?(t.EditPropertyValue(n.valueModel.businessObjectModel.initializeModel,n.valueModel.businessObjectModel,"initializeModel",{prefix:"",Name:"Initialize",Value:"",dictAttributes:{ObjectType:"XmlMethod"},Elements:[],Children:[]}),t.PushItem(n.valueModel.businessObjectModel.initializeModel,n.valueModel.businessObjectModel.Elements)):(n.valueModel.businessObjectModel.initializeModel={prefix:"",Name:"Initialize",Value:"",dictAttributes:{ObjectType:"XmlMethod"},Elements:[],Children:[]},n.valueModel.businessObjectModel.Elements.push(n.valueModel.businessObjectModel.initializeModel))};n.showDetails=function(){var t,r;n.selectedShape&&(t=i("filter")(n.selectedShape.ShapeModel.Elements,{Name:"extensionElements"}),t&&t.length>0&&(r=i("filter")(t[0].Elements,{Name:"isSynchronous"}),r&&r.length>0&&(n.selectedShape.ShapeModel.isSynchronousModel=r[0])))};n.init()}]);app.controller("BPMExecutionController",["$scope","$rootScope","$filter","$cssFunc","$getQueryparam","$getEnitityXmlMethods","$getEnitityRule","hubcontext","$timeout",function(n,t,i,r,u,f,e,o,s){n.Guid="";n.Guid=generateUUID();n.isIterationDialog=!1;n.makeMapSVG=function(){n.$parent.BPMExceutionTabDetails.isIteration||(n.ExecutedSteps=n.$parent.BPMExceutionTabDetails.ExecutedData.lstExecutedSteps);n.lstExecutionTabShapes=n.$parent.BPMExceutionTabDetails.ExecutedData.lstShapes;n.isIterationDialog=n.$parent.BPMExceutionTabDetails.isIteration;n.isIterationDialog&&(n.lstIterationsForTab=n.$parent.BPMExceutionTabDetails.ExecutedData.lstIterations,n.ExecutedSteps=n.$parent.BPMExceutionTabDetails.ExecutedData.lstIterations[0].lstExecutedSteps,n.objTabIteration=n.$parent.BPMExceutionTabDetails.ExecutedData.lstIterations[0]);n.FilterTheElementsBasedOnTypeAndLoadShapes(n.lstExecutionTabShapes);n.$parent.BPMExceutionTabDetails.Mode=="Demo"&&(n.index=0,n.ShowAnimationForExecutedSteps())};n.onIterationTabClick=function(t){n.objTabIteration=t;clearShapes(n);n.ExecutedSteps=t.lstExecutedSteps;n.FilterTheElementsBasedOnTypeAndLoadShapes(n.lstExecutionTabShapes)};n.ShowAnimationForExecutedSteps=function(){n.index<n.ExecutedSteps.length&&s(function(){n.ExecutedSteps[n.index].ExecutedShapeElement&&n.FillColourToExecutedStep(n.ExecutedSteps[n.index].ExecutedShapeElement);n.index++;n.index<n.ExecutedSteps.length?n.ExecutedSteps[n.index-1].ExecutedShapeElement&&n.ExecutedSteps[n.index-1].ExecutedShapeElement.getAttribute("id")!="callActivity"&&n.ShowAnimationForExecutedSteps():n.$parent.BPMExceutionTabDetails.isChildWindow?s(function(){n.close()},300):alert("Execution Completed")},300)};n.FillColourToExecutedStep=function(t){var f=t.getAttribute("id"),r,i,u;switch(f){case"task":case"userTask":case"serviceTask":case"businessRuleTask":case"manualTask":case"callActivity":for(i=0;i<t.childNodes.length;i++)if(t.childNodes[i].nodeName=="rect"){shadowcolor="url(#rectshadow_"+n.Guid+")";r="url(#task_"+n.Guid+")";t.childNodes[i].setAttributeNS(null,"fill",r);t.childNodes[i].setAttributeNS(null,"filter",shadowcolor);break}if(f=="callActivity"){for(i=0;i<n.lstExecutionTabShapes.length;i++)if(n.lstExecutionTabShapes[i].Left==parseFloat(t.getAttribute("x"))&&n.lstExecutionTabShapes[i].Top==parseFloat(t.getAttribute("y"))){n.selectedShape=n.lstExecutionTabShapes[i];break}n.selectedShape&&n.selectedShape.ShapeType=="callActivity"&&n.showDetails()}break;case"endEvent":case"startEvent":case"intermediateCatchEvent":for(i=0;i<t.childNodes.length;i++)if(t.childNodes[i].nodeName=="circle"){r="";f=="startEvent"?r="url(#start_"+n.Guid+")":f=="endEvent"?r="url(#end_"+n.Guid+")":f=="intermediateCatchEvent"&&(r="url(#intermediate_"+n.Guid+")");t.childNodes[i].setAttributeNS(null,"fill",r);break}break;case"exclusiveGateway":case"inclusiveGateway":case"parallelGateway":case"eventBasedGateway":for(i=0;i<t.childNodes.length;i++)if(t.childNodes[i].nodeName=="polygon"){r="";r="url(#exclusive_"+n.Guid+")";t.childNodes[i].setAttributeNS(null,"fill",r);break}break;case"line":for(i=0;i<t.childNodes.length;i++)if(t.childNodes[i].getAttribute("elementtype")=="linegroup")for(u=0;u<t.childNodes[i].childNodes.length;u++)t.childNodes[i].childNodes[u].nodeName=="line"&&t.childNodes[i].childNodes[u].getAttribute("stroke-width")!=15&&t.childNodes[i].childNodes[u].setAttributeNS(null,"stroke","black")}};n.init=function(){n.initVariables();n.initSvgVariables();s(function(){n.$apply(function(){n.Guid});n.svgElement=$("div[id='"+n.Guid+"']").contents().find("#ExecutionSVG")[0];n.SetUniqueIdtoGradientsInsideSVG();n.makeMapSVG()})};n.initVariables=function(){n.versionList=[];n.activeTab="EXECUTION"};n.initSvgVariables=function(){n.svgNS="http://www.w3.org/2000/svg";n.selectedElement=0;n.currentX=0;n.currentY=0;n.selectedElementTop=0;n.selectedElementLeft=0;n.selectedElemstartLeft=0;n.selectedElemstartTop=0;n.indexofResizerElement;n.selectedElemPrevBounds=0;n.isElementMoved=!1;n.ClonedElement=null;n.ClonedResizer=null;n.LaneElement=null;n.SelectedElementLane=null;n.selectedResizergElement=0;n.selectedElemForResize=0;n.selectedlineEle=0;n.linecount=0;n.selectedLineSourceElement=0;n.selectedLineTargetElement=0;n.indexOfSelectedLine;n.ClonedLineElement=null;n.selectedlinegtagEle=0;n.selectedlineindex=0;n.isEdgeChanged=!1;n.ClonedLineSourceElement=null;n.ClonedLineTargetElement=null;n.sourceElementOnMouseHover=null;n.targetElementOnMouseHover=null;n.hoverElement=null;n.targetElementForLine=null;n._previousPosition;n.NewEdgeWayPoints;n.PaticipantIndex;n.LaneIndex;n.PrevlaneElement=null;n.objDragOverLineElement=null};n.SetUniqueIdtoGradientsInsideSVG=function(){for(var i,t=0;t<n.svgElement.childNodes.length;t++)if(n.svgElement.childNodes[t].nodeName=="defs")for(i=0;i<n.svgElement.childNodes[t].childNodes.length;i++)n.svgElement.childNodes[t].childNodes[i].nodeName!="#text"&&n.svgElement.childNodes[t].childNodes[i].nodeName!="#comment"&&n.svgElement.childNodes[t].childNodes[i].setAttribute("id",n.svgElement.childNodes[t].childNodes[i].getAttribute("id")+"_"+n.Guid)};n.FilterTheElementsBasedOnTypeAndLoadShapes=function(t){var r={Height:2500,Width:2500},u=n.getMaxHeightAndWidthofSvg(t),f,e,i;for(u.Height&&u.Height>r.Height&&(r.Height=u.Height+100),u.Width&&u.Width>r.Width&&(r.Width=u.Width+100),n.svgElement.setAttribute("height",r.Height),n.svgElement.setAttribute("width",r.Width),f=[],e=[],i=0;i<t.length;i++)t[i].ShapeType=="participant"||t[i].ShapeType=="lane"?f.push(t[i]):e.push(t[i]);n.LoadShapes(n.svgElement,f);n.LoadShapes(n.svgElement,e)};n.LoadShapes=function(t,i){for(var r,f,e,u=0;u<i.length;u++){if(r=i[u],r.IsExecuted=!0,r.ShapeName=="BPMNShape"){f=!1;e=!1;switch(r.ShapeType){case"participant":case"lane":drawSquareParam(t,r,n);f=!0;break;case"task":case"userTask":case"serviceTask":case"businessRuleTask":case"manualTask":case"callActivity":drawTask(t,r,n);e=!0;break;case"endEvent":case"startEvent":case"intermediateCatchEvent":drawCircle(t,r,n);break;case"exclusiveGateway":case"inclusiveGateway":case"parallelGateway":case"eventBasedGateway":drawDiamond(t,r,n);break;case"dataStoreReference":drawdataStoreReference(t,r,n);break;case"dataObjectReference":drawdataObjectReference(t,r,n);break;case"textAnnotation":drawtextAnnotation(t,r,n);break;case"message":drawInitiatingorNonInitiatingMessage(t,r,n);break;default:drawTask(t,r,n)}}r.ShapeName=="BPMNEdge"&&AddLineArray(t,r,n)}};n.ShowVariables=function(){var i=n.GetExecutedstep(n.selectedShape.Id);i&&i.ParametersSnapShot&&$.connection.hubBPMN.server.loadParametersFromSnapShot(i.ParametersSnapShot).done(function(i){n.$evalAsync(function(){if(n.lstParametersofExecutedStep=i,n.lstParametersofExecutedStep){var r=n.$new();r.selectedExecutedStep="";r.lstParametersofExecutedStep=n.lstParametersofExecutedStep;r.templateName="BPM/views/Execution/ExecutionVariablesDialog.html";r.dialogOptions={height:500,width:650,showclose:!0};r.dialog=t.showDialog(r,"Parameters",r.templateName,r.dialogOptions);r.close=function(){n.$evalAsync(function(){r.dialog.close()})};r.SelectExecutedStep=function(n){r.selectedExecutedStep=n}}})})};n.showDetails=function(){var s=!1,c,i,r,u,t;if(event&&(n.$parent.BPMExceutionTabDetails.Mode="Normal",c=event.currentTarget,c.iterationCount>1&&(s=!0,n.ShowIterationWindow())),n.selectedShape&&!s&&n.selectedShape.ShapeType=="callActivity"){for(i=n.selectedShape.ShapeModel,r="",t=0;t<i.Elements.length;t++)if(i.Elements[t].Elements&&i.Elements[t].Elements.length>0)for(u=0;u<i.Elements[t].Elements.length;u++)if(i.Elements[t].Elements[u].Name&&i.Elements[t].Elements[u].Name=="calledCaseBpmMap"){r=i.Elements[t].Elements[u].Value;break}if(r)if(r.length>32e3){var f="",o=[],e=0;for(t=0;t<r.length;t++)e++,f=f+r[t],e==32e3&&(e=0,o.push(f),f="");e!=0&&o.push(f);h(o)}else hubMain.server.getExecutedBPMModel(r).done(function(t){if(t){var i={},r=n.getExecutedStepsForCallElement(n.selectedShape.Id);i.lstShapes=t.lstShapes;r&&(i.lstExecutedSteps=r,n.ShowExecutedDailog(i))}})}};n.ShowIterationWindow=function(){var i;n.lstIteration=[];var t=null,r=!1,u=1;for(i=0;i<n.ExecutedSteps.length;i++)r||n.selectedShape.Id==n.ExecutedSteps[i].ElementId&&(r=!0),r&&(n.ExecutedSteps[i].ElementId==n.selectedShape.Id&&(t={},t.Id="iteration"+u,t.lstExecutedSteps=[],n.lstIteration.push(t),u++),t!=null&&t.lstExecutedSteps.push(n.ExecutedSteps[i]));n.OpenIterationWindowDialog(n.lstIteration)};n.OpenIterationWindowDialog=function(i){n.BPMExceutionTabDetails={};n.BPMExceutionTabDetails.ExecutedData={};n.BPMExceutionTabDetails.ExecutedData.lstIterations=i;n.BPMExceutionTabDetails.ExecutedData.lstShapes=n.lstExecutionTabShapes;n.BPMExceutionTabDetails.isIteration=!0;n.BPMExceutionTabDetails.Mode=n.$parent.BPMExceutionTabDetails.Mode;var r=n.$new();r.BPMExceutionTabDetails=n.BPMExceutionTabDetails;r.templateName="BPM/views/Execution/BPMExecutionDialog.html";r.dialogOptions={height:700,width:1300,showclose:!0};r.dialog=t.showDialog(r,"Iteration Result",r.templateName,r.dialogOptions);r.close=function(){n.$evalAsync(function(){r.dialog.close();n.$parent.BPMExceutionTabDetails.Mode=="Demo"&&n.ShowAnimationForExecutedSteps()})}};n.getExecutedStepsForCallElement=function(t){var i;if(n.ExecutedSteps.length>0)for(i=0;i<n.ExecutedSteps.length;i++)if(t==n.ExecutedSteps[i].ElementId)return n.ExecutedSteps[i].lstExecutedSteps};n.ShowExecutedDailog=function(i){if(i){n.BPMExceutionTabDetails={};n.BPMExceutionTabDetails.ExecutedData=i;n.BPMExceutionTabDetails.Mode=n.$parent.BPMExceutionTabDetails.Mode;n.BPMExceutionTabDetails.isChildWindow=!0;var r=n.$new();r.BPMExceutionTabDetails=n.BPMExceutionTabDetails;r.templateName="BPM/views/Execution/BPMExecutionDialog.html";r.dialogOptions={height:700,width:1300,showclose:!0};r.dialog=t.showDialog(r,"CallActivity Result",r.templateName,r.dialogOptions);r.close=function(){n.$evalAsync(function(){r.dialog.close();n.$parent.BPMExceutionTabDetails.Mode=="Demo"&&n.ShowAnimationForExecutedSteps()})}}};var h=function(t){for(var i=0;i<t.length;i++)hubMain.server.receiveDataPacketsForBPMNModel(t[i],t.length,i).done(function(t){if(t){var i={},r=n.getExecutedStepsForCallElement(n.selectedShape.Id);i.lstShapes=t.lstShapes;r&&(i.lstExecutedSteps=r,n.ShowExecutedDailog(i))}})};n.init();n.CheckStepisExceutedOrNot=function(t,i){var e=!1,r,f,u;if(n.ExecutedSteps.length>0){for(r=0;r<n.ExecutedSteps.length;r++)if(t==n.ExecutedSteps[r].ElementId){e=!0;n.ExecutedSteps[r].ExecutedShapeElement=i;f=0;u=n.ExecutedSteps.filter(function(n){return n.ElementId==t});u&&u.length>0&&(f=u.length);i.iterationCount=f;break}}else return!1;return e};n.GetExecutedstep=function(t){var r="",i;if(n.ExecutedSteps.length>0)for(i=0;i<n.ExecutedSteps.length;i++)if(t==n.ExecutedSteps[i].ElementId){r=n.ExecutedSteps[i];break}return r}}]);$(document).bind("mousedown",function(n){!$(n.target).parents(".custom-menu").length>0&&($(".custom-menu").hide(100),scopeforexecutionvaraibles=undefined,$(".page-header-fixed").css("pointer-events","auto"))});app.component("bpmUsertaskShapeMapProperties",{templateUrl:"BPM/views/Map/UserTaskMapProperties.html",bindings:{model:"<",mapvariablesmodel:"<",isDisabledforVersioning:"<?"},controller:["$rootScope",bpmUsertaskProcessMapPropertiesController]});app.component("bpmProcessShapeMapProperties",{templateUrl:"BPM/views/Map/ProcessMapProperties.html",bindings:{model:"<",processTypes:"<",mapvariablesmodel:"<",isDisabledforVersioning:"<?"},controller:["$rootScope",bpmUsertaskProcessMapPropertiesController]});app.component("bpmCallactivityShapeMapProperties",{bindings:{model:"<",isDisabledforVersioning:"<?",setCalledelementparameters:"&",calledCaseBpmModel:"<"},templateUrl:"BPM/views/Map/CallActivityMapProperties.html",controller:["$rootScope","$scope",bpmCallactivityMapPropertiesController]});app.component("processusertaskcommonproperties",{bindings:{model:"=",showseconds:"<",istimerevent:"<",processtypes:"<",onchangeDuration:"&",slaFromVariable:"&",datetypevariables:"<",inttypevariables:"<",isDisabledforVersioning:"<?"},templateUrl:"BPM/views/Map/ProcessUserTaskMapProperties.html"});app.component("bpmIntermediateCatchEventMapProperties",{bindings:{model:"<",mapvariablesmodel:"<",isDisabledforVersioning:"<?",selectedelemforresize:"<",processtypes:"<"},templateUrl:"BPM/views/Map/IntermediateCatchEventMapProperties.html",controller:["$rootScope","$filter","$getQueryparam",intermediateCatchEventMapPropertiesController]});app.component("bpmMessageflowMapProperties",{bindings:{model:"<",isDisabledforVersioning:"<?",docTypes:"<"},templateUrl:"BPM/views/Map/MessageFlowMapProperties.html",controller:["$filter","$rootScope",messageflowMapPropertiesController]});app.component("bpmTextAnnotationProperties",{bindings:{shapeModel:"<",isDisabledforVersioning:"<?",onChangeText:"&"},replace:!0,templateUrl:"BPM/views/Map/TextAnnotationProperties.html",controller:["$rootScope","$scope",bpmTextAnnotationMapPropertiesController]});app.component("bpmInclusiveGatewayProperties",{bindings:{shapeModel:"<",isDisabledforVersioning:"<?",getDivergingGatewaysCallback:"&"},templateUrl:"BPM/views/Map/InclusiveGatewayProperties.html",controller:["$scope","$filter",bpmInclusiveGatewayController]});app.component("bpmUserTaskAssociationProperties",{bindings:{queryParametersValues:"<",shapeModel:"<",isDisabledforVersioning:"<?",isObjectbased:"<?"},replace:!0,controller:["$scope","$filter","$rootScope",userTaskAssociationPropertiesController],templateUrl:"BPM/views/Association/UserTaskAssociationProperties.html"});app.component("bpmBusinessRuleTaskAssociationProperties",{bindings:{shapeModel:"<",isDisabledforVersioning:"<?",queryParametersValues:"<",isObjectbased:"<?"},replace:!0,controller:["$scope","$filter","$rootScope","$getEnitityRule","$EntityIntellisenseFactory","$getEnitityXmlMethods",businessRuleTaskAssociationController],templateUrl:"BPM/views/Association/PropertiesBussinessRuleTask.html"});app.component("bpmInitializeSection",{bindings:{model:"<",queryParametersValues:"<",isDisabledforVersioning:"<",callbackFunction:"&"},replace:!0,controller:["$scope","$filter","$rootScope","$getQueryparam","$NavigateToFileService","$getEnitityXmlMethods",initializeController],templateUrl:"BPM/views/Association/InitializeTemplate.html"});app.component("bpmCallactivityShapeAssociationProperties",{bindings:{model:"<",isDisabledforVersioning:"<?",queryParametersvalues:"<",setCalledelementparameters:"&",onValueSourceChanged:"&",setParamEntityValue:"&",checkAndUpdateParamChildModels:"&"},templateUrl:"BPM/views/Association/CallActivityAssociationProperties.html",controller:["$rootScope","$scope",bpmCallactivityAssociationPropertiesController]});app.component("bpmServiceruleShapeAssociationProperties",{bindings:{shapeModel:"<",isDisabledforVersioning:"<?",queryParametersvalues:"<",queryParameterallowedValues:"<",checkAndUpdateParamChildModels:"&",onValueSourceChanged:"&",mapVariablesModel:"<",setParamEntityValue:"&",isObjectbased:"<?"},templateUrl:"BPM/views/Association/ServiceRuleTaskAssociationProperties.html",controller:["$rootScope","$scope","$filter","$EntityIntellisenseFactory","$getEnitityXmlMethods","$getEnitityObjectMethods","$NavigateToFileService","$getQueryparam",bpmServiceRuleAssociationPropertiesController]});app.component("bpmSequenceflowShapeAssociationProperties",{bindings:{model:"<",isDisabledforVersioning:"<?",queryParameterallowedValues:"<",operatorsList:"<",queryParametersvalues:"<",setQueryParam:"&"},templateUrl:"BPM/views/Association/GatewayExpressionAssociationProperties.html",controller:["$rootScope","$scope",bpmSequenceFlowAssociationPropertiesController]});app.component("setValueByConstantVariableQuery",{bindings:{model:"<",setqueryparam:"&",direction:"<",isDisabledforVersioning:"<?",isLeftSideExpression:"<"},require:{parent:"^bpmSequenceflowShapeAssociationProperties"},templateUrl:"BPM/views/Association/setValueByConstantVariableQuery.html",controller:["$rootScope","$getQueryparam",setValueByConstantVariableQueryController]});app.directive("usertaskperformerstableheadertemplate",["$compile","$rootScope",function(n){var t=function(){return"<table style='width:100%' ><thead><tr class='boldfont grey-bottom-border'> <th style='width:10px'><div class='arrow-td'><\/div><\/th><th><div>Role<\/div> <\/th><th><div>Skill<\/div> <\/th><th><div>Location<\/div><\/th><th><div>Authority Level<\/div><\/th><th><div>Position<\/div><\/th><th><div>User<\/div> <\/th><\/tr> <\/thead><\/table>"};return{restrict:"E",replace:!0,scope:{},link:function(i,r){var u=$(r).parent();u.html(t());n(u.contents())(i)}}}]);app.directive("usertaskperformerstabledatatemplate",["$compile","$rootScope",function(){return{restrict:"E",replace:!0,scope:{conditionsModel:"=",lstbpmnrelatedcodevalues:"=",lstuserroles:"=",mapvariablesmodel:"=",selectedCondition:"=",isdisabledforversioning:"<"},link:function(n){n.types={Role:"role",Skill:"skill",Location:"location",AuthorityLevel:"authoritylevel",Position:"position",User:"user"};n.setEmptyvalueOnChange=function(n,t){t=="role"?n.dictAttributes.role="":t=="skill"?n.dictAttributes.skill="":t=="location"?n.dictAttributes.location="":t=="position"?n.dictAttributes.position="":t=="authoritylevel"?n.dictAttributes.authorityLevel="":t=="user"&&(n.dictAttributes.user="")};n.selectCondition=function(t){n.selectedCondition=t}},templateUrl:"BPM/views/Performer/userTaskPerformersTableData.html"}}]);app.component("bpmEnterReEnterFormDetails",{require:{parent:"^bpmUserTaskAssociationProperties"},bindings:{model:"<",approvalactivity:"<",isenter:"<",extelementmodel:"<",IsDisabledforVersioning:"<isDisabledforVersioning",isObjectbased:"<?"},controller:["$scope","$rootScope","$filter","$EntityIntellisenseFactory","$NavigateToFileService",enterReEnterController],templateUrl:"BPM/views/Association/EnterReEnterFormDetailsTemplate.html"});app.directive("userrolesintellisensetemplate",["$compile","$rootScope",function(n){var t=function(){return"<div class='input-group full-width'><input type='text' ng-disabled='isdisabledforversioning' undoredodirective  model='model' propertyname='propertyname' class='form-control input-sm' title='{{rolename}}' ng-model='rolename' ng-keydown='UserRoleTextChanged($event)'/><span ng-if='!isdisabledforversioning' class='input-group-addon button-intellisense' ng-click='showIntellisenseList($event)'><\/span><\/div>"};return{restrict:"E",replace:!0,scope:{lstuserroles:"=",rolename:"=",isdisabledforversioning:"<",model:"=",propertyname:"="},link:function(i,r){var u=$(r).parent();u.html(t());n(u.contents())(i);i.intellienseList=[];i.intellienseList=i.lstuserroles;SetCodeIDDescriptionToList(i.intellienseList);i.UserRoleTextChanged=function(n){var t=$(n.target);n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")?($(t).autocomplete("search",$(t).val()),n.preventDefault()):setSingleLevelAutoComplete(t,i.intellienseList,i,"CodeID","CodeIDDescription")};i.showIntellisenseList=function(n){var t=$(n.target).prevAll("input[type='text']");setSingleLevelAutoComplete(t,i.lstuserroles,i,"CodeID","CodeIDDescription");$(t).data("ui-autocomplete")&&$(t).autocomplete("search",$(t).val().trim());t.focus();n&&n.stopPropagation()}}}}]);app.directive("bpmncodevaluesbasedontypeintellisense",["$compile","$rootScope",function(n){var i=function(){return"<div class='input-group full-width'><input class='form-control input-sm' type='text' title='{{objconditionmodel.dictAttributes[type]}}' ng-model='objconditionmodel.dictAttributes[type]' ng-show='getBoolValue(false)' ng-keydown='TextChanged($event)'/><span class='input-group-addon button-intellisense' ng-click='showIntellisenseList($event)' ng-show='getBoolValue(false)'><\/span><select class=\"form-control input-sm\" ng-options=\"variable.dictAttributes.id as variable.dictAttributes.id for variable in mapvariablesmodel.Elements\"  ng-show=\"getBoolValue(true)\" title=\"{{objconditionmodel.dictAttributes[type]}}\" ng-model=\"objconditionmodel.dictAttributes[type]\" ><\/select><\/div>"},t=function(n,t){var i="";return t!=undefined&&(data=n.filter(function(n){return n.CodeID.match(t)}),data.length>0&&(i=data[0].CodeIDDescription)),i};return{restrict:"E",replace:!0,scope:{lstbpmnrelatedcodevalues:"=",type:"=",lstuserroles:"=",mapvariablesmodel:"=",objconditionmodel:"="},link:function(r,u){var f=$(u).parent();f.html(i());n(f.contents())(r);r.lst=[];r.type=="role"?(r.lst=r.lstuserroles,r.modelvalue=r.objconditionmodel.dictAttributes.isRoleBasedOnMapVariable!=undefined&&r.objconditionmodel.dictAttributes.isRoleBasedOnMapVariable.toLowerCase()=="true"?r.objconditionmodel.dictAttributes.role:t(r.lst,r.objconditionmodel.dictAttributes.role)):r.type=="skill"?angular.forEach(r.lstbpmnrelatedcodevalues,function(n){n.Name=="SkillList"&&(r.lst=n.lstCodeID,r.modelvalue=r.objconditionmodel.dictAttributes.isSkillBasedOnMapVariable!=undefined&&r.objconditionmodel.dictAttributes.isSkillBasedOnMapVariable.toLowerCase()=="true"?r.objconditionmodel.dictAttributes.skill:t(r.lst,r.objconditionmodel.dictAttributes.skill))}):r.type=="location"?angular.forEach(r.lstbpmnrelatedcodevalues,function(n){n.Name=="LocationList"&&(r.lst=n.lstCodeID,r.modelvalue=r.objconditionmodel.dictAttributes.isLocationBasedOnMapVariable!=undefined&&r.objconditionmodel.dictAttributes.isLocationBasedOnMapVariable.toLowerCase()=="true"?r.objconditionmodel.dictAttributes.location:t(r.lst,r.objconditionmodel.dictAttributes.location))}):r.type=="position"?angular.forEach(r.lstbpmnrelatedcodevalues,function(n){n.Name=="PositionList"&&(r.lst=n.lstCodeID,r.modelvalue=r.objconditionmodel.dictAttributes.isPositionBasedOnMapVariable!=undefined&&r.objconditionmodel.dictAttributes.isPositionBasedOnMapVariable.toLowerCase()=="true"?r.objconditionmodel.dictAttributes.position:t(r.lst,r.objconditionmodel.dictAttributes.position))}):r.type=="authorityLevel"?angular.forEach(r.lstbpmnrelatedcodevalues,function(n){n.Name=="AuthorityLevelList"&&(r.lst=n.lstCodeID,r.modelvalue=r.objconditionmodel.dictAttributes.isAuthorityLevelBasedOnMapVariable!=undefined&&r.objconditionmodel.dictAttributes.isAuthorityLevelBasedOnMapVariable.toLowerCase()=="true"?r.objconditionmodel.dictAttributes.authorityLevel:t(r.lst,r.objconditionmodel.dictAttributes.authorityLevel))}):r.type=="user"&&angular.forEach(r.lstbpmnrelatedcodevalues,function(n){n.Name=="UserIds"&&(r.lst=n.lstCodeID,r.modelvalue=r.objconditionmodel.dictAttributes.isUserBasedOnMapVariable!=undefined&&r.objconditionmodel.dictAttributes.isUserBasedOnMapVariable.toLowerCase()=="true"?r.objconditionmodel.dictAttributes.user:t(r.lst,r.objconditionmodel.dictAttributes.user))});SetCodeIDDescriptionToList(r.lst);r.getBoolValue=function(n){var t;return r.type=="role"?t=r.objconditionmodel.dictAttributes.isRoleBasedOnMapVariable:r.type=="skill"?t=r.objconditionmodel.dictAttributes.isSkillBasedOnMapVariable:r.type=="location"?t=r.objconditionmodel.dictAttributes.isLocationBasedOnMapVariable:r.type=="position"?t=r.objconditionmodel.dictAttributes.isPositionBasedOnMapVariable:r.type=="authorityLevel"?t=r.objconditionmodel.dictAttributes.isAuthorityLevelBasedOnMapVariable:r.type=="user"&&(t=r.objconditionmodel.dictAttributes.isUserBasedOnMapVariable),t!=undefined?t.toLowerCase()!="false"||n?t.toLowerCase()=="true"&&n?!0:!1:!0:n?!1:!0};r.TextChanged=function(n){var t=$(n.target),i;n.key!="Down"&&n.key!="Up"&&n.key!="Left"&&n.key!="Right"&&(n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(t).data("ui-autocomplete")?($(t).autocomplete("search",$(t).val()),n.preventDefault()):(i="CodeID",setSingleLevelAutoCompleteForCodeValues(t,r.lst,r,i,"CodeIDDescription",r.objconditionmodel,r.type)))};r.showIntellisenseList=function(n){var t=$(n.target).prevAll("input[type='text']");setSingleLevelAutoCompleteForCodeValues(t,r.lst,r,"CodeID","CodeIDDescription",r.objconditionmodel,r.type);t.focus();$(t).data("ui-autocomplete")&&$(t).autocomplete("search",$(t).val().trim())}}}}]);app.component("bpmLanePerformersProperties",{bindings:{shapeModel:"<",userRoles:"<",isdisabledforversioning:"<"},templateUrl:"BPM/views/Performer/LanePerformersProperties.html",controller:["$filter",bpmLanePerformersPropertiesController]});app.component("bpmUserTaskPerformersProperties",{bindings:{shapeModel:"<",isdisabledforversioning:"<",targetsitelist:"<",lstBpmnRelatedCodeValues:"<",mapvariablesmodel:"<",userRoles:"<"},templateUrl:"BPM/views/Performer/UserTaskPerformersProperties.html",controller:["$filter","$getQueryparam","$scope","$rootScope",bpmUserTaskPerformersProperties]});app.controller("BpmTerminationController",["$scope","$rootScope","$filter","$getQueryparam","$getMultiIndexofArray","$getEnitityRule","$getEnitityXmlMethods","$cssFunc","$EntityIntellisenseFactory","$NavigateToFileService","$getEnitityObjectMethods","hubcontext",function(n,t,i,r,u,f,e,o,s,h,c){n.bpmModel=null;n.extraSettingsModel=null;n.terminationModel=null;n.terminationMethodModel=null;n.mapVariablesModel=null;n.xmlMethods=[];n.objectMethods=[];n.selectedEntity="";n.selectedVariable="";n.selectedXmlMethod="";n.selectedXmlMethodParameters="";n.selectedObjectMethod="";n.selectedObjectMethodParameters="";n.queryParametersValues=[];n.init=function(){var t,u,i;n.selectedEntity="";n.selectedVariable="";n.selectedXmlMethod="";n.selectedXmlMethodParameters="";n.selectedObjectMethod="";n.selectedObjectMethodParameters="";n.xmlMethods=[];n.objectMethods=[];n.bpmModel=n.getBpmModel();n.mapVariablesModel=n.getMapVariables();n.queryParametersValues=r.getMapVariableIds(n.mapVariablesModel.Elements);n.extraSettingsModel=n.getExtraSettingsModel();n.terminationModel=n.getTerminationModel();n.terminationMethodModel=n.getTerminationMethodModel();n.terminationModel&&n.terminationModel.dictAttributes.sfwEntity&&(n.selectedEntity=n.terminationModel.dictAttributes.sfwEntity,n.onEntityChanged(),n.terminationMethodModel&&(n.terminationMethodModel.dictAttributes.sfwExecuteOnTermination&&(n.selectedObjectMethod=n.terminationMethodModel.dictAttributes.sfwExecuteOnTermination,n.onObjectMethodChanged()),n.terminationMethodModel.dictAttributes.sfwNavigationParameter&&(n.selectedObjectMethodParameters=n.terminationMethodModel.dictAttributes.sfwNavigationParameter)),t=n.terminationModel.Elements.filter(function(n){return n.Name&&n.Name.toLowerCase()==="failoverbusinessobject"})[0],u=null,t&&t.dictAttributes.variable&&n.isVariablePresent(t.dictAttributes.variable,n.terminationModel.dictAttributes.sfwEntity)?(n.selectedVariable=t.dictAttributes.variable,n.onVariableChanged(),u=t.Elements.filter(function(n){return n.Name&&n.Name.toLowerCase()==="initialize"})[0]):u=n.terminationModel.Elements.filter(function(n){return n.Name&&n.Name.toLowerCase()==="initialize"})[0],u&&(i=u.Elements.filter(function(n){return n.Name&&n.Name.toLowerCase()==="xmlmethod"})[0],i&&(i.dictAttributes.ID&&(n.selectedXmlMethod=i.dictAttributes.ID,n.onXmlMethodChanged()),i.dictAttributes.sfwNavigationParameter&&(n.selectedXmlMethodParameters=i.dictAttributes.sfwNavigationParameter))))};n.isVariablePresent=function(t,i){var r=!1;return t&&i&&n.mapVariablesModel&&(r=n.mapVariablesModel.Elements.some(function(n){return n.dictAttributes.id===t&&n.dictAttributes.sfwEntity===i})),r};n.getBpmModel=function(){for(var t=n.$parent,i=null;!i&&t;)i=t.BPMNModel,t=t.$parent;return i};n.getExtraSettingsModel=function(){var t=null;return n.bpmModel&&(t=n.bpmModel.ExtensionElementsModel.Elements.filter(function(n){return n.Name&&n.Name.toLowerCase()==="extrasettings"})[0]),t};n.getTerminationModel=function(){var t=null;return n.extraSettingsModel&&(t=n.extraSettingsModel.Elements.filter(function(n){return n.Name&&n.Name.toLowerCase()==="termination"})[0]),t};n.getTerminationMethodModel=function(){var t=null;return n.terminationModel&&(t=n.terminationModel.Elements.filter(function(n){return n.Name&&n.Name.toLowerCase()==="terminationmethod"})[0]),t};n.getMapVariables=function(){return n.bpmModel?n.bpmModel.ExtensionElementsModel.Elements.filter(function(n){return n.Name&&n.Name.toLowerCase()==="mapvariables"})[0]:null};n.onEntityChanged=function(){n.clearEntityDependents();n.selectedEntity&&(n.getXmlMethods(),n.getObjectMethods())};n.clearEntityDependents=function(){n.xmlMethods=[];n.objectMethods=[];n.selectedObjectMethod="";n.selectedObjectMethodParameters="";n.selectedVariable="";n.selectedXmlMethod="";n.selectedXmlMethodParameters=""};n.showVariablesByEntity=function(){return function(t){var i=!1;return n.selectedEntity&&n.selectedEntity.trim().length>0&&(i=t.dictAttributes.sfwEntity===n.selectedEntity),i}};n.onVariableChanged=function(){};n.getXmlMethods=function(){n.xmlMethods=e.get(n.selectedEntity.trim())};n.onXmlMethodChanged=function(){n.getXmlMethodParameters()};n.getXmlMethodParameters=function(){var t,r;if(n.selectedXmlMethod){if(t=i("filter")(n.xmlMethods,{ID:n.selectedXmlMethod},!0)[0],t){r=[];function u(n){this.push(n.ID+"="+(n.Value?n.Value:""))}angular.forEach(t.Parameters,u,r);n.selectedXmlMethodParameters=r.join(",")}}else n.selectedXmlMethodParameters=""};n.setXmlMethodParameters=function(){var u=n.$new(!0);u.DialogConstants={queryParamsName:"selectedXmlMethodParameters"};u.mapObj={};u.queryValues=n.queryParametersValues;u.queryParameters=r.getQueryparamfromString(n,"selectedXmlMethodParameters",",");u.QueryDialog=t.showDialog(u,"Set Xml Method Parameters","Common/views/SetQueryParameters.html",{width:500,height:500});u.setQueryParameters=function(){function i(n){this.push(n.ID+"="+(n.Value?n.Value:""))}var t=[];angular.forEach(u.queryParameters,i,t);n.selectedXmlMethodParameters=t.join(",");u.QueryDialog.close()};u.onRefreshParams=function(){var h=e.get(n.selectedEntity),s,c,f,r,o;if(h.length>0&&(s=i("filter")(h,{ID:n.selectedXmlMethod},!0),s&&s.length>0)){c=s[0];f=u.queryParameters;u.queryParameters=[];function l(n){var i=new objElements;i.Name="parameter";i.ID=n.ID;i.Value=n.Value;u.queryParameters.length>0&&!u.queryParameters.some(function(t){return t.dictAttributes.ID==n.ID})&&t.PushItem(i,u.queryParameters);u.queryParameters.length==0&&t.PushItem(i,u.queryParameters)}for(angular.forEach(c.Parameters,l,u.queryParameters),r=0;r<f.length;r++)f[r]&&f[r]&&f[r].ID&&(o=u.queryParameters.filter(function(n){return n.ID==f[r].ID}),o&&o.length>0&&f[r].Value&&t.EditPropertyValue(o[0].Value,o[0],"Value",f[r].Value))}}};n.getObjectMethods=function(){n.objectMethods=c.get(n.selectedEntity.trim())};n.onObjectMethodChanged=function(){n.getObjectMethodParameters()};n.getObjectMethodParameters=function(){var t,r;if(n.selectedObjectMethod){if(t=i("filter")(n.objectMethods,{ID:n.selectedObjectMethod},!0)[0],t){r=[];function u(n){this.push(n.ID+"="+(n.Value?n.Value:""))}angular.forEach(t.Parameters,u,r);n.selectedObjectMethodParameters=r.join(",")}}else n.selectedObjectMethodParameters=""};n.setObjectMethodParameters=function(){var u=n.$new(!0);u.DialogConstants={queryParamsName:"selectedObjectMethodParameters"};u.mapObj={};u.queryValues=n.queryParametersValues;u.queryParameters=r.getQueryparamfromString(n,"selectedObjectMethodParameters",",");u.QueryDialog=t.showDialog(u,"Set Object Method Parameters","Common/views/SetQueryParameters.html",{width:500,height:500});u.setQueryParameters=function(){function i(n){this.push(n.ID+"="+(n.Value?n.Value:""))}var t=[];angular.forEach(u.queryParameters,i,t);n.selectedObjectMethodParameters=t.join(",");u.QueryDialog.close()};u.onRefreshParams=function(){var s=c.get(n.selectedEntity),o,f,r,e;if(s.length>0&&(o=i("filter")(s,{ID:n.selectedObjectMethod},!0)[0],o)){f=u.queryParameters;u.queryParameters=[];function h(n){var i=new objElements;i.Name="parameter";i.ID=n.ID;i.Value=n.Value;u.queryParameters.length>0&&!u.queryParameters.some(function(t){return t.dictAttributes.ID==n.ID})&&t.PushItem(i,u.queryParameters);u.queryParameters.length==0&&t.PushItem(i,u.queryParameters)}for(angular.forEach(o.Parameters,h,u.queryParameters),r=0;r<f.length;r++)f[r]&&f[r]&&f[r].ID&&(e=u.queryParameters.filter(function(n){return n.ID==f[r].ID}),e&&e.length>0&&f[r].Value&&t.EditPropertyValue(e[0].Value,e[0],"Value",f[r].Value))}}};n.updateBpmModel=function(){var i=null,r,u,f,e,o,s;n.selectedEntity&&(i={Name:"termination",dictAttributes:{},Elements:[]},r={Name:"TerminationMethod",dictAttributes:{ObjectType:"ObjectMethod"},Elements:[]},i.Elements.push(r),i.dictAttributes.sfwEntity=n.selectedEntity,n.selectedObjectMethod&&(r.dictAttributes.sfwExecuteOnTermination=n.selectedObjectMethod,n.selectedObjectMethodParameters&&(r.dictAttributes.sfwNavigationParameter=n.selectedObjectMethodParameters)),u={Name:"initialize",dictAttributes:{ObjectType:"XmlMethod"},Elements:[]},f={Name:"XmlMethod",dictAttributes:{},Elements:[]},u.Elements.push(f),n.selectedXmlMethod&&(f.dictAttributes.ID=n.selectedXmlMethod,n.selectedXmlMethodParameters&&(f.dictAttributes.sfwNavigationParameter=n.selectedXmlMethodParameters)),n.selectedVariable?(e={Name:"FailOverBusinessObject",dictAttributes:{},Elements:[]},e.dictAttributes.variable=n.selectedVariable,e.Elements.push(u),i.Elements.push(e)):i.Elements.push(u));!n.extraSettingsModel&&i&&(n.extraSettingsModel={Name:"extraSettings",dictAttributes:{},Elements:[]},n.mapVariablesModel?(o=n.bpmModel.ExtensionElementsModel.Elements.indexOf(n.mapVariablesModel),o>-1?t.InsertItem(n.extraSettingsModel,n.bpmModel.ExtensionElementsModel.Elements,o):t.PushItem(n.extraSettingsModel,n.bpmModel.ExtensionElementsModel.Elements)):t.PushItem(n.extraSettingsModel,n.bpmModel.ExtensionElementsModel.Elements));n.terminationModel?(s=n.extraSettingsModel.Elements.indexOf(n.terminationModel),s>-1?(i&&t.InsertItem(i,n.extraSettingsModel.Elements,s),t.DeleteItem(n.terminationModel,n.extraSettingsModel.Elements)):i&&t.PushItem(i,n.extraSettingsModel.Elements)):i&&t.PushItem(i,n.extraSettingsModel.Elements)};n.$on("UpdateBpmTerminate",function(){n.updateBpmModel()});n.init()}]);