function expandCollapseConstants(n){var i=n.target,t=$(i).parents("table");t.length>0&&$(t[0]).siblings("ul").slideToggle()}app.controller("ConstantsController",["$scope","$filter","$rootScope","$timeout","$resourceFactory","CONSTANTS","$ValidationService","$Errors","$EntityIntellisenseFactory",function(n,t,i,r,u,f,e,o,s){var a,c,v,l,h,y;n.Groups=[];n.lstColumnNames=[];n.EntityQueryCollection=[];n.FilesCollection=[];n.IsFilesLoaded=!1;n.IsEntityQueriesLoaded=!1;n.parentGroupObj=null;n.currentfile=i.currentopenfile.file;n.IsBaseAppFile=n.currentfile&&n.currentfile.IsBaseAppFile;n.lstFilesCollection=[];n.CreateDuplicateModel=function(t){var r,i;if(t)for(r={Children:t.Children,dictAttributes:t.dictAttributes,Elements:[],IsExpanded:!1,isSelected:!1,IsValueInCDATAFormat:t.IsValueInCDATAFormat,Name:t.Name,objExtraData:t.objExtraData,prefix:t.prefix,Value:t.Value,IsBaseAppModel:t.IsBaseAppModel,BaseAppModel:t.BaseAppModel},i=0;i<t.Elements.length;i++)r.Elements.push(n.CreateDuplicateModel(t.Elements[i]));return r};a=angular.copy(u.getConstantModelData());n.constantfilemodel=n.CreateDuplicateModel(a);n.entityQueryGroup=n.constantfilemodel.Elements.filter(function(n){return n.Name==="groups"&&n.dictAttributes.GroupType==="EntityGroup"})[0];n.getconstants=function(t){n.objDummyConstants=t;n.objDummyConstants!=undefined&&(n.Groups=[],n.objDummyConstants.IsExpanded=!0,n.Groups.push(n.objDummyConstants),n.SelectedConstant=n.objDummyConstants,h(),n.PopulateDataTypes(),ComponentsPickers.init())};n.showSource=!1;n.selectedDesignSource=!1;n.ShowDesign=function(){var t,r,o,e;if(n.selectedDesignSource==!0&&(t=n.editor.getValue(),t!=null&&t!=""))if(i.IsLoading=!0,r=n.editor.selection.getCursor().row,r=r+1,t.length<32e3)hubMain.server.getDesignXmlString(t,i.currentopenfile.file,r);else{o=[];o[0]=r>0?r:1;var u="",s=[],f=0;for(e=0;e<t.length;e++)f++,u=u+t[e],f==32e3&&(f=0,s.push(u),u="");f!=0&&s.push(u);c(s,i.currentopenfile.file,"Source-Design",o)}};n.receivedesignxmlobject=function(t,f){n.selectedDesignSource=!1;n.isSourceDirty&&(n.constantfilemodel=t,n.getconstants(n.constantfilemodel),u.setConstantsList(n.constantfilemodel),n.isSourceDirty=!1);n.$evalAsync(function(){var r,u,t;if(i.IsLoading=!1,f!=null&&f!=""){if(r=[],f.contains("-")||f.contains(","))for(u=n.objDummyConstants,t=0;t<f.split(",").length;t++)u=n.FindNodeHierarchy(u,f.split(",")[t].substring(f.split(",")[t].lastIndexOf("-")+1)),r.push(u);if(r.length>1)for(t=0;t<r.length;t++)r[t].Name=="groups"&&(r[t].IsExpanded=!0),t==0&&n.SelectConstantClick(r[r.length-1],window.event);else r.length==1&&n.SelectConstantClick(r[0],window.event)}});n.$evalAsync(function(){i.IsLoading=!1});r(function(){var n=$("#"+i.currentopenfile.file.FileName).find(".constant-tree-view .selected");n&&$(".constant-tree-view").scrollTo(n,null,null)})};n.selectElement=function(t){n.receivedesignxmlobject(n.constantfilemodel,t)};n.isSourceDirty;n.sourceChanged=function(){n.isSourceDirty=!0;n.isDirty=!0;n.SearchSource.IsSearchCriteriaChange=!0};c=function(n,t,i,r){for(var u=0;u<n.length;u++)hubMain.server.receiveDataPackets(n[u],n.length,t,u,i,r)};n.ShowSource=function(){var a,h,l,o,f;if(n.selectedDesignSource==!1&&(n.selectedDesignSource=!0,h=[],n.objDummyConstants!=null&&n.objDummyConstants!=undefined)){i.IsLoading=!0;var v=GetBaseModel(n.objDummyConstants),r=JSON.stringify(v),e=[];if(n.objDummyConstants&&n.SelectedConstant&&(o=[],a=n.FindDeepNode(n.objDummyConstants,n.SelectedConstant,o),l=n.getPathSource(n.objDummyConstants,o,h),angular.copy(l,e)),r.length<32e3)hubMain.server.getSourceXmlObject(r,i.currentopenfile.file,e);else{var t="",s=[],u=0;for(f=0;f<r.length;f++)u++,t=t+r[f],u==32e3&&(u=0,s.push(t),t="");u!=0&&s.push(t);c(s,i.currentopenfile.file,"Design-Source",e)}n.receivesourcexml=function(t,r){n.$apply(function(){setDataToEditor(n,t,r,"constants");n.$evalAsync(function(){i.IsLoading=!1});window.navigator.userAgent.toLowerCase().contains("chrome")&&n.$evalAsync(function(){i.IsLoading=!1})})}}};n.FindNodeHierarchy=function(n,t){if(n&&n.Elements){var i=n.Elements[t];return i==undefined&&(i=n.Elements[t-1]),i}};n.FindDeepNode=function(t,i,r){return t&&angular.forEach(t.Elements,function(t){var u=n.isValidObject(t,i);return(u&&r.push(t),t==i)?i:t.Elements&&t.Elements.length>0?i=n.FindDeepNode(t,i,r):void 0}),i};n.getPathSource=function(n,t,i){for(var u,r=0;r<t.length;r++)r==0?(u=n.Elements.indexOf(t[r]),i.push(u)):(u=t[r-1].Elements.indexOf(t[r]),i.push(u));return i};n.isValidObject=function(t,i){var u,r;if(t==i)return!0;for(r in t.Elements){if(t.Elements[r]==i)return!0;if(t.Elements[r].Elements&&t.Elements[r].Elements.length>0)for(iele in t.Elements[r].Elements)if(u=n.isValidObject(t.Elements[r].Elements[iele],i),u==!0)return u}return u};n.updateEntitySelection=function(t){var r,u;if(n.entityQueryGroup)for(r=0;r<n.EntityQueryCollection.length;r++)u=n.entityQueryGroup.Elements.some(function(t){return t.dictAttributes.ID===n.EntityQueryCollection[r].Name}),t?i.EditPropertyValue(n.EntityQueryCollection[r].IsRuleSelected,n.EntityQueryCollection[r],"IsRuleSelected",u):n.EntityQueryCollection[r].IsRuleSelected=u};n.LoadEntityQueries=function(t){for(var f,e,i,o,l,u,h,a,p,v=function(n,t){return n.ID<t.ID?-1:n.ID>t.ID?1:0},c=s.getEntityIntellisense().sort(v),y=n.EntityQueryCollection.filter(function(n){return!c.some(function(t){return n.Name===t.ID})}),r=0;r<y.length;r++)u=n.EntityQueryCollection.indexOf(y[r]),u>-1&&n.EntityQueryCollection.splice(u,1);for(f=0;f<c.length;f++){for(e=c[f],i=n.EntityQueryCollection.filter(function(n){return n.Name===e.ID})[0],i||(i={Name:e.ID,IsRuleSelected:!1,Childs:[]},n.EntityQueryCollection.push(i)),o=e.Queries.sort(v),l=i.Childs.filter(function(n){return!o.some(function(t){return n.Name===t.ID})}),r=0;r<l.length;r++)u=i.Childs.indexOf(l[r]),u>-1&&i.Childs.splice(u,1);for(h=0;h<o.length;h++)a=o[h],i.Childs.some(function(n){return n.Name===a.ID})||(p={Name:a.ID,IsRuleSelected:!1,Childs:[]},i.Childs.push(p))}t&&n.updateEntitySelection()};n.LoadFilesList=function(){$.connection.hubConstants.server.getFilesList().done(function(t){n.$apply(function(){var r,i;for(n.FilesCollection=t,r=0,i=0;i<n.FilesCollection.length;i++)if(r++,r==100)break;else n.lstFilesCollection.push(n.FilesCollection[i]);n.IsFilesLoaded=!0})})};n.BeforeSaveToFile=function(){var t=n.CreateDuplicateModel(n.objDummyConstants);angular.copy(t,u.getConstantModelData())};n.PopulateDataTypes=function(){n.DataTypes=[];n.DataTypes.push("string");n.DataTypes.push("bool");n.DataTypes.push("decimal");n.DataTypes.push("double");n.DataTypes.push("float");n.DataTypes.push("int");n.DataTypes.push("long");n.DataTypes.push("short")};n.LoadParentForObject=function(n,t){h();n!=undefined&&(t.ParentGroupType=n.dictAttributes.GroupType,t.ParentVM=n,t.Name=="constant"&&(t.IsShowEffectiveDate=!0,t.ParentGroupType=="Query"||t.ParentGroupType=="Files"||t.ParentGroupType=="Entity"?t.IsShowEffectiveDate=!1:n.dictAttributes.IsChildGroup=="True"?t.IsShowEffectiveDate=!1:(n.ParentGroupType=="Query"||n.ParentGroupType=="Files"||n.ParentGroupType=="EntityQueries")&&(t.IsShowEffectiveDate=!1)));r(function(){ComponentsPickers.init()})};n.SelectConstantClick=function(t,i){n.SelectedConstant=t;h();n.objParentGroup=n.GetParent(t,n.constantfilemodel);n.SelectedConstant.dictAttributes.GroupType==="EntityGroup"&&n.updateEntitySelection();i&&i.stopPropagation()};n.SetConstantClass=function(n,t){if(n==t)return"selectedconstant"};n.AddEffectiveDateClick=function(){if(n.SelectedConstant!=undefined)n.currentSelectedRow(undefined),i.PushItem({Name:"item",dictAttributes:{Value:""},Elements:[],isSelected:!0},n.SelectedConstant.Elements),n.SelectedEffectiveDate=n.SelectedConstant.Elements[n.SelectedConstant.Elements.length-1],r(function(){ComponentsPickers.init()}),n.validateDataType(n.SelectedEffectiveDate,n.SelectedConstant.dictAttributes.sfwDataType)};n.DeleteEffectiveDateClick=function(){if(n.SelectedConstant!=undefined&&n.SelectedEffectiveDate&&n.SelectedConstant.Elements.length>0){var t=n.SelectedConstant.Elements.indexOf(n.SelectedEffectiveDate);i.DeleteItem(n.SelectedEffectiveDate,n.SelectedConstant.Elements,"");e.removeObjInToArray(n.validationErrorList,n.SelectedEffectiveDate);t<n.SelectedConstant.Elements.length?n.currentSelectedRow(n.SelectedConstant.Elements[t]):n.SelectedConstant.Elements.length>0&&n.currentSelectedRow(n.SelectedConstant.Elements[t-1])}else toastr.info("Please Select the Effective Date.")};n.currentSelectedRow=function(t){angular.forEach(n.SelectedConstant.Elements,function(n){n.isSelected=!1});t&&(t.isSelected=!0,n.SelectedEffectiveDate=t)};n.ExpandCollapsedConstant=function(n){n.IsExpanded=!n.IsExpanded};n.expandByFind=function(n){for(var t=0;t<n.length;t++)n[t].Name!="constant"&&(n[t].IsExpanded=!0)};n.ResetGroupQueryDetail=function(t){t.indexOf(n.SelectedConstant.dictAttributes.QueryFieldID)===-1&&(n.SelectedConstant.dictAttributes.QueryFieldID="");t.indexOf(n.SelectedConstant.dictAttributes.QueryFieldValue)===-1&&(n.SelectedConstant.dictAttributes.QueryFieldValue="");t.indexOf(n.SelectedConstant.dictAttributes.QueryFieldDescription)===-1&&(n.SelectedConstant.dictAttributes.QueryFieldDescription="");t.indexOf(n.SelectedConstant.dictAttributes.ClassName)===-1&&(n.SelectedConstant.dictAttributes.ClassName="")};n.GetQuerySchemaClick=function(){$.connection.hubConstants.server.getQuerySchema(n.SelectedConstant.dictAttributes.sfwQuery).done(function(t){n.$apply(function(){t?(n.ResetGroupQueryDetail(t),n.lstColumnNames=t):alert("Function getQuerySchema didnot return data.")})})};n.onQueryFieldKeyDown=function(t){var i=t.currentTarget;t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&(n.lstColumnNames&&n.lstColumnNames.length>0&&$(i).autocomplete("search",$(i).val().trim()),t.preventDefault());n.lstColumnNames&&n.lstColumnNames.length>0&&t.key!="Down"&&t.key!="Up"&&t.key!="Left"&&t.key!="Right"&&setSingleLevelAutoComplete($(i),n.lstColumnNames);n.lstColumnNames&&n.lstColumnNames.length==0&&setSingleLevelAutoComplete($(i),n.lstColumnNames)};n.showQueryList=function(t){var i=$(t.target).prevAll("input[type='text']");i.focus();n.lstColumnNames&&n.lstColumnNames.length>0&&(setSingleLevelAutoComplete($(i),n.lstColumnNames),$(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val().trim()));t&&t.stopPropagation()};n.CanContainsValue=function(t){var i;return n.lstColumnNames.filter(function(n){n==t&&(i=n)}),i!=undefined?!0:!1};n.ValidateData=function(){var i=!0,t;return n.SelectedConstant.dictAttributes.sfwQuery!=undefined&&n.SelectedConstant.dictAttributes.sfwQuery!=""&&(t="",n.SelectedConstant.dictAttributes.QueryFieldID==undefined||n.SelectedConstant.dictAttributes.QueryFieldID==""?(i=!1,t="Enter the ID Field Name."):n.CanContainsValue(n.SelectedConstant.dictAttributes.QueryFieldID)?n.SelectedConstant.dictAttributes.QueryFieldValue==undefined||n.SelectedConstant.dictAttributes.QueryFieldValue==""?(i=!1,t="Enter the Value Field Name."):n.CanContainsValue(n.SelectedConstant.dictAttributes.QueryFieldValue)?n.SelectedConstant.dictAttributes.QueryFieldDescription==undefined||n.SelectedConstant.dictAttributes.QueryFieldDescription==""||n.CanContainsValue(n.SelectedConstant.dictAttributes.QueryFieldDescription)?n.SelectedConstant.dictAttributes.ClassName==undefined||n.SelectedConstant.dictAttributes.ClassName==""||n.CanContainsValue(n.SelectedConstant.dictAttributes.ClassName)||(i=!1,t="Invalid ClassName Field Name."):(i=!1,t="Invalid Description Field Name."):(i=!1,t="Invalid Value Field Name."):(i=!1,t="Invalid ID Field Name."),t!=undefined&&t!=""&&alert(t)),i};n.ImportQueryClick=function(){!n.SelectedConstant!=undefined&&n.ValidateData()&&(i.IsLoading=!0,$.connection.hubConstants.server.importQueryInConstant(n.SelectedConstant.dictAttributes.sfwQuery,n.SelectedConstant.dictAttributes.ClassName,n.SelectedConstant.dictAttributes.QueryFieldValue,n.SelectedConstant.dictAttributes.QueryFieldID,n.SelectedConstant.dictAttributes.QueryFieldDescription).done(function(t){n.$apply(function(){if(t){if(i.UndRedoBulkOp("Start"),!n.IsBaseAppFile)while(n.SelectedConstant.Elements.length>0)i.DeleteItem(n.SelectedConstant.Elements[0],n.SelectedConstant.Elements);var r=t;angular.forEach(r,function(t){n.SelectedConstant.Elements.some(function(n){return t.dictAttributes.ID===n.dictAttributes.ID})||i.PushItem(t,n.SelectedConstant.Elements)});i.UndRedoBulkOp("End")}else alert("Function importQueryInConstant didnot return data.");i.IsLoading=!1})}))};n.ImportFilesClick=function(){i.UndRedoBulkOp("Start");n.OnClearItemClick();n.lstFilesCollection.length>0&&angular.forEach(n.lstFilesCollection,function(t){if(t.IsRuleSelected){var r={Name:"constant",Value:"",dictAttributes:{ID:t.Name,Value:t.Name,sfwDataType:"string"},Elements:[]};i.PushItem(r,n.SelectedConstant.Elements);r.ParentGroupType=n.SelectedConstant.dictAttributes.GroupType;t.IsRuleSelected=!1}});i.UndRedoBulkOp("End")};n.SelectAllFilesClick=function(t){t?n.FilesCollection.length>0&&angular.forEach(n.FilesCollection,function(n){n.IsRuleSelected=!0}):n.FilesCollection.length>0&&angular.forEach(n.FilesCollection,function(n){n.IsRuleSelected=!1})};n.ImportEntityQueryClick=function(){i.UndRedoBulkOp("Start");n.OnClearItemClick();n.EntityQueryCollection.length>0&&angular.forEach(n.EntityQueryCollection,function(t){var r,u;t.IsRuleSelected?(r={Name:"groups",Value:"",dictAttributes:{ID:t.Name,GroupType:"Manual"},Elements:[]},n.AddSelectedEntityQueries(t.Childs,r),r.Elements.length>0&&i.PushItem(r,n.SelectedConstant.Elements),t.IsRuleSelected=!1):t.Childs.length>0&&(r={Name:"groups",Value:"",dictAttributes:{ID:t.Name,GroupType:"Manual"},Elements:[]},u=[],angular.forEach(t.Childs,function(n){n.IsRuleSelected&&(i.PushItem(n,u),n.IsRuleSelected=!1)}),u.length>0&&(n.AddSelectedEntityQueries(u,r),i.PushItem(r,n.SelectedConstant.Elements)))});i.UndRedoBulkOp("End")};n.AddSelectedEntityQueries=function(t,r){angular.forEach(t,function(t){var u={Name:"constant",Value:"",dictAttributes:{ID:t.Name,Value:t.Name,sfwDataType:"string"},Elements:[]};i.PushItem(u,r.Elements);u.ParentGroupType=n.SelectedConstant.dictAttributes.GroupType})};n.OnClearItemClick=function(){if(n.SelectedConstant){for(n.SelectedConstant.dictAttributes&&(i.EditPropertyValue(n.SelectedConstant.dictAttributes.ClassName,n.SelectedConstant.dictAttributes,"ClassName",""),i.EditPropertyValue(n.SelectedConstant.dictAttributes.sfwQuery,n.SelectedConstant.dictAttributes,"sfwQuery",""),i.EditPropertyValue(n.SelectedConstant.dictAttributes.QueryFieldID,n.SelectedConstant.dictAttributes,"QueryFieldID",""),i.EditPropertyValue(n.SelectedConstant.dictAttributes.QueryFieldValue,n.SelectedConstant.dictAttributes,"QueryFieldValue",""),i.EditPropertyValue(n.SelectedConstant.dictAttributes.QueryFieldDescription,n.SelectedConstant.dictAttributes,"QueryFieldDescription",""),n.lstColumnNames=[]);n.SelectedConstant.Elements.length>0;)i.DeleteItem(n.SelectedConstant.Elements[0],n.SelectedConstant.Elements);n.SelectedConstant.dictAttributes.GroupType==="EntityGroup"&&n.updateEntitySelection(!0)}};n.parentList=[];n.GetParent=function(t,i){var r;return i&&angular.forEach(i.Elements,function(u){if(r==undefined){if(u.dictAttributes.ID==t.dictAttributes.ID&&u.Name==t.Name&&u==t){r=i;n.parentList.push(r);return}if(r=n.GetParent(t,u),n.parentList.push(r),r!=undefined)return}}),r};n.OpenAddWindow=function(t,u){var f=n.$new(),s="",e,o;f.Type=t;s=t=="groups"?"Group":t==="entitygroup"?"Entity Query Group":"Constant";f.Parent=u;f.templateName="Constants/views/AddConstantTemplate.html";f.objConstant={Name:f.Type,Value:"",dictAttributes:{},Elements:[],ParentVM:u};n.checkConstantName(f.objConstant.dictAttributes.ID,f.Parent);f.OnOkClick=function(){f.Type=="groups"&&(f.objConstant.dictAttributes.GroupType="Manual");f.objConstant!=undefined&&(f.objConstant.dictAttributes.ID!=undefined||f.objConstant.dictAttributes.ID!="")&&(i.PushItem(f.objConstant,f.Parent.Elements),f.Parent.IsExpanded||(f.Parent.IsExpanded=!0),n.SelectConstantClick(f.objConstant,window.event),n.SelectedConstant.IsShowEffectiveDate=!0,h(),r(function(){var n=$("#"+i.currentopenfile.file.FileName).find(".constant-tree-view .selected");n&&$(".constant-tree-view").scrollTo(n,null,null)}));n.validateConstants(n.SelectedConstant.ParentVM,!1,n.SelectedConstant.ParentVM,n.SelectedConstant.ParentVM);f.OnCancelClick()};f.OnCancelClick=function(){n.ErrorMessage="";n.IsError=!1;f.dialog&&f.dialog.close()};t==="entitygroup"?(e=!0,o=f.Parent.Elements.filter(function(n){return n.Name==="groups"&&n.dictAttributes.ID==="Query"})[0],o&&(confirm("Already a group name 'Query' exists, do you want to override it?")?i.DeleteItem(o,f.Parent.Elements):e=!1),e&&(f.objConstant.dictAttributes.ID="Query",f.objConstant.Name="groups",f.objConstant.dictAttributes.GroupType="EntityGroup",n.entityQueryGroup=f.objConstant,f.OnOkClick())):f.templateName&&f.templateName.trim().length>0&&(f.dialog=i.showDialog(f,"Add "+s,f.templateName,{height:200,width:400}))};n.checkConstantName=function(t,i){return n.ErrorMessage="",n.IsError=!1,t?isValidIdentifier(t,!1,!1)?i.ParentVM&&i.ParentVM.Elements&&i.ParentVM.Elements.filter(function(r){r.dictAttributes.ID&&t&&r.dictAttributes.ID.toLowerCase()==t.toLowerCase()&&r!=i&&(n.IsError=!0,n.ErrorMessage="Error:Duplicate ID.");i.ParentVM.dictAttributes.ID&&t&&i.ParentVM.dictAttributes.ID.toLowerCase()==t.toLowerCase()&&r!=i.ParentVM&&(n.IsError=!0,n.ErrorMessage="Error:Duplicate ID.")}):(n.IsError=!0,n.ErrorMessage="Error:Invalid ID."):(n.IsError=!0,n.ErrorMessage="Error:ID can not be empty."),n.IsError};n.menuOptionsForConstant=[["Add Entity Queries Group",function(t){n.OpenAddWindow("entitygroup",t.itm)},function(t){return t.itm===n.constantfilemodel&&!t.itm.Elements.some(function(n){return n.Name==="groups"&&n.dictAttributes.GroupType==="EntityGroup"})?!0:!1}],null,["Add Groups",function(t){n.OpenAddWindow("groups",t.itm)},function(t){var i=n.GetParent(t.itm,n.constantfilemodel);return(i&&n.LoadParentForObject(i,t.itm),n.SelectConstantClick(t.itm),t.itm.Name=="groups"&&t.itm.dictAttributes.GroupType=="Manual")?t.itm.ParentGroupType==undefined||t.itm.ParentGroupType=="Manual"?!0:!1:!1}],null,["Add Constant",function(t){n.OpenAddWindow("constant",t.itm)},function(n){return n.itm.Name=="constant"?!1:n.itm.Name=="groups"&&n.itm.dictAttributes.GroupType=="Manual"?n.itm.dictAttributes.IsChildGroup=="True"?!1:n.itm.ParentGroupType==undefined||n.itm.ParentGroupType=="Manual"?!0:!1:void 0}],null,["Delete",function(t){var r=n.GetParent(t.itm,n.objDummyConstants),u;r!=undefined&&(u=r.Elements.indexOf(t.itm),i.DeleteItem(t.itm,r.Elements),n.removeInvalidObject(t.itm),e.removeObjInToArray(n.validationErrorList,t.itm),u<r.Elements.length?(n.SelectedConstant=r.Elements[u],n.LoadParentForObject(r,n.SelectedConstant),n.SelectConstantClick(n.SelectedConstant)):r.Elements.length>0&&(n.SelectedConstant=r.Elements[u-1],n.LoadParentForObject(r,n.SelectedConstant),n.SelectConstantClick(n.SelectedConstant)))},function(t){if(t.itm.IsBaseAppModel||t.itm.BaseAppModel)return!1;var i=n.GetParent(t.itm,n.objDummyConstants);return t.itm.Name=="constant"?t.itm.ParentGroupType=="Query"||t.itm.ParentGroupType=="Files"||t.itm.ParentGroupType=="EntityQueries"?!1:i!=undefined&&i.dictAttributes.IsChildGroup!=undefined&&i.dictAttributes.IsChildGroup.toLowerCase()=="true"?!1:!0:t.itm.Name==="groups"?i==undefined?!1:t.itm.dictAttributes.IsChildGroup=="True"?!1:i!=undefined&&(i.dictAttributes.GroupType=="Files"||i.dictAttributes.GroupType=="EntityQueries")?!1:!0:void 0}],null,["Clear",function(){i.UndRedoBulkOp("Start");n.OnClearItemClick();n.validateFileData(!1,null);i.UndRedoBulkOp("End")},function(t){if(t.itm.IsBaseAppModel||t.itm.BaseAppModel)return!1;var i=n.GetParent(t.itm,n.objDummyConstants);if(t.itm.Name=="groups")return t.itm.dictAttributes.IsChildGroup=="True"?!1:t.itm.Elements.length==0?!1:i!=undefined&&(i.dictAttributes.GroupType=="Files"||i.dictAttributes.GroupType=="EntityQueries")?!1:!0}],null,["Revert",function(t){n.revertToBaseAppModel(t.itm)},function(n){return!n.itm.IsBaseAppModel&&n.itm.BaseAppModel}],null];n.removeInvalidObject=function(t){t&&t.Elements.length>0&&angular.forEach(t.Elements,function(t){e.removeObjInToArray(n.validationErrorList,t);t&&angular.isArray(t.Elements)&&t.Elements.length>0&&n.removeInvalidObject(t)})};n.GroupTypeChangeClick=function(){n.SelectedConstant!=undefined&&n.SelectedConstant.dictAttributes.GroupType=="Manual"&&(i.UndRedoBulkOp("Start"),n.OnClearItemClick(),i.UndRedoBulkOp("End"))};n.onRefreshAllGroups=function(){n.isDirty?toastr.info("Please hit Save before refresh."):($.connection.hubConstants.server.onRefreshAllGroups(),i.IsLoading=!0)};n.receieveConstantsAfterRefresh=function(t,r){var o,u,f,e;for(n.setValidationList(),n.isDirty=!0,o=JSON.parse(t),u="",f=0;f<r.length;f++)u+=f+1+") "+r[f]+"\n";u!=""&&u&&(e=n.$new(),e.strMessage=u,e.isError=!0,dialog=i.showDialog(e,"","StartUp/views/TFSMessageDialog.html"),e.OkClick=function(){dialog.close()});n.getconstants(o);n.constantfilemodel=o;n.$evalAsync(function(){i.IsLoading=!1})};n.CountofConstants=0;n.ConstantSearchID="";v="";n.onEnterKeySearch=function(t){t.which==13&&n.FindConstants(n.ConstantSearchID)};n.onTextChangeinConstant=function(){h();n.lstConstants=[];n.CountofConstants=0};n.lstConstants=[];n.currentGroup;n.FindConstants=function(t){if(n.ConstantSearchID&&t){n.CountofConstants=0;n.newParentList={};for(var i=0;i<n.Groups.length;i++)n.currentGroup=i,n.SearchConstantsWithID(n.Groups[i],t);n.FindNextConstant()}};n.newParentList={};n.currentPath=[];n.SearchConstantsWithID=function(t,i){for(var u,r=0;r<t.Elements.length;r++)t.Elements[r].dictAttributes.ID!=undefined&&((t.Elements[r].dictAttributes.ID.toLowerCase().contains(i.toLowerCase())||t.Elements[r].dictAttributes.Value&&t.Elements[r].dictAttributes.Value.toLowerCase().contains(i.toLowerCase()))&&(u=t.Elements[r],u.ParentVM=n.newParentList,u.isSelected=!1,n.lstConstants.push(u),u={}),t.Elements[r].Elements.length>0&&(n.newParentList={},n.newParentList=t.Elements[r],l(n.newParentList),n.SearchConstantsWithID(t.Elements[r],i)))};l=function(n){if(n.Elements.length>0)for(var t=0;t<n.Elements.length;t++)n.Elements[t].Name=="groups"&&(n.Elements[t].ParentVM=n,n.Elements[t].Elements.length>0&&l(n.Elements[t]))};h=function(){n.SelectedConstant&&!n.SelectedConstant.isSelected&&(n.SelectedConstant&&(n.SelectedConstant.isSelected=!0),n.PrevSelectedConstant&&(n.PrevSelectedConstant.isSelected=!1),n.PrevSelectedConstant=n.SelectedConstant)};n.FindNextConstant=function(){if(n.lstConstants.length>0&&n.CountofConstants<n.lstConstants.length){n.SelectedConstant=n.lstConstants[n.CountofConstants];h();var t=n.lstConstants[n.CountofConstants];for(n.newParentList=[];t!=undefined&&t!="";)n.newParentList.push(t),t=t.ParentVM;n.expandByFind(n.newParentList);r(function(){var n=$("#"+i.currentopenfile.file.FileName).find(".constant-tree-view .selected");n&&$(".constant-tree-view").scrollTo(n,null,null)});n.CountofConstants++}else toastr.info("Finished searching,reached end of file"),n.CountofConstants=0,h(),n.lstConstants=[]};n.togglebuttonForTreeView=function(n){n.IsExpanded=!n.IsExpanded};n.LoadSomeFiles=function(){for(var i=0,t=n.lstFilesCollection.length;t<n.FilesCollection.length;t++)if(i++,i==15)break;else n.lstFilesCollection.push(n.FilesCollection[t])};n.LoadFilesDependingOnText=function(){for(var t=n.lstFilesCollection.length;t<n.FilesCollection.length;t++)n.lstFilesCollection.push(n.FilesCollection[t])};n.getconstants(n.constantfilemodel);n.setValidationList=function(){var r,u;n.validationErrorList=[];o.validationListObj&&angular.isArray(o.validationListObj)&&(r=t("filter")(o.validationListObj,{FileName:i.currentopenfile.file.FileName}),r.length==0&&o.validationListObj.push({FileName:i.currentopenfile.file.FileName,errorList:[]}),u=t("filter")(o.validationListObj,{FileName:i.currentopenfile.file.FileName})[0],n.validationErrorList=u.errorList=[])};n.validateFileData=function(t,i){n.setValidationList();n.constantfilemodel&&(n.validateConstants(n.constantfilemodel,t,n.constantfilemodel,n.constantfilemodel),n.checkDuplicateId(n.constantfilemodel),t&&i!="change"&&r(function(){toastr.success("Constants validated successfully.")},1e3))};n.checkDuplicateId=function(t){t&&t.Name=="groups"&&angular.forEach(t.Elements,function(i){if(i.Name!="item"&&n.validateID(i),e.checkDuplicateId(i,t,n.validationErrorList,!1,["item"]),i.dictAttributes.ID&&t.dictAttributes.ID&&i.dictAttributes.ID==t.dictAttributes.ID&&i!=t){i.errors||angular.isObject(i.errors)||(i.errors={});var r=f.VALIDATION.DUPLICATE_ID;i.errors&&!i.errors.duplicate_id&&(i.errors.duplicate_id=r);n.validationErrorList.indexOf(i)<=-1&&n.validationErrorList.push(i);t.errors&&!t.errors.duplicate_id&&(t.errors.duplicate_id=r);n.validationErrorList.indexOf(t)<=-1&&n.validationErrorList.push(t)}i.Elements.length>0&&i.Name=="groups"&&n.checkDuplicateId(i)})};y=null;n.validateConstants=function(t,i,r,u){angular.forEach(t.Elements,function(t){t&&t.dictAttributes.hasOwnProperty("sfwEffectiveDate")&&t.dictAttributes.sfwEffectiveDate&&(i&&(t.errors&&t.errors.sfwEffectiveDate&&delete t.errors.sfwEffectiveDate,t.errors&&!e.isEmptyObj(t.errors)&&e.removeObjInToArray(n.validationErrorList,t)),e.findDuplicateDates(r,t,n.validationErrorList,"sfwEffectiveDate"));t.Name=="constant"&&(t.dictAttributes.sfwDataType||e.checkValidListValue(n.DataTypes,t,t.dictAttributes.sfwDataType,"sfwDataType","sfwDataType",f.VALIDATION.INVALID_METHOD,n.validationErrorList));t.Name=="constant"&&u.dictAttributes.GroupType=="Manual"&&n.validateDataType(t,t.dictAttributes.sfwDataType);t.Elements.length>0&&(t.Name=="constant"&&(r=t),t.Name=="groups"&&(u=t),n.validateConstants(t,i,r,u))})};n.validateDataType=function(t,i){t.Name=="constant"&&e.checkValidListValue(n.DataTypes,t,t.dictAttributes.sfwDataType,"sfwDataType","sfwDataType",f.VALIDATION.EMPTY_DATATYPE,n.validationErrorList,!0);t&&(e.validateDataTypes(t,t.dictAttributes.Value,i,n.validationErrorList),t.Elements.length>0&&angular.forEach(t.Elements,function(t){n.validateDataType(t,i)}));n.updateModelForBaseAppModel()};n.validateID=function(t){t&&e.validateID(t,n.validationErrorList,t.dictAttributes.ID)};n.findParentAndChildObject=function(t){var i=[];n.FindDeepNode(n.constantfilemodel,t,i);n.$evalAsync(function(){n.selectConstant(i)})};n.selectConstant=function(t){var i,u,f;if(t.length>1)for(i=0;i<t.length;i++)t[i].Name=="groups"&&(t[i].IsExpanded=!0),t[i].Name!="item"&&(u=t[i],f=t[i+1],n.SelectConstantClick(u,window.event),u&&u.Name!="groups"&&t.length==2&&(u=n.constantfilemodel,f=t[i]),u&&f&&n.LoadParentForObject(u,f)),t[i].Name=="item"&&(n.currentSelectedRow(t[i]),r(function(){var n=$(".constants-items-table").find(".selected").first();n&&$(".constants-items-table").scrollTo(n,{offsetTop:300,offsetLeft:0},null)}));else t.length==1&&n.SelectConstantClick(t[0],window.event);r(function(){var n=document.getElementsByClassName("selected")[0];n&&$(".constant-tree-view").scrollTo(n,null,null)})};n.PopulateDataTypes();n.setValidationList();n.traverseMainModel=function(t){var f=[],i,r,u,e;if(t.contains("-")||t.contains(","))for(i=n.constantfilemodel,r=0;r<t.split(",").length;r++)if(i=n.FindNodeHierarchy(i,t.split(",")[r].substring(t.split(",")[r].lastIndexOf("-")+1)),i&&(f.push(i),i.ParentID&&(i.ParentID=="softerror"||i.ParentID=="harderror")))if(u=t.split(","),e=u[u.length-1].substring(0,u[u.length-1].indexOf("-")),i.Children.length>0&&e=="rule"){i=FindChidrenHierarchy(i,t.split(",")[r+2].substring(t.split(",")[r+2].lastIndexOf("-")+1));f.push(i);break}else break;return f};n.updateModelForBaseAppModel=function(t){n.IsBaseAppFile&&n.constantfilemodel&&n.constantfilemodel.BaseAppModel&&n.$evalAsync(function(){updateModelForBaseAppModel(n.constantfilemodel,n.constantfilemodel.BaseAppModel,t)})};n.revertToBaseAppModel=function(t){n.$evalAsync(function(){revertToBaseAppModel(t)})};n.LoadEntityQueries(!0);n.onSelectAllEntities=function(){for(var t=0;t<n.EntityQueryCollection.length;t++)n.EntityQueryCollection[t].IsRuleSelected=n.isAllEntitiesSelected};n.updateEntityQueriesGroup=function(){var r,t,u;for(n.LoadEntityQueries(),i.UndRedoBulkOp("Start"),i.EditPropertyValue(n.entityQueryGroup.Elements,n.entityQueryGroup,"Elements",[]),r=n.EntityQueryCollection.filter(function(n){return n.IsRuleSelected}),t=0;t<r.length;t++)u=r[t],entityNode={Name:"groups",dictAttributes:{ID:u.Name,GroupType:"Entity"},Elements:[]},i.PushItem(entityNode,n.entityQueryGroup.Elements),n.updateEntityQueries(entityNode,u);i.UndRedoBulkOp("End")};n.updateEntityQueries=function(t,r){var u,f,e,o;if(r||n.LoadEntityQueries(),t&&t.dictAttributes.GroupType==="Entity"){if(u=null,r?u=r:(i.UndRedoBulkOp("Start"),u=n.EntityQueryCollection.filter(function(n){return n.Name===t.dictAttributes.ID})[0]),i.EditPropertyValue(t.Elements,t,"Elements",[]),u)for(f=0;f<u.Childs.length;f++)e=u.Childs[f],o={Name:"constant",dictAttributes:{ID:e.Name,Value:t.dictAttributes.ID+"."+e.Name,sfwDataType:"string"},Elements:[]},i.PushItem(o,t.Elements);r||i.UndRedoBulkOp("End")}}}]);app.directive("scrollIf",["$window",function(){return{restrict:"AE",scope:{val:"@"},link:function(n,t){n.$watch("val",function(n){if(n=="true"){for(var i=t[0];i.offsetTop==0;)i=i.parentNode;$("#dvScrollList").scrollTo(i,null,null)}},!0)}}}]);app.directive("treeviewconstants",["$compile",function(n){var t=function(){return"<ul class='marg-left-20'> <li ng-repeat=\"itm in items.Elements | orderBy:'dictAttributes.ID'\" tabindex='0' key-up-down-for-tree callbackfn='selectConstant' objproperty='\"itm\"' objparent='items'> <i style='float:left' ng-click='toggleCondition(itm)' ng-if=\"itm.Elements.length > 0 && itm.Name !='constant'\" ng-class=\"itm.IsExpanded?'constants-tree-minus':'constants-tree-plus'\"><\/i> <span style='position:relative;'><span class='info-tooltip dtc-span' ng-if='itm.errors.empty_id || itm.errors.inValid_id || itm.errors.duplicate_id' ng-attr-title='{{itm.errors.empty_id || itm.errors.inValid_id || itm.errors.duplicate_id}}'><i style='color:red !important;' class='fa fa-exclamation-circle'><\/i><\/span><\/span> <span ng-class=\"itm.isSelected?'selected':''\" class='constant-tree-child-label' ng-click='selectConstant(itm,items,$event)' context-menu='menuoptionforconstant'>{{itm.dictAttributes.ID}} <span ng-if=\"itm.Name =='constant'\"> = <\/span> <span ng-if=\"itm.Name =='constant'\" style='color:blue'> {{itm.dictAttributes.Value}} <\/span> <\/span> <span treeviewconstants  items='itm' ng-if='itm.IsExpanded' menuoptionforconstant='menuoptionforconstant'/> <\/li> <\/ul>"};return{restrict:"A",scope:{items:"=",menuoptionforconstant:"="},link:function(i,r){i.toggleCondition=function(n){n.IsExpanded=!n.IsExpanded};i.selectConstant=function(n,t,i){var r=getCurrentFileScope();r.SelectedConstant=n;t&&r.LoadParentForObject(t,n);r.SelectConstantClick&&r.SelectConstantClick(r.SelectedConstant);i&&i.stopPropagation()};angular.isArray(i.items.Elements)&&(r.html(t(i.items,r)),n(r.contents())(i))}}}]);app.directive("scrolldirectiveforfiles",function(){return{restrict:"A",link:function(n,t){var i=t[0],r;console.log("loading directive");r=0;t.bind("scroll",function(){if(i.scrollTop+i.offsetHeight>i.scrollHeight&&i.scrollTop>r){r=i.scrollTop-10;i.scrollHeight=i.scrollTop+i.scrollHeight;var n=getCurrentFileScope();n.$apply(function(){n.LoadSomeFiles()})}})}}});