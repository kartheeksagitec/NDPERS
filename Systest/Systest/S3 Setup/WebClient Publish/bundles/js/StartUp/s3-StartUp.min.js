app.controller("LoginController",["$scope","$http","$rootScope","ConfigurationFactory","hubcontext","$cookies",function(n,t,i,r,u,f){function o(){var t=JSON.parse(e);t.DomainName&&(i.IsActiveDirectoryUser=!0);t.allowADLogin&&(i.allowADLogin=!0);t.NewUser=="Y"?(i.IsProjectLoaded=!1,n.ChangePasswordFunction(t)):t.UserName=="admin"?(i.IsAdmin=!0,i.IsLogin=!0,i.IsProjectLoaded=!1,i.setCurrentUserName()):n.GetPojectNamesAndProjectDetail()}n.Submit=function(){n.UserName!=undefined&&n.Password!=undefined&&n.UserName!=""&&n.Password!=""?(i.IsProjectLoaded=!0,t({method:"POST",data:{UserName:n.UserName,Password:n.Password},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/LoginUser"}).then(function(t){i.IsProjectLoaded=!1;n.CheckUserValidation(t)},function(n){i.IsProjectLoaded=!1;i.showExceptionDetails(n.data)})):n.UserName&&n.UserName!=""?n.Password&&n.Password!=""||toastr.error("Password required."):toastr.error("User Name required.")};n.LoginWithADUser=function(){i.IsProjectLoaded=!0;t({method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/LoginWithADUser"}).then(function(t){i.IsProjectLoaded=!1;n.CheckUserValidation(t,!0)},function(t){i.IsProjectLoaded=!1;n.showExceptionDetails(t.data)})};n.CheckUserValidation=function(t,r){var u,e;$(".login-content input[id=user]").focus();t.data=="ActiveUserLimit"?toastr.error("Number of users logged in reached to its maximum count."):t.data=="UserNotExist"?toastr.error("User not exist."):t.data=="AccessError"?toastr.error("Sorry, You have No Access."):t.data=="ActiveError"?toastr.error("Account is not activated."):t.data==null||t.data==="UsernamePasswordNotMatched"?toastr.error("UserName/Password does not match."):t.data=="PasswordResetOrNotActive"?(u="Your account is not activated or you need to reset your password.",r||(u+=" Please click on set new password link."),toastr.error(u)):t.data==="AllowADLogin"?i.allowADLogin=!0:t.data==="None"||(i.IsLogOut=!1,(i.allowADLogin||t.data.DomainName)&&(t.data.allowADLogin=!0),f.putObject("UserDetails",JSON.stringify(t.data)),e=f.getObject("UserDetails"),t.data&&(t.data.DomainName?(i.IsActiveDirectoryUser=!0,i.allowADLogin=!0):i.IsActiveDirectoryUser=!1,JSON.parse(e).UserType!=""?t.data.NewUser=="Y"?n.ChangePasswordFunction(t.data):t.data.UserName=="admin"?(i.IsAdmin=!0,i.IsLogin=!0,i.setCurrentUserName()):n.GetPojectNamesAndProjectDetail():toastr.error("Sorry, You have No Access.")))};n.ChangePasswordFunction=function(t){var e=f.getObject("UserDetails"),u=n.$new();u.userDetails=t;u.changePasswordDialog=i.showDialog(u,"Change Password","StartUp/views/ChangePasswordDialog.html",{height:460,width:500});u.changePasswordCallBack=function(n){var t,o;n.data=="AccessError"?toastr.error("Sorry, You have No Access"):n.data=="passwordMatch"?toastr.error("Password has been used in past."):(t=JSON.parse(e),t.NewUser="N",f.putObject("UserDetails",JSON.stringify(t)),toastr.success("Password changed successfully."),u.closeChangePasswordDialog(),o=getScopeByFileName("MainPage"),o&&o.GetAfterLoginData(),i.IsAdmin=!1,n.data[0].length>0&&n.data[1].ProjectName!=null?(r.setConfigurationObject(n.data[0],n.data[1]),i.IsProjectLoaded=!0,i.loadProjectData(n.data[1],!1)):(r.setConfigurationObject(n.data[0],null),i.isConfigureSettingsVisible=!0),i.IsLogin=!0)};u.closeChangePasswordDialog=function(){u.changePasswordDialog.close()}};n.GetPojectNamesAndProjectDetail=function(){i.IsProjectLoaded=!0;var n=f.getObject("UserDetails");t({method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/GetPojectNamesAndProjectDetail?UserID="+JSON.parse(n).UserID}).then(function(n){if(i.IsProjectLoaded=!1,n.data=="AccessError")toastr.error("Sorry, You have No Access.");else if(n.data=="InvalidRequest")toastr.error("Invalid Request.");else{var t=getScopeByFileName("MainPage");t&&t.GetAfterLoginData();i.IsAdmin=!1;n.data[0].length>0?n.data[1].ProjectName!=null?(i.IsProjectLoaded=!0,r.setConfigurationObject(n.data[0],n.data[1]),i.loadProjectData(n.data[1],!1)):(r.setConfigurationObject(n.data[0],null),i.isConfigureSettingsVisible=!0):i.isConfigureSettingsVisible=!0;i.IsLogin=!0}},function(n){i.IsProjectLoaded=!1;i.showExceptionDetails(n.data)})};n.getSessionTime=function(){function n(n){n?SessionEvents.InitSessionTimeout(n):SessionEvents.InitSessionTimeout(20)}$.ajax({url:"api/Login/getSessionTime",type:"GET",async:!1,success:n})};var e=f.getObject("UserDetails");e&&e!=null?o():i.IsLogOut||(i.IsProjectLoaded=!0,t({method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/CheckDomainUserAndLogin"}).then(function(t){i.IsProjectLoaded=!1;n.CheckUserValidation(t,!0)},function(t){i.IsProjectLoaded=!1;n.showExceptionDetails(t.data)}));n.ForgotPasswordDialog=function(){var r=n.$new(!0),u;r.UserName=n.UserName;u=i.showDialog(r,"Forgot Password","StartUp/views/ForgotPasswordDialog.html",{height:210,width:500});r.CheckValidUser=function(){return r.ErrorMessage="",r.UserName&&r.UserName!=""?validateEmail(r.UserName)?!1:(r.ErrorMessage="User Name not valid.",!0):(r.ErrorMessage="User Name Required.",!0)};r.GetPasswordClick=function(){t({method:"POST",data:{UserName:r.UserName},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/ForgotPassword"}).then(function(n){n.data=="InvalidUser"?toastr.error("Invalid user name."):n.data=="ActiveError"?toastr.error("Your account is not activated."):(toastr.success("Password reset successfully."),u.close())},function(n){i.IsLogin=!1;i.showExceptionDetails(n.data)})};r.closeDialog=function(){u.close()}};$("input[type=password]").bind("copy paste",function(n){n.preventDefault()});n.ShowHidePassword=function(n){document.getElementById("pass").type=n?"text":"password"};i.loadProjectData=function(n,t){if(n)if(n.htxPortals){var i=JSON.parse(JSON.stringify(n));i.htxPortals=null;u.hubMain.server.loadProjectData(i,t)}else u.hubMain.server.loadProjectData(n,t)}}]);app.factory("ConfigurationFactory",[function(){var n=[],t={};return{getLastProjectDetails:function(){return t},getProjectList:function(){return n},setConfigurationObject:function(i,r){n=i;t=r},setProjectNames:function(t){n=t}}}]);app.controller("MainController",["$scope","$http","$rootScope","ngDialog","$window","$compile","$interval","hubcontext","ConfigurationFactory","cutFilter","$DashboardFactory","$FormatQueryFactory","$resourceFactory","$EntityIntellisenseFactory","$cookies","$filter","$Errors","$timeout","$searchQuerybuilder","$NavigateToFileService","$searchFindReferences","ParameterFactory","$SgMessagesService","$IentBaseMethodsFactory",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it){function et(t){n.$evalAsync(function(){t&&t.searchFiles&&(n.SideBarSearch.listFile=t.searchFiles.length>0?p("orderBy")(t.searchFiles,"FileName"):[],n.SideBarSearch.totalRecords=t.totalRecords);n.SideBarSearch.IsProcessing=!1})}function at(n){return $.map(n,function(n){return{label:n.FileName,value:n.FileName,FileName:n.FileName,FilePath:n.FilePath,FileType:n.FileType,TFSState:n.TFSState}})}function vt(n){i.isstartpagevisible=!1;i.openFile(n.item)}var ft,ht,rt,ct,ut,ot,st,lt;i.userIdleTimeout=0;i.UndoRedoList={};i.IsTFSConfigured=!1;i.lstopenedfiles=[];i.lstPrevious=[];i.lstNext=[];n.SideBarSearch={};n.SideBarSearch.listFile=[];n.SideBarSearch.totalRecords=0;n.SideBarSearch.FilefilterText="";n.iblnChatWindowVisible=!1;n.iblnChatHelpVisible=!0;ft=y.getObject("UserDetails");ft&&JSON.parse(ft).UserName!=null&&(i.IsLogin=!1);t({method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/GetEntityValidationFlag"}).then(function(n){i.iblnShowEntityDuplicateIdAsWarning=n.data=="true"?!0:!1},function(n){i.showExceptionDetails(n.data)});n.showError=function(){var t=n.$new(),r;t.IsSignalRError=!0;r=i.showDialog(t,"Error Information","Tools/views/LoginPageError.html");t.closeDialog=function(){r.close()}};n.GetAfterLoginData=function(){hubMain.server.getCommonData().done(function(t){n.strFwkVersion=t.fwkVersion;n.strApplicationVersion=t.strApplicationVersion;n.IncorrectHubHandler();globalKeywords=t.lstKeyWords;i.LstButtonMethodLookup=t.LstButtonMethodLookup;i.LstButtonMethodMaintenance=t.LstButtonMethodMaintenance;i.LstButtonMethodWizard=t.LstButtonMethodWizard;i.lstWebControls=t.lstWebControl;i.lstActions=t.lstActions;it.setIentBaseMethods(t.LientBaseMethods);i.ChartTypes=["Bar","Column","Donut","Line","Pie","Radar","StackedBar","StackedColumn"]});n.$evalAsync(function(){i.setCurrentUserName();n.CurrentProjectName=undefined});i.updateProjectList()};i.updateProjectList=function(){n.$evalAsync(function(){n.lstprojects=s.getProjectList();var t=s.getLastProjectDetails();t&&t!=null&&(n.selectedProject=s.getLastProjectDetails().ProjectName)})};i.setCurrentUserName=function(){var n,t;i.LoginName="";n=y.getObject("UserDetails");n&&(t=JSON.parse(n),t&&(i.LoginName=t.FirstName))};n.IncorrectHubHandler=function(){s3Config&&s3Config.versionClient!==n.strApplicationVersion&&toastr.warning("You are using a wrong version of S3 Hub, Please take the latest version ("+s3Config.versionClient+") to have a smooth experience.","Hub Version",{closeButton:!0,timeOut:0,extendedTimeOut:0})};n.loadSelectedProject=function(t){var u=getScopeByFileName("SettingsPage"),r,f;u!=undefined&&u.isDirty&&i.isConfigureSettingsVisible?u.$evalAsync(function(){u.closeFile(t.ProjectID)}):(r=n.$new(),r.lstDirtyFiles=[],i.lstopenedfiles&&i.lstopenedfiles.length>0&&(r.lstDirtyFiles=n.getDirtyFiles()),r.lstDirtyFiles.length>0?(f=i.showDialog(r,"UnSaved File List","Common/views/UnsavedFileListDialog.html"),r.closeSaveListDialog=function(u){var o=angular.element($('div[ng-controller="PageLayoutController"]')).scope(),e;if(u=="Yes"){for(e=0;e<r.lstDirtyFiles.length;e++)o.onsavefileclick(r.lstDirtyFiles[e]);n.ChangeProject(t)}else if(u=="No"){for(e=0;e<r.lstDirtyFiles.length;e++)i.closeFile(r.lstDirtyFiles[e].file.FileName);n.ChangeProject(t)}f.close()}):n.ChangeProject(t))};n.ChangeProject=function(r){i.$evalAsync(function(){var u,f,e;i.ClearUndoRedoList();i.IsProjectLoaded=!0;i.projectLoadError=!1;i.isConfigureSettingsVisible=!1;i.isstartpagevisible=!1;u=s.getLastProjectDetails();!n.CurrentProjectName||u&&u!=null&&r.ProjectID!=u.ProjectId?(f=y.getObject("UserDetails"),e=JSON.parse(f),t({method:"POST",data:{UserID:e.UserID,ProjectId:r.ProjectID},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/LoadSelectedProject"}).then(function(t){t.data=="ActiveUserLimit"?(i.IsProjectLoaded=!1,i.isConfigureSettingsVisible=!0,toastr.error("Number of users logged in reached to its maximum count.")):t.data=="DateError"?(i.IsProjectLoaded=!1,i.isConfigureSettingsVisible=!0,toastr.error("Check status or end date is expired.")):(t.data[0].length>0&&t.data[1].ProjectName!=null?s.setConfigurationObject(t.data[0],t.data[1]):s.setConfigurationObject(t.data[0],null),i.resetRootScopeVarible(),n.$evalAsync(function(){i.IsProjectLoaded=!0}),i.loadProjectData(t.data[1],!0))},function(n){i.IsProjectLoaded=!1;i.showExceptionDetails(n.data)})):u&&(n.$evalAsync(function(){i.IsProjectLoaded=!0}),i.resetRootScopeVarible(),i.loadProjectData(u,!0))})};n.handleFileOperationsAdvanceSearch=function(n,t){var f=i.lstopenedfiles.filter(function(n){return n.file.FileName==t.FileName}),r,u;f&&f.length>0&&(r=[],i.currentopenfile&&i.currentopenfile.file&&i.currentopenfile.file.FileType=="SearchFiles"?r=n.$parent?n.$parent.ResultantFiles:[]:(u=getScopeByFileName("SearchFiles"),r=u?u.ResultantFiles:[]),r.some(function(n,i,r){n.FileName==t.FileName&&(r[i]=t)}))};i.menuOptionForFiles=[["Open Containing Folder",function(){hubMain.server.openContainingFolder(i.currentopenfile.file.FilePath)},function(){return i.currentopenfile&&i.currentopenfile.file&&!i.currentopenfile.file.FilePath?!1:!0}],["Open in Notepad++",function(){hubMain.server.openInNotepadPlus(i.currentopenfile.file.FilePath)},function(){return i.currentopenfile&&i.currentopenfile.file&&!i.currentopenfile.file.FilePath?!1:!0}],["Open HTML in Notepad++",function(){hubMain.server.openHTMLInNotepadPlus(i.currentopenfile.file.FileName)},function(){return i.currentopenfile&&i.currentopenfile.file&&!i.currentopenfile.file.FileName?!1:["FormLinkLookup","FormLinkMaintenance","FormLinkWizard"].indexOf(i.currentopenfile.file.FileType)<0?!1:!0}],["Pin File",function(){n.UserFileAction("pin",i.currentopenfile.file)},function(){return i.currentopenfile.isPinned||i.currentopenfile.file.FileType&&i.currentopenfile.file.FileType=="ERDiagram"?!1:!0}],["UnPin File",function(){n.UserFileAction("pin",i.currentopenfile.file)},function(){return i.currentopenfile.isPinned?!0:!1}],["Add File",function(t){var r=n.$new(),u;r.strMessage="Are you sure you want to Add ";r.FileName=i.currentopenfile.file.FileName;u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170});r.OkClick=function(){i.IsLoading=!0;hubMain.server.addFileInTFS(i.currentopenfile.file).done(function(i){i&&(n.receiveFileAddInTFSStatus(i),n.handleFileOperationsAdvanceSearch(t,i))});u.close()};r.closeDialog=function(){u.close()}},function(){n.IsTFS=!1;var t=s.getLastProjectDetails();return t&&t.IsTFS&&(n.IsTFS=!0),i.currentopenfile.file.TFSState=="OnlyLocal"&&n.IsTFS?!0:!1}],["Check In",function(t){var r=n.$new(),u;r.strMessage="Are you sure you want to check in the pending changes in ";r.FileName=i.currentopenfile.file.FileName;u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170});r.OkClick=function(){i.IsLoading=!0;hubMain.server.checkInTFS(i.currentopenfile.file).done(function(i){i&&(n.receiveCheckInTfsStatus(i),n.handleFileOperationsAdvanceSearch(t,i))});u.close()};r.closeDialog=function(){u.close()}},function(){return(i.currentopenfile.file.TFSState=="InAdd"||i.currentopenfile.file.TFSState=="InEdit")&&n.IsTFS?!0:!1}],["Check Out",function(t){var r=n.$new(),u;r.strMessage="Are you sure you want to check out the ";r.FileName=i.currentopenfile.file.FileName;u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170});r.OkClick=function(){i.IsLoading=!0;hubMain.server.checkOut(i.currentopenfile.file).done(function(i){i&&(n.receiveCheckOutTfsStatus(i),n.handleFileOperationsAdvanceSearch(t,i))});u.close()};r.closeDialog=function(){u.close()}},function(){return i.currentopenfile.file.TFSState=="InEdit"||i.currentopenfile.file.TFSState=="InAdd"||i.currentopenfile.file.TFSState=="OnlyLocal"?!1:n.IsTFS?!0:!1}],["Undo",function(t){var r=n.$new(),u;r.strMessage="Are you sure you want to undo changes ";r.FileName="";u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170});r.OkClick=function(){i.IsLoading=!0;hubMain.server.undoCheckOut(i.currentopenfile.file).done(function(i){i&&(n.receiveUndoModel(i),n.handleFileOperationsAdvanceSearch(t,i))});u.close()};r.closeDialog=function(){u.close()}},function(){return(i.currentopenfile.file.TFSState=="InAdd"||i.currentopenfile.file.TFSState=="InEdit")&&n.IsTFS?!0:!1}],["Get Latest Version",function(t){i.IsLoading=!0;hubMain.server.getLatest(i.currentopenfile.file).done(function(i){i&&(n.receiveGetLatest(i),n.handleFileOperationsAdvanceSearch(t,i))})},function(){return(i.currentopenfile.file.TFSState=="InAdd"||i.currentopenfile.file.TFSState=="InEdit"||i.currentopenfile.file.TFSState=="LocalWithoutChange")&&n.IsTFS?!0:!1}],["Close All But this",function(){i.checkAndCloseFiles()},function(){return!0}]];n.receiveProjectafterLoad=function(t,r,u,f){n.$evalAsync(function(){n.CurrentProjectName=r;n.selectedProject=r;n.strDBConnection=t;n.fileErrorList=u;i.IsProjectInitialLoad=!0;i.IsOracleDB=f;i.isstartpagevisible=!0;i.lstPrevious.push(undefined);i.IsProjectLoaded=!1})};o.hubMain.client.setToolsFileDetails=function(t){var r,i;t&&(r=JSON.parse(t),r&&r.length>0&&(i=p("filter")(r,{FileName:"AuditLog"}),i&&i.length>0&&(n.auditLogFileInfo=i[0]),i=p("filter")(r,{FileName:"CustomSettings"}),i&&i.length>0&&(n.customSettingsFileInfo=i[0]),i=p("filter")(r,{FileName:"RuleConstants"}),i&&i.length>0&&(n.ruleConstantsFileInfo=i[0]),i=p("filter")(r,{FileName:"entTableSchema"}),i&&i.length>0&&(n.entTableSchemaInfo=i[0]),i=p("filter")(r,{FileName:"ProjectConfiguration"}),i&&i.length>0&&(n.projectConfigurationFileInfo=i[0])))};n.redirectToProjectSettings=function(){n.$evalAsync(function(){i.isstartpagevisible=!1;i.IsProjectLoaded=!1;i.isConfigureSettingsVisible=!0;i.currentopenfile=undefined})};n.openConfigureSettings=function(){var t=n.$new(),r;t.lstDirtyFiles=[];i.lstopenedfiles&&i.lstopenedfiles.length>0?t.lstDirtyFiles=n.getDirtyFiles():(i.isstartpagevisible=!1,n.closeLeftBar(),i.isConfigureSettingsVisible=!0);t.lstDirtyFiles.length>0?(r=i.showDialog(t,"UnSaved File List","Common/views/UnsavedFileListDialog.html"),t.closeSaveListDialog=function(u){var e=angular.element($('div[ng-controller="PageLayoutController"]')).scope(),f;if(u=="Yes"){for(f=0;f<t.lstDirtyFiles.length;f++)e.onsavefileclick(t.lstDirtyFiles[f]);i.$evalAsync(function(){i.isstartpagevisible=!1;i.isConfigureSettingsVisible=!0;n.closeLeftBar()})}else if(u=="No"){for(f=0;f<t.lstDirtyFiles.length;f++)i.closeFile(t.lstDirtyFiles[f].file.FileName);i.$evalAsync(function(){i.isstartpagevisible=!1;i.isConfigureSettingsVisible=!0;n.closeLeftBar()})}r.close()}):i.$evalAsync(function(){i.isstartpagevisible=!1;i.isConfigureSettingsVisible=!0;i.currentopenfile=undefined;n.closeLeftBar()})};n.getDirtyFiles=function(){for(var t,r=[],n=0;n<i.lstopenedfiles.length;n++)t=getScopeByFileName(i.lstopenedfiles[n].file.FileName),t&&t.isDirty&&r.push(i.lstopenedfiles[n]);return r};n.slideOutLeftBar=function(t,r){var u=r.currentTarget,f,e;n.SideBarSearch.category!=t||i.IsTfsUpdated||i.IsFilesAddedDelete||i.isFilesListUpdated?(i.IsTfsUpdated=!1,n.SideBarSearch.FilefilterText="",n.SideBarSearch.category=t,n.SideBarSearch.PageIndex=1,f=n.GetSideBarSearchList(),f.done(et),e=u.getBoundingClientRect(),$(".left-slider").css({left:e.left-115+"px"}),$(".left-slider").show(500)):($(u).toggleClass("borderBWhite"),$(".left-slider").toggle());window.setTimeout(function(){$("[ui-search-wrapper] input[id='searchfiletype']").focus()},50)};n.closeLeftBar=function(){$(".global-menu li a").removeClass("borderBWhite");$(".left-slider").slideUp("fast")};n.GetSideBarSearchList=function(){return o.hubSearch.server.getFileListTypewise(n.SideBarSearch.PageIndex,n.SideBarSearch.category,n.SideBarSearch.FilefilterText?n.SideBarSearch.FilefilterText.trim():"")};n.SidebarScrollDown=function(){if(n.SideBarSearch.IsProcessing=!0,n.SideBarSearch.PageIndex=n.SideBarSearch.PageIndex+1,n.SideBarSearch.SelectedFile=$("[ui-search-wrapper]").find("li.selected").length>0?$("[ui-search-wrapper]").find("li.selected")[0]:null,n.SideBarSearch.listFile&&n.SideBarSearch.listFile.length<n.SideBarSearch.totalRecords){var t=n.GetSideBarSearchList();t.done(function(t){et(t);n.SideBarSearch.SelectedFile&&setTimeout(function(){var i=$(n.SideBarSearch.SelectedFile).attr("id"),t=$("[ui-search-wrapper] #"+i);t.length>0&&(t.addClass("selected"),$("[ui-search-wrapper] .list-group").scrollTo(t,null,null))},500)})}};n.SideBarFileSelect=function(n){$(".left-slider").hide();i.openFile(n)};n.homepageclick=function(){n.$evalAsync(function(){i.isConfigureSettingsVisible||i.isstartpagevisible||(i.isstartpagevisible=!0,n.closeLeftBar(),i.isConfigureSettingsVisible=!1,i.lstPrevious.push(undefined),i.currentopenfile=undefined,n.ClassForHeaderPanel="")})};n.SearchFilterFileTypeWise=function(){n.SideBarSearch.PageIndex=1;var t=n.GetSideBarSearchList();t.done(et)};n.SideBarSearchKeyDown=function(t){var f=t.which?t.which:t.keyCode,i=$(t.currentTarget).parents("[ui-search-wrapper]"),u,r;switch(f){case 38:$(i).find("li.selected").length>0&&$(i).find("li:not(:first-child).selected").removeClass("selected").prev().addClass("selected");$(i).find("li.selected").length>0&&$("[ui-search-wrapper] .list-group").scrollTo($(i).find("li.selected"),null,null);break;case 40:$(i).find("li.selected").length>0?$(i).find("li:not(:last-child).selected").removeClass("selected").next().addClass("selected"):$(i).find("li:first-child").addClass("selected");$(i).find("li.selected").length>0&&$("[ui-search-wrapper] .list-group").scrollTo($(i).find("li.selected"),null,null);break;case 13:u=$(i).find("li");r=$(u).index($(u).filter(".selected"));r>-1&&n.SideBarSearch.listFile.length>0&&n.SideBarSearch.listFile[r]&&n.SideBarFileSelect(n.SideBarSearch.listFile[r]);event.preventDefault()}};n.getGlobalSearch=function(){$("#globalSearch").autocomplete({minLength:0,appendTo:"#dvIntellisense",open:function(n){$("#dvIntellisense > ul").css({width:"auto",height:"auto",overflow:"auto",maxWidth:"300px",maxHeight:"700px"});var i=$(n.target),t=i.autocomplete("widget");left=t.position().left+10;windowWidth=$(window).width();height=t.height();inputHeight=i.height();windowsHeight=$(window).height();windowsHeight<t.position().top+height+inputHeight&&(newTop=t.position().top-height-inputHeight-10,t.css("top",newTop+"px"));left+t.width()>windowWidth&&(newleft=left-t.width()+110,t.css("left",newleft+"px"))},source:function(n,t){n.term&&n.term.trim()!=""&&o.hubSearch.server.getsearchGlobal(n.term.trim()).done(function(n){n&&t(at(n))})},search:function(n){n.target.value==""&&$(this).autocomplete("destroy")},focus:function(n,t){$(".ui-autocomplete > li").attr("title",t.item.value)},select:function(n,t){return vt(t),this.value="",!1}})};n.getGlobalSearchPaste=function(n){$(n.currentTarget).data("ui-autocomplete")&&setTimeout(function(){$(n.currentTarget).autocomplete("search",$(n.currentTarget).val())},0)};document.body.onkeydown=function(t){t.ctrlKey&&t.shiftKey&&t.keyCode==70&&n.openSearchFile();t.keyCode==27&&$(".page-header-fixed").css("pointer-events","auto");$(".sgt-wrapper").length>0&&($("#temprow").remove(),$(".sgt-wrapper.row-wrap").parent("tr").remove(),$(".sgt-wrapper").remove());i.userIdleTimeout&&clearTimeout(i.userIdleTimeout)};document.onmousemove=function(){n.IsUserWorking=!0;$(".sgt-wrapper").length>0&&!$(event.target).hasClass("sgt-wrapper")&&!$(event.target).hasClass("row-col")&&($(".sgt-wrapper.row-wrap").parent("tr").remove(),$(".sgt-wrapper.col-wrap").remove());!$("#temprow").length||$(event.target).hasClass("sgt-wrapper")||$(event.target).hasClass("row-col")||$("#temprow").remove()};document.onmousedown=function(t){var r,u,f,e;n.IsUserWorking=!0;$(t.target).parents(".left-slider").length<=0&&$(".left-slider").is(":visible")&&$(".left-slider").slideUp("fast");r=$("#validation-error-list");r.is(t.target)||r.has(t.target).length!=0||r.fadeOut();u=$(".xml-control-tree");u.is(t.target)||u.has(t.target).length!=0||$(t.target).prop("id")=="quick-navigator"||(u.slideUp(),n.showFormTreeMap("close"));f=$("#validation-warning-list");f.is(t.target)||f.has(t.target).length!=0||f.fadeOut();e=$(".duplicate-id-tooltip");e.is(t.target)||e.has(t.target).length!=0||e.fadeOut();$(".sgt-wrapper").length>0&&!$(t.target).hasClass("sgt-wrapper")&&($("#temprow").remove(),$(".sgt-wrapper.row-wrap").parent("tr").remove(),$(".sgt-wrapper.col-wrap").remove());clearTimeout(i.userIdleTimeout)};document.ontouchstart=function(){n.IsUserWorking=!0};document.onclick=function(){n.IsUserWorking=!0};document.onkeydown=function(t){(t.keyCode==116||t.ctrlKey&&t.keyCode==82)&&(i.IsLogOut=!0);n.IsUserWorking=!0};i.openFile=function(t,r){function l(n){n.isvisible=!1;n.file.FileName==t.FileName&&t.FileType&&n.file.FileType==t.FileType&&(f=!0,n.isvisible=!0,i.currentopenfile=n)}var o,u,f,e,s,h;t!=undefined&&(o=new Date,t.TimeModified=o.toISOString(),$("#globalSearch").val(""),$(".d3-tip").hide(),n.closeLeftBar(),r&&(i.IsFilesAddedDelete=!0,i.IsTfsUpdated=!0),t.FileName&&(u=i.lstPrevious.length-1,u>-1&&(i.lstPrevious[u]==undefined||i.lstPrevious[u].FileName!=t.FileName)&&(!i.currentopenfile||i.currentopenfile.file.FileName!=t.FileName&&(r||r==undefined))&&i.lstPrevious.push(t)),f=!1,angular.forEach(i.lstopenedfiles,l),f==!1&&(e={file:t,isvisible:!0,IsSavePending:!1},i.currentopenfile=e,i.lstopenedfiles.push(e)),n.SetClassForHeaderPanel(),t.FilePath&&(s=c.getPinnedFilesData(),h=s.filter(function(n){return n.FileName==i.currentopenfile.file.FileName}),i.currentopenfile.isPinned=h.length>0?!0:!1,i.currentopenfile&&n.UserFileAction("Recent",i.currentopenfile.file)),i.$evalAsync(function(){i.isConfigureSettingsVisible=!1;i.isstartpagevisible=!1}))};n.PreviousClick=function(){var t="";i.lstPrevious.length>1&&(t=i.lstPrevious[i.lstPrevious.length-2],i.lstNext.length>0?i.lstNext[i.lstNext.length-1]!=i.lstPrevious[i.lstPrevious.length-1]&&i.lstNext.push(i.lstPrevious[i.lstPrevious.length-1]):i.lstNext.push(i.lstPrevious[i.lstPrevious.length-1]),i.lstPrevious.splice(i.lstPrevious.length-1,1),t==undefined?n.$evalAsync(function(){i.isstartpagevisible=!0;i.isConfigureSettingsVisible=!1;n.closeLeftBar();i.currentopenfile=undefined}):i.openFile(t,!1))};n.NextClick=function(){if(i.lstNext.length>0){var t=i.lstNext[i.lstNext.length-1];t==undefined?n.$evalAsync(function(){i.currentopenfile=undefined;n.closeLeftBar();i.isstartpagevisible=!0;i.isConfigureSettingsVisible=!1}):i.openFile(t,!1);i.lstNext.splice(i.lstNext.length-1,1);i.lstPrevious.length>0?i.lstPrevious[i.lstPrevious.length-1]!=t&&i.lstPrevious.push(t):i.lstPrevious.push(t)}};i.checkAndCloseFiles=function(){var t=n.$new(),e,u,f,o,r;if(t.lstDirtyFiles=[],t.lstNotDirtyFiles=[],e=JSON.stringify(i.lstopenedfiles),u=JSON.parse(e),i.lstopenedfiles&&i.lstopenedfiles.length>0)for(r=0;r<u.length;r++)u[r].file.FileName!=i.currentopenfile.file.FileName&&(f=getScopeByFileName(u[r].file.FileName),f&&(f.isDirty?t.lstDirtyFiles.push(u[r]):t.lstNotDirtyFiles.push(u[r])));if(t.lstDirtyFiles.length>0)o=i.showDialog(t,"UnSaved File List","Common/views/UnsavedFileListDialog.html"),t.closeSaveListDialog=function(n){var u=angular.element($('div[ng-controller="PageLayoutController"]')).scope(),r;if(n=="Yes"){for(r=0;r<t.lstDirtyFiles.length;r++){u.onsavefileclick(t.lstDirtyFiles[r]);i.closeFile(t.lstDirtyFiles[r].file.FileName)}for(r=0;r<t.lstNotDirtyFiles.length;r++)i.closeFile(t.lstNotDirtyFiles[r].file.FileName)}else if(n=="No"){for(r=0;r<t.lstDirtyFiles.length;r++)i.closeFile(t.lstDirtyFiles[r].file.FileName);for(r=0;r<t.lstNotDirtyFiles.length;r++)i.closeFile(t.lstNotDirtyFiles[r].file.FileName)}o.close()};else for(r=0;r<t.lstNotDirtyFiles.length;r++)i.closeFile(t.lstNotDirtyFiles[r].file.FileName)};i.CloseCurrentFiles=function(t){var e={file:t},r=n.$new(),u,f;r.lstDirtyFiles=[];u=getScopeByFileName(t.FileName);u&&(u.isDirty?r.lstDirtyFiles.push(e):i.closeFile(t.FileName));r.lstDirtyFiles.length>0&&(f=i.showDialog(r,"Save Dialog","Common/views/UnsavedFileListDialog.html"),r.closeSaveListDialog=function(n){var t=angular.element($('div[ng-controller="PageLayoutController"]')).scope();if(n=="Yes"){if(!u.canSaveFile||u.canSaveFile&&u.canSaveFile()){t.onsavefileclick(r.lstDirtyFiles[0]);i.closeFile(r.lstDirtyFiles[0].file.FileName)}}else n=="No"&&i.closeFile(r.lstDirtyFiles[0].file.FileName);f.close()})};i.closeFile=function(t){var u=i.lstopenedfiles.filter(function(n){return n.file.FileName==t}),s,f,r,e;if(u&&u.length>0){for(o.hubMain.server.clearSelectedPath(t),s=i.lstopenedfiles.indexOf(u[0]),i.lstopenedfiles.splice(s,1),u[0].isvisible=!1,(u[0].file.FileType=="FormLinkLookup"||u[0].file.FileType=="FormLinkMaintenance"||u[0].file.FileType=="FormLinkWizard")&&$("#globalSearch").focus(),r=i.lstPrevious.length;r--;)i.lstPrevious[r]!=undefined&&i.lstPrevious[r].FileName==t&&i.lstPrevious.splice(r,1);for(r=i.lstNext.length;r--;)i.lstNext[r]!=undefined&&i.lstNext[r].FileName==t&&i.lstNext.splice(r,1);for(i.ClearUndoRedoListByFileName(u[0].file.FileName),f=-1,r=0;r<w.validationListObj.length;r++)w.validationListObj[r].FileName==t&&(f=r);f!=-1&&w.validationListObj.splice(f,1);i.lstopenedfiles.length>0?i.lstPrevious.length>1?(i.lstNext.length>0&&i.lstNext[i.lstNext.length-1]==i.lstopenedfiles[0].file&&i.lstNext.splice(i.lstNext.length-1,1),i.lstPrevious[i.lstPrevious.length-1]==undefined?(i.isstartpagevisible=!0,i.currentopenfile=undefined):i.openFile(i.lstPrevious[i.lstPrevious.length-1])):(i.lstNext.length>0&&i.lstNext[i.lstNext.length-1]==i.lstopenedfiles[0].file&&i.lstNext.splice(i.lstNext.length-1,1),i.openFile(i.lstopenedfiles[0].file)):(i.lstNext=[],i.lstPrevious=[],i.lstPrevious.push(undefined),n.ClassForHeaderPanel="",i.currentopenfile=undefined,i.$evalAsync(function(){i.isstartpagevisible=!0}));n.SetClassForHeaderPanel();u[0].file.FileType&&u[0].file.FileType=="Entity"&&(e=$("body").find(".findReferences-floating-btn[filename='"+u[0].file.FileName+"']"),e&&e.length>0&&(g.resetData(),e.remove()))}};n.addanddeleteuserfile=function(n,t){var r,f,o,i,e,u;n.toLowerCase()=="pin"||n.toLowerCase()=="unpin"?(r=c.getPinnedFilesData(),f=r.filter(function(n){return n.FileName==t.FileName}),f.length>0?(o=r.indexOf(f[0]),r.splice(o,1)):r.length<20&&n.toLowerCase()=="pin"?r.unshift(t):r.length>=20&&n.toLowerCase()=="pin"&&(r.splice(-1,1),r.unshift(t)),c.setPinnedFilesData(r)):(n.toLowerCase()=="recent"||n.toLowerCase()=="unrecent")&&(i=c.getRecentFilesData(),e=i.filter(function(n){return n.FileName==t.FileName}),e.length>0?(u=i.indexOf(e[0]),n.toLowerCase()=="unrecent"?u>-1&&i.splice(u,1):n.toLowerCase()=="recent"&&(i.splice(u,1),i.unshift(t))):n.toLowerCase()=="recent"&&i.length<20?i.unshift(t):i.length>=20&&n.toLowerCase()=="recent"&&(i.splice(-1,1),i.unshift(t)),c.setRecentFilesData(i))};n.UserFileAction=function(t,r){var u,f;t!=""&&(u=y.getObject("UserDetails"),u&&JSON.parse(u).UserID!=null&&(f=c.postUserFiles(r,JSON.parse(u).UserID,t),f.then(function(u){u&&(n.$broadcast("updateUserFiles"),n.addanddeleteuserfile(t,r),t.toLowerCase()=="pin"&&i.currentopenfile&&r.FileName==i.currentopenfile.file.FileName&&(i.currentopenfile.isPinned=!i.currentopenfile.isPinned,i.currentopenfile.isPinned?toastr.success("File pinned successfully"):toastr.success("File unpinned successfully")))})))};i.ClearUndoRedoList=function(){i.UndoRedoList={}};i.ClearUndoRedoListByFileName=function(n){if(i.UndoRedoList.hasOwnProperty(n)){var t=i.lstopenedfiles.filter(function(t){return t.file.FileName==n});t&&t.length>0?(i.UndoRedoList[n].UndoList=[],i.UndoRedoList[n].RedoList=[]):delete i.UndoRedoList[n]}};n.UndoClick=function(){var f,t,r,u;if(n.canUndo()&&(i.isConfigureSettingsVisible?f="SettingsPage":i.currentopenfile&&i.currentopenfile.file.FileName&&(f=i.currentopenfile.file.FileName),t=getScopeByFileName(f),f!=undefined)){if(r=i.GetSessionStorageObject(f),r&&r.UndoList.length>0&&(u=r.UndoList.pop(),n.AddToRedoList(r,u),u.position=="End"))while(u.position!="Start")u=r.UndoList.pop(),n.AddToRedoList(r,u);t&&t.validateFileData&&t.currentfile&&t.currentfile.FileType=="Entity"&&t.validateFileData();t&&(t.isDirty||(t.isDirty=!0))}};n.AddToRedoList=function(n,t){var i={},o,f,e,u,r;if(t.operation=="Edit")t.model&&(i.value=getPropertyValue(t.model,t.propname),i.operation=t.operation,i.model=t.model,i.propname=t.propname,i.undorelatedfunction=t.undorelatedfunction,t.model&&setPropertyValue(t.model,t.propname,t.value),t.undorelatedfunction&&(typeof t.undorelatedfunction=="function"?(o=t.model,b(function(){t.undorelatedfunction.length>0?t.undorelatedfunction(o):t.undorelatedfunction()})):(r=getCurrentFileScope(),r!=undefined&&r[t.undorelatedfunction](t.value))),n.RedoList.push(i));else if(t.operation=="Add"){if(t.collection&&(i.operation=t.operation,i.collection=t.collection,i.item=t.item,i.undorelatedfunction=t.undorelatedfunction,f=t.collection.indexOf(t.item),t.index!=undefined&&t.index>-1&&(i.index=f),n.RedoList.push(i),t.collection&&t.collection.splice(t.index,1),t.undorelatedfunction&&(r=getCurrentFileScope(),r!=undefined)))if(t.collection.length>0)if(f>0){for(e=null,u=f-1;u>=0;u--)if(t.collection[u].Name==t.item.Name){e=u;break}r[t.undorelatedfunction](e!=null?t.collection[e]:undefined)}else r[t.undorelatedfunction](t.collection[0].Name==t.item.Name?t.collection[0]:undefined);else r[t.undorelatedfunction]()}else t.operation=="Insert"?t.collection&&(i.operation=t.operation,i.collection=t.collection,i.item=t.item,i.index=t.index,n.RedoList.push(i),t.collection&&t.collection.splice(t.index,1)):t.operation=="Delete"?t.collection&&(i.operation=t.operation,i.collection=t.collection,i.item=t.item,i.index=t.index,i.undorelatedfunction=t.undorelatedfunction,n.RedoList.push(i),t.collection&&t.collection.splice(t.index,0,t.item),t.undorelatedfunction&&(r=getCurrentFileScope(),r!=undefined&&t.collection.length>0&&r[t.undorelatedfunction](t.collection[t.index]))):(i.position=t.position,n.RedoList.push(i))};n.RedoClick=function(){var f,t,r,u;if(n.canRedo()&&(i.isConfigureSettingsVisible?f="SettingsPage":i.currentopenfile&&i.currentopenfile.file.FileName&&(f=i.currentopenfile.file.FileName),t=getScopeByFileName(f),f!=undefined)){if(r=i.GetSessionStorageObject(f),r&&r.RedoList.length>0&&(u=r.RedoList.pop(),n.AddToUndoList(u,r),u.position=="Start"))while(u.position!="End")u=r.RedoList.pop(),n.AddToUndoList(u,r);t&&t.validateFileData&&t.currentfile&&t.currentfile.FileType=="Entity"&&t.validateFileData();t&&(t.isDirty||(t.isDirty=!0))}};n.AddToUndoList=function(n,t){var r={},f,u;n.operation=="Edit"?n.model&&(r.value=getPropertyValue(n.model,n.propname),r.operation=n.operation,r.model=n.model,r.propname=n.propname,r.undorelatedfunction=n.undorelatedfunction,n.model&&setPropertyValue(n.model,n.propname,n.value),n.undorelatedfunction&&(typeof n.undorelatedfunction=="function"?(f=n.model,b(function(){n.undorelatedfunction.length>0?n.undorelatedfunction(f):n.undorelatedfunction()})):(u=getCurrentFileScope(),u!=undefined&&u[n.undorelatedfunction](n.value))),t.UndoList.push(r)):n.operation=="Add"?n.collection&&i.PushItem(n.item,n.collection,n.undorelatedfunction,!0):n.operation=="Insert"?n.collection&&i.InsertItem(n.item,n.collection,n.index,!0):n.operation=="Delete"?n.collection&&i.DeleteItem(n.item,n.collection,n.undorelatedfunction,!0):(r.position=n.position,t.UndoList.push(r))};i.GetSessionStorageObject=function(n){var t,r;return i.UndoRedoList.hasOwnProperty(n)?t=i.UndoRedoList[n]:(r={FileName:n,UndoList:[],RedoList:[]},i.UndoRedoList[n]=r,t=r),t};i.UndRedoBulkOp=function(n){var u,t,f,r;i.isConfigureSettingsVisible?u="SettingsPage":i.currentopenfile&&i.currentopenfile.file.FileName&&(u=i.currentopenfile.file.FileName);u!=undefined&&(t=i.GetSessionStorageObject(u),t&&(t.RedoList=[],t.UndoList.length>0?(f=t.UndoList[t.UndoList.length-1],f.position=="Start"?t.UndoList.pop():(r={},r.position=n,t.UndoList.push(r))):(r={},r.position=n,t.UndoList.push(r))))};i.EditPropertyValue=function(n,t,r,u,f){var o,s,e,h;typeof n=="undefined"?n="":angular.isString(n)&&(n=n.trim());typeof u=="undefined"?u="":angular.isString(u)&&(u=u.trim());n!=u&&(i.isConfigureSettingsVisible?o="SettingsPage":i.currentopenfile&&i.currentopenfile.file.FileName&&(o=i.currentopenfile.file.FileName),o!=undefined&&(s=i.GetSessionStorageObject(o),s&&(s.RedoList=[],e={},e.operation="Edit",e.value=n,e.model=t,e.propname=r,e.undorelatedfunction=f,s.UndoList.push(e)),h=getScopeByFileName(o),h&&(h.isDirty||(h.isDirty=!0))),t[r]=u)};i.PushItem=function(n,t,r,u){var e,o,h,c,f,s;t&&(e=t.push(n),e=e-1);i.isConfigureSettingsVisible?o="SettingsPage":i.currentopenfile&&i.currentopenfile.file.FileName&&(o=i.currentopenfile.file.FileName);o!=undefined&&(h=i.GetSessionStorageObject(o),u?r&&(c=getCurrentFileScope(),c!=undefined&&t.length>0&&c[r](t[e])):h.RedoList=[],f={},f.operation="Add",f.collection=t,f.item=n,f.index=e,f.undorelatedfunction=r,h.UndoList.push(f),s=getScopeByFileName(o),s&&(s.isDirty||(s.isDirty=!0)))};i.InsertItem=function(n,t,r,u){var e,s,f,o;t&&t.splice(r,0,n);i.isConfigureSettingsVisible?e="SettingsPage":i.currentopenfile&&i.currentopenfile.file.FileName&&(e=i.currentopenfile.file.FileName);e!=undefined&&(s=i.GetSessionStorageObject(e),u||(s.RedoList=[]),f={},f.operation="Insert",f.collection=t,f.item=n,f.index=r,s.UndoList.push(f),o=getScopeByFileName(e),o&&(o.isDirty||(o.isDirty=!0)))};i.DeleteItem=function(n,t,r,u){var e,o,c,s,f,h;t&&(e=t.indexOf(n),t.splice(e,1));i.isConfigureSettingsVisible?o="SettingsPage":i.currentopenfile&&i.currentopenfile.file.FileName&&(o=i.currentopenfile.file.FileName);o!=undefined&&(c=i.GetSessionStorageObject(o),u?r&&(s=getCurrentFileScope(),s!=undefined&&(t.length>0?e>0?s[r](t[e-1]):s[r](t[0]):s[r](undefined))):c.RedoList=[],f={},f.operation="Delete",f.collection=t,f.item=n,f.index=e,f.undorelatedfunction=r,c.UndoList.push(f),h=getScopeByFileName(o),h&&(h.isDirty||(h.isDirty=!0)))};n.canUndo=function(){return i.currentopenfile?i.UndoRedoList[i.currentopenfile.file.FileName]&&i.UndoRedoList[i.currentopenfile.file.FileName].UndoList&&i.UndoRedoList[i.currentopenfile.file.FileName].UndoList.length>0:i.isConfigureSettingsVisible?i.UndoRedoList.SettingsPage&&i.UndoRedoList.SettingsPage.UndoList&&i.UndoRedoList.SettingsPage.UndoList.length>0:!1};n.canRedo=function(){return i.currentopenfile?i.UndoRedoList[i.currentopenfile.file.FileName]&&i.UndoRedoList[i.currentopenfile.file.FileName].RedoList&&i.UndoRedoList[i.currentopenfile.file.FileName].RedoList.length>0:i.isConfigureSettingsVisible?i.UndoRedoList.SettingsPage&&i.UndoRedoList.SettingsPage.RedoList&&i.UndoRedoList.SettingsPage.RedoList.length>0:!1};n.receiveProjectLoadError=function(n){i.$evalAsync(function(){i.projectLoadError=!0;i.projectLoadErrormsg=n})};i.showExceptionDetails=function(n){var t,r,u;i.$evalAsync(function(){i.IsLoading=!1;i.IsProjectLoaded=!1});t=i.$new();r=[];n&&(r.push(n.Message),n.InnerException&&r.push(n.InnerException.Message),t.errorMessage=r.join("\n"),t.stackTrace=n.StackTraceString);t.sendErrorReport=function(){n&&hubMain.server.sendErrorReport(n);u.close()};t.closeDialog=function(){u.close()};u=i.showDialog(t,"Exception Details","Common/views/ExceptionDetails.html")};i.showDialog=function(n,t,i,r){function o(i){function l(){if(r&&r.open&&r.open(),$(".ui-dialog-titlebar-close").hide(),r&&r.showclose){var n=$('<span style="cursor:pointer;color:black;float:right">X<\/span>');n.click(function(){u.dialog("close")});u.closest(".ui-dialog").find(".ui-dialog-titlebar").append(n)}r&&r.isInfoDialog&&$(".ui-dialog-content").addClass("info-dialog");r&&r.isAlert&&$(".ui-widget-header").last().addClass("sg-alert-header");u.closest(".ui-dialog").find(".ui-dialog-titlebar").on("dblclick",a);s(t);h(o);u.on("keydown",function(n){n.stopPropagation&&n.stopPropagation();preventDefaultSaveUndoRedo(n)});u.on("keypress",function(n){n.which==$.ui.keyCode.ENTER||n.keyCode==$.ui.keyCode.ENTER?u.find(".dialog-btn-default:visible:enabled:first").trigger("click"):(n.which==$.ui.keyCode.ESCAPE||n.keyCode===$.ui.keyCode.ESCAPE)&&r&&r.closeOnEscape&&u.dialog("close");n.stopPropagation&&n.stopPropagation()})}function a(){var n=u.closest(".ui-dialog"),t,i;n&&n.length>0&&(n.height()===o.height?(e={height:n.height(),width:n.width(),top:n.position().top,left:n.position().left},t=window.outerHeight-100,i=window.outerWidth-50,h({height:t,width:i,top:0,left:12.5})):e&&(h(e),e=null))}function v(){r&&r.close&&r.close();u.dialog("destroy");n.$destroy();u.remove()}function y(){r&&r.focus&&r.focus()}function h(n){var t=u.closest(".ui-dialog");n&&t&&t.length>0&&(n.height&&t.css("height",n.height+"px"),n.width&&t.css("width",n.width+"px"),n.top?t.css("top",n.top+"px"):t.css("top","calc((100% - "+n.height+"px)/2)"),n.left?t.css("left",n.left+"px"):t.css("left","calc((100% - "+n.width+"px)/2)"))}var o={position:{my:"center",at:"center",of:window},minWidth:50,minHeight:50,width:500,height:400,modal:!0},c;r&&(r.beforeClose&&(o.beforeClose=r.beforeClose),r.height&&(o.height=r.height),r.width&&(o.width=r.width),r.minHeight&&(o.minHeight=r.minHeight,o.height<o.minHeight&&(o.height=o.minHeight)),r.minWidth&&(o.minWidth=r.minWidth,o.width<o.minWidth&&(o.width=o.minWidth)),r.modal!=undefined&&r.modal==!1&&(o.modal=!1));o.open=l;o.close=v;o.focus=y;c=$("<div id='ScopeId_{{$id}}' class='full-height'><\/div>");c.html(i);u.append(c);$("#main-wrapper").append(u);f(u)(n);u.dialog(o)}function c(){tt.Message("Message","An error occured while getting the temeplate html.")}function l(){u.dialog("close")}function s(n){u.siblings(".ui-dialog-titlebar").find("span[class='ui-dialog-title']").text(n).attr("title",n)}var u=$("<div id='dialog' tabindex='0'><\/div>"),e={},h;return r&&r.isInlineHtml?o(i):(h=[window.location.protocol,"//",window.location.host,"/",getWebApplicationName(),"/",i].join(""),$.ajax({url:h,type:"GET",async:!1,success:o,error:c})),{close:l,updateTitle:s}};i.getEntityAttributeIntellisense=function(t,i,r,u,f,e,o,s){var a=[],w=v.getEntityIntellisense(),y=w,p,h,l,c;if(y&&y.length>0&&(p=y.filter(function(n){return n.ID==t}),p.length>0)){if(h=p[0].Attributes,i){for(l=[],c=0;c<h.length;c++)n.filterEntityAttributeBasedOnCriteria(h[c],r,u,l,f,e,o,s);h=l}else{for(l=[],c=0;c<h.length;c++)((h[c].IsPrivate+"").toLowerCase()=="false"||h[c].IsPrivate==undefined)&&n.filterEntityAttributeBasedOnCriteria(h[c],r,u,l,f,e,o,s);h=l}a=a.concat(h)}return a};n.filterEntityAttributeBasedOnCriteria=function(n,t,i,r,u,f,e,o){u&&n.Type&&n.Type=="Column"&&r.push(n);t&&n.DataType=="Object"&&r.push(n);i&&(n.DataType=="Collection"||n.DataType=="List")&&r.push(n);f&&n.DataType=="CDOCollection"&&r.push(n);e&&n.Type=="Expression"&&r.push(n);o&&n.Type&&n.Type.toLowerCase()=="property"&&r.push(n);t||i||f||u||o||n.Type!="Expression"&&r.push(n)};n.onnewfileclick=function(t){if(n.CurrentProjectName){var r=n.$new();r.SelectedCreationOption=t;r.title="Create New Entity";r.dialogForNew=i.showDialog(r,r.title,"CreateNewObject/views/CreateNewObject.html",{width:830,height:700})}};n.SetClassForHeaderPanel=function(){i.currentopenfile&&(n.ClassForHeaderPanel=i.currentopenfile.file.FileType=="Maintenance"||i.currentopenfile.file.FileType=="Wizard"||i.currentopenfile.file.FileType=="Lookup"||i.currentopenfile.file.FileType=="UserControl"||i.currentopenfile.file.FileType=="Tooltip"?"form-header":i.currentopenfile.file.FileType=="Entity"?"entity-header":i.currentopenfile.file.FileType=="FormLinkLookup"||i.currentopenfile.file.FileType=="FormLinkMaintenance"||i.currentopenfile.file.FileType=="FormLinkWizard"?"htmlform-header":i.currentopenfile.file.FileType=="Correspondence"||i.currentopenfile.file.FileType=="PDFCorrespondence"?"correspondence-header":i.currentopenfile.file.FileType=="LogicalRule"||i.currentopenfile.file.FileType=="DecisionTable"||i.currentopenfile.file.FileType=="ExcelMatrix"?"rule-header":i.currentopenfile.file.FileType=="ExcelScenario"||i.currentopenfile.file.FileType=="ObjectScenario"||i.currentopenfile.file.FileType=="ParameterScenario"?"scenario-header":i.currentopenfile.file.FileType=="BPMN"?"bpm-header":i.currentopenfile.file.FileType=="InboundFile"||i.currentopenfile.file.FileType=="OutboundFile"?"file-header":i.currentopenfile.file.FileType=="Report"?"report-header":"otherfile-header")};n.LogoutSession=function(){var e=y.getObject("UserDetails"),t=n.$new(),o,u,f,s,r;if(t.lstDirtyFiles=[],t.lstNotDirtyFiles=[],o=JSON.stringify(i.lstopenedfiles),u=JSON.parse(o),t.logout=function(){if(e&&JSON.parse(e).UserName!=null){i.IsLoading=!0;$.ajax({url:"api/Login/LogOutUser",type:"GET",async:!1,success:n,error:t});function n(){y.remove("UserDetails");i.resetRootScopeVarible();toastr.success("User has logged out successfully");i.IsLogin=!1;i.IsAdmin=!1;i.IsLogOut=!0;i.IsLoading=!1;i.setCurrentUserName();i.isConfigureSettingsVisible=!1;i.isstartpagevisible=!1}function t(n){i.IsLoading=!1;i.showExceptionDetails(n.data)}}},i.lstopenedfiles&&i.lstopenedfiles.length>0)for(r=0;r<u.length;r++)f=getScopeByFileName(u[r].file.FileName),f&&(f.isDirty?t.lstDirtyFiles.push(u[r]):t.lstNotDirtyFiles.push(u[r]));if(t.lstDirtyFiles.length>0)s=i.showDialog(t,"UnSaved File List","Common/views/UnsavedFileListDialog.html"),t.closeSaveListDialog=function(n){var u=angular.element($('div[ng-controller="PageLayoutController"]')).scope(),r;if(n=="Yes"){for(r=0;r<t.lstDirtyFiles.length;r++){u.onsavefileclick(t.lstDirtyFiles[r]);i.closeFile(t.lstDirtyFiles[r].file.FileName)}for(r=0;r<t.lstNotDirtyFiles.length;r++)i.closeFile(t.lstNotDirtyFiles[r].file.FileName);t.logout()}else if(n=="No"){for(r=0;r<t.lstDirtyFiles.length;r++)i.closeFile(t.lstDirtyFiles[r].file.FileName);for(r=0;r<t.lstNotDirtyFiles.length;r++)i.closeFile(t.lstNotDirtyFiles[r].file.FileName);t.logout()}s.close()};else{for(r=0;r<t.lstNotDirtyFiles.length;r++)i.closeFile(t.lstNotDirtyFiles[r].file.FileName);t.logout()}};n.ChangePassword=function(){var r,t;if(i.IsActiveDirectoryUser){toastr.error("Active Directory User cannot change password.");return}r=y.getObject("UserDetails");r&&JSON.parse(r).UserName!=null&&(t=n.$new(!0),t.showOldPassword=!0,t.userDetails=JSON.parse(r),t.changePasswordDialog=i.showDialog(t,"Change Password","StartUp/views/ChangePasswordDialog.html",{height:460,width:500}),t.changePasswordCallBack=function(){toastr.success("Password changed successfully.");t.closeChangePasswordDialog()},t.closeChangePasswordDialog=function(){t.changePasswordDialog.close()})};n.lstTools=["Run Results","Rule Errors","Refresh Master Data","Get Rule Configuration Results","Custom Settings","Project Configuration","View DataBase Object File","Execute Query","Audit Log","Build Entity Rule","Build Object Rule","Build Rules Assembly - Debug Mode","Build Rules Assembly - Release Mode","Build Project","Add Resources","Constant","Advance Search (Ctrl+Shift+F)","Convert To HTX","New Entity Diagram","Set Code Group","Keyboard Shortcuts","Table/do Report","Validation Utility"];ht=1;n.ShowSelectedTool=function(t){var c,y,h,d,w,l,r,b,a,k,v,f,u,e;n.CurrentProjectName&&(n.RuleNameReadOnly=!1,n.RuleName=undefined,n.EffectiveDate=undefined,n.ToDate=undefined,n.StrExecutionId=undefined,n.ErrorStatus=undefined,n.BusinessObjectName=undefined,n.lstRunresults=null,n.lstRuleErrors=null,n.lstGetRuleConfigResults=null,t=="Run Results"?n.OpenRunResultClick(!0,""):t=="Rule Errors"?n.OpenRuleErrorsClick(!0,""):t=="Get Rule Configuration Results"?n.OpenGetRuleConfigurationClick():t=="Custom Settings"?n.customSettingsFileInfo&&i.openFile(n.customSettingsFileInfo):t=="Check Queries"?n.OpenCheckQueriesClick():t=="Project Configuration"?n.projectConfigurationFileInfo&&i.openFile(n.projectConfigurationFileInfo):t=="View DataBase Object File"?i.openFile(n.entTableSchemaInfo):t=="Audit Log"?n.auditLogFileInfo&&i.openFile(n.auditLogFileInfo):t=="Execute Query"?(c=ht++,y={FileName:"ExecuteQuery("+c+")",FileType:"ExecuteQuery",FileID:c,FilePath:""},i.openFile(y)):t=="Build Entity Rule"?(n.$evalAsync(function(){i.IsLoading=!0}),hubMain.server.onBuildRules().done(function(n){i.receiveRuleBuildResult(n)})):t=="Build Object Rule"?(n.$evalAsync(function(){i.IsLoading=!0}),hubMain.server.onBuildObjectRules().done(function(n){i.receiveRuleBuildResult(n)})):t=="Build Rules Assembly - Debug Mode"?(n.$evalAsync(function(){i.IsLoading=!0}),hubMain.server.onConvertDLL("Debug").done(function(n){i.receiveRuleBuildResult(n)})):t=="Build Rules Assembly - Release Mode"?(n.$evalAsync(function(){i.IsLoading=!0}),hubMain.server.onConvertDLL("Release").done(function(n){i.receiveRuleBuildResult(n)})):t=="Build Project"?(n.$evalAsync(function(){i.IsLoading=!0}),hubMain.server.onBuildProjectClick()):t=="Refresh Master Data"?(n.$evalAsync(function(){i.IsLoading=!0}),hubMain.server.refreshMasterData().done(function(){hubMain.server.getCommonIntellisenseData();toastr.success("Master Data is Refreshed");n.$evalAsync(function(){i.IsLoading=!1})})):t=="Add Resources"?(r=n.$new(!0),hubMain.server.getResourcesFormList().done(function(n){r.filelist=JSON.parse(n);r.$evalAsync()}),r.onSearch=function(n){r.lstResourceFormList=[];r.IsSelectAll=!1;angular.forEach(r.filelist,function(t){t.Location==n&&r.lstResourceFormList.push(t)});r.resetModelData()},r.onToggleSelectionClick=function(n){var t=p("filter");r.queryData=p("filter")(r.lstResourceFormList,{Location:r.folderName});r.queryData&&r.queryData.length>0&&angular.forEach(r.queryData,function(t){t.IsChecked=n})},r.preserveCheckedFiles=[],r.selectFormId=function(n){r.selectedFormId=n},r.onResourceNotSetRowClick=function(n){r.selectedResourceNotSet=n},r.onAddResource=function(){var n=[],t;r.lstResourceFormList&&(t=r.lstResourceFormList.filter(function(n){return n.IsChecked}),angular.copy(t,n),r.resetModelData());r.IsProcessing=!0;n.length>0&&hubMain.server.getFileAddResources(n).done(function(n){r.resourceSet=n.ResourceSetDetails;r.resourceNotSet=n.ResourceNotSetDetails;r.formResource=n.FormResourceDetails;r.IsProcessing=!1;r.$evalAsync()})},r.displayedRecordsNotSet=25,r.OnScrollNotSet=function(){r.displayedRecordsNotSet+=25;r.$evalAsync()},r.displayedRecordsSet=25,r.OnScrollSet=function(){r.displayedRecordsSet+=25;r.$evalAsync()},r.displayedRecordsForm=25,r.OnScrollForm=function(){r.displayedRecordsForm+=25;r.$evalAsync()},r.resetModelData=function(){r.resourceSet=undefined;r.resourceNotSet=undefined;r.formResource=undefined},r.onExport=function(){i.IsLoading=!0;hubMain.server.exportResources().done(function(){i.$apply(function(){i.IsLoading=!1})})},r.lstAllFormModel=[],r.onSaveResources=function(){var t,e,n;if(r.selectedFiles=[],r.formResource){for(i.IsLoading=!0,n=0;n<r.formResource.length;n++)for(t=0;t<r.lstResourceFormList.length;t++)r.formResource[n].strFormId==r.lstResourceFormList[t].FileName&&r.selectedFiles.push(r.lstResourceFormList[t]);if(e={FormResourceDetails:r.formResource,ResourceNotSetDetails:r.resourceNotSet,ResourceSetDetails:r.resourceSet},h=JSON.stringify(e),h.length<32e3)hubMain.server.getSaveResources(e,r.selectedFiles,"ScopeId_"+r.$id).done(function(){});else{var u="",o=[],f=0;for(n=0;n<h.length;n++)f++,u=u+h[n],f==32e3&&(f=0,o.push(u),u="");f!=0&&o.push(u);r.saveResourcePacketsToServer(o,r.selectedFiles,"ScopeId_"+r.$id)}}},d=function(n){for(var t=0;t<n.length;t++)n[t].strControlId==null&&n[t].strFormId!=null?n[t].formModel!=null&&(n[t].formModel.dictAttributes.sfwResource=n[t].strResource):n[t].strControlId!=null&&n[t].strFormId!=null&&(n[t].controlModel.dictAttributes.sfwResource=n[t].strResource),r.lstAllFormModel.indexOf(n[t].formModel)==-1&&r.lstAllFormModel.push(n[t].formModel)},r.saveResourcePacketsToServer=function(n,t,i){for(var r=0;r<n.length;r++)hubMain.server.packetSaveResource(n[r],n.length,t,r,i).done(function(){})},r.receiveSaveResourceException=function(n){if(n.length>0){var t=r.$new(!0);t.lstErrorMessage=n;i.IsLoading=!1;t.dialogError=i.showDialog(t,"Exception Details","Tools/views/ResourceException.html",{width:500,height:500});t.closeDialog=function(){t.dialogError.close()};i.$apply(function(){})}else i.$apply(function(){i.IsLoading=!1;toastr.success("Resources Saved successfully");r.CloseAddResourcesDialog()})},w=i.showDialog(r,"Update Resources","Tools/views/AddResources.html",{width:1e3,height:650}),r.CloseAddResourcesDialog=function(){w.close()},r.tab=1,r.setTab=function(n){r.tab=n},r.isSet=function(n){return r.tab===n}):t=="Convert To HTX"?(l=s.getLastProjectDetails(),l&&l!=null&&s.getLastProjectDetails().HtmlTemplatesLocation?(r=n.$new(),b=i.showDialog(r,"Convert To HTX","Tools/views/ConvertToHtx.html",{width:1100,height:510}),r.CloseDialog=function(){b.close()},r.CancelConvertion=function(){o.hubConvertToHtx.server.stopConverSion()}):toastr.error("Set HTML Template Location")):t=="Constant"?n.constantclick():t=="Advance Search (Ctrl+Shift+F)"?n.openSearchFile():t==="New Entity Diagram"?(a=n.$new(),k=i.showDialog(a,"Add Entity","Tools/views/SelectEntitiesDiagram.html",{width:650,height:450}),a.onEntityDiagramCancelClick=function(){k.close()}):t==="Set Code Group"?(v=n.$new(),v.CodeGroupDialog=i.showDialog(v,"Set Code Group","Tools/views/AddCodeGroup.html",{width:1e3,height:470})):t==="Keyboard Shortcuts"?(f=n.$new(),f.KeyboardShortcutDialog=i.showDialog(f,"Keyboard Shortcuts","Tools/views/KeyboardShortcuts.html",{width:700,height:600,showclose:!0}),f.close=function(){f.KeyboardShortcutDialog.close()}):t==="Table/do Report"?(u=n.$new(),o.hubMain.server.loadTableDoReport().done(function(n){u.$evalAsync(function(){u.entityReport=n})}),u.EntityListDialog=i.showDialog(u,"Table/do Report","Tools/views/EntityReport.html",{width:700,height:600,showclose:!0}),u.close=function(){u.EntityListDialog.close()},u.MergeSelectedFile=function(){var i={lstDuplicateTableNameEntities:[]},t,n;if(u.entityReport&&u.entityReport.lstDuplicateTableNameEntities&&u.entityReport.lstDuplicateTableNameEntities.length>0){for(t=0;t<u.entityReport.lstDuplicateTableNameEntities.length;t++)n=u.entityReport.lstDuplicateTableNameEntities[t],n&&n.IsSelected&&n.istrMergeEntityName&&(delete n.IsSelected,i.lstDuplicateTableNameEntities.push(n));o.hubMain.server.mergeEntity(i).done(function(){})}},u.setNewEntity=function(n,t){n.istrMergeEntityName=n.IsSelected&&n.lstEntityName&&n.lstEntityName.length>0?t?t:n.lstEntityName[0]:""}):t=="Validation Utility"&&(e=n.$new(!0),e.ValidationUtilityDialog=i.showDialog(e,"Validation Utility","Tools/views/ValidationUtility.html",{width:800,height:600,showclose:!0}),e.close=function(){e.ValidationUtilityDialog.close()}))};n.CloseAddResourcesDialog=function(){addResourcesDialog.close()};n.OpenRunResultClick=function(t,r){var u=n.$new(!0),f;u.isValid=!0;u.errorMessage;t?u.RuleNameReadOnly=!1:(u.RuleNameReadOnly=!0,u.RuleName=r);f=i.showDialog(u,"Run Results","Tools/views/RunResult.html",{width:1100,height:600});ComponentsPickers.init();u.CloseRunResultsDialog=function(){f.close()};u.OnSearchClick=function(n){var t;u.Toolname=n;u.lstdata=undefined;u.runResult.PageIndex=1;u.ErrorMessage="";t={StrExecutionId:u.StrExecutionId,RuleName:u.RuleName,ToDate:u.ToDate,EffectiveDate:u.EffectiveDate,ErrorStatus:u.ErrorStatus,UserName:u.UserName,PrimaryKey:u.PrimaryKey,BusinessObjectField:u.BusinessObjectField};hubMain.server.executeQueryInTool(t,n,u.runResult.PageIndex*15,u.$id).done(function(n){u.ErrorMessage="";(!n||n&&JSON.parse(n).length==0)&&(u.ErrorMessage="No Records Found.");u.receieveExecuteQuery(n)})};u.OnClearSearchClick=function(){u.ErrorMessage="";u.StrExecutionId="";u.RuleNameReadOnly||(u.RuleName="");u.ToDate="";u.EffectiveDate="";u.ErrorStatus="";u.UserName="";u.PrimaryKey="";u.BusinessObjectField="";u.lstdata=null;u.runResult.lstRunresults=null;u.runResult.IsProcessing=!1;u.ValidateExecutionIdForRunResult();u.validationForDate()};u.runResult={};u.viewDiagram=function(n){i.IsLoading=!0;$.connection.hubTools.server.loadRunResultDiagram(n.EXECUTION_ID).done(function(n){u.viewDiagramSuccessCallback(n)}).fail(function(){})};u.viewDiagramSuccessCallback=function(t){var u,f,r;t.ruleModel&&(u="",f="",t.ruleModel.dictAttributes?(u=t.ruleModel.dictAttributes.sfwRuleType,f=t.ruleModel.dictAttributes.ID):(u=t.ruleModel.RuleType,f=t.ruleModel.RuleID),closestRule=GetClosestLogicalRule(t.ruleModel,t.effectiveDate,u),closestRule!=undefined&&(UpdateTestExecutionFlow(t.scenarioRuleSteps,u,closestRule,"AllRuleSteps"),r=n.$new(),r.IsRunResults=!0,r.objLogicalRule=t.ruleModel,r.objSelectedLogicalRule=closestRule,r.objEntity=t.entityModel,r.Type="RunResults",r.IsDiagramDivExpanded=!0,r.scenarioruntype="AllRuleSteps",r.viewDiagramDialog=i.showDialog(r,"Rule : "+f+" - Effective Date : "+t.effectiveDate+"[ Elapsed Time:"+t.elapsedTime+"]","Scenario/views/ViewRuleDiagram.html",{height:700,width:1400}),r.ShowOnlyExecutedPath=function(n){ShowOnlyExecutedPath(n,r.objSelectedLogicalRule)},i.IsLoading=!1))};u.runResult.IsProcessing=!1;u.runResult.PageIndex=1;u.OnSearchScrollDown=function(){u.runResult.IsProcessing=!0;u.runResult.PageIndex=u.runResult.PageIndex+1;var n={StrExecutionId:u.StrExecutionId,RuleName:u.RuleName,ToDate:u.ToDate,EffectiveDate:u.EffectiveDate,ErrorStatus:u.ErrorStatus,UserName:u.UserName,PrimaryKey:u.PrimaryKey,BusinessObjectField:u.BusinessObjectField};hubMain.server.executeQueryInTool(n,u.Toolname,u.runResult.PageIndex*15,u.$id).done(function(n){u.receieveExecuteQuery(n)})};u.receieveExecuteQuery=function(n){u.$apply(function(){u.lstdata=JSON.parse(n);u.runResult.lstRunresults=u.lstdata;u.runResult.IsProcessing=!1})};u.receiveErrorMessageQuery=function(n){u.$apply(function(){u.errorMessage=n})};u.ValidateExecutionIdForRunResult=function(t){u.isValid=!0;t&&!n.ValidateExecutionId(t)&&(u.isValid=!1)};u.validationForDate=function(t){u.isValid=!0;t&&!n.ValidateDate(t)&&(u.isValid=!1)}};n.OpenRuleErrorsClick=function(t,r){var u=n.$new(!0),f;u.isValid=!0;u.errorMessage;t?u.RuleNameReadOnly=!1:(u.RuleNameReadOnly=!0,u.RuleName=r);f=i.showDialog(u,"Rule Errors","Tools/views/RuleErrors.html",{width:1100,height:600});ComponentsPickers.init();u.CloseRuleErrorsDialog=function(){f.close()};u.OnSearchClick=function(n){var t;u.Toolname=n;u.lstdata=undefined;u.runResult.PageIndex=1;t={RuleName:u.RuleName,ToDate:u.ToDate,EffectiveDate:u.EffectiveDate};hubMain.server.executeQueryInTool(t,n,u.runResult.PageIndex*15,u.$id).done(function(n){u.ErrorMessage="";(!n||n&&JSON.parse(n).length==0)&&(u.ErrorMessage="No Result Found.");u.receieveExecuteQuery(n)})};u.runResult={};u.runResult.IsProcessing=!1;u.runResult.PageIndex=1;u.OnSearchScrollDown=function(){u.runResult.IsProcessing=!0;u.runResult.PageIndex=u.runResult.PageIndex+1;var n={RuleName:u.RuleName,ToDate:u.ToDate,EffectiveDate:u.EffectiveDate};hubMain.server.executeQueryInTool(n,u.Toolname,u.runResult.PageIndex*15,u.$id).done(function(n){u.receieveExecuteQuery(n)})};u.receieveExecuteQuery=function(n){u.$apply(function(){u.lstdata=JSON.parse(n);u.Toolname=="Rule Errors"&&(u.runResult.lstRuleErrors=u.lstdata,u.ErrorMessage=u.lstdata&&u.lstdata.length>0?"":"No Records Found.");u.runResult.IsProcessing=!1})};u.receiveErrorMessageQuery=function(n){u.$apply(function(){u.errorMessage=n})};u.validationForDate=function(t){u.isValid=!0;t&&!n.ValidateDate(t)&&(u.isValid=!1)}};n.ValidateDate=function(n){var t=!0;return/^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/.test(n)||(t=!1),t};n.ValidateExecutionId=function(n){var t=!0;return/^\d+$/.test(n)||(t=!1),t};n.OpenGetRuleConfigurationClick=function(){var t=n.$new(!0),r;t.errorMessage;r=i.showDialog(t,"Get Rule Configuration Result","Tools/views/GetRulesConfiguration.html",{width:1100,height:600});ComponentsPickers.init();t.CloseGetRuleConfigDialog=function(){r.close()};t.OnSearchClick=function(n){var r,i;t.Toolname=n;t.lstdata=undefined;t.runResult.PageIndex=1;t.strQuery=r;i={StrExecutionId:t.StrExecutionId,RuleName:t.RuleName,BusinessObjectName:t.BusinessObjectName,EffectiveDate:t.EffectiveDate};hubMain.server.executeQueryInTool(i,n,t.runResult.PageIndex*15,t.$id).done(function(n){t.receieveExecuteQuery(n)})};t.runResult={};t.runResult.IsProcessing=!1;t.runResult.PageIndex=1;t.OnSearchScrollDown=function(){t.runResult.IsProcessing=!0;t.runResult.PageIndex=t.runResult.PageIndex+1;var n={StrExecutionId:t.StrExecutionId,RuleName:t.RuleName,BusinessObjectName:t.BusinessObjectName,EffectiveDate:t.EffectiveDate};hubMain.server.executeQueryInTool(n,t.Toolname,t.runResult.PageIndex*15,t.$id).done(function(n){t.receieveExecuteQuery(n)})};t.receieveExecuteQuery=function(n){t.$apply(function(){t.lstdata=JSON.parse(n);t.Toolname=="Get Rule Configuration Results"&&(t.runResult.lstGetRuleConfigResults=t.lstdata,t.lstData&&t.lstData.length>0||(t.errorMessage="No Records Found."));t.runResult.IsProcessing=!1})};t.receiveErrorMessageQuery=function(n){t.$apply(function(){t.errorMessage=n})}};n.showBuildErrorNode=function(n){var r,u,t;n&&n.istrRuleID&&n.istrNodeID&&(r="",n.istrNodeName&&(r=n.istrNodeName),u={NodeName:r,Attribute:"sfwNodeID",Operator:"EqualTo",AttributeValue:n.istrNodeID,isFromBuildErrors:!0},t=[],t.push(u),hubMain.server.getFileInfoByID(n.istrRuleID).done(function(n){var r=n,u;r&&(u=i.lstopenedfiles.some(function(n){if(n.file.FileName==r.FileName)return!0}),u?(i.openFile(r),i.IsLoading=!0,o.hubSearch.server.getFindAdvanceDesign(t,r).done(function(n){var t=getScopeByFileName(r.FileName);t&&t.selectElement&&t.$evalAsync(function(){i.IsLoading=!1;n.length==1&&(r.FileType=="DecisionTable"?t.selectElement(n[0].ParentPath,n[0].FileInfo.SelectNodePath):t.selectElement(n[0].FileInfo.SelectNodePath))})})):(k.setGlobalQueryBuilderFilters(t),k.setQueryBuilderIsAdvanceOption(!1),i.openFile(r)))}))};i.receiveRuleBuildResult=function(t){t&&n.$apply(function(){n.ruleBuildResult=t;n.errorCount=null;n.warningCount=null;n.messageCount=null;n.ruleBuildResult.ilstErrors.length>0&&(n.errorCount=n.ruleBuildResult.ilstErrors.length);n.ruleBuildResult.ilstWarnings.length>0&&(n.warningCount=n.ruleBuildResult.ilstWarnings.length);n.ruleBuildResult.ilstMessages.length>0&&(n.messageCount=n.ruleBuildResult.ilstMessages.length);showBuildResults();toggleBuildResults(null,!0);n.ruleBuildResult.ilstErrors.length>0?selectBuildResultErrors():n.ruleBuildResult.ilstWarnings.length>0?selectBuildResultWarnings():selectBuildResultMessages()});n.$evalAsync(function(){i.IsLoading=!1})};n.selectedTab="Errors";n.selectTab=function(t){n.selectedTab=t};n.IsPhysicalFileFilter=function(n){return n.file.FilePath?!0:!1};n.getactualFileCount=function(){return i.lstopenedfiles?i.lstopenedfiles.length:0};n.constantclick=function(){i.openFile(n.ruleConstantsFileInfo)};n.openSearchFile=function(){n.searchFiles={Data:null,FileName:"SearchFiles",FilePath:"",FileType:"SearchFiles",TFSState:"None",TimeModified:null};i.openFile(n.searchFiles)};n.CheckForDirtyFiles=function(){var r=n.$new(),t,u;if(r.lstDirtyFiles=[],i.lstopenedfiles&&i.lstopenedfiles.length>0)for(t=i.lstopenedfiles.length;t--;)u=getScopeByFileName(i.lstopenedfiles[t].file.FileName),u&&(u.isDirty?r.lstDirtyFiles.push(i.lstopenedfiles[t]):i.closeFile(i.lstopenedfiles[t].file.FileName));return r.lstDirtyFiles};u.onbeforeunload=function(){var r,u,f,e,t;if(i.IsLogOut==undefined){if(r=n.CheckForDirtyFiles(),r.length>0){for(u="",t=0;t<r.length;t++)u+="\r\n"+r[t].file.FilePath;if(f=window.confirm("You are closing the window. do you want to Save following Files?"+u+"\r\n\r\n Click 'Ok' to Save or click 'Cancel' to stay back"),f)for(e=angular.element($('div[ng-controller="PageLayoutController"]')).scope(),t=0;t<r.length;t++){e.onsavefileclick(r[t]);i.closeFile(r[t].file.FileName)}else return!1}}else i.IsLogOut=undefined};i.menuOptionsForFileList=[["Delete",function(t){var r=n.$new(),u;r.strMessage="Are you sure you want to delete this file ";r.FileName=t.file.FileName;u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170});r.OkClick=function(){var n=i.DeleteFile(t.file);n.done(function(n){i.deleteFileSucessCallback(t.file,n);n&&i.currentopenfile&&i.currentopenfile.file&&i.currentopenfile.file.FileType=="SearchFiles"&&(t.$parent.ResultantFiles?t.$parent.ResultantFiles.some(function(n,i){if(n.FileName==t.file.FileName)return t.$parent.ResultantFiles.splice(i,1),!0}):t.$parent.ResultantExtraFieldFiles&&t.$parent.ResultantExtraFieldFiles.some(function(n,i){if(n.FileName==t.file.FileName)return t.$parent.ResultantExtraFieldFiles.splice(i,1),!0}))});u.close()};r.closeDialog=function(){u.close()}},function(n){return n.file.FileType.toLowerCase()=="auditlog"||n.file.FileType.toLowerCase()=="ruleconstants"||n.file.FileType.toLowerCase()=="customsettings"||n.file.FileType.toLowerCase()=="projectconfiguration"||n.file.FileName=="entTableSchema"?!1:!0}],["Add File",function(t){var r=n.$new(),u;r.strMessage="Are you sure you want to Add ";r.FileName=t.file.FileName;u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170});r.OkClick=function(){i.IsLoading=!0;hubMain.server.addFileInTFS(t.file).done(function(i){i&&(n.receiveFileAddInTFSStatus(i),n.handleFileOperationsAdvanceSearch(t,i))});u.close()};r.closeDialog=function(){u.close()}},function(t){n.IsTFS=!1;var i=s.getLastProjectDetails();return i&&i.IsTFS&&(n.IsTFS=!0),t.file.TFSState=="OnlyLocal"&&n.IsTFS?!0:!1}],["Check In",function(t){var r=n.$new(),u;r.strMessage="Are you sure you want to check in the pending changes in ";r.FileName=t.file.FileName;u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170});r.OkClick=function(){i.IsLoading=!0;hubMain.server.checkInTFS(t.file).done(function(i){i&&(n.receiveCheckInTfsStatus(i),n.handleFileOperationsAdvanceSearch(t,i))});u.close()};r.closeDialog=function(){u.close()}},function(t){return(t.file.TFSState=="InAdd"||t.file.TFSState=="InEdit")&&n.IsTFS?!0:!1}],["Check Out",function(t){var r=n.$new(),u;r.strMessage="Are you sure you want to check out the ";r.FileName=t.file.FileName;u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170});r.OkClick=function(){i.IsLoading=!0;hubMain.server.checkOut(t.file).done(function(i){i&&(n.receiveCheckOutTfsStatus(i),n.handleFileOperationsAdvanceSearch(t,i))});u.close()};r.closeDialog=function(){u.close()}},function(t){return t.file.TFSState=="InEdit"||t.file.TFSState=="InAdd"||t.file.TFSState=="OnlyLocal"?!1:n.IsTFS?!0:!1}],["Undo",function(t){var r=n.$new(),u;r.strMessage="Are you sure you want to undo changes ";r.FileName="";u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html",{width:500,height:170});r.OkClick=function(){i.IsLoading=!0;hubMain.server.undoCheckOut(t.file).done(function(i){i&&(n.receiveUndoModel(i),n.handleFileOperationsAdvanceSearch(t,i))});u.close()};r.closeDialog=function(){u.close()}},function(t){return(t.file.TFSState=="InAdd"||t.file.TFSState=="InEdit")&&n.IsTFS?!0:!1}],["Get Latest Version",function(t){i.IsLoading=!0;hubMain.server.getLatest(t.file).done(function(i){i&&(n.receiveGetLatest(i),n.handleFileOperationsAdvanceSearch(t,i))})},function(t){return(t.file.TFSState=="InAdd"||t.file.TFSState=="InEdit"||t.file.TFSState=="LocalWithoutChange")&&n.IsTFS?!0:!1}],["Save As",function(t){var r=n.$new(),u;hubMain.server.getAllFileList().done(function(n){r.$apply(function(){r.lstAllfiles=n})});u=i.showDialog(r,"","StartUp/views/SaveAs.html",{width:500,height:200});r.OkClick=function(){t.file.FileType.toLowerCase()=="lookup"?rt(t.file,r.newFileName+"Lookup"):t.file.FileType.toLowerCase()=="maintenance"?rt(t.file,r.newFileName+"Maintenance"):t.file.FileType.toLowerCase()=="wizard"?rt(t.file,r.newFileName+"Wizard"):t.file.FileType.toLowerCase()=="tooltip"?rt(t.file,r.newFileName+"Tooltip"):t.file.FileType.toLowerCase()=="usercontrol"?rt(t.file,r.newFileName+"UserControl"):rt(t.file,r.newFileName);u.close()};r.closeDialog=function(){u.close()};r.ValidateFileName=function(){t.file.FileType.toLowerCase()=="lookup"||t.file.FileType.toLowerCase()=="maintenance"||t.file.FileType.toLowerCase()=="wizard"?r.ValidateFormName(t.file):t.file.FileType.toLowerCase()=="logicalrule"||t.file.FileType.toLowerCase()=="decisiontable"||t.file.FileType.toLowerCase()=="excelmatrix"?r.validateNewRule():t.file.FileType.toLowerCase()=="bpmn"||t.file.FileType.toLowerCase()=="bpmtemplate"?r.ValidateBPMN():t.file.FileType.toLowerCase()=="usercontrol"?r.ValidateUserControl():t.file.FileType.toLowerCase()=="tooltip"&&r.ValidateTooltip()};r.ValidateFormName=function(n){var t,i;if(r.SaveAsError=undefined,t=!0,r.newFileName)return isValidFileID(r.newFileName,!0)?r.newFileName&&r.newFileName.toLowerCase().startsWith("wfm")?(r.SaveAsError="Error: ID can not start with wfm.",t=!1):r.newFileName&&r.newFileName.trim().length<=3?(r.SaveAsError="Error: Invalid ID. Minimum 4 characters are required.",t=!1):r.newFileName&&(r.newFileName.toLowerCase().endsWith("lookup")||r.newFileName.toLowerCase().endsWith("maintenance")||r.newFileName.toLowerCase().endsWith("wizard"))?(r.SaveAsError=r.newFileName.toLowerCase().endsWith("maintenance")?"Error: ID can not ends with maintenance.":r.newFileName.toLowerCase().endsWith("lookup")?"Error: ID can not ends with lookup.":"Error: ID can not ends with wizard.",t=!1):n.FileType&&n.FileType.toLowerCase()=="lookup"?(i=r.lstAllfiles.filter(function(n){if(n.FileName)return n.FileName.toLowerCase()=="wfm"+r.newFileName.toLowerCase()+"lookup"}),i.length>0&&(r.SaveAsError="Error: The File Name already exists.\nPlease enter a different Form Name (ID).",t=!1)):n.FileType&&n.FileType.toLowerCase()=="maintenance"?(i=r.lstAllfiles.filter(function(n){if(n.FileName)return n.FileName.toLowerCase()=="wfm"+r.newFileName.toLowerCase()+"maintenance"}),i.length>0&&(r.SaveAsError="Error: The File Name already exists.\nPlease enter a different Form Name (ID).",t=!1)):n.FileType&&n.FileType.toLowerCase()=="wizard"&&(i=r.lstAllfiles.filter(function(n){if(n.FileName)return n.FileName.toLowerCase()=="wfm"+r.newFileName.toLowerCase()+"wizard"}),i.length>0&&(r.SaveAsError="Error: The File Name already exists.\nPlease enter a different Wizard Name (ID).",t=!1)):(r.SaveAsError="Error: Numeric Values and Special characters are not allowed in Name.",t=!1),t;r.SaveAsError="Error: Please enter a Form Name (ID).";t=!1};r.validateNewRule=function(){var n=!0,t;return r.SaveAsError=undefined,r.newFileName?isValidIdentifier(r.newFileName)?r.newFileName&&r.newFileName.trim().length<=3?(r.SaveAsError="Error: Invalid ID. Minimum 4 characters are required.",n=!1):r.lstAllfiles&&r.lstAllfiles.length>0&&(t=r.lstAllfiles.filter(function(n){return n.FileName.toLowerCase()=="rul"+r.newFileName.toLowerCase()}),t&&t.length>0&&(r.SaveAsError='Error: The rule name "rul'+r.newFileName+'"  already exists. Please enter a different Name (ID).',n=!1)):(r.SaveAsError="Error: Invalid ID.",n=!1):(r.SaveAsError="Error: ID cannot be empty.",n=!1),n};r.ValidateBPMN=function(){r.SaveAsError=undefined;var n=!0;return r.newFileName&&r.newFileName.trim().length>0?r.newFileName&&r.newFileName.trim().length<=3?(r.SaveAsError="Error: Invalid ID. Minimum 4 characters are required.",n=!1):r.isExistingBpm()?(r.SaveAsError="Error: A file with same name already exists. Please give a different file name.",n=!1):isValidFileID(r.newFileName)||(r.SaveAsError="Error: File Name must not start with digits, contain space(s), special characters(except '-').",n=!1):(r.SaveAsError="Error: Please enter a File Name (ID).",n=!1),n};r.isExistingBpm=function(){return r.lstAllfiles.filter(function(n){return n.FileName.toLowerCase()=="sbp"+r.newFileName.toLowerCase()}).length>0};r.ValidateUserControl=function(){var n,t,i;r.SaveAsError=undefined;n=!0;r.newFileName?isValidFileID(r.newFileName,!0)?r.newFileName&&r.newFileName.trim().length<=3?(r.SaveAsError="Error: Invalid ID. Minimum 4 characters are required.",n=!1):r.newFileName&&r.newFileName.toLowerCase().startsWith("udc")?(r.SaveAsError="Error: ID can not start with udc.",n=!1):r.newFileName&&r.newFileName.toLowerCase().endsWith("usercontrol")?(r.SaveAsError="Error: ID can not ends with usercontrol.",n=!1):(t="udc"+r.newFileName+"UserControl",i=r.lstAllfiles.filter(function(n){return n.FileName.toLowerCase()==t.toLowerCase()}),i.length>0&&(r.SaveAsError="Error: The File Name already exists.\nPlease enter a different User control ID.",n=!1)):(r.SaveAsError="Error: Numeric Values and Special characters are not allowed in Name.",n=!1):(r.SaveAsError="Error: Please enter a User Control ID.",n=!1)};r.ValidateTooltip=function(){var n,t,i;r.SaveAsError=undefined;n=!0;r.newFileName?isValidFileID(r.newFileName,!0)?r.newFileName&&r.newFileName.trim().length<=3?(r.SaveAsError="Error: Invalid ID. Minimum 4 characters are required.",n=!1):r.newFileName&&r.newFileName.toLowerCase().startsWith("wfm")?(r.SaveAsError="Error: ID can not start with wfm.",n=!1):r.newFileName&&r.newFileName.toLowerCase().endsWith("tooltip")?(r.SaveAsError="Error: ID can not ends with tooltip.",n=!1):(t="wfm"+r.newFileName+"Tooltip",i=r.lstAllfiles.filter(function(n){return n.FileName.toLowerCase()==t.toLowerCase()}),i.length>0&&(r.SaveAsError="Error: The File Name "+t+" already exists.\nPlease enter a different tooltip form ID.",n=!1)):(r.SaveAsError="Error: Numeric Values and Special characters are not allowed in Name.",n=!1):(r.SaveAsError="Error: Please enter a Tooltip form ID.",n=!1)}},function(n){return n.file.FileType=="Report"||n.file.FileType=="Entity"||n.file.FileType=="Correspondence"||n.file.FileType=="InboundFile"||n.file.FileType=="OutboundFile"||n.file.FileType=="ParameterScenario"||n.file.FileType=="ObjectScenario"||n.file.FileType=="ExcelScenario"||n.file.FileType=="FormLinkMaintenance"||n.file.FileType=="FormLinkLookup"||n.file.FileType=="FormLinkWizard"||n.file.FileType=="WorkflowMap"||n.file.FileType.toLowerCase()=="auditlog"||n.file.FileType.toLowerCase()=="ruleconstants"||n.file.FileType.toLowerCase()=="customsettings"||n.file.FileType.toLowerCase()=="projectconfiguration"?!1:!0}],["Convert to wfm",function(t){var r=n.$new(),u,f;r.objFile=t.file;u=getScopeByFileName(t.file.FileName);u&&u.isDirty?tt.Message("Alert","Save the file before converting."):(r.objFormsDetails={},r.objFormsDetails.FormName=r.objFile.FileName.replace("wfp",""),r.objFormsDetails.FormName=r.objFormsDetails.FormName.replace(r.objFile.FileType,""),r.convertToWfmErrors=null,$.connection.hubCreateNewObject.server.getCommonFieldList().done(function(n){r.$evalAsync(function(){n.length==5&&(r.lstAllFiles=n[4])})}),f=i.showDialog(r,"Convert to WFM","StartUp/views/converttowfm.html",{width:500,height:400}),r.OkClick=function(){switch(r.objFile.FileType.toLowerCase()){case"lookup":r.convertToWfm(r.objFile,r.objFormsDetails,"Lookup");break;case"maintenance":r.convertToWfm(r.objFile,r.objFormsDetails,"Maintenance");break;case"wizard":r.convertToWfm(r.objFile,r.objFormsDetails,"Wizard");break;default:toastr.error("Required data is not sufficient to convert to wfm")}f.close()},r.closeConvertToWfmDialog=function(){f.close()},r.convertToWfm=function(t,r){r.FormType=t.FileType;i.IsLoading=!0;o.hubMain.server.convertToWFM(t,r).done(function(t){t&&t=="Success"&&(toastr.success("File converted successfully"),n.$evalAsync(function(){i.IsFilesAddedDelete=!0;i.IsTfsUpdated=!0;c.getFileTypeData();c.getTfsStatusData()}));i.IsLoading=!1})},r.ValidateConvertToWfm=function(){var n=!1,i,t,u;return r.objFormsDetails.FormName?isValidFileID(r.objFormsDetails.FormName,!0)?r.objFormsDetails.FormName&&r.objFormsDetails.FormName.toLowerCase().startsWith("wfm")?(r.convertToWfmErrors="Error: ID can not start with wfm.",n=!0):r.objFormsDetails.FormName&&r.objFormsDetails.FormName.trim().length<=3?(r.convertToWfmErrors="Error: Invalid ID. Minimum 4 characters are required.",n=!0):r.objFormsDetails.FormName&&(r.objFormsDetails.FormName.toLowerCase().endsWith("lookup")||r.objFormsDetails.FormName.toLowerCase().endsWith("maintenance")||r.objFormsDetails.FormName.toLowerCase().endsWith("wizard"))&&(i=r.objFormsDetails.FormName.toLowerCase().match(/lookup/g)||r.objFormsDetails.FormName.toLowerCase().match(/maintenance/g)||r.objFormsDetails.FormName.toLowerCase().match(/wizard/g),r.convertToWfmErrors="Error: ID can not ends with "+i[0]+".",n=!0):(r.convertToWfmErrors="Error: Numeric Values and Special characters are not allowed in Name.",n=!0):(r.convertToWfmErrors="Error: Please enter a Form Name (ID).",n=!0),!n&&r.objFile.FileType&&r.objFile.FileType.toLowerCase()=="lookup"?(t="lookup",n=r.checkFileExists(t)):!n&&r.objFile.FileType&&r.objFile.FileType.toLowerCase()=="maintenance"?(t="maintenance",n=r.checkFileExists(t)):!n&&r.objFile.FileType&&r.objFile.FileType.toLowerCase()=="wizard"&&(t="wizard",n=r.checkFileExists(t)),!n&&r.objFormsDetails.Entity?(u=v.getEntityIntellisense(),u.some(function(n){return n.ID==r.objFormsDetails.Entity})||(r.convertToWfmErrors="Error: Invalid Entity.",n=!0)):n&&r.objFormsDetails.Entity||(n=!0,r.convertToWfmErrors="Error: Enter Entity name."),n||r.objFormsDetails.Path||(n=!0,r.convertToWfmErrors="Error: Enter file path."),r.objFormsDetails.errors&&r.objFormsDetails.errors.invalid_path&&r.objFormsDetails.errors.invalid_path=="Folder Not Exist"&&(n=!0,r.convertToWfmErrors="Info: Folder doesn't exist. Please Click Create New Folder Button."),n||(r.convertToWfmErrors=""),n},r.checkFileExists=function(n){var t=!1,i="wfm"+r.objFormsDetails.FormName.toLowerCase()+n,u=r.lstAllFiles&&r.lstAllFiles.filter(function(n){if(n.FileName)return n.FileName.toLowerCase()==i.toLowerCase()||n.FileID.toLowerCase()==i.toLowerCase()});return u&&u.length>0&&(r.convertToWfmErrors="Error: The File Name already exists.\nPlease enter a different Form Name (ID).",t=!0),t})},function(n){return n.file.FileName.startsWith("wfp")?!0:!1}],["Convert to wfp",function(n){var i=n.file,t=getScopeByFileName(n.file.FileName);t&&t.isDirty?tt.Message("Alert","Save the file before converting."):tt.Message("Convert File","Do you want to convert file from wfm to wfp?",!0,function(n){n&&ct(i)})},function(n){return n.file.FileName.startsWith("wfm")&&n.file.FileType!="Tooltip"?!0:!1}],];i.deleteFileSucessCallback=function(t,r){var f,e,u;if(r){n.$evalAsync(function(){if(i.lstopenedfiles.length>0)for(var n=0;n<i.lstopenedfiles.length;n++)i.lstopenedfiles[n].file.FileName==t.FileName&&i.closeFile(t.FileName)});i.IsTfsUpdated=!0;i.isFilesListUpdated=!0;i.IsFilesAddedDelete=!0;n.UserFileAction("Unpin",t);n.UserFileAction("Unrecent",t);t.FileType=="Entity"&&(f=v.getEntityIntellisense(),e=f.filter(function(n){return n.ID==t.FileName}),e&&e.length>0&&(u=f.indexOf(e[0]),u>-1&&f.splice(u,1)));var o=null,s=null,h=function(n){return n.ID==t.FileName?(s=n,!0):!1},l=function(n){return n.Rules.some(h)?(o=n,!0):!1},a=function(){v.getEntityIntellisense().some(l)};a();o&&s&&(u=o.Rules.indexOf(s),o.Rules.splice(u,1));i.isstartpagevisible&&(c.getFileTypeData(),c.getTfsStatusData(),n.addanddeleteuserfile("Unpin",t),n.addanddeleteuserfile("Unrecent",t),n.$broadcast("updateUserFiles"));toastr.success("File deleted successfully.")}n.$evalAsync(function(){i.IsLoading=!1})};i.DeleteFile=function(t){return i.IsLoading=!0,n.closeLeftBar(),hubMain.server.deleteFile(t)};i.updateUserFileDetails=function(t){var r=c.getPinnedFilesData(),u=c.getRecentFilesData(),e=r.filter(function(n){return n.FileName==t.FileName}),o=u.filter(function(n){return n.FileName==t.FileName}),f;e.length==1&&(f=r.indexOf(e[0]),r.splice(f,1),r.unshift(t));o.length==1&&(f=u.indexOf(o[0]),u.splice(f,1),u.unshift(t));c.setPinnedFilesData(r);c.setRecentFilesData(u);i.isstartpagevisible&&n.$broadcast("updateUserFiles")};n.receiveFileAddInTFSStatus=function(t){n.$evalAsync(function(){i.IsLoading=!1;t&&i.currentopenfile&&i.currentopenfile.file&&t.FileName==i.currentopenfile.file.FileName&&(i.currentopenfile.file.TFSState=t.TFSState);i.lstopenedfiles.length>0&&n.changeOpenFileTfsStatus(t)});i.isFilesListUpdated=!0;i.IsTfsUpdated=!0;i.isstartpagevisible&&c.getTfsStatusData();i.updateUserFileDetails(t);toastr.success("File added successfully")};n.receiveCheckInTfsStatus=function(t){n.$evalAsync(function(){i.IsLoading=!1;t&&i.currentopenfile&&i.currentopenfile.file&&t.FileName==i.currentopenfile.file.FileName&&(i.currentopenfile.file.TFSState=t.TFSState);i.lstopenedfiles.length>0&&n.changeOpenFileTfsStatus(t)});i.IsTfsUpdated=!0;i.isFilesListUpdated=!0;i.isstartpagevisible&&c.getTfsStatusData();i.updateUserFileDetails(t);toastr.success("File checked in successfully")};n.receiveCheckOutTfsStatus=function(t){n.$evalAsync(function(){i.IsLoading=!1;t&&i.currentopenfile&&i.currentopenfile.file&&t.FileName==i.currentopenfile.file.FileName&&(i.currentopenfile.file.TFSState=t.TFSState);i.lstopenedfiles.length>0&&n.changeOpenFileTfsStatus(t)});i.IsTfsUpdated=!0;i.isFilesListUpdated=!0;i.isstartpagevisible&&c.getTfsStatusData();i.updateUserFileDetails(t);toastr.success("File checked out successfully")};n.receiveUndoModel=function(t){n.$evalAsync(function(){i.lstopenedfiles.length>0&&n.checkFileIsOpenAndReloadModel(t);i.IsLoading=!1});i.IsTfsUpdated=!0;i.isFilesListUpdated=!0;i.updateUserFileDetails(t);i.isstartpagevisible&&c.getTfsStatusData();toastr.success("Undo successfull")};n.receiveGetLatest=function(t){n.$evalAsync(function(){i.lstopenedfiles.length>0&&n.checkFileIsOpenAndReloadModel(t);i.IsLoading=!1});i.IsTfsUpdated=!0;i.isFilesListUpdated=!0;toastr.success("No conflict found.")};n.receiveErrorMessage=function(t){var r,u;n.$evalAsync(function(){i.IsLoading=!1});r=n.$new();r.strMessage=t;r.isError=!0;u=i.showDialog(r,"","StartUp/views/TFSMessageDialog.html");r.OkClick=function(){u.close()}};n.changeOpenFileTfsStatus=function(n){for(var t=0;t<i.lstopenedfiles.length;t++)i.lstopenedfiles[t].file.FileName==n.FileName&&(i.lstopenedfiles[t].file.TFSState=n.TFSState)};n.checkFileIsOpenAndReloadModel=function(n){for(var r,t=0;t<i.lstopenedfiles.length;t++)i.lstopenedfiles[t].file.FileName==n.FileName&&(r=i.lstopenedfiles[t],i.closeFile(n.FileName),i.openFile(i.lstopenedfiles[t]))};rt=function(t,r){t&&r&&(i.IsLoading=!0,o.hubMain.server.saveAsFile(t,r).done(function(t){t&&t=="Success"&&n.$evalAsync(function(){i.IsFilesAddedDelete=!0;i.IsTfsUpdated=!0;c.getFileTypeData();c.getTfsStatusData()})}),i.IsLoading=!1)};ct=function(t){var r={};t&&(r.FormName=t.FileName.replace("wfm",""),r.FormName=r.FormName.replace(t.FileType,""),r.Entity="entPrototype",r.Path="Prototype\\"+t.FileType,i.IsLoading=!0,o.hubMain.server.convertToWFP(t,r).done(function(t){t&&t=="Success"&&(toastr.success("File converted successfully"),n.$evalAsync(function(){i.IsFilesAddedDelete=!0;i.IsTfsUpdated=!0;c.getFileTypeData();c.getTfsStatusData()}));i.IsLoading=!1}))};n.objExcelMatrixDetails={};n.objExcelMatrixDetails.SelectedMatrix="ImportExcelMatrix";n.objExcelMatrixDetails.SelectedFile="ExcelFile";n.objExcelMatrixDetails.SelectedTable="DecisionTable";n.objExcelMatrixDetails.ExcelFilePath="";n.objExcelMatrixDetails.ExcelSelectedQuery="";n.objExcelMatrixDetails.Precision="6";n.objExcelMatrixDetails.Delimiter=",";n.objExcelMatrixDetails.ColumnIndex=-1;n.objExcelMatrixDetails.RowIndex=-1;n.objExcelMatrixDetails.ExcelNeoTrackID="";n.addRules=function(t){var c,s,u,r,a;if(n.currentEntityExcelMatrix=null,c=v.getEntityIntellisense(),s=c.filter(function(t){return t.ID==n.currentFileName}),s&&s.length>0&&(n.currentEntityExcelMatrix=s[0].Rules.filter(function(n){return n.RuleType=="ExcelMatrix"||n.RuleType=="DecisionTable"}),n.currentEntityExcelMatrix&&n.currentEntityExcelMatrix.length>0))for(u=0;u<n.currentEntityExcelMatrix.length;u++)n.currentEntityExcelMatrix[u].RuleID=n.currentEntityExcelMatrix[u].ID?n.currentEntityExcelMatrix[u].ID.substring(3):"";if(t=="ExcelMatrix"){n.ResetAllPropertiesOfExcelMatrixTemplate();r=n.$new();r.objExcelMatrixDetails=n.objExcelMatrixDetails;r.lstLoadedExcelData=n.lstLoadedExcelData;r.lstInputColumns=n.lstInputColumns;r.lstOutputColumns=n.lstOutputColumns;r.lstSetValuesData=n.lstSetValuesData;r.lstReturnParameters=n.lstReturnParameters;r.lstimportExcelFileData=n.lstimportExcelFileData;r.ReturnTypes=["","bool","DateTime","decimal","double","float","int","long","short","string"];r.dialogOptions={height:700,width:1100};r.templateName="Rule/views/CreateNewExcelMatrix.html";r.templateName&&r.templateName.trim().length>0&&(r.dialog=i.showDialog(r,"New Rule",r.templateName,r.dialogOptions));r.isCodeQuery=!1;var f=!1,h=!1,e=!0,y=!1;r.objLoadFileData;r.OnKeyDowninExcelMatrixFileName=function(t){var u,i;n.currentEntityExcelMatrix&&n.currentEntityExcelMatrix.length>0&&(r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix"?u="ExcelMatrix":r.objExcelMatrixDetails.SelectedMatrix=="ImportExcel"&&(u=r.objExcelMatrixDetails.SelectedTable.toLowerCase()=="excelmatrix"?"excelmatrix":"decisiontable"),i=n.currentEntityExcelMatrix.filter(function(n){return n.RuleType.toLowerCase()==u.toLowerCase()}),t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE?(i&&i.length>0&&$(t.currentTarget).autocomplete("search",$(t.currentTarget).val()),t.preventDefault()):(i&&i.length>0&&setSingleLevelAutoComplete($(t.currentTarget),i,"","RuleID","ID"),t.stopPropagation()))};r.onExcelMatrixNameChanged=function(t){var e,o,i,f,u;if(r.validateExcelMatrixName(t),r.objExcelMatrixDetails.SelectedMatrix=="ImportExcel"?(e=r.objExcelMatrixDetails.SelectedTable.toLowerCase()=="excelmatrix"?"excelmatrix":"decisiontable",o=r.lstimportExcelFileData.filter(function(n){return!angular.equals(t,n)}),angular.forEach(o,function(n){r.validateExcelMatrixName(n)})):r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix"&&(e="ExcelMatrix",o=r.lstLoadedExcelData.filter(function(n){return!angular.equals(t,n)}),angular.forEach(o,function(n){r.validateExcelMatrixName(n)})),i=[],n.currentEntityExcelMatrix&&n.currentEntityExcelMatrix.length>0&&(i=n.currentEntityExcelMatrix.filter(function(n){return t.ExcelMatrixName&&n.ID&&n.ID.toLowerCase().substring(3)==t.ExcelMatrixName.toLowerCase()&&n.RuleType.toLowerCase()==e.toLowerCase()})),i&&i.length>0)if(t.ReturnType="",t.InputColumns=[],t.OutputColumns=[],t.ReturnParameter=[],t.IsStatic=!1,t.ReturnType=i[0].ReturnType,t.isReturnTypeDisable=!0,e=="decisiontable"){if(t.ReturnType=i[0].ReturnType,t.IsStatic=i[0].IsStatic,t.InputColumns&&t.InputColumns.length==0){if(i[0].Parameters)for(f=0;f<i[0].Parameters.length;f++)u={},u.DataType=i[0].Parameters[f].DataType,u.Name=i[0].Parameters[f].ID,i[0].Parameters[f].Direction=="In"?t.InputColumns.push(u):i[0].Parameters[f].Direction=="Out"&&t.OutputColumns.push(u);i[0].ReturnType&&(u={},u.DataType=i[0].ReturnType,u.Name="Return",t.ReturnParameter.push(u))}}else i[0].Parameters&&i[0].Parameters.length>0&&(t.RowParameter.Name=i[0].Parameters[0].ID,t.RowParameter.DataType=i[0].Parameters[0].DataType,t.DefaultOutputValue=i[0].DefaultOutputValue,i[0].Parameters.length>1&&(t.ColumnParameter.Name=i[0].Parameters[1].ID,t.ColumnParameter.DataType=i[0].Parameters[1].DataType));else t.isReturnTypeDisable=!1,e=="decisiontable"?(t.isExistingRule&&(t.ReturnType="",t.InputColumns=[],t.OutputColumns=[],t.ReturnParameter=[],t.IsStatic=!1),t.isExistingRule=!1):t.EffectiveDate=""};r.onExcelMatrixEffectiveDateChanged=function(n){r.validateExcelMatrixEffectiveDate(n)};r.LoadDataFromtheExcelFileAndQuery=function(){var n,t;if(i.IsLoading=!0,f=!1,h=!1,e=!0,y=!1,r.objExcelMatrixDetails.SelectedFile=="ExcelFile"&&(f=!0),r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix"?h=!0:r.objExcelMatrixDetails.SelectedMatrix="ImportExcel",e=r.objExcelMatrixDetails.SelectedTable=="DecisionTable"?!0:!1,h&&(e=!1),r.Parameters=[],r.objExcelMatrixDetails.QueryParameters&&r.objExcelMatrixDetails.QueryParameters.length>0)for(n=0;n<r.objExcelMatrixDetails.QueryParameters.length;n++)t={ID:r.objExcelMatrixDetails.QueryParameters[n].dictAttributes.ID,DataType:r.objExcelMatrixDetails.QueryParameters[n].dictAttributes.sfwDataType,Value:r.objExcelMatrixDetails.QueryParameters[n].Value},r.Parameters.push(t);r.objExcelFileDetails={ExcelFilePath:r.objExcelMatrixDetails.ExcelFilePath,ExcelQuery:r.objExcelMatrixDetails.ExcelSelectedQuery,IsExcelFile:f,IsImportExcelMatrix:h,IsDecisionTable:e,IsCdoQuery:r.objExcelMatrixDetails.isCodeQuery,QueryID:r.objExcelMatrixDetails.QueryID,DataType:r.objExcelMatrixDetails.QueryDataType,Parameters:r.Parameters};$.connection.hubEntityModel.server.loadDataFromtheExcelFile(r.objExcelFileDetails).done(function(n){r.$evalAsync(function(){n&&n.length>0&&n[0].Data.length>0?r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix"?r.lstLoadedExcelData=n:r.lstimportExcelFileData=n:(r.lstLoadedExcelData=[],r.lstimportExcelFileData=[]);r.lstLoadedExcelData&&r.lstLoadedExcelData.length>0&&angular.forEach(r.lstLoadedExcelData,function(n){r.validateExcelData(n)});r.lstimportExcelFileData&&r.lstimportExcelFileData.length>0&&angular.forEach(r.lstimportExcelFileData,function(n){r.validateExcelData(n)});i.IsLoading=!1})})};r.onSelectedTableChanged=function(n){r.objExcelMatrixDetails.SelectedTable=n;angular.forEach(r.lstimportExcelFileData,function(n){n.ExcelMatrixName=n.EffectiveDate="";r.validateExcelData(n)})};r.selectFile=function(n){r.lstLoadedExcelData=[];o.hubMain.server.getFilePath(n=="M","NewExcelMatrix",null,"Excel")};r.getRowParameter=function(n){return n.RowParameter.Name!=null&&n.RowParameter.Name!=""&&n.RowParameter.DataType!=null&&n.RowParameter.DataType!=""?n.RowParameter.Name+"["+n.RowParameter.DataType+"]":""};r.getColumnParameter=function(n){return n.ColumnParameter.Name!=null&&n.ColumnParameter.Name!=""&&n.ColumnParameter.DataType!=null&&n.ColumnParameter.DataType!=""?n.ColumnParameter.Name+"["+n.ColumnParameter.DataType+"]":""};r.validateExcelData=function(n){r.validateExcelMatrixName(n);r.validateExcelMatrixEffectiveDate(n)};r.validateExcelMatrixName=function(t){var i,u=v.getEntityIntellisense();r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix"?i="ExcelMatrix":r.objExcelMatrixDetails.SelectedMatrix=="ImportExcel"&&(i=r.objExcelMatrixDetails.SelectedTable.toLowerCase()=="excelmatrix"?"excelmatrix":"decisiontable");t.ExcelMatrixNameError="";t.ExcelMatrixName&&t.ExcelMatrixName.trim().length>0?n.currentEntityExcelMatrix.some(function(n){return n.ID.toLowerCase()===t.ExcelMatrixName.toLowerCase()})?t.ExcelMatrixNameError="Rule name '"+t.ExcelMatrixName+"' already exists.\nPlease enter a different ID (Name).":isValidIdentifier(t.ExcelMatrixName)?u.some(function(r){return r.Rules.some(function(u){return u.ID&&u.ID.toLowerCase().substring(3)==t.ExcelMatrixName.toLowerCase()&&(r.ID!=n.currentFileName||u.RuleType.toLowerCase()!=i.toLowerCase())})})?t.ExcelMatrixNameError="Rule name '"+t.ExcelMatrixName+"' already exists.\nPlease enter a different ID (Name).":r.objExcelMatrixDetails.SelectedMatrix=="ImportExcel"&&r.lstimportExcelFileData&&r.lstimportExcelFileData.filter(function(n){return t.ExcelMatrixName&&n.ExcelMatrixName&&n.ExcelMatrixName.toLowerCase()==t.ExcelMatrixName.toLowerCase()}).length>1?t.ExcelMatrixNameError="Duplicate File Name.":r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix"&&r.lstLoadedExcelData&&r.lstLoadedExcelData.filter(function(n){return t.ExcelMatrixName&&n.ExcelMatrixName&&n.ExcelMatrixName.toLowerCase()==t.ExcelMatrixName.toLowerCase()}).length>1&&(t.ExcelMatrixNameError="Duplicate File Name."):t.ExcelMatrixNameError="Invalid File Name.":t.ExcelMatrixNameError="File Name cannot be empty.";r.validateExcelMatrixEffectiveDate(t);t.ExcelMatrixNameError=="Invalid File Name."&&t.isExistingRule&&(t.ExcelMatrixNameError="")};r.validateExcelMatrixEffectiveDate=function(t){var u,i;t.isExistingRule=!1;t.ExcelMatrixEffectiveDateError="";r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix"?u="ExcelMatrix":r.objExcelMatrixDetails.SelectedMatrix=="ImportExcel"&&(u=r.objExcelMatrixDetails.SelectedTable.toLowerCase()=="excelmatrix"?"excelmatrix":"decisiontable");i=[];n.currentEntityExcelMatrix&&n.currentEntityExcelMatrix.length>0&&(i=n.currentEntityExcelMatrix.filter(function(n){return t.ExcelMatrixName&&t.ExcelMatrixName.trim().length>0&&n.ID&&n.ID.toLowerCase().substring(3)==t.ExcelMatrixName.toLowerCase()&&n.RuleType.toLowerCase()==u.toLowerCase()}));i&&i.length>0&&(t.EffectiveDate&&t.EffectiveDate.trim().length>0?i[0].EffectiveDates.indexOf(t.EffectiveDate)>-1&&(t.ExcelMatrixEffectiveDateError="A Rule version with effective date already exists.\nPlease select different effective date."):t.ExcelMatrixEffectiveDateError="Default rule already exists.\nPlease select an effective date.",t.isExistingRule=!0)};r.ResetData=function(n){n.ExcelMatrixName="";n.EffectiveDate="";n.DataStartCellVal="";n.ReturnType="";n.DefaultOutputValue="";n.ColumnParameter.Name="";n.ColumnParameter.DataType="";n.ColumnParameter.Description="";n.RowParameter.Name="";n.RowParameter.DataType="";n.RowParameter.Description="";n.isReturnTypeDisable=!1;r.validateExcelMatrixName(n)};r.ResetDataForSetValues=function(n){n.ExcelMatrixName="";n.EffectiveDate="";n.InputColumns=[];n.OutputColumns=[];n.ReturnParameter=[];n.IsStatic=!1;n.IsDescriptionSameAsExpression=!1;n.RowParameter&&(n.RowParameter.Name="",n.RowParameter.DataType="",n.RowParameter.Description="");n.ColumnParameter&&(n.ColumnParameter.Name="",n.ColumnParameter.DataType="",n.ColumnParameter.Description="");n.XAxisCellValue="";n.YAxisCellValue="";n.Value="";n.DistinctFileValue="";n.ReturnType=""};r.createNewExcelMatrix=function(){var o=[],e,u,s,h;if(i.IsLoading=!0,r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix")for(u=0;u<r.lstLoadedExcelData.length;u++)r.isValidImportData(r.lstLoadedExcelData[u])?(r.lstLoadedExcelData[u].IsValid=!0,r.objExcelData=r.lstLoadedExcelData[u],e={DefaultOutputValue:r.objExcelData.DefaultOutputValue,EffectiveDate:r.objExcelData.EffectiveDate,ReturnType:r.objExcelData.ReturnType,DataStartCellVal:r.objExcelData.DataStartCellVal,SheetName:r.objExcelData.SheetName,ExcelMatrixName:r.objExcelData.ExcelMatrixName,IsValid:r.objExcelData.IsValid,IsStatic:r.objExcelData.IsStatic,RowParameter:{Name:r.objExcelData.RowParameter.Name,DataType:r.objExcelData.RowParameter.DataType,Description:r.objExcelData.RowParameter.Description},ColumnParameter:{Name:r.objExcelData.ColumnParameter.Name,DataType:r.objExcelData.ColumnParameter.DataType,Description:r.objExcelData.ColumnParameter.Description},DataColumnIndex:r.objExcelData.ColumnIndex,DataRowIndex:r.objExcelData.RowIndex,Precision:r.objExcelMatrixDetails.Precision,Delimiter:r.objExcelMatrixDetails.Delimiter,blnIsNewExcelFormat:r.objExcelData.blnIsNewExcelFormat,ExcelFilePath:r.objExcelMatrixDetails.ExcelFilePath,IsExcelFile:f,LoadExcelFileDetails:r.objExcelFileDetails,NeoTrackID:r.objExcelMatrixDetails.ExcelNeoTrackID},o.push(e)):r.lstLoadedExcelData[u].IsValid=!1;else for(u=0;u<r.lstimportExcelFileData.length;u++)r.isValidImportData(r.lstimportExcelFileData[u])?(r.lstimportExcelFileData[u].IsValid=!0,r.objExcelData=r.lstimportExcelFileData[u],e={DefaultOutputValue:r.objExcelData.DefaultOutputValue,EffectiveDate:r.objExcelData.EffectiveDate,ReturnType:r.objExcelData.ReturnType,DataStartCellVal:r.objExcelData.DataStartCellVal,SheetName:r.objExcelData.SheetName,ExcelMatrixName:r.objExcelData.ExcelMatrixName,IsValid:r.objExcelData.IsValid,IsStatic:r.objExcelData.IsStatic,RowParameter:{Name:r.objExcelData.RowParameter.Name,DataType:r.objExcelData.RowParameter.DataType,Description:r.objExcelData.RowParameter.Description},ColumnParameter:{Name:r.objExcelData.ColumnParameter.Name,DataType:r.objExcelData.ColumnParameter.DataType,Description:r.objExcelData.ColumnParameter.Description},InputColumns:r.objExcelData.InputColumns,OutputColumns:r.objExcelData.OutputColumns,ReturnParameter:r.objExcelData.ReturnParameter,DataColumnIndex:r.ColumnIndex,DataRowIndex:r.RowIndex,Precision:r.objExcelMatrixDetails.Precision,Delimiter:r.objExcelMatrixDetails.Delimiter,blnIsNewExcelFormat:r.objExcelData.blnIsNewExcelFormat,ExcelFilePath:r.objExcelMatrixDetails.ExcelFilePath,IsExcelFile:f,DistinctFileValue:r.objExcelData.DistinctFileValue,XAxisCellValue:r.objExcelData.XAxisCellValue,YAxisCellValue:r.objExcelData.YAxisCellValue,Value:r.objExcelData.Value,LoadExcelFileDetails:r.objExcelFileDetails,NeoTrackID:r.objExcelMatrixDetails.ExcelNeoTrackID,DescriptionIsSameAsExpression:r.objExcelData.IsDescriptionSameAsExpression?!0:!1},o.push(e)):r.lstimportExcelFileData[u].IsValid=!1;o.length>0?(n.currentFileName!=undefined&&n.currentFilePath!=undefined&&(s=i.currentopenfile.file),n.objRule={},n.objRule.RuleType=t,n.objRule.IsDefaultVersion=!0,n.currentFileName?n.objRule.EntityName=n.currentFileName:(h=getCurrentControllerScope(),n.objRule.EntityName=h.objEntity.dictAttributes.ID),n.objRule.RuleID="",n.objRule.Description="",n.objRule.EffectiveDate="",n.objRule.NeoTrackID="",n.objRule.EntityReturnType="",n.objRule.ReturnType="",n.objRule.IsStatic=!1,n.objRule.IsMatchAllCondition=!1,n.objRule.IsThrowError=!1,n.objRule.IsPrivate=!1,n.objRule.Trace=!1,n.objRule.CacheResult=!1,i.IsLoading=!0,$.connection.hubEntityModel.server.createRule(s,o).done(function(t){n.$apply(function(){var s=n.objRule.EntityName,o=v.getEntityIntellisense(),f,u,h;if(o=o.filter(function(n){return n.ID==s}),$.connection.hubEntityModel.server.getEntityRulesIntellisenseData(s).done(function(n){lstRuleIntellisenseData=[];n&&(lstRuleIntellisenseData=n);o[0].Rules=lstRuleIntellisenseData}),t!=undefined&&t!=null&&t.length>0)for(f=0;f<t.length;f++)n.objRule&&o.length>0&&(u=getScopeByFileName(r.objRule.EntityName),u&&u.lstItemsRulesList&&u.lstItemsRulesList.push(t[f][0]),u.objEntity&&u.objEntity.dictAttributes.ID==r.objRule.EntityName&&(h={DataSourceBasedScenario:null,EntityScenario:null,ExcelBasedScenario:null,ID:t[f][1].ID,IsVisible:!1,ObjectBasedScenario:null,RuleFileDetails:e,Type:e.FileType},u.lstEntityRules.push(h),u.SearchRuleCommand()));i.IsLoading=!1;tt.Message("Message","Complete")})})):n.$evalAsync(function(){i.IsLoading=!1});r.closeNewRuleWindow()};r.isValidImportData=function(n){var i,t;if(r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix"?i="excelmatrix":r.objExcelMatrixDetails.SelectedMatrix=="ImportExcel"&&(i=r.objExcelMatrixDetails.SelectedTable.toLowerCase()=="decisiontable"?"decisiontable":"excelmatrix"),i){if(n.ExcelMatrixNameError&&n.ExcelMatrixNameError.trim().length>0||n.ExcelMatrixEffectiveDateError&&n.ExcelMatrixEffectiveDateError.trim().length>0)return!1;if(i=="excelmatrix"){if(!(n.ReturnType&&n.ReturnType.trim().length>0)||!(n.RowParameter.Name&&n.RowParameter.Name.trim().length>0)||!(n.RowParameter.DataType&&n.RowParameter.DataType.trim().length>0)||!(n.ColumnParameter.Name&&n.ColumnParameter.Name.trim().length>0)||!(n.ColumnParameter.DataType&&n.ColumnParameter.DataType.trim().length>0))return!1;if(r.objExcelMatrixDetails.SelectedMatrix=="ImportExcelMatrix"){if(!(n.DataStartCellVal!==undefined&&n.DataStartCellVal.toString().trim().length>0)||n.ColumnIndex==undefined||n.RowIndex==undefined)return!1}else if(!(n.XAxisCellValue&&n.XAxisCellValue.trim().length>0)||!(n.YAxisCellValue&&n.YAxisCellValue.trim().length>0)||!(n.Value&&n.Value.trim().length>0))return!1}else{if(n.InputColumns&&n.InputColumns.length>0){for(t=0;t<n.InputColumns.length;t++)if(!(n.InputColumns[t].Name&&n.InputColumns[t].Name.trim().length>0)||!(n.InputColumns[t].DataType&&n.InputColumns[t].DataType.trim().length>0))return!1}else return!1;if(n.OutputColumns&&n.OutputColumns.length>0){for(t=0;t<n.OutputColumns.length;t++)if(!(n.OutputColumns[t].Name&&n.OutputColumns[t].Name.trim().length>0)||!(n.OutputColumns[t].DataType&&n.OutputColumns[t].DataType.trim().length>0))return!1}else if(!(n.ReturnParameter&&n.ReturnParameter.length>0))return!1}}else return!1;return!0};r.OnAddOrEditParameter=function(t,u){var f=n.$new();f.ReturnTypes=r.ReturnTypes;f.SelectedDataObj=u;f.SelectedParameter=t;t=="RowParameter"?(f.ParameterName=u.RowParameter.Name,f.ParameterDataType=u.RowParameter.DataType,f.ParameterDescription=u.RowParameter.Description):t=="ColumnParameter"&&(f.ParameterName=u.ColumnParameter.Name,f.ParameterDataType=u.ColumnParameter.DataType,f.ParameterDescription=u.ColumnParameter.Description);f.validateImportExcelMatrixParameter=function(){f.ImportExcelMatrixParameterError="";f.ParameterName&&f.ParameterName.trim().length>0?isValidIdentifier(f.ParameterName)?f.ParameterDataType&&f.ParameterDataType.trim().length>0||(f.ImportExcelMatrixParameterError="Parameter Datatype cannot be empty."):f.ImportExcelMatrixParameterError="Invalid Parameter Name.":f.ImportExcelMatrixParameterError="Parameter Name cannot be empty."};f.validateImportExcelMatrixParameter();f.dialogOptions={height:250,width:500};f.templateName="Rule/views/AddOrEditParameterTemplate.html";f.templateName&&f.templateName.trim().length>0&&(f.dialog=i.showDialog(f,"Add/Edit Parameter",f.templateName,f.dialogOptions));f.onOkAddOrEditClick=function(){f.SelectedParameter=="RowParameter"?(f.SelectedDataObj.RowParameter.Name=f.ParameterName,f.SelectedDataObj.RowParameter.DataType=f.ParameterDataType,f.SelectedDataObj.RowParameter.Description=f.ParameterDescription):f.SelectedParameter=="ColumnParameter"&&(f.SelectedDataObj.ColumnParameter.Name=f.ParameterName,f.SelectedDataObj.ColumnParameter.DataType=f.ParameterDataType,f.SelectedDataObj.ColumnParameter.Description=f.ParameterDescription);f.onCloseAddOrEditClick()};f.onCloseAddOrEditClick=function(){f.dialog&&f.dialog.close();f.SelectedDataObj=null}};r.onDataStartingCellClick=function(t){var r=n.$new();r.SelectedDataStartingCell;r.LoadSomeData=function(){for(var t=0,n=r.lstData.length;n<r.lstobjExceldata.length;n++)if(t++,t==10)break;else r.lstData.push(r.lstobjExceldata[n])};r.lstData=[];r.SelectedDataObj=t;r.lstobjExceldata=t.Data;r.LoadSomeData();r.dialogOptions={height:500,width:600};r.templateName="Rule/views/ExcelDataTemplate.html";r.templateName&&r.templateName.trim().length>0&&(r.dialog=i.showDialog(r,"",r.templateName,r.dialogOptions));r.onOkClickExcelDailog=function(){r.SelectedDataObj.DataStartCellVal=r.SelectedDataStartingCell;r.SelectedDataObj.RowIndex=r.RowIndex;r.SelectedDataObj.ColumnIndex=r.ColumnIndex;r.closeExcelDailog()};r.closeExcelDailog=function(){r.dialog&&r.dialog.close();r.SelectedDataObj=null};r.setSelectedCellData=function(n){r.SelectedDataStartingCell=n};r.setRowIndex=function(n){r.RowIndex=n};r.setColumnIndex=function(n){r.ColumnIndex=n}};r.closeNewRuleWindow=function(){r.dialog&&r.dialog.close()};r.isSetDetailsLoaded=!1;r.onSetValueClick=function(t){var u=n.$new(),f,e,o;for(r.isSetDetailsLoaded&&(f=r.setDetailsScope),u.scopeId=u.$id,u.objExcelMatrixDetails=n.objExcelMatrixDetails,u.lstSetValuesData=[],u.ObjSelectedlstValuesData=t,u.setValues={},u.setValues.ReturnType=u.ObjSelectedlstValuesData.ReturnType,u.setValues.IsStatic=u.ObjSelectedlstValuesData.IsStatic,u.setValues.isExistingRule=u.ObjSelectedlstValuesData.isExistingRule,u.setValues.IsDescriptionSameAsExpression=u.ObjSelectedlstValuesData.IsDescriptionSameAsExpression,u.lstColumns=[],u.lstDummyColumns=[],u.lstKeys=[],u.ObjSelectedlstValuesData.Data.length>0&&angular.forEach(u.ObjSelectedlstValuesData.Data[0],function(n,t){t!="$$hashKey"&&(t!=null?u.lstKeys.push(t):u.lstKeys.push(""))}),f&&(f.ObjSelectedlstValuesData=u.ObjSelectedlstValuesData,f.ResetSetDetailsData()),u.setColumnNamesinLst=function(n){function t(n){n=n.toString();u.lstColumns.push(n.trim());u.lstDummyColumns.push(n.trim())}u.lstColumns=[];u.lstDummyColumns=[];angular.forEach(n,function(n,i){i!="$$hashKey"&&(n!=null?t(n):t(""))})},u.lstInputColumns=[],u.lstOutputColumns=[],u.lstReturnParameters=[],u.InputCanMoveErrorUp=function(){if(u.Flag=!0,u.objselectedInputValue!=undefined)for(var n=0;n<u.lstInputColumns.length;n++)u.lstInputColumns[n]==u.objselectedInputValue&&n>0&&(u.Flag=!1);return u.Flag},u.InputCanMoveErrorDown=function(){if(u.Flag=!0,u.objselectedInputValue!=undefined)for(var n=0;n<u.lstInputColumns.length;n++)u.lstInputColumns[n]==u.objselectedInputValue&&n<u.lstInputColumns.length-1&&(u.Flag=!1);return u.Flag},u.InputmoveErrorUp=function(){var n=u.lstInputColumns.indexOf(u.objselectedInputValue),t=u.lstInputColumns[n-1];u.lstInputColumns[n-1]=u.objselectedInputValue;u.lstInputColumns[n]=t},u.InputmoveErrorDown=function(){var n=u.lstInputColumns.indexOf(u.objselectedInputValue),t=u.lstInputColumns[n+1];u.lstInputColumns[n+1]=u.objselectedInputValue;u.lstInputColumns[n]=t},u.DeleteInputParameter=function(){var n=u.lstInputColumns.indexOf(u.objselectedInputValue);u.lstInputColumns.splice(n,1);u.objselectedInputValue=n!=0?u.lstInputColumns[n-1]:u.lstInputColumns.length>0?u.lstInputColumns[n]:undefined},u.DeleteOutputParameter=function(){var n=u.lstOutputColumns.indexOf(u.objselectedOutputValue);u.lstOutputColumns.splice(n,1);u.objselectedOutputValue=n!=0?u.lstOutputColumns[n-1]:u.lstOutputColumns.length>0?u.lstOutputColumns[n]:undefined},u.DeleteReturnParameter=function(){u.lstReturnParameters.length>0&&u.lstReturnParameters.splice(u.lstReturnParameters.length-1,1)},u.InputDeleteDisable=function(){return u.objselectedInputValue!=undefined?!1:!0},u.OutputDeleteDisable=function(){return u.objselectedOutputValue!=undefined?!1:!0},u.validateImportExcelMatrixParameter=function(){var n;u.ImportExcelMatrixParameterError="";u.SelectedDataObj?n=u.SelectedDataObj:u.ObjSelectedlstValuesData&&(n=u.ObjSelectedlstValuesData);n&&(u.ParameterName&&u.ParameterName.trim().length>0?isValidIdentifier(u.ParameterName)?u.existingParameter(u.ParameterName,n)?u.ImportExcelMatrixParameterError="A Parameter with same name already existing in the selected rule.":u.ParameterDataType&&u.ParameterDataType.trim().length>0||(u.ImportExcelMatrixParameterError="Parameter Datatype cannot be empty."):u.ImportExcelMatrixParameterError="Invalid Parameter Name.":u.ImportExcelMatrixParameterError="Parameter Name cannot be empty.")},u.existingParameter=function(t,i){if(i.ExcelMatrixName&&i.ExcelMatrixName.trim().length>0){var r=n.currentEntityExcelMatrix.filter(function(n){return n.ID==i.ExcelMatrixName});if(r&&r.length>0&&r[0].Parameters.some(function(n){return n.ID==t}))return!0}return!1},u.SelectInputParameter=function(n){u.objselectedInputValue=n},u.OutputmoveErrorUp=function(){var n=u.lstOutputColumns.indexOf(u.objselectedOutputValue),t=u.lstOutputColumns[n-1];u.lstOutputColumns[n-1]=u.objselectedOutputValue;u.lstOutputColumns[n]=t},u.SelectOutputParameter=function(n){u.objselectedOutputValue=n},u.OutputCanMoveErrorUp=function(){if(u.Flag=!0,u.objselectedOutputValue!=undefined)for(var n=0;n<u.lstOutputColumns.length;n++)u.lstOutputColumns[n]==u.objselectedOutputValue&&n>0&&(u.Flag=!1);return u.Flag},u.OutputmoveErrorDown=function(){var n=u.lstOutputColumns.indexOf(u.objselectedOutputValue),t=u.lstOutputColumns[n+1];u.lstOutputColumns[n+1]=u.objselectedOutputValue;u.lstOutputColumns[n]=t},u.OutputCanMoveErrorDown=function(){if(u.Flag=!0,u.objselectedOutputValue!=undefined)for(var n=0;n<u.lstOutputColumns.length;n++)u.lstOutputColumns[n]==u.objselectedOutputValue&&n<u.lstOutputColumns.length-1&&(u.Flag=!1);return u.Flag},u.OnAddOrEditParameterForImportExcel=function(t,f){var e=n.$new();e.isExistingRule=u.ObjSelectedlstValuesData.isExistingRule;e.ReturnTypes=r.ReturnTypes;e.objselectedSetValue=t;e.ParameterName=t.Name;e.ParameterDataType=t.DataType;e.ParameterOperator="";t.Operator&&(e.ParameterOperator=t.Operator);e.ParameterDescription=t.Description;u.validateImportExcelMatrixParameter();f=="Return"&&(e.isReturnParameter=!0);e.dialogOptions={height:250,width:500};e.validateImportExcelMatrixParameter=function(){e.ImportExcelMatrixParameterError="";e.ParameterName&&e.ParameterName.trim().length>0?isValidIdentifier(e.ParameterName)?!f||f=="Return"||e.ParameterDataType&&e.ParameterDataType.trim().length>0||(e.ImportExcelMatrixParameterError="Parameter Datatype cannot be empty."):e.ImportExcelMatrixParameterError="Invalid Parameter Name.":e.ImportExcelMatrixParameterError="Parameter Name cannot be empty."};e.validateImportExcelMatrixParameter();e.Operators=["",">","<","==",">=","<=","!="];e.ParameterType=f;e.templateName="Rule/views/AddOrEditParameterTemplate.html";e.templateName&&e.templateName.trim().length>0&&(e.dialog=i.showDialog(e,"Add/Edit Parameter",e.templateName,e.dialogOptions));e.onOkAddOrEditClick=function(){e.objselectedSetValue.Name=e.ParameterName;e.objselectedSetValue.DataType=e.ParameterDataType;e.objselectedSetValue.Description=e.ParameterDescription;e.objselectedSetValue.Operator=e.ParameterOperator;e.onCloseAddOrEditClick()};e.onCloseAddOrEditClick=function(){e.dialog&&e.dialog.close();e.objselectedSetValue=null}},u.setInputValues=function(n){var t=u.lstColumns[n-1],r,e,i,f,o;if(t&&t.trim().length>0){for(e=!1,r=0;r<u.lstInputColumns.length;r++)if(t==u.lstInputColumns[r].ColumnName){e=!0;break}for(i=0;i<u.lstOutputColumns.length;i++)t==u.lstOutputColumns[i].ColumnName&&u.lstOutputColumns.splice(i,1);e||(f=t,f=f.replace(new RegExp(" ","gi"),""),o={ColumnName:t,Name:f,DataType:"",Description:t},u.lstInputColumns.push(o),u.objselectedInputValue=o,u.OnAddOrEditParameterForImportExcel(u.lstInputColumns[u.lstInputColumns.length-1],"Input"))}},u.setValuesForExistingParameter=function(n,t,i){var r=u.lstColumns[t-1],f=u.lstKeys[t-1];r?(n.ColumnName=r,n.Description=r):n.ColumnName="";n.key=f?"["+f+"]":"";u.OnAddOrEditParameterForImportExcel(n,i);u.ValidateExistingParameterValuesForDecVersion()},u.setOutputValues=function(n){var t=u.lstColumns[n-1],r,e,i,f,o;if(t&&t.trim().length>0){for(e=!1,r=0;r<u.lstOutputColumns.length;r++)if(t==u.lstOutputColumns[r].ColumnName){e=!0;break}for(i=0;i<u.lstInputColumns.length;i++)t==u.lstInputColumns[i].ColumnName&&u.lstInputColumns.splice(i,1);e||(f=t,f=f.replace(new RegExp(" ","gi"),""),o={ColumnName:t,Name:f,DataType:"",Description:t},u.lstOutputColumns.push(o),u.objselectedOutputValue=o,u.OnAddOrEditParameterForImportExcel(u.lstOutputColumns[u.lstOutputColumns.length-1],"Output"))}},u.setReturnParameter=function(n){var t,i,r;u.setValues.ReturnType?(t=u.lstColumns[n-1],t&&t.trim().length>0&&u.lstReturnParameters.length==0&&(i=t,i=i.replace(new RegExp(" ","gi"),""),r={ColumnName:t,Name:i,DataType:"",Description:t},u.lstReturnParameters.push(r),u.objselectedreturnparameter=r,u.OnAddOrEditParameterForImportExcel(u.lstReturnParameters[u.lstReturnParameters.length-1],"Return"))):tt.Message("Message","please select return type to add return parameter")},u.SelectReturnParameter=function(n){u.objselectedreturnparameter=n},u.onSetValuesOkClick=function(){u.ObjSelectedlstValuesData.OutputColumns=[];u.ObjSelectedlstValuesData.InputColumns=[];u.ObjSelectedlstValuesData.ReturnParameter=[];angular.forEach(u.lstOutputColumns,function(n){u.ObjSelectedlstValuesData.OutputColumns.push(n)});angular.forEach(u.lstInputColumns,function(n){u.ObjSelectedlstValuesData.InputColumns.push(n)});u.lstReturnParameters&&u.lstReturnParameters.length>0&&u.ObjSelectedlstValuesData.ReturnParameter.push(u.lstReturnParameters[0]);u.ObjSelectedlstValuesData.DistinctFileValue=u.DistinctFileValue;u.ObjSelectedlstValuesData.XAxisCellValue=u.XAxisCellValue;u.ObjSelectedlstValuesData.YAxisCellValue=u.YAxisCellValue;u.ObjSelectedlstValuesData.Value=u.Value;u.ObjSelectedlstValuesData.ReturnType=u.setValues.ReturnType;u.ObjSelectedlstValuesData.isExistingRule=u.setValues.isExistingRule;u.ObjSelectedlstValuesData.IsDescriptionSameAsExpression=u.setValues.IsDescriptionSameAsExpression;u.ObjSelectedlstValuesData.IsStatic=u.setValues.IsStatic;u.onSetValuescloseClick()},u.onSetValuescloseClick=function(){u.dialog&&(u.dialog.close(),u.ObjSelectedlstValuesData=null)},e=0;e<t.Data.length;e++)if(e<=20)u.lstSetValuesData.push(t.Data[e]);else break;u.setColumnNamesinLst(u.lstSetValuesData[0]);u.ValidateExistingParameterValuesForDecVersion=function(){var t=!1,n;if(u.ErrorMessage="",!t)for(n=0;n<u.lstInputColumns.length;n++)if(!u.lstInputColumns[n].ColumnName){t=!0;u.ErrorMessage="Error : Map Input column for  "+u.lstInputColumns[n].Name;break}if(!t)for(n=0;n<u.lstOutputColumns.length;n++)if(!u.lstOutputColumns[n].ColumnName){t=!0;u.ErrorMessage="Error : Map Output column for  "+u.lstOutputColumns[n].Name;break}if(!t)for(n=0;n<u.lstReturnParameters.length;n++)if(!u.lstReturnParameters[n].ColumnName){t=!0;u.ErrorMessage="Error : Map Return column for  "+u.lstReturnParameters[n].Name;break}};u.objExcelMatrixDetails.SelectedTable=="DecisionTable"?(u.lstInputColumns=[],u.lstOutputColumns=[],u.lstReturnParameters=[],angular.forEach(u.ObjSelectedlstValuesData.InputColumns,function(n){var t=JSON.stringify(n);n=JSON.parse(t);u.lstInputColumns.push(n)}),angular.forEach(u.ObjSelectedlstValuesData.OutputColumns,function(n){var t=JSON.stringify(n);n=JSON.parse(t);u.lstOutputColumns.push(n)}),u.ObjSelectedlstValuesData&&u.ObjSelectedlstValuesData.ReturnParameter.length>0&&(o=JSON.stringify(u.ObjSelectedlstValuesData.ReturnParameter[0]),value=JSON.parse(o),u.lstReturnParameters.push(value)),u.ObjSelectedlstValuesData.isExistingRule&&u.ValidateExistingParameterValuesForDecVersion(),u.dialogOptions={height:700,width:900},u.onDecisionTableDataTypeChanged=function(){u.ObjSelectedlstValuesData.ReturnType==""&&(u.lstReturnParameters=[])},u.DataTypes=r.ReturnTypes,u.templateName="Rule/views/SetValuesForImportExcel.html",u.templateName&&u.templateName.trim().length>0&&(u.dialog=i.showDialog(u,"Set Values",u.templateName,u.dialogOptions))):(u.DistinctFileValue=u.ObjSelectedlstValuesData.DistinctFileValue,u.XAxisCellValue=u.ObjSelectedlstValuesData.XAxisCellValue,u.YAxisCellValue=u.ObjSelectedlstValuesData.YAxisCellValue,u.Value=u.ObjSelectedlstValuesData.Value,u.dialogOptions={height:700,width:900},u.templateName="Rule/views/SetValuesForExcelMatrix.html",u.templateName&&u.templateName.trim().length>0&&(u.dialog=i.showDialog(u,"Set Values",u.templateName,u.dialogOptions)),u.onImoprtExcelValueKeyDown=function(n){var i=n.target,r=n.which?n.which:n.keyCode,t=u.lstColumns;n.ctrlKey&&n.keyCode==$.ui.keyCode.SPACE&&$(i).data("ui-autocomplete")&&(t&&t.length>0&&$(i).autocomplete("search",$(i).val()),n.preventDefault());controlSelection=$(i);t&&t.length>0&&(setSingleLevelAutoComplete(controlSelection,t),n.stopPropagation())},u.SetValuesIntellisenseButtonClick=function(n){var t,i;t=$(n.target).prevAll("input[type='text']");t.focus();t&&(i=u.lstColumns,i&&i.length>0&&(setSingleLevelAutoComplete(t,i),$(t).data("ui-autocomplete")&&$(t).autocomplete("search",$(t).val())));n&&n.stopPropagation()},u.SetValuesYAxisCellValueChange=function(n){u.YAxisCellValue=n},u.SetValuesXAxisCellValueChange=function(n){u.XAxisCellValue=n},u.SetValuesValueChange=function(n){u.Value=n},u.validatesetValues=function(){if(u.YAxisCellValue==undefined||u.YAxisCellValue=="")return u.setvaluesError="Error: Enter Y Axis Value",u.setValueShowError=!0,!0;if(u.lstColumns.indexOf(u.YAxisCellValue.trim())==-1)return u.setvaluesError="Error: Invalid Y Axis Value.",u.setValueShowError=!0,!0;if(u.XAxisCellValue==undefined||u.XAxisCellValue=="")return u.setvaluesError="Error: Enter X Axis Value",u.setValueShowError=!0,!0;if(u.lstColumns.indexOf(u.XAxisCellValue.trim())==-1)return u.setvaluesError="Error: Invalid X Axis Value.",u.setValueShowError=!0,!0;if(u.Value==undefined||u.Value=="")return u.setvaluesError="Error: Enter Value",u.setValueShowError=!0,!0;if(u.lstColumns.indexOf(u.Value.trim())==-1)return u.setvaluesError="Error: Invalid Value.",u.setValueShowError=!0,!0;if(u.DistinctFileValue&&u.lstColumns.indexOf(u.DistinctFileValue.trim())==-1)return u.setvaluesError="Error: Invalid Distinct File Value.",u.setValueShowError=!0,!0;if(u.XAxisCellValue.trim().toLowerCase()===u.YAxisCellValue.trim().toLowerCase()||u.XAxisCellValue.trim().toLowerCase()===u.Value.trim().toLowerCase()||u.XAxisCellValue.trim().toLowerCase()===(u.DistinctFileValue&&u.DistinctFileValue.trim().toLowerCase())||u.YAxisCellValue.trim().toLowerCase()===u.Value.trim().toLowerCase()||u.YAxisCellValue.trim().toLowerCase()===(u.DistinctFileValue&&u.DistinctFileValue.trim().toLowerCase())||u.Value.trim().toLowerCase()===(u.DistinctFileValue&&u.DistinctFileValue.trim().toLowerCase()))return u.setvaluesError="Error: X Axis, Y Axis, Value and Distinct File fields should have different values.",u.setValueShowError=!0,!0;if(u.SetDetailsErrorMessage&&u.SetDetailsErrorMessage.trim().length>0)return u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0;if(f)if(f){if(f.ObjSelectedlstValuesData)return f.ShowError=!0,f.setDetailsReturnType&&f.setDetailsReturnType.trim().length>0?f.setDetailsRowParamName&&f.setDetailsRowParamName.trim().length>0?isValidIdentifier(f.setDetailsRowParamName)?f.existingParameter(f.setDetailsRowParamName,f.ObjSelectedlstValuesData)?(u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0):f.setDetailsRowReturnType&&f.setDetailsRowReturnType.trim().length>0?f.setDetailsColumnParamName&&f.setDetailsColumnParamName.trim().length>0?isValidIdentifier(f.setDetailsColumnParamName)?f.existingParameter(f.setDetailsColumnParamName,f.ObjSelectedlstValuesData)?(u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0):f.setDetailsColumnReturnType&&f.setDetailsColumnReturnType.trim().length>0?(u.setValueShowError=!1,!1):(u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0):(u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0):(u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0):(u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0):(u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0):(u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0):(u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0)}else return u.setValueShowError=!1,!1;else return u.setvaluesError="Error: Enter Correct Values in details section.",u.setValueShowError=!0,!0},u.OnSetDetailsClick=function(){f=n.$new();r.isSetDetailsLoaded=!0;r.setDetailsScope=f;f.ObjSelectedlstValuesData=u.ObjSelectedlstValuesData;f.existingParameter=function(t,i){if(i.ExcelMatrixName&&i.ExcelMatrixName.trim().length>0){n.currentEntityExcelMatrix||(n.currentEntityExcelMatrix=[]);var r=n.currentEntityExcelMatrix.filter(function(n){return n.ID==i.ExcelMatrixName});if(r&&r.length>0&&r[0].Parameters.some(function(n){return n.ID==t}))return!0}return!1};f.ResetSetDetailsData=function(){f.setDetailsReturnType=f.ObjSelectedlstValuesData.ReturnType;f.isSetDetailsReturnTypeDisable=f.ObjSelectedlstValuesData.isReturnTypeDisable;f.setDetailsReturn=f.ObjSelectedlstValuesData.ReturnType;f.setDetailsColumnReturnType=f.ObjSelectedlstValuesData.ColumnParameter.DataType;f.setDetailsColumnReturn=f.setDetailsColumnReturnType;f.setDetailsRowReturnType=f.ObjSelectedlstValuesData.RowParameter.DataType;f.setDetailsRowReturn=f.setDetailsRowReturnType;f.setDetailsRowParamName="";f.setDetailsColumnParamName="";f.setDetailsRowDescription="";f.setDetailsColumnDescription="";f.ObjSelectedlstValuesData.RowParameter.Name&&f.ObjSelectedlstValuesData.RowParameter.Name.trim().length>0?f.setDetailsRowParamName=f.ObjSelectedlstValuesData.RowParameter.Name:u.XAxisCellValue&&(f.setDetailsRowParamName=u.XAxisCellValue.replace(" ",""));f.ObjSelectedlstValuesData.ColumnParameter.Name&&f.ObjSelectedlstValuesData.ColumnParameter.Name.trim().length>0?f.setDetailsColumnParamName=f.ObjSelectedlstValuesData.ColumnParameter.Name:u.YAxisCellValue&&(f.setDetailsColumnParamName=u.YAxisCellValue.replace(" ",""));f.setDetailsRowDescription=f.ObjSelectedlstValuesData.RowParameter.Description&&f.ObjSelectedlstValuesData.RowParameter.Description.trim().length>0?f.ObjSelectedlstValuesData.RowParameter.Description:u.XAxisCellValue;f.setDetailsColumnDescription=f.ObjSelectedlstValuesData.ColumnParameter.Description&&f.ObjSelectedlstValuesData.ColumnParameter.Description.trim().length>0?f.ObjSelectedlstValuesData.ColumnParameter.Description:u.YAxisCellValue};f.ValidateSetDetails=function(){if(f.SetDetailsErrorMessage="",f.ShowError=!0,f.setDetailsReturnType&&f.setDetailsReturnType.trim().length>0)if(f.setDetailsRowParamName&&f.setDetailsRowParamName.trim().length>0)if(isValidIdentifier(f.setDetailsRowParamName))if(f.existingParameter(f.setDetailsRowParamName,f.ObjSelectedlstValuesData))f.SetDetailsErrorMessage="A Parameter with same name already existing in the selected rule.";else if(f.setDetailsRowReturnType&&f.setDetailsRowReturnType.trim().length>0)if(f.setDetailsColumnParamName&&f.setDetailsColumnParamName.trim().length>0)if(isValidIdentifier(f.setDetailsColumnParamName))if(f.existingParameter(f.setDetailsColumnParamName,f.ObjSelectedlstValuesData))f.SetDetailsErrorMessage="A Parameter with same name already existing in the selected rule.";else return f.setDetailsColumnReturnType&&f.setDetailsColumnReturnType.trim().length>0?(f.ShowError=!1,!1):(f.SetDetailsErrorMessage="Column Parameter Data Type cannot be empty.",f.ShowError=!0,!0);else return f.SetDetailsErrorMessage="Invalid Column Parameter Name.",f.ShowError=!0,!0;else return f.SetDetailsErrorMessage="Column Parameter Name cannot be empty.",f.ShowError=!0,!0;else return f.SetDetailsErrorMessage="Row Parameter Data Type cannot be empty.",!0;else return f.SetDetailsErrorMessage="Invalid Row Parameter Name.",!0;else return f.SetDetailsErrorMessage="Row Parameter Name cannot be empty.",!0;else return f.SetDetailsErrorMessage="Return type cannot be empty.",!0};f.ResetSetDetailsData();f.ValidateSetDetails();f.ReturnTypes=r.ReturnTypes;f.dialogOptions={height:600,width:750};f.templateName="Rule/views/SetDetailsForExcelMatrix.html";f.templateName&&f.templateName.trim().length>0&&(f.dialog=i.showDialog(f,"Set Details",f.templateName,f.dialogOptions));f.onSetDetailsCancelClick=function(){f.dialog&&f.dialog.close();f.ResetSetDetailsData()};f.SetDetailsReturnTypeChange=function(n){f.setDetailsReturnType=n};f.SetDetailsRowParameterNameChange=function(n){f.setDetailsRowParamName=n};f.SetDetailsRowReturnTypeChange=function(n){f.setDetailsRowReturnType=n};f.SetDetailsColumnParameterNameChange=function(n){f.setDetailsColumnParamName=n};f.SetDetailsColumnReturnTypeChange=function(n){f.setDetailsColumnReturnType=n};f.onSetDetailsOkClick=function(){f.ObjSelectedlstValuesData.isReturnTypeDisable||(f.ObjSelectedlstValuesData.ReturnType=f.setDetailsReturnType,u.setValues.ReturnType=f.setDetailsReturnType);f.ObjSelectedlstValuesData.ColumnParameter.DataType=f.setDetailsColumnReturnType;f.ObjSelectedlstValuesData.RowParameter.DataType=f.setDetailsRowReturnType;f.ObjSelectedlstValuesData.RowParameter.Name=f.setDetailsRowParamName;f.ObjSelectedlstValuesData.ColumnParameter.Name=f.setDetailsColumnParamName;f.ObjSelectedlstValuesData.RowParameter.Description=f.setDetailsRowDescription;f.ObjSelectedlstValuesData.ColumnParameter.Description=f.setDetailsColumnDescription;f.onSetDetailsCancelClick()}})};r.OnSearchClickInCreateExcelMatrix=function(){var t=n.$new();t.objExcelMatrixDetails=r.objExcelMatrixDetails;t.objExcelMatrixDetails.ExcelQuery=t.objExcelMatrixDetails.ExcelSelectedQuery;t.QueryID=t.objExcelMatrixDetails.QueryID;t.QueryDataType=t.objExcelMatrixDetails.QueryDataType;t.isCodeQuery=t.objExcelMatrixDetails.isCodeQuery;t.QueryParameters=t.objExcelMatrixDetails.QueryParameters;t.parameterTypes=["","int","long","string","decimal","DateTime"];t.QueryDataTypes=["","bool","DateTime","decimal","double","float","int","long","short","string","EntityTable"];r.objExcelMatrixDetails.SelectedFile=="Query"&&(t.templateName="Rule/Views/ExcelMatrixQueryTemplate.html",t.dialog=i.showDialog(t,"Select Query",t.templateName,{height:600,width:1e3}));t.onCloseQueryTemplateClick=function(){t.dialog&&t.dialog.close()};t.setQueryBasedOnEntityandQueryID=function(n){var i,u,f,r;t.isCodeQuery&&(i=n.split("."),t.objExcelMatrixDetails.ExcelQuery="",n!=""&&i.length>1&&(u=v.getEntityIntellisense(),f=u.filter(function(n){return n.ID==i[0]}),i[1]!=""&&i[0]!=""&&(r=f[0].Queries.filter(function(n){return n.ID==i[1]}),r.length>0&&(t.objExcelMatrixDetails.ExcelQuery=r[0].SqlQuery,t.getParametersBasedOnQuery(r[0].SqlQuery)))))};t.onOkQueryTemplateClick=function(){t.objExcelMatrixDetails.ExcelSelectedQuery=t.objExcelMatrixDetails.ExcelQuery;t.objExcelMatrixDetails.QueryID=t.QueryID;t.objExcelMatrixDetails.QueryDataType=t.QueryDataType;t.objExcelMatrixDetails.isCodeQuery=t.isCodeQuery;t.objExcelMatrixDetails.QueryParameters=t.QueryParameters;t.onCloseQueryTemplateClick()};t.getParametersBasedOnQuery=function(n){var c,r,i,s;if(n!=undefined&&n!=""){var h=n,e=h.split(/[\s,()=\r\n]+/),o=[],f,u=[];for(i=0;i<e.length;i++)c=!1,e[i].indexOf("@")>-1&&(f=e[i],o.indexOf(f)==-1&&(r={},r.Name="parameter",r.dictAttributes={},r.dictAttributes.ID=f,r.dictAttributes.sfwDataType="",r.Value="",u.push(r),o.push(f)));for(i=0;i<u.length;i++)s=u[i].dictAttributes.ID,o.indexOf(s)==-1&&u.splice(i,1)}t.QueryParameters=u};t.AddNodeLockOperation=function(){if(t.objExcelMatrixDetails.ExcelQuery){var i=l.createQueryWithNoLock(t.objExcelMatrixDetails.ExcelQuery);i.then(function(i){i&&n.$evalAsync(function(){t.objExcelMatrixDetails.ExcelQuery=i})})}};t.formatQuery=function(){if(t.objExcelMatrixDetails.ExcelQuery){var i=l.formatQuery(t.objExcelMatrixDetails.ExcelQuery);i.then(function(i){i&&n.$evalAsync(function(){t.objExcelMatrixDetails.ExcelQuery=i})})}}}}else n.LoadRuleReturnTypes(t),r=n.$new(),r.showExtraFieldsTab=!1,r.objRuleExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]},r.formName="Rule",r.objDirFunctions={},r.SelectedNewRuleDetailsDialogTab="Details",r.ruleErrorMessageForDisplay=undefined,n.objRule={},r.objRule.RuleType=t,r.objRule.IsDefaultVersion=!0,n.currentFileName?r.objRule.EntityName=n.currentFileName:(a=getCurrentControllerScope(),r.objRule.EntityName=a.objEntity.dictAttributes.ID),r.objRule.RuleID="",r.objRule.Description="",r.objRule.EffectiveDate="",r.objRule.NeoTrackID="",r.objRule.EntityReturnType="",r.objRule.ReturnType="",r.objRule.IsStatic=!1,r.objRule.IsMatchAllCondition=!1,n.objRule.IsThrowError=!1,r.objRule.IsPrivate=!1,r.objRule.Trace=!1,r.objRule.CacheResult=!1,r.newRuleDialog=i.showDialog(r,"New Rule","Rule/views/NewRuleTemplate.html",{height:600,width:1100}),ComponentsPickers.init(),hubMain.server.getAllRuleFiles("ScopeId_"+r.$id),r.receiveAllRuleFiles=function(n){r.$apply(function(){r.files=n})},r.selectNewDetailsDialogTab=function(){r.SelectedNewRuleDetailsDialogTab="Details"},r.selectNewExtraFieldsDialogTab=function(){r.SelectedNewRuleDetailsDialogTab="ExtraFields"},r.CreateNewRuleDetails=function(){r.SelectedNewRuleDetailsDialogTab="Details";r.ID=undefined;r.objExtraFields=[]},r.CreateNewRuleDetails(),r.onSelectedTableChanged=function(n){r.SelectedTable=n;angular.forEach(r.lstimportExcelFileData,function(n){n.ExcelMatrixName=n.EffectiveDate="";r.validateExcelData(n)})},r.validateNewRule=function(){var n,t;if(r.ruleErrorMessageForDisplay=undefined,r.objRule.RuleID)if(isValidIdentifier(r.objRule.RuleID))if(r.objRule.ReturnType!="Collection"&&r.objRule.ReturnType!="List"&&r.objRule.ReturnType!="Object"||r.objRule.EntityReturnType||r.objRule.EntityReturnType.trim().length!=0)if(r.objRule.IsDefaultVersion||r.objRule.EffectiveDate&&r.objRule.EffectiveDate!=""){if(r.files&&r.files.length>0&&(n=r.files.filter(function(n){return n.FileName.toLowerCase()=="rul"+r.objRule.RuleID.toLowerCase()}),n&&n.length>0))return r.ruleErrorMessageForDisplay='Error: The rule name "rul'+r.objRule.RuleID+'"  already exists. Please enter a different Name (ID).',!0}else return r.ruleErrorMessageForDisplay="Error: Effective Date Required.",!0;else return r.ruleErrorMessageForDisplay="Enter Return Entity Type.",!0;else return r.ruleErrorMessageForDisplay="Error: Invalid ID.",!0;else return r.ruleErrorMessageForDisplay="Error: ID cannot be empty.",!0;return(r.objDirFunctions.getExtraFieldData&&(r.objExtraFields=r.objDirFunctions.getExtraFieldData()),t=validateExtraFields(r),t)?(r.ruleErrorMessageForDisplay=r.FormDetailsErrorMessage,!0):r.ruleErrorMessageForDisplay!=""&&r.ruleErrorMessageForDisplay!=undefined?!0:!1},r.DefaultVersionCheckChange=function(){r.objRule.IsDefaultVersion&&(r.objRule.EffectiveDate="");r.validateNewRule()},r.createNewRule=function(){r.objDirFunctions.prepareExtraFieldData&&r.objDirFunctions.prepareExtraFieldData();r.objRule!=undefined&&(n.currentFilePath?$.connection.hubEntityModel.server.createNewRule("rul"+r.objRule.RuleID,r.objRule.Description,r.objRule.RuleType,r.objRule.ReturnType,r.objRule.EffectiveDate,r.objRule.NeoTrackID,r.objRule.EntityName,r.objRule.EntityReturnType,r.objRule.IsStatic,r.objRule.IsMatchAllCondition,r.objRule.IsThrowError,r.objRule.IsDefaultVersion,r.objRule.IsPrivate,n.currentFilePath,r.objRule.Trace,r.objRule.CacheResult,r.objRuleExtraFields).done(function(n){r.receieveNewRule(n)}):$.connection.hubEntityModel.server.createNewRule("rul"+r.objRule.RuleID,r.objRule.Description,r.objRule.RuleType,r.objRule.ReturnType,r.objRule.EffectiveDate,r.objRule.NeoTrackID,r.objRule.EntityName,r.objRule.EntityReturnType,r.objRule.IsStatic,r.objRule.IsMatchAllCondition,r.objRule.IsThrowError,r.objRule.IsDefaultVersion,r.objRule.IsPrivate,i.currentopenfile.file.FilePath,r.objRule.Trace,r.objRule.CacheResult,r.objRuleExtraFields).done(function(n){r.receieveNewRule(n)}))},r.receieveNewRule=function(n){var t=n;r.$apply(function(){var u=t[0],n,o;if(r.files!=null&&(r.files.push(u),i.openFile(u)),r.closeNewRuleWindow(),r.objRule){var e=r.objRule.EntityName,s=v.getEntityIntellisense(),f=s.filter(function(n){return n.ID==e});f.length>0&&(f[0].Rules=f[0].Rules.concat(t[1]));n=getScopeByFileName(e);n!=undefined&&(n&&n.lstItemsRulesList&&n.lstItemsRulesList.push(t[0]),n.objEntity&&n.objEntity.dictAttributes.ID==r.objRule.EntityName&&(o={DataSourceBasedScenario:null,EntityScenario:null,ExcelBasedScenario:null,ID:u.FileName,IsVisible:!1,ObjectBasedScenario:null,RuleFileDetails:u,Type:u.FileType},n.lstEntityRules.push(o),n.SearchRuleCommand()))}})},r.closeNewRuleWindow=function(){r.newRuleDialog.close()}};n.ResetAllPropertiesOfExcelMatrixTemplate=function(){n.lstLoadedExcelData=[];n.lstInputColumns=[];n.lstOutputColumns=[];n.lstSetValuesData=[];n.lstimportExcelFileData=[];n.objExcelMatrixDetails.SelectedMatrix="ImportExcelMatrix";n.objExcelMatrixDetails.SelectedFile="ExcelFile";n.objExcelMatrixDetails.SelectedTable="DecisionTable";n.objExcelMatrixDetails.ExcelFilePath="";n.objExcelMatrixDetails.ExcelNeoTrackID="";n.objExcelMatrixDetails.Precision="6";n.objExcelMatrixDetails.Delimiter=",";n.objExcelMatrixDetails.ColumnIndex=-1;n.objExcelMatrixDetails.RowIndex=-1;n.objExcelMatrixDetails.ExcelSelectedQuery="";n.objExcelMatrixDetails.ExcelQuery="";n.objExcelMatrixDetails.QueryDataType="";n.objExcelMatrixDetails.isCodeQuery=!1;n.objExcelMatrixDetails.QueryID="";n.objExcelMatrixDetails.QueryParameters=[]};n.receiveFilePath=function(t){n.$apply(function(){t.length>0&&(t[0].toLowerCase().endsWith(".xls")||t[0].toLowerCase().endsWith(".xlsx")?n.objExcelMatrixDetails.ExcelFilePath=t[0]:tt.Message("Message","Please select valid Excel File"))})};n.selectNewDetailsDialogTab=function(){n.SelectedNewRuleDetailsDialogTab="Details"};n.selectNewExtraFieldsDialogTab=function(){n.SelectedNewRuleDetailsDialogTab="ExtraFields"};n.AddHyperLinkUrl=function(t){n.currentobjHyperLink=t;var i=JSON.stringify(t);n.objHyperLink=JSON.parse(i);n.Hyperlinkdialog=r.open({template:"AddHyperLinkUrlForNewRule",scope:n,closeByDocument:!1})};n.closeNewRuleDetailsHyperlink=function(){for(var t=0;t<n.objExtraFields.length;t++)n.objExtraFields[t].ID==n.currentobjHyperLink.ID&&(n.currentobjHyperLink.URL=n.objHyperLink.URL,n.currentobjHyperLink.Value=n.objHyperLink.Value);n.Hyperlinkdialog!=undefined&&r.close(n.Hyperlinkdialog.id)};n.onSelectedTableChanged=function(t){n.SelectedTable=t;angular.forEach(n.lstimportExcelFileData,function(t){t.ExcelMatrixName=t.EffectiveDate="";n.validateExcelData(t)})};n.validateHyperLink=function(){if(n.HyperlinkErrorMessage="",this.objHyperLink.Value==undefined||this.objHyperLink.Value=="")return n.HyperlinkErrorMessage="Error: Enter the Description.",!0;if(this.objHyperLink.URL==undefined)return n.HyperlinkErrorMessage="Error: Invalid Hyperlink URL.",(n.currentobjHyperLink.IsRequired=="True"||n.currentobjHyperLink.IsRequired==!0)&&(n.ruleErrorMessageForDisplay="Error: Invalid Hyperlink URL."),!0;var t=n.objHyperLink.URL.match(new RegExp(/^http(s)?:\/\/(www\.)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?/));if(t==null)return n.HyperlinkErrorMessage="Error: Invalid Hyperlink URL.",(n.currentobjHyperLink.IsRequired=="True"||n.currentobjHyperLink.IsRequired==!0)&&(n.ruleErrorMessageForDisplay="Error: Invalid Hyperlink URL."),!0};n.selectionChange=function(t,i){for(var r=n.objExtraFields.indexOf(t),u=0;u<n.objExtraFields[r].Children.length;u++)n.objExtraFields[r].Children[u].ID==i?(n.ID=i,n.objExtraFields[r].Children[u].Value=!0,n.objExtraFields[r].Value=i):n.objExtraFields[r].Children[u].Value=!1;n.validateNewRule()};n.updateExtraFieldTextBoxValue=function(t){var i=n.CreateNewObjectForExtraField(t);n.objRuleExtraFields.Elements.push(i)};n.CreateNewObjectForExtraField=function(n){var t={Name:"ExtraField",dictAttributes:{},Elements:[]};return t.dictAttributes.ID=n.ID,n.Value!=undefined&&(t.dictAttributes.Value=n.Value),t};n.updateExtraFieldCheckBoxListValue=function(t){var i=n.CreateNewObjectForExtraFieldlist(t);(i.Value!=undefined||i.dictAttributes.Value!=undefined)&&n.objRuleExtraFields.Elements.push(i)};n.CreateNewObjectForExtraFieldlist=function(n){for(var i,r="",u=0,t=0;t<n.Children.length;t++)n.Children[t].Value=="True"&&(r+=u==0?n.Children[t].ID:","+n.Children[t].ID,u++);return i={Name:"ExtraField",dictAttributes:{},Elements:[]},i.dictAttributes.ID=n.ID,r!=""&&(i.dictAttributes.Value=r),i};n.updateExtraFieldHyperLinkValue=function(t){var i={Name:"ExtraField",dictAttributes:{},Elements:[]};i.dictAttributes.ID=t.ID;t.Value!=undefined&&(i.dictAttributes.Value=t.Value);t.URL!=undefined&&(i.dictAttributes.URL=t.URL);n.objRuleExtraFields.Elements.push(i)};n.fileNameChanged=function(t){n.$apply(function(){n.ExcelFilePath=t.value;n.$$childTail.ExcelFilePath=t.value;t.value=""})};ut="";n.onRadioButtonClickInExcelMatrix=function(){this.SelectedMatrix!=ut&&ut!=""&&(n.ExcelFilePath="",n.ExcelSelectedQuery="",n.lstLoadedExcelData=[],n.lstimportExcelFileData=[]);ut=this.SelectedMatrix};n.QueryDataType="";i.LoadRuleReturnTypes=function(n){i.ReturnValues=n=="DecisionTable"?["","bool","datetime","decimal","float","double","int","long","short","string"]:["","bool","datetime","decimal","float","double","int","long","short","string","Collection","Object","List"]};n.showErrorPage=function(){var t,r;$("#invalidFiles").length>0||($(".blink-err-btn").length>0&&$(".blink-err-btn").removeClass("blink-err-btn"),t=n.$new(),t.fileErrorList=n.fileErrorList&&n.fileErrorList.length>0?n.fileErrorList:[],t.close=function(){r.close()},r=i.showDialog(t,"Errors: Invalid Files","Common/views/ErrorPage.html",{modal:!1,showclose:!0,isInfoDialog:!0,width:1e3,height:500}))};n.checkIfObject=function(n){return angular.isObject(n)?!0:!1};$.connection&&$.connection.hubMain&&$.connection.hubMain.client&&($.connection.hubMain.client.refreshBrowser=function(){alert("Signalr Hub is shut down. Application will be reloaded.");window.location.href="error_page.html?ERROR_CODE=101"});n.showFormTreeMap=function(n){if(i.currentopenfile&&i.currentopenfile.file){var t=getScopeByFileName(i.currentopenfile.file.FileName);n&&t?t.viewTreeMap=!1:t&&t.showFormTreeMap&&t.showFormTreeMap()}};n.activeFileListKeyDown=function(n){var r=n.which?n.which:n.keyCode,t=$(n.currentTarget).parents("[ui-active-file-wrapper]"),i;switch(r){case 9:$(t).find("li:last").hasClass("selected")?($(t).find("li.selected").removeClass("selected"),$(t).find("li:first").addClass("selected"),st(t)):ot(t);break;case 38:st(t);break;case 40:ot(t)}$(t).find("li.selected").length&&(i=angular.element($(t).find("li.selected")).scope(),i&&i.fileObj&&lt(i.fileObj))};ot=function(n){$(n).find("li.selected").length>0?$(n).find("li:not(:last-child).selected").removeClass("selected").next().addClass("selected"):$(n).find("li:first-child").addClass("selected");$(n).find("li.selected").length>0&&$("[ui-active-file-wrapper] #active-files-list").scrollTo($(n).find("li.selected"),{offsetTop:200,offsetLeft:0},null)};st=function(n){$(n).find("li.selected").length>0&&$(n).find("li:not(:first-child).selected").removeClass("selected").prev().addClass("selected");$(n).find("li.selected").length>0&&$("[ui-active-file-wrapper] #active-files-list").scrollTo($(n).find("li.selected"),{offsetTop:200,offsetLeft:0},null)};n.selectActiveFile=function(n){n&&(i.openFile(n.file),$("#active-files").removeClass("show"),$("#active-files").addClass("hide"))};lt=function(t){t&&(n.activeFileInfo=t)};i.showHelp=function(n){var r=null,t;if(r=n?getKnowtionHelpUrl(n):"Technical Documentation/html/index.html",r){t=i.$new();t.helpUrl=r;t.dialog=i.showDialog(t,"Help","Common/views/HelpDialog.html",{width:900,height:600,showclose:!0,closeOnFocusOut:!0});t.close=function(){t.dialog&&t.dialog.close&&t.dialog.close()};t.isUrlLoaded=!1;function u(n){var t=document.getElementById("help-iframe"),i;try{i=t.contentDocument||t.contentWindow.document;i.readyState=="complete"&&n.$evalAsync(function(){n.isUrlLoaded=!0})}catch(r){n.$evalAsync(function(){n.isUrlLoaded=!0})}n.isUrlLoaded||window.setTimeout(u,100,n)}u(t)}};i.resetRootScopeVarible=function(){n.SideBarSearch={};n.SideBarSearch.listFile=[];n.SideBarSearch.totalRecords=0;n.SideBarSearch.FilefilterText="";n.SideBarSearch.category="";n.CurrentProjectName=undefined;i.IsLoading=!1;i.currentopenfile=null;i.lstopenedfiles=[];i.UndoRedoList=[];i.lstPrevious=[];i.lstNext=[];i.IsOracleDB=!1;i.projectLoadError=!1;i.isstartpagevisible=!1;i.globalSearchText="";delete i.openFromHtx;n.ruleBuildResult=null;i.userIdleTimeout=0;i.rFuncMethods=[];i.isFilesListUpdated=undefined;i.IsProjectInitialLoad=!0;i.IsWorkFlowMap=undefined;i.queryID=undefined;a.clearResourceFactory();k.clearSearchQueryBuilder();v.clearEntityIntellisenseFactory();g.resetData();nt.clearParameterFactory();$("#globalSearch").val("");i.IsTfsUpdated=!0;i.IsTFSConfigured=!1;i.IsTfsUpdated=!0;i.IsFilesAddedDelete=!0};n.showAndHideChatWindow=function(t){n.iblnChatWindowVisible=t};n.showAndHideHelpWindow=function(t){t?$(".chat-help-parent").animate({right:"0px"},1e3):$(".chat-help-parent").animate({right:"-130px"},1e3);n.iblnChatHelpVisible=t}}]);app.controller("PageLayoutController",["$scope","$http","$rootScope","$Errors","$DashboardFactory",function(n,t,i,r,u){n.isstartpagevisible=!1;n.isConfigureSettingsVisible=!1;n.closeFile=function(n){i.CloseCurrentFiles(n)};n.toggleView=function(n){if(i.currentopenfile&&i.currentopenfile.file){var t=getScopeByFileName(i.currentopenfile.file.FileName);t&&t.ShowDesign&&(n=="Design"?(t.isSourceDirty&&i.ClearUndoRedoListByFileName(t.currentfile.FileName),t.ShowDesign()):n=="Source"&&t.ShowSource())}};n.selectDesignSource=function(){if(i.currentopenfile&&i.currentopenfile.file&&i.currentopenfile.file.FileName){var t=getScopeByFileName(i.currentopenfile.file.FileName);return n.isHideUndoredobuttons=!1,t?(n.isHideUndoredobuttons=t.selectedDesignSource,t.selectedDesignSource):!1}return!1};n.getFileTitle=function(){n.currentEntityName="";n.isBpmMapLocked=!1;var r="",t={};if(i.currentopenfile&&i.currentopenfile.file){if(i.currentopenfile.file.FileType&&(t=getCurrentFileScope(),t))switch(i.currentopenfile.file.FileType){case"BPMN":case"BPMTemplate":t.BPMNModel&&t.BPMNModel.Title&&t.BPMNModel.Title.trim().length>0&&(r=t.BPMNModel.Title);i.currentopenfile.file.FileType=="BPMN"&&(t.IsMapEditable||(n.isBpmMapLocked=!0));break;case"Lookup":case"Maintenance":case"Wizard":case"UserControl":case"Tooltip":t.FormModel&&t.FormModel.dictAttributes&&(n.currentEntityName=t.FormModel.dictAttributes.sfwEntity,t.FormModel.dictAttributes.sfwTitle&&t.FormModel.dictAttributes.sfwTitle.trim().length>0&&(r=t.FormModel.dictAttributes.sfwTitle));break;case"LogicalRule":case"ExcelMatrix":t.objLogicalRule&&t.objLogicalRule.dictAttributes&&(n.currentEntityName=t.objLogicalRule.dictAttributes.sfwEntity);break;case"DecisionTable":t.objLogicalRule&&(n.currentEntityName=t.objLogicalRule.Entity);break;case"Correspondence":case"PDFCorrespondence":t.objCorrespondenceDetails&&t.objCorrespondenceDetails.dictAttributes&&(n.currentEntityName=t.objCorrespondenceDetails.dictAttributes.sfwEntity);break;case"FormLinkMaintenance":case"FormLinkLookup":case"FormLinkWizard":t.FormLinkModel&&t.FormLinkModel.dictAttributes&&(n.currentEntityName=t.FormLinkModel.dictAttributes.sfwEntity);break;case"InboundFile":case"OutboundFile":t.objFile&&t.objFile.dictAttributes&&t.objFile.dictAttributes.sfwTitle&&(r=t.objFile.dictAttributes.sfwTitle);break;case"Entity":t.objEntity&&t.objEntity.dictAttributes.sfwParentEntity&&(n.currentEntityName=t.objEntity.dictAttributes.sfwParentEntity)}return r==""&&i.currentopenfile.file.FileName&&(r=i.currentopenfile.file.FileName),r}};n.getTfsIcon=function(){if(i.currentopenfile&&i.currentopenfile.file&&i.currentopenfile.file.FileType){switch(i.currentopenfile.file.FileType){case"BPMN":case"BPMTemplate":""}return i.currentopenfile.file.FileName}};n.getFileTypeIcon=function(){};n.isCurrentFileDirty=function(){if(i.currentopenfile&&i.currentopenfile.file){var n=getScopeByFileName(i.currentopenfile.file.FileName);if(n)return n.isDirty}};n.onDetailClick=function(){var t=i.currentopenfile.file,n;n=getScopeByFileName(t.FileName);t.FileType=="UserControl"||t.FileType=="Tooltip"?n&&n.onUserControlDetailsClick&&n.onUserControlDetailsClick():n&&n.onDetailClick&&n.onDetailClick()};n.showWizardProperty=function(){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);n&&n.showWizardProperty&&n.showWizardProperty()};n.refreshConstants=function(){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);n&&n.onRefreshAllGroups&&n.onRefreshAllGroups()};n.openValidateNew=function(){if(i.currentopenfile&&i.currentopenfile.file){var n=getScopeByFileName(i.currentopenfile.file.FileName);n&&n.OpenValidateNewDialog()}};n.lstViewModel=["Developer View","Analyst View"];n.ViewMode="Developer View";n.setViewMode=function(t){n.ViewMode=t;var r=getScopeByFileName(i.currentopenfile.file.FileName);r&&r.setViewMode(t)};n.versionWiseDisplay=function(){var n=getScopeByFileName(i.currentopenfile.file.FileName);n&&n.versionWiseDisplay()};n.OpenRunResult=function(){var i=n.getRuleName(t),t=getScopeByFileName("MainPage");t&&t.OpenRunResultClick(!1,i)};n.OpenRuleErrors=function(){var i=n.getRuleName(t),t=getScopeByFileName("MainPage");t&&t.OpenRuleErrorsClick(!1,i)};n.getRuleName=function(){var n=getScopeByFileName(i.currentopenfile.file.FileName),t="";return n&&(t=n.objLogicalRule.dictAttributes!=undefined?n.objLogicalRule.dictAttributes.ID:n.objLogicalRule.RuleID),t};n.buildRule=function(n){var t=getScopeByFileName(i.currentopenfile.file.FileName);t&&t.buildRule(n)};n.openRuleInExpression=function(n){var t=getScopeByFileName(i.currentopenfile.file.FileName);t&&t.openRuleInExpression(n)};n.SelectVersion=function(){var t=getScopeByFileName(i.currentopenfile.file.FileName);t&&(t=getScopeByFileName(i.currentopenfile.file.FileName),n.objEffectiveDate=t.objEffectiveDate)};n.UpdateRule=function(n){var t=getScopeByFileName(i.currentopenfile.file.FileName);t&&t.UpdateRule(n)};n.buildRuleClick=function(){var t=getScopeByFileName(i.currentopenfile.file.FileName);t&&(n.CanCreateObjectBasedScenario=t.CanCreateObjectBasedScenario)};n.ScenariosClick=function(){var t=getScopeByFileName(i.currentopenfile.file.FileName);t&&(n.HasRelatedParameterBasedScenario=t.HasRelatedParameterBasedScenario,n.CanCreateObjectBasedScenario=t.CanCreateObjectBasedScenario,n.HasRelatedXLBasedScenario=t.HasRelatedXLBasedScenario,n.HasRelatedObjectBasedScenario=t.HasRelatedObjectBasedScenario)};n.AddNewScenario=function(n,t){var r=getScopeByFileName(i.currentopenfile.file.FileName);r&&r.AddNewScenario(n,t)};n.NavigateToScenario=function(n){var t=getScopeByFileName(i.currentopenfile.file.FileName);t&&t.NavigateToScenario(n)};n.FixAllNodeIds=function(){var n=getScopeByFileName(i.currentopenfile.file.FileName);n&&n.FixAllNodeIds()};n.ScenarioRunAllTests=function(n){var r=i.currentopenfile.file.FileName,t=getScopeByFileName(r);t&&t.RunAllTests&&t.RunAllTests(n)};n.canCreateShowParameterScenario=function(){var n=getCurrentFileScope();if(n&&(i.currentopenfile.file.FileType=="ParameterScenario"||i.currentopenfile.file.FileType=="ObjectScenario"||i.currentopenfile.file.FileType=="ExcelScenario")&&n.IsObjectBasedScenario&&n.objEntityBasedScenario.SelectedStep.IsRunSelected==!0)return!0};n.NavigateToRule=function(){var n=getCurrentFileScope();n&&n.NavigateToRule()};n.RefreshScenario=function(){var n=getCurrentFileScope();n&&n.RefreshScenario()};n.canShowNavigationImage=function(n){var t=getCurrentFileScope();if(t&&(i.currentopenfile.file.FileType=="ParameterScenario"||i.currentopenfile.file.FileType=="ObjectScenario"||i.currentopenfile.file.FileType=="ExcelScenario")&&t.RuleType==n)return!0};n.canShowAddParameterBasedScenario=function(){if(i.currentopenfile.file.FileType=="ObjectScenario"){var n=getCurrentFileScope();if(n&&n.objEntityBasedScenario&&n.objEntityBasedScenario.SelectedStep&&n.objEntityBasedScenario.SelectedStep.IsRunSelected)return!0}return!1};n.onCreateParameterScenario=function(){var n=getCurrentFileScope();n&&n.onCreateParameterScenario()};n.OnOpenValidationRuleDetailsClick=function(){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);n&&n.OnOpenValidationRuleDetailsClick&&n.OnOpenValidationRuleDetailsClick()};n.OnAddPanelClick=function(n){var r=i.currentopenfile.file.FileName,t=getScopeByFileName(r);t&&(n=="Panel"&&t.OnAddPanelClick(-1,!1),n=="Wizard"&&t.OnAddWizardStepClick(-1,!1))};n.getHightlightAttribute=function(){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);n&&!n.selectedDesignSource&&n.getHightlightAttribute()};n.OnSwitchView=function(){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);n&&n.OnSwitchView()};n.isDeveloperView=function(){if(i.currentopenfile&&i.currentopenfile.file){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);if(n)return n.isDeveloperView}else return!1};n.deployBpmnMap=function(n){if(i.currentopenfile.file&&i.currentopenfile.file.FileType=="BPMN"){var r=i.currentopenfile.file.FileName,t=getScopeByFileName(r);t&&t.deployMap&&t.deployMap(n)}};n.loadVersions=function(){if(i.currentopenfile.file&&i.currentopenfile.file.FileType=="BPMN"){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);n&&n.loadVersions&&n.loadVersions()}};n.saveAsPng=function(){if(i.currentopenfile.file&&i.currentopenfile.file.FileType=="BPMN"){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);n&&n.deployMap&&n.saveBPMNAsPng()}};n.openWordTemplateClick=function(){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);n&&n.openWordTemplateClick&&n.openWordTemplateClick()};n.onSynchroniseClick=function(){var t=i.currentopenfile.file.FileName,n=getScopeByFileName(t);n&&n.onSynchroniseClick&&n.onSynchroniseClick()};n.onRefreshClick=function(){var n=getScopeByFileName(i.currentopenfile.file.FileName);n&&(n.isDirty?alert("Please save the file before refresh."):n.OnRefreshClick())};n.onDisplayUnmapColumnclick=function(){var n=getScopeByFileName(i.currentopenfile.file.FileName);n&&n.OnDisplayUnmapColumnclick()};n.onsavefileclick=function(t){var u,e,r,f;if(!t.IsSavePending){if(n.selectDesignSource()==!0){n.onsavefilexmlclick(t);return}u="";t&&(u=t.file.FileType,e=t.file);u=="ExcelScenario"?alert("Excel Scenario cannot be saved."):t&&(r=getScopeByFileName(t.file.FileName),r&&(!r.canSaveFile||r.canSaveFile&&r.canSaveFile())&&(r&&r.BeforeSaveToFile&&r.BeforeSaveToFile(),f=u=="NeoRuleSettings"?n.GetCurrentScopeObjectModel(u,"SettingsPage"):n.GetCurrentScopeObjectModel(u,t.file.FileName),f&&i.SaveModelWithPackets(f,e,u,!1)))}};n.GetCurrentScopeObjectModel=function(n,t){var i=getScopeByFileName(t);return n=="NeoRuleSettings"?i.configureSettingsDetails:n=="LogicalRule"||n=="DecisionTable"||n=="ExcelMatrix"?i.objLogicalRule:n=="ParameterScenario"||n=="ObjectScenario"||n=="ExcelScenario"||n=="DatasourceScenario"?i.objEntityBasedScenario:n=="Entity"?i.objEntity:n=="RuleConstants"?i.objDummyConstants:n=="AuditLog"?i.AuditlogFiledata:n=="ProjectConfiguration"?i.projectconfigurationfiledata:n=="CustomSettings"?i.customsettingsfiledata:n=="Correspondence"?i.objCorrespondenceDetails:n=="Maintenance"||n=="Lookup"||n=="Wizard"||n=="UserControl"||n=="Tooltip"?GetBaseModel(i.FormModel):n=="Report"?i.ReportModel:n=="InboundFile"||n=="OutboundFile"?i.objFile:n=="BPMN"||n=="BPMTemplate"?i.BPMNModel:n=="FormLinkMaintenance"||n=="FormLinkLookup"||n=="FormLinkWizard"?i.FormLinkModel:n=="WorkflowMap"?i.WorkflowMapModel:void 0};i.SaveModelWithPackets=function(n,t,r,u){var f,o,s,e;if(typeof n=="object"&&(f=r=="DecisionTable"?n:r=="BPMN"||r=="BPMTemplate"?n:GetBaseModel(n)),!f||f.Name||f.ID||f.RuleID){for(typeof n=="object"?(o=JSON.stringify(f),s="SaveModel"):(o=n,s="SaveXMLSource"),e=0;e<i.lstopenedfiles.length;e++)if(i.lstopenedfiles[e].file.FileName===t.FileName){i.lstopenedfiles[e].IsSavePending=!0;break}i.IsLoading=!0;typeof n=="object"?hubMain.server.saveModel(o,t,!0,u):hubMain.server.saveXMLString(o,t,!0)}};var f=function(n,t,i){for(var r=0;r<n.length;r++)hubMain.server.receiveDataPackets(n[r],n.length,t,r,i,null)};n.receiveSavedModel=function(t,r){if(i.currentopenfile){var f=r,u=getScopeByFileName(f);u&&(u.$evalAsync(function(){u.isDirty=!1;u&&u.AfterSaveToFile&&u.AfterSaveToFile();i.isFilesListUpdated=!0}),u.currentfile&&u.currentfile.FileName.match("^ent")&&u.ValidateObject())}i.currentopenfile&&i.currentopenfile.file.FileType=="RuleConstants"?hubMain.server.reloadConstantFroValidateExpression().done(function(t){n.UpdateUI(u);t&&alert(t)}):n.UpdateUI(u)};n.receivePendingSaveModel=function(n){if(n)for(var t=0;t<i.lstopenedfiles.length;t++)if(i.lstopenedfiles[t].file.FileName===n){i.lstopenedfiles[t].IsSavePending=!1;break}};n.UpdateUI=function(n){i.$evalAsync(function(){i.IsLoading=!1;i.IsTFSConfigured&&(i.currentopenfile&&(i.currentopenfile.file.TFSState="InEdit",i.updateUserFileDetails(i.currentopenfile.file)),i.IsTfsUpdated=!0,u.getTfsStatusData());n&&n.removeExtraFieldsDataInToMainModel&&n.removeExtraFieldsDataInToMainModel();toastr.success("File saved sucessfully.")})};n.onsavefilexmlclick=function(n){var r;if(n){var u=n.file.FileType,f=n.file,t=getScopeByFileName(n.file.FileName);u=="ExcelScenario"?alert("Excel Scenario cannot be saved."):(t&&t.editor&&(t.isSourceDirty&&i.ClearUndoRedoListByFileName(t.currentfile.FileName),r=t.editor.getValue()),r&&r!=""&&i.SaveModelWithPackets(r,f,u,!1))}};n.openCurrentEntity=function(n){var t=n;$.connection.hubMain.server.navigateToFile(t,"").done(function(n){i.openFile(n,undefined)})};n.validateFile=function(){if(i.currentopenfile&&i.currentopenfile.file){var n=getScopeByFileName(i.currentopenfile.file.FileName);n&&n.validateFileData&&($("#validation-btn").prop("disabled",!0),n.validateFileData(!0))}};n.addNoLockToQueries=function(){if(i.currentopenfile&&i.currentopenfile.file){var n=getScopeByFileName(i.currentopenfile.file.FileName);n&&n.addNoLockToQueries&&n.addNoLockToQueries()}};n.checkValidation=function(){var t=!1;return n.errorListObj=[],r.validationListObj.length>0&&i.currentopenfile&&angular.forEach(r.validationListObj,function(r){r.FileName==i.currentopenfile.file.FileName&&(n.errorListObj=r.errorList,t=n.errorListObj.length>0?!0:!1)}),t};n.checkWarning=function(){var t=!1;return n.warningList=[],r.validationListObj.length>0&&i.currentopenfile&&angular.forEach(r.validationListObj,function(r){r.FileName==i.currentopenfile.file.FileName&&r.warningList&&(n.warningList=r.warningList,t=n.warningList.length>0?!0:!1)}),t};n.showErrorList=function(){r.validationListObj.length>0&&$("#validation-error-list").length>0&&$("#validation-error-list").toggle()};n.showWarnings=function(){r.validationListObj.length>0&&$("#validation-warning-list").length>0&&$("#validation-warning-list").toggle()};n.navigateToError=function(n){if($("#validation-error-list").fadeOut(),$("#validation-warning-list").fadeOut(),i.currentopenfile&&i.currentopenfile.file){var t=getScopeByFileName(i.currentopenfile.file.FileName);t&&t.findParentAndChildObject&&t.findParentAndChildObject(n)}};n.toggleErrorList=function(n){n.isExpand=n.isExpand?!1:!0};n.openLoadDetails=function(){if(i.currentopenfile&&i.currentopenfile.file){var n=getScopeByFileName(i.currentopenfile.file.FileName);n&&n.OpenLoadDetailsDialog()}};n.RefreshWorkflowMap=function(){var n=getCurrentFileScope();n&&n.RefreshWorkflowMap()};n.CutCopyPasteClick=function(n){if(i.currentopenfile&&i.currentopenfile.file){var t=getScopeByFileName(i.currentopenfile.file.FileName);n=="cut"||n=="copy"||n=="paste"?t&&t.OnCopyCutPasteControlClick&&!t.selectedDesignSource&&t.OnCopyCutPasteControlClick(n):(i.currentopenfile.file.FileType=="Lookup"||i.currentopenfile.file.FileType=="Maintenance"||i.currentopenfile.file.FileType=="Wizard"||i.currentopenfile.file.FileType=="Tooltip"||i.currentopenfile.file.FileType=="UserControl"||i.currentopenfile.file.FileType=="Report"||i.currentopenfile.file.FileType=="Correspondence")&&(n=="InsertRowAbove"||n=="InsertRowBelow"||n=="InsertColumnLeft"||n=="InsertColumnRight"||n=="MoveRowUp"||n=="MoveRowDown"||n=="MoveColumnLeft"||n=="MoveColumnRight"?t&&t.OnRowColumnInsertMoveClick&&!t.selectedDesignSource&&t.OnRowColumnInsertMoveClick(n):(n=="InsertCellLeft"||n=="InsertCellRight")&&t&&t.OnInsertCellClick&&!t.selectedDesignSource&&t.OnInsertCellClick(n))}};n.openCentreLeft=function(){if(i.currentopenfile&&i.currentopenfile.file){var n=getScopeByFileName(i.currentopenfile.file.FileName);n&&n.OpenCentreLeftDialog()}}}]);$(document).ready(function(){$(document).on("keydown",function(t){var i;if(t.shiftKey&&t.keyCode==$.ui.keyCode.TAB&&(t.preventDefault(),t.stopPropagation(),t.shiftKey&&$("#active-files").hasClass("hide")&&document.getElementsByClassName("ui-dialog").length==0&&n()),t.ctrlKey&&t.keyCode==90)t.target.localName=="input"&&$(t.target).attr("type")=="text"||$("#btnUndo:not([disabled]):visible").click(),t.preventDefault();else if(t.ctrlKey&&t.keyCode==89)t.target.localName=="input"&&$(t.target).attr("type")=="text"||$("#btnRedo:not([disabled]):visible").click(),t.preventDefault();else{if(t.ctrlKey&&t.keyCode==83)return t.target.localName=="input"&&$(t.target).attr("type")=="text"&&$(t.target).blur(),$("#btnSave:not([disabled]):visible").click(),!1;t.ctrlKey&&t.keyCode==88?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("cut")):t.ctrlKey&&t.keyCode==67?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("copy")):t.ctrlKey&&t.keyCode==86?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("paste")):t.ctrlKey&&t.shiftKey&&t.keyCode==65?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("InsertRowAbove"),t.preventDefault()):t.ctrlKey&&t.shiftKey&&t.keyCode==66?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("InsertRowBelow"),t.preventDefault()):t.ctrlKey&&t.shiftKey&&t.keyCode==76?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("InsertColumnLeft"),t.preventDefault()):t.ctrlKey&&t.shiftKey&&t.keyCode==82?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("InsertColumnRight"),t.preventDefault()):t.ctrlKey&&t.altKey&&t.keyCode==76?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("InsertCellLeft"),t.preventDefault()):t.ctrlKey&&t.altKey&&t.keyCode==82?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("InsertCellRight"),t.preventDefault()):t.altKey&&t.keyCode==$.ui.keyCode.DELETE?(i=getCurrentFileScope(),i&&i.deleteCellClick&&!i.selectedDesignSource&&(i.$evalAsync(function(){i.deleteCellClick()}),t.preventDefault())):t.ctrlKey&&t.keyCode==85?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("MoveRowUp"),t.preventDefault()):t.ctrlKey&&t.keyCode==68?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("MoveRowDown"),t.preventDefault()):t.ctrlKey&&t.keyCode==76?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("MoveColumnLeft"),t.preventDefault()):t.ctrlKey&&t.keyCode==82?(i=getScopeByFileName("PageLayout"),i&&i.CutCopyPasteClick&&i.CutCopyPasteClick("MoveColumnRight"),t.preventDefault()):t.ctrlKey&&t.shiftKey&&t.keyCode==$.ui.keyCode.DELETE?(i=getCurrentFileScope(),i&&i.deleteColumn&&!i.selectedDesignSource&&(i.$evalAsync(function(){i.deleteColumn()}),t.preventDefault())):t.ctrlKey&&t.keyCode==$.ui.keyCode.DELETE?(i=getCurrentFileScope(),i&&i.deleteRow&&!i.selectedDesignSource&&(i.$evalAsync(function(){i.deleteRow()}),t.preventDefault())):t.shiftKey&&t.keyCode==$.ui.keyCode.DELETE?(i=getCurrentFileScope(),i&&i.clearPanel&&!i.selectedDesignSource&&(i.$evalAsync(function(){i.clearPanel()}),t.preventDefault())):t.keyCode==$.ui.keyCode.DELETE&&(i=getCurrentFileScope(),i&&i.DeleteSelectedRowsAndColumns&&i.DeleteSelectedRowsAndColumns())}});$(document).on("keyup",function(n){!n.shiftKey&&$("#active-files").hasClass("show")&&($("[ui-active-file-wrapper]").find("li.selected").length?$("[ui-active-file-wrapper]").find("li.selected").trigger("click"):($("#active-files").removeClass("show"),$("#active-files").addClass("hide")))});history.pushState(null,null,document.URL);window.addEventListener("popstate",function(){history.pushState(null,null,document.URL)});var n=function(){var t=$('body[ng-controller="MainController"]'),n;t&&(rootScope=angular.element(t).scope().$root,rootScope.IsLoading)||(n=$("#active-files"),n.removeClass("hide"),n.addClass("show"),n.find("input").focus(),n.find("li.selected").removeClass("selected"),n.find("li:nth-child(2)").length?n.find("li:nth-child(2)").addClass("selected"):n.find("li:nth-child(1)").addClass("selected"),n.find("input").trigger("keydown"))}});app.controller("CreateClientController",["$scope","$http","$rootScope","ConfigurationFactory","$cookies","$timeout",function(n,t,i,r,u,f){n.lstClient=[];n.lstUser=[];n.Password="sagitec";i.IsProjectLoaded=!0;var e=u.getObject("UserDetails");n.LoginName=JSON.parse(e).UserName;n.getUserClientData=function(){t({method:"POST",data:{},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/GetClientUserData"}).then(function(t){i.IsProjectLoaded=!1;t.data[0].length>0&&(n.lstUser=t.data[0]);t.data[1].length>0&&(n.lstClient=t.data[1])},function(n){i.IsProjectLoaded=!1;i.showExceptionDetails(n.data)})};n.getUserClientList=function(i){t({method:"POST",data:{},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/GetUserClientProjectList"}).then(function(t){n.lstAllUsers=t.data;angular.isArray(n.lstAllUsers)&&n.lstAllUsers.length&&(i=="first"?n.selectUserRow(n.lstAllUsers[0]):i=="last"&&(n.selectUserRow(n.lstAllUsers[n.lstAllUsers.length-1]),f(function(){$("#sg-user-details.userinfo-table").scrollTo($("#sg-user-details.userinfo-table").find("tr.selected"),null,null)})))},function(n){console.log(n)})};n.LogoutSession=function(){function t(){u.remove("UserDetails");n.LoginName="";i.IsLogin=!1;i.IsAdmin=!1;i.isConfigureSettingsVisible=!1;i.isstartpagevisible=!1;toastr.success("User has logged out successfully")}function r(n){i.IsLoading=!1;i.showExceptionDetails(n.data)}$.ajax({url:"api/Login/LogOutUser",type:"GET",async:!1,success:t,error:r})};n.selectClientRow=function(t){n.selectedClient=t};n.updateUserRole=function(i){var e,o;if(i&&n.selectedUser){var u=i.AdminUser,r=u.split(";"),f=r.indexOf(n.selectedUser.UserID.toString());i.userRole!="owner"&&f>-1?r.splice(f,1):i.userRole=="owner"&&f==-1&&r.push(n.selectedUser.UserID.toString());u=r.join(";");e={UserID:n.selectedUser.UserID,ClientID:i.clientId,UserRole:i.userRole,AdminUser:u};o=confirm("Are you sure you want to update user role");o&&t({method:"POST",data:e,headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/UpdateUserRole"}).then(function(t){t.data=="success"?(n.getUserClientData(),toastr.success("User role updated sucessfully.")):toastr.error("User role updation faild")},function(){toastr.error("User role updation faild")})}};n.OpenCreateClient=function(r,u){var f,e;n.lstMapUsers=[];n.mappedADUsers=[];n.lstDeletedMapUser=[];n.lstDeletedADMapUser=[];n.IsUpdate=r;f=n.$new();n.IsUpdate?(n.$evalAsync(function(){i.IsLoading=!0}),f.ClientId=u.ClientID,f.ClientName=u.ClientName,f.SDSLicenseType=u.SDSLicenseType,f.SASLicenseType=u.SASLicenseType,f.SMSLicenseType=u.SMSLicenseType,f.ActiveUserLimit=u.ActiveUserLimit,f.Status=u.Status,f.StartDate=u.StartDate,f.EndDate=u.EndDate,u.AdminUser&&(u.AdminUser=u.AdminUser.replace(/^;/,"")),t({method:"POST",data:{},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/GetMappedUserData?ownerUsers="+u.AdminUser}).then(function(t){n.lstMapUsers=t.data;f.checkValidClient()},function(n){i.showExceptionDetails(n.data)}),t({method:"POST",data:{},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/GetMappedUserData?ownerUsers="+u.AdminUser+"&isADUser=true"}).then(function(t){i.IsLoading=!1;n.mappedADUsers=t.data;f.checkValidClient()},function(n){i.IsLoading=!1;i.showExceptionDetails(n.data)})):f.ClientId=null;f.lstLicensetype=[{ID:"S",Description:"Standard"},{ID:"A",Description:"Advanced"},{ID:"E",Description:"Enterprise"},{ID:"N",Description:"None"}];e=i.showDialog(f,"Create Client","StartUp/views/CreateClientDialog.html",{width:683,height:590});ComponentsPickers.init();f.AddClient=function(){var u,r;for(n.AdminUser="",u={},r=0;r<n.lstMapUsers.length;r++)n.AdminUser==""?n.AdminUser=n.lstMapUsers[r].UserID:n.AdminUser+=";"+n.lstMapUsers[r].UserID;f.successCallback=function(t){i.IsProjectLoaded=!1;n.lstClient=t.data;e.close();var r=n.$new();n.IsUpdate?(n.getUserClientList("first"),toastr.success("Client updated sucessfully.")):(n.getUserClientList(),toastr.success("Client created sucessfully."));n.IsUpdate=undefined};f.errorCallback=function(n){i.IsProjectLoaded=!1;i.showExceptionDetails(n.data)};t({method:"POST",data:{ClientID:f.ClientId,ClientName:f.ClientName,SDSLicenseType:f.SDSLicenseType,SASLicenseType:f.SASLicenseType,SMSLicenseType:f.SMSLicenseType,ActiveUserLimit:f.ActiveUserLimit,Status:f.Status,StartDate:f.StartDate,EndDate:f.EndDate,AdminUser:f.AdminUser,IsUpdateFlag:n.IsUpdate,ActiveDirectoryUsers:f.mappedADUsers},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/CreateUpdateClient"}).then(f.successCallback,f.errorCallback)};f.closeDialog=function(){e.close()};f.selectAdminUser=function(n){f.selectedAdminUser=n};f.selectADOwner=function(n){f.selectedADOwner=n};f.deleteAdminUser=function(){var t=n.lstMapUsers.indexOf(f.selectedAdminUser),i;t>-1&&(n.lstDeletedMapUser.length>0?(i=n.lstDeletedMapUser.map(function(n){return n.UserName}).indexOf(f.selectedAdminUser.UserName),i==-1&&n.lstDeletedMapUser.push(n.lstMapUsers[t])):n.lstDeletedMapUser.push(n.lstMapUsers[t]),n.lstMapUsers.splice(t,1),f.selectedAdminUser=undefined,f.checkValidClient())};f.deleteADUserFromOwners=function(){var t=n.mappedADUsers.indexOf(f.selectedADOwner),i;t>-1&&(n.lstDeletedADMapUser.length>0?(i=n.lstDeletedADMapUser.map(function(n){return n.SAMAccountName}).indexOf(f.selectedADOwner.SAMAccountName),i==-1&&n.lstDeletedADMapUser.push(n.mappedADUsers[t])):n.lstDeletedADMapUser.push(n.mappedADUsers[t]),n.mappedADUsers.splice(t,1),f.selectedADOwner=undefined,f.checkValidClient())};f.checkValidClient=function(){if(f.ClientName&&n.lstClient&&n.lstClient.length>0){var t=n.lstClient.map(function(n){return n.ClientName.toLowerCase()}).indexOf(f.ClientName.toLowerCase());if(t>-1&&!n.IsUpdate||n.IsUpdate&&t>-1&&u.ClientName.toLowerCase()!=f.ClientName.toLowerCase()){f.ClientErrorMessage="Client Name already exist.";f.IsClientError=!0;return}}f.ClientName&&f.ClientName!=""?f.SDSLicenseType&&f.SDSLicenseType!=""?f.SASLicenseType&&f.SASLicenseType!=""?f.SMSLicenseType&&f.SMSLicenseType!=""?f.ActiveUserLimit&&f.ActiveUserLimit!=""?f.ActiveUserLimit<-1?(f.ClientErrorMessage="Active User Limit should be greater than -1",f.IsClientError=!0):f.Status&&f.Status!=""?f.StartDate&&f.StartDate!=""?ValidateDate(f.StartDate)?new Date<Date.parse(f.StartDate)?(f.ClientErrorMessage="Start Date should be less than Or equal to current Date",f.IsClientError=!0):f.EndDate&&!ValidateDate(f.EndDate)?(f.ClientErrorMessage="End Date should be mm/dd/yyyy or mm-dd-yyyy",f.IsClientError=!0):f.EndDate&&Date.parse(f.StartDate)>Date.parse(f.EndDate)?(f.ClientErrorMessage="Start Date should be greater than End Date",f.IsClientError=!0):n.lstMapUsers&&n.lstMapUsers.length!=0||n.mappedADUsers&&n.mappedADUsers.length!=0?(f.ClientErrorMessage="",f.IsClientError=!1):(f.ClientErrorMessage="At least one owner required.",f.IsClientError=!0):(f.ClientErrorMessage="Start Date should be mm/dd/yyyy or mm-dd-yyyy format",f.IsClientError=!0):(f.ClientErrorMessage="Start Date Required",f.IsClientError=!0):(f.ClientErrorMessage="Status Required",f.IsClientError=!0):(f.ClientErrorMessage="Active User Limit Required",f.IsClientError=!0):(f.ClientErrorMessage="SMS LicenseType Required",f.IsClientError=!0):(f.ClientErrorMessage="SAS LicenseType Required",f.IsClientError=!0):(f.ClientErrorMessage="SDS LicenseType Required",f.IsClientError=!0):(f.ClientErrorMessage="Client Name Required",f.IsClientError=!0)};f.MapUsers=function(){var r=n.$new();r.lstUser=[];t({method:"POST",data:{},headers:{"Content-Type":"application/json; charset=utf-8"},async:!1,url:"api/Login/GetUnMappedUserData"}).then(function(t){var i,u;if(r.lstUser=[],r.lstUser=t.data,n.lstMapUsers.length>0&&r.lstUser.length>0)for(i=0;i<n.lstMapUsers.length;i++)u=r.lstUser.map(function(n){return n.UserName}).indexOf(n.lstMapUsers[i].UserName),u>-1&&r.lstUser.splice(u,1);if(n.lstDeletedMapUser.length>0)for(i=0;i<n.lstDeletedMapUser.length;i++)u=r.lstUser.map(function(n){return n.UserName}).indexOf(n.lstDeletedMapUser[i].UserName),u==-1&&r.lstUser.push(n.lstDeletedMapUser[i])},function(n){i.showExceptionDetails(n.data)});dialogMapuser=i.showDialog(r,"Assign User","StartUp/views/ClientUserAssociationDialog.html");r.lstTempMapUser=[];r.OkClick=function(){for(var i,t=0;t<r.lstTempMapUser.length;t++)i=n.lstMapUsers.map(function(n){return n.UserID}).indexOf(r.lstTempMapUser[t].UserID),i<0&&(n.lstMapUsers.push(r.lstTempMapUser[t]),n.lstDeletedMapUser.length>0&&(i=n.lstDeletedMapUser.map(function(n){return n.UserName}).indexOf(r.lstTempMapUser[t].UserName),i>-1&&n.lstDeletedMapUser.splice(i,1)),f.checkValidClient());r.closeDialog()};r.closeDialog=function(){dialogMapuser.close()};r.CheckUserMap=function(n,t){if(n)r.lstTempMapUser.push({UserID:t.UserID,UserName:t.UserName});else{var i=r.lstTempMapUser.map(function(n){return n.UserID}).indexOf(t.UserID);i>-1&&r.lstTempMapUser.splice(i,1)}}};f.mapADUsers=function(){var r=n.$new();r.searchADUser=function(){i.IsLoading=!0;t({method:"POST",data:{samAccounName:r.samAccountName,domainName:r.domainName,name:r.name,email:r.email},headers:{"Content-Type":"application/json; charset=utf-8"},async:!1,url:"api/Login/GetUnMappedADUserData"}).then(function(t){var u,e,f;if(i.IsLoading=!1,r.filterADUsers=t.data,n.lstDeletedADMapUser.length>0)for(u=0;u<n.lstDeletedADMapUser.length;u++)e=r.filterADUsers.filter(function(t){return t.SAMAccountName.toLowerCase()==n.lstDeletedADMapUser[u].SAMAccountName.toLowerCase()&&t.Name.toLowerCase()==n.lstDeletedADMapUser[u].Name.toLowerCase()&&t.DomainName.toLowerCase()==n.lstDeletedADMapUser[u].DomainName.toLowerCase()}),f=n.lstDeletedADMapUser[u],e.length==0&&f.SAMAccountName.toLowerCase().contains(r.samAccountName.toLowerCase())&&f.Name.toLowerCase().contains(r.name.toLowerCase())&&f.DomainName.toLowerCase().contains(r.domainName.toLowerCase())&&r.filterADUsers.push(n.lstDeletedADMapUser[u]);r.removeMappedADUser(r.selectedADUsers,r.filterADUsers);n.mappedADUsers&&n.mappedADUsers.length>0&&r.removeMappedADUser(n.mappedADUsers,r.filterADUsers);r.selectedUserDisplayCount=r.filterUserDisplayCount=30;r.filterUserDisplayCount=30},function(n){i.IsLoading=!1;i.showExceptionDetails(n.data)})};r.OK=function(){var t,i;for(r.beforeOK(),t=0;t<r.selectedADUsers.length;t++)n.mappedADUsers.push(r.selectedADUsers[t]),n.lstDeletedMapUser.length>0&&(i=n.lstDeletedMapUser.map(function(n){return n.SAMAccountName}).indexOf(r.selectedADUsers[t].SAMAccountName),i>-1&&n.lstDeletedMapUser.splice(i,1));f.checkValidClient();r.closeDialog()};r.dialogMapuser=i.showDialog(r,"Assign Active Directory User","StartUp/views/GetActiveDirectoryUsers.html",{width:1200,height:550})};f.checkValidClient()};n.DeleteClient=function(){n.selectedClient&&(i.IsLoading=!0,t({method:"POST",data:{},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/DeleteClient?clientID="+n.selectedClient.ClientID}).then(function(t){n.lstUser=[];n.lstClient=[];i.IsLoading=!1;t.data[0].length>0&&(n.lstUser=t.data[0]);t.data[1].length>0&&(n.lstClient=t.data[1],n.selectedClient=n.lstClient[n.lstClient.length-1]);n.getUserClientList("first");toastr.success("Client Deleted sucessfully.")},function(n){i.IsLoading=!1;i.showExceptionDetails(n.data)}))};n.ChangePassword=function(){var r=u.getObject("UserDetails"),t;r&&JSON.parse(r).UserName!=null&&(t=n.$new(!0),t.showOldPassword=!0,t.userDetails=JSON.parse(r),t.changePasswordDialog=i.showDialog(t,"Change Password","StartUp/views/ChangePasswordDialog.html",{height:440,width:500}),t.changePasswordCallBack=function(){toastr.success("Password changed successfully.");t.closeChangePasswordDialog()},t.closeChangePasswordDialog=function(){t.changePasswordDialog.close()})};n.selectUserRow=function(t){n.selectedUser=t;n.selectClientRow(n.selectedUser.lstClients[0])};n.selectClientRow=function(t){n.selectedClient=t};n.openAddUserDialog=function(r,u){var f=n.$new(!0);f.userOperationType=r;f.selectedUser={UserName:"",FirstName:"",LastName:"",DomainName:""};f.userOperationType=="newUser"?f.saveButtonLabel="Create User":f.userOperationType=="updateUser"&&u&&(n.selectUserRow(u),angular.copy(n.selectedUser,f.selectedUser),f.saveButtonLabel="Update User");f.CreateUserOkClick=function(){var r=-1;n.lstUser.length>0&&(r=n.lstUser.map(function(n){return n.UserName}).indexOf(f.UserName));r<0||f.userOperationType=="updateUser"?t({method:"POST",data:[{UserName:f.selectedUser.UserName,FirstName:f.selectedUser.FirstName,LastName:f.selectedUser.LastName,EmailId:f.selectedUser.EmailId,saveType:f.userOperationType}],headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/CreateUser"}).then(function(t){i.IsProjectLoaded=!1;t.data!="UserExist"?(n.lstUser=t.data,f.dialog.close(),f.userOperationType=="updateUser"?toastr.success("User details updated sucessfully."):(n.getUserClientList("last"),toastr.success("User created sucessfully."))):toastr.error("User already exist.")},function(n){i.IsProjectLoaded=!1;i.showExceptionDetails(n.data)}):toastr.error("User already exist.")};f.CheckValidUser=function(){f.selectedUser.UserName||f.userOperationType!="newUser"?validateEmail(f.selectedUser.UserName)||f.userOperationType!="newUser"?f.selectedUser.FirstName?f.selectedUser.LastName?f.userOperationType!="updateUser"||f.selectedUser.EmailId&&validateEmail(f.selectedUser.EmailId)?(f.ErrorMessage="",f.IsError=!1):(f.ErrorMessage="Invalid emailid",f.IsError=!0):(f.ErrorMessage="Last Name Required",f.IsError=!0):(f.ErrorMessage="First Name Required",f.IsError=!0):(f.ErrorMessage="Invalid username.",f.IsError=!0):(f.ErrorMessage="User Name Required",f.IsError=!0)};f.closeAddUserDialog=function(){f.dialog.close()};f.dialog=i.showDialog(f,f.saveButtonLabel,"StartUp/views/add_new_user.html",{width:650,height:350});f.CheckValidUser()};n.deleteUser=function(){};n.showADUsers=function(){var r=n.$new();r.IsShowRole=!1;r.newAddedADUsers=[];r.OK=function(){var u,f;for(r.beforeOK(),u=0;u<r.selectedADUsers.length;u++)f={UserName:r.selectedADUsers[u].SAMAccountName,FirstName:r.selectedADUsers[u].FirstName,LastName:r.selectedADUsers[u].LastName,EmailId:r.selectedADUsers[u].EmailId,DomainName:r.selectedADUsers[u].DomainName,saveType:"newUser"},r.newAddedADUsers.push(f);r.selectedADUsers.length&&r.newAddedADUsers.length>0&&t({method:"POST",data:r.newAddedADUsers,headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/CreateUser"}).then(function(t){i.IsProjectLoaded=!1;t.data!="UserExist"?(n.lstUser=t.data,n.getUserClientList("last"),r.dialogMapuser.close(),toastr.success("User created sucessfully.")):toastr.error("User already exist.")},function(n){i.IsProjectLoaded=!1;i.showExceptionDetails(n.data)})};r.removeExistingADUser=function(t){var i,r,u;if(angular.isArray(n.lstAllUsers)&&n.lstAllUsers.length)for(i=0;i<n.lstAllUsers.length;i++)r=t.filter(function(t){return t.SAMAccountName.toLowerCase()==n.lstAllUsers[i].UserName.toLowerCase()&&t.DomainName.toLowerCase()==n.lstAllUsers[i].DomainName.toLowerCase()}),r.length>0&&(u=t.indexOf(r[0]),u>-1&&t.splice(u,1))};r.searchADUser=function(){i.IsLoading=!0;t({method:"POST",data:{userID:JSON.parse(e).UserID,samAccounName:r.samAccountName,domainName:r.domainName,name:r.name,email:r.email},headers:{"Content-Type":"application/json; charset=utf-8"},async:!1,url:"api/ConfigureSetting/GetADUsersForMapping"}).then(function(n){i.IsLoading=!1;r.filterADUsers=n.data;r.removeExistingADUser(r.filterADUsers);r.selectedUserDisplayCount=r.filterUserDisplayCount=30;r.filterUserDisplayCount=30},function(n){i.IsLoading=!1;i.showExceptionDetails(n.data)})};r.dialogMapuser=i.showDialog(r,"Add Active Directory User","StartUp/views/GetActiveDirectoryUsers.html",{width:1200,height:550})};n.getUserClientData();n.getUserClientList("first")}]);app.controller("SearchFilesController",["$scope","hubcontext","$rootScope","$filter","$searchQuerybuilder","$ObjectsSearch","$resourceFactory",function(n,t,i,r,u,f,e){function h(){n.lstactiveSearchPanelIDs=["mainSearchCommonCriteriaPanel"];n.objDirFunctions={};n.SelectedFileType="Entity";n.InitAdvanceSearch();o();hubMain.server.prepareFolderPath("");$("[advance-search-wrapper] input").on("keydown",function(t){var i=t.which;if(i==13)return n.$evalAsync(function(){n.GetAllFilesInfo()}),!1})}function o(){n.objEntityExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]}}function s(n,t){if(n){var i=t.indexOf(n.value);n.selected&&i<0?t.push(n.value):!n.selected&&i>=0&&t.splice(i,1)}}n.InitAdvanceSearch=function(){n.lstFileTypes=JSON.parse(JSON.stringify(e.getFileTypeList()));n.lstTfsStatus=JSON.parse(JSON.stringify(e.getTfsStatusList()));n.searchCriteria={fileName:"",containingText:"",location:"",isCreatedDate:!1,isModifiedDate:!1,fromDate:"",toDate:"",fileType:[],TfsStatus:[],QuerySearchList:[]};n.selectedDate={typeOfDate:""};n.queryBuilder=u;n.ResultantFiles=[];n.ResultantExtraFieldFiles=[];setTimeout(function(){var n,t;if($("[autofocus]:not(:focus)").eq(0).focus(),$("[advance-search-wrapper] [st-search]:visible").val(null),n=document.querySelectorAll("[advance-search-wrapper] input[select-all-toggle]"),n.length>0)for(t=0;t<n.length;t++)n[t].checked=!1})};n.getFolderPathIntellisense=function(t){var i=null;i=t.type=="click"?$(t.target).prevAll("input[type='text']"):$(t.target);i&&($(i).autocomplete({minLength:0,appendTo:"#dvIntellisense",open:function(n){$("#dvIntellisense > ul").css({width:"auto",height:"auto",overflow:"auto",maxWidth:"300px",maxHeight:"300px"});setIntellisensePosition(n);$(".tab-content").find(".settings-tab-content").css("pointer-events","none")},source:function(t,i){hubMain.server.getFolderPathIntellisense(t.term.trim(),"",!0).done(function(t){t!=""?(n.responseParsed=parsePathIntellisenseResult(t),i(n.responseParsed)):(n.responseParsed=[],i(n.responseParsed))})},search:function(t){n.searchCriteria.location=t.target.value},select:function(t,i){n.searchCriteria.location=i.item.value},focus:function(n,t){$(".ui-autocomplete > li").attr("title",t.item.label)}}),t.type=="click"&&($(i).focus(),$(i).data("ui-autocomplete")&&$(i).autocomplete("search",$(i).val())),t.ctrlKey&&t.keyCode==$.ui.keyCode.SPACE&&$(i).data("ui-autocomplete")&&($(i).autocomplete("search",$(i).val()),t.preventDefault()))};n.SelectDateType=function(){ComponentsPickers.init();n.selectedDate.typeOfDate=="create"?(n.searchCriteria.isCreatedDate=!0,n.searchCriteria.isModifiedDate=!1):(n.searchCriteria.isModifiedDate=!0,n.searchCriteria.isCreatedDate=!1)};n.onchangecheckboxlst=function(n,t,i){for(var u=n.length,r=0;r<u;r++)if(i.value===n[r].value){s(i,t);break}};n.SelectAllFiles=function(n,t,i){for(var u=n.length,r=0;r<u;r++)n[r].selected=i.target.checked,s(n[r],t);i&&i.stopImmediatePropagation()};n.GetAllFilesInfo=function(u){function s(){if(n.searchCriteria.fileType.length==0)return toastr.info("Please select at least one file type"),!1;if(n.searchCriteria.isCreatedDate&&!n.searchCriteria.fromDate||n.searchCriteria.isModifiedDate&&!n.searchCriteria.fromDate)return toastr.info("Please select From Date"),!1;if(new Date<Date.parse(n.searchCriteria.fromDate))return toastr.info("From Date should be less than Or equal to current Date"),!1;if(n.searchCriteria.fromDate)n.searchCriteria.toDate||(n.searchCriteria.toDate=r("date")(new Date,"MM/dd/yyyy"));else if(n.searchCriteria.toDate){if(!n.searchCriteria.fromDate)return toastr.info("Please select From Date"),!1}else if(n.searchCriteria.toDate&&Date.parse(n.searchCriteria.fromDate)>Date.parse(n.searchCriteria.toDate))return toastr.info("From Date should be greater than To Date"),!1;return!0}var e,o;u||(u=!1);s()&&(i.IsLoading=!0,n.searchCriteria.fileName=n.searchCriteria.fileName.trim(),e=angular.copy(n.searchCriteria),e.containingText&&(o=angular.copy(f.QueryObj),o.Operator="Contains",o.AttributeValue=e.containingText,e.QuerySearchList.push(o)),t.hubSearch.server.getFilesBySearchCriteria(e,u).done(function(t){n.$evalAsync(function(){i.IsLoading=!1;n.ResultantFiles=t})}))};n.advanceSearchOpenfile=function(t){var e,r;["WorkflowMap","ParameterScenario","ObjectScenario","ExcelScenario","BPMN","ExcelMatrix","FormLinkLookup","FormLinkMaintenance","FormLinkWizard"].indexOf(t.FileType)<0&&(e=angular.copy(n.searchCriteria.QuerySearchList),n.searchCriteria.containingText&&(r=angular.copy(f.QueryObj),r.Operator="Contains",r.operatorList=u.getOperatorList(),r.AttributeValue=n.searchCriteria.containingText,e.push(r)),n.queryBuilder.setGlobalQueryBuilderFilters(e));i.openFile(t)};n.togglePanel=function(t){var i=n.lstactiveSearchPanelIDs.indexOf(t);i>=0?n.lstactiveSearchPanelIDs.splice(i,1):n.lstactiveSearchPanelIDs.push(t)};n.searchExtraFields=function(){if(n.objDirFunctions.getExtraFieldData){var r=n.objDirFunctions.getExtraFieldData();r&&r.length>0&&t.hubSearch.server.getExtraFieldFilesBySearchCriteria(r,n.SelectedFileType).done(function(t){n.$evalAsync(function(){i.IsLoading=!1;n.ResultantExtraFieldFiles=t})})}};n.onFileTypeChange=function(t){t&&(n.ResultantExtraFieldFiles=[])};n.clearExtraFieldsList=function(){n.objDirFunctions.resetExtraField&&(o(),n.objDirFunctions.resetExtraField(),n.ResultantExtraFieldFiles=[])};h();n.exportToExcel=function(n){i.IsLoading=!0;t.hubSearch.server.exportSearchResultsToExcel(n).done(function(n){i.IsLoading=!1;n&&MessageBox("Search Exported","Search results exported to:\n"+n,!1,null,{width:550})})}}]);app.controller("DashboardController",["$scope","$rootScope","hubcontext","$DashboardFactory","$Chart","$cookies","ConfigurationFactory","$interval","$http",function(n,t,i,r,u,f,e,o){var s=f.getObject("UserDetails");n.init=function(){var f=r.getFileTypeData(),s,i,h,c;if(n.dashboardData=r.getData,t.IsTFSConfigured=!1,t.isConfigureSettingsVisible==!1,t.currentopenfile=undefined,s=e.getLastProjectDetails(),s&&s.IsWorkFlow&&(t.IsWorkFlowMap=s.IsWorkFlow),s&&s.IsTFS)if(t.IsTFSConfigured=!0,i=r.getTfsStatusData(),i.length>0&&!t.IsTfsUpdated)u.drawPieChart(i,"TfsChart","Name","Count"),$(window).resize(function(){u.drawPieChart(i,"TfsChart","Name","Count")});else{h=o(l,100);function l(){t.IsTfsUpdated?t.IsTfsUpdated&&o.cancel(h):(i=r.getTfsStatusData(),i.length>0&&(o.cancel(h),$("#TfsChart")[0]&&$("#TfsChart").html().trim().length==0&&(u.drawPieChart(i,"TfsChart","Name","Count"),$(window).resize(function(){u.drawPieChart(i,"TfsChart","Name","Count")}))))}}if(f.length>0&&!t.IsFilesAddedDelete)u.drawStackedBarChart(f,"mainChart","ParentType","ChildType"),$(window).resize(function(){u.drawStackedBarChart(f,"mainChart","ParentType","ChildType")});else{c=o(a,100);function a(){t.IsFilesAddedDelete?o.cancel(c):(f=r.getFileTypeData(),f.length>0&&(o.cancel(c),$("#mainChart")[0]&&$("#mainChart").html().trim().length==0&&(u.drawStackedBarChart(f,"mainChart","ParentType","ChildType"),$(window).resize(function(){u.drawStackedBarChart(f,"mainChart","ParentType","ChildType")}))))}}n.updateUserfiles()};n.$on("updateUserFiles",function(){n.updateUserfiles()});n.updateUserfiles=function(){if(t.IsProjectInitialLoad){if(s&&JSON.parse(s).UserID!=null){var u=r.getUserFiles(JSON.parse(s).UserID,e.getLastProjectDetails().ProjectId);u.then(function(t){t&&t.files?i.hubMain.server.getFilePathValid(t.files).done(function(i){if(n.objFiles={},n.$evalAsync(function(){n.objFiles.pinnedFiles=i[0];n.objFiles.recentFiles=i[1]}),r.setPinnedFilesData(i[0]),r.setRecentFilesData(i[1]),t.files.pinnedFiles.length!=i[0].length||t.files.recentFiles.length!=i[1].length){var u=t.files.pinnedFiles.difference(i[0],"FileName"),f=t.files.recentFiles.difference(i[1],"FileName"),e=r.deleteUserFiles({pinnedFiles:u,recentFiles:f});e.then(function(n){n&&toastr.info(u.length+f.length+" invalid file(s) removed from recent and pinned files list",{timeOut:3500})})}}):n.$evalAsync(function(){n.objFiles={}})})}t.IsProjectInitialLoad=!1}else n.$evalAsync(function(){n.objFiles=r.getUserFilesData()})};n.init();n.unPinUserFile=function(t){if(s){var i=r.postUserFiles(t,JSON.parse(s).UserID,"Pin");i.then(function(i){if(i){var u=n.objFiles.pinnedFiles.indexOf(t);u>-1&&(n.objFiles.pinnedFiles.splice(u,1),r.setPinnedFilesData(n.objFiles.pinnedFiles),toastr.success("File unpinned successfully"))}})}}}]);app.factory("$DashboardFactory",["hubcontext","$http","$rootScope","$Chart","ConfigurationFactory","$timeout",function(n,t,i,r,u,f){var e={fileTypeChart:[],TfsStatusChart:[],pinnedFiles:[],recentFiles:[],LegendData:undefined};return n.hubMain&&(n.hubMain.client.setDashboardChartData=function(n,t){n.length>0&&t.length>0&&f(function(){e.fileTypeChart=JSON.parse(n);e.LegendData=JSON.parse(t);$("#mainChart").length==1&&i.IsFilesAddedDelete&&(i.IsFilesAddedDelete=!1,r.drawStackedBarChart(e.fileTypeChart,"mainChart","ParentType","ChildType"),$(window).resize(function(){r.drawStackedBarChart(e.fileTypeChart,"mainChart","ParentType","ChildType")}))},0)},n.hubMain.client.setDashboardTfsChartData=function(n){n.length>0&&(e.TfsStatusChart=JSON.parse(n),$("#TfsChart").length==1&&i.IsTfsUpdated&&(i.IsTfsUpdated=!1,r.drawPieChart(e.TfsStatusChart,"TfsChart","Name","Count"),$(window).resize(function(){r.drawPieChart(e.TfsStatusChart,"TfsChart","Name","Count")})))}),{getFileTypeData:function(){return i.IsFilesAddedDelete&&n.hubMain.server.getDashboardChartData(),e.fileTypeChart},getData:e,getTfsStatusData:function(){return i.IsTfsUpdated&&n.hubMain.server.getDashboardTfsChartData(),e.TfsStatusChart},getUserFilesData:function(){return{pinnedFiles:e.pinnedFiles,recentFiles:e.recentFiles}},getPinnedFilesData:function(){return e.pinnedFiles},getRecentFilesData:function(){return e.recentFiles},setPinnedFilesData:function(n){e.pinnedFiles=n},setRecentFilesData:function(n){e.recentFiles=n},getUserFiles:function(n,r){return t({method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/DashBoard/getUserFiles?userId="+n+"&project_id="+r}).then(function(n){if(!n.data.IsException)return e.pinnedFiles=n.data.pinnedFiles?n.data.pinnedFiles:[],e.recentFiles=n.data.recentFiles?n.data.recentFiles:[],{files:{pinnedFiles:e.pinnedFiles,recentFiles:e.recentFiles}}},function(n){i.showExceptionDetails(n.data)})},postUserFiles:function(n,r,f){var e={UserId:r,ProjectId:u.getLastProjectDetails().ProjectId,FileName:n.FileName,FilePath:n.FilePath,FileType:n.FileType,UserTypeFile:f};return t({method:"POST",data:e,headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/UserAction/PostUserFiles"}).then(function(n){return n},function(n){i.showExceptionDetails(n.data)})},updateUserFiles:function(n){return t({method:"POST",data:n,headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/UserAction/UpdateUserFiles"}).then(function(n){return n},function(n){i.showExceptionDetails(n.data)})},deleteUserFiles:function(n){return t({method:"POST",data:n,headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/UserAction/DeleteUserFiles"}).then(function(n){return n},function(n){i.showExceptionDetails(n.data)})}}}]);app.controller("ChangePasswordController",["$scope","$rootScope","$cookies","$http",function(n,t,i,r){n.ChangePasswordOkClick=function(i){n.checkPassword();n.IsError||r({method:"POST",data:{UserID:i.UserID,Password:i.Password.trim(),oldPassword:i.oldPassword?i.oldPassword.trim():""},headers:{"Content-Type":"application/json; charset=utf-8"},url:"api/Login/ChangePassword"}).then(function(i){t.IsProjectLoaded=!1;i.data=="passwordMatch"?toastr.error("Password has been used in past."):i.data=="oldpasswordNotMatch"?toastr.error("Incorrect old password."):n.userDetails&&n.userDetails.UserName=="admin"?(t.IsAdmin=!0,n.closeDialog(),toastr.success("Password changed successfully.")):n.changePasswordCallBack(i)},function(n){t.IsProjectLoaded=!1;t.showExceptionDetails(n.data)})};n.closeDialog=function(){n.closeChangePasswordDialog()};n.checkPassword=function(){n.showOldPassword&&!n.userDetails.oldPassword?(n.IsError=!0,n.ErrorMessage="Please enter old password."):n.userDetails.Password?n.userDetails.Password.indexOf(" ")>=0?(n.IsError=!0,n.ErrorMessage="Space not allowed"):/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*?&])[A-Za-z\d$@$!%*?&]{6,}/.test(n.userDetails.Password)?n.confirmPassword&&n.confirmPassword!=""?n.confirmPassword!=n.userDetails.Password?(n.IsError=!0,n.ErrorMessage="Password confirmation does't match password."):(n.IsError=!1,n.ErrorMessage=""):(n.IsError=!0,n.ErrorMessage="Please confirm your password."):(n.IsError=!0,n.ErrorMessage="Password must Contain at least one Uppercase Alphabet, one Lowercase Alphabet, one Number, one Special Character and minimum six characters"):(n.IsError=!0,n.ErrorMessage="Please enter new password.")};n.checkPassword();$("input[type=password]").bind("copy paste",function(n){n.preventDefault()});n.ShowHidePassword=function(n,t){document.getElementById(t).type=n?"text":"password"}}]);app.controller("GetActiveDirectoryUsersController",["$scope",function(n){n.$parent.dialogMapuser=null;n.$parent.selectedADUsers=[];n.$parent.samAccountName="";n.$parent.name="";n.$parent.domainName="";n.$parent.email="";n.selectADUser=function(t,i){var u=n.llstUnMappedADUsers.indexOf(t),f=n.selectedADUsers.indexOf(t),r;u>-1&&f==-1&&(n.llstUnMappedADUsers.splice(u,1),r={},angular.copy(t,r),n.$parent.IsShowRole&&(r.UserType="developer"),r.editableEmailId=t.EmailID,i||i===0?n.selectedADUsers.splice(0,0,r):n.selectedADUsers.push(r));n.$parent.validateEmail()};n.deSelectADUser=function(t,i){var u=n.llstUnMappedADUsers.indexOf(t),r=n.selectedADUsers.indexOf(t);r>-1&&u==-1&&(n.selectedADUsers.splice(r,1),i||i===0?n.llstUnMappedADUsers.splice(0,0,t):(delete t.editableEmailId,n.llstUnMappedADUsers.push(t)));n.$parent.validateEmail()};n.selectAllADUsers=function(){if(n.llstUnMappedADUsers&&n.llstUnMappedADUsers.length>0){for(var t=n.llstUnMappedADUsers.length-1;t>=0;t--)n.selectADUser(n.llstUnMappedADUsers[t],0);n.filterUserDisplayCount=n.selectedUserDisplayCount=30}};n.deSelectAllADUsers=function(){for(var t=n.selectedADUsers.length-1;t>=0;t--)n.deSelectADUser(n.selectedADUsers[t],0);n.filterUserDisplayCount=n.selectedUserDisplayCount=30};n.clearSearchCriteria=function(){n.$parent.samAccountName="";n.$parent.name="";n.$parent.domainName="";n.$parent.email=""};n.$parent.closeDialog=function(){n.$parent.dialogMapuser&&n.$parent.dialogMapuser.close&&n.$parent.dialogMapuser.close()};n.$parent.beforeOK=function(){n.validateEmail();for(var t=0;t<n.$parent.selectedADUsers.length;t++)n.$parent.selectedADUsers[t].EmailId=n.$parent.selectedADUsers[t].editableEmailId};n.$parent.validateEmail=function(){n.$parent.errorMessage=n.$parent.selectedADUsers.some(function(n){return!n.editableEmailId})?"One or more user doesn't have email id.":n.$parent.selectedADUsers.some(function(n){return!validateEmail(n.editableEmailId)})?"One or more user doesn't have valid email id.":""}}]);