function GetClosestLogicalRule(n,t,i){var r,u=!1;return i=="DecisionTable"?n.Rules!=null&&n.Rules.length>0&&(angular.forEach(n.Rules,function(n){var i=n.EffectiveDate;if(i==t){r=n;u=!0;return}}),u||angular.forEach(n.Rules,function(n){if(n.EffectiveDate==undefined||n.EffectiveDate==""){r=n;return}})):(angular.forEach(n.Elements,function(n){if(n.Name=="logicalrule"&&n.dictAttributes.sfwEffectiveDate==t){r=n;u=!0;return}}),u||angular.forEach(n.Elements,function(n){if(n.Name=="logicalrule"){(n.dictAttributes.sfwEffectiveDate==undefined||n.dictAttributes.sfwEffectiveDate=="")&&(r=n);return}})),r}function UpdateTestExecutionFlow(n,t,i,r){t=="LogicalRule"?CheckAndSelectStepForLogicalRule(n,i,r):t=="DecisionTable"?CheckAndSelectStepForDecisionTable(n,i):t=="ExcelMatrix"&&prepareExcelMatrix(n,i)}function CheckAndSelectStepForLogicalRule(n,t,i){angular.forEach(t.Elements,function(t){t.Name!="variables"&&CheckAndUpdateStep(t,n,i)})}function CheckAndUpdateStep(n,t,i){n.VisibilityStatus=!1;n.IsStepSelected=!1;CheckAndSelectStep(n,t,i);angular.forEach(n.Elements,function(n){n.Name!="items"&&CheckAndUpdateStep(n,t,i)});n.Children!=undefined&&angular.forEach(n.Children,function(n){n.Name!="items"&&CheckAndUpdateStep(n,t,i)});CheckAndUpdateBottomLineUnSelectedStatus(n.Elements);n.Children!=null&&CheckAndUpdateBottomLineUnSelectedStatus(n.Children);n.Name=="switch"&&CheckAndUpdateCondtionChildrenLineStatus(n)}function CheckAndUpdateBottomLineUnSelectedStatus(){}function CheckAndUpdateCondtionChildrenLineStatus(){}function getRuleStep(n,t){for(var u,i,r=0;r<n.length;r++)if(n[r].istrNodeID==t.dictAttributes.sfwNodeID){i=n[r];break}if(!i&&t.dictAttributes.sfwCommented=="True"&&t.Children&&t.Children.length>0)for(u=0;u<t.Children.length;u++)if(i=getRuleStep(n,t.Children[u]),i)break;return i}function CheckAndSelectStep(n,t,i){n.IsStepSelected=!1;n.isExpanded=!1;var r;r=getRuleStep(t,n);n.ActualValue=undefined;r!=undefined?r.istrNodeID==n.dictAttributes.sfwNodeID?(r.iobjValue instanceof Date?n.ActualValue=r.iobjValue.toString():(undefined!=r.iobjValue&&(n.ActualValue=r.iobjValue.toString()),r.iobjValue!=undefined),n.IsErrorOccured=r.iblnErrorOccurred,n.IsStepSelected=!0,n.isExpanded=!0,CheckAndUpdateCondtionStepsStatus(n),n.VisibilityStatus=!0,i=="AllRuleSteps"&&(n.Name=="calllogicalrule"||n.Name=="calldecisiontable"||n.Name=="callexcelmatrix")?(n.TestExeRuleObject=r,n.OpenExecutionWindow=!0):(n.Name=="foreach"||n.Name=="while")&&(n.CanExpandOrCollapse=!1,n.TestExeRuleObject=r,UpdateLoopExecutionCountForLoop(n.TestExeRuleObject,n))):(n.IsStepSelected=!0,n.isExpanded=!0,n.VisibilityStatus=!0):n.isExpanded=!1}function CheckAndUpdateCondtionStepsStatus(){}function UpdateLoopExecutionCountForLoop(n,t){if(n!=undefined){var i=0;angular.forEach(n.ilstSteps,function(n){if(n.length>0){var r;angular.forEach(n,function(n){if(n.istrNodeID==t.dictAttributes.sfwNodeID){r=n;return}});r!=undefined&&i++}});t.LoopExecutionCount=i}}function GetCollectionEntityActualVale(){}function CheckAndSelectStepForDecisionTable(n,t){t!=undefined&&(angular.forEach(t.Rows,function(i){i.IsVisiblefterExecution=!0;angular.forEach(i.Cells,function(i){CheckAndUpdateStepForDecisionTable(i.Item,n,t)})}),angular.forEach(t.DataHeaders,function(i){CheckAndUpdateStepForDecisionTable(i,n,t)}))}function CheckAndUpdateStepForDecisionTable(n,t){var i,r=t.filter(function(t){return t.istrNodeID==n.NodeID});r&&r.length>0&&(i=r[0]);n.ActualValue=undefined;i!=undefined?(undefined!=i.iobjValue&&(n.ActualValue=i.iobjValue.toString()),n.IsErrorOccured=i.iblnErrorOccurred,n.IsStepSelected=!0,n.ItemType=="assign"):n.ItemType=="rowheader"&&(n.IsStepSelected=!0)}function UpdateRelatedStepBackground(n,t){var r=-1,u=-1,f;if(angular.forEach(t.Rows,function(i){angular.forEach(i.Cells,function(f){if(f.Item.NodeID==n.NodeID){r=t.Rows.indexOf(i);u=i.Cells.indexOf(f);return}});r>=0}),r>=0&&u>=0)for(i=0;i<u;i++)f=t.Rows[r].Cells[i],f.Item.ItemType=="assign"&&(f.Item.IsRelatedStepAfterExecution=!0)}function CheckAndSelectStepForExcelMatrix(n,t){t.Elements!=undefined&&t.Elements.length>0&&angular.forEach(t.Elements,function(t){if(t.Name.toString().toLowerCase()=="rows")for(var i=0;i<t.Elements.length;i++)angular.forEach(n,function(n){if(t.Elements[i].dictAttributes.sfwNodeID==n.istrNodeID){t.IsStepSelected=!0;t.Elements[i].OtherData=n.iobjData;return}})})}function prepareExcelMatrix(n,t){var f,u,h,o,l,s,i,r,e,c;for(t.objColumnValues=[],t.objExcelColumnValues=[],t.objHeaderRowValues=[],t.objHeaderColumnValues=[],t.objHeaderRowTitle="",t.objRows=[],f=t,i=0;i<f.Elements.length;i++)if(f.Elements[i].Name.toString().toLowerCase()=="rows")for(r=f.Elements[i],u=0;u<r.Elements.length;u++)r.Elements[u].dictAttributes.ID==0?(h=r.Elements[u].dictAttributes.sfwColumnValues,r.Elements[u].dictAttributes.Value!=undefined&&(t.objHeaderRowTitle=r.Elements[u].dictAttributes.Value),o=[],o=h.split(t.dictAttributes.sfwDelimiter),t.objHeaderColumnValues.push(o)):(h=r.Elements[u].dictAttributes.sfwColumnValues,o=[],o=h.split(t.dictAttributes.sfwDelimiter),t.objExcelColumnValues.push(o),t.objHeaderRowValues.push(r.Elements[u].dictAttributes.Value));if(e=CheckAndSelectStepForExcelMatrix(n,t),l=0,n)for(s=0;s<n.length;s++)if(n[s].istrNodeName=="row")for(i=0;i<t.objHeaderRowValues.length;i++)t.objHeaderRowValues[i]==n[s].iobjData[0]&&(l=i,t.selectedHeaderValue=n[s].iobjData[1]);if(t.objExcelColumnValues.length>25)for(i=0;i<25;i++)t.objColumnValues.push(t.objExcelColumnValues[i]);else t.objColumnValues=t.objExcelColumnValues;for(i=0;i<f.Elements.length;i++)if(f.Elements[i].Name.toString().toLowerCase()=="rows")for(r=f.Elements[i],e=0;e<r.Elements.length;e++)r.Elements[e].OtherData!=undefined&&(c=-1,angular.forEach(t.objHeaderColumnValues[0],function(n){if(n==r.Elements[e].OtherData[1]){c=t.objHeaderColumnValues[0].indexOf(n);return}}),t.objOtherData=[r.Elements[e].OtherData[0],c])}function GetExpressionValue(n,t){var i="";return t!==undefined&&t!==""&&(i=t.contains(".")?CheckAndGetExpressionValue(n,t):t),i}function CheckAndGetExpressionValue(n,t){var u="",i=t.split("."),r,f,e;if(i!==undefined&&i.length!=undefined)for(r=0;r<i.length;r++)f=GetCollectionName(n,i[r]),i[r]!==f?(e=CheckAndGetExpressionValue(n,f),e!==undefined&&e!=""&&(u+=e+".")):u+=f+".";return u.substring(0,u.length-1)}function GetCollectionName(n,t){for(var r=t,i=GetLoopParent(n);i!==undefined;){if(i!==undefined&&(i.dictAttributes.sfwObjectID==t||i.dictAttributes.sfwItemName==t)){r=i.dictAttributes.sfwObjectID;break}i=GetLoopParent(i)}return r}function GetLoopParent(n){var i,t;if(n!=undefined)for(t=n.ParentVM;t!==undefined;){if(t.Name=="foreach"){i=t;break}t=t.ParentVM}return i}function GetLoopParameter(n,t){var i,r;return t!==undefined&&t!==""&&(t.contains(".")?angular.forEach(t.split("."),function(t){if(i==undefined){var r;angular.forEach(n.Elements,function(n){n.Name=="parameters"&&(r=n)});r!==undefined&&(i=GetLoopParameter1(r.Elements,t))}else i!==undefined&&(i=GetLoopParameter1(i.Elements,t))}):(angular.forEach(n.Elements,function(n){n.Name=="parameters"&&(r=n)}),r!==undefined&&(i=GetLoopParameter1(r.Elements,name)))),i}function GetLoopParameter1(n,t){var i;return angular.forEach(n,function(n){var r=n.dictAttributes.sfwDataType,u=n.dictAttributes.ID;if(u==t&&(r=="Collection"||r=="CDOCollection"||r=="List")){i=n;return}}),i}function GetEntityFieldsFromRuleDataInfo(n){var t=[];return n.ruleDataInfo!=undefined&&(n.ruleDataInfo.ilstEntityFields!=undefined?t=n.ruleDataInfo.ilstEntityFields:n.dictAttributes.ParameterType=="InputParameter"?t=n.ruleDataInfo.ilstInputFields:n.dictAttributes.ParameterType=="OutputParameter"&&(t=n.ruleDataInfo.ilstOutputFields),t==undefined&&(t=[])),t}function AddColumnForCollection(n,t,i,r){var f,e,o,u;n.ruleDataInfo!=undefined&&(f=n.ruleDataInfo.istrEntity,f!=undefined&&f!=""&&(e=r.getEntityAttributeIntellisense(f,!0),o=JSON.stringify(e),e=JSON.parse(o),t.lstEntityFieldsCollection=[],r.UndRedoBulkOp("Start"),angular.forEach(e,function(i){var u=GetEntityFieldsFromRuleDataInfo(n,undefined);this.IsFieldExist(u,i.ID,n.ExtraFields)||(i.IsSelected=!1,i.EntityId=f,r.PushItem(i,t.lstEntityFieldsCollection))}),r.UndRedoBulkOp("End"),u=i.$new(),u.lstEntityFieldsCollection=t.lstEntityFieldsCollection,u.SelectAllEntityFields=function(){SelectAllEntityFields(u.lstEntityFieldsCollection)},u.ClearAllEntityFields=function(){ClearAllEntityFields(u.lstEntityFieldsCollection)},u.OnOKClickEntityFields=function(){OnOKClickEntityFields(t.SelectedTestField,u.lstEntityFieldsCollection,u,r)},u.OnCloseClickEntityFields=function(){OnCloseClickEntityFields(u)},u.searchColumnsForCollection="",u.AddColumnDialog=r.showDialog(u,"Entity Fields","Scenario/views/AddColumnsForCollection.html",{height:500})))}function SelectAllEntityFields(n){n!=undefined&&n.length>0&&SelectAndClearEntityField(n,!0)}function ClearAllEntityFields(n){n!=undefined&&n.length>0&&SelectAndClearEntityField(n,!1)}function OnOKClickEntityFields(n,t,i,r){if(n!=undefined){if(r.UndRedoBulkOp("Start"),n.dictAttributes.sfwDataType=="Object")t!=undefined&&t.length>0&&angular.forEach(t,function(t){var i,u;t.IsSelected&&(i={istrName:t.ID,istrDataType:t.DataType,istrEntity:t.Entity},(i.istrDataType=="Object"||i.istrDataType=="Collection"||i.istrDataType=="CDOCollection"||i.istrDataType=="List")&&(i.ilstEntityFields=[]),n.ExtraFields==undefined&&(n.ExtraFields=[]),r.PushItem(i,n.ExtraFields),u={Name:"field",Value:"",dictAttributes:{ParameterType:"Input",isExtraEntityField:"true",ID:t.ID,sfwDataType:t.DataType,istrEntity:t.Entity},Elements:[]},u.ruleDataInfo=i,CheckAndAddObjectFields(u,n.objEntity,r),n.objFieldsVM==undefined&&(n.objFieldsVM={Name:"fields",Value:"",dictAttributes:{},Elements:[]},r.PushItem(n.objFieldsVM,n.Elements)),n.objFieldsVM.Elements.some(function(n){return n.dictAttributes.ID==t.ID})||r.PushItem(u,n.objFieldsVM.Elements))});else{var u=[];t!=undefined&&t.length>0&&angular.forEach(t,function(t){var i,e,f;if(t.IsSelected)if(u.push(t),i={istrName:t.ID,istrDataType:t.DataType,istrEntity:t.Entity},(i.istrDataType=="Object"||i.istrDataType=="Collection"||i.istrDataType=="CDOCollection"||i.istrDataType=="List")&&(i.ilstEntityFields=[]),n.ExtraFields==undefined&&(n.ExtraFields=[]),r.PushItem(i,n.ExtraFields),n.IsOutput){for(e=1,f=1;f<n.lstCollectionColumn.length;f++)if(n.lstCollectionColumn[f].istrName=="Ignore"){e=f;break}e>0&&r.InsertItem(i,n.lstCollectionColumn,e)}else r.PushItem(i,n.lstCollectionColumn)});u!=undefined&&u.length>0&&angular.forEach(u,function(t){angular.forEach(n.Elements,function(i){var u={istrName:t.ID,istrDataType:t.DataType,istrEntity:t.Entity},f;(u.istrDataType=="Object"||u.istrDataType=="Collection"||u.istrDataType=="CDOCollection"||u.istrDataType=="List")&&(u.ilstEntityFields=[]);f={Name:"field",Value:"",dictAttributes:{ParameterType:"Input",ID:t.ID,sfwDataType:t.DataType,isExtraEntityField:"true",istrEntity:t.Entity},Elements:[]};f.ruleDataInfo=u;CheckAndAddObjectFields(f,n.objEntity,r);r.PushItem(f,i.Elements)})})}r.UndRedoBulkOp("End");OnCloseClickEntityFields(i)}}function OnCloseClickEntityFields(n){n.AddColumnDialog!=undefined&&n.AddColumnDialog.close()}function UpdateSelectedCollectionField(n,t){t.SelectedFieldsVM=n}function DeleteCollectionField(n,t){if(n!=undefined&&n.SelectedFieldsVM!=undefined){var i=n.Elements.indexOf(n.SelectedFieldsVM);i>=0&&(t.DeleteItem(n.SelectedFieldsVM,n.Elements),i<n.Elements.length?n.SelectedFieldsVM=n.Elements[i]:n.Elements.length>0&&(n.SelectedFieldsVM=n.Elements[i-1]))}}function AddCollectionField(n,t,i){if(i.UndRedoBulkOp("Start"),n!=undefined){var r={Name:"fields",Value:"",dictAttributes:{ParameterType:n.dictAttributes.ParameterType},Elements:[]},u=AddParameter(r,n,t,i);u&&(i.PushItem(r,n.Elements),n.SelectedFieldsVM=r)}i.UndRedoBulkOp("End")}function UpdateSelectedObjectField(n,t){t.objFieldsVM.SelectedField=n}function DeleteObjectField(n,t){var i,r;if(n.objFieldsVM!=undefined&&n.objFieldsVM.SelectedField!=undefined&&(i=n.objFieldsVM.Elements.indexOf(n.objFieldsVM.SelectedField),i>=0))if(n.objFieldsVM.SelectedField.dictAttributes.isExtraEntityField=="true"){for(r=0;r<n.ExtraFields.length;r++)n.ExtraFields[r].istrName==n.objFieldsVM.SelectedField.dictAttributes.ID&&n.ExtraFields.splice(r,1);t.DeleteItem(n.objFieldsVM.SelectedField,n.objFieldsVM.Elements);i<n.objFieldsVM.Elements.length?n.objFieldsVM.SelectedField=n.objFieldsVM.Elements[i]:n.Elements.length>0&&(n.objFieldsVM.SelectedField=n.objFieldsVM.Elements[i-1])}else alert("Selected field cannot be deleted as it is a mandatory field.")}function DeleteColumnFromCollection(n,t){var e,r,u,i,f;if(n!=undefined&&t!=undefined){for(e=!1,r=0;r<n.ExtraFields.length;r++)if(n.ExtraFields[r].istrName==t.istrName){for(e=!0,n.ExtraFields.splice(r,1),u=0;u<n.lstCollectionColumn.length;u++)if(n.lstCollectionColumn[u].istrName==t.istrName){n.lstCollectionColumn.splice(u,1);break}for(i=-1,n.Elements&&n.Elements.length>0&&(i=n.Elements.length-1);i>-1;)f=n.Elements[i],angular.forEach(f.Elements,function(r){r.dictAttributes.ID==t.istrName&&(f.Elements.splice(f.Elements.indexOf(r),1),f.Elements.length||n.Elements.splice(i,1))}),i--;break}e||alert("Selected field cannot be deleted as it is a mandatory field.")}}function AddParameter(n,t,i,r){var u=!1,f=GetEntityFieldsFromRuleDataInfo(t,i);return f!=undefined&&angular.forEach(f,function(t){if(!n.Elements.some(function(n){return n.dictAttributes.ID==t.istrName})){var f={Name:"field",Value:"",dictAttributes:{ParameterType:n.dictAttributes.ParameterType,ID:t.istrName,sfwDataType:t.istrDataType},Elements:[]};f.ruleDataInfo=t;CheckAndAddObjectFields(f,i,r);r.PushItem(f,n.Elements);u=!0}}),t.ExtraFields!=undefined&&angular.forEach(t.ExtraFields,function(t){if(!n.Elements.some(function(n){return n.dictAttributes.ID==t.istrName})){var f={Name:"field",Value:"",dictAttributes:{ParameterType:"InputParameter",ID:t.istrName,sfwDataType:t.istrDataType,isExtraEntityField:"true",istrEntity:t.istrEntity},Elements:[]};f.ruleDataInfo=t;CheckAndAddObjectFields(f,i,r);r.PushItem(f,n.Elements);u=!0}}),u}function CheckAndAddObjectFields(n,t,i){var r,u;n.dictAttributes.sfwDataType=="Object"&&(r=GetEntityFieldsFromRuleDataInfo(n,t),r!=undefined&&r.length>0&&(u={Name:"fields",Value:"",dictAttributes:{},Elements:[]},angular.forEach(r,function(n){var r={Name:"field",Value:"",dictAttributes:{ParameterType:"InputParameter",ID:n.istrName,sfwDataType:n.istrDataType},Elements:[]};r.ruleDataInfo=n;CheckAndAddObjectFields(r,t,i);i.PushItem(r,u.Elements)}),i.PushItem(u,n.Elements)))}function IsFieldExist(n,t,i){var r=!1;return angular.forEach(n,function(n){n.istrName==t&&(r=!0)}),r||angular.forEach(i,function(n){n.istrName==t&&(r=!0)}),r}function SelectAndClearEntityField(n,t){angular.forEach(n,function(n){n.IsSelected=t})}function ReloadTestParameterModel(n,t,i,r,u){i?LoadTestParameterModel(n,i,r,u,!0):(n.dictAttributes.ID=t.dictAttributes.ID,n.dictAttributes.sfwDataType=t.dictAttributes.sfwDataType,n.dictAttributes.Value=t.dictAttributes.Value);n.dictAttributes.isExtraEntityField=t.dictAttributes.isExtraEntityField;n.dictAttributes.istrEntity=t.dictAttributes.istrEntity;n.dictAttributes.sfwIgnore=t.dictAttributes.sfwIgnore;CheckAndUpdateInputOrExpectedValue(n,t);n.dictAttributes.sfwIsconstant=t.dictAttributes.sfwIsconstant;n.ruleDataInfo=i;CheckAndLoadChildParameters(n,t,i,r,u)}function LoadTestParameterModel(n,t,i,r,u){t&&(n.dictAttributes.ID=t.istrName,n.dictAttributes.sfwDataType=t.istrDataType,n.ruleDataInfo=t,u||CheckAndAddObjectFields(n,i,r))}function CheckAndUpdateInputOrExpectedValue(n,t){t&&(n.dictAttributes.Value=t.dictAttributes.Value)}function CheckAndLoadChildParameters(n,t,i,r,u){if(t&&i){var f=GetEntityFieldsFromRuleDataInfo(n,r);n.dictAttributes.sfwDataType=="Collection"||n.dictAttributes.sfwDataType=="List"?angular.forEach(t.Elements,function(t){var e=t,f={Name:"fields",Value:"",dictAttributes:{},Elements:[]};f.dictAttributes.ParameterType=n.dictAttributes.ParameterType;f.ruleDataInfo=i;ReloadParameters(e,f,i,r,u);n.Elements.push(f)}):n&&n.dictAttributes.sfwDataType=="Object"&&(angular.forEach(f,function(i){var f=null,e,s,o,h;testFieldsModels=n.Elements.filter(function(n){return n.Name=="fields"});!testFieldsModels||testFieldsModels&&testFieldsModels.length==0?(f={Name:"fields",Value:"",dictAttributes:{},Elements:[]},n.Elements.push(f)):f=testFieldsModels[0];e={Name:"field",Value:"",dictAttributes:{},Elements:[]};e.dictAttributes.ParameterType="Input";f&&f.Elements.push(e);s=t.Elements.filter(function(n){return n.Name=="fields"});o=null;s&&s.length>0&&(h=s[0].Elements.filter(function(n){return n.dictAttributes.ID==i.istrName}),h&&h.length>0&&(o=h[0]));o&&o.Name=="field"?ReloadTestParameterModel(e,o,i,r,u):LoadTestParameterModel(e,i,r,u)}),angular.forEach(t.Elements,function(t){if(t.Name=="fields"){var i;testFieldsModels=n.Elements.filter(function(n){return n.Name=="fields"});!testFieldsModels||testFieldsModels&&testFieldsModels.length==0?(i={Name:"fields",Value:"",dictAttributes:{},Elements:[]},n.Elements.push(i)):i=testFieldsModels[0];angular.forEach(t.Elements,function(t){var f,e;getDescendents(n).some(function(n){return n.dictAttributes.ID==t.dictAttributes.ID})||"isExtraEntityField"in t.dictAttributes&&t.dictAttributes.isExtraEntityField.toLowerCase()=="true"&&(f={},f.istrName=t.dictAttributes.ID,f.istrDataType=t.dictAttributes.sfwDataType,e={Name:"fields",Value:"",dictAttributes:{},Elements:[]},e.dictAttributes.ParameterType="Input",ReloadTestParameterModel(e,t,f,r,u),i.Elements.push(e))})}}))}}function ReloadParameters(n,t,i,r,u){t.dictAttributes.indexNumber=n.dictAttributes.indexNumber;var f=GetEntityFieldsFromRuleDataInfo(t,r);f&&angular.forEach(f,function(i){LoadField(t,n,i,r,u)});angular.forEach(n.Elements,function(n){if(n.dictAttributes.isExtraEntityField&&n.dictAttributes.isExtraEntityField=="true"){var i=t.Elements.filter(function(t){return t.dictAttributes.ID==n.dictAttributes.ID});i&&i.length>0||t.Elements.push(n)}})}function LoadField(n,t,i,r,u){var f,e;n&&!n.Elements.some(function(n){return n.dictAttributes.ID==i.istrName})&&(f={Name:"field",Value:"",dictAttributes:{},Elements:[]},f.dictAttributes.ParameterType="Input",e=t.Elements.filter(function(n){return n.dictAttributes.ID==i.istrName}),e&&e.length>0&&e[0].Name=="field"?ReloadTestParameterModel(f,e[0],i,r,u):LoadTestParameterModel(f,i,r,u),n.Elements.push(f))}app.controller("ScenarioController",["$scope","$filter","$rootScope","$timeout","$EntityIntellisenseFactory","$resourceFactory","$NavigateToFileService","$interval",function(n,t,i,r,u,f,e,o){var s;i.IsLoading=!0;n.lstEntityFields=[];n.currentfile=i.currentopenfile.file;n.IsObjectBasedScenario=n.currentfile.FileName.match("^rso")?!0:!1;n.IsExcelBasedScenario=n.currentfile.FileName.match("^rsx")?!0:!1;n.isDirty=!1;n.selectedTestFilter="All";n.showSource=!1;n.selectedDesignSource=!1;n.lstEntityFieldsCollection=[];n.IsDiagramDivExpanded=!0;hubMain.server.getModel(n.currentfile.FilePath,n.currentfile.FileType).done(function(t){t?n.receivescenariomodel(t):i.closeFile(n.currentfile.FileName)});n.selectDefaultScenario=function(){n.objEntityBasedScenario!=undefined&&n.objEntityBasedScenario.Elements.length>0&&n.objEntityBasedScenario.Elements.some(function(t){if(t.Name=="test")return n.TestSelectionChange(t),n.objEntityBasedScenario.SelectedStep.IsRunSelected=!1,!0})};n.receivescenariomodel=function(u){n.$apply(function(){n.objScenarioExtraFields=[];n.lstXmlMethods=[];n.objEntityBasedScenario=u;n.objEntity=n.objEntityBasedScenario.objExtraData.entityModel;n.objScenarioExtraFields=t("filter")(n.objEntityBasedScenario.Elements,{Name:"ExtraFields"});n.objScenarioExtraFields.length>0&&(n.objScenarioExtraFields=n.objScenarioExtraFields[0]);n.PopulateEntityRelatedDetail();n.CompileResult=n.objEntityBasedScenario.objExtraData.CompileResult;n.PopulateCompilationResultDetail();n.objEntityBasedScenario.objExtraData.ruleFileInfo&&(n.RuleType=n.objEntityBasedScenario.objExtraData.ruleFileInfo.FileType,n.ruleFileInfo=n.objEntityBasedScenario.objExtraData.ruleFileInfo);angular.forEach(n.objEntityBasedScenario.Elements,function(t){t.Name=="test"&&n.InitializeData(t)});angular.forEach(n.objEntityBasedScenario.Elements,function(t){t.Name=="test"&&n.SetValue(t,!0)});n.objScenarioExtraFields.length==0&&(n.objScenarioExtraFields={Name:"ExtraFields",Value:"",dictAttributes:{},Elements:[]});n.selectDefaultScenario();r(function(){ComponentsPickers.init()});i.IsLoading=!1})};n.ShowDesign=function(){var t,r,o,e;if(n.selectedDesignSource==!0&&(t=n.editor.getValue(),t!=null&&t!="")){if(i.IsLoading=!0,r=n.editor.selection.getCursor().row,r=r+1,t.length<32e3)hubMain.server.getDesignXmlString(t,n.currentfile,r);else{o=[];o[0]=r>0?r:1;var u="",h=[],f=0;for(e=0;e<t.length;e++)f++,u=u+t[e],f==32e3&&(f=0,h.push(u),u="");f!=0&&h.push(u);s(h,n.currentfile,"Source-Design",o)}n.receivescenariodesignxmlobject=function(t,r){n.selectedDesignSource=!1;n.isSourceDirty&&(n.receivescenariomodel(t),n.isSourceDirty=!1);n.$evalAsync(function(){var t,e,f,u;if(n.testSelectedObj=undefined,n.parameterSelectedObj=undefined,r!=null){if(t=[],r.contains("-")||r.contains(","))for(e=n.objEntityBasedScenario,f=0;f<r.split(",").length;f++)e=n.FindNodeHierarchy(e,r.split(",")[f].substring(r.split(",")[f].lastIndexOf("-")+1)),t.push(e);t!=null&&t.length>0?n.objEntityBasedScenario.SelectedStep=t[0]:n.selectDefaultScenario();t.length>1&&(t[t.length-2]&&(t[t.length-2].Name=="input"||t[t.length-2].Name=="parameter")?n.setSelectedParameters(t[t.length-1]):t[t.length-2]&&t[t.length-2].Name=="output"?n.setSelectedOutputParam(t[t.length-1]):t[t.length-2]&&t[t.length-2].Name=="parameters"?n.setSelectedMethodParameters(t[t.length-1]):t[t.length-1].Name=="input"||t[t.length-1].Name=="parameter"?n.SelectedParameter&&(u=FindDeepNode(n.objEntityBasedScenario,n.SelectedParameter),n.setSelectedParameters(u)):t[t.length-1].Name=="output"?n.SelectedOutputParam&&(u=FindDeepNode(n.objEntityBasedScenario,n.SelectedOutputParam),n.setSelectedOutputParam(u)):t[t.length-1].Name=="parameters"&&n.SelectedMethodParameter&&(u=FindDeepNode(n.objEntityBasedScenario,n.SelectedMethodParameter),n.setSelectedMethodParameters(u)))}i.IsLoading=!1})}}};n.isSourceDirty;n.sourceChanged=function(){n.isSourceDirty=!0;n.isDirty=!0;n.SearchSource.IsSearchCriteriaChange=!0};s=function(n,t,i,r){for(var u=0;u<n.length;u++)hubMain.server.receiveDataPackets(n[u],n.length,t,u,i,r)};n.ShowSource=function(){var a,e,o,t,l;if(n.selectedDesignSource==!1&&(n.selectedDesignSource=!0,e=[],n.objEntityBasedScenario!=null&&n.objEntityBasedScenario!=undefined)){i.IsLoading=!0;var y=GetBaseModel(n.objEntityBasedScenario),h=JSON.stringify(y),r=[],u;if(n.objEntityBasedScenario.SelectedStep!=undefined&&(t=[],a=n.FindDeepNode(n.objEntityBasedScenario,n.objEntityBasedScenario.SelectedStep,t),o=n.getPathSource(n.objEntityBasedScenario,t,e),angular.copy(o,r)),n.SelectedParameter?u=n.SelectedParameter:n.SelectedOutputParam?u=n.SelectedOutputParam:n.SelectedMethodParameter&&(u=n.SelectedMethodParameter),u&&(a=undefined,e=[],r=[],t=[],a=n.FindDeepNode(n.objEntityBasedScenario,u,t),o=n.getPathSource(n.objEntityBasedScenario,t,e),angular.copy(o,r)),h.length<32e3)hubMain.server.getSourceXmlObject(h,n.currentfile,r);else{var f="",v=[],c=0;for(l=0;l<h.length;l++)c++,f=f+h[l],c==32e3&&(c=0,v.push(f),f="");c!=0&&v.push(f);s(v,n.currentfile,"Design-Source",r)}n.receivesourcexml=function(t,r){n.$apply(function(){n.xmlSource=t;var u=n.currentfile.FileName;setDataToEditor(n,t,r,u);n.$evalAsync(function(){i.IsLoading=!1;n.objEntityBasedScenario.SelectedStep=undefined});window.navigator.userAgent.toLowerCase().contains("chrome")&&(i.IsLoading=!1)})}}};n.FindNodeHierarchy=function(n,t){if(n&&n.Elements){var i=n.Elements[t];return i==undefined&&(i=n.Elements[t-1]),i}};n.FindDeepNode=function(t,i,r){return t&&angular.forEach(t.Elements,function(t){var u=n.isValidObject(t,i);return(u&&r.push(t),t==i)?i:t.Elements&&t.Elements.length>0?i=n.FindDeepNode(t,i,r):void 0}),i};n.getPathSource=function(n,t,i){for(var u,r=0;r<t.length;r++)r==0?(u=n.Elements.indexOf(t[r]),i.push(u)):(u=t[r-1].Elements.indexOf(t[r]),i.push(u));return i};n.isValidObject=function(t,i){var u,r;if(t==i)return!0;for(r in t.Elements){if(t.Elements[r]==i)return!0;if(t.Elements[r].Elements&&t.Elements[r].Elements.length>0)for(iele in t.Elements[r].Elements)if(u=n.isValidObject(t.Elements[r].Elements[iele],i),u==!0)return u}return u};n.InitializeData=function(t){t&&(angular.forEach(t.Elements,function(i){i.Name=="input"?t.objInputVM=i:i.Name=="parameter"?t.objParameterVM=i:i.Name=="output"?t.objOutputVM=i:n.IsObjectBasedScenario&&i.Name=="parameters"&&(t.objParameters=i)}),t.objInputVM==undefined&&(t.objInputVM=n.CreateNewObject("input",t)),t.objOutputVM==undefined&&(t.objOutputVM=n.CreateNewObject("output",t)),t.objParameterVM==undefined&&(t.objParameterVM=n.CreateNewObject("parameter",t)),n.IsObjectBasedScenario&&t.objParameters==undefined&&(t.objParameters=n.CreateNewObject("parameters",t)))};n.PopulateCompilationResultDetail=function(){n.objEntityBasedScenario.Elements.length>0&&angular.forEach(n.objEntityBasedScenario.Elements,function(t){t.Name!="ExtraFields"&&n.SetValue(t,!1)})};n.receiveCompilationResult=function(t){n.$apply(function(){n.CompileResult=JSON.parse(t);n.PopulateCompilationResultDetail()})};n.PopulateEntityRelatedDetail=function(){var i,t;n.lstXmlMethods=[];i=u.getEntityIntellisense();n.objEntity&&i&&i.length>0&&(t=i.filter(function(t){return t.ID==n.objEntity.dictAttributes.ID}),t&&t.length>0&&t[0].XmlMethods&&t[0].XmlMethods.length>0&&angular.forEach(t[0].XmlMethods,function(t){t.ID&&t.ID.trim()&&t.MethodType=="Load"&&n.lstXmlMethods.push(t)}))};n.UpdateDisplayInputOutputList=function(t,r,u){u?(i.EditPropertyValue(t.lstInputValues,t,"lstInputValues",[]),i.EditPropertyValue(t.lstOutputValues,t,"lstOutputValues",[])):(t.lstInputValues=[],t.lstOutputValues=[]);t.objInputVM!=undefined&&angular.forEach(t.objInputVM.Elements,function(r){n.CompileResult!=undefined&&(angular.forEach(n.CompileResult.ilstInputFields,function(n){n.istrName==r.dictAttributes.ID&&(r.ruleDataInfo=n)}),n.SetCompilationResultForChild(r));u?i.PushItem(r,t.lstInputValues):t.lstInputValues.push(r)});t.objParameterVM!=undefined&&angular.forEach(t.objParameterVM.Elements,function(f){n.CompileResult!=undefined&&(angular.forEach(n.CompileResult.ilstParameters,function(n){n.istrName==f.dictAttributes.ID&&(f.ruleDataInfo=n)}),n.SetCompilationResultForChild(f,f.ruleDataInfo));(f.dictAttributes.ParameterType==undefined||f.dictAttributes.ParameterType=="")&&(r||(f.dictAttributes.ParameterType=f.ruleDataInfo?f.ruleDataInfo.ienmDirection==0?"InputParameter":"OutputParameter":"InputParameter"));f.dictAttributes.ParameterType=="InputParameter"?u?i.PushItem(f,t.lstInputValues):t.lstInputValues.push(f):f.dictAttributes.ParameterType=="OutputParameter"&&(u?i.PushItem(f,t.lstOutputValues):t.lstOutputValues.push(f))});t.objOutputVM!=undefined&&angular.forEach(t.objOutputVM.Elements,function(r){n.CompileResult!=undefined&&(angular.forEach(n.CompileResult.ilstOutputFields,function(n){n.istrName==r.dictAttributes.ID&&(r.ruleDataInfo=n)}),n.SetCompilationResultForChild(r,r.ruleDataInfo));u?i.PushItem(r,t.lstOutputValues):t.lstOutputValues.push(r)})};n.SetCompilationResultForChild=function(t){t.ruleDataInfo==undefined&&n.InitRuleDataInfo(t);angular.forEach(t.Elements,function(i){angular.forEach(i.Elements,function(i){var r=GetEntityFieldsFromRuleDataInfo(t,n.objEntity);r!=undefined&&angular.forEach(r,function(n){n.istrName==i.dictAttributes.ID&&(i.ruleDataInfo=n)});i.ruleDataInfo==undefined&&t.dictAttributes.sfwDataType=="Object"&&n.CheckAndUpdateExtraFields(t,i,t.ExtraFields);n.SetCompilationResultForChild(i,i.ruleDataInfo)})})};n.CheckAndUpdateExtraFields=function(n,t){var i=!1;angular.forEach(n.ExtraFields,function(n){n.istrName==t.dictAttributes.ID&&(i=!0)});i||(n.ExtraFields==undefined&&(n.ExtraFields=[]),n.ExtraFields.push({ilstEntityFields:[],istrDataType:t.dictAttributes.sfwDataType,istrEntity:"",istrName:t.dictAttributes.ID,istrObjectField:"",itypDataType:""}))};n.InitRuleDataInfo=function(t){t.ruleDataInfo==undefined&&(t.dictAttributes.ID=="return"?$.connection.hubScenarioModel.server.prepareEntityFiledInfo(n.objEntityBasedScenario.dictAttributes.sfwRuleFile).done(function(i){n.$apply(function(){t.ruleDataInfo=i})}):t.dictAttributes.isExtraEntityField!=undefined&&t.dictAttributes.isExtraEntityField=="true"&&(t.ruleDataInfo={ilstEntityFields:[],istrEntity:t.dictAttributes.istrEntity}))};n.CreateNewObject=function(n,t){var i={Name:n,Value:"",dictAttributes:{},Elements:[]};return t.Elements.push(i),i};n.TestSelectionChange=function(t){n.objEntityBasedScenario.SelectedStep=t;n.selectedTest=t;n.SelectedParameter=undefined;n.SelectedOutputParam=undefined;n.SelectedMethodParameter=undefined};n.SetValue=function(t,i){n.InitializeData(t);t&&n.UpdateDisplayInputOutputList(t,i)};n.menuOptions=[["Copy Test",function(){var t=n.$new(),r=n.objEntityBasedScenario.SelectedStep.dictAttributes.ID+" - copy";t.objNewTest={Name:"test",value:"",dictAttributes:{ID:r,Text:n.objEntityBasedScenario.SelectedStep.dictAttributes.Text,sfwEffectiveDate:""},Elements:[]};n.IsCopy=!0;t.preCloseCallback=function(){n.IsCopy=!1;n.IsEdit=!1};t.AddNewTest=function(){n.AddNewTest(t)};t.ValidateTestID=function(){return n.ValidateTestID(t)};t.dialog=i.showDialog(t,"Copy Test","Scenario/views/AddCopyEditNewTest.html",{beforeClose:t.preCloseCallback});ComponentsPickers.init()},function(){return n.IsExcelBasedScenario?!1:!0}],null,["Edit Test",function(){var t=n.$new(),r=n.objEntityBasedScenario.SelectedStep.dictAttributes.ID;t.objNewTest={Name:"test",value:"",dictAttributes:{ID:r,Text:n.objEntityBasedScenario.SelectedStep.dictAttributes.Text,sfwEffectiveDate:n.objEntityBasedScenario.SelectedStep.dictAttributes.sfwEffectiveDate},Elements:[]};t.objNewTest.dictAttributes.ID=r;t.preCloseCallback=function(){n.IsCopy=!1;n.IsEdit=!1};t.AddNewTest=function(){n.AddNewTest(t)};t.ValidateTestID=function(){return n.ValidateTestID(t)};n.IsEdit=!0;t.dialog=i.showDialog(t,"Edit Test","Scenario/views/AddCopyEditNewTest.html",{beforeClose:t.preCloseCallback});ComponentsPickers.init()},function(){return n.IsExcelBasedScenario?!1:!0}],null];n.openWindow=function(){function f(n){return n.Name=="attributes"}function e(n){n.Selected=!1;t.lstEntityFields.push(n)}var t=n.$new(),r,u;t.EntityField=!0;t.lstEntityFields=[];n.objEntity&&(r=n.objEntity.Elements.filter(f),u=JSON.stringify(r),r=JSON.parse(u),r&&r.length>0&&angular.forEach(r[0].Elements,e));t.unCheckAll=function(){angular.forEach(t.lstEntityFields,function(n){n.Selected=!1})};t.checkAll=function(){angular.forEach(t.lstEntityFields,function(n){n.Selected=!0})};t.onCancelClick=function(){t.dialog.close()};t.UpdateData=function(){i.UndRedoBulkOp("Start");angular.forEach(t.lstEntityFields,function(t){var u,f,r,e;t.Selected&&(u=!1,angular.forEach(n.objEntityBasedScenario.SelectedStep.lstInputValues,function(n){n.dictAttributes.ID==t.dictAttributes.ID&&(u=!0)}),u||(f=t.dictAttributes.sfwDataType,(t.dictAttributes.sfwType=="Collection"||t.dictAttributes.sfwType=="Object"||t.dictAttributes.sfwType=="List"||t.dictAttributes.sfwType=="Description")&&(f=t.dictAttributes.sfwType),r={Name:"field",value:"",dictAttributes:{ParameterType:"Input",ID:t.dictAttributes.ID,sfwDataType:f,isExtraEntityField:"true",istrEntity:t.dictAttributes.sfwEntity},Elements:[]},e={istrName:t.dictAttributes.ID,istrDataType:t.dictAttributes.sfwDataType,istrEntity:t.dictAttributes.sfwEntity},r.ruleDataInfo=e,n.objEntityBasedScenario.SelectedStep.lstInputValues!=undefined&&(i.PushItem(r,n.objEntityBasedScenario.SelectedStep.lstInputValues),i.PushItem(r,n.objEntityBasedScenario.SelectedStep.objInputVM.Elements))))});i.UndRedoBulkOp("End");t.dialog.close()};t.searchEntityFields="";t.dialog=i.showDialog(t,"Add Entity Fields","Scenario/views/AddEntityFields.html",{height:500})};n.DeleteInputValues=function(){var t,r;n.SelectedParameter!=undefined&&n.SelectedParameter.dictAttributes.ParameterType=="InputParameter"?alert("can not delete selected  field, value is mandatory for execution."):(t=n.objEntityBasedScenario.SelectedStep.lstInputValues.indexOf(n.SelectedParameter),t>-1?(i.UndRedoBulkOp("Start"),i.DeleteItem(n.SelectedParameter,n.objEntityBasedScenario.SelectedStep.lstInputValues),r=n.objEntityBasedScenario.SelectedStep.objInputVM.Elements.indexOf(n.SelectedParameter),i.DeleteItem(n.SelectedParameter,n.objEntityBasedScenario.SelectedStep.objInputVM.Elements),n.SelectedParameter=n.objEntityBasedScenario.SelectedStep.lstInputValues[0],i.UndRedoBulkOp("End")):alert("Select the item."))};n.DeleteOutputValues=function(){var t,r;n.SelectedOutputParam!=undefined&&(n.SelectedOutputParam.dictAttributes.ParameterType=="Output"&&n.SelectedOutputParam.dictAttributes.ID=="return"?alert("Cannot delete return value."):n.SelectedOutputParam.dictAttributes.ParameterType=="OutputParameter"||(t=n.objEntityBasedScenario.SelectedStep.lstOutputValues.indexOf(n.SelectedOutputParam),t>-1?(i.UndRedoBulkOp("Start"),i.DeleteItem(n.SelectedOutputParam,n.objEntityBasedScenario.SelectedStep.lstOutputValues),r=n.objEntityBasedScenario.SelectedStep.objOutputVM.Elements.indexOf(n.SelectedOutputParam),i.DeleteItem(n.SelectedOutputParam,n.objEntityBasedScenario.SelectedStep.objOutputVM.Elements),n.SelectedOutputParam=n.objEntityBasedScenario.SelectedStep.lstOutputValues[0],i.UndRedoBulkOp("End")):alert("Select the item.")))};n.SelectedMethodParameter=undefined;n.setSelectedMethodParameters=function(t){n.SelectedMethodParameter=t;n.SelectedOutputParam=undefined;n.SelectedParameter=undefined};n.setSelectedParameters=function(t){n.SelectedParameter=t;n.SelectedOutputParam=undefined;n.SelectedMethodParameter=undefined};n.setSelectedOutputParam=function(t){n.SelectedOutputParam=t;n.SelectedParameter=undefined;n.SelectedMethodParameter=undefined};n.DeleteTest=function(){var r=n.objEntityBasedScenario.Elements.indexOf(n.objEntityBasedScenario.SelectedStep),u,t,f;if(r>-1){if(confirm("Test : '"+n.objEntityBasedScenario.SelectedStep.dictAttributes.ID+"'   will be deleted, Do you want to continue?")){if(i.UndRedoBulkOp("Start"),i.DeleteItem(n.objEntityBasedScenario.SelectedStep,n.objEntityBasedScenario.Elements,"TestSelectionChange"),u=n.objEntityBasedScenario.Elements.filter(function(n){return n.Name=="test"}),u.length>0)for(t=r;;)if(r==0){if(t<n.objEntityBasedScenario.Elements.length){if(n.objEntityBasedScenario.Elements[t]&&n.objEntityBasedScenario.Elements[t].Name=="test"){n.objEntityBasedScenario.SelectedStep=n.objEntityBasedScenario.Elements[t];break}}else break;t++}else{if(t>=0){if(n.objEntityBasedScenario.Elements[t]){if(n.objEntityBasedScenario.Elements[t].Name=="test"){n.objEntityBasedScenario.SelectedStep=n.objEntityBasedScenario.Elements[t];break}}else if(n.objEntityBasedScenario.Elements[t-1].Name=="test"){n.objEntityBasedScenario.SelectedStep=n.objEntityBasedScenario.Elements[t-1];break}}else break;t--}else n.objEntityBasedScenario.SelectedStep=undefined;i.UndRedoBulkOp("End");n.SetValue(n.objEntityBasedScenario.SelectedStep,!1);f=n.objEntityBasedScenario.Elements.indexOf(n.objEntityBasedScenario.SelectedStep)}}else alert("Select the item.")};n.canDeleteTest=function(){return n.objEntityBasedScenario!=undefined&&n.objEntityBasedScenario.Elements!=undefined&&n.objEntityBasedScenario.Elements.length>0?n.objEntityBasedScenario.SelectedStep!=undefined:!1};n.OpenAddTest=function(){var t;n.NewTest=!0;for(var u="NewTest",f=0,r=u,e=n.objEntityBasedScenario.Elements.filter(function(n){return n.dictAttributes.ID==r});e.length>0;)f++,r=u+" ("+f+")",e=n.objEntityBasedScenario.Elements.filter(function(n){return n.dictAttributes.ID==r});t=n.$new();t.objNewTest={Name:"test",value:"",dictAttributes:{ID:r,Text:"",sfwEffectiveDate:""},Elements:[]};t.preCloseCallback=function(){n.IsCopy=!1;n.IsEdit=!1};t.AddNewTest=function(){n.AddNewTest(t)};t.ValidateTestID=function(){return n.ValidateTestID(t)};t.dialog=i.showDialog(t,"New Test","Scenario/views/AddCopyEditNewTest.html",{beforeClose:t.preCloseCallback});ComponentsPickers.init()};n.AddNewTest=function(t){var f,r,u;n.IsCopy?(f=JSON.stringify(n.objEntityBasedScenario.SelectedStep),r=JSON.parse(f),r.dictAttributes.ID=t.objNewTest.dictAttributes.ID,r.dictAttributes.Text=t.objNewTest.dictAttributes.Text,r.dictAttributes.sfwEffectiveDate=t.objNewTest.dictAttributes.sfwEffectiveDate,u={Name:"test",value:"",dictAttributes:r.dictAttributes,Elements:r.Elements},i.PushItem(u,n.objEntityBasedScenario.Elements,"TestSelectionChange"),n.objEntityBasedScenario.SelectedStep=u,n.SetValue(u,!1),n.IsCopy=!1):n.IsEdit?(i.UndRedoBulkOp("Start"),i.EditPropertyValue(n.objEntityBasedScenario.SelectedStep.dictAttributes.ID,n.objEntityBasedScenario.SelectedStep.dictAttributes,"ID",t.objNewTest.dictAttributes.ID),i.EditPropertyValue(n.objEntityBasedScenario.SelectedStep.dictAttributes.Text,n.objEntityBasedScenario.SelectedStep.dictAttributes,"Text",t.objNewTest.dictAttributes.Text),i.EditPropertyValue(n.objEntityBasedScenario.SelectedStep.dictAttributes.sfwEffectiveDate,n.objEntityBasedScenario.SelectedStep.dictAttributes,"sfwEffectiveDate",t.objNewTest.dictAttributes.sfwEffectiveDate),n.IsEdit=!1,i.UndRedoBulkOp("End")):(i.PushItem(t.objNewTest,n.objEntityBasedScenario.Elements,"TestSelectionChange"),n.objEntityBasedScenario.SelectedStep=t.objNewTest,n.SetValue(t.objNewTest,!1),n.LoadInputOutputValues(t.objNewTest));t.dialog.close()};n.ValidateTestID=function(t){var i=!1;return t.ErrorMessageForDisplay="",t.objNewTest.dictAttributes.ID==undefined||t.objNewTest.dictAttributes.ID==""?(t.ErrorMessageForDisplay="Enter the Test ID.",i=!0):n.IsEdit?n.CheckForDuplicateTestID(t.objNewTest.dictAttributes.ID,t.objNewTest)&&(t.ErrorMessageForDisplay="Duplicate Test ID.",i=!0):n.CheckForDuplicateTestID(t.objNewTest.dictAttributes.ID)&&(t.ErrorMessageForDisplay="Duplicate Test ID.",i=!0),i};n.CheckForDuplicateTestID=function(t,i){function u(u){r||(i?u.dictAttributes.ID==t&&u.dictAttributes.ID!=n.objEntityBasedScenario.SelectedStep.dictAttributes.ID&&(r=!0):u.dictAttributes.ID==t&&u.dictAttributes.ID&&(r=!0))}var r=!1;return n.objEntityBasedScenario&&angular.forEach(n.objEntityBasedScenario.Elements,u),r};n.UpdateMethodParameter=function(){if(n.SelectedMethodParameter=undefined,i.UndRedoBulkOp("Start"),n.ClearMethodParameters(),n.objEntityBasedScenario.SelectedStep){var t,r=n.lstXmlMethods.filter(function(t){return t.ID==n.objEntityBasedScenario.SelectedStep.dictAttributes.sfwXmlMethod});r&&r.length>0&&(t=r[0]);t!=undefined&&t.Parameters!=undefined&&angular.forEach(t.Parameters,function(t){var r={Name:"parameter",Value:"",dictAttributes:{ID:t.ID,sfwDataType:t.DataType},Elements:[]};i.PushItem(r,n.objEntityBasedScenario.SelectedStep.objParameters.Elements)})}i.UndRedoBulkOp("End")};n.ClearMethodParameters=function(){while(n.objEntityBasedScenario.SelectedStep.objParameters.Elements.length>0)i.DeleteItem(n.objEntityBasedScenario.SelectedStep.objParameters.Elements[0],n.objEntityBasedScenario.SelectedStep.objParameters.Elements)};n.TestFilter=function(t){n.selectedTestFilter=t;n.selectedTest=undefined;n.objEntityBasedScenario.SelectedStep=undefined;t=="All"&&angular.forEach(n.objEntityBasedScenario.Elements,function(t){t.TestFilter!=undefined&&t.Name!="ExtraFields"&&(t.TestFilter=!0,n.selectedTest||(n.selectedTest=t,n.objEntityBasedScenario.SelectedStep=t))});t=="Pass"&&angular.forEach(n.objEntityBasedScenario.Elements,function(t){t.TestFilter!=undefined&&t.Name!="ExtraFields"&&(t.Status&&t.IsRunSelected?(t.TestFilter=!0,n.selectedTest||(n.selectedTest=t,n.objEntityBasedScenario.SelectedStep=t)):t.TestFilter=!1)});t=="Fail"&&angular.forEach(n.objEntityBasedScenario.Elements,function(t){t.TestFilter!=undefined&&t.Name!="ExtraFields"&&(!t.Status&&t.IsRunSelected?(t.TestFilter=!0,n.selectedTest||(n.selectedTest=t,n.objEntityBasedScenario.SelectedStep=t)):t.TestFilter=!1)})};n.OnConstantValueChange=function(n){n&&i.EditPropertyValue(n.dictAttributes.Value,n.dictAttributes,"Value","")};n.OpenPopupForCollection=function(t,r){var e,f,u;n.SelectedTestField=t;t.objEntity=n.objEntity;n.SelectedTestField.IsOutput=r;t.lstCollectionColumn=[];t.ruleDataInfo!=undefined&&(e=GetEntityFieldsFromRuleDataInfo(t,n.objEntity),e!=undefined&&angular.forEach(e,function(i){if(n.SelectedTestField.Elements.length>0){var r=n.SelectedTestField.Elements[0].Elements.filter(function(n){return n.dictAttributes.ID==i.istrName});r&&r.length>0&&(t.lstCollectionColumn.some(function(n){return n.istrName==i.istrName})||t.lstCollectionColumn.push(i))}else t.lstCollectionColumn.push(i)}),n.SelectedTestField.Elements.length>0&&angular.forEach(n.SelectedTestField.Elements[0].Elements,function(n){if(n.dictAttributes.isExtraEntityField&&n.dictAttributes.isExtraEntityField.toLowerCase()=="true"&&!t.lstCollectionColumn.some(function(t){return t.istrName==n.dictAttributes.ID})){var i={iblnImportant:!1,ilstEntityFields:n.ruleDataInfo.ilstEntityFields,istrDataType:n.dictAttributes.sfwDataType,istrName:n.dictAttributes.ID};t.lstCollectionColumn.push(i)}}),r&&(f={istrName:"Index"},t.lstCollectionColumn.splice(0,0,f)));r&&(f={istrName:"Ignore"},t.lstCollectionColumn.push(f),n.objEntityBasedScenario.SelectedStep.IsRunSelected&&(f={istrName:"Result"},t.lstCollectionColumn.push(f)));u=n.$new();u.SelectedTestField=t;u.objselectedstep=n.objEntityBasedScenario.SelectedStep;u.SelectedTestField.objentity=n.objEntity;u.IsExcelBasedScenario=n.IsExcelBasedScenario;u.SelectedTestField.ExtraFields=[];u.AddExtraFields=function(n){n.Elements.length>0&&angular.forEach(n.Elements[0].Elements,function(t){if(t.dictAttributes.isExtraEntityField&&t.dictAttributes.isExtraEntityField=="true"){var r={istrName:t.dictAttributes.ID,istrDataType:t.dictAttributes.sfwDataType,istrEntity:t.dictAttributes.istrEntity};(r.istrDataType=="Object"||r.istrDataType=="Collection"||r.istrDataType=="CDOCollection"||r.istrDataType=="List")&&(r.ilstEntityFields=[]);n.ExtraFields==undefined&&(n.ExtraFields=[]);i.PushItem(r,n.ExtraFields)}})};u.AddExtraFields(u.SelectedTestField);u.AddColumnForCollection=function(){AddColumnForCollection(u.SelectedTestField,u,n,i)};u.DeleteCollectionField=function(){DeleteCollectionField(u.SelectedTestField,i)};u.UpdateSelectedCollectionField=function(n){UpdateSelectedCollectionField(n,u.SelectedTestField)};u.AddCollectionField=function(){AddCollectionField(u.SelectedTestField,n.objEntity,i)};u.onCancelClick=function(){u.collectionDialog.close()};u.menuOptionForCollection=[["Delete Column",function(n){DeleteColumnFromCollection(u.SelectedTestField,n.objcol)}],null,];u.collectionDialog=i.showDialog(u,u.SelectedTestField.dictAttributes.ID,"Scenario/views/OpenCollectionPopup.html",{height:400})};n.OpenPopupForObject=function(t){n.SelectedTestField=t;n.SelectedTestField.objEntity=n.objEntity;n.SelectedTestField.IsOutput=!1;angular.forEach(n.SelectedTestField.Elements,function(t){if(t.Name=="fields"){n.SelectedTestField.objFieldsVM=t;return}});n.SelectedTestField.objFieldsVM!=undefined&&angular.forEach(n.SelectedTestField.Elements,function(t){if(t.Name=="field"){n.SelectedTestField.objFieldsVM.SelectedField=t;return}});var r=n.$new();r.SelectedTestField=n.SelectedTestField;r.SelectedTestField.ExtraFields=[];r.AddExtraFields=function(n){n.Elements.length>0&&angular.forEach(n.Elements[0].Elements,function(t){if(t.dictAttributes.isExtraEntityField&&t.dictAttributes.isExtraEntityField=="true"){var r={istrName:t.dictAttributes.ID,istrDataType:t.dictAttributes.sfwDataType,istrEntity:t.dictAttributes.istrEntity};(r.istrDataType=="Object"||r.istrDataType=="Collection"||r.istrDataType=="CDOCollection"||r.istrDataType=="List")&&(r.ilstEntityFields=[]);i.PushItem(r,n.ExtraFields)}})};r.AddExtraFields(r.SelectedTestField);r.UpdateSelectedObjectField=function(n){UpdateSelectedObjectField(n,r.SelectedTestField)};r.DeleteObjectField=function(){DeleteObjectField(r.SelectedTestField,i)};r.AddColumnForCollection=function(){AddColumnForCollection(r.SelectedTestField,r,n,i)};r.OnConstantValueChange=function(n){n&&i.EditPropertyValue(n.dictAttributes.Value,n.dictAttributes,"Value","")};r.objectInputDialog=i.showDialog(r,r.SelectedTestField.dictAttributes.ID,"Scenario/views/OpenObjectPopup.html",{height:500})};n.OpenPopupForOutputObject=function(t,r){n.SelectedOutputTestField=t;n.SelectedOutputTestField.objEntity=n.objEntity;n.SelectedOutputTestField.IsOutput=!0;angular.forEach(n.SelectedOutputTestField.Elements,function(t){if(t.Name=="fields"){n.SelectedOutputTestField.objFieldsVM=t;return}});n.SelectedOutputTestField.objFieldsVM!=undefined&&angular.forEach(n.SelectedOutputTestField.Elements,function(t){if(t.Name=="field"){n.SelectedOutputTestField.objFieldsVM.SelectedField=t;return}});var u=n.$new();u.SelectedTestField=n.SelectedOutputTestField;u.objselectedstep=r;u.UpdateSelectedObjectField=function(n){UpdateSelectedObjectField(n,u.SelectedTestField)};u.DeleteObjectField=function(){DeleteObjectField(u.SelectedTestField,i)};u.AddColumnForCollection=function(){AddColumnForCollection(u.SelectedTestField,u,n,i)};u.OnConstantValueChange=function(n){n&&i.EditPropertyValue(n.dictAttributes.Value,n.dictAttributes,"Value","")};u.objectOutputDialog=i.showDialog(u,u.SelectedTestField.dictAttributes.ID,"Scenario/views/OpenObjectPopupForOutput.html",{height:500})};n.RunAllTests=function(t){n.$evalAsync(function(){i.IsLoading=!0});var r=n.objEntityBasedScenario.Elements.filter(function(n){return n.Name=="test"});r&&r.length>0?n.objEntityBasedScenario&&n.objEntityBasedScenario.Elements&&n.objEntityBasedScenario.Elements.length>0&&$.connection.hubScenarioModel.server.createCompileResult(n.objEntityBasedScenario.dictAttributes.sfwRuleFile).done(function(){angular.forEach(n.objEntityBasedScenario.Elements,function(i){i.Name=="test"&&n.Runtest(i,t,!0)});$.connection.hubScenarioModel.server.disposeCompileResult()}):n.$evalAsync(function(){i.IsLoading=!1})};n.GetLastStepID=function(){var i="",t=n.objEntityBasedScenario.Elements.filter(function(n){return n.Name==="test"});return t&&t.length>0&&(i=t[0].dictAttributes.ID),i};n.RunScenario=function(t){n.$evalAsync(function(){i.IsLoading=!0});n.Runtest(n.objEntityBasedScenario.SelectedStep,t,!1)};n.Runtest=function(t,r,u){var e,f,o;t&&(e=n.GetLastStepID(),t.IsRunSelected=!1,t.Status=!0,t.TestFilter=!0,t.IsViewdiagramVisible=!1,t.objSelectedLogicalRule=undefined,t.strRunType=r,f=n.GetInputAndOuputConstantValues(t),n.objEntityBasedScenario!=undefined&&t!=undefined&&(o=GetBaseModel(t),$.connection.hubScenarioModel.server.runScenario(n.objEntityBasedScenario.dictAttributes.sfwRuleFile,o,r,f,n.IsObjectBasedScenario).done(function(o){n.$evalAsync(function(){var h,s,c;o&&o.length>1&&(h=o[0],n.objLogicalRule=o[1],h&&h.StepId&&(objselectedtest=n.getSelectedStep(h.StepId),objselectedtest.objScenarioRunResult=h,objselectedtest.objScenarioRunResult.ScenarioRuleType=n.RuleType,objselectedtest.objScenarioRunResult&&(objselectedtest.objScenarioRunResult.ErrorMessage==undefined||objselectedtest.objScenarioRunResult.ErrorMessage==null)&&(objselectedtest.IsViewdiagramVisible=r!="OnlyResult"?!0:!1,objselectedtest.IsRunSelected=!0,objselectedtest.ExcecutedRuleEffectiveDate=objselectedtest.objScenarioRunResult.istrEffectiveDate!=undefined?objselectedtest.objScenarioRunResult.istrEffectiveDate:"",objselectedtest.TestResult=objselectedtest.objScenarioRunResult.TestResult,objselectedtest.ExecutionTime=objselectedtest.objScenarioRunResult.ExecutionTime,n.objLogicalRule!=undefined&&(objselectedtest.objSelectedLogicalRule=GetClosestLogicalRule(n.objLogicalRule,objselectedtest.objScenarioRunResult.istrEffectiveDate,objselectedtest.objScenarioRunResult.ScenarioRuleType),objselectedtest.objSelectedLogicalRule!=undefined&&UpdateTestExecutionFlow(objselectedtest.objScenarioRunResult.ilstRuleSteps,objselectedtest.objScenarioRunResult.ScenarioRuleType,objselectedtest.objSelectedLogicalRule,r)),objselectedtest.objScenarioRunResult.ScenarioRuleType!="ExcelMatrix"||n.IsObjectBasedScenario?n.IsObjectBasedScenario?n.UpdateOutputParameters(objselectedtest,objselectedtest.objScenarioRunResult.outputParameters):n.UpdateActualValues(objselectedtest,f):objselectedtest!=undefined&&objselectedtest.objOutputVM!=undefined&&(angular.forEach(objselectedtest.objOutputVM.Elements,function(n){n.dictAttributes.ID=="return"&&(s=n)}),s!=undefined&&objselectedtest.objScenarioRunResult.iobjReturnValue&&(s.ResultValue=objselectedtest.objScenarioRunResult.iobjReturnValue.Value,c=!1,s.dictAttributes.sfwIgnore!=undefined&&(c=s.dictAttributes.sfwIgnore.toLowerCase()=="true"),c||(s.Status=objselectedtest.objScenarioRunResult.iobjReturnValue.Status,objselectedtest.Status=s.Status))),objselectedtest.TestExecutionResults=[],objselectedtest.TestExecutionResults=n.GetScenarioExecutionResults(objselectedtest))));u?t.dictAttributes.ID===e&&(i.IsLoading=!1):i.IsLoading=!1})})))};n.getSelectedStep=function(t){var r,i=n.objEntityBasedScenario.Elements.filter(function(n){return n.dictAttributes.ID==t});return i&&i.length>0&&(r=i[0]),r};n.GetInputAndOuputConstantValues=function(t){var i=[];return t.objParameterVM!=undefined&&n.PopulateConstantList(t.objParameterVM.Elements,i),t.objInputVM!=undefined&&n.PopulateConstantList(t.objInputVM.Elements,i),t.objOutputVM!=undefined&&n.PopulateConstantList(t.objOutputVM.Elements,i),i};n.PopulateConstantList=function(t,i){angular.forEach(t,function(t){t&&(t.Name=="field"&&t.dictAttributes.sfwIsconstant&&n.AddIntoConstantList(t,i),t.Elements&&t.Elements.length>0&&n.PopulateConstantList(t.Elements,i))})};n.AddIntoConstantList=function(t,i){var r,u;t&&(r=n.GetConstantValue(t.dictAttributes.Value),r!=undefined&&r.dictAttributes.Value!=undefined&&(u={strID:t.dictAttributes.ID,strValue:r.dictAttributes.Value,strType:t.dictAttributes.ParameterType,strDataType:t.dictAttributes.sfwDataType,FullID:t.dictAttributes.Value},i.push(u)))};n.GetConstantValue=function(t){var i=null,r,u,e,o;if(t!=undefined&&t!=null&&(r=t.split("."),u=f.getConstantModelData(),r!==undefined&&r.length!=undefined))for(e=0;e<r.length;e++)o=r[e],i==null?u!=undefined&&u.dictAttributes.ID==o&&(i=u):i=n.GetModelFromConstantsFile(i,o);return i};n.GetModelFromConstantsFile=function(n,t){for(var r,i=0;i<n.Elements.length;i++)if(n.Elements[i].dictAttributes.ID==t){r=n.Elements[i];break}return r};n.ViewDiagram=function(){var t=n.$new();i.IsLoading=!0;r(function(){var u,f,e;t.IsRunResults=!1;u="";t.objLogicalRule=n.objLogicalRule;t.objSelectedLogicalRule=JSON.parse(JSON.stringify(n.objEntityBasedScenario.SelectedStep.objSelectedLogicalRule));t.testExecutionResults=n.objEntityBasedScenario.SelectedStep.TestExecutionResults;t.objEntity=n.objEntity;t.scenarioruntype=n.objEntityBasedScenario.SelectedStep.strRunType;t.objLogicalRule.RuleType=="DecisionTable"?(u=n.objLogicalRule.RuleID,t.noConditionsDisplayed=30,t.LazyLoadScenarioDecisionTable=function(){t.objSelectedLogicalRule.Rows.length>t.noConditionsDisplayed?t.noConditionsDisplayed+=30:o.cancel(f)},f=o(function(){t.LazyLoadScenarioDecisionTable()},100)):u=n.objLogicalRule.dictAttributes.ID;e=n.objEntityBasedScenario.SelectedStep.dictAttributes.sfwEffectiveDate==""||n.objEntityBasedScenario.SelectedStep.dictAttributes.sfwEffectiveDate==undefined?"Default":n.objEntityBasedScenario.SelectedStep.objScenarioRunResult.istrEffectiveDate?n.objEntityBasedScenario.SelectedStep.objScenarioRunResult.istrEffectiveDate:"Default";t.viewDiagramDialog=i.showDialog(t,"Rule : "+u+" - Effective Date :"+e+"[ Elapsed Time:"+n.objEntityBasedScenario.SelectedStep.objScenarioRunResult.ExecutionTime+"]","Scenario/views/ViewRuleDiagram.html",{height:700,width:1400});r(function(){var n=$("#ScopeId_"+t.$id).find(".logical-rule-container").find(".node-expander"),r,u;if(n&&n.length>0)for(r=0;r<n.length>0;r++)u=angular.element(n[r]).scope(),u&&u.model&&!u.model.IsStepSelected&&collapseNode(n[r],!0);i.IsLoading=!1})})};n.GetScenarioExecutionResults=function(n){var t=[];return n.objParameterVM!=undefined&&angular.forEach(n.objParameterVM.Elements,function(n){if(n.Name=="field"){var i={};i.Id=n.dictAttributes.ID;n.ruleDataInfo!=undefined?n.ruleDataInfo.ienmDirection=="0"?(i.InputValue=n.dictAttributes.Value,i.Direction="In"):n.ruleDataInfo.ienmDirection=="1"&&(i.ActualValue=n.ResultValue,i.ExpectedValue=n.dictAttributes.Value,i.Direction="Out",i.Status=n.Status):(i.InputValue=n.dictAttributes.Value,i.Direction="In");i.OutputType="Parameter";i.DataType=n.dictAttributes.sfwDataType;t.push(i)}}),n.objInputVM!=undefined&&angular.forEach(n.objInputVM.Elements,function(n){var i={};i.Id=n.dictAttributes.ID;i.InputValue=n.dictAttributes.Value;i.OutputType="Entity";i.Direction="In";i.DataType=n.dictAttributes.sfwDataType;t.push(i)}),n.objOutputVM!=undefined&&angular.forEach(n.objOutputVM.Elements,function(n){var r,i;n.Name=="field"&&(angular.forEach(t,function(t){if(t.Id==n.dictAttributes.ID){r=t;return}}),r!=undefined?(r.ExpectedValue=n.dictAttributes.Value,r.ActualValue=n.ResultValue,r.Status=n.Status):(i={},i.Id=n.dictAttributes.ID,i.ActualValue=n.ResultValue,i.ExpectedValue=n.dictAttributes.Value,i.OutputType=n.dictAttributes.ID=="return"?"Return":"Entity",i.Status=n.Status,i.Direction="Out",i.DataType=n.dictAttributes.sfwDataType,t.push(i)))}),t};n.UpdateActualValues=function(t,i){var r=!0;t.objScenarioRunResult!=undefined&&angular.forEach(t.lstOutputValues,function(u){u.IsRuleExecuted=!0;u.Status=u.dictAttributes.ParameterType=="OutputParameter"?n.UpdateParameterActualValues(u,t.objScenarioRunResult.parms,t.objScenarioRunResult,t,i,u):n.UpdateResultParameterValues(u,t.objScenarioRunResult.ruleEntity,t.objScenarioRunResult,t,i,u);r=r&&u.Status});t.Status=r};n.UpdateParameterActualValues=function(t,i,r,u,f,e){var h=!0,s,c,o,l;return t.dictAttributes.sfwDataType=="Collection"||t.dictAttributes.sfwDataType=="CDOCollection"||t.dictAttributes.sfwDataType=="List"?i[t.dictAttributes.ID]!=undefined&&(s=i[t.dictAttributes.ID],s&&s.lstData&&s.lstData.length>0&&(t.Status=n.UpdateCollectionFieldActualValuesWithRuleEntity(t,r,s.lstData,u,f,e))):t.dictAttributes.sfwDataType=="Object"?i[t.dictAttributes.ID]!=undefined&&(o=i[t.dictAttributes.ID],o&&o.objData&&(c=o.objData,angular.forEach(t.Elements,function(n){if(n.Name=="fields"){t.objFieldsVM=n;return}}),c!=undefined&&t.objFieldsVM!=undefined&&(t.Status=n.UpdateChildTestParameterActualValues(t.objFieldsVM,c,r,u,f,e)))):(t.ResultValue="",t.Status=!1,r.idictOutParameters[t.dictAttributes.ID]!=undefined&&(o=r.idictOutParameters[t.dictAttributes.ID],o?(t.ResultValue=o.Value,t.Status=o.Status):(t.ResultValue="",t.Status=!1))),l=!1,t.dictAttributes.sfwIgnore!=undefined&&(l=t.dictAttributes.sfwIgnore.toLowerCase()=="true"),l||(h=h&&t.Status),h};n.UpdateResultParameterValues=function(t,i,r,u,f,e){var h=!0,s,o;return t.dictAttributes.sfwDataType=="Collection"||t.dictAttributes.sfwDataType=="CDOCollection"||t.dictAttributes.sfwDataType=="List"?(t.Status=n.UpdateCollectionFieldActualValues(t,i,r,u,f,e),o=!1,t.dictAttributes.sfwIgnore!=undefined&&(o=t.dictAttributes.sfwIgnore.toLowerCase()=="true"),o||(h=h&&t.Status)):t.dictAttributes.sfwDataType=="Object"?(t.Status=n.UpdateObjectFieldActualValues(t,i,r,u,f,e),o=!1,t.dictAttributes.sfwIgnore!=undefined&&(o=t.dictAttributes.sfwIgnore.toLowerCase()=="true"),o||(h=h&&t.Status)):(t.ResultValue="",t.dictAttributes.ID=="return"?r.iblnErrorOccurred?s=r.iobjReturnValue:(s=r.iobjReturnValue,s&&(t.ResultValue=s.Value)):i&&i.EntityFields&&i.EntityFields[t.dictAttributes.ID]&&(s=i.EntityFields[t.dictAttributes.ID],s&&(t.ResultValue=s.Value)),o=!1,t.dictAttributes.sfwIgnore!=undefined&&(o=t.dictAttributes.sfwIgnore.toLowerCase()=="true"),o||(t.Status=s?s.Status:!1,h=h&&t.Status)),h};n.UpdateObjectFieldActualValues=function(t,i,r,u,f,e){var o,h=!0,s;return t.dictAttributes.ID=="return"?r&&(s=r.iobjReturnValue,s&&s.Value&&(o=s.Value)):i&&i.Entities&&i.Entities[t.dictAttributes.ID]!=undefined&&(o=i.Entities[t.dictAttributes.ID]),o!=undefined&&(angular.forEach(t.Elements,function(n){if(n.Name=="fields"){t.objFieldsVM=n;return}}),h=t.objFieldsVM!=undefined?n.UpdateChildTestParameterActualValues(t.objFieldsVM,o,r,u,f,e):!1),h};n.UpdateCollectionFieldActualValues=function(t,i,r,u,f,e){var s,o;return t.dictAttributes.ID=="return"?(o=r.iobjReturnValue,o&&o.Value&&(s=o.lstData)):i&&i.Collections&&i.Collections[t.dictAttributes.ID]!=undefined&&(s=i.Collections[t.dictAttributes.ID]),n.UpdateCollectionFieldActualValuesWithRuleEntity(t,r,s,u,f,e)};n.UpdateCollectionFieldActualValuesWithRuleEntity=function(t,i,r,u,f){var e=!0;return r!=undefined?angular.forEach(t.Elements,function(o){var h,s;o.dictAttributes.indexNumber!=undefined&&o.dictAttributes.indexNumber<r.length&&(h=r[o.dictAttributes.indexNumber]);o.IsRuleExecuted=!0;o.Status=n.UpdateChildTestParameterActualValues(o,h,i,u,f,t);s=!1;t.dictAttributes.sfwIgnore!=undefined&&(s=t.dictAttributes.sfwIgnore.toLowerCase()=="true");s||(e=e&&o.Status)}):e=!1,e};n.UpdateChildTestParameterActualValues=function(t,i,r,u,f,e){var o=!0;return angular.forEach(t.Elements,function(t){t.IsRuleExecuted=!0;t.Status=n.UpdateResultParameterValues(t,i,r,u,f,e);o=o&&t.Status}),o};n.findObject=function(t,i){var r;return angular.forEach(t,function(t){r||(r=t.dictAttributes.ID==i?t:n.findObject(t.Elements,i))}),r};n.UpdateOutputParameters=function(n,t){var i=!0;angular.forEach(n.lstOutputValues,function(n){var r=t.filter(function(t){return t.ID==n.dictAttributes.ID}),u;r&&r.length?(n.ResultValue=r[0].strActualValue,u=!1,n.dictAttributes.sfwIgnore!=undefined&&(u=n.dictAttributes.sfwIgnore.toLowerCase()=="true"),u||(n.Status=r[0].Status,i=i&&n.Status)):n.Status=!1});n.Status=i};n.ShowOnlyExecutedPath=function(n,t){ShowOnlyExecutedPath(n,t)};n.UpdateTestExecutionFlow=function(t,i,r,u){i=="LogicalRule"?CheckAndSelectStepForLogicalRule(t,r,u):i=="DecisionTable"?CheckAndSelectStepForDecisionTable(t,r):i=="ExcelMatrix"&&n.prepareExcelMatrix(t,r)};n.prepareExcelMatrix=function(n,t){var f,u,s,o,r,i,e,h;for(t.objColumnValues=[],t.objHeaderRowValues=[],t.objHeaderColumnValues=[],t.objHeaderRowTitle="",t.objRows=[],f=t,r=0;r<f.Elements.length;r++)if(f.Elements[r].Name.toString().toLowerCase()=="rows")for(i=f.Elements[r],u=0;u<i.Elements.length;u++)i.Elements[u].dictAttributes.ID==0?(s=i.Elements[u].dictAttributes.sfwColumnValues,i.Elements[u].dictAttributes.Value!=undefined&&(t.objHeaderRowTitle=i.Elements[u].dictAttributes.Value),o=[],o=s.split(","),t.objHeaderColumnValues.push(o)):(s=i.Elements[u].dictAttributes.sfwColumnValues,o=[],o=s.split(","),t.objColumnValues.push(o),t.objHeaderRowValues.push(i.Elements[u].dictAttributes.Value));for(e=CheckAndSelectStepForExcelMatrix(n,t),r=0;r<f.Elements.length;r++)if(f.Elements[r].Name.toString().toLowerCase()=="rows")for(i=f.Elements[r],e=0;e<i.Elements.length;e++)i.Elements[e].OtherData!=undefined&&(h=-1,angular.forEach(t.objHeaderColumnValues[0],function(n){if(n==i.Elements[e].OtherData[1]){h=t.objHeaderColumnValues[0].indexOf(n);return}}),t.objOtherData=[i.Elements[e].OtherData[0],h])};n.RefreshScenario=function(){if(i.ClearUndoRedoListByFileName(n.currentfile.FileName),i.IsLoading=!0,n.IsObjectBasedScenario&&n.PopulateEntityRelatedDetail(),n.objEntityBasedScenario){if(n.objEntityBasedScenario.Elements&&n.objEntityBasedScenario.Elements.length>0)for(var t=0;t<n.objEntityBasedScenario.Elements.length;t++)n.objEntityBasedScenario.Elements[t].IsViewdiagramVisible=!1;$.connection.hubScenarioModel.server.refreshScenario(n.objEntityBasedScenario.dictAttributes.sfwRuleFile,n.IsObjectBasedScenario).done(function(t){n.$apply(function(){t&&t.length==2&&(n.CompileResult=t[0],n.ruleFileInfo=t[1],n.objEntityBasedScenario.Elements.length>0&&angular.forEach(n.objEntityBasedScenario.Elements,function(t){t.Name=="test"&&(n.LoadInputOutputValues(t),n.IsObjectBasedScenario&&n.RefreshXmlParameter(t))}));i.IsLoading=!1})})}};n.RefreshXmlParameter=function(t){function h(n){var i=s.filter(function(t){return t.dictAttributes.ID==n.ID}),r={Name:"parameter",Value:"",dictAttributes:{ID:n.ID,sfwDataType:n.DataType},Elements:[]};i&&i.length>0&&i[0].dictAttributes.Value!=undefined&&i[0].dictAttributes.Value!=""&&(r.dictAttributes.Value=i[0].dictAttributes.Value);t.objParameters.Elements.push(r)}function c(n){s.push(n)}var i,s,r,f,e,o;n.objEntityBasedScenario.objExtraData&&n.objEntityBasedScenario.objExtraData.entityModel&&(i=u.getEntityIntellisense(),i&&i.length>0&&(s=[],t.objParameters&&(angular.forEach(t.objParameters.Elements,c),t.objParameters.Elements=[]),t.objParameters||(t.objParameters={Name:"parameters",Value:"",dictAttributes:{},Elements:[]},t.Elements.push(t.objParameters)),t.objParameters&&(r=i.filter(function(t){return t.ID==n.objEntityBasedScenario.objExtraData.entityModel.dictAttributes.ID}),r&&r.length>0&&(f=r[0],f.XmlMethods&&f.XmlMethods.length>0&&(e=f.XmlMethods.filter(function(n){return n.ID==t.dictAttributes.sfwXmlMethod}),e&&e.length>0&&(o=e[0],o.Parameters&&o.Parameters.length>0&&angular.forEach(o.Parameters,h)))))))};n.NavigateToRule=function(){n.ruleFileInfo!=undefined&&i.openFile(n.ruleFileInfo)};n.LoadInputOutputValues=function(t){var i,r,u;n.SetDefaultSettings(t);t.inputflds=[];t.outputflds=[];n.CompileResult!=undefined&&(i=[],r=[],n.IsObjectBasedScenario||(i=n.CompileResult.ilstInputFields,r=n.CompileResult.ilstOutputFields),t.objInputVM!=undefined&&(t.inputflds=n.UpdateTestList(t,i,t.objInputVM.Elements,"Input")),t.objOutputVM!=undefined&&(t.outputflds=n.UpdateTestList(t,r,t.objOutputVM.Elements,"Output")));t.objOutputVM!=undefined&&(u=n.CheckAndReLoadReturnParameter(t))};n.SetDefaultSettings=function(n){n.IsRunSelected=!1;n.TestResult="";n.Status=!1};n.UpdateTestListParameter=function(t,r,u){var f=[];return angular.forEach(r,function(t){var s=t.ienmDirection=="0"?"InputParameter":"OutputParameter",r,e,o;angular.forEach(u,function(n){if(n.dictAttributes.ID==t.istrName&&n.dictAttributes.ParameterType==s){r=angular.copy(n);r.dictAttributes.ParameterType=s;return}});r==undefined&&(r={Name:"field",Value:"",dictAttributes:{ID:t.istrName,sfwDataType:t.istrDataType,ParameterType:s},Elements:[]},r.ruleDataInfo=t,CheckAndAddObjectFields(r,n.objEntity,i));f.push(r);(t.istrDataType=="Collection"||t.istrDataType=="CDOCollection"||t.istrDataType=="List"||t.istrDataType=="Object")&&(t.ilstInputFields.length>0&&s!="InputParameter"&&(angular.forEach(u,function(n){if(n.dictAttributes.ID==t.istrName&&n.dictAttributes.ParameterType!="OutputParameter"){e=angular.copy(n);e.dictAttributes.ParameterType="InputParameter";return}}),e==undefined&&(e={Name:"field",Value:"",dictAttributes:{ID:t.istrName,sfwDataType:t.istrDataType,ParameterType:"InputParameter"},Elements:[]},e.ruleDataInfo=t,CheckAndAddObjectFields(e,n.objEntity,i)),f.push(e)),t.ilstOutputFields.length>0&&s!="OutputParameter"&&(angular.forEach(u,function(n){if(n.dictAttributes.ID==t.istrName&&n.dictAttributes.ParameterType!="InputParameter"){o=angular.copy(n);o.dictAttributes.ParameterType="OutputParameter";return}}),o==undefined&&(o={Name:"field",Value:"",dictAttributes:{ID:t.istrName,sfwDataType:t.istrDataType,ParameterType:"OutputParameter"},Elements:[]},o.ruleDataInfo=t,CheckAndAddObjectFields(o,n.objEntity,i)),f.push(o)))}),f};n.UpdateTestList=function(t,r,u,f){var e=[];return angular.forEach(r,function(t){var r;angular.forEach(u,function(u){if(u.dictAttributes.ID==t.istrName){r={Name:"field",Value:"",dictAttributes:{},Elements:[]};ReloadTestParameterModel(r,u,t,n.objEntity,i);r.dictAttributes.ParameterType=f;return}});r==undefined&&(r={Name:"field",Value:"",dictAttributes:{ID:t.istrName,sfwDataType:t.istrDataType,ParameterType:f},Elements:[]},r.ruleDataInfo=t,CheckAndAddObjectFields(r,n.objEntity,i));r&&r.dictAttributes.sfwDataType=="Object"&&angular.forEach(u,function(t){var r,u,i;t.Name=="field"&&(n.IsObjectBasedScenario?n.CanProceedOpe(t.dictAttributes.ID)&&(u={istrName:t.dictAttributes.ID,istrDataType:t.dictAttributes.sfwDataType},i=angular.copy(t),i.ruleDataInfo=u,e.push(i)):t.dictAttributes.isExtraEntityField!=undefined&&t.dictAttributes.isExtraEntityField!=""&&t.dictAttributes.isExtraEntityField.toLowerCase()=="true"&&(angular.forEach(e,function(n){if(n.dictAttributes.ID==t.dictAttributes.ID){r=n;return}}),r==undefined&&(i=angular.copy(t),e.push(i))))});e.push(r)}),e};n.CanProceedOpe=function(t){var i=!0,r,u;return t=="return"?i=!1:null!=n.CompileResult&&(r=n.CompileResult.ilstInputFields.filter(function(n){return n.istrName==t}),u=n.CompileResult.ilstOutputFields.filter(function(n){return n.istrName==t}),r&&u&&r.length==0&&u.length==0&&(i=!0)),i};n.CheckAndReLoadReturnParameter=function(t){$.connection.hubScenarioModel.server.prepareEntityFiledInfo(n.objEntityBasedScenario.dictAttributes.sfwRuleFile).done(function(r){n.$apply(function(){var u,f=r;step=n.getSelectedStep(t.dictAttributes.ID);f!=null&&f!=undefined&&(angular.forEach(step.objOutputVM.Elements,function(t){if(t.dictAttributes.ID=="return"){u={Name:"field",Value:"",dictAttributes:{},Elements:[]};ReloadTestParameterModel(u,t,f,n.objEntity,i);u.dictAttributes.ParameterType="Output";return}}),u==undefined&&(u={Name:"field",Value:"",dictAttributes:{ID:"return",ParameterType:"Output",sfwDataType:f.istrDataType},Elements:[]},u.ruleDataInfo=f,CheckAndAddObjectFields(u,n.objEntity,i)),step.outputflds.push(u));n.UpdateTestListForAll(step)})})};n.UpdateTestListForAll=function(t){var r,u;if(t.paramflds=undefined,n.CompileResult!=undefined&&t.objParameterVM!=undefined&&(t.paramflds=n.UpdateTestListParameter(t,n.CompileResult.ilstParameters,t.objParameterVM.Elements)),i.UndRedoBulkOp("Start"),t.objInputVM!=undefined)for(r=t.objInputVM.Elements.length-1;r>-1;)t.objInputVM.Elements[r]&&t.objInputVM.Elements[r].dictAttributes.isExtraEntityField!="true"&&i.DeleteItem(t.objInputVM.Elements[r],t.objInputVM.Elements),r--;if(t.objOutputVM!=undefined)for(u=t.objOutputVM.Elements.length-1;u>-1;)t.objOutputVM.Elements[u]&&t.objOutputVM.Elements[u].dictAttributes.isExtraEntityField!="true"&&i.DeleteItem(t.objOutputVM.Elements[u],t.objOutputVM.Elements),u--;if(t.objParameterVM!=undefined)while(t.objParameterVM.Elements.length>0)i.DeleteItem(t.objParameterVM.Elements[0],t.objParameterVM.Elements);t.inputflds!=undefined&&t.objInputVM!=undefined&&angular.forEach(t.inputflds,function(n){i.PushItem(n,t.objInputVM.Elements)});t.outputflds!=undefined&&t.objOutputVM!=undefined&&angular.forEach(t.outputflds,function(n){i.PushItem(n,t.objOutputVM.Elements)});t.paramflds!=undefined&&t.objParameterVM!=undefined&&angular.forEach(t.paramflds,function(n){i.PushItem(n,t.objParameterVM.Elements)});n.UpdateDisplayInputOutputList(t,!1,!0);i.UndRedoBulkOp("End")};n.onBusinessObjectPropertViewerOpenClick=function(t){var r=n.$new(),u;r.IsInputField=t;u=n.objEntityBasedScenario.dictAttributes.BusinessObjectName;r.StrObjectTreeText="";r.StrObjectTreePath=u;u!=undefined&&u!=""&&$.connection.hubScenarioModel.server.loadObjectTree(u,!0).done(function(n){r.receiveObjectTree(n)});r.receiveObjectTree=function(n){r.$evalAsync(function(){r.ObjTreeForFields=n})};r.onOkObjectTree=function(){if(i.UndRedoBulkOp("Start"),r.ObjTreeForFields!=undefined){var t="",u="",e=n.objEntityBasedScenario.dictAttributes.BusinessObjectName,f=r.ObjTreeForFields.ChildProperties.filter(function(n){return n.IsChecked});angular.forEach(f,function(f){var e,o,h,s;t=n.makeStringToCamelCase(f.ShortName);dataType=getDataType(f.DataType,f.DataTypeName);e="";r.StrObjectTreePath!=undefined&&r.StrObjectTreePath!=""&&(e=r.StrObjectTreePath);e!=undefined&&e!=""&&e.contains(n.objEntity.dictAttributes.sfwObjectID)&&(e=e.substring(n.objEntity.dictAttributes.sfwObjectID.length+1));e!=undefined&&e!=""&&(e=e+".");u=e+f.ShortName;o={istrName:t,istrDataType:dataType};(o.istrDataType=="Object"||o.istrDataType=="Collection"||o.istrDataType=="CDOCollection"||o.istrDataType=="List")&&(o.ilstEntityFields=[]);h="Input";r.IsInputField||(h="output");s={Name:"field",Value:"",dictAttributes:{ID:t,sfwDataType:dataType,ParameterType:h},Elements:[]};CheckAndAddObjectFields(s,n.objEntity,i);r.IsInputField?n.objEntityBasedScenario.SelectedStep.objInputVM&&(i.PushItem(s,n.objEntityBasedScenario.SelectedStep.objInputVM.Elements),i.PushItem(s,n.objEntityBasedScenario.SelectedStep.lstInputValues)):n.objEntityBasedScenario.SelectedStep.objOutputVM&&(i.PushItem(s,n.objEntityBasedScenario.SelectedStep.objOutputVM.Elements),i.PushItem(s,n.objEntityBasedScenario.SelectedStep.lstOutputValues))})}i.UndRedoBulkOp("End");r.onCancelObjectTreeclick()};r.onCancelObjectTreeclick=function(){r.fieldsDialog.close()};r.onObjectTreeClick=function(n){(n.DataType=="TableObjectType"||n.DataType=="CollctionType"||n.DataType=="BusObjectType"||n.DataType=="OtherReferenceType")&&(r.StrObjectTreeText==undefined||r.StrObjectTreeText==""?(r.StrObjectTreeText=r.objEntity.dictAttributes.sfwObjectID,r.StrObjectTreePath=r.objEntity.dictAttributes.sfwObjectID+"."+n.ShortName):(r.StrObjectTreeText=r.StrObjectTreeText+"."+r.ObjTreeForFields.ItemType.Name,r.StrObjectTreePath=r.StrObjectTreePath+"."+n.ShortName));n.ItemType.Name!=undefined&&n.ItemType.Name!=""&&$.connection.hubScenarioModel.server.loadObjectTree(n.ItemType.Name,!0).done(function(n){r.receiveObjectTree(n)})};r.onToggleSelectionClick=function(n){r.ObjTreeForFields!=undefined&&angular.forEach(r.ObjTreeForFields.ChildProperties,function(t){t.IsCheckboxVisible&&(t.IsChecked=n)})};r.onLoadPreviosObjectTree=function(){if(r.StrObjectTreeText!=undefined||r.StrObjectTreeText!="")if(r.StrObjectTreeText.contains(".")){var n=r.StrObjectTreeText.substring(r.StrObjectTreeText.lastIndexOf(".")+1);$.connection.hubScenarioModel.server.loadObjectTree(n,!0).done(function(n){r.receiveObjectTree(n)});r.StrObjectTreeText=r.StrObjectTreeText.substring(0,r.StrObjectTreeText.lastIndexOf("."));r.StrObjectTreePath=r.StrObjectTreePath.substring(0,r.StrObjectTreePath.lastIndexOf("."))}else $.connection.hubScenarioModel.server.loadObjectTree(r.StrObjectTreeText,!0).done(function(n){r.receiveObjectTree(n)}),r.StrObjectTreeText=undefined,r.StrObjectTreePath=undefined};r.fieldsDialog=i.showDialog(r,"Object Tree Fields","Scenario/views/ScenarioObjectTree.html",{width:550,height:550})};n.makeStringToCamelCase=function(n){for(var t="",r=!0,i=0;i<n.length;i++)"~`!@#$%^&*_-+=[{()}]|:;<,.>?/.".contains(""+n[i])?r=!0:(t+=r?n.toUpperCase()[i]:n[i],r=""+n[i]==" "?!0:!1);return(t.toLowerCase().match("^iclb")||t.toLowerCase().match("^icol")||t.toLowerCase().match("^ibus"))&&(t=t.substring(4)),t};n.onCreateParameterScenario=function(){if(n.objEntityBasedScenario.SelectedStep&&n.objEntityBasedScenario.SelectedStep.IsRunSelected){var t="rsn"+n.objEntityBasedScenario.dictAttributes.ID.substring(3),r=i.lstopenedfiles.filter(function(n){return n.file.FileName==t});r&&r.length>0?alert("File "+t+" is already open. Close it for further updation ."):(i.IsLoading=!0,$.connection.hubScenarioModel.server.createParameterScenario(n.objEntityBasedScenario.SelectedStep.objParameters,n.objEntityBasedScenario.dictAttributes.sfwRuleFile,n.objEntityBasedScenario.dictAttributes.RemoteObjectName,n.objEntityBasedScenario.dictAttributes.BusinessObjectName,n.objEntityBasedScenario.SelectedStep.dictAttributes.sfwXmlMethod).done(function(t){var r=t,f,u;i.openFile(r);f=o(function(){if(i.lstopenedfiles.some(function(n){return n.file&&n.file.FileName==r.FileName})){var n=getScopeByFileName(r.FileName);n&&n.objEntityBasedScenario&&(n.TestSelectionChange(n.objEntityBasedScenario.Elements[n.objEntityBasedScenario.Elements.length-1]),o.cancel(f),i.IsLoading&&(i.IsLoading=!1))}},100);i.lstopenedfiles.some(function(t){return t.file&&t.file.FileName==n.objEntityBasedScenario.dictAttributes.sfwRuleFile})&&(u=getScopeByFileName(n.objEntityBasedScenario.dictAttributes.sfwRuleFile),u&&u.SetParameterScenario(t))}))}};n.scrolldownfunction=function(n){for(var i,u=n.objExcelColumnValues.indexOf(n.objColumnValues[n.objColumnValues.length-1]),r=0,t=u+1;t<n.objExcelColumnValues.length;t++){if(r==5)break;else n.objColumnValues.push(n.objExcelColumnValues[t]);r++}for(i=0;i<5;i++)n.objColumnValues.length>25&&n.objColumnValues.splice(0,1)};n.scrollupfunction=function(n){var i=n.objExcelColumnValues.indexOf(n.objColumnValues[0]),t=0,r,u;if(i!=0){for(i=i-1,r=i;r>=0;r--){if(t==5)break;else n.objColumnValues.splice(0,0,n.objExcelColumnValues[r]);t++}for(t=0,u=n.objColumnValues.length-1;u>0;u--){if(t==5)break;else n.objColumnValues.length>25&&n.objColumnValues.splice(u,1);t++}}};n.ExpandCollapseDiagram=function(){n.IsDiagramDivExpanded=!n.IsDiagramDivExpanded};n.render=function(n){n&&$(".run-result-spliter").width("100%").height("530px").split({orientation:"vertical",limit:20})};n.onDetailClick=function(){var t=n.$new();t.objExtraFields=[];t.objDirFunctions={};t.showExtraFieldsTab=!1;t.formName="Scenario";t.onOKClick=function(){t.objDirFunctions.prepareExtraFieldData&&t.objDirFunctions.prepareExtraFieldData();t.closeDialog()};t.validateDetails=function(){var i,n;return(t.DetailsErrorMessage=undefined,i=!1,t.objDirFunctions.getExtraFieldData&&(t.objExtraFields=t.objDirFunctions.getExtraFieldData()),n=validateExtraFields(t),n)?(t.DetailsErrorMessage=t.FormDetailsErrorMessage,!0):t.DetailsErrorMessage!=undefined?!0:!1};t.closeDialog=function(){t.dialog&&t.dialog.close()};t.dialog=i.showDialog(t,"Details","Scenario/views/ScenarioDetails.html",{height:500,width:500})};n.addExtraFieldsDataInToMainModel=function(){if(n.objScenarioExtraFields){var t=n.objEntityBasedScenario.Elements.indexOf(n.objScenarioExtraFields);t==-1&&n.objEntityBasedScenario.Elements.push(n.objScenarioExtraFields)}};n.BeforeSaveToFile=function(){n.addExtraFieldsDataInToMainModel()};n.selectXmlMethodClick=function(t){t&&t!=""&&t!="NewObject"&&e.NavigateToFile(n.objEntity.dictAttributes.ID,"methods",t)}}]);app.directive("collactionrowdirective",["$compile","$rootScope",function(n,t){var i=function(n,t){var i;return n.IsOutput?(i='<td > <input type="text" ng-disabled="isexcelbasedscenario" class="form-control form-filter input-sm min-width-80" title="{{items.dictAttributes.indexNumber}}" undoredodirective model="items" ng-model="items.dictAttributes.indexNumber"><\/td>',i+='<td valign="top" ng-repeat="item in items.Elements" ng-model="SelectedTestField">',i+="  <table><tr><td> <span ng-hide=\"item.dictAttributes.sfwDataType == 'Collection' || item.dictAttributes.sfwDataType == 'List' || item.dictAttributes.sfwDataType == 'Object'\"> Expected Value :<\/span><\/td>",i+=' <td>  <input type="text" ng-disabled="isexcelbasedscenario" class="form-control form-filter input-sm min-width-80" title="{{item.dictAttributes.Value}}" ng-model="item.dictAttributes.Value" undoredodirective model="item" ng-hide="item.dictAttributes.sfwDataType == \'Collection\' || item.dictAttributes.sfwDataType == \'List\' || item.dictAttributes.sfwDataType == \'Object\'"/> <\/td>',i+='  <td> <a><img src="images/Common/icon_add_dark.svg" ng-click="OpenPopupForCollection(item)" ng-show="item.dictAttributes.sfwDataType == \'Collection\' || item.dictAttributes.sfwDataType == \'List\'"/><\/a> <\/td>',i+='  <td> <a><img src="images/Common/icon_add_dark.svg"  ng-click="OpenPopupForObject(item)" ng-show="item.dictAttributes.sfwDataType == \'Object\'"/><\/a><\/td><\/tr> ',t.IsRunSelected&&(i+="<tr ng-hide=\"(item.dictAttributes.sfwDataType == 'Collection' || item.dictAttributes.sfwDataType == 'List' || item.dictAttributes.sfwDataType == 'Object') \"><td> <div > Actual Value :<\/div><\/td><td><span>{{item.ResultValue}}<\/span><\/td><\/tr>"),i+='<tr ng-hide="item.dictAttributes.sfwDataType == \'Collection\' || item.dictAttributes.sfwDataType == \'List\' || item.dictAttributes.sfwDataType == \'Object\'">  <td> <span>Ignore Field :<\/span><\/td> <td><input type="checkbox" ng-disabled="isexcelbasedscenario" ng-true-value="\'True\'" ng-false-value="\'False\'" ng-model="item.dictAttributes.sfwIgnore" undoredodirective model="item"><\/td><\/tr>',t.IsRunSelected&&(i+='<tr ng-hide="(item.dictAttributes.sfwDataType == \'Collection\' || item.dictAttributes.sfwDataType == \'List\' || item.dictAttributes.sfwDataType == \'Object\')">   <td ng-hide="(item.dictAttributes.sfwIgnore == \'True\')"> Field Result :<\/td> <td ng-hide="(item.dictAttributes.sfwIgnore == \'True\')"> <i class="fa fa-check faCheckScenario" ng-show="item.Status"><\/i><i class="fa fa-times faTimesScenario" ng-show="!item.Status"><\/i><\/td><\/tr>'),i+="<\/table><\/td>",i+='<td > <input type="checkbox" ng-disabled="isexcelbasedscenario" ng-model="items.dictAttributes.sfwIgnore" undoredodirective model="items" ng-checked="items.dictAttributes.sfwIgnore" ng-true-value="\'True\'" ng-false-value="\'False\'"><\/td>',i+'<td ng-show="objselectedstep.IsRunSelected==true && (items.dictAttributes.sfwIgnore == \'False\' || items.dictAttributes.sfwIgnore==undefined)"><i class="fa fa-check faCheckScenario" ng-show="items.Status==true"><\/i><i class="fa fa-times faTimesScenario" ng-show="items.Status!=true"><\/i><\/td>'):(i='<td valign="top" ng-repeat="item in items.Elements" ng-model="SelectedTestField">',i+='   <input type="text" ng-disabled="isexcelbasedscenario" class="form-control form-filter input-sm" title="{{item.dictAttributes.Value}}" ng-model="item.dictAttributes.Value" undoredodirective model="item" ng-hide="item.dictAttributes.sfwDataType == \'Collection\' || item.dictAttributes.sfwDataType == \'List\' || item.dictAttributes.sfwDataType == \'Object\'"/>',i+='   <a><img src="images/Common/icon_add_dark.svg" ng-click="OpenPopupForCollection(item)" ng-show="item.dictAttributes.sfwDataType == \'Collection\' || item.dictAttributes.sfwDataType == \'List\'"/><\/a>',i+='   <a><img src="images/Common/icon_add_dark.svg"  ng-click="OpenPopupForObject(item)" ng-show="item.dictAttributes.sfwDataType == \'Object\'"/><\/a>',i+"<\/td>")};return{restrict:"A",replace:!0,scope:{items:"=",model:"=",objentity:"=",objselectedstep:"=",isexcelbasedscenario:"="},link:function(r,u){u.html(i(r.model,r.objselectedstep));n(u.contents())(r);r.OpenPopupForCollection=function(n){var u,i;n.objentity=r.objentity;n.lstCollectionColumn=[];n.IsOutput=r.model.IsOutput;n.ExtraFields=[];n.ruleDataInfo!=undefined&&(u=GetEntityFieldsFromRuleDataInfo(n,r.objentity),u!=undefined&&angular.forEach(u,function(t){n.lstCollectionColumn.push(t)}));n.Elements.length>0&&angular.forEach(n.Elements[0].Elements,function(i){if(i.dictAttributes.isExtraEntityField&&i.dictAttributes.isExtraEntityField=="true"){var r={istrName:i.dictAttributes.ID,istrDataType:i.dictAttributes.sfwDataType,istrEntity:i.dictAttributes.istrEntity};(r.istrDataType=="Object"||r.istrDataType=="Collection"||r.istrDataType=="CDOCollection"||r.istrDataType=="List")&&(r.ilstEntityFields=[]);n.ExtraFields==undefined&&(n.ExtraFields=[]);t.PushItem(r,n.ExtraFields)}});n.ExtraFields!=undefined&&angular.forEach(n.ExtraFields,function(t){n.lstCollectionColumn.push(t)});i=r.$new();i.SelectedTestField=n;i.SelectedTestField.IsOutput=!1;i.objselectedstep=r.objselectedstep;i.IsExcelBasedScenario=r.isexcelbasedscenario;i.AddColumnForCollection=function(){AddColumnForCollection(i.SelectedTestField,i,r,t)};i.DeleteCollectionField=function(){DeleteCollectionField(i.SelectedTestField,t)};i.UpdateSelectedCollectionField=function(n){UpdateSelectedCollectionField(n,i.SelectedTestField)};i.AddCollectionField=function(){AddCollectionField(i.SelectedTestField,r.objentity,t)};i.onCancelClick=function(){i.collectionDialog.close()};i.menuOptionForCollection=[["Delete Column",function(n){DeleteColumnFromCollection(i.SelectedTestField,n.objcol)}],null];i.collectionDialog=t.showDialog(i,i.SelectedTestField.dictAttributes.ID,"Scenario/views/OpenCollectionPopup.html")};r.OpenPopupForObject=function(n){if(r.model.IsOutput)r.OpenPopupForOutputObject(n,r.objselectedstep);else{r.SelectedTestField=n;r.SelectedTestField.objentity=r.objentity;angular.forEach(r.SelectedTestField.Elements,function(n){if(n.Name=="fields"){r.SelectedTestField.objFieldsVM=n;return}});r.SelectedTestField.objFieldsVM!=undefined&&angular.forEach(r.SelectedTestField.Elements,function(n){if(n.Name=="field"){r.SelectedTestField.objFieldsVM.SelectedField=n;return}});var i=r.$new();i.SelectedTestField=r.SelectedTestField;i.SelectedTestField.ExtraFields=[];i.AddExtraFields=function(n){n.Elements.length>0&&angular.forEach(n.Elements[0].Elements,function(i){if(i.dictAttributes.isExtraEntityField&&i.dictAttributes.isExtraEntityField=="true"){var r={istrName:i.dictAttributes.ID,istrDataType:i.dictAttributes.sfwDataType,istrEntity:i.dictAttributes.istrEntity};(r.istrDataType=="Object"||r.istrDataType=="Collection"||r.istrDataType=="CDOCollection"||r.istrDataType=="List")&&(r.ilstEntityFields=[]);t.PushItem(r,n.ExtraFields)}})};i.AddExtraFields(i.SelectedTestField);i.IsExcelBasedScenario=r.isexcelbasedscenario;i.UpdateSelectedObjectField=function(n){UpdateSelectedObjectField(n,i.SelectedTestField)};i.DeleteObjectField=function(){DeleteObjectField(i.SelectedTestField,t)};i.AddColumnForCollection=function(){AddColumnForCollection(i.SelectedTestField,i,r,t)};i.OnConstantValueChange=function(n){n&&t.EditPropertyValue(n.dictAttributes.Value,n.dictAttributes,"Value","")};i.objectInputDialog=t.showDialog(i,i.SelectedTestField.dictAttributes.ID,"Scenario/views/OpenObjectPopup.html")}};r.OpenPopupForOutputObject=function(n,i){r.SelectedOutputTestField=n;r.SelectedOutputTestField.objentity=r.objentity;angular.forEach(r.SelectedOutputTestField.Elements,function(n){if(n.Name=="fields"){r.SelectedOutputTestField.objFieldsVM=n;return}});r.SelectedOutputTestField.objFieldsVM!=undefined&&angular.forEach(r.SelectedOutputTestField.Elements,function(n){if(n.Name=="field"){r.SelectedOutputTestField.objFieldsVM.SelectedField=n;return}});var u=r.$new();u.SelectedTestField=r.SelectedOutputTestField;u.objselectedstep=i;u.UpdateSelectedObjectField=function(n){UpdateSelectedObjectField(n,u.SelectedTestField)};u.DeleteObjectField=function(){DeleteObjectField(u.SelectedTestField,t)};u.AddColumnForCollection=function(){AddColumnForCollection(u.SelectedTestField,u,r,t)};u.OnConstantValueChange=function(n){n&&t.EditPropertyValue(n.dictAttributes.Value,n.dictAttributes,"Value","")};u.objectOutputDialog=t.showDialog(u,u.SelectedTestField.dictAttributes.ID,"Scenario/views/OpenObjectPopupForOutput.html")}}}}]);app.directive("ruledirectiveforscenarioexecution",["$compile",function(n){var t=function(n){var t;return n!=undefined&&n.dictAttributes!=undefined?n.dictAttributes.sfwRuleType=="LogicalRule"?(t='<div class="logical-rule-container" id="dvLogicalRule">',t+='<ul class="logical-rule-first-ul">',t+="<li ng-if=\"item.Name != 'variables'\" ng-repeat='item in objSelectedLogicalRule.Elements'>",t+='<logical-rule-node-wrapper-for-scenario-execution model="item" parent-model="objSelectedLogicalRule" objentity="objEntity" objmainlogicalrule="objLogicalRule" scenarioruntype="scenarioruntype"><\/logical-rule-node-wrapper>',t+="<\/li>",t+="<\/ul>",t+="<\/div>"):n.dictAttributes.sfwRuleType=="ExcelMatrix"&&(t=' <div class="tree" custom-scroll >',t+='<span class="excelmatrix-columnheader">{{objLogicalRule.dictAttributes.columnHeader}}<\/span>',t+='<div class="excelmatrix-rowheader-wrapper">',t+='                            <span class="excelmatrix-rowheader" ng-bind="objLogicalRule.dictAttributes.rowHeader"><\/span>',t+="                        <\/div>",t+='<div class="excelmatrix-table" excelmatrixscrolldirective>',t+='    <table class="excel-table" cellspacing="0" cellpadding="0" id="tblExcelMatricsSecond" >',t+="        <thead>",t+='            <tr ng-repeat="objcol in objSelectedLogicalRule.objHeaderColumnValues">',t+='      <th valign= "top" class="excel-colheader">',t+='          <span ng-bind="objSelectedLogicalRule.objHeaderRowTitle"><\/span>',t+="  <\/th>",t+='      <td class="excel-colheader" ng-repeat="obj in objcol track by $index" ng-class="(obj==objSelectedLogicalRule.selectedHeaderValue)?\'excel-rowheader-execution\':\'excel-data\'"  >',t+='          <span valign="top" ng-bind="obj"><\/span>',t+="      <\/td>",t+="  <\/tr > ",t+="        <\/thead>",t+="        <tbody>",t+='            <tr ng-repeat="objval in objSelectedLogicalRule.objColumnValues" ng-init="cindex = $index">',t+="                <td ng-class=\"(objSelectedLogicalRule.objHeaderRowValues[$index] == objSelectedLogicalRule.objOtherData[0])?'excel-rowheader-execution' : 'excel-rowheader'\" valign= \"top\" >",t+='                    <span ng-bind="objSelectedLogicalRule.objHeaderRowValues[$index]"><\/span>',t+="                <\/td >",t+='    <td ng-class="GetExcelMatrixStepSelectedClass(obj, cindex, objSelectedLogicalRule, objval, $index)" valign="top" ng-repeat="obj in objval track by $index">',t+='        <span valign="top" ng-bind="obj"><\/span>',t+="    <\/td>",t+="            <\/tr > ",t+="        <\/tbody>",t+="    <\/table>",t+="<\/div>",t+="<\/div>"):(t='<div class="tree" id="dvDecisionTable" >',t+='<div>     <table class="dt-table-border" cellspacing="0" cellpadding="0">',t+="         <tbody>",t+='             <tr ng-show="obj.IsVisiblefterExecution" rowconditiondirectiveforscenarioexecution ng-repeat="obj in objSelectedLogicalRule.Rows  | limitTo : noConditionsDisplayed" items="obj" logicalrule="objSelectedLogicalRule"><\/tr>',t+="         <\/tbody>",t+="     <\/table><\/div>",t+=" <\/div>"),t};return{restrict:"E",replace:!0,scope:!1,link:function(i,r){i.GetExcelMatrixStepSelectedClass=function(n,t,i,r,u){var f="excel-data",e;return i.objOtherData!=undefined&&((i.objHeaderRowValues[t]==i.objOtherData[0]||i.objOtherData[1]==u)&&(f+=" excel-cell-execution"),i.objHeaderRowValues[t]==i.objOtherData[0]&&(e=r[i.objOtherData[1]],i.objOtherData[1]==u&&e==n&&(f="excel-data-execution"))),f};i.LoadSomeRowsinExcelMatrix=function(){var t,n;if(i.objSelectedLogicalRule.objColumnValues)for(t=i.objSelectedLogicalRule.objColumnValues.length,count=0,n=t;n<i.objSelectedLogicalRule.objExcelColumnValues.length;n++){if(count==5)break;else i.objSelectedLogicalRule.objColumnValues.push(i.objSelectedLogicalRule.objExcelColumnValues[n]);count++}};r.html(t(i.objLogicalRule));n(r.contents())(i)}}}]);app.directive("logicalRuleNodeWrapperForScenarioExecution",["$compile","$rootScope","$timeout","$EntityIntellisenseFactory",function(n,t,i,r){return{restrict:"E",scope:{model:"=",objentity:"=",objmainlogicalrule:"=",scenarioruntype:"=",parentModel:"="},replace:!0,link:function(u,f){var o,e;u.getNodeTemplate=function(){var n="";switch(u.model.Name){case"actions":n="<actions-node-for-scenario-execution><\/actions-node-for-scenario-execution>";break;case"break":case"continue":case"default":n="<break-continue-default-node-for-scenario-execution><\/break-continue-default-node-for-scenario-execution>";break;case"notes":n="<notes-node-for-scenario-execution><\/notes-node-for-scenario-execution>";break;case"return":case"switch":case"case":case"while":n="<return-switch-case-while-node-for-scenario-execution><\/return-switch-case-while-node-for-scenario-execution>";break;case"calllogicalrule":case"calldecisiontable":case"callexcelmatrix":n="<call-rule-node-for-scenario-execution><\/call-rule-node-for-scenario-execution>";break;case"foreach":n="<for-each-node-for-scenario-execution><\/for-each-node-for-scenario-execution>";break;case"query":n="<query-node-for-scenario-execution><\/query-node-for-scenario-execution>";break;case"method":n="<method-node-for-scenario-execution><\/method-node-for-scenario-execution>"}return n};u.getTemplate=function(){var n=['<div node-id="{{::model.dictAttributes.sfwNodeID}}" node-name="{{::model.Name}}" ng-keydown="onkeydownevent($event,model,parentModel)">                                                                                 ',"    <span ng-show=\"(model.Name === 'foreach' || model.Name === 'while' || model.Name === 'switch') || (model.Name !== 'case' && model.Name !== 'default' && model.Children.length > 0) || ((model.Name === 'case' || model.Name === 'default') && model.Elements.length > 0)\" class=\"node-expander node-expanded\" ng-click=\"toggleNodeChildren($event)\"><\/span>                                                                                              ",'    <div class="node-wrapper node-wrapper-after">                                                                                                                                        '];return n.push(u.getNodeTemplate()),n=n.concat(["<ul ng-show=\"model.CanExpandOrCollapse\" ng-if=\"model.Name == 'foreach' || model.Name == 'while'\" ng-class=\"model.Name == 'switch'? 'ul-switch':'ul-children'\">                 ",'            <li ng-repeat="item in model.Elements">                                                                                                                                      ','                <logical-rule-node-wrapper-for-scenario-execution model="item" parent-model="model" objmainlogicalrule="objmainlogicalrule" scenarioruntype="scenarioruntype" objentity="objentity"><\/logical-rule-node-wrapper-for-scenario-execution>                                                           ',"            <\/li>                                                                                                                                                                        ","                                                                                                                                                                                         ","        <\/ul>","<ul ng-if=\"model.Name == 'switch'\" ng-class=\"model.Name == 'switch'? 'ul-switch':'ul-children'\">                 ",'            <li ng-repeat="item in model.Elements">                                                                                                                                      ','                <logical-rule-node-wrapper-for-scenario-execution model="item" parent-model="model" objmainlogicalrule="objmainlogicalrule" scenarioruntype="scenarioruntype" objentity="objentity"><\/logical-rule-node-wrapper-for-scenario-execution>                                                           ',"            <\/li>                                                                                                                                                                        ","                                                                                                                                                                                         ","        <\/ul> ","    <\/div>                                                                                                                                                                               ","    <ul ng-if=\"(model.Name == 'case' || model.Name == 'default') && model.Elements.length>0\">                                                                                        ",'        <li ng-repeat="item in model.Elements">                                                                                                                                          ','            <logical-rule-node-wrapper-for-scenario-execution model="item" parent-model="model" objmainlogicalrule="objmainlogicalrule" scenarioruntype="scenarioruntype" objentity="objentity"><\/logical-rule-node-wrapper-for-scenario-execution>                                                               ',"        <\/li>                                                                                                                                                                            ","    <\/ul>                                                                                                                                                                                ","    <ul ng-if=\"model.Name != 'case' && model.Name != 'default' && model.Children.length>0\">                                                                                          ",'        <li ng-repeat="item in model.Children">                                                                                                                                          ','            <logical-rule-node-wrapper-for-scenario-execution model="item" parent-model="model" objmainlogicalrule="objmainlogicalrule" scenarioruntype="scenarioruntype" objentity="objentity"><\/logical-rule-node-wrapper-for-scenario-execution>                                                               ',"        <\/li>                                                                                                                                                                            ","    <\/ul>                                                                                                                                                                                ","<\/div>                                                                                                                                                                                   "]),n.join("")};u.toggleParameters=function(n){if(u.parameters&&u.parameters.Elements.length>0){var t=$(n.target).parents(".node").first();t.find(".parameters-expander-refresh.fa-caret-right").length>0?u.showParameters(t):u.hideParameters(t)}};u.showParameters=function(n){n.find(".parameters-wrapper").slideDown("slow");n.find(".parameters-expander-refresh.fa-caret-right").addClass("fa-caret-down");n.find(".parameters-expander-refresh.fa-caret-right").removeClass("fa-caret-right")};u.hideParameters=function(n){n.find(".parameters-wrapper").slideUp("slow");n.find(".parameters-expander-refresh.fa-caret-down").addClass("fa-caret-right");n.find(".parameters-expander-refresh.fa-caret-down").removeClass("fa-caret-down")};u.syncParameterVisibility=function(n){i(function(){n.find(".parameters-expander-refresh.fa-caret-right").length>0?u.hideParameters(n):u.showParameters(n)})};u.toggleNodeChildren=function(n){$(n.target).hasClass("node-expanded")?collapseNode(n.target,!0):expandNode(n.target,!0)};u.onStepSelectChange=function(n){var t=getCurrentFileScope();t.onSelectChange(n);u.SelectedNode=n};u.onActionKeyDown=function(n){if(controllerScope=getCurrentFileScope(),controllerScope&&controllerScope.onActionKeyDown){controllerScope.SelectedNode=u.SelectedNode;controllerScope.onActionKeyDown(n)}};u.onDescriptionKeyDown=function(){};u.init=function(){if((u.model.Name==="switch"||u.model.Name==="foreach"||u.model.Name==="while")&&(u.childrenCollection=u.model.Elements),u.siblingsCollection=u.model.Name==="case"||u.model.Name==="default"?u.model.Elements:u.model.Children,u.model.Elements.length>0){var t=function(n){return n.Name=="parameters"},n=u.model.Elements.filter(t);n&&n.length>0&&(u.parameters=n[0])}if(u.model.IsSelected)u.onStepSelectChange(u.model)};u.getCssClass=function(n){var t="";return n.dictAttributes.sfwCommented==="True"&&(t="commented-node"),n.IsSelected?(t+=" selected-node",n.isAdvanceSearched&&(t+=" bckgGreen")):n.isAdvanceSearched&&(t+=" bckgGrey"),t};u.getClass=function(){if(u.model)return u.model.Name=="default"?u.model.IsStepSelected?"case-block-execution":u.model.IsErrorOccured?"case-block-error-occur ":"case-block-default":u.model.dictAttributes&&u.model.dictAttributes.sfwCommented=="True"?"text-assign-execution-commented":u.model.IsStepSelected?"text-assign-execution":u.model.IsErrorOccured?"text-assign-error-occur ":"text-assign-default"};u.OnLoopExecutionClick=function(){if((u.model.Name=="foreach"||u.model.Name=="while")&&u.model.CanExpandOrCollapse!=undefined&&!u.model.CanExpandOrCollapse&&u.model.LoopExecutionCount!==undefined&&u.model.LoopExecutionCount>0){var n=u.$new();n.LoopViewModel=GetBaseModel(u.model);n.LoopViewModel.TestExeRuleObject=u.model.TestExeRuleObject;n.LoopViewModel.IsStepSelected=u.model.IsStepSelected;n.LoopViewModel.CanExpandOrCollapse=!0;n.LoopViewModel.LoopExecutionCount=0;n.IsDiagramDivExpanded=!0;n.Elements=[];n.IsWhileLoop=!1;u.model.Name=="while"&&(n.IsWhileLoop=!0);n.InitLoopExecutionSteps=function(){var t,u,r,i;n.LoopViewModel.Name=="foreach"?(n.SetEntity(),typeof n.LoopViewModel.TestExeRuleObject.iobjData!="undefined"&&n.LoopViewModel.TestExeRuleObject.iobjData.length!==undefined?(r=n.LoopViewModel.TestExeRuleObject.iobjData,r!=undefined&&(t=0,angular.forEach(r,function(i){var r;r=t<n.LoopViewModel.TestExeRuleObject.ilstSteps.length?{RuleObj:i,logicalRuleLoopViewModel:n.LoopViewModel,ExecutedSteps:n.LoopViewModel.TestExeRuleObject.ilstSteps[t],index:t,properties:{}}:{RuleObj:i,logicalRuleLoopViewModel:n.LoopViewModel,ExecutedSteps:undefined,index:t,properties:{}};r!=undefined&&n.setValueForStep(r,t);n.Elements.push(r);t++}))):(t=0,angular.forEach(n.LoopViewModel.TestExeRuleObject.ilstSteps,function(t){u={RuleObj:undefined,logicalRuleLoopViewModel:n.LoopViewModel,ExecutedSteps:t,index:i,properties:{}};n.Elements.push(u);i++})),n.GetLoopParameter(),n.GetColumns()):n.LoopViewModel.Name=="while"&&(r=n.LoopViewModel.TestExeRuleObject.ilstSteps,i=0,angular.forEach(r,function(r){var u;u={Name:"Iteration"+i,RuleObj:r,logicalRuleLoopViewModel:n.LoopViewModel,ExecutedSteps:r,index:t,properties:{}};u!=undefined&&n.setValueForStep(u,i);n.Elements.push(u);i++}));n.Elements!==undefined&&n.Elements.length>0&&n.UpdateStepOnSelectionChange(n.Elements[0])};n.SetEntity=function(){var e=n.LoopViewModel.dictAttributes.sfwObjectID,i=CheckAndGetExpressionValue(n.LoopViewModel,e),o="",t,f;u.objentity!=undefined&&(o=u.objentity.dictAttributes.ID);t="";i!==undefined&&i!==""&&(angular.forEach(i.split("."),function(n){u.objentity!=undefined&&(t=GetEntityID(u.objentity,n))}),t!==undefined&&t!==""&&(f=r.getEntityIntellisense(),angular.forEach(f,function(i){i.ID==t&&(n.objEntity=i)})))};n.CheckAndSetValFotIsDataTable=function(){var i=n.LoopViewModel.dictAttributes.sfwObjectID.lastIndexOf("."),t,r;i<0&&(i=0);t=n.LoopViewModel.dictAttributes.sfwObjectID.substring(i);t!==undefined&&t!==""&&(n.IsDataTable=!1,r=n.objEntity.Queries.filter(function(i){i.ID==t&&(n.IsDataTable=!0)}))};n.setValueForStep=function(t,i){t.IsExecuted=t.ExecutedSteps==undefined?!1:!0;t.RuleObj!=undefined&&(t.RuleObj.EntityFields==undefined&&t.RuleObj.Collections==undefined?t.Name="Iteration "+i:Object.keys(t.RuleObj.EntityFields).length==0&&Object.keys(t.RuleObj.Collections).length==0?t.Name="Iteration "+i:(angular.forEach(t.RuleObj.EntityFields,function(n,i){t.properties[i]=n}),angular.forEach(t.RuleObj.Collections,function(n,i){t.properties[i]=t.index}),angular.forEach(t.RuleObj.Entities,function(i,r){n.setValueForStepForObject(i,r,t)})))};n.setValueForStepForObject=function(t,i,r){var u=i;angular.forEach(t.EntityFields,function(n,t){r.properties[u+"."+t]=n});angular.forEach(t.Collections,function(n,t){r.properties[u+"."+t]=r.index});angular.forEach(t.Entities,function(t,i){n.setValueForStepForObject(t,u+"."+i,r)})};n.GetLoopParameter=function(){var t=GetExpressionValue(n.LoopViewModel,n.LoopViewModel.dictAttributes.sfwObjectID);u.objmainlogicalrule!=undefined&&(n.LoopParameter=GetLoopParameter(u.objmainlogicalrule,t))};n.GetColumns=function(){var i,r;n.Columns=[];n.Elements.length>0&&(i=n.Elements[0].RuleObj,i!==undefined?(angular.forEach(i.EntityFields,function(t,i){n.Columns.push(i)}),angular.forEach(i.Collections,function(t,i){n.Columns.push(i)}),angular.forEach(i.Entities,function(t,i){n.GetColumnsForObject(t,i)})):n.objEntity!==undefined?(r=t.getEntityAttributeIntellisense(n.objEntity.ID,!0),angular.forEach(r,function(t){n.Columns.push(t.ID)})):n.LoopParameter!==undefined?angular.forEach(n.LoopParameter.Elements,function(t){n.Columns.push(t.dictAttributes.ID)}):n.Columns.push("Iteration"))};n.GetColumnsForObject=function(t,i){var r=i;angular.forEach(t.EntityFields,function(t,i){n.Columns.push(r+"."+i)});angular.forEach(t.Collections,function(t,i){n.Columns.push(r+"."+i)});angular.forEach(t.Entities,function(t,i){n.GetColumnsForObject(t,r+"."+i)})};n.render=function(n){if(n){var t=[];t=$(".run-result-spliter-loop");angular.forEach(t,function(n){$(n).width("100%").height("400px").split({orientation:"vertical",limit:20})})}};n.ExpandCollapseNode=function(){i(function(){var t=$("#ScopeId_"+n.$id).find(".logical-rule-container").find(".node-expander"),i,r;if(t&&t.length>0)for(i=0;i<t.length>0;i++)r=angular.element(t[i]).scope(),r&&r.model&&!r.model.IsStepSelected&&collapseNode(t[i],!0);if(t=$("#ScopeId_"+n.$id).find(".logical-rule-container").find(".node-collapsed"),t&&t.length>0)for(i=0;i<t.length>0;i++)r=angular.element(t[i]).scope(),r&&r.model&&r.model.IsStepSelected&&expandNode(t[i],!0)})};n.UpdateStepOnSelectionChange=function(t){n.SelectedStep=t;n.SelectedStep!=undefined&&(n.LoopViewModel.IsShowDiagram=n.SelectedStep.IsExecuted,n.LoopViewModel.IsStepSelected=!1,n.SelectedStep.IsExecuted&&(n.LoopViewModel.IsStepSelected=!0,angular.forEach(n.LoopViewModel.Elements,function(t){t.Name!="items"&&CheckAndUpdateStep(t,n.SelectedStep.ExecutedSteps,u.scenarioruntype)}),n.LoopViewModel.Children!=null&&angular.forEach(n.LoopViewModel.Children,function(t){t.Name!="items"&&CheckAndUpdateStep(t,n.SelectedStep.ExecutedSteps,u.scenarioruntype)})),n.ExpandCollapseNode())};n.setClassForLoop=function(t){return t==n.SelectedStep?"selected":t.IsExecuted?void 0:"disabled"};n.ExpandCollapseDiagram=function(){n.IsDiagramDivExpanded=!n.IsDiagramDivExpanded};n.loopExecutionDialog=t.showDialog(n,"Run Result For Loop","Scenario/views/TestLoopExecution.html",{height:550,width:1e3});n.InitLoopExecutionSteps();n.ExpandCollapseNode()}};u.init();o=f.parent();o&&(e=$(u.getTemplate()),n(e)(u),f.remove(),o.append(e),(u.model.Name==="foreach"||u.model.Name==="while")&&i(function(){var n=e.parents(".ul-children-even,.ul-children-odd").length;n>0&&n%2==1?e.find("> .node-wrapper > .ul-children").addClass("ul-children-even"):e.find("> .node-wrapper > .ul-children").addClass("ul-children-odd")}))}}}]);app.directive("actionsNodeForScenarioExecution",[function(){return{restrict:"E",replace:!0,templateUrl:"Scenario/views/LogicalRule/ActionsNodeTemplate.html"}}]);app.directive("breakContinueDefaultNodeForScenarioExecution",[function(){return{restrict:"E",replace:!0,templateUrl:"Scenario/views/LogicalRule/BreakContinueDefaultNodeTemplate.html"}}]);app.directive("callRuleNodeForScenarioExecution",["$rootScope","$EntityIntellisenseFactory","$timeout",function(n,t,i){return{restrict:"E",replace:!0,link:function(t){t.OnCallLogicalRuleDoubleClick=function(){if(t.scenarioruntype=="AllRuleSteps"&&t.model!=undefined&&(t.model.Name=="calllogicalrule"||t.model.Name=="calldecisiontable"||t.model.Name=="callexcelmatrix")){var r=t.model.dictAttributes.sfwRuleID;$.connection.hubScenarioModel.server.checkAndLoadRuleDiagram(r).done(function(r){t.$apply(function(){var u,f,e,o,s,h;t.objLogicalRule=r;u=t.$new();u.objLogicalRule=t.objLogicalRule;u.scenarioruntype=t.scenarioruntype;f="";e="DecisionTable";t.objLogicalRule.dictAttributes!=undefined?(e=t.objLogicalRule.dictAttributes.sfwRuleType,f=t.objLogicalRule.dictAttributes.ID):f=t.objLogicalRule.RuleID;u.objEntity=t.objentity;o="";s="Default";t.model.TestExeRuleObject!=undefined&&(u.objSelectedLogicalRule=GetClosestLogicalRule(t.objLogicalRule,t.model.TestExeRuleObject.istrOtherData,e),s=t.model.TestExeRuleObject.istrOtherData?t.model.TestExeRuleObject.istrOtherData:"Default",o=t.model.TestExeRuleObject.ExecutionTime,h=[],t.model.TestExeRuleObject.ilstSteps.length>0&&t.model.TestExeRuleObject.ilstSteps[0]&&(h=t.model.TestExeRuleObject.ilstSteps[0]),UpdateTestExecutionFlow(h,e,u.objSelectedLogicalRule,u.scenarioruntype));u.callRuleExecutionDialog=n.showDialog(u,"Rule : "+f+" - Effective Date : "+s+"[ Elapsed Time: "+o+"]","Scenario/views/TestCallLogicalRuleExecution.html",{width:900,height:500});u.ShowOnlyExecutedPath=function(n){ShowOnlyExecutedPath(n,u.objSelectedLogicalRule)};i(function(){var n=$("#ScopeId_"+u.$id).find(".logical-rule-container").find(".node-expander"),t,i;if(n&&n.length>0)for(t=0;t<n.length>0;t++)i=angular.element(n[t]).scope(),i&&i.model&&!i.model.IsStepSelected&&collapseNode(n[t],!0)})})})}}},templateUrl:"Scenario/views/LogicalRule/CallRuleNodeTemplate.html"}}]);app.directive("forEachNodeForScenarioExecution",[function(){return{restrict:"E",replace:!0,templateUrl:"Scenario/views/LogicalRule/ForEachNodeTemplate.html"}}]);app.directive("methodNodeForScenarioExecution",[function(){return{restrict:"E",replace:!0,templateUrl:"Scenario/views/LogicalRule/MethodNodeTemplate.html"}}]);app.directive("notesNodeForScenarioExecution",["$rootScope",function(){return{restrict:"E",replace:!0,templateUrl:"Scenario/views/LogicalRule/NotesNodeTemplate.html"}}]);app.directive("queryNodeForScenarioExecution",[function(){return{restrict:"E",replace:!0,templateUrl:"Scenario/views/LogicalRule/QueryNodeTemplate.html"}}]);app.directive("returnSwitchCaseWhileNodeForScenarioExecution",[function(){return{restrict:"E",replace:!0,templateUrl:"Scenario/views/LogicalRule/ReturnSwitchCaseWhileNodeTemplate.html"}}]);var GetEntityID=function(n,t){var u="",i,r=n.Elements.filter(function(n){if(n.Name=="attributes")return n});return r&&r.length>0&&(i=r[0].Elements.filter(function(n){if(n.Name=="attribute"&&n.dictAttributes.ID==t)return n})),i!=undefined&&i.length>0&&(u=i[0].dictAttributes.sfwEntity),u};app.directive("rowconditionitemdirectiveforscenarioexecution",["$compile",function(){return{restrict:"A",scope:{items:"=",logicalrule:"="},templateUrl:"Rule/views/DecisionTable/rowconditionitem.html",link:function(n){n.init=function(){n.conditionType="default";n.items.Item.ItemType=="notesheader"||n.items.Item.ItemType=="returnheader"?n.conditionType="1":n.items.Item.ItemType=="colheader"||n.items.Item.ItemType=="rowheader"?n.conditionType="2":n.items.Item.ItemType=="assignheader"?n.conditionType="3":n.items.Item.ItemType!="notesheader"&&n.items.Item.ItemType!="returnheader"&&n.items.Item.ItemType!="colheader"&&n.items.Item.ItemType!="rowheader"&&n.items.Item.ItemType!="assignheader"&&n.items.Item.ItemType!="notes"&&n.items.Item.Expression&&n.items.Item.Expression.length>0&&(n.conditionType="5")};n.getclass=function(n){if(n!=undefined)return n.Item.ItemType=="if"?n.Item.IsStepSelected?"dt-if-execution":n.Item.IsRelatedStepAfterExecution?"dt-if-execution-related-step":n.Item.IsErrorOccured?"dt-if-step-execution-error-occur":"dt-if-step-execution":n.Item.ItemType=="colheader"||n.Item.ItemType=="rowheader"?"dt-row-col-header-execution":n.Item.ItemType=="assignheader"?n.Item.IsStepSelected?"dt-assign-header-execution":n.Item.IsErrorOccured?"dt-assign-header-execution-related-step":"dt-row-assign-header-execution":n.Item.IsStepSelected?"dt-assign-execution-decisiontable":n.Item.IsRelatedStepAfterExecution?"dt-assign-execution-related-step":n.Item.IsErrorOccured?"dt-assign-execution-error-occur":"dt-assign-step-execution"};n.init()}}}]);app.directive("rowconditiondirectiveforscenarioexecution",["$compile","$interval",function(){return{restrict:"A",scope:{items:"=",logicalrule:"="},template:'<td rowconditionitemdirectiveforscenarioexecution ng-repeat="objChild in items.Cells" items="objChild" valign="top" rowspan={{objChild.Rowspan}} colspan={{objChild.Colspan}} class="dt-table-cell"  logicalrule="logicalrule"><\/td>'}}]);