<?xml version="1.0" encoding="utf-8"?>
<entity ID="entGLTransaction" sfwMainCDO="icdoGlTransaction" sfwType="BusinessRule" sfwActive="True" sfwStatus="Review" sfwObjectID="busGLTransaction" sfwTableName="sgt_gl_transaction">
  <queries>
    <query ID="Lookup" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="Select * from (SELECT s.*,cv1.description as item_type_description FROM SGT_GL_TRANSACTION s &#xD;&#xA;left join sgs_code_value cv1 on cv1.code_id=s.item_type_id and cv1.code_value=s.item_type_value)SGL">
      <parameters />
    </query>
    <query ID="GetExtractFileName" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT DISTINCT EXTRACT_FILE_NAME FROM SGT_GL_TRANSACTION GL &#xD;&#xA;WHERE CONVERT(DATETIME,CONVERT(VARCHAR,extract_date,101) ,110)=@extract_date">
      <parameters>
        <parameter ID="@extract_date" sfwDataType="DateTime" />
      </parameters>
    </query>
    <query ID="GetGLTransactionsByFileName" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT PLAN_ID,POSTING_DATE,ACCOUNT_ID,FUND_ID,FUND_VALUE , DEPT_ID,DEPT_VALUE, CASE WHEN SOURCE_TYPE_VALUE = 'REMI' THEN SOURCE_ID ELSE NULL END AS DTI,&#xD;&#xA;SUM(ISNULL(DEBIT_AMOUNT,0) - ISNULL(CREDIT_AMOUNT,0)) AS TOTAL_AMOUNT, EXTRACT_DATE&#xD;&#xA;FROM SGT_GL_TRANSACTION &#xD;&#xA;WHERE EXTRACT_FILE_NAME=@FILE_NAME AND EXTRACT_DATE = @EXTRACTDATE&#xD;&#xA;GROUP BY ACCOUNT_ID,POSTING_DATE,FUND_ID,FUND_VALUE, DEPT_ID,DEPT_VALUE,EXTRACT_DATE,&#xD;&#xA;CASE WHEN SOURCE_TYPE_VALUE = 'REMI' THEN SOURCE_ID ELSE NULL END,PLAN_ID,POSTING_DATE">
      <parameters>
        <parameter ID="@FILE_NAME" sfwDataType="string" />
        <parameter ID="@EXTRACTDATE" sfwDataType="DateTime" />
      </parameters>
    </query>
    <query ID="GetTransactionForPeopleSoft" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT POSTING_DATE,ACCOUNT_ID,FUND_ID,FUND_VALUE , DEPT_ID,DEPT_VALUE, &#xD;&#xA;NULL AS DTI,&#xD;&#xA;SUM(ISNULL(DEBIT_AMOUNT,0) - ISNULL(CREDIT_AMOUNT,0)) AS TOTAL_AMOUNT&#xD;&#xA;FROM SGT_GL_TRANSACTION &#xD;&#xA;WHERE EXTRACT_DATE IS NULL AND SOURCE_TYPE_VALUE &lt;&gt; 'REMI'&#xD;&#xA; AND POSTING_DATE &lt;= @POSTINGDATE&#xD;&#xA;GROUP BY ACCOUNT_ID,POSTING_DATE,FUND_ID,FUND_VALUE, DEPT_ID,DEPT_VALUE,POSTING_DATE&#xD;&#xA;UNION ALL&#xD;&#xA;SELECT POSTING_DATE,ACCOUNT_ID,FUND_ID,FUND_VALUE , DEPT_ID,DEPT_VALUE, &#xD;&#xA;D.DEPOSIT_TAPE_ID AS DTI,&#xD;&#xA;SUM(ISNULL(DEBIT_AMOUNT,0) - ISNULL(CREDIT_AMOUNT,0)) AS TOTAL_AMOUNT&#xD;&#xA;FROM SGT_GL_TRANSACTION A &#xD;&#xA;INNER JOIN SGT_REMITTANCE B ON A.SOURCE_ID = B.REMITTANCE_ID&#xD;&#xA;INNER JOIN SGT_DEPOSIT C ON C.DEPOSIT_ID = B.DEPOSIT_ID&#xD;&#xA;INNER JOIN SGT_DEPOSIT_TAPE D ON D.DEPOSIT_TAPE_ID = C.DEPOSIT_TAPE_ID &#xD;&#xA;WHERE EXTRACT_DATE IS NULL AND SOURCE_TYPE_VALUE = 'REMI'&#xD;&#xA; AND POSTING_DATE &lt;= @POSTINGDATE&#xD;&#xA;GROUP BY ACCOUNT_ID,D.DEPOSIT_TAPE_ID,POSTING_DATE,FUND_ID,FUND_VALUE, DEPT_ID,DEPT_VALUE,POSTING_DATE">
      <parameters>
        <parameter ID="@POSTINGDATE" sfwDataType="DateTime" />
      </parameters>
    </query>
    <query ID="GetTransactionForRIO" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT ACCOUNT_ID,POSTING_DATE,PLAN_ID,&#xD;&#xA;SUM(ISNULL(DEBIT_AMOUNT,0) - ISNULL(CREDIT_AMOUNT,0)) AS TOTAL_AMOUNT&#xD;&#xA;FROM SGT_GL_TRANSACTION&#xD;&#xA;WHERE CONVERT(DATETIME,CONVERT(VARCHAR,POSTING_DATE,101) ,110) BETWEEN @START_DATE AND @END_DATE&#xD;&#xA;AND PLAN_ID IN (2,3,5,20,26,29)&#xD;&#xA;AND ACCOUNT_ID IN (49,50,51,52,53,54,56,57,79,81)&#xD;&#xA;AND FUND_VALUE = 483 --ADDED FOR PIR 9918&#xD;&#xA;GROUP BY ACCOUNT_ID,POSTING_DATE,PLAN_ID">
      <parameters>
        <parameter ID="@START_DATE" sfwDataType="DateTime" />
        <parameter ID="@END_DATE" sfwDataType="DateTime" />
      </parameters>
    </query>
    <query ID="sqOrgCodeID" sfwQueryType="SubSelectQuery" sfwSql="SELECT * FROM SGT_ORGANIZATION SO WHERE SO.ORG_ID=SGL.ORG_ID">
      <parameters />
    </query>
    <query ID="sqGLType" sfwQueryType="SubSelectQuery" sfwSql="SELECT * FROM SGT_CHART_OF_ACCOUNT SCA WHERE SCA.CHART_OF_ACCOUNT_ID=SGL.ACCOUNT_ID">
      <parameters />
    </query>
    <query ID="GetGLTransactionByExtractDate" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT * FROM SGT_GL_TRANSACTION &#xD;&#xA;WHERE EXTRACT_DATE IS NULL">
      <parameters />
    </query>
    <query ID="CreateGLFromPayrollForPremiumPayment" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT   REM.PLAN_ID,ACTREF.FUND_VALUE,ACTREF.DEPT_VALUE,ACTREF.SOURCE_TYPE_VALUE,&#xD;&#xA;     ACTREF.ITEM_TYPE_VALUE,ACTREF.TRANSACTION_TYPE_VALUE,ACTREF.ACCOUNT_REFERENCE_ID,&#xD;&#xA;     ACTREF.DEBIT_ACCOUNT_ID AS DEBIT_ACCOUNT_ID,ACTREF.CREDIT_ACCOUNT_ID AS CREDIT_ACCOUNT_ID,REM.ORG_ID,REM.PERSON_ID,&#xD;&#xA;     REM.REMITTANCE_ID,REM.REMITTANCE_AMOUNT AS AMOUNT,PHH.PAYMENT_DATE AS EFFECTIVE_DATE,TAP.DEPOSIT_DATE,NULL AS EXTRACT_DATE,&#xD;&#xA;     ACTREF.JOURNAL_DESCRIPTION,NULL AS EXTRACT_FILE_NAME,'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  CREATED_BY , GETDATE() AS CREATED_DATE,&#xD;&#xA;     'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  MODIFIED_BY ,GETDATE() AS MODIFIED_DATE, 0 AS UPDATE_SEQ, ACTREF.GENERATE_GL_FLAG&#xD;&#xA;INTO   #TEMP_GL&#xD;&#xA; FROM  SGT_PAYMENT_HISTORY_HEADER  PHH&#xD;&#xA;  INNER JOIN SGT_DEPOSIT DEP&#xD;&#xA;    ON DEP.PAYMENT_HISTORY_HEADER_ID = PHH.PAYMENT_HISTORY_HEADER_ID&#xD;&#xA;  INNER JOIN SGT_DEPOSIT_TAPE TAP&#xD;&#xA;    ON DEP.DEPOSIT_TAPE_ID = TAP.DEPOSIT_TAPE_ID&#xD;&#xA;  INNER JOIN SGT_REMITTANCE REM&#xD;&#xA;    ON REM.DEPOSIT_ID = DEP.DEPOSIT_ID&#xD;&#xA;  INNER JOIN SGT_ACCOUNT_REFERENCE ACTREF&#xD;&#xA;    ON REM.PLAN_ID = ACTREF.PLAN_ID&#xD;&#xA;      AND ACTREF.ITEM_TYPE_VALUE = REM.REMITTANCE_TYPE_VALUE&#xD;&#xA;      AND ACTREF.SOURCE_TYPE_VALUE = 'REMI'&#xD;&#xA;      AND ACTREF.TRANSACTION_TYPE_VALUE = 'STAT'&#xD;&#xA;      AND ACTREF.STATUS_TRANSITION_VALUE = 'APPL'&#xD;&#xA; WHERE  PHH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;&#xD;&#xA;SELECT   PLAN_ID,SOURCE_TYPE_VALUE,ITEM_TYPE_VALUE,TRANSACTION_TYPE_VALUE,&#xD;&#xA;     ORG_ID,PERSON_ID,&#xD;&#xA;     REMITTANCE_ID,AMOUNT,&#xD;&#xA;     DEPOSIT_DATE&#xD;&#xA;INTO   #TEMP_ACCTREF&#xD;&#xA;FROM   #TEMP_GL&#xD;&#xA;GROUP BY  PLAN_ID,SOURCE_TYPE_VALUE,ITEM_TYPE_VALUE,TRANSACTION_TYPE_VALUE,&#xD;&#xA;     ORG_ID,PERSON_ID,&#xD;&#xA;     REMITTANCE_ID,AMOUNT,&#xD;&#xA;     DEPOSIT_DATE&#xD;&#xA;HAVING  COUNT(SOURCE_TYPE_VALUE) &gt; 1&#xD;&#xA;&#xD;&#xA;DELETE   A&#xD;&#xA;FROM   #TEMP_GL A,#TEMP_ACCTREF B&#xD;&#xA;WHERE   A.PLAN_ID = B.PLAN_ID&#xD;&#xA;      AND A.SOURCE_TYPE_VALUE = B.SOURCE_TYPE_VALUE&#xD;&#xA;      AND A.ITEM_TYPE_VALUE = B.ITEM_TYPE_VALUE&#xD;&#xA;      AND A.TRANSACTION_TYPE_VALUE = B.TRANSACTION_TYPE_VALUE&#xD;&#xA;      AND A.ORG_ID = B.ORG_ID&#xD;&#xA;      AND A.PERSON_ID = B.PERSON_ID&#xD;&#xA;      AND A.REMITTANCE_ID = B.REMITTANCE_ID&#xD;&#xA;      AND A.AMOUNT = B.AMOUNT&#xD;&#xA;      AND A.DEPOSIT_DATE = B.DEPOSIT_DATE&#xD;&#xA;&#xD;&#xA;INSERT INTO SGT_GL_TRANSACTION&#xD;&#xA;    (PLAN_ID, FUND_ID, FUND_VALUE, DEPT_ID, DEPT_VALUE, SOURCE_TYPE_ID, &#xD;&#xA;    SOURCE_TYPE_VALUE, ITEM_TYPE_ID, ITEM_TYPE_VALUE, TRANSACTION_TYPE_ID, &#xD;&#xA;    TRANSACTION_TYPE_VALUE, ACCOUNT_REFERENCE_ID, ACCOUNT_ID, ORG_ID, &#xD;&#xA;    PERSON_ID, SOURCE_ID, DEBIT_AMOUNT, CREDIT_AMOUNT, EFFECTIVE_DATE, POSTING_DATE, &#xD;&#xA;    EXTRACT_DATE, JOURNAL_DESCRIPTION, EXTRACT_FILE_NAME, &#xD;&#xA;    CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE, UPDATE_SEQ)&#xD;&#xA;SELECT PLAN_ID,1300, FUND_VALUE,1301,DEPT_VALUE,1304,SOURCE_TYPE_VALUE,&#xD;&#xA;    1302,ITEM_TYPE_VALUE,1303,TRANSACTION_TYPE_VALUE,ACCOUNT_REFERENCE_ID,&#xD;&#xA;    DEBIT_ACCOUNT_ID AS ACCOUNT_ID,ORG_ID,PERSON_ID,&#xD;&#xA;    REMITTANCE_ID,AMOUNT AS DEBIT_AMOUNT,0 AS CREDIT_AMOUNT,&#xD;&#xA;    EFFECTIVE_DATE,DEPOSIT_DATE,EXTRACT_DATE,JOURNAL_DESCRIPTION,&#xD;&#xA;    EXTRACT_FILE_NAME,CREATED_BY ,CREATED_DATE,&#xD;&#xA;    MODIFIED_BY ,MODIFIED_DATE, UPDATE_SEQ&#xD;&#xA;FROM  #TEMP_GL&#xD;&#xA;WHERE  GENERATE_GL_FLAG = 1&#xD;&#xA;UNION ALL &#xD;&#xA;SELECT  PLAN_ID,1300, FUND_VALUE,1301,DEPT_VALUE,1304,SOURCE_TYPE_VALUE,&#xD;&#xA;    1302,ITEM_TYPE_VALUE,1303,TRANSACTION_TYPE_VALUE,ACCOUNT_REFERENCE_ID,&#xD;&#xA;    CREDIT_ACCOUNT_ID AS ACCOUNT_ID,ORG_ID,PERSON_ID,&#xD;&#xA;    REMITTANCE_ID,0 AS DEBIT_AMOUNT,AMOUNT AS CREDIT_AMOUNT,&#xD;&#xA;    EFFECTIVE_DATE,DEPOSIT_DATE,EXTRACT_DATE,JOURNAL_DESCRIPTION,&#xD;&#xA;    EXTRACT_FILE_NAME,CREATED_BY ,CREATED_DATE,&#xD;&#xA;    MODIFIED_BY ,MODIFIED_DATE, UPDATE_SEQ&#xD;&#xA;FROM  #TEMP_GL&#xD;&#xA;WHERE  GENERATE_GL_FLAG = 1&#xD;&#xA;&#xD;&#xA;DROP TABLE #TEMP_GL&#xD;&#xA;DROP TABLE #TEMP_ACCTREF">
      <parameters>
        <parameter ID="@PAYMENTSCHEDULEID" sfwDataType="int" />
        <parameter ID="@batchscheduleid" sfwDataType="int" />
      </parameters>
    </query>
    <query ID="CreateGLFromPayroll" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT PHH.PLAN_ID,&#xD;&#xA;  AC.FUND_VALUE,&#xD;&#xA;  AC.DEPT_VALUE,&#xD;&#xA;  AC.SOURCE_TYPE_VALUE,&#xD;&#xA;  AC.ITEM_TYPE_VALUE,&#xD;&#xA;  AC.TRANSACTION_TYPE_VALUE,&#xD;&#xA;  AC.ACCOUNT_REFERENCE_ID,&#xD;&#xA;  AC.DEBIT_ACCOUNT_ID AS DEBIT_ACCOUNT_ID,&#xD;&#xA;  AC.CREDIT_ACCOUNT_ID AS CREDIT_ACCOUNT_ID,&#xD;&#xA;  PHH.ORG_ID,PHH.PERSON_ID,&#xD;&#xA;  PHD.PAYMENT_HISTORY_DETAIL_ID,&#xD;&#xA;  PHD.AMOUNT AS AMOUNT,&#xD;&#xA;  PHH.PAYMENT_DATE AS EFFECTIVE_DATE,&#xD;&#xA;  PHH.PAYMENT_DATE,&#xD;&#xA;  NULL AS EXTRACT_DATE,&#xD;&#xA;  AC.JOURNAL_DESCRIPTION,&#xD;&#xA;  NULL AS EXTRACT_FILE_NAME,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  CREATED_BY ,&#xD;&#xA;  GETDATE() AS CREATED_DATE,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  MODIFIED_BY ,&#xD;&#xA;  GETDATE() AS MODIFIED_DATE,&#xD;&#xA;  0 AS UPDATE_SEQ,&#xD;&#xA;  isnull(AC.GENERATE_GL_FLAG,0) AS GENERATE_GL_FLAG&#xD;&#xA;  ,CASE &#xD;&#xA;&#x9;WHEN &#xD;&#xA;&#x9;&#x9;AC.ITEM_TYPE_VALUE IN ('P014','P015','P016','P023','P031','P032','P069','P070','P217','P220','P223','P225') &#xD;&#xA;&#x9;&#x9;AND AC.SOURCE_TYPE_VALUE = 'BEPY' AND AC.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;&#x9;&#x9;AND AC.CREDIT_ACCOUNT_ID = 239 &#xD;&#xA;&#x9;THEN &#xD;&#xA;&#x9;&#x9;PHD.ROLLOVER_ORG_ID &#xD;&#xA;&#x9;ELSE &#xD;&#xA;&#x9;&#x9;NULL &#xD;&#xA;&#x9;END AS ROLLOVER_ORG_ID_FROM_DETAIL&#xD;&#xA;INTO #TEMP_GL&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   &#xD;&#xA;FROM SGT_PAYMENT_HISTORY_HEADER  PHH&#xD;&#xA; INNER JOIN SGT_PAYMENT_HISTORY_DETAIL PHD&#xD;&#xA;  ON PHD.PAYMENT_HISTORY_HEADER_ID = PHH.PAYMENT_HISTORY_HEADER_ID&#xD;&#xA; INNER JOIN SGT_PAYMENT_ITEM_TYPE PIT &#xD;&#xA;  ON PHD.PAYMENT_ITEM_TYPE_ID = PIT.PAYMENT_ITEM_TYPE_ID&#xD;&#xA;INNER JOIN SGT_ACCOUNT_REFERENCE AC&#xD;&#xA;  ON PHH.PLAN_ID = AC.PLAN_ID&#xD;&#xA;    AND PIT.ITEM_TYPE_CODE_VALUE = AC.ITEM_TYPE_VALUE&#xD;&#xA;    AND AC.SOURCE_TYPE_VALUE = @SOURCETYPE&#xD;&#xA;    AND AC.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;    AND AC.STATUS_TRANSITION_VALUE is null&#xD;&#xA;WHERE PHH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;AND (1 = CASE WHEN (PHH.PLAN_ID = 9 AND @SOURCETYPE = 'VPMT') THEN 2 ELSE 1 END) --PIR 14848&#xD;&#xA;AND ISNULL(AC.ITEM_TYPE_VALUE, '') &lt;&gt; 'P457'&#xD;&#xA;and (PHH.ORG_ID IS NULL or (PHH.ORG_ID IS NOT NULL AND AC.ITEM_TYPE_VALUE NOT IN ('P215','P216','P218','P219','P221','P222')))&#xD;&#xA;--fund transfer GL Creation&#xD;&#xA;&#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT OPH.PLAN_ID,&#xD;&#xA;&#x9;  AC.FUND_VALUE,&#xD;&#xA;&#x9;  AC.DEPT_VALUE,&#xD;&#xA;&#x9;  AC.SOURCE_TYPE_VALUE,&#xD;&#xA;&#x9;  AC.ITEM_TYPE_VALUE,&#xD;&#xA;&#x9;  AC.TRANSACTION_TYPE_VALUE,&#xD;&#xA;&#x9;  AC.ACCOUNT_REFERENCE_ID,&#xD;&#xA;&#x9;  AC.DEBIT_ACCOUNT_ID AS DEBIT_ACCOUNT_ID,&#xD;&#xA;&#x9;  AC.CREDIT_ACCOUNT_ID AS CREDIT_ACCOUNT_ID,&#xD;&#xA;&#x9;  OPH.ORG_ID,NULL AS PERSON_ID,&#xD;&#xA;&#x9;  OPD.PAYMENT_HISTORY_DETAIL_ID,&#xD;&#xA;&#x9;  MPD.AMOUNT AS AMOUNT,&#xD;&#xA;&#x9;  OPH.PAYMENT_DATE AS EFFECTIVE_DATE,&#xD;&#xA;&#x9;  OPH.PAYMENT_DATE,&#xD;&#xA;&#x9;  NULL AS EXTRACT_DATE,&#xD;&#xA;&#x9;  AC.JOURNAL_DESCRIPTION,&#xD;&#xA;&#x9;  NULL AS EXTRACT_FILE_NAME,&#xD;&#xA;&#x9;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  CREATED_BY ,&#xD;&#xA;&#x9;  GETDATE() AS CREATED_DATE,&#xD;&#xA;&#x9;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  MODIFIED_BY ,&#xD;&#xA;&#x9;  GETDATE() AS MODIFIED_DATE,&#xD;&#xA;&#x9;  0 AS UPDATE_SEQ,&#xD;&#xA;&#x9;  isnull(AC.GENERATE_GL_FLAG,0) AS GENERATE_GL_FLAG&#xD;&#xA;&#x9;  , NULL AS ROLLOVER_ORG_ID_FROM_DETAIL&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   &#xD;&#xA;&#x9;FROM SGT_PAYMENT_HISTORY_DETAIL OPD&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_ITEM_TYPE PITO ON PITO.PAYMENT_ITEM_TYPE_ID = OPD.PAYMENT_ITEM_TYPE_ID AND PITO.ITEM_TYPE_CODE_VALUE IN ('P221', 'P222')&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER OPH ON OPH.PAYMENT_HISTORY_HEADER_ID = OPD.PAYMENT_HISTORY_HEADER_ID AND OPH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL MPD ON MPD.ROLLOVER_ORG_ID = OPH.ORG_ID&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER MPH ON MPD.PAYMENT_HISTORY_HEADER_ID = MPH.PAYMENT_HISTORY_HEADER_ID AND MPH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID AND OPH.PAYEE_ACCOUNT_ID = MPH.PAYEE_ACCOUNT_ID&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_ITEM_TYPE PITM ON MPD.PAYMENT_ITEM_TYPE_ID = PITM.PAYMENT_ITEM_TYPE_ID AND PITO.ITEM_TYPE_CODE = PITM.ROLLOVER_ITEM_CODE AND PITM.ALLOW_ROLLOVER_CODE_VALUE = 'RRED'&#xD;&#xA;&#x9;JOIN SGT_ACCOUNT_REFERENCE AC on ac.ITEM_TYPE_VALUE = PITO.ITEM_TYPE_CODE_VALUE AND OPH.PLAN_ID = AC.PLAN_ID&#xD;&#xA;    AND PITO.ITEM_TYPE_CODE_VALUE = AC.ITEM_TYPE_VALUE&#xD;&#xA;    AND AC.SOURCE_TYPE_VALUE = @SOURCETYPE&#xD;&#xA;    AND AC.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;    AND AC.STATUS_TRANSITION_VALUE is null&#xD;&#xA;&#x9;WHERE OPH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;&#xD;&#xA;Union All&#xD;&#xA;&#xD;&#xA;SELECT PHH.PLAN_ID,&#xD;&#xA;  AC.FUND_VALUE,&#xD;&#xA;  AC.DEPT_VALUE,&#xD;&#xA;  AC.SOURCE_TYPE_VALUE,&#xD;&#xA;  AC.ITEM_TYPE_VALUE,&#xD;&#xA;  AC.TRANSACTION_TYPE_VALUE,&#xD;&#xA;  AC.ACCOUNT_REFERENCE_ID,&#xD;&#xA;  AC.DEBIT_ACCOUNT_ID AS DEBIT_ACCOUNT_ID,&#xD;&#xA;  AC.CREDIT_ACCOUNT_ID AS CREDIT_ACCOUNT_ID,&#xD;&#xA;  PHH.ORG_ID,PHH.PERSON_ID,&#xD;&#xA;  PHD.PAYMENT_HISTORY_DETAIL_ID,&#xD;&#xA;  PHD.AMOUNT AS AMOUNT,&#xD;&#xA;  PHH.PAYMENT_DATE AS EFFECTIVE_DATE,&#xD;&#xA;  PHH.PAYMENT_DATE,&#xD;&#xA;  NULL AS EXTRACT_DATE,&#xD;&#xA;  AC.JOURNAL_DESCRIPTION,&#xD;&#xA;  NULL AS EXTRACT_FILE_NAME,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  CREATED_BY ,&#xD;&#xA;  GETDATE() AS CREATED_DATE,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  MODIFIED_BY ,&#xD;&#xA;  GETDATE() AS MODIFIED_DATE,&#xD;&#xA;  0 AS UPDATE_SEQ,&#xD;&#xA;  isnull(AC.GENERATE_GL_FLAG,0) AS GENERATE_GL_FLAG&#xD;&#xA;  ,NULL AS ROLLOVER_ORG_ID_FROM_DETAIL&#xD;&#xA;FROM SGT_PAYMENT_HISTORY_HEADER  PHH&#xD;&#xA; INNER JOIN SGT_PAYMENT_HISTORY_DETAIL PHD&#xD;&#xA;  ON PHD.PAYMENT_HISTORY_HEADER_ID = PHH.PAYMENT_HISTORY_HEADER_ID&#xD;&#xA; INNER JOIN SGT_PAYMENT_ITEM_TYPE PIT &#xD;&#xA;  ON PHD.PAYMENT_ITEM_TYPE_ID = PIT.PAYMENT_ITEM_TYPE_ID&#xD;&#xA;INNER JOIN SGT_ACCOUNT_REFERENCE AC&#xD;&#xA;  ON PHH.PLAN_ID = AC.PLAN_ID&#xD;&#xA;    AND PIT.ITEM_TYPE_CODE_VALUE = AC.ITEM_TYPE_VALUE&#xD;&#xA;    AND AC.SOURCE_TYPE_VALUE =  @SOURCETYPE&#xD;&#xA;    AND AC.TRANSACTION_TYPE_VALUE = 'TRAN'&#xD;&#xA;    AND AC.STATUS_TRANSITION_VALUE is null&#xD;&#xA;WHERE PHH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;AND (1 = CASE WHEN (PHH.PLAN_ID = 9 AND @SOURCETYPE = 'VPMT') THEN 2 ELSE 1 END) --PIR 14848&#xD;&#xA;AND ISNULL(AC.ITEM_TYPE_VALUE, '') &lt;&gt; 'P457'&#xD;&#xA;&#xD;&#xA;INSERT INTO SGT_GL_TRANSACTION&#xD;&#xA;    (PLAN_ID, FUND_ID, FUND_VALUE, DEPT_ID, DEPT_VALUE, SOURCE_TYPE_ID, &#xD;&#xA;    SOURCE_TYPE_VALUE, ITEM_TYPE_ID, ITEM_TYPE_VALUE, TRANSACTION_TYPE_ID, &#xD;&#xA;    TRANSACTION_TYPE_VALUE, ACCOUNT_REFERENCE_ID, ACCOUNT_ID, ORG_ID, &#xD;&#xA;    PERSON_ID, SOURCE_ID, DEBIT_AMOUNT, CREDIT_AMOUNT, EFFECTIVE_DATE, POSTING_DATE, &#xD;&#xA;    EXTRACT_DATE, JOURNAL_DESCRIPTION, EXTRACT_FILE_NAME, &#xD;&#xA;    CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE, UPDATE_SEQ)&#xD;&#xA;SELECT PLAN_ID,1300, FUND_VALUE,1301,DEPT_VALUE,1304,SOURCE_TYPE_VALUE,&#xD;&#xA;    1302,ITEM_TYPE_VALUE,1303,TRANSACTION_TYPE_VALUE,ACCOUNT_REFERENCE_ID,&#xD;&#xA;    DEBIT_ACCOUNT_ID AS ACCOUNT_ID,ORG_ID,PERSON_ID,&#xD;&#xA;    PAYMENT_HISTORY_DETAIL_ID,AMOUNT AS DEBIT_AMOUNT,0 AS CREDIT_AMOUNT,&#xD;&#xA;    EFFECTIVE_DATE,PAYMENT_DATE,EXTRACT_DATE,JOURNAL_DESCRIPTION,&#xD;&#xA;    EXTRACT_FILE_NAME,CREATED_BY ,CREATED_DATE,&#xD;&#xA;    MODIFIED_BY ,MODIFIED_DATE, UPDATE_SEQ&#xD;&#xA;FROM  #TEMP_GL&#xD;&#xA;WHERE  GENERATE_GL_FLAG = 1&#xD;&#xA;UNION ALL &#xD;&#xA;SELECT  PLAN_ID,1300, FUND_VALUE,1301,DEPT_VALUE,1304,SOURCE_TYPE_VALUE,&#xD;&#xA;    1302,ITEM_TYPE_VALUE,1303,TRANSACTION_TYPE_VALUE,ACCOUNT_REFERENCE_ID,&#xD;&#xA;    CREDIT_ACCOUNT_ID AS ACCOUNT_ID,&#xD;&#xA;&#x9;CASE WHEN ISNULL(#TEMP_GL.ROLLOVER_ORG_ID_FROM_DETAIL, 0) &gt; 0 THEN #TEMP_GL.ROLLOVER_ORG_ID_FROM_DETAIL ELSE ORG_ID END AS ORG_ID,&#xD;&#xA;&#x9;CASE WHEN ISNULL(#TEMP_GL.ROLLOVER_ORG_ID_FROM_DETAIL, 0) &gt; 0 THEN NULL ELSE PERSON_ID END AS PERSON_ID,&#xD;&#xA;    PAYMENT_HISTORY_DETAIL_ID,0 AS DEBIT_AMOUNT,AMOUNT AS CREDIT_AMOUNT,&#xD;&#xA;    EFFECTIVE_DATE,PAYMENT_DATE,EXTRACT_DATE,JOURNAL_DESCRIPTION,&#xD;&#xA;    EXTRACT_FILE_NAME,CREATED_BY ,CREATED_DATE,&#xD;&#xA;    MODIFIED_BY ,MODIFIED_DATE, UPDATE_SEQ&#xD;&#xA;FROM  #TEMP_GL&#xD;&#xA;WHERE  GENERATE_GL_FLAG = 1&#xD;&#xA;&#xD;&#xA;DROP TABLE #TEMP_GL">
      <parameters>
        <parameter ID="@SOURCETYPE" sfwDataType="string" />
        <parameter ID="@PAYMENTSCHEDULEID" sfwDataType="int" />
        <parameter ID="@batchscheduleid" sfwDataType="int" />
      </parameters>
    </query>
    <query ID="rptGLPeopleSoft" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT CV1.[DESCRIPTION] AS FUND_ID,&#xD;&#xA;  CV2.[DESCRIPTION] AS DEPT_ID,&#xD;&#xA;  CH.GL_ACCOUNT_NUMBER AS ACCOUNT_NUM,&#xD;&#xA;  CH.ACCOUNT_NAME AS ACCOUNT_NAME,&#xD;&#xA;  SUM(ISNULL(GL.DEBIT_AMOUNT,0)) AS DEBIT_AMT,&#xD;&#xA;  SUM(ISNULL(GL.CREDIT_AMOUNT,0)) AS CREDIT_AMT&#xD;&#xA;FROM SGT_GL_TRANSACTION GL WITH(NOLOCK)&#xD;&#xA;INNER JOIN SGT_CHART_OF_ACCOUNT CH WITH(NOLOCK) ON GL.ACCOUNT_ID = CH.CHART_OF_ACCOUNT_ID&#xD;&#xA;INNER JOIN SGS_CODE_VALUE CV1 WITH(NOLOCK) ON GL.FUND_ID = CV1.CODE_ID AND GL.FUND_VALUE = CV1.CODE_VALUE&#xD;&#xA;INNER JOIN SGS_CODE_VALUE CV2 WITH(NOLOCK) ON GL.DEPT_ID = CV2.CODE_ID AND GL.DEPT_VALUE = CV2.CODE_VALUE&#xD;&#xA;WHERE EXTRACT_DATE IS NULL AND SOURCE_TYPE_VALUE &lt;&gt; 'REMI'&#xD;&#xA; AND POSTING_DATE &lt;= @POSTINGDATE&#xD;&#xA; AND CH.GL_ACCOUNT_NUMBER IN ('131212', '132472', '132473', '132475', '132480', '132481', '132482', '132483', '212472', '212473', &#xD;&#xA;         '212475', '212480', '212481', '212482', '212483', '211212','211470','131470')&#xD;&#xA;GROUP BY CV1.[DESCRIPTION],&#xD;&#xA;   CV2.[DESCRIPTION],&#xD;&#xA;   CH.GL_ACCOUNT_NUMBER,&#xD;&#xA;   CH.ACCOUNT_NAME   &#xD;&#xA;&#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT CV1.[DESCRIPTION] AS FUND_ID,&#xD;&#xA;  CV2.[DESCRIPTION] AS DEPT_ID,&#xD;&#xA;  CH.GL_ACCOUNT_NUMBER AS ACCOUNT_NUM,&#xD;&#xA;  CH.ACCOUNT_NAME AS ACCOUNT_NAM,&#xD;&#xA;  SUM(ISNULL(A.DEBIT_AMOUNT,0)) AS DEBIT_AMT,&#xD;&#xA;  SUM(ISNULL(A.CREDIT_AMOUNT,0)) AS CREDIT_AMT&#xD;&#xA;FROM SGT_GL_TRANSACTION A WITH(NOLOCK) &#xD;&#xA;INNER JOIN SGT_REMITTANCE B WITH(NOLOCK) ON A.SOURCE_ID = B.REMITTANCE_ID&#xD;&#xA;INNER JOIN SGT_DEPOSIT C WITH(NOLOCK) ON C.DEPOSIT_ID = B.DEPOSIT_ID&#xD;&#xA;INNER JOIN SGT_DEPOSIT_TAPE D WITH(NOLOCK) ON D.DEPOSIT_TAPE_ID = C.DEPOSIT_TAPE_ID &#xD;&#xA;INNER JOIN SGT_CHART_OF_ACCOUNT CH WITH(NOLOCK) ON A.ACCOUNT_ID = CH.CHART_OF_ACCOUNT_ID&#xD;&#xA;INNER JOIN SGS_CODE_VALUE CV1 WITH(NOLOCK) ON A.FUND_ID = CV1.CODE_ID AND A.FUND_VALUE = CV1.CODE_VALUE&#xD;&#xA;INNER JOIN SGS_CODE_VALUE CV2 WITH(NOLOCK) ON A.DEPT_ID = CV2.CODE_ID AND A.DEPT_VALUE = CV2.CODE_VALUE&#xD;&#xA;WHERE EXTRACT_DATE IS NULL AND SOURCE_TYPE_VALUE = 'REMI'&#xD;&#xA; AND POSTING_DATE &lt;= @POSTINGDATE&#xD;&#xA; AND CH.GL_ACCOUNT_NUMBER IN ('131212', '132472', '132473', '132475', '132480', '132481', '132482', '132483', '212472', '212473', &#xD;&#xA;         '212475', '212480', '212481', '212482', '212483', '211212','211470','131470')&#xD;&#xA;GROUP BY CV1.[DESCRIPTION],&#xD;&#xA;   CV2.[DESCRIPTION],&#xD;&#xA;   CH.GL_ACCOUNT_NUMBER,&#xD;&#xA;   CH.ACCOUNT_NAME&#xD;&#xA;">
      <parameters>
        <parameter ID="@POSTINGDATE" sfwDataType="DateTime" />
      </parameters>
    </query>
    <query ID="UpdateGLTransactionExtractDate" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="UPDATE SGT_GL_TRANSACTION&#xD;&#xA;SET EXTRACT_DATE = CAST(CONVERT(VARCHAR(10),GETDATE(),120) AS DATETIME),&#xD;&#xA; EXTRACT_FILE_NAME = @FILENAME,&#xD;&#xA; MODIFIED_BY = 'PERSLink Batch',&#xD;&#xA; MODIFIED_DATE = GETDATE(),&#xD;&#xA; UPDATE_SEQ = UPDATE_SEQ + 1 &#xD;&#xA;WHERE EXTRACT_DATE IS NULL&#xD;&#xA;AND POSTING_DATE &lt;= @POSTINGDATE">
      <parameters>
        <parameter ID="@FILENAME" sfwDataType="string" />
        <parameter ID="@POSTINGDATE" sfwDataType="DateTime" />
      </parameters>
    </query>
    <query ID="LoadItemType" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="select distinct DESCRIPTION as item_type_description from sgs_code_value where code_id=1302">
      <parameters />
    </query>
    <query ID="CreateGLEscheatToState" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT PHH.PLAN_ID,&#xD;&#xA;  AC.FUND_VALUE,&#xD;&#xA;  AC.DEPT_VALUE,&#xD;&#xA;  AC.SOURCE_TYPE_VALUE,&#xD;&#xA;  AC.ITEM_TYPE_VALUE,&#xD;&#xA;  AC.TRANSACTION_TYPE_VALUE,&#xD;&#xA;  AC.ACCOUNT_REFERENCE_ID,&#xD;&#xA;  AC.DEBIT_ACCOUNT_ID AS DEBIT_ACCOUNT_ID,&#xD;&#xA;  AC.CREDIT_ACCOUNT_ID AS CREDIT_ACCOUNT_ID,&#xD;&#xA;  PHH.ORG_ID,OLDHEADER.PERSON_ID AS OLD_PERSON_ID,OLDHEADER.ORG_ID AS OLD_ORG_ID,&#xD;&#xA;  PHD.PAYMENT_HISTORY_DETAIL_ID,&#xD;&#xA;  PHD.AMOUNT AS AMOUNT,&#xD;&#xA;  PHH.PAYMENT_DATE AS EFFECTIVE_DATE,&#xD;&#xA;  PHH.PAYMENT_DATE,&#xD;&#xA;  NULL AS EXTRACT_DATE,&#xD;&#xA;  AC.JOURNAL_DESCRIPTION,&#xD;&#xA;  NULL AS EXTRACT_FILE_NAME,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  CREATED_BY,&#xD;&#xA;  GETDATE() AS CREATED_DATE,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  MODIFIED_BY,&#xD;&#xA;  GETDATE() AS MODIFIED_DATE,&#xD;&#xA;  0 AS UPDATE_SEQ,&#xD;&#xA;  isnull(AC.GENERATE_GL_FLAG,0) AS GENERATE_GL_FLAG&#xD;&#xA;INTO #TEMP_GL&#xD;&#xA;FROM SGT_PAYMENT_HISTORY_HEADER  PHH&#xD;&#xA; INNER JOIN SGT_PAYMENT_HISTORY_DETAIL PHD&#xD;&#xA;  ON PHD.PAYMENT_HISTORY_HEADER_ID = PHH.PAYMENT_HISTORY_HEADER_ID&#xD;&#xA; INNER JOIN SGT_PAYMENT_ITEM_TYPE PIT &#xD;&#xA;  ON PHD.PAYMENT_ITEM_TYPE_ID = PIT.PAYMENT_ITEM_TYPE_ID&#xD;&#xA;INNER JOIN SGT_PAYMENT_HISTORY_HEADER OLDHEADER ON PHH.OLD_PAYMENT_HISTORY_HEADER_ID = OLDHEADER.PAYMENT_HISTORY_HEADER_ID&#xD;&#xA;INNER JOIN SGT_ACCOUNT_REFERENCE AC&#xD;&#xA;  ON PHH.PLAN_ID = AC.PLAN_ID&#xD;&#xA;    AND PIT.ITEM_TYPE_CODE_VALUE = AC.ITEM_TYPE_VALUE&#xD;&#xA;    AND AC.SOURCE_TYPE_VALUE = @SOURCETYPE&#xD;&#xA;    AND AC.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;    AND AC.STATUS_TRANSITION_VALUE is null&#xD;&#xA;WHERE PHH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;AND ISNULL(AC.ITEM_TYPE_VALUE, '') = 'P457'&#xD;&#xA;&#xD;&#xA;INSERT INTO SGT_GL_TRANSACTION&#xD;&#xA;    (PLAN_ID, FUND_ID, FUND_VALUE, DEPT_ID, DEPT_VALUE, SOURCE_TYPE_ID, &#xD;&#xA;    SOURCE_TYPE_VALUE, ITEM_TYPE_ID, ITEM_TYPE_VALUE, TRANSACTION_TYPE_ID, &#xD;&#xA;    TRANSACTION_TYPE_VALUE, ACCOUNT_REFERENCE_ID, ACCOUNT_ID, ORG_ID, &#xD;&#xA;    PERSON_ID, SOURCE_ID, DEBIT_AMOUNT, CREDIT_AMOUNT, EFFECTIVE_DATE, POSTING_DATE, &#xD;&#xA;    EXTRACT_DATE, JOURNAL_DESCRIPTION, EXTRACT_FILE_NAME, &#xD;&#xA;    CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE, UPDATE_SEQ)&#xD;&#xA;SELECT PLAN_ID,1300, FUND_VALUE,1301,DEPT_VALUE,1304,SOURCE_TYPE_VALUE,&#xD;&#xA;    1302,ITEM_TYPE_VALUE,1303,TRANSACTION_TYPE_VALUE,ACCOUNT_REFERENCE_ID,&#xD;&#xA;    DEBIT_ACCOUNT_ID AS ACCOUNT_ID,OLD_ORG_ID as ORG_ID,OLD_PERSON_ID as PERSON_ID,&#xD;&#xA;    PAYMENT_HISTORY_DETAIL_ID,AMOUNT AS DEBIT_AMOUNT,0 AS CREDIT_AMOUNT,&#xD;&#xA;    EFFECTIVE_DATE,PAYMENT_DATE,EXTRACT_DATE,JOURNAL_DESCRIPTION,&#xD;&#xA;    EXTRACT_FILE_NAME,CREATED_BY ,CREATED_DATE,&#xD;&#xA;    MODIFIED_BY ,MODIFIED_DATE, UPDATE_SEQ&#xD;&#xA;FROM  #TEMP_GL&#xD;&#xA;WHERE  GENERATE_GL_FLAG = 1&#xD;&#xA;UNION ALL &#xD;&#xA;SELECT  PLAN_ID,1300, FUND_VALUE,1301,DEPT_VALUE,1304,SOURCE_TYPE_VALUE,&#xD;&#xA;    1302,ITEM_TYPE_VALUE,1303,TRANSACTION_TYPE_VALUE,ACCOUNT_REFERENCE_ID,&#xD;&#xA;    CREDIT_ACCOUNT_ID AS ACCOUNT_ID,ORG_ID,NULL,&#xD;&#xA;    PAYMENT_HISTORY_DETAIL_ID,0 AS DEBIT_AMOUNT,AMOUNT AS CREDIT_AMOUNT,&#xD;&#xA;    EFFECTIVE_DATE,PAYMENT_DATE,EXTRACT_DATE,JOURNAL_DESCRIPTION,&#xD;&#xA;    EXTRACT_FILE_NAME,CREATED_BY ,CREATED_DATE,&#xD;&#xA;    MODIFIED_BY ,MODIFIED_DATE, UPDATE_SEQ&#xD;&#xA;FROM  #TEMP_GL&#xD;&#xA;WHERE  GENERATE_GL_FLAG = 1&#xD;&#xA;&#xD;&#xA;DROP TABLE #TEMP_GL">
      <parameters>
        <parameter ID="@SOURCETYPE" sfwDataType="string" />
        <parameter ID="@PAYMENTSCHEDULEID" sfwDataType="int" />
        <parameter ID="@batchscheduleid" sfwDataType="int" />
      </parameters>
    </query>
    <query ID="CreateGLFromPayrollAdhoc" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT PHH.PLAN_ID,&#xD;&#xA;  AC.FUND_VALUE,&#xD;&#xA;  AC.DEPT_VALUE,&#xD;&#xA;  AC.SOURCE_TYPE_VALUE,&#xD;&#xA;  AC.ITEM_TYPE_VALUE,&#xD;&#xA;  AC.TRANSACTION_TYPE_VALUE,&#xD;&#xA;  AC.ACCOUNT_REFERENCE_ID,&#xD;&#xA;  AC.DEBIT_ACCOUNT_ID AS DEBIT_ACCOUNT_ID,&#xD;&#xA;  AC.CREDIT_ACCOUNT_ID AS CREDIT_ACCOUNT_ID,&#xD;&#xA;  PHH.ORG_ID,PHH.PERSON_ID,&#xD;&#xA;  PHD.PAYMENT_HISTORY_DETAIL_ID,&#xD;&#xA;  PHD.AMOUNT AS AMOUNT,&#xD;&#xA;  PHH.PAYMENT_DATE AS EFFECTIVE_DATE,&#xD;&#xA;  PHH.PAYMENT_DATE,&#xD;&#xA;  NULL AS EXTRACT_DATE,&#xD;&#xA;  AC.JOURNAL_DESCRIPTION,&#xD;&#xA;  NULL AS EXTRACT_FILE_NAME,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  CREATED_BY ,&#xD;&#xA;  GETDATE() AS CREATED_DATE,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  MODIFIED_BY ,&#xD;&#xA;  GETDATE() AS MODIFIED_DATE,&#xD;&#xA;  0 AS UPDATE_SEQ,&#xD;&#xA;  isnull(AC.GENERATE_GL_FLAG,0) AS GENERATE_GL_FLAG&#xD;&#xA;  ,CASE WHEN AC.ITEM_TYPE_VALUE IN ('P014','P015','P016','P023','P031','P032','P069','P070','P217','P220','P223','P225') AND AC.SOURCE_TYPE_VALUE = 'BEPY' AND AC.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;  AND AC.CREDIT_ACCOUNT_ID = 239 THEN PHD.ROLLOVER_ORG_ID ELSE NULL END AS ROLLOVER_ORG_ID_FROM_DETAIL&#xD;&#xA;INTO #TEMP_GL&#xD;&#xA;FROM SGT_PAYMENT_HISTORY_HEADER  PHH&#xD;&#xA; INNER JOIN SGT_PAYMENT_HISTORY_DETAIL PHD&#xD;&#xA;  ON PHD.PAYMENT_HISTORY_HEADER_ID = PHH.PAYMENT_HISTORY_HEADER_ID&#xD;&#xA; INNER JOIN SGT_PAYMENT_ITEM_TYPE PIT &#xD;&#xA;  ON PHD.PAYMENT_ITEM_TYPE_ID = PIT.PAYMENT_ITEM_TYPE_ID&#xD;&#xA;INNER JOIN SGT_ACCOUNT_REFERENCE AC&#xD;&#xA;  ON PHH.PLAN_ID = AC.PLAN_ID&#xD;&#xA;    AND PIT.ITEM_TYPE_CODE_VALUE = AC.ITEM_TYPE_VALUE&#xD;&#xA;    AND AC.SOURCE_TYPE_VALUE = @SOURCETYPE&#xD;&#xA;    AND AC.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;    AND AC.STATUS_TRANSITION_VALUE is null&#xD;&#xA;WHERE PHH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;AND (1 = CASE WHEN (PHH.PLAN_ID = 9 AND @SOURCETYPE = 'VPMT') THEN 2 ELSE 1 END) --PIR 14848&#xD;&#xA;AND ISNULL(AC.ITEM_TYPE_VALUE, '') &lt;&gt; 'P457'&#xD;&#xA;AND (PHH.ORG_ID IS NULL or (PHH.ORG_ID IS NOT NULL AND AC.ITEM_TYPE_VALUE NOT IN ('P215','P216','P218','P219','P221','P222')))&#xD;&#xA;--Fund transfer GL Creation&#xD;&#xA;&#xD;&#xA;Union All&#xD;&#xA;&#xD;&#xA;SELECT OPH.PLAN_ID,&#xD;&#xA;  AC.FUND_VALUE,&#xD;&#xA;  AC.DEPT_VALUE,&#xD;&#xA;  AC.SOURCE_TYPE_VALUE,&#xD;&#xA;  AC.ITEM_TYPE_VALUE,&#xD;&#xA;  AC.TRANSACTION_TYPE_VALUE,&#xD;&#xA;  AC.ACCOUNT_REFERENCE_ID,&#xD;&#xA;  AC.DEBIT_ACCOUNT_ID AS DEBIT_ACCOUNT_ID,&#xD;&#xA;  AC.CREDIT_ACCOUNT_ID AS CREDIT_ACCOUNT_ID,&#xD;&#xA;  OPH.ORG_ID,NULL AS PERSON_ID,&#xD;&#xA;&#x9;  OPD.PAYMENT_HISTORY_DETAIL_ID,&#xD;&#xA;&#x9;  MPD.AMOUNT AS AMOUNT,&#xD;&#xA;&#x9;  OPH.PAYMENT_DATE AS EFFECTIVE_DATE,&#xD;&#xA;&#x9;  OPH.PAYMENT_DATE,&#xD;&#xA;  NULL AS EXTRACT_DATE,&#xD;&#xA;  AC.JOURNAL_DESCRIPTION,&#xD;&#xA;  NULL AS EXTRACT_FILE_NAME,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  CREATED_BY ,&#xD;&#xA;  GETDATE() AS CREATED_DATE,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  MODIFIED_BY ,&#xD;&#xA;  GETDATE() AS MODIFIED_DATE,&#xD;&#xA;  0 AS UPDATE_SEQ,&#xD;&#xA;  isnull(AC.GENERATE_GL_FLAG,0) AS GENERATE_GL_FLAG&#xD;&#xA;  ,NULL AS ROLLOVER_ORG_ID_FROM_DETAIL&#xD;&#xA;FROM SGT_PAYMENT_HISTORY_DETAIL OPD&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_ITEM_TYPE PITO ON PITO.PAYMENT_ITEM_TYPE_ID = OPD.PAYMENT_ITEM_TYPE_ID AND PITO.ITEM_TYPE_CODE_VALUE IN ('P221', 'P222')&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER OPH ON OPH.PAYMENT_HISTORY_HEADER_ID = OPD.PAYMENT_HISTORY_HEADER_ID AND OPH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL MPD ON MPD.ROLLOVER_ORG_ID = OPH.ORG_ID&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER MPH ON MPD.PAYMENT_HISTORY_HEADER_ID = MPH.PAYMENT_HISTORY_HEADER_ID AND MPH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID AND OPH.PAYEE_ACCOUNT_ID = MPH.PAYEE_ACCOUNT_ID&#xD;&#xA;&#x9;JOIN SGT_PAYMENT_ITEM_TYPE PITM ON MPD.PAYMENT_ITEM_TYPE_ID = PITM.PAYMENT_ITEM_TYPE_ID AND PITO.ITEM_TYPE_CODE = PITM.ROLLOVER_ITEM_CODE AND PITM.ALLOW_ROLLOVER_CODE_VALUE = 'RRED'&#xD;&#xA;&#x9;JOIN SGT_ACCOUNT_REFERENCE AC on ac.ITEM_TYPE_VALUE = PITO.ITEM_TYPE_CODE_VALUE AND OPH.PLAN_ID = AC.PLAN_ID&#xD;&#xA;    AND PITO.ITEM_TYPE_CODE_VALUE = AC.ITEM_TYPE_VALUE&#xD;&#xA;    AND AC.SOURCE_TYPE_VALUE = @SOURCETYPE&#xD;&#xA;    AND AC.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;    AND AC.STATUS_TRANSITION_VALUE is null&#xD;&#xA;WHERE OPH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;&#xD;&#xA;Union All&#xD;&#xA;&#xD;&#xA;SELECT PHH.PLAN_ID,&#xD;&#xA;  AC.FUND_VALUE,&#xD;&#xA;  AC.DEPT_VALUE,&#xD;&#xA;  AC.SOURCE_TYPE_VALUE,&#xD;&#xA;  AC.ITEM_TYPE_VALUE,&#xD;&#xA;  AC.TRANSACTION_TYPE_VALUE,&#xD;&#xA;  AC.ACCOUNT_REFERENCE_ID,&#xD;&#xA;  AC.DEBIT_ACCOUNT_ID AS DEBIT_ACCOUNT_ID,&#xD;&#xA;  AC.CREDIT_ACCOUNT_ID AS CREDIT_ACCOUNT_ID,&#xD;&#xA;  PHH.ORG_ID,PHH.PERSON_ID,&#xD;&#xA;  PHD.PAYMENT_HISTORY_DETAIL_ID,&#xD;&#xA;  PHD.AMOUNT AS AMOUNT,&#xD;&#xA;  PHH.PAYMENT_DATE AS EFFECTIVE_DATE,&#xD;&#xA;  PHH.PAYMENT_DATE,&#xD;&#xA;  NULL AS EXTRACT_DATE,&#xD;&#xA;  AC.JOURNAL_DESCRIPTION,&#xD;&#xA;  NULL AS EXTRACT_FILE_NAME,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  CREATED_BY ,&#xD;&#xA;  GETDATE() AS CREATED_DATE,&#xD;&#xA;  'PERSLink Batch'+' '+ convert(nvarchar,@batchscheduleid) AS  MODIFIED_BY ,&#xD;&#xA;  GETDATE() AS MODIFIED_DATE,&#xD;&#xA;  0 AS UPDATE_SEQ,&#xD;&#xA;  isnull(AC.GENERATE_GL_FLAG,0) AS GENERATE_GL_FLAG&#xD;&#xA;  ,NULL AS ROLLOVER_ORG_ID_FROM_DETAIL&#xD;&#xA;FROM SGT_PAYMENT_HISTORY_HEADER  PHH&#xD;&#xA; INNER JOIN SGT_PAYMENT_HISTORY_DETAIL PHD&#xD;&#xA;  ON PHD.PAYMENT_HISTORY_HEADER_ID = PHH.PAYMENT_HISTORY_HEADER_ID&#xD;&#xA; INNER JOIN SGT_PAYMENT_ITEM_TYPE PIT &#xD;&#xA;  ON PHD.PAYMENT_ITEM_TYPE_ID = PIT.PAYMENT_ITEM_TYPE_ID&#xD;&#xA;INNER JOIN SGT_ACCOUNT_REFERENCE AC&#xD;&#xA;  ON PHH.PLAN_ID = AC.PLAN_ID&#xD;&#xA;    AND PIT.ITEM_TYPE_CODE_VALUE = AC.ITEM_TYPE_VALUE&#xD;&#xA;    AND AC.SOURCE_TYPE_VALUE =  @SOURCETYPE&#xD;&#xA;    AND AC.TRANSACTION_TYPE_VALUE = 'TRAN'&#xD;&#xA;    AND AC.STATUS_TRANSITION_VALUE is null&#xD;&#xA;WHERE PHH.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;AND (1 = CASE WHEN (PHH.PLAN_ID = 9 AND @SOURCETYPE = 'VPMT') THEN 2 ELSE 1 END) --PIR 14848&#xD;&#xA;AND ISNULL(AC.ITEM_TYPE_VALUE, '') &lt;&gt; 'P457'&#xD;&#xA;&#xD;&#xA;INSERT INTO SGT_GL_TRANSACTION&#xD;&#xA;    (PLAN_ID, FUND_ID, FUND_VALUE, DEPT_ID, DEPT_VALUE, SOURCE_TYPE_ID, &#xD;&#xA;    SOURCE_TYPE_VALUE, ITEM_TYPE_ID, ITEM_TYPE_VALUE, TRANSACTION_TYPE_ID, &#xD;&#xA;    TRANSACTION_TYPE_VALUE, ACCOUNT_REFERENCE_ID, ACCOUNT_ID, ORG_ID, &#xD;&#xA;    PERSON_ID, SOURCE_ID, DEBIT_AMOUNT, CREDIT_AMOUNT, EFFECTIVE_DATE, POSTING_DATE, &#xD;&#xA;    EXTRACT_DATE, JOURNAL_DESCRIPTION, EXTRACT_FILE_NAME, &#xD;&#xA;    CREATED_BY, CREATED_DATE, MODIFIED_BY, MODIFIED_DATE, UPDATE_SEQ)&#xD;&#xA;SELECT PLAN_ID&#xD;&#xA;&#x9;&#x9;,1300&#xD;&#xA;&#x9;&#x9;,FUND_VALUE&#xD;&#xA;&#x9;&#x9;,1301&#xD;&#xA;&#x9;&#x9;,DEPT_VALUE&#xD;&#xA;&#x9;&#x9;,1304&#xD;&#xA;&#x9; &#x9;,SOURCE_TYPE_VALUE&#xD;&#xA;&#x9;&#x9;,1302&#xD;&#xA;&#x9;&#x9;,ITEM_TYPE_VALUE&#xD;&#xA;&#x9;&#x9;,1303&#xD;&#xA;&#x9;&#x9;,TRANSACTION_TYPE_VALUE&#xD;&#xA;&#x9;&#x9;,ACCOUNT_REFERENCE_ID&#xD;&#xA;&#x9;&#x9;,DEBIT_ACCOUNT_ID AS ACCOUNT_ID,&#xD;&#xA;&#x9;&#x9;CASE &#xD;&#xA;&#x9;&#x9;&#x9;WHEN #TEMP_GL.ITEM_TYPE_VALUE = 'P001' &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.ORG_ID = 2428 &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.SOURCE_TYPE_VALUE = 'BEPY'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND (&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT TOP 1 R.PERSON_ID FROM SGT_REMITTANCE R&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER H ON R.PAYMENT_HISTORY_HEADER_ID = &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;H.PAYMENT_HISTORY_HEADER_ID AND H.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID AND &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;R.REMITTANCE_TYPE_VALUE = 'IBSD'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL D ON D.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND D.PAYMENT_HISTORY_DETAIL_ID = #TEMP_GL.PAYMENT_HISTORY_DETAIL_ID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;) &gt; 0 &#xD;&#xA;&#x9;&#x9;&#x9;THEN NULL ELSE &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;CASE WHEN #TEMP_GL.ITEM_TYPE_VALUE = 'P460' &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.ORG_ID &gt; 0 &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.SOURCE_TYPE_VALUE = 'BEPY'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND (&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT TOP 1 R.PERSON_ID FROM SGT_REMITTANCE R&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER H ON R.PAYMENT_HISTORY_HEADER_ID = &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;H.PAYMENT_HISTORY_HEADER_ID AND H.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL D ON D.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND D.PAYMENT_HISTORY_DETAIL_ID = #TEMP_GL.PAYMENT_HISTORY_DETAIL_ID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;) &gt; 0 &#xD;&#xA;&#x9;&#x9;&#x9;THEN NULL ELSE #TEMP_GL.ORG_ID END END AS ORG_ID,&#xD;&#xA;&#x9;&#x9;CASE &#xD;&#xA;&#x9;&#x9;&#x9;WHEN #TEMP_GL.ITEM_TYPE_VALUE = 'P001' &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.ORG_ID = 2428 &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.SOURCE_TYPE_VALUE = 'BEPY'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;AND (&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT TOP 1 R.PERSON_ID FROM SGT_REMITTANCE R&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER H ON R.PAYMENT_HISTORY_HEADER_ID = &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;H.PAYMENT_HISTORY_HEADER_ID AND H.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID AND &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;R.REMITTANCE_TYPE_VALUE = 'IBSD'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL D ON D.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND D.PAYMENT_HISTORY_DETAIL_ID = #TEMP_GL.PAYMENT_HISTORY_DETAIL_ID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;) &gt; 0 &#xD;&#xA;&#x9;&#x9;&#x9;THEN (&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT TOP 1 R.PERSON_ID FROM SGT_REMITTANCE R&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER H ON R.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND H.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID AND R.REMITTANCE_TYPE_VALUE = 'IBSD'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL D ON D.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND D.PAYMENT_HISTORY_DETAIL_ID = #TEMP_GL.PAYMENT_HISTORY_DETAIL_ID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;) ELSE &#xD;&#xA;&#x9;&#x9;CASE &#xD;&#xA;&#x9;&#x9;&#x9;WHEN #TEMP_GL.ITEM_TYPE_VALUE = 'P460' &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.ORG_ID &gt; 0 &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;AND #TEMP_GL.SOURCE_TYPE_VALUE = 'BEPY'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;AND (&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT TOP 1 R.PERSON_ID FROM SGT_REMITTANCE R&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER H ON R.PAYMENT_HISTORY_HEADER_ID = &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;H.PAYMENT_HISTORY_HEADER_ID AND H.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL D ON D.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AND D.PAYMENT_HISTORY_DETAIL_ID = #TEMP_GL.PAYMENT_HISTORY_DETAIL_ID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;) &gt; 0&#xD;&#xA;&#x9;&#x9;&#x9;THEN (&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT TOP 1 R.PERSON_ID FROM SGT_REMITTANCE R&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER H ON R.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND H.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL D ON D.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND D.PAYMENT_HISTORY_DETAIL_ID = #TEMP_GL.PAYMENT_HISTORY_DETAIL_ID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;) ELSE &#xD;&#xA;&#x9;&#x9;CASE &#xD;&#xA;&#x9;&#x9;&#x9;WHEN  &#xD;&#xA;&#x9;&#x9;&#x9;&#x9; #TEMP_GL.ITEM_TYPE_VALUE IN ('P001','P459','P460','P461','P462')&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; AND #TEMP_GL.TRANSACTION_TYPE_VALUE = 'ITLV'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; AND #TEMP_GL.SOURCE_TYPE_VALUE = 'BEPY'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; AND (&#xD;&#xA;    &#x9;&#x9;&#x9;&#x9;&#x9;SELECT TOP 1 CASE WHEN (R.REFUND_TO_VALUE='DFME' AND DEBIT_ACCOUNT_ID IN (2,44)) THEN  R.REFUND_TO_PERSON_ID ELSE R.PERSON_ID END  AS PERSON_ID&#xD;&#xA;    &#x9;&#x9;&#x9;&#x9;&#x9;FROM SGT_REMITTANCE R&#xD;&#xA;    &#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER H ON R.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;    &#x9;&#x9;&#x9;&#x9;&#x9;AND H.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;    &#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL D ON D.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;    &#x9;&#x9;&#x9;&#x9;&#x9;AND D.PAYMENT_HISTORY_DETAIL_ID = #TEMP_GL.PAYMENT_HISTORY_DETAIL_ID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;     ) &gt; 0&#xD;&#xA;&#x9;&#x9;&#x9;THEN(&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT TOP 1 CASE WHEN (R.REFUND_TO_VALUE='DFME' AND DEBIT_ACCOUNT_ID IN (2,44)) THEN  R.REFUND_TO_PERSON_ID ELSE R.PERSON_ID END  AS PERSON_ID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;FROM SGT_REMITTANCE R&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_HEADER H ON R.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND H.PAYMENT_SCHEDULE_ID = @PAYMENTSCHEDULEID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN SGT_PAYMENT_HISTORY_DETAIL D ON D.PAYMENT_HISTORY_HEADER_ID = H.PAYMENT_HISTORY_HEADER_ID &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;AND D.PAYMENT_HISTORY_DETAIL_ID = #TEMP_GL.PAYMENT_HISTORY_DETAIL_ID&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;)ELSE&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;#TEMP_GL.PERSON_ID END END END AS PERSON_ID,&#xD;&#xA;    PAYMENT_HISTORY_DETAIL_ID,AMOUNT AS DEBIT_AMOUNT,0 AS CREDIT_AMOUNT,&#xD;&#xA;    EFFECTIVE_DATE,PAYMENT_DATE,EXTRACT_DATE,JOURNAL_DESCRIPTION,&#xD;&#xA;    EXTRACT_FILE_NAME,CREATED_BY ,CREATED_DATE,&#xD;&#xA;    MODIFIED_BY ,MODIFIED_DATE, UPDATE_SEQ&#xD;&#xA;FROM  #TEMP_GL&#xD;&#xA;WHERE  GENERATE_GL_FLAG = 1&#xD;&#xA;UNION ALL &#xD;&#xA;SELECT  PLAN_ID,1300, FUND_VALUE,1301,DEPT_VALUE,1304,SOURCE_TYPE_VALUE,&#xD;&#xA;    1302,ITEM_TYPE_VALUE,1303,TRANSACTION_TYPE_VALUE,ACCOUNT_REFERENCE_ID,&#xD;&#xA;    CREDIT_ACCOUNT_ID AS ACCOUNT_ID,&#xD;&#xA;&#x9;CASE WHEN ISNULL(#TEMP_GL.ROLLOVER_ORG_ID_FROM_DETAIL, 0) &gt; 0 THEN #TEMP_GL.ROLLOVER_ORG_ID_FROM_DETAIL ELSE ORG_ID END AS ORG_ID,&#xD;&#xA;&#x9;CASE WHEN ISNULL(#TEMP_GL.ROLLOVER_ORG_ID_FROM_DETAIL, 0) &gt; 0 THEN NULL ELSE PERSON_ID END AS PERSON_ID,&#xD;&#xA;    PAYMENT_HISTORY_DETAIL_ID,0 AS DEBIT_AMOUNT,AMOUNT AS CREDIT_AMOUNT,&#xD;&#xA;    EFFECTIVE_DATE,PAYMENT_DATE,EXTRACT_DATE,JOURNAL_DESCRIPTION,&#xD;&#xA;    EXTRACT_FILE_NAME,CREATED_BY ,CREATED_DATE,&#xD;&#xA;    MODIFIED_BY ,MODIFIED_DATE, UPDATE_SEQ&#xD;&#xA;FROM  #TEMP_GL&#xD;&#xA;WHERE  GENERATE_GL_FLAG = 1&#xD;&#xA;&#xD;&#xA;DROP TABLE #TEMP_GL">
      <parameters>
        <parameter ID="@SOURCETYPE" sfwDataType="string" />
        <parameter ID="@PAYMENTSCHEDULEID" sfwDataType="int" />
        <parameter ID="@batchscheduleid" sfwDataType="int" />
      </parameters>
    </query>
    <query ID="GetGLDetailsForMonthlyAudit" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT&#xA;&#x9; cast(Year(EXTRACT_DATE) AS varchar(4)) + Right('00'+cast(month(EXTRACT_DATE) AS varchar(4)),&#xA;&#x9;2)+'01' AS Dt ,&#xA;&#x9;DateName(m,&#xA;&#x9;EXTRACT_DATE)+DATENAME(yy,&#xA;&#x9;EXTRACT_DATE) AS EXTRACT_DATE ,&#xA;&#x9;FUND_VALUE ,&#xA;&#x9;GL_ACCOUNT_NUMBER ,&#xA;&#x9;ACCOUNT_NAME ,&#xA;&#x9;ISNULL(ORG_CODE,&#xA;&#x9;' ') AS ORG_CODE ,&#xA;&#x9;ISNULL(PERSON_ID,&#xA;&#x9;0) AS PERSON_ID ,&#xA;&#x9;SUM(ISNULL(debit_amount,0)-Isnull(credit_amount,0)) AS Amount&#xA;FROM&#xA;&#x9; SGT_GL_TRANSACTION Gl WITH(NOLOCK)   &#xA;&#x9; LEFT OUTER JOIN    sgt_organization O WITH(NOLOCK)&#xA;&#x9; ON GL.ORG_ID = O.ORG_ID   &#xA;&#x9; LEFT OUTER JOIN    SGT_CHART_OF_ACCOUNT CA WITH(NOLOCK)&#xA;&#x9; ON Gl.ACCOUNT_ID = CA.CHART_OF_ACCOUNT_ID &#xA;WHERE&#xA;&#x9; Gl.EXTRACT_DATE Between cast(@EXTRACT_DATE_From AS varchar(12)) AND&#xA;&#x9; cast(@EXTRACT_DATE_To  AS varchar(12)) AND&#xA;&#x9; Fund_value = Case When ISNULL(@Fund_ID, '') = '' then FUND_VALUE else @Fund_ID End AND&#xA;&#x9; GL_ACCOUNT_NUMBER = case when @Account_Code is Null then GL_ACCOUNT_NUMBER else @Account_Code End &#xA;GROUP BY    cast(Year(EXTRACT_DATE) AS varchar(4)) + Right('00'+cast(month(EXTRACT_DATE) AS varchar(4)),&#xA;&#x9;2) ,&#xA;&#x9;DateName(m,&#xA;&#x9;EXTRACT_DATE)+DATENAME(yy,&#xA;&#x9;EXTRACT_DATE) ,&#xA;&#x9;FUND_VALUE ,&#xA;&#x9;GL_ACCOUNT_NUMBER,&#xA;&#x9;ACCOUNT_NAME ,&#xA;&#x9;ORG_CODE ,&#xA;&#x9;PERSON_ID Having SUM(ISNULL(debit_amount,&#xA;&#x9;0)-Isnull(credit_amount,&#xA;&#x9;0)) &lt;&gt; 0 &#xA;ORDER BY    1,&#xA;&#x9;4,&#xA;&#x9;6 desc,&#xA;&#x9;7">
      <parameters>
        <parameter ID="@EXTRACT_DATE_From" sfwDataType="DateTime" />
        <parameter ID="@EXTRACT_DATE_To" sfwDataType="DateTime" />
        <parameter ID="@Fund_ID" sfwDataType="string" />
        <parameter ID="@Account_Code" sfwDataType="string" />
      </parameters>
    </query>
    <query ID="GetGLTransactionForReverse" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="-- here added credit_amount &gt; 0 condition because in code we are inserting credit and debit entries in single method&#xD;&#xA; SELECT *  &#xD;&#xA; FROM SGT_GL_TRANSACTION GL WITH(NOLOCK)&#xD;&#xA; INNER JOIN SGT_ACCOUNT_REFERENCE AR WITH(NOLOCK) ON GL.ACCOUNT_REFERENCE_ID = AR.ACCOUNT_REFERENCE_ID&#xD;&#xA; WHERE SOURCE_ID = @SOURCE_ID  AND GL.SOURCE_TYPE_VALUE ='EMPR' AND GL.TRANSACTION_TYPE_VALUE IN ('ALLO', 'ITLV')&#xD;&#xA; --AND CONVERT(date,(GL.POSTING_DATE)) = CONVERT(date,( SELECT POSTED_DATE FROM SGT_EMPLOYER_PAYROLL_HEADER WHERE EMPLOYER_PAYROLL_HEADER_ID = @SOURCE_ID)) &#xD;&#xA; AND ISNULL(CREDIT_AMOUNT, 0) &gt; 0">
      <parameters>
        <parameter ID="@SOURCE_ID" sfwDataType="int" />
      </parameters>
    </query>
  </queries>
  <attributes>
    <attribute ID="GlTransactionId" sfwType="Column" sfwValue="gl_transaction_id" sfwKeyNo="1" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="True" sfwDataType="int" sfwRequired="False" />
    <attribute ID="PlanId" sfwType="Column" sfwValue="plan_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="int" sfwRequired="False" />
    <attribute ID="FundDescription" sfwType="Description" sfwValue="fund_description" />
    <attribute ID="FundId" sfwType="Column" sfwValue="fund_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwCodeID="1300" sfwDataType="int" sfwRequired="False" />
    <attribute ID="FundValue" sfwType="Column" sfwValue="fund_value" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="string" sfwRequired="False" sfwLength="4" />
    <attribute ID="DeptDescription" sfwType="Description" sfwValue="dept_description" />
    <attribute ID="DeptId" sfwType="Column" sfwValue="dept_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwCodeID="1301" sfwDataType="int" sfwRequired="False" />
    <attribute ID="DeptValue" sfwType="Column" sfwValue="dept_value" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="string" sfwRequired="False" sfwLength="4" />
    <attribute ID="SourceTypeDescription" sfwType="Description" sfwValue="source_type_description" />
    <attribute ID="SourceTypeId" sfwType="Column" sfwValue="source_type_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwCodeID="1304" sfwDataType="int" sfwRequired="False" />
    <attribute ID="SourceTypeValue" sfwType="Column" sfwValue="source_type_value" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="string" sfwRequired="False" sfwLength="4" />
    <attribute ID="ItemTypeDescription" sfwType="Description" sfwValue="item_type_description" />
    <attribute ID="ItemTypeId" sfwType="Column" sfwValue="item_type_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwCodeID="1302" sfwDataType="int" sfwRequired="False" />
    <attribute ID="ItemTypeValue" sfwType="Column" sfwValue="item_type_value" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="string" sfwRequired="False" sfwLength="4" />
    <attribute ID="TransactionTypeDescription" sfwType="Description" sfwValue="transaction_type_description" />
    <attribute ID="TransactionTypeId" sfwType="Column" sfwValue="transaction_type_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwCodeID="1303" sfwDataType="int" sfwRequired="False" />
    <attribute ID="TransactionTypeValue" sfwType="Column" sfwValue="transaction_type_value" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="string" sfwRequired="False" sfwLength="4" />
    <attribute ID="AccountReferenceId" sfwType="Column" sfwValue="account_reference_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="int" sfwRequired="False" />
    <attribute ID="AccountId" sfwType="Column" sfwValue="account_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="int" sfwRequired="False" />
    <attribute ID="OrgId" sfwType="Column" sfwValue="org_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="int" sfwRequired="False" />
    <attribute ID="PersonId" sfwType="Column" sfwValue="person_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="int" sfwRequired="False" />
    <attribute ID="SourceId" sfwType="Column" sfwValue="source_id" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="int" sfwRequired="False" />
    <attribute ID="DebitAmount" sfwType="Column" sfwValue="debit_amount" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="decimal" sfwRequired="False" sfwLength="13,2" />
    <attribute ID="CreditAmount" sfwType="Column" sfwValue="credit_amount" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="decimal" sfwRequired="False" sfwLength="13,2" />
    <attribute ID="EffectiveDate" sfwType="Column" sfwValue="effective_date" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="DateTime" sfwRequired="False" />
    <attribute ID="PostingDate" sfwType="Column" sfwValue="posting_date" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="DateTime" sfwRequired="False" />
    <attribute ID="ExtractDate" sfwType="Column" sfwValue="extract_date" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="DateTime" sfwRequired="False" />
    <attribute ID="JournalDescription" sfwType="Column" sfwValue="journal_description" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="string" sfwRequired="False" sfwLength="100" />
    <attribute ID="ExtractFileName" sfwType="Column" sfwValue="extract_file_name" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="True" sfwIsIdentity="False" sfwDataType="string" sfwRequired="False" sfwLength="50" />
    <attribute ID="CreatedBy" sfwType="Column" sfwValue="created_by" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="string" sfwRequired="False" sfwLength="50" />
    <attribute ID="CreatedDate" sfwType="Column" sfwValue="created_date" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="DateTime" sfwRequired="False" />
    <attribute ID="ModifiedBy" sfwType="Column" sfwValue="modified_by" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="string" sfwRequired="False" sfwLength="50" />
    <attribute ID="ModifiedDate" sfwType="Column" sfwValue="modified_date" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="DateTime" sfwRequired="False" />
    <attribute ID="UpdateSeq" sfwType="Column" sfwValue="update_seq" sfwKeyNo="0" sfwIsSequence="False" sfwIsNull="False" sfwIsIdentity="False" sfwDataType="int" sfwRequired="False" />
    <attribute sfwDataType="int" sfwType="Property" ID="SourceIdDerived" sfwValue="icdoGlTransaction.source_id_derived" />
    <attribute sfwDataType="string" sfwType="Property" ID="LstrPlanName" sfwValue="lstrPlanName" />
    <attribute sfwDataType="string" sfwType="Property" ID="LstrAccountNumber" sfwValue="lstrAccountNumber" />
    <attribute sfwDataType="string" sfwType="Property" ID="LstrOrgCodeID" sfwValue="lstrOrgCodeID" />
  </attributes>
</entity>