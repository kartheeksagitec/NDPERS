<?xml version="1.0" encoding="utf-8"?>
<entity ID="entPersonAccountInsuranceContribution" sfwMainCDO="icdoPersonAccountInsuranceContribution" sfwType="BusinessRule" sfwActive="True" sfwStatus="Review" sfwObjectID="busPersonAccountInsuranceContribution" sfwTableName="sgt_person_account_insurance_contribution" sfwView="False" sfwParentEntity="entExtendBase">
  <queries>
    <query ID="CheckTransactionByPersonAccountID" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT * FROM SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION&#xD;&#xA;WHERE PERSON_ACCOUNT_ID=@PERSON_ACCOUNT_ID AND EFFECTIVE_DATE BETWEEN @START_DATE AND @END_DATE">
      <parameters>
        <parameter ID="@PERSON_ACCOUNT_ID" sfwDataType="int" />
        <parameter ID="@START_DATE" sfwDataType="DateTime" />
        <parameter ID="@END_DATE" sfwDataType="DateTime" />
      </parameters>
    </query>
    <query ID="CheckDueAmountForGivenEffectiveDate" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="Select *&#xD;&#xA;From dbo.SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION&#xD;&#xA;Where PERSON_ACCOUNT_ID= @PersonAccountID and EFFECTIVE_DATE&lt;=@effectivedate&#xD;&#xA;order by EFFECTIVE_DATE desc">
      <parameters>
        <parameter ID="@PersonAccountID" sfwDataType="int" />
        <parameter ID="@effectivedate" sfwDataType="DateTime" />
      </parameters>
    </query>
    <query ID="LoadIBSAllDueContributions" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT &#xD;&#xA; '1'  AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;INTO #TEMP&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR WITH(NOLOCK)&#xD;&#xA;&#xD;&#xA; INNER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON CONTR.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.plan_id != 9&#xD;&#xA;WHERE ACCT.PERSON_ID = @PERSONID&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA; AND TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS','IBAP','AIBS')  &#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;--ORDER BY &#xD;&#xA;--  CONTR.EFFECTIVE_DATE,&#xD;&#xA;--  ACCT.PLAN_ID&#xD;&#xA;  &#xD;&#xA;  &#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT &#xD;&#xA; '2'AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR WITH(NOLOCK)&#xD;&#xA; INNER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON CONTR.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.PLAN_ID != 9&#xD;&#xA; LEFT JOIN&#xD;&#xA;  ( &#xD;&#xA;   SELECT  IBS_DETAIL_ID,&#xD;&#xA;     IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID,&#xD;&#xA;     PEA.PAYMENT_OPTION_VALUE,&#xD;&#xA;     PEA.REPAYMENT_TYPE_VALUE,PEA.PROVIDER_ORG_ID &#xD;&#xA;    FROM SGT_IBS_DETAIL IBSD  WITH(NOLOCK)&#xD;&#xA;     LEFT JOIN  SGT_PAYMENT_ELECTION_ADJUSTMENT PEA   WITH(NOLOCK)&#xD;&#xA;      ON IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID &#xD;&#xA;       = PEA.PAYMENT_ELECTION_ADJUSTMENT_ID&#xD;&#xA;      AND REPAYMENT_TYPE_VALUE = 'LPSM'&#xD;&#xA;      AND  PEA.STATUS_VALUE NOT IN ('CNLD','PEND')&#xD;&#xA;&#x9;  AND ISNULL(IBSD.DETAIL_STATUS_VALUE, '') &lt;&gt; 'IGNR'&#xD;&#xA;  ) IBS ON CONTR.SUBSYSTEM_REF_ID = IBS.IBS_DETAIL_ID &#xD;&#xA;   --AND CONTR.PROVIDER_ORG_ID = IBS.PROVIDER_ORG_ID   &#xD;&#xA;   AND SUBSYSTEM_VALUE IN ('IBSD','IBSP')&#xD;&#xA;   AND TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS','IBAP','AIBS') &#xD;&#xA;WHERE ACCT.PERSON_ID = @PERSONID&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;--ORDER BY &#xD;&#xA;--  CONTR.EFFECTIVE_DATE,&#xD;&#xA;--  ACCT.PLAN_ID&#xD;&#xA;&#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT &#xD;&#xA; '3'AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR WITH(NOLOCK)&#xD;&#xA; INNER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON CONTR.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.PLAN_ID != 9&#xD;&#xA;  INNER JOIN &#xD;&#xA;  (&#xD;&#xA;  SELECT DISTINCT PEA.PROVIDER_ORG_ID &#xD;&#xA;    FROM SGT_PAYMENT_ELECTION_ADJUSTMENT PEA&#xD;&#xA;    &#xD;&#xA;     INNER JOIN  SGT_IBS_DETAIL IBSD &#xD;&#xA;      ON PEA.PAYMENT_ELECTION_ADJUSTMENT_ID=&#xD;&#xA;      IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID &#xD;&#xA;      WHERE REPAYMENT_TYPE_VALUE &lt;&gt; 'LPSM'&#xD;&#xA;      AND  PEA.STATUS_VALUE NOT IN ('CNLD','PEND')&#xD;&#xA;&#x9;  AND ISNULL(IBSD.DETAIL_STATUS_VALUE, '') &lt;&gt; 'IGNR'&#xD;&#xA;      --AND  CONTR.SUBSYSTEM_REF_ID = IBSD.IBS_DETAIL_ID &#xD;&#xA;      --AND  CONTR.PROVIDER_ORG_ID = IBSD.PROVIDER_ORG_ID  &#xD;&#xA;    )  IBS&#xD;&#xA;    ON   CONTR.PROVIDER_ORG_ID = IBS.PROVIDER_ORG_ID &#xD;&#xA;WHERE ACCT.PERSON_ID = @PERSONID&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;--ORDER BY &#xD;&#xA;--  CONTR.EFFECTIVE_DATE,&#xD;&#xA;--  ACCT.PLAN_ID&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;union ALL&#xD;&#xA;&#xD;&#xA;--Medicare&#xD;&#xA;SELECT &#xD;&#xA; '1'  AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;&#xD;&#xA;--INTO #TEMP&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_MEDICARE_PART_D_HISTORY MED WITH(NOLOCK)&#xD;&#xA;&#xD;&#xA; LEFT OUTER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON MED.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA;  inner join SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR on CONTR.PERSON_ACCOUNT_ID = MED.PERSON_ACCOUNT_ID&#xD;&#xA;  &#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.PLAN_ID = 9&#xD;&#xA;WHERE (MED.MEMBER_PERSON_ID = @PERSONID)&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA; AND TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS','IBAP','AIBS')  &#xD;&#xA; and (MED.START_DATE != ISNULL(MED.END_DATE, '99991231')) AND CONTR.EFFECTIVE_DATE BETWEEN MED.START_DATE AND isnull(MED.END_DATE,'99991231')--OR MED.START_DATE &lt;= CONTR.EFFECTIVE_DATE)&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;&#xD;&#xA; UNION ALL&#xD;&#xA;&#xD;&#xA;&#xD;&#xA; SELECT &#xD;&#xA; '2'AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_MEDICARE_PART_D_HISTORY MED WITH(NOLOCK)&#xD;&#xA; LEFT OUTER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON MED.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA;  inner join SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR on CONTR.PERSON_ACCOUNT_ID = MED.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID  and PL.PLAN_ID = 9&#xD;&#xA;  &#xD;&#xA; LEFT JOIN&#xD;&#xA;  ( &#xD;&#xA;   SELECT  IBS_DETAIL_ID,&#xD;&#xA;     IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID,&#xD;&#xA;     PEA.PAYMENT_OPTION_VALUE,&#xD;&#xA;     PEA.REPAYMENT_TYPE_VALUE,PEA.PROVIDER_ORG_ID &#xD;&#xA;    FROM SGT_IBS_DETAIL IBSD  WITH(NOLOCK)&#xD;&#xA;     LEFT JOIN  SGT_PAYMENT_ELECTION_ADJUSTMENT PEA   WITH(NOLOCK)&#xD;&#xA;      ON IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID &#xD;&#xA;       = PEA.PAYMENT_ELECTION_ADJUSTMENT_ID&#xD;&#xA;      AND REPAYMENT_TYPE_VALUE = 'LPSM'&#xD;&#xA;      AND  PEA.STATUS_VALUE NOT IN ('CNLD','PEND')&#xD;&#xA;&#x9;  AND ISNULL(IBSD.DETAIL_STATUS_VALUE, '') &lt;&gt; 'IGNR'&#xD;&#xA;  ) IBS ON CONTR.SUBSYSTEM_REF_ID = IBS.IBS_DETAIL_ID &#xD;&#xA;   --AND CONTR.PROVIDER_ORG_ID = IBS.PROVIDER_ORG_ID   &#xD;&#xA;   AND SUBSYSTEM_VALUE IN ('IBSD','IBSP')&#xD;&#xA;   AND TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS','IBAP','AIBS')&#xD;&#xA;WHERE (MED.MEMBER_PERSON_ID = @PERSONID)&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA; and (MED.START_DATE != ISNULL(MED.END_DATE, '99991231')) AND CONTR.EFFECTIVE_DATE BETWEEN MED.START_DATE AND isnull(MED.END_DATE,'99991231')&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;&#xD;&#xA; UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT &#xD;&#xA; '3'AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_MEDICARE_PART_D_HISTORY MED WITH(NOLOCK)&#xD;&#xA;&#xD;&#xA; LEFT OUTER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON MED.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA;  inner join SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR on CONTR.PERSON_ACCOUNT_ID = MED.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.PLAN_ID = 9&#xD;&#xA;  INNER JOIN &#xD;&#xA;  (&#xD;&#xA;  SELECT DISTINCT PEA.PROVIDER_ORG_ID &#xD;&#xA;    FROM SGT_PAYMENT_ELECTION_ADJUSTMENT PEA&#xD;&#xA;    &#xD;&#xA;     INNER JOIN  SGT_IBS_DETAIL IBSD &#xD;&#xA;      ON PEA.PAYMENT_ELECTION_ADJUSTMENT_ID=&#xD;&#xA;      IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID &#xD;&#xA;      WHERE REPAYMENT_TYPE_VALUE &lt;&gt; 'LPSM'&#xD;&#xA;      AND  PEA.STATUS_VALUE NOT IN ('CNLD','PEND')&#xD;&#xA;&#x9;  AND ISNULL(IBSD.DETAIL_STATUS_VALUE, '') &lt;&gt; 'IGNR'&#xD;&#xA;      --AND  CONTR.SUBSYSTEM_REF_ID = IBSD.IBS_DETAIL_ID &#xD;&#xA;      --AND  CONTR.PROVIDER_ORG_ID = IBSD.PROVIDER_ORG_ID &#xD;&#xA;    )  IBS&#xD;&#xA;    ON   CONTR.PROVIDER_ORG_ID = IBS.PROVIDER_ORG_ID &#xD;&#xA;WHERE (MED.MEMBER_PERSON_ID = @PERSONID)&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA;&#xD;&#xA;  and (MED.START_DATE != ISNULL(MED.END_DATE, '99991231')) AND CONTR.EFFECTIVE_DATE BETWEEN MED.START_DATE AND isnull(MED.END_DATE,'99991231')&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.EFFECTIVE_DATE,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;&#xD;&#xA;SELECT '1' AS REC_ORDER ,&#xD;&#xA;  PLAN_ID,&#xD;&#xA;  EFFECTIVE_DATE,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID,&#xD;&#xA;SUM(BALANCE_AMOUNT) AS BALANCE_AMOUNT&#xD;&#xA;INTO #TEMP2&#xD;&#xA;FROM #TEMP &#xD;&#xA;WHERE  REC_ORDER = '1'&#xD;&#xA;GROUP BY PLAN_ID,&#xD;&#xA;  EFFECTIVE_DATE,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID&#xD;&#xA;  &#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;SELECT '2' AS REC_ORDER ,&#xD;&#xA; PLAN_ID,&#xD;&#xA;  EFFECTIVE_DATE,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID,&#xD;&#xA;SUM(BALANCE_AMOUNT) AS BALANCE_AMOUNT&#xD;&#xA;FROM #TEMP &#xD;&#xA;WHERE  REC_ORDER IN ('1','2')&#xD;&#xA;GROUP BY PLAN_ID,&#xD;&#xA;  EFFECTIVE_DATE,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID&#xD;&#xA;&#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT '3' AS REC_ORDER ,&#xD;&#xA; PLAN_ID,&#xD;&#xA;  EFFECTIVE_DATE,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID,&#xD;&#xA; SUM(BALANCE_AMOUNT) AS BALANCE_AMOUNT&#xD;&#xA;FROM #TEMP &#xD;&#xA;WHERE  REC_ORDER IN ('1','3')&#xD;&#xA;GROUP BY PLAN_ID,&#xD;&#xA;  EFFECTIVE_DATE,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID&#xD;&#xA; &#xD;&#xA;SELECT  REC_ORDER ,&#xD;&#xA; PLAN_ID,&#xD;&#xA;  EFFECTIVE_DATE,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID,&#xD;&#xA; SUM(BALANCE_AMOUNT) AS BALANCE_AMOUNT&#xD;&#xA;FROM #TEMP2 &#xD;&#xA;WHERE REC_ORDER = @RECORDORDER&#xD;&#xA;GROUP BY REC_ORDER,PLAN_ID,&#xD;&#xA;  EFFECTIVE_DATE,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(BALANCE_AMOUNT) &gt; 0 &#xD;&#xA;ORDER BY &#xD;&#xA;  REC_ORDER,&#xD;&#xA;  EFFECTIVE_DATE,&#xD;&#xA;  CASE WHEN PLAN_ID = 12 then 1&#xD;&#xA;  WHEN plan_id&#x9;= 9 then 2&#xD;&#xA;  ELSE 3&#xD;&#xA;  END&#xD;&#xA;  &#xD;&#xA;&#xD;&#xA;DROP TABLE #TEMP&#xD;&#xA;DROP TABLE #TEMP2">
      <parameters>
        <parameter ID="@PERSONID" sfwDataType="int" />
        <parameter ID="@RECORDORDER" sfwDataType="int" />
      </parameters>
    </query>
    <query ID="LoadIBSDueContributionsWithoutStausCheck" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="--not used&#xD;&#xA;SELECT &#xD;&#xA;CASE WHEN TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS') THEN '1'&#xD;&#xA;      WHEN TRANSACTION_TYPE_VALUE IN ('IBAP','AIBS') THEN '2'&#xD;&#xA;      ELSE '0' END AS REC_ORDER,&#xD;&#xA;ACCT.PLAN_ID,CONTR.EFFECTIVE_DATE,CONTR.PERSON_ACCOUNT_ID,CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR WITH(NOLOCK)&#xD;&#xA; INNER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON CONTR.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PERSON_ACCOUNT_PAYMENT_ELECTION ELEC WITH(NOLOCK)&#xD;&#xA;  ON ELEC.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID&#xD;&#xA;WHERE ACCT.PERSON_ACCOUNT_ID = @PERSONACCOUNTID&#xD;&#xA; --AND (ELEC.IBS_FLAG='Y' OR ELEC.IBS_SUPPLEMENTAL_FLAG='Y')&#xD;&#xA; --AND ISNULL(ACCT.END_DATE,GETDATE()) &gt;= GETDATE()&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA;GROUP BY &#xD;&#xA;CASE WHEN TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS') THEN '1'&#xD;&#xA;      WHEN TRANSACTION_TYPE_VALUE IN ('IBAP','AIBS') THEN '2'&#xD;&#xA;      ELSE '0' END,&#xD;&#xA; CONTR.EFFECTIVE_DATE,CONTR.PERSON_ACCOUNT_ID,ACCT.PLAN_ID,CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &gt; 0&#xD;&#xA;ORDER BY &#xD;&#xA;CASE WHEN TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS') THEN '1'&#xD;&#xA;      WHEN TRANSACTION_TYPE_VALUE IN ('IBAP','AIBS') THEN '2'&#xD;&#xA;      ELSE '0' END,&#xD;&#xA;  CONTR.EFFECTIVE_DATE,&#xD;&#xA;  ACCT.PLAN_ID">
      <parameters>
        <parameter ID="@PERSONACCOUNTID" sfwDataType="int" />
      </parameters>
    </query>
    <query ID="LoadIBSAllDueContributionsWithoutEffectiveDate" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="SELECT &#xD;&#xA; '1'  AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;INTO #TEMP&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR WITH(NOLOCK)&#xD;&#xA;&#xD;&#xA; INNER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON CONTR.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.plan_id != 9&#xD;&#xA;WHERE ACCT.PERSON_ID = @PERSONID&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA; AND TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS','IBAP','AIBS')  &#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;--ORDER BY &#xD;&#xA;--  CONTR.EFFECTIVE_DATE,&#xD;&#xA;--  ACCT.PLAN_ID&#xD;&#xA;  &#xD;&#xA;  &#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT &#xD;&#xA; '2'AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR WITH(NOLOCK)&#xD;&#xA; INNER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON CONTR.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.plan_id != 9&#xD;&#xA; INNER JOIN&#xD;&#xA;  ( &#xD;&#xA;   SELECT  IBS_DETAIL_ID,&#xD;&#xA;     IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID,&#xD;&#xA;     PEA.PAYMENT_OPTION_VALUE,&#xD;&#xA;     PEA.REPAYMENT_TYPE_VALUE,PEA.PROVIDER_ORG_ID &#xD;&#xA;    FROM SGT_IBS_DETAIL IBSD  WITH(NOLOCK)&#xD;&#xA;     LEFT JOIN  SGT_PAYMENT_ELECTION_ADJUSTMENT PEA   WITH(NOLOCK)&#xD;&#xA;      ON IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID &#xD;&#xA;       = PEA.PAYMENT_ELECTION_ADJUSTMENT_ID&#xD;&#xA;      AND REPAYMENT_TYPE_VALUE = 'LPSM'&#xD;&#xA;      AND  PEA.STATUS_VALUE NOT IN ('CNLD','PEND')&#xD;&#xA;&#x9;  AND ISNULL(IBSD.DETAIL_STATUS_VALUE, '') &lt;&gt; 'IGNR'&#xD;&#xA;  ) IBS ON CONTR.SUBSYSTEM_REF_ID = IBS.IBS_DETAIL_ID &#xD;&#xA;   --AND CONTR.PROVIDER_ORG_ID = IBS.PROVIDER_ORG_ID   &#xD;&#xA;   AND SUBSYSTEM_VALUE IN ('IBSD','IBSP')&#xD;&#xA;   AND TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS','IBAP','AIBS')&#xD;&#xA;WHERE ACCT.PERSON_ID = @PERSONID&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;--ORDER BY &#xD;&#xA;--  CONTR.EFFECTIVE_DATE,&#xD;&#xA;--  ACCT.PLAN_ID&#xD;&#xA;&#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT &#xD;&#xA; '3'AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR WITH(NOLOCK)&#xD;&#xA; INNER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON CONTR.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.plan_id != 9&#xD;&#xA;  INNER JOIN &#xD;&#xA;  (&#xD;&#xA;  SELECT DISTINCT PEA.PROVIDER_ORG_ID &#xD;&#xA;    FROM SGT_PAYMENT_ELECTION_ADJUSTMENT PEA&#xD;&#xA;    &#xD;&#xA;     INNER JOIN  SGT_IBS_DETAIL IBSD &#xD;&#xA;      ON PEA.PAYMENT_ELECTION_ADJUSTMENT_ID=&#xD;&#xA;      IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID &#xD;&#xA;      WHERE REPAYMENT_TYPE_VALUE &lt;&gt; 'LPSM'&#xD;&#xA;      AND  PEA.STATUS_VALUE NOT IN ('CNLD','PEND')&#xD;&#xA;&#x9;  AND ISNULL(IBSD.DETAIL_STATUS_VALUE, '') &lt;&gt; 'IGNR'&#xD;&#xA;      --AND  CONTR.SUBSYSTEM_REF_ID = IBSD.IBS_DETAIL_ID &#xD;&#xA;      --AND  CONTR.PROVIDER_ORG_ID = IBSD.PROVIDER_ORG_ID &#xD;&#xA;    )  IBS&#xD;&#xA;    ON   CONTR.PROVIDER_ORG_ID = IBS.PROVIDER_ORG_ID &#xD;&#xA;WHERE ACCT.PERSON_ID = @PERSONID&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;--ORDER BY &#xD;&#xA;--  CONTR.EFFECTIVE_DATE,&#xD;&#xA;--  ACCT.PLAN_ID&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;union ALL&#xD;&#xA;&#xD;&#xA;--Medicare&#xD;&#xA;SELECT &#xD;&#xA; '1'  AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;&#xD;&#xA;--INTO #TEMP&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_MEDICARE_PART_D_HISTORY MED WITH(NOLOCK)&#xD;&#xA;&#xD;&#xA; LEFT OUTER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON MED.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA;  inner join SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR on CONTR.PERSON_ACCOUNT_ID = MED.PERSON_ACCOUNT_ID&#xD;&#xA;  &#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.PLAN_ID = 9&#xD;&#xA;WHERE (MED.MEMBER_PERSON_ID = @PERSONID)&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA; AND TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS','IBAP','AIBS')  &#xD;&#xA; and (MED.START_DATE != ISNULL(MED.END_DATE, '99991231')) --AND CONTR.EFFECTIVE_DATE BETWEEN MED.START_DATE AND isnull(MED.END_DATE,'99991231')--OR MED.START_DATE &lt;= CONTR.EFFECTIVE_DATE)&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;&#xD;&#xA; UNION ALL&#xD;&#xA;&#xD;&#xA;&#xD;&#xA; SELECT &#xD;&#xA; '2'AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_MEDICARE_PART_D_HISTORY MED WITH(NOLOCK)&#xD;&#xA; LEFT OUTER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON MED.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA;  inner join SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR on CONTR.PERSON_ACCOUNT_ID = MED.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID  and PL.PLAN_ID = 9&#xD;&#xA;  &#xD;&#xA;INNER JOIN&#xD;&#xA;  ( &#xD;&#xA;   SELECT  IBS_DETAIL_ID,&#xD;&#xA;     IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID,&#xD;&#xA;     PEA.PAYMENT_OPTION_VALUE,&#xD;&#xA;     PEA.REPAYMENT_TYPE_VALUE,PEA.PROVIDER_ORG_ID &#xD;&#xA;    FROM SGT_IBS_DETAIL IBSD  WITH(NOLOCK)&#xD;&#xA;     LEFT JOIN  SGT_PAYMENT_ELECTION_ADJUSTMENT PEA   WITH(NOLOCK)&#xD;&#xA;      ON IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID &#xD;&#xA;       = PEA.PAYMENT_ELECTION_ADJUSTMENT_ID&#xD;&#xA;      AND REPAYMENT_TYPE_VALUE = 'LPSM'&#xD;&#xA;      AND  PEA.STATUS_VALUE NOT IN ('CNLD','PEND')&#xD;&#xA;&#x9;  AND ISNULL(IBSD.DETAIL_STATUS_VALUE, '') &lt;&gt; 'IGNR'&#xD;&#xA;  ) IBS ON CONTR.SUBSYSTEM_REF_ID = IBS.IBS_DETAIL_ID &#xD;&#xA;   --AND CONTR.PROVIDER_ORG_ID = IBS.PROVIDER_ORG_ID   &#xD;&#xA;   AND SUBSYSTEM_VALUE IN ('IBSD','IBSP')&#xD;&#xA;   AND TRANSACTION_TYPE_VALUE IN ('IBSP','RIBS','IBAP','AIBS')&#xD;&#xA;WHERE (MED.MEMBER_PERSON_ID = @PERSONID)&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA; and (MED.START_DATE != ISNULL(MED.END_DATE, '99991231')) --AND CONTR.EFFECTIVE_DATE BETWEEN MED.START_DATE AND isnull(MED.END_DATE,'99991231')&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;&#xD;&#xA; UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT &#xD;&#xA; '3'AS REC_ORDER,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID,&#xD;&#xA; SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) AS BALANCE_AMOUNT&#xD;&#xA;FROM SGT_PERSON_ACCOUNT_MEDICARE_PART_D_HISTORY MED WITH(NOLOCK)&#xD;&#xA;&#xD;&#xA; LEFT OUTER JOIN SGT_PERSON_ACCOUNT ACCT WITH(NOLOCK)&#xD;&#xA;  ON MED.PERSON_ACCOUNT_ID = ACCT.PERSON_ACCOUNT_ID&#xD;&#xA;  inner join SGT_PERSON_ACCOUNT_INSURANCE_CONTRIBUTION CONTR on CONTR.PERSON_ACCOUNT_ID = MED.PERSON_ACCOUNT_ID&#xD;&#xA; INNER JOIN SGT_PLAN PL WITH(NOLOCK)&#xD;&#xA;  ON ACCT.PLAN_ID = PL.PLAN_ID and PL.PLAN_ID = 9&#xD;&#xA;  INNER JOIN &#xD;&#xA;  (&#xD;&#xA;  SELECT DISTINCT PEA.PROVIDER_ORG_ID &#xD;&#xA;    FROM SGT_PAYMENT_ELECTION_ADJUSTMENT PEA&#xD;&#xA;    &#xD;&#xA;     INNER JOIN  SGT_IBS_DETAIL IBSD &#xD;&#xA;      ON PEA.PAYMENT_ELECTION_ADJUSTMENT_ID=&#xD;&#xA;      IBSD.PAYMENT_ELECTION_ADJUSTMENT_ID &#xD;&#xA;      WHERE REPAYMENT_TYPE_VALUE &lt;&gt; 'LPSM'&#xD;&#xA;      AND  PEA.STATUS_VALUE NOT IN ('CNLD','PEND')&#xD;&#xA;&#x9;  AND ISNULL(IBSD.DETAIL_STATUS_VALUE, '') &lt;&gt; 'IGNR'&#xD;&#xA;      --AND  CONTR.SUBSYSTEM_REF_ID = IBSD.IBS_DETAIL_ID &#xD;&#xA;      --AND  CONTR.PROVIDER_ORG_ID = IBSD.PROVIDER_ORG_ID  &#xD;&#xA;    )  IBS&#xD;&#xA;    ON   CONTR.PROVIDER_ORG_ID = IBS.PROVIDER_ORG_ID &#xD;&#xA;WHERE (MED.MEMBER_PERSON_ID = @PERSONID)&#xD;&#xA; AND PL.BENEFIT_TYPE_VALUE = 'INSR'&#xD;&#xA; AND ACCT.PLAN_PARTICIPATION_STATUS_VALUE IN ('ENL2','SUS3')&#xD;&#xA; &#xD;&#xA;  and (MED.START_DATE != ISNULL(MED.END_DATE, '99991231'))-- AND CONTR.EFFECTIVE_DATE BETWEEN MED.START_DATE AND isnull(MED.END_DATE,'99991231')&#xD;&#xA;GROUP BY &#xD;&#xA; CONTR.PERSON_ACCOUNT_ID,&#xD;&#xA; ACCT.PLAN_ID,&#xD;&#xA; CONTR.PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(ISNULL(CONTR.DUE_PREMIUM_AMOUNT,0)) &#xD;&#xA; - SUM(ISNULL(CONTR.PAID_PREMIUM_AMOUNT,0)) &lt;&gt; 0&#xD;&#xA;&#xD;&#xA;SELECT '1' AS REC_ORDER ,&#xD;&#xA;  PLAN_ID,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID,&#xD;&#xA;SUM(BALANCE_AMOUNT) AS BALANCE_AMOUNT&#xD;&#xA;INTO #TEMP2&#xD;&#xA;FROM #TEMP &#xD;&#xA;WHERE  REC_ORDER = '1'&#xD;&#xA;GROUP BY PLAN_ID,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID&#xD;&#xA;  &#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT '2' AS REC_ORDER ,&#xD;&#xA;  PLAN_ID,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID,&#xD;&#xA;SUM(BALANCE_AMOUNT) AS BALANCE_AMOUNT&#xD;&#xA;FROM #TEMP WITH(NOLOCK) &#xD;&#xA;WHERE  REC_ORDER IN ('1','2')&#xD;&#xA;GROUP BY PLAN_ID,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID&#xD;&#xA;&#xD;&#xA;UNION ALL&#xD;&#xA;&#xD;&#xA;SELECT '3' AS REC_ORDER ,&#xD;&#xA;  PLAN_ID,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID,&#xD;&#xA; SUM(BALANCE_AMOUNT) AS BALANCE_AMOUNT&#xD;&#xA;FROM #TEMP WITH(NOLOCK) &#xD;&#xA;WHERE  REC_ORDER IN ('1','3')&#xD;&#xA;GROUP BY PLAN_ID,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID&#xD;&#xA; &#xD;&#xA; &#xD;&#xA;SELECT  REC_ORDER ,&#xD;&#xA;  PLAN_ID,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID,&#xD;&#xA; SUM(BALANCE_AMOUNT) AS BALANCE_AMOUNT&#xD;&#xA;FROM #TEMP2 WITH(NOLOCK) &#xD;&#xA;GROUP BY REC_ORDER,PLAN_ID,&#xD;&#xA;  PERSON_ACCOUNT_ID,&#xD;&#xA;  PROVIDER_ORG_ID&#xD;&#xA;HAVING SUM(BALANCE_AMOUNT) &gt;= 0 &#xD;&#xA;ORDER BY &#xD;&#xA;  REC_ORDER DESC,&#xD;&#xA;  CASE WHEN PLAN_ID = 12 then 1&#xD;&#xA;  WHEN PLAN_ID&#x9;= 9 then 2&#xD;&#xA;  ELSE 3&#xD;&#xA;  END&#xD;&#xA;&#xD;&#xA;DROP TABLE #TEMP&#xD;&#xA;DROP TABLE #TEMP2">
      <parameters>
        <parameter ID="@PERSONID" sfwDataType="int" />
      </parameters>
    </query>
  </queries>
  <attributes>
    <attribute ID="HealthInsuranceContributionId" sfwType="Column" sfwValue="health_insurance_contribution_id" sfwIsNull="False" sfwKeyNo="1" sfwIsIdentity="True" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="PersonAccountId" sfwType="Column" sfwValue="person_account_id" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="SubsystemDescription" sfwType="Description" sfwValue="subsystem_description" />
    <attribute ID="SubsystemId" sfwType="Column" sfwValue="subsystem_id" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="int" sfwCodeID="349" sfwIsSequence="False" />
    <attribute ID="SubsystemValue" sfwType="Column" sfwValue="subsystem_value" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="string" sfwLength="4" sfwIsSequence="False" />
    <attribute ID="SubsystemRefId" sfwType="Column" sfwValue="subsystem_ref_id" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="TransactionDate" sfwType="Column" sfwValue="transaction_date" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="DateTime" sfwIsSequence="False" />
    <attribute ID="EffectiveDate" sfwType="Column" sfwValue="effective_date" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="DateTime" sfwIsSequence="False" />
    <attribute ID="PersonEmploymentDtlId" sfwType="Column" sfwValue="person_employment_dtl_id" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="TransactionTypeDescription" sfwType="Description" sfwValue="transaction_type_description" />
    <attribute ID="TransactionTypeId" sfwType="Column" sfwValue="transaction_type_id" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="int" sfwCodeID="350" sfwIsSequence="False" />
    <attribute ID="TransactionTypeValue" sfwType="Column" sfwValue="transaction_type_value" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="string" sfwLength="4" sfwIsSequence="False" />
    <attribute ID="DuePremiumAmount" sfwType="Column" sfwValue="due_premium_amount" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="PaidPremiumAmount" sfwType="Column" sfwValue="paid_premium_amount" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="RhicBenefitAmount" sfwType="Column" sfwValue="rhic_benefit_amount" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="CreatedBy" sfwType="Column" sfwValue="created_by" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="string" sfwLength="50" sfwIsSequence="False" />
    <attribute ID="CreatedDate" sfwType="Column" sfwValue="created_date" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="DateTime" sfwIsSequence="False" />
    <attribute ID="ModifiedBy" sfwType="Column" sfwValue="modified_by" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="string" sfwLength="50" sfwIsSequence="False" />
    <attribute ID="ModifiedDate" sfwType="Column" sfwValue="modified_date" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="DateTime" sfwIsSequence="False" />
    <attribute ID="UpdateSeq" sfwType="Column" sfwValue="update_seq" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="GroupHealthFeeAmt" sfwType="Column" sfwValue="group_health_fee_amt" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LifeBasicPremiumAmount" sfwType="Column" sfwValue="life_basic_premium_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LifeSuppPremiumAmount" sfwType="Column" sfwValue="life_supp_premium_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LifeSpouseSuppPremiumAmount" sfwType="Column" sfwValue="life_spouse_supp_premium_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LifeDepSuppPremiumAmount" sfwType="Column" sfwValue="life_dep_supp_premium_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="PaymentHistoryHeaderId" sfwType="Column" sfwValue="payment_history_header_id" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="OthrRhicAmount" sfwType="Column" sfwValue="othr_rhic_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="JsRhicAmount" sfwType="Column" sfwValue="js_rhic_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LtcMemberThreeYrsPremiumAmount" sfwType="Column" sfwValue="ltc_member_three_yrs_premium_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LtcMemberFiveYrsPremiumAmount" sfwType="Column" sfwValue="ltc_member_five_yrs_premium_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LtcSpouseThreeYrsPremiumAmount" sfwType="Column" sfwValue="ltc_spouse_three_yrs_premium_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LtcSpouseFiveYrsPremiumAmount" sfwType="Column" sfwValue="ltc_spouse_five_yrs_premium_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="GroupNumber" sfwType="Column" sfwValue="group_number" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="string" sfwLength="50" sfwIsSequence="False" />
    <attribute ID="LifeBasicCoverageAmount" sfwType="Column" sfwValue="life_basic_coverage_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LifeSuppCoverageAmount" sfwType="Column" sfwValue="life_supp_coverage_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LifeSpouseSuppCoverageAmount" sfwType="Column" sfwValue="life_spouse_supp_coverage_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="LifeDepSuppCoverageAmount" sfwType="Column" sfwValue="life_dep_supp_coverage_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="AdAndDBasicPremiumRate" sfwType="Column" sfwValue="ad_and_d_basic_premium_rate" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,4" sfwIsSequence="False" />
    <attribute ID="AdAndDSupplementalPremiumRate" sfwType="Column" sfwValue="ad_and_d_supplemental_premium_rate" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,4" sfwIsSequence="False" />
    <attribute ID="ProviderOrgId" sfwType="Column" sfwValue="provider_org_id" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="RateStructureCode" sfwType="Column" sfwValue="rate_structure_code" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="string" sfwLength="4" sfwIsSequence="False" />
    <attribute ID="CoverageCode" sfwType="Column" sfwValue="coverage_code" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="string" sfwLength="4" sfwIsSequence="False" />
    <attribute ID="HsaAmount" sfwType="Column" sfwValue="hsa_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,4" sfwIsSequence="False" />
    <attribute ID="VendorAmount" sfwType="Column" sfwValue="vendor_amount" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,4" sfwIsSequence="False" />
    <attribute ID="BuydownAmount" sfwType="Column" sfwValue="buydown_amount" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="13,2" sfwIsSequence="False" />
    <attribute ID="MedicarePartDAmt" sfwType="Column" sfwValue="medicare_part_d_amt" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="decimal" sfwLength="7,2" />
    <attribute sfwDataType="string" sfwType="Property" ID="PremiumMonth" sfwValue="icdoPersonAccountInsuranceContribution.PremiumMonth" />
    <attribute ID="objPersonAccount" sfwType="Object" sfwEntity="entPersonAccount" sfwValue="ibusPersonAccount" />
    <attribute sfwDataType="datetime" sfwType="Property" ID="IdtTransactionDateFrom" sfwValue="idtTransactionDateFrom" />
    <attribute sfwDataType="datetime" sfwType="Property" ID="IdtTransactionDateTo" sfwValue="idtTransactionDateTo" />
    <attribute sfwDataType="datetime" sfwType="Property" ID="IdtEffectiveDateFrom" sfwValue="idtEffectiveDateFrom" />
    <attribute sfwDataType="datetime" sfwType="Property" ID="IdtEffectiveDateTo" sfwValue="idtEffectiveDateTo" />
    <attribute sfwDataType="string" sfwType="Property" ID="IstrTransactionType" sfwValue="istrTransactionType" />
    <attribute sfwDataType="string" sfwType="Property" ID="IstrSource" sfwValue="istrSource" />
    <attribute sfwDataType="string" sfwType="Property" ID="IstrGroupBy" sfwValue="istrGroupBy" />
    <attribute sfwDataType="string" sfwType="Property" ID="StrOrg" sfwValue="icdoPersonAccountInsuranceContribution.strOrg" />
    <attribute sfwDataType="string" sfwType="Property" ID="IstrSelected" sfwValue="icdoPersonAccountInsuranceContribution.istrSelected" />
    <attribute sfwDataType="string" sfwType="Property" ID="IstrPostedMonthYear" sfwValue="icdoPersonAccountInsuranceContribution.istrPostedMonthYear" />
    <attribute sfwDataType="string" sfwType="Property" ID="IstrEditedSubsystem" sfwValue="icdoPersonAccountInsuranceContribution.istrEditedSubsystem" />
    <attribute sfwDataType="decimal" sfwType="Property" ID="IdecTotalPaidPremiumAmount" sfwValue="icdoPersonAccountInsuranceContribution.idecTotalPaidPremiumAmount" />
    <attribute sfwDataType="decimal" sfwType="Property" ID="IdecTotalDuePremiumAmount" sfwValue="icdoPersonAccountInsuranceContribution.idecTotalDuePremiumAmount" />
    <attribute sfwDataType="string" sfwType="Property" ID="IstrEarliestMonthYear" sfwValue="istrEarliestMonthYear" />
    <attribute sfwDataType="string" sfwType="Property" ID="IstrLatestMonthYear" sfwValue="istrLatestMonthYear" />
    <attribute ID="objPaymentElectionAdjustment" sfwType="Object" sfwEntity="entPaymentElectionAdjustment" sfwValue="ibusPaymentElectionAdjustment" />
  </attributes>
  <objectmethods>
    <method ID="btnAllocateRemittanceClick" sfwReturnType="ArrayList" />
    <method ID="FilterInsuranceContribution" sfwReturnType="ArrayList" />
    <method ID="ResetSearchFilter" sfwReturnType="ArrayList" />
  </objectmethods>
</entity>