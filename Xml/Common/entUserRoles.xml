<?xml version="1.0" encoding="utf-8"?>
<entity ID="entUserRoles" sfwActive="True" sfwStatus="Valid" sfwRemoteObject="srvAdmin" sfwType="BusinessRule" sfwMainCDO="icdoUserRoles" sfwObjectID="busUserRoles" sfwTableName="sgs_user_roles">
  <rules>
    <rule ID="Rule Check  Role" sfwMessageId="5016" sfwExpression="(this.icdoUserRoles.role_id == 0)" sfwObjectBased="True" />
    <rule ID="Rule check if Start Date is greater than end date" sfwMessageId="5017" sfwExpression="(this.icdoUserRoles.effective_start_date != DateTime.MinValue) &amp;&amp; &#xA;(this.icdoUserRoles.effective_end_date != DateTime.MinValue) &amp;&amp; &#xA;(this.icdoUserRoles.effective_end_date &lt;= this.icdoUserRoles.effective_start_date)" sfwObjectBased="True" />
    <rule ID="RULE CHECK LOGGED USER ID IS CURRENT USER ID" sfwMessageId="5020" sfwExpression="(RFunc.GetValue&lt;Int32&gt;(this, &quot;ibusUser.icdoUser.user_serial_id&quot;) == RFunc.GetValue&lt;Int32&gt;(this, &quot;ibusUser.icdoUser.Loggedin_user_id&quot;))" sfwObjectBased="True" />
    <rule ID="Rule Duplicate Role" sfwMessageId="5021" sfwExpression="(RFunc.ExecuteQuery&lt;Int32&gt;(&quot;entUserRoles.ByUserRole&quot;, this.icdoUserRoles.user_serial_id, this.icdoUserRoles.role_id) &gt; 0)" sfwObjectBased="True" />
    <rule ID="Rule if entered start date less than old value in update" sfwMessageId="5023" sfwExpression="(this.icdoUserRoles.effective_start_date != DateTime.MinValue) &amp;&amp; &#xA;(this.icdoUserRoles.effective_start_date &lt; Convert.ToDateTime(this.icdoUserRoles.ihstOldValues[&quot;effective_start_date&quot;]))" sfwObjectBased="True" />
    <rule ID="Rule if Start date is not null and past date" sfwMessageId="5018" sfwExpression="(this.icdoUserRoles.effective_start_date != DateTime.MinValue) &amp;&amp; &#xA;(this.icdoUserRoles.effective_start_date &lt; RFunc.CurrentDate())" sfwObjectBased="True" />
    <rule ID="Rule if Start Date is null" sfwMessageId="5019" sfwExpression="(this.icdoUserRoles.effective_start_date == DateTime.MinValue)" sfwObjectBased="True" />
  </rules>
  <delete />
  <checklist />
  <initialload />
  <softerror />
  <harderror>
    <item ID="Rule Duplicate Role" sfwMode="New" sfwStatus="Active" />
    <item ID="Rule Check  Role" sfwMode="All" sfwStatus="Active" />
    <item ID="RULE CHECK LOGGED USER ID IS CURRENT USER ID" sfwMode="All" sfwStatus="Active" />
    <item ID="Rule if Start date is not null and past date" sfwMode="New" sfwStatus="Active" />
    <item ID="Rule if Start Date is null" sfwMode="All" sfwStatus="Active" />
    <item ID="Rule check if Start Date is greater than end date" sfwMode="All" sfwStatus="Active" />
    <item ID="Rule if entered start date less than old value in update" sfwMode="All" sfwStatus="Active" />
  </harderror>
  <validatedelete />
  <updateablecdo />
  <queries>
    <query ID="ByUser" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="select a.*,&#xD;&#xA;       role_description&#xD;&#xA;  from sgs_user_roles a, sgs_roles b&#xD;&#xA; where user_serial_id = @user_serial_id&#xD;&#xA;   and a.role_id = b.role_id">
      <parameters>
        <parameter ID="@user_serial_id" sfwDataType="int" />
      </parameters>
    </query>
    <query ID="CountByRole" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="select count(*) &#xD;&#xA;  from sgs_user_roles&#xD;&#xA; where role_id = @role_id&#xD;&#xA;">
      <parameters>
        <parameter ID="@role_id" sfwDataType="int" />
      </parameters>
    </query>
    <query ID="ByUserRole" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="select count(*) &#xD;&#xA;  from sgs_user_roles&#xD;&#xA;where user_serial_id = @user_serial_id&#xD;&#xA;  and role_id = @role_id">
      <parameters>
        <parameter ID="@user_serial_id" sfwDataType="string" />
        <parameter ID="@role_id" sfwDataType="int" />
      </parameters>
    </query>
    <query ID="GetUserWithActiveStatus" sfwQueryType="SelectQuery" sfwDataType="EntityTable" sfwSql="select * from sgs_user us,sgs_user_roles usr where &#xD;&#xA;           us.user_serial_id = usr.user_serial_id and us.user_status_value = 'A'&#xD;&#xA;         and usr.user_serial_id = @user_serial_id">
      <parameters>
        <parameter ID="@user_serial_id" />
      </parameters>
    </query>
  </queries>
  <attributes>
    <attribute ID="UserSerialId" sfwType="Column" sfwValue="user_serial_id" sfwIsNull="False" sfwKeyNo="1" sfwIsIdentity="False" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="RoleId" sfwType="Column" sfwValue="role_id" sfwIsNull="False" sfwKeyNo="2" sfwIsIdentity="False" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="EffectiveStartDate" sfwType="Column" sfwValue="effective_start_date" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="DateTime" />
    <attribute ID="EffectiveEndDate" sfwType="Column" sfwValue="effective_end_date" sfwIsNull="True" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="DateTime" />
    <attribute ID="CreatedBy" sfwType="Column" sfwValue="created_by" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="string" sfwLength="50" sfwIsSequence="False" />
    <attribute ID="CreatedDate" sfwType="Column" sfwValue="created_date" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="DateTime" sfwIsSequence="False" />
    <attribute ID="ModifiedBy" sfwType="Column" sfwValue="modified_by" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="string" sfwLength="50" sfwIsSequence="False" />
    <attribute ID="ModifiedDate" sfwType="Column" sfwValue="modified_date" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="DateTime" sfwIsSequence="False" />
    <attribute ID="UpdateSeq" sfwType="Column" sfwValue="update_seq" sfwIsNull="False" sfwKeyNo="0" sfwIsIdentity="False" sfwDataType="int" sfwIsSequence="False" />
    <attribute ID="objUser" sfwType="Object" sfwEntity="entUser" sfwValue="ibusUser" />
    <attribute sfwDataType="string" sfwType="Property" ID="RoleDescription" sfwValue="icdoRoles.role_description" />
  </attributes>
</entity>